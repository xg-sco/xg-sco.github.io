<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Vue3</title>
    <link href="/%E5%89%8D%E7%AB%AF/Vue3/"/>
    <url>/%E5%89%8D%E7%AB%AF/Vue3/</url>
    
    <content type="html"><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><blockquote><p><a href="https://github.com/vuejs/vue-next/releases/tag/v3.0.0">https://github.com/vuejs/vue-next/releases/tag/v3.0.0</a><br><img src="/assets/2023-06-05-15-11-09.png"></p></blockquote><h2 id="使用vue-cli创建工程"><a href="#使用vue-cli创建工程" class="headerlink" title="使用vue-cli创建工程"></a>使用vue-cli创建工程</h2><blockquote><p>官方文档：<a href="https://cli.vuejs.org/zh/guide/creating-a-project.html#vue-create">https://cli.vuejs.org/zh/guide/creating-a-project.html#vue-create</a></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## 查看@vue/cli版本，确保@vue/cli版本在4.5.0以上</span><br>vue --version<br><span class="hljs-comment">## 或者使用</span><br>vue -V<br><br><span class="hljs-comment">## 安装或者升级你的@vue/cli</span><br>npm install -g @vue/cli<br><br><span class="hljs-comment">## 创建</span><br>vue create vue3_test<br><br><span class="hljs-comment"># 勾选vue3, 选择npm</span><br><br><span class="hljs-comment">## 启动</span><br><span class="hljs-built_in">cd</span> vue3_test<br>npm run serve<br></code></pre></td></tr></table></figure><p>显示<code>Successfully created project vue3_test.</code>说明安装成功了<br><img src="/assets/2023-06-05-15-21-11.png"></p><p>启动脚手架<br><img src="/assets/2023-06-05-15-22-52.png"></p><p>页面效果<br><img src="/assets/2023-06-05-15-23-20.png"></p><h2 id="使用vite创建工程"><a href="#使用vite创建工程" class="headerlink" title="使用vite创建工程"></a>使用vite创建工程</h2><blockquote><p>官方文档：<a href="https://v3.cn.vuejs.org/guide/installation.html#vite">https://v3.cn.vuejs.org/guide/installation.html#vite</a><br>vite官网：<a href="https://vitejs.cn/">https://vitejs.cn</a></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## 创建工程</span><br><span class="hljs-comment">## npm init vite-app vue3_test_vite</span><br>npm init vite-app &lt;project-name&gt;<br><br><span class="hljs-comment">## 进入工程目录</span><br><span class="hljs-comment">## cd vue3_test_vite</span><br><span class="hljs-built_in">cd</span> &lt;project-name&gt;<br><br><span class="hljs-comment">## 安装依赖</span><br>npm install<br><span class="hljs-comment">## 运行</span><br>npm run dev<br></code></pre></td></tr></table></figure><p>页面效果:<br><img src="/assets/2023-06-05-15-43-16.png"></p><h2 id="分析工程结构"><a href="#分析工程结构" class="headerlink" title="分析工程结构"></a>分析工程结构</h2><p>这里主要分析的工程是由npm创建的工程, 而不是vite创建出来的工程</p><p>main.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 引入的不再是Vue构造函数了, 引入的是一个名为createApp的工厂函数</span><br><span class="hljs-keyword">import</span> &#123; createApp &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./App.vue&#x27;</span><br><br><span class="hljs-comment">// 创建应用实例对象--app(类似于之前Vue2中的vm, 但app比vm更&quot;轻&quot;)</span><br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)<br><span class="hljs-comment">// 挂载</span><br>app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">&#x27;#app&#x27;</span>)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;app&#x27;</span>, app);<br><br><span class="hljs-comment">// 一个定时器, 一秒之后就卸载app, 页面也就不展示了</span><br><span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    app.<span class="hljs-title function_">unmount</span>(<span class="hljs-string">&#x27;#app&#x27;</span>)<br>&#125;, <span class="hljs-number">1000</span>)<br><br><br><span class="hljs-comment">/* const vm = new Vue(&#123;</span><br><span class="hljs-comment">    render: h =&gt; h(App)</span><br><span class="hljs-comment">&#125;)</span><br><span class="hljs-comment">vm.$mount(&#x27;#app&#x27;) */</span><br><br></code></pre></td></tr></table></figure><p>App.vue</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;img alt=&quot;Vue logo&quot; src=&quot;./assets/logo.png&quot;&gt;<br>  &lt;HelloWorld msg=&quot;Welcome to Your Vue.js App&quot;/&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import HelloWorld from &#x27;./components/HelloWorld.vue&#x27;<br><br>export default &#123;<br>  name: &#x27;App&#x27;,<br>  components: &#123;<br>    HelloWorld<br>  &#125;<br>&#125;<br>&lt;/script&gt;<br><br>&lt;style&gt;<br>#app &#123;<br>  font-family: Avenir, Helvetica, Arial, sans-serif;<br>  -webkit-font-smoothing: antialiased;<br>  -moz-osx-font-smoothing: grayscale;<br>  text-align: center;<br>  color: #2c3e50;<br>  margin-top: 60px;<br>&#125;<br>&lt;/style&gt;<br><br></code></pre></td></tr></table></figure><p>其余的项目结构跟vue2的工程类似</p><h2 id="安装开发者工具"><a href="#安装开发者工具" class="headerlink" title="安装开发者工具"></a>安装开发者工具</h2><p>建议不要同时开启两个vue.js devtools开发工具, 控制台会提示开启一个, 虽然说两个工具都会亮, 这很神奇<br><img src="/assets/2023-06-05-16-22-06.png"></p><blockquote><p>Chrome 网上商店安装地址 <a href="https://chrome.google.com/webstore/detail/vuejs-devtools/nhdogjmejiglipccpnnnanhbledajbpd/related?hl=zh-CN">https://chrome.google.com/webstore/detail/vuejs-devtools/nhdogjmejiglipccpnnnanhbledajbpd/related?hl=zh-CN</a></p></blockquote><h2 id="初识setup"><a href="#初识setup" class="headerlink" title="初识setup"></a>初识setup</h2><p>setup的简单使用<br>return 可以返回一个对象</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;h1&gt;一个人的信息: &lt;/h1&gt;<br>  &lt;h2&gt;姓名: &#123;&#123;name&#125;&#125;&lt;/h2&gt;<br>  &lt;h2&gt;年龄: &#123;&#123;age&#125;&#125;&lt;/h2&gt;<br>  &lt;button @click=&quot;sayHello&quot;&gt;说话&lt;/button&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br><br>export default &#123;<br>  name: &#x27;App&#x27;,<br>  // 此处只是测试一个setup, 暂时不考虑响应式的问题<br>  setup() &#123;<br>    // 数据<br>    let name = &#x27;张三&#x27;<br>    let age = 18<br><br>    // 方法<br>    function sayHello() &#123;<br>      alert(`我叫$&#123;name&#125;, 我$&#123;age&#125;岁了, 你好啊! `)<br>    &#125;<br><br>    return &#123;<br>      name, <br>      age, <br>      sayHello<br>    &#125;<br><br>  &#125;<br>&#125;<br>&lt;/script&gt;<br><br></code></pre></td></tr></table></figure><p>页面效果<br><img src="/assets/2023-06-05-16-50-59.png"></p><p>return 也可以返回一个函数</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;h1&gt;一个人的信息: &lt;/h1&gt;<br>  &lt;h2&gt;姓名: &#123;&#123;name&#125;&#125;&lt;/h2&gt;<br>  &lt;h2&gt;年龄: &#123;&#123;age&#125;&#125;&lt;/h2&gt;<br>  &lt;button @click=&quot;sayHello&quot;&gt;说话&lt;/button&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import &#123;h&#125; from &quot;vue&quot;;<br>export default &#123;<br>  name: &#x27;App&#x27;,<br>  // 此处只是测试一个setup, 暂时不考虑响应式的问题<br>  setup() &#123;<br>    // 数据<br>    let name = &#x27;张三&#x27;<br>    let age = 18<br><br>    // 方法<br>    function sayHello() &#123;<br>      alert(`我叫$&#123;name&#125;, 我$&#123;age&#125;岁了, 你好啊! `)<br>    &#125;<br><br>    // 返回一个对象常用<br>    /* return &#123;<br>      name, <br>      age, <br>      sayHello<br>    &#125; */<br><br>    // 返回一个函数(渲染函数)<br>    return () =&gt; h(&#x27;h1&#x27;, &#x27;尚硅谷&#x27;)<br><br>  &#125;<br>&#125;<br>&lt;/script&gt;<br><br></code></pre></td></tr></table></figure><p>页面效果<br><img src="/assets/2023-06-05-16-56-40.png"></p><p>在vue3中同样的可以使用data, method</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;h1&gt;一个人的信息: &lt;/h1&gt;<br>  &lt;h2&gt;姓名: &#123;&#123;name&#125;&#125;&lt;/h2&gt;<br>  &lt;h2&gt;年龄: &#123;&#123;age&#125;&#125;&lt;/h2&gt;<br>  &lt;h2&gt;性别: &#123;&#123;sex&#125;&#125;&lt;/h2&gt;<br>  &lt;button @click=&quot;sayHello&quot;&gt;说话(Vue3所配置的——sayHello)&lt;/button&gt;<br>  &lt;br&gt;<br>  &lt;br&gt;<br>  &lt;button @click=&quot;sayWelcome&quot;&gt;说话(Vue2所配置的——sayWelcome)&lt;/button&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>// import &#123;h&#125; from &quot;vue&quot;;<br>export default &#123;<br>  name: &#x27;App&#x27;,<br>  data() &#123;<br>    return &#123;<br>      sex: &#x27;男&#x27;,<br>    &#125;<br>  &#125;,<br>  methods: &#123;<br>    sayWelcome() &#123;<br>      alert(&#x27;欢迎来到尚硅谷学习&#x27;)<br>    &#125;<br>  &#125;,<br>  // 此处只是测试一个setup, 暂时不考虑响应式的问题<br>  setup() &#123;<br>    // 数据<br>    let name = &#x27;张三&#x27;<br>    let age = 18<br><br>    // 方法<br>    function sayHello() &#123;<br>      alert(`我叫$&#123;name&#125;, 我$&#123;age&#125;岁了, 你好啊! `)<br>    &#125;<br><br>    // 返回一个对象常用<br>    return &#123;<br>      name, <br>      age, <br>      sayHello<br>    &#125;<br><br>    // 返回一个函数(渲染函数)<br>    // return () =&gt; h(&#x27;h1&#x27;, &#x27;尚硅谷&#x27;)<br><br>  &#125;<br>&#125;<br>&lt;/script&gt;<br><br></code></pre></td></tr></table></figure><p>页面效果<br><img src="/assets/2023-06-05-17-15-13.png"></p><p>甚至可以在vue的方法中调用vue3的setup的属性和方法</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;h1&gt;一个人的信息: &lt;/h1&gt;<br>  &lt;h2&gt;姓名: &#123;&#123;name&#125;&#125;&lt;/h2&gt;<br>  &lt;h2&gt;年龄: &#123;&#123;age&#125;&#125;&lt;/h2&gt;<br>  &lt;h2&gt;性别: &#123;&#123;sex&#125;&#125;&lt;/h2&gt;<br>  &lt;button @click=&quot;sayHello&quot;&gt;说话(Vue3所配置的——sayHello)&lt;/button&gt;<br>  &lt;br&gt;<br>  &lt;br&gt;<br>  &lt;button @click=&quot;sayWelcome&quot;&gt;说话(Vue2所配置的——sayWelcome)&lt;/button&gt;<br>  &lt;br&gt;<br>  &lt;br&gt;<br>  &lt;button @click=&quot;test1&quot;&gt;测试一下在Vue2的配置中去读取Vue3中的数据、方法&lt;/button&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>// import &#123;h&#125; from &quot;vue&quot;;<br>export default &#123;<br>  name: &#x27;App&#x27;,<br>  data() &#123;<br>    return &#123;<br>      sex: &#x27;男&#x27;,<br>    &#125;<br>  &#125;,<br>  methods: &#123;<br>    sayWelcome() &#123;<br>      alert(&#x27;欢迎来到尚硅谷学习&#x27;)<br>    &#125;,<br>    test1() &#123;<br>      console.log(this.sex);<br>      console.log(this.name);<br>      console.log(this.age);<br>      this.sayHello()<br>    &#125;<br>  &#125;,<br>  // 此处只是测试一个setup, 暂时不考虑响应式的问题<br>  setup() &#123;<br>    // 数据<br>    let name = &#x27;张三&#x27;<br>    let age = 18<br><br>    // 方法<br>    function sayHello() &#123;<br>      alert(`我叫$&#123;name&#125;, 我$&#123;age&#125;岁了, 你好啊! `)<br>    &#125;<br><br>    // 返回一个对象常用<br>    return &#123;<br>      name, <br>      age, <br>      sayHello<br>    &#125;<br><br>    // 返回一个函数(渲染函数)<br>    // return () =&gt; h(&#x27;h1&#x27;, &#x27;尚硅谷&#x27;)<br><br>  &#125;<br>&#125;<br>&lt;/script&gt;<br><br></code></pre></td></tr></table></figure><p>页面效果<br><img src="/assets/2023-06-05-17-17-30.png"></p><p>但是在Vue3中不能调用Vue2的属性和方法</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;h1&gt;一个人的信息: &lt;/h1&gt;<br>  &lt;h2&gt;姓名: &#123;&#123;name&#125;&#125;&lt;/h2&gt;<br>  &lt;h2&gt;年龄: &#123;&#123;age&#125;&#125;&lt;/h2&gt;<br>  &lt;h2&gt;性别: &#123;&#123;sex&#125;&#125;&lt;/h2&gt;<br>  &lt;button @click=&quot;sayHello&quot;&gt;说话(Vue3所配置的——sayHello)&lt;/button&gt;<br>  &lt;br&gt;<br>  &lt;br&gt;<br>  &lt;button @click=&quot;sayWelcome&quot;&gt;说话(Vue2所配置的——sayWelcome)&lt;/button&gt;<br>  &lt;br&gt;<br>  &lt;br&gt;<br>  &lt;button @click=&quot;test1&quot;&gt;测试一下在Vue2的配置中去读取Vue3中的数据、方法&lt;/button&gt;<br>  &lt;br&gt;<br>  &lt;br&gt;<br>  &lt;button @click=&quot;test2&quot;&gt;测试一下在Vue3的setup配置中去读取Vue2中的数据、方法&lt;/button&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>// import &#123;h&#125; from &quot;vue&quot;;<br>export default &#123;<br>  name: &#x27;App&#x27;,<br>  data() &#123;<br>    return &#123;<br>      sex: &#x27;男&#x27;,<br>    &#125;<br>  &#125;,<br>  methods: &#123;<br>    sayWelcome() &#123;<br>      alert(&#x27;欢迎来到尚硅谷学习&#x27;)<br>    &#125;,<br>    test1() &#123;<br>      console.log(this.sex);<br>      console.log(this.name);<br>      console.log(this.age);<br>      this.sayHello()<br>    &#125;<br>  &#125;,<br>  // 此处只是测试一个setup, 暂时不考虑响应式的问题<br>  setup() &#123;<br>    // 数据<br>    let name = &#x27;张三&#x27;<br>    let age = 18<br><br>    // 方法<br>    function sayHello() &#123;<br>      alert(`我叫$&#123;name&#125;, 我$&#123;age&#125;岁了, 你好啊! `)<br>    &#125;<br><br>    function test2() &#123;<br>      console.log(name);<br>      console.log(age);<br>      console.log(sayHello);<br>      console.log(this.sex);<br>      console.log(this.sayWelcome);<br>    &#125;<br><br>    // 返回一个对象常用<br>    return &#123;<br>      name, <br>      age, <br>      sayHello,<br>      test2<br>    &#125;<br><br>    // 返回一个函数(渲染函数)<br>    // return () =&gt; h(&#x27;h1&#x27;, &#x27;尚硅谷&#x27;)<br><br>  &#125;<br>&#125;<br>&lt;/script&gt;<br><br></code></pre></td></tr></table></figure><p>页面效果<br><img src="/assets/2023-06-05-17-27-14.png"></p><blockquote><p>总结: Vue2的配置和Vue3的配置不要混用</p></blockquote><p>当Vue3和Vue2中都存在同一个属性时, 会优先使用Vue3的属性</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;h1&gt;一个人的信息: &lt;/h1&gt;<br>  &lt;h2&gt;姓名: &#123;&#123;name&#125;&#125;&lt;/h2&gt;<br>  &lt;h2&gt;年龄: &#123;&#123;age&#125;&#125;&lt;/h2&gt;<br>  &lt;h2&gt;性别: &#123;&#123;sex&#125;&#125;&lt;/h2&gt;<br>  &lt;h2&gt;a: &#123;&#123;a&#125;&#125;&lt;/h2&gt;<br>  &lt;button @click=&quot;sayHello&quot;&gt;说话(Vue3所配置的——sayHello)&lt;/button&gt;<br>  &lt;br&gt;<br>  &lt;br&gt;<br>  &lt;button @click=&quot;sayWelcome&quot;&gt;说话(Vue2所配置的——sayWelcome)&lt;/button&gt;<br>  &lt;br&gt;<br>  &lt;br&gt;<br>  &lt;button @click=&quot;test1&quot;&gt;测试一下在Vue2的配置中去读取Vue3中的数据、方法&lt;/button&gt;<br>  &lt;br&gt;<br>  &lt;br&gt;<br>  &lt;button @click=&quot;test2&quot;&gt;测试一下在Vue3的setup配置中去读取Vue2中的数据、方法&lt;/button&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>// import &#123;h&#125; from &quot;vue&quot;;<br>export default &#123;<br>  name: &#x27;App&#x27;,<br>  data() &#123;<br>    return &#123;<br>      sex: &#x27;男&#x27;,<br>      a: 100<br>    &#125;<br>  &#125;,<br>  methods: &#123;<br>    sayWelcome() &#123;<br>      alert(&#x27;欢迎来到尚硅谷学习&#x27;)<br>    &#125;,<br>    test1() &#123;<br>      console.log(this.sex);<br>      console.log(this.name);<br>      console.log(this.age);<br>      this.sayHello()<br>    &#125;<br>  &#125;,<br>  // 此处只是测试一个setup, 暂时不考虑响应式的问题<br>  setup() &#123;<br>    // 数据<br>    let name = &#x27;张三&#x27;<br>    let age = 18<br>    let a = 200<br><br>    // 方法<br>    function sayHello() &#123;<br>      alert(`我叫$&#123;name&#125;, 我$&#123;age&#125;岁了, 你好啊! `)<br>    &#125;<br><br>    function test2() &#123;<br>      console.log(name);<br>      console.log(age);<br>      console.log(sayHello);<br>      console.log(this.sex);<br>      console.log(this.sayWelcome);<br>    &#125;<br><br>    // 返回一个对象常用<br>    return &#123;<br>      name, <br>      age, <br>      sayHello,<br>      test2,<br>      a<br>    &#125;<br><br>    // 返回一个函数(渲染函数)<br>    // return () =&gt; h(&#x27;h1&#x27;, &#x27;尚硅谷&#x27;)<br><br>  &#125;<br>&#125;<br>&lt;/script&gt;<br><br></code></pre></td></tr></table></figure><p><img src="/assets/2023-06-05-17-29-30.png"></p><p>setup不能是一个async函数</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vue">async setup() &#123;...&#125;<br></code></pre></td></tr></table></figure><ol><li>理解：Vue3.0中一个新的配置项，值为一个函数。</li><li>setup是所有<strong style="color:#DD5145">Composition API（组合API）</strong><i style="color:gray;font-weight:bold">“ 表演的舞台 ”</i>。</li><li>组件中所用到的：数据、方法等等，均要配置在setup中。</li><li>setup函数的两种返回值：<ol><li>若返回一个对象，则对象中的属性、方法, 在模板中均可以直接使用。（重点关注！）</li><li><span style="color:#aad">若返回一个渲染函数：则可以自定义渲染内容。（了解）</span></li></ol></li><li>注意点：<ol><li>尽量不要与Vue2.x配置混用<ul><li>Vue2.x配置（data、methos、computed…）中<strong style="color:#DD5145">可以访问到</strong>setup中的属性、方法。</li><li>但在setup中<strong style="color:#DD5145">不能访问到</strong>Vue2.x配置（data、methos、computed…）。</li><li>如果有重名, setup优先。</li></ul></li><li>setup不能是一个async函数，因为返回值不再是return的对象, 而是promise, 模板看不到return对象中的属性。（后期也可以返回一个Promise实例，但需要Suspense和异步组件的配合）</li></ol></li></ol><h2 id=""><a href="#" class="headerlink" title=""></a></h2>]]></content>
    
    
    <categories>
      
      <category>前端</category>
      
    </categories>
    
    
    <tags>
      
      <tag>前端</tag>
      
      <tag>Vue</tag>
      
      <tag>Vue3</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>四级</title>
    <link href="/English/%E5%9B%9B%E7%BA%A7/"/>
    <url>/English/%E5%9B%9B%E7%BA%A7/</url>
    
    <content type="html"><![CDATA[<h2 id="题型"><a href="#题型" class="headerlink" title="题型"></a>题型</h2><p>四级主要考试的题型</p><ul><li>写作</li><li>听力理解<ul><li>短篇新闻</li><li>长对话</li><li>听力篇章</li></ul></li><li>阅读理解<ul><li>词汇理解</li><li>长篇阅读</li><li>仔细阅读</li></ul></li><li>翻译<ul><li>汉译英</li></ul></li></ul><p>翻译中常考 “起源于” “追溯于” “象征着” </p><p>固定结构<br>has + 动词的过去分词 + 介词from</p>]]></content>
    
    
    <categories>
      
      <category>English</category>
      
    </categories>
    
    
    <tags>
      
      <tag>English</tag>
      
      <tag>四级</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Flask快速入门</title>
    <link href="/python/Flask%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"/>
    <url>/python/Flask%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<blockquote><p>很明显Flask是一个<a href="https://zhuanlan.zhihu.com/p/359280800">轻量级框架</a></p></blockquote><h2 id="安装Flask"><a href="#安装Flask" class="headerlink" title="安装Flask"></a>安装Flask</h2><p>进入D:\Python\Scripts输入</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pip install Flask<br></code></pre></td></tr></table></figure><h2 id="第一个Hello-World"><a href="#第一个Hello-World" class="headerlink" title="第一个Hello World"></a>第一个Hello World</h2><p>创建一个demo0.py文件</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask<br><br>app = Flask(__name__)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello_world</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Hello World&#x27;</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run()<br></code></pre></td></tr></table></figure><p>运行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">py demo0.py<br></code></pre></td></tr></table></figure><p>好的, 第一个Hello World就成功运行起来了<br><img src="/assets/2023-05-23-21-38-43.png"></p><p>接下来手搓一个后台管理系统吧^_^</p><p><img src="/assets/2023-05-23-21-41-05.png"></p><p>run()函数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">app.run(host, port, debug, options)<br></code></pre></td></tr></table></figure><p>host就是主机名, 默认127.0.0.1, 设置成0.0.0.0可以暴露给其他主机访问<br>port就是端口<br>debug表示调试模式, 在程序运行时, 如果修改了代码, 调试模式就类似于热部署了<br>options表示要转发给底层的服务器</p><h2 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h2><p>@app.route后面就是访问的路径<br><a href="http://127.0.0.1:666/hello">http://127.0.0.1:666/hello</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/hello&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello_world</span>():<br>   <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;hello world&#x27;</span><br></code></pre></td></tr></table></figure><p>也可以改写成如下的形式</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-comment"># @app.route(&#x27;/hello&#x27;)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello_world</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Hello World!!&#x27;</span><br><br>app.add_url_rule(<span class="hljs-string">&#x27;/hello&#x27;</span>, <span class="hljs-string">&#x27;hello&#x27;</span>, hello_world)<br></code></pre></td></tr></table></figure><p>app.add_url_rule用来绑定URL和函数, 中间的参数是路由的端点, 唯一标识路由的字符串</p><h2 id="接收参数"><a href="#接收参数" class="headerlink" title="接收参数"></a>接收参数</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/hello/&lt;name&gt;&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello_world</span>(<span class="hljs-params">name</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Hello%s World!!&#x27;</span> % name<br></code></pre></td></tr></table></figure><p>路由上定义一个参数<name>, 然后函数上接收这个参数, 最后将这个参数返回给页面</p><p><img src="/assets/2023-05-23-22-03-33.png"></p><p>一般来说默认是字符串类型的, 当然也可以指定类型<br>比如int, float</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/num/&lt;int:num&gt;&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_num</span>(<span class="hljs-params">num</span>):<br>    <span class="hljs-comment"># return num # 不要写成这样, 会被当成字符串的</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;%d&#x27;</span> % num<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/float/&lt;float:num&gt;&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_float</span>(<span class="hljs-params">num</span>):<br>    <span class="hljs-comment"># return num # 不要写成这样, 会被当成字符串的</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;%f&#x27;</span> % num<br></code></pre></td></tr></table></figure><p><a href="http://127.0.0.1:666/num/1">http://127.0.0.1:666/num/1</a><br><a href="http://127.0.0.1:666/float/1.0">http://127.0.0.1:666/float/1.0</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/flask&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello_flask</span>():<br>   <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Hello Flask&#x27;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/python/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello_python</span>():<br>   <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Hello Python&#x27;</span><br></code></pre></td></tr></table></figure><p><a href="http://127.0.0.1:666/flask">http://127.0.0.1:666/flask</a> 可以正常请求<br><a href="http://127.0.0.1:666/flask/">http://127.0.0.1:666/flask/</a> 不可以正常请求</p><p><a href="http://127.0.0.1:666/python">http://127.0.0.1:666/python</a>  正常请求<br><a href="http://127.0.0.1:666/python/">http://127.0.0.1:666/python/</a> 正常请求</p><h2 id="url-for"><a href="#url-for" class="headerlink" title="url_for"></a>url_for</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-comment"># Flask URL构建</span><br><br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, redirect, url_for<br>app = Flask(__name__)<br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/admin&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello_admin</span>():<br>   <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Hello Admin&#x27;</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/guest/&lt;guest&gt;&#x27;</span></span>)</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello_guest</span>(<span class="hljs-params">guest</span>):<br>   <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Hello %s as Guest&#x27;</span> % guest<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/user/&lt;name&gt;&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello_user</span>(<span class="hljs-params">name</span>):<br>   <span class="hljs-keyword">if</span> name ==<span class="hljs-string">&#x27;admin&#x27;</span>:<br>      <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;hello_admin&#x27;</span>))<br>   <span class="hljs-keyword">else</span>:<br>      <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;hello_guest&#x27;</span>, guest = name))<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>   app.run(debug = <span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure><p>url_for是用来生成url的<br>url_for(‘hello_admin’)               &#x3D;&gt; &#x2F;user&#x2F;admin  &#x3D;&gt; &#x2F;admin<br>url_for(‘hello_guest’, guest &#x3D; name) &#x3D;&gt; &#x2F;user&#x2F;123    &#x3D;&gt; &#x2F;guest&#x2F;123</p><p>当请求的是   <a href="http://127.0.0.1:5000/user/123">http://127.0.0.1:5000/user/123</a> &#x3D;&gt; <a href="http://127.0.0.1:5000/guest/12">http://127.0.0.1:5000/guest/12</a><br>返回的Hello 12 as Guest</p><p>请求<a href="http://127.0.0.1:5000/admin">http://127.0.0.1:5000/admin</a> 返回Hello Admin</p><h2 id="HTTP方法"><a href="#HTTP方法" class="headerlink" title="HTTP方法"></a>HTTP方法</h2><p>创建一个html页面</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span> = <span class="hljs-string">&quot;http://localhost:5000/login&quot;</span> <span class="hljs-attr">method</span> = <span class="hljs-string">&quot;post&quot;</span>&gt;</span><br>         <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Enter Name:<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>         <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span> = <span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span> = <span class="hljs-string">&quot;nm&quot;</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>         <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span> = <span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span> = <span class="hljs-string">&quot;submit&quot;</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br>   <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>然后http-server运行这个页面</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">http-server -o .\login.html<br></code></pre></td></tr></table></figure><p>然后编写如下Python代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, redirect, url_for, request, render_template<br><br>app = Flask(__name__)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;login.html&quot;</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/success/&lt;name&gt;&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">success</span>(<span class="hljs-params">name</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;welcome %s&#x27;</span> % name<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/login&#x27;</span>,methods = [<span class="hljs-string">&#x27;POST&#x27;</span>, <span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>():<br>   <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br>      <span class="hljs-built_in">print</span>(<span class="hljs-number">1</span>)<br>      user = request.form[<span class="hljs-string">&#x27;nm&#x27;</span>]<br>      <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;success&#x27;</span>,name = user))<br>   <span class="hljs-keyword">else</span>:<br>      <span class="hljs-built_in">print</span>(<span class="hljs-number">2</span>)<br>      user = request.args.get(<span class="hljs-string">&#x27;nm&#x27;</span>)<br>      <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;success&#x27;</span>,name = user))<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run()<br></code></pre></td></tr></table></figure><p>当method为post时, 控制台输出的是1<br>当method为get时, 控制台输出的是2</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">&lt;form action <span class="hljs-operator">=</span> <span class="hljs-string">&quot;http://localhost:5000/login&quot;</span> method <span class="hljs-operator">=</span> <span class="hljs-string">&quot;post&quot;</span>&gt;<br></code></pre></td></tr></table></figure><h2 id="模板引擎"><a href="#模板引擎" class="headerlink" title="模板引擎"></a>模板引擎</h2><blockquote><p>Flask 是使用 Jinja2 这个模板引擎来渲染模板</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>我的模板html内容<br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, render_template<br><br>app = Flask(__name__)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;hello.html&#x27;</span>)<br></code></pre></td></tr></table></figure><p>当有人请求 <a href="http://localhost:5000/">http://localhost:5000/</a> 将会呈现<code>我的模板html内容</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs Python">```<br><br>```html<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
      <tag>Flask</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>油猴脚本整理无用课程</title>
    <link href="/%E6%B2%B9%E7%8C%B4/%E6%B2%B9%E7%8C%B4%E8%84%9A%E6%9C%AC%E6%95%B4%E7%90%86%E6%97%A0%E7%94%A8%E8%AF%BE%E7%A8%8B/"/>
    <url>/%E6%B2%B9%E7%8C%B4/%E6%B2%B9%E7%8C%B4%E8%84%9A%E6%9C%AC%E6%95%B4%E7%90%86%E6%97%A0%E7%94%A8%E8%AF%BE%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<p>也不知道学校的网站硬是更新了个啥, 把所有的课程都挤到了一块<br><img src="/assets/2023-05-23-16-12-35.png"></p><p>原先还有一个归档选项可以隐藏以前上完的课, 现在全堆到一起了</p><p><img src="/assets/2023-05-23-16-14-16.png"></p><p>没办法只好写了油猴脚本来隐藏一下以前上完的课了, 脚本如下</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// ==UserScript==</span><br><span class="hljs-comment">// @name         整理无用课程</span><br><span class="hljs-comment">// @namespace    http://tampermonkey.net/</span><br><span class="hljs-comment">// @version      0.1</span><br><span class="hljs-comment">// @description  try to take over the world!</span><br><span class="hljs-comment">// @author       肉豆蔻吖</span><br><span class="hljs-comment">// @match        https://www.eduplus.net/workbench/index/school*</span><br><span class="hljs-comment">// @icon         https://www.google.com/s2/favicons?sz=64&amp;domain=eduplus.net</span><br><span class="hljs-comment">// @grant        none</span><br><span class="hljs-comment">// @run-at       document-start</span><br><span class="hljs-comment">// ==/UserScript==</span><br><br>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-string">&#x27;use strict&#x27;</span>;<br><br>    <span class="hljs-comment">// 创建一个 MutationObserver 实例</span><br>    <span class="hljs-keyword">const</span> observer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MutationObserver</span>(<span class="hljs-function">(<span class="hljs-params">mutationsList, observer</span>) =&gt;</span> &#123;<br>        <span class="hljs-keyword">let</span> title = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">&#x27;.course-title&#x27;</span>);<br><br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;title&#x27;</span>, title);<br><br>        <span class="hljs-keyword">let</span> keywordsToKeep = [<span class="hljs-string">&#x27;数据可视化&#x27;</span>, <span class="hljs-string">&#x27;Hadoop&#x27;</span>, <span class="hljs-string">&#x27;Spark&#x27;</span>, <span class="hljs-string">&#x27;Hive&#x27;</span>, <span class="hljs-string">&#x27;Python&#x27;</span>, <span class="hljs-string">&#x27;javaweb框架技术&#x27;</span>];<br><br>        <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(title).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> &#123;<br>            <span class="hljs-keyword">let</span> shouldKeep = <span class="hljs-literal">false</span>;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> keyword <span class="hljs-keyword">of</span> keywordsToKeep) &#123;<br>                <span class="hljs-keyword">if</span> (item.<span class="hljs-property">innerText</span>.<span class="hljs-title function_">includes</span>(keyword)) &#123;<br>                    shouldKeep = <span class="hljs-literal">true</span>;<br>                    <span class="hljs-keyword">break</span>;<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (!shouldKeep) &#123;<br>                item.<span class="hljs-property">parentNode</span>.<span class="hljs-property">parentNode</span>.<span class="hljs-property">parentNode</span>.<span class="hljs-property">parentNode</span>.<span class="hljs-title function_">remove</span>();<br>            &#125;<br>        &#125;);<br>    &#125;);<br><br>    <span class="hljs-comment">// 配置 MutationObserver 监听的选项</span><br>    <span class="hljs-keyword">const</span> observerOptions = &#123;<br>        <span class="hljs-attr">childList</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 监听子节点的变化</span><br>        <span class="hljs-attr">subtree</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 监听整个子树的变化</span><br>        <span class="hljs-attr">attributes</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 不监听属性的变化</span><br>        <span class="hljs-attr">characterData</span>: <span class="hljs-literal">false</span> <span class="hljs-comment">// 不监听文本内容的变化</span><br>    &#125;;<br><br>    <span class="hljs-comment">// 启动 MutationObserver 监听</span><br>    observer.<span class="hljs-title function_">observe</span>(<span class="hljs-variable language_">document</span>, observerOptions);<br><br>    <span class="hljs-comment">// Your code here...</span><br>&#125;)();<br></code></pre></td></tr></table></figure><p>隐藏之后的效果<br><img src="/assets/2023-05-23-16-17-08.png"></p><p>参考: </p><ul><li><a href="https://bbs.tampermonkey.net.cn/forum.php?mod=viewthread&tid=835">https://bbs.tampermonkey.net.cn/forum.php?mod=viewthread&amp;tid=835</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>油猴</category>
      
    </categories>
    
    
    <tags>
      
      <tag>油猴</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>油猴脚本去掉版权声明</title>
    <link href="/%E6%B2%B9%E7%8C%B4/%E6%B2%B9%E7%8C%B4%E8%84%9A%E6%9C%AC%E5%8E%BB%E6%8E%89%E7%89%88%E6%9D%83%E5%A3%B0%E6%98%8E/"/>
    <url>/%E6%B2%B9%E7%8C%B4/%E6%B2%B9%E7%8C%B4%E8%84%9A%E6%9C%AC%E5%8E%BB%E6%8E%89%E7%89%88%E6%9D%83%E5%A3%B0%E6%98%8E/</url>
    
    <content type="html"><![CDATA[<p>上CSDN复制文本往往会出现一堆没用的版权声明</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml">————————————————<br>版权声明：本文为CSDN博主「XXX」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。<br>原文链接：https://blog.csdn.net/XXX<br></code></pre></td></tr></table></figure><p>emmm, 感觉一点都不友好</p><p>从网上参考了一下, 原理貌似是阻止事件冒泡到父元素, 父元素不会触发oncopy事件</p><p>编写了如下油猴脚本</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// ==UserScript==</span><br><span class="hljs-comment">// @name         去掉CSDN复制文本的版权声明</span><br><span class="hljs-comment">// @namespace    http://tampermonkey.net/</span><br><span class="hljs-comment">// @version      0.1</span><br><span class="hljs-comment">// @description  try to take over the world!</span><br><span class="hljs-comment">// @author       You</span><br><span class="hljs-comment">// @match        https://blog.csdn.net/*</span><br><span class="hljs-comment">// @icon         https://www.google.com/s2/favicons?sz=64&amp;domain=csdn.net</span><br><span class="hljs-comment">// @grant        none</span><br><span class="hljs-comment">// ==/UserScript==</span><br><br>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-string">&#x27;use strict&#x27;</span>;<br><br>    [...<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">&#x27;*&#x27;</span>)].<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">item</span>=&gt;</span>&#123;<br>        item.<span class="hljs-property">oncopy</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) &#123;<br>            e.<span class="hljs-title function_">stopPropagation</span>();<br>        &#125;<br>    &#125;);<br><br>    <span class="hljs-comment">// Your code here...</span><br>&#125;)();<br></code></pre></td></tr></table></figure><p>参考: </p><ul><li>去掉小尾巴 <a href="https://blog.csdn.net/qianshanyou9054/article/details/97657757">https://blog.csdn.net/qianshanyou9054/article/details/97657757</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>油猴</category>
      
    </categories>
    
    
    <tags>
      
      <tag>油猴</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringSecurity</title>
    <link href="/Java/SpringSecurity/"/>
    <url>/Java/SpringSecurity/</url>
    
    <content type="html"><![CDATA[<h2 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h2><p>搭建一个SpringBoot工程</p><p>创建一个maven项目<br>导入依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.5.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><p>创建启动类<code>SecurityApplication.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecurityApplication</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(SecurityApplication.class, args);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>编写controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloController</span> &#123;<br>    <span class="hljs-meta">@GetMapping(&quot;/&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">hello</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello&quot;</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>运行项目<br><img src="/assets/2023-05-21-21-38-29.png"></p><h2 id="引入SpringSecurity"><a href="#引入SpringSecurity" class="headerlink" title="引入SpringSecurity"></a>引入SpringSecurity</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>重启项目, 再次请求<code>http://localhost:8080/</code></p><p><img src="/assets/2023-05-21-21-45-32.png"></p><p>可以发现此时需要先登录, 才能进行刚刚的正常访问</p><p>账号是: <code>user</code><br>密码将会在idea控制台中打印出来 <code>dd7079e7-0fb9-4735-850b-ccc3aaceea32</code></p><p><img src="/assets/2023-05-21-21-46-25.png"></p><p>输入完账号密码之后又可以正常访问了</p><p><img src="/assets/2023-05-21-21-47-14.png"></p><p>发送请求<code>http://localhost:8080/logout</code>退出登录</p><h2 id="常见的三个过滤器"><a href="#常见的三个过滤器" class="headerlink" title="常见的三个过滤器"></a>常见的三个过滤器</h2><p>FilterSecurityInterceptor: 是一个方法级的权限过滤器, 基本位于过滤链的最底部。</p><p>ExceptionTranslationFilter: 是个异常过滤器，用来处理在认证授权过程中抛出的异常</p><p>UsernamePasswordAuthenticationFilter: 对&#x2F;login 的 POST 请求做拦截，校验表单中用户名，密码。</p><h2 id="设置登录系统的账号密码"><a href="#设置登录系统的账号密码" class="headerlink" title="设置登录系统的账号密码"></a>设置登录系统的账号密码</h2><h4 id="通过配置文件方式配置"><a href="#通过配置文件方式配置" class="headerlink" title="通过配置文件方式配置"></a>通过配置文件方式配置</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/spring-security?characterEncoding=utf-8&amp;serverTimezone=UTC</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>  <span class="hljs-attr">security:</span><br>    <span class="hljs-attr">user:</span><br>      <span class="hljs-attr">name:</span> <span class="hljs-string">xiamu</span><br>      <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span><br><br><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">666</span><br><br></code></pre></td></tr></table></figure><h4 id="通过config配置类实现"><a href="#通过config配置类实现" class="headerlink" title="通过config配置类实现"></a>通过config配置类实现</h4><p>运行这个配置类的前提是一定要保证boot版本是2.2.1.RELEASE</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2.1.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WebSecurityConfigurerAdapter</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">BCryptPasswordEncoder</span> <span class="hljs-variable">passwordEncoder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BCryptPasswordEncoder</span>();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">password</span> <span class="hljs-operator">=</span> passwordEncoder.encode(<span class="hljs-string">&quot;123456&quot;</span>);<br>        auth.inMemoryAuthentication().withUser(<span class="hljs-string">&quot;xiamu&quot;</span>).password(password).roles(<span class="hljs-string">&quot;admin&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    PasswordEncoder <span class="hljs-title function_">password</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BCryptPasswordEncoder</span>();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>当出现了这个异常<br>java.lang.IllegalArgumentException: There is no PasswordEncoder mapped for the id “null”</p><p>不能正常登录时, 记得将如下Bean创建出来</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@Bean</span><br>PasswordEncoder <span class="hljs-title function_">password</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BCryptPasswordEncoder</span>();<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="自定义编写实现类实现接口"><a href="#自定义编写实现类实现接口" class="headerlink" title="自定义编写实现类实现接口"></a>自定义编写实现类实现接口</h4><p>注释掉SecurityConfig类上的@Configuration</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-comment">// @Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WebSecurityConfigurerAdapter</span> &#123;...&#125;<br></code></pre></td></tr></table></figure><p>然后编写如下代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecurityConfig1</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WebSecurityConfigurerAdapter</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserDetailsService userDetailsService;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        auth.userDetailsService(userDetailsService).passwordEncoder(password());<br>    &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    PasswordEncoder <span class="hljs-title function_">password</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BCryptPasswordEncoder</span>();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>接着创建一个MyUserDetailsService来实现UserDetailsService接口<br>注意User引入的包是: org.springframework.security.core.userdetails.User</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyUserDetailsService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserDetailsService</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> UserDetails <span class="hljs-title function_">loadUserByUsername</span><span class="hljs-params">(String s)</span> <span class="hljs-keyword">throws</span> UsernameNotFoundException &#123;<br>        List&lt;GrantedAuthority&gt; auths = AuthorityUtils.commaSeparatedStringToAuthorityList(<span class="hljs-string">&quot;role&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;xiamu&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BCryptPasswordEncoder</span>().encode(<span class="hljs-string">&quot;123456&quot;</span>), auths);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>然后运行boot</p><h2 id="查询数据库完成用户认证"><a href="#查询数据库完成用户认证" class="headerlink" title="查询数据库完成用户认证"></a>查询数据库完成用户认证</h2><p>第一步, 引入依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.4.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>第二步, 然后创建数据库<br><img src="/assets/2023-05-30-20-25-30.png"></p><p>第三步, 配置yml</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/spring-security?characterEncoding=utf-8&amp;serverTimezone=UTC</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br><span class="hljs-comment">#  security:</span><br><span class="hljs-comment">#    user:</span><br><span class="hljs-comment">#      name: xiamu</span><br><span class="hljs-comment">#      password: 123456</span><br><br><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">666</span><br><br></code></pre></td></tr></table></figure><p>第四步, 创建实体类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <span class="hljs-keyword">private</span> Integer id;<br>    <span class="hljs-keyword">private</span> String username;<br>    <span class="hljs-keyword">private</span> String password;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>第五步, 创建mapper接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@Repository</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;User&gt; &#123;<br>&#125;<br></code></pre></td></tr></table></figure><p>第六步, 修改service, 查询数据库</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyUserDetailsService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserDetailsService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserMapper userMapper;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> UserDetails <span class="hljs-title function_">loadUserByUsername</span><span class="hljs-params">(String username)</span> <span class="hljs-keyword">throws</span> UsernameNotFoundException &#123;<br>        <span class="hljs-comment">// 调用usersMapper方法, 根据用户名查询数据库</span><br>        QueryWrapper&lt;Users&gt; queryWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;&gt;();<br>        queryWrapper.eq(<span class="hljs-string">&quot;username&quot;</span>, username);<br>        <span class="hljs-type">Users</span> <span class="hljs-variable">users</span> <span class="hljs-operator">=</span> userMapper.selectOne(queryWrapper);<br>        <span class="hljs-comment">// 判断, 数据库没有用户名, 认证失败</span><br>        <span class="hljs-keyword">if</span> (users == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UsernameNotFoundException</span>(<span class="hljs-string">&quot;用户名不存在! &quot;</span>);<br>        &#125;<br><br>        List&lt;GrantedAuthority&gt; auths =<br>                AuthorityUtils.commaSeparatedStringToAuthorityList(<span class="hljs-string">&quot;role&quot;</span>);<br>        <span class="hljs-comment">// 从查询数据库返回users对象 得到用户名和密码, 返回</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;xiamu&quot;</span>,<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">BCryptPasswordEncoder</span>().encode(users.getPassword()), auths);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>第七步, 启动类开启包扫描</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@MapperScan(&quot;icu.xiamu.mapper&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecurityApplication</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(SecurityApplication.class, args);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>测试代码:<br><img src="/assets/2023-05-30-20-50-23.png"></p><p><img src="/assets/2023-05-30-20-50-01.png"></p><h2 id="自定义设置登录页面"><a href="#自定义设置登录页面" class="headerlink" title="自定义设置登录页面"></a>自定义设置登录页面</h2><p>自定义设置登录页面, 不需要认证就可以访问</p><p>在SecurityConfig1中重写configure</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs Java"><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    http.formLogin()    <span class="hljs-comment">// 自定义自己编写的登录页面</span><br>            .loginPage(<span class="hljs-string">&quot;/login.html&quot;</span>)    <span class="hljs-comment">//登录页面设置</span><br>            .loginProcessingUrl(<span class="hljs-string">&quot;/user/login&quot;</span>)   <span class="hljs-comment">// 登录访问路径 , 也就是表单action需要提交的路径</span><br>            .defaultSuccessUrl(<span class="hljs-string">&quot;/index&quot;</span>)<br>            .permitAll()<br>            .and()<br>            .authorizeRequests()<br>            .antMatchers(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-string">&quot;/hello&quot;</span>, <span class="hljs-string">&quot;/user/login&quot;</span>).permitAll()     <span class="hljs-comment">// 设置哪些路径可以直接访问, 不需要认证</span><br>            .anyRequest()<br>            .authenticated()<br>            .and()<br>            .csrf()<br>            .disable();     <span class="hljs-comment">// 关闭csrf防护</span><br>&#125;<br><br></code></pre></td></tr></table></figure><p>resource&#x2F;static&#x2F;login.html创建一个登录页面</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span> <span class="hljs-attr">xmlns:th</span>=<span class="hljs-string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/user/login&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span><br>    用户名: <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> /&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>    密码: <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> /&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;login&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>在HelloController中多添加一个mapping</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloController</span> &#123;<br>    <span class="hljs-meta">@GetMapping(&quot;/hello&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">hello</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/index&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">index</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;index&quot;</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>测试代码: </p><p>这个路径可以直接请求, 不需要认证<br><a href="http://localhost:666/hello">http://localhost:666/hello</a></p><p><img src="/assets/2023-05-30-21-32-42.png"></p><p>请求 <a href="http://localhost:666/index">http://localhost:666/index</a> 的时候需要进行认证<br><img src="/assets/2023-05-30-21-36-35.png"></p><p>认证完成之后就会显示出来index<br><img src="/assets/2023-05-30-21-37-15.png"></p><h2 id="用户授权"><a href="#用户授权" class="headerlink" title="用户授权"></a>用户授权</h2><h4 id="hasAuthority"><a href="#hasAuthority" class="headerlink" title="hasAuthority"></a>hasAuthority</h4><p>修改configure方法</p><p>添加</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs Java">.antMatchers(<span class="hljs-string">&quot;/index&quot;</span>)      <span class="hljs-comment">// 当前登录用户, 只有具有admin才可以访问这个路径</span><br>.hasAuthority(<span class="hljs-string">&quot;admin&quot;</span>)<br></code></pre></td></tr></table></figure><p>并且让MyUserDetailsService中的commaSeparatedStringToAuthorityList设置成admin</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyUserDetailsService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserDetailsService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserMapper userMapper;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> UserDetails <span class="hljs-title function_">loadUserByUsername</span><span class="hljs-params">(String username)</span> <span class="hljs-keyword">throws</span> UsernameNotFoundException &#123;<br>        <span class="hljs-comment">// 调用usersMapper方法, 根据用户名查询数据库</span><br>        QueryWrapper&lt;Users&gt; queryWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;&gt;();<br>        queryWrapper.eq(<span class="hljs-string">&quot;username&quot;</span>, username);<br>        <span class="hljs-type">Users</span> <span class="hljs-variable">users</span> <span class="hljs-operator">=</span> userMapper.selectOne(queryWrapper);<br>        <span class="hljs-comment">// 判断, 数据库没有用户名, 认证失败</span><br>        <span class="hljs-keyword">if</span> (users == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UsernameNotFoundException</span>(<span class="hljs-string">&quot;用户名不存在! &quot;</span>);<br>        &#125;<br><br>        List&lt;GrantedAuthority&gt; auths =<br>                AuthorityUtils.commaSeparatedStringToAuthorityList(<span class="hljs-string">&quot;admin&quot;</span>);<br>        <span class="hljs-comment">// 从查询数据库返回users对象 得到用户名和密码, 返回</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;xiamu&quot;</span>,<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">BCryptPasswordEncoder</span>().encode(users.getPassword()), auths);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>此时只有一个权限是admin, 也就是说admin权限可以进行登录</p><p>代码测试:<br>访问<a href="http://localhost:666/index">http://localhost:666/index</a><br><img src="/assets/2023-05-30-22-05-41.gif"></p><h4 id="hasAnyAuthority"><a href="#hasAnyAuthority" class="headerlink" title="hasAnyAuthority"></a>hasAnyAuthority</h4><p>如果想实现多个权限, 需要在SecurityConfig1中使用hasAnyAuthority</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs Java">.antMatchers(<span class="hljs-string">&quot;/index&quot;</span>)<br>.hasAnyAuthority(<span class="hljs-string">&quot;admin, manager&quot;</span>)<br></code></pre></td></tr></table></figure><p>此时登录的权限是admin或者是manager都可以进行登录</p><p>完整SecurityConfig1的代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecurityConfig1</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WebSecurityConfigurerAdapter</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserDetailsService userDetailsService;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        auth.userDetailsService(userDetailsService).passwordEncoder(password());<br>    &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    PasswordEncoder <span class="hljs-title function_">password</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BCryptPasswordEncoder</span>();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        http.formLogin()    <span class="hljs-comment">// 自定义自己编写的登录页面</span><br>                .loginPage(<span class="hljs-string">&quot;/login.html&quot;</span>)    <span class="hljs-comment">//登录页面设置</span><br>                .loginProcessingUrl(<span class="hljs-string">&quot;/user/login&quot;</span>)   <span class="hljs-comment">// 登录访问路径</span><br>                .defaultSuccessUrl(<span class="hljs-string">&quot;/index&quot;</span>)<br>                .permitAll()<br>                .and()<br>                .authorizeRequests()<br>                .antMatchers(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-string">&quot;/hello&quot;</span>, <span class="hljs-string">&quot;/user/login&quot;</span>)<br>                .permitAll()     <span class="hljs-comment">// 设置哪些路径可以直接访问, 不需要认证</span><br>                <span class="hljs-comment">// .antMatchers(&quot;/index&quot;)      // 当前登录用户, 只有具有admin才可以访问这个路径</span><br>                <span class="hljs-comment">// .hasAuthority(&quot;admin&quot;)</span><br>                .antMatchers(<span class="hljs-string">&quot;/index&quot;</span>)<br>                .hasAnyAuthority(<span class="hljs-string">&quot;admin, manager&quot;</span>)<br>                .anyRequest()<br>                .authenticated()<br>                .and()<br>                .csrf()<br>                .disable();     <span class="hljs-comment">// 关闭csrf防护</span><br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="hasRole"><a href="#hasRole" class="headerlink" title="hasRole"></a>hasRole</h4><p>指定角色, 是当前角色的用户才能进行登录</p><blockquote><p>需要注意的是commaSeparatedStringToAuthorityList中填写的角色应该是要添加前缀的<code>ROLE_</code></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs Java">List&lt;GrantedAuthority&gt; auths =<br>        AuthorityUtils.commaSeparatedStringToAuthorityList(<span class="hljs-string">&quot;manager,ROLE_sale&quot;</span>);<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    http.formLogin()    <span class="hljs-comment">// 自定义自己编写的登录页面</span><br>            .loginPage(<span class="hljs-string">&quot;/login.html&quot;</span>)    <span class="hljs-comment">//登录页面设置</span><br>            .loginProcessingUrl(<span class="hljs-string">&quot;/user/login&quot;</span>)   <span class="hljs-comment">// 登录访问路径</span><br>            .defaultSuccessUrl(<span class="hljs-string">&quot;/index&quot;</span>)<br>            .permitAll()<br>            .and()<br>            .authorizeRequests()<br>            .antMatchers(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-string">&quot;/hello&quot;</span>, <span class="hljs-string">&quot;/user/login&quot;</span>)<br>            .permitAll()     <span class="hljs-comment">// 设置哪些路径可以直接访问, 不需要认证</span><br>            <span class="hljs-comment">// .antMatchers(&quot;/index&quot;)      // 当前登录用户, 只有具有admin才可以访问这个路径</span><br>            <span class="hljs-comment">// .hasAuthority(&quot;admin&quot;)</span><br>            <span class="hljs-comment">// .antMatchers(&quot;/index&quot;)</span><br>            <span class="hljs-comment">// .hasAnyAuthority(&quot;admin, manager&quot;)</span><br>            .antMatchers(<span class="hljs-string">&quot;/index&quot;</span>)<br>            .hasRole(<span class="hljs-string">&quot;sale&quot;</span>)<br>            .anyRequest()<br>            .authenticated()<br>            .and()<br>            .csrf()<br>            .disable();     <span class="hljs-comment">// 关闭csrf防护</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="hasAnyRole"><a href="#hasAnyRole" class="headerlink" title="hasAnyRole"></a>hasAnyRole</h4><p>这个跟hasAnyAuthority差不多, 可以设置多个角色, 跟hasRole一样, 需要添加前缀<code>ROLE_</code></p><h2 id="自定义403页面"><a href="#自定义403页面" class="headerlink" title="自定义403页面"></a>自定义403页面</h2><p>当登录的用户没有访问权限或者是角色时, 尝试登录会出现默认的403页面, 这个页面是可以通过配置类进行替换的<br><img src="/assets/2023-06-01-11-28-10.png"></p><p>在static中创建一个自定义的403页面 <code>unauth.html</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span> <span class="hljs-attr">xmlns:th</span>=<span class="hljs-string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>非法用户, 不能访问<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-comment">// 配置没有权限访问跳转自定义页面</span><br>http.exceptionHandling().accessDeniedPage(<span class="hljs-string">&quot;/unauth.html&quot;</span>);<br></code></pre></td></tr></table></figure><p>完整SecurityConfig1的代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecurityConfig1</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WebSecurityConfigurerAdapter</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserDetailsService userDetailsService;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        auth.userDetailsService(userDetailsService).passwordEncoder(password());<br>    &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    PasswordEncoder <span class="hljs-title function_">password</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BCryptPasswordEncoder</span>();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">// 配置没有权限访问跳转自定义页面</span><br>        http.exceptionHandling().accessDeniedPage(<span class="hljs-string">&quot;/unauth.html&quot;</span>);<br>        http.formLogin()    <span class="hljs-comment">// 自定义自己编写的登录页面</span><br>                .loginPage(<span class="hljs-string">&quot;/login.html&quot;</span>)    <span class="hljs-comment">//登录页面设置</span><br>                .loginProcessingUrl(<span class="hljs-string">&quot;/user/login&quot;</span>)   <span class="hljs-comment">// 登录访问路径</span><br>                .defaultSuccessUrl(<span class="hljs-string">&quot;/index&quot;</span>)<br>                .permitAll()<br>                .and()<br>                .authorizeRequests()<br>                .antMatchers(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-string">&quot;/hello&quot;</span>, <span class="hljs-string">&quot;/user/login&quot;</span>)<br>                .permitAll()     <span class="hljs-comment">// 设置哪些路径可以直接访问, 不需要认证</span><br>                <span class="hljs-comment">// .antMatchers(&quot;/index&quot;)      // 当前登录用户, 只有具有admin才可以访问这个路径</span><br>                <span class="hljs-comment">// .hasAuthority(&quot;admin&quot;)</span><br>                <span class="hljs-comment">// .antMatchers(&quot;/index&quot;)</span><br>                <span class="hljs-comment">// .hasAnyAuthority(&quot;admin, manager&quot;)</span><br>                .antMatchers(<span class="hljs-string">&quot;/index&quot;</span>)<br>                .hasAnyRole(<span class="hljs-string">&quot;sale&quot;</span>)<br>                .anyRequest()<br>                .authenticated()<br>                .and()<br>                .csrf()<br>                .disable();     <span class="hljs-comment">// 关闭csrf防护</span><br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>此时再次非法请求一下, 显示的是我们自己创建的html页面<br><img src="/assets/2023-06-01-11-35-20.png"></p><h2 id="注解方式的用户授权"><a href="#注解方式的用户授权" class="headerlink" title="注解方式的用户授权"></a>注解方式的用户授权</h2><h4 id="Secured"><a href="#Secured" class="headerlink" title="@Secured"></a>@Secured</h4><p>用户具有某个角色, 可以方法这个方法</p><p>启动类或者配置类开启注解</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@EnableGlobalMethodSecurity(securedEnabled = true)</span><br></code></pre></td></tr></table></figure><p>在controller的方法上面使用注解, 设置角色</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@GetMapping(&quot;/update&quot;)</span><br><span class="hljs-meta">@Secured(&#123;&quot;ROLE_sale&quot;, &quot;ROLE_manager&quot;&#125;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">update</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;update&quot;</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>MyUserDetailsService设置用户角色</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyUserDetailsService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserDetailsService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserMapper userMapper;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> UserDetails <span class="hljs-title function_">loadUserByUsername</span><span class="hljs-params">(String username)</span> <span class="hljs-keyword">throws</span> UsernameNotFoundException &#123;<br>        <span class="hljs-comment">// 调用usersMapper方法, 根据用户名查询数据库</span><br>        QueryWrapper&lt;Users&gt; queryWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;&gt;();<br>        queryWrapper.eq(<span class="hljs-string">&quot;username&quot;</span>, username);<br>        <span class="hljs-type">Users</span> <span class="hljs-variable">users</span> <span class="hljs-operator">=</span> userMapper.selectOne(queryWrapper);<br>        <span class="hljs-comment">// 判断, 数据库没有用户名, 认证失败</span><br>        <span class="hljs-keyword">if</span> (users == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UsernameNotFoundException</span>(<span class="hljs-string">&quot;用户名不存在! &quot;</span>);<br>        &#125;<br><br>        List&lt;GrantedAuthority&gt; auths =<br>                AuthorityUtils.commaSeparatedStringToAuthorityList(<span class="hljs-string">&quot;admin,ROLE_sale&quot;</span>);<br>        <span class="hljs-comment">// 从查询数据库返回users对象 得到用户名和密码, 返回</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;xiamu&quot;</span>,<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">BCryptPasswordEncoder</span>().encode(users.getPassword()), auths);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="PreAuthorize"><a href="#PreAuthorize" class="headerlink" title="PreAuthorize"></a>PreAuthorize</h4><p>启动类开启注解</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@EnableGlobalMethodSecurity(securedEnabled = true, prePostEnabled = true)</span><br></code></pre></td></tr></table></figure><p>在controller的方法上面使用注解</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@GetMapping(&quot;/update&quot;)</span><br><span class="hljs-comment">// @Secured(&#123;&quot;ROLE_sale&quot;, &quot;ROLE_manager&quot;&#125;)</span><br><span class="hljs-meta">@PreAuthorize(&quot;hasAnyAuthority(&#x27;admin&#x27;)&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">update</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;update&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>同样的MyUserDetailsService设置用户角色</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs Java">List&lt;GrantedAuthority&gt; auths =<br>        AuthorityUtils.commaSeparatedStringToAuthorityList(<span class="hljs-string">&quot;admin,ROLE_sale&quot;</span>);<br></code></pre></td></tr></table></figure><p>PreAuthorize可以设置hasAnyAuthority, hasAuthority, hasAnyRole, hasRole</p><h4 id="PostAuthorize"><a href="#PostAuthorize" class="headerlink" title="@PostAuthorize"></a>@PostAuthorize</h4><p>@PostAuthorize注解, 是在方法执行完成之后再进行校验权限, 适合校验带有返回值</p><p>启动类开启注解</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@EnableGlobalMethodSecurity(securedEnabled = true, prePostEnabled = true)</span><br></code></pre></td></tr></table></figure><p>controller设置@PostAuthorize注解</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@GetMapping(&quot;/update&quot;)</span><br><span class="hljs-comment">// @Secured(&#123;&quot;ROLE_sale&quot;, &quot;ROLE_manager&quot;&#125;)</span><br><span class="hljs-comment">// @PreAuthorize(&quot;hasAnyAuthority(&#x27;admin&#x27;)&quot;)</span><br><span class="hljs-meta">@PostAuthorize(&quot;hasAnyAuthority(&#x27;admin123&#x27;)&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">update</span><span class="hljs-params">()</span> &#123;<br>    System.out.println(<span class="hljs-string">&quot;update...&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;update&quot;</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>当请求了 <a href="http://localhost:666/update">http://localhost:666/update</a> 成功登录之后, 控制将会打印这段, 但是页面将会进行权限验证<br><img src="/assets/2023-06-01-20-21-25.png"></p><p><img src="/assets/2023-06-01-20-23-46.png"></p><h4 id="PostFilter"><a href="#PostFilter" class="headerlink" title="@PostFilter"></a>@PostFilter</h4><p>@PostFilter: 权限验证之后对数据进行过滤, 留下用户名是admin1的数据<br>表达式种的filterObject引用的是方法返回值List中的某一个元素</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;getAll&quot;)</span><br><span class="hljs-meta">@PreAuthorize(&quot;hasRole(&#x27;ROLE_管理员&#x27;)&quot;)</span><br><span class="hljs-meta">@PostFilter(&quot;filterObject.username == &#x27;admin1&#x27;&quot;)</span><br><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-keyword">public</span> List&lt;Users&gt; <span class="hljs-title function_">getAllUser</span><span class="hljs-params">()</span>&#123;<br>    ArrayList&lt;Users&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    list.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Users</span>(<span class="hljs-number">11</span>,<span class="hljs-string">&quot;admin1&quot;</span>,<span class="hljs-string">&quot;6666&quot;</span>));<br>    list.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Users</span>(<span class="hljs-number">21</span>,<span class="hljs-string">&quot;admin2&quot;</span>,<span class="hljs-string">&quot;888&quot;</span>));<br>    <span class="hljs-keyword">return</span> list;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>页面最后只展示了admin1的信息</p><p><img src="/assets/2023-06-01-20-31-02.png"></p><h4 id="PreFilter"><a href="#PreFilter" class="headerlink" title="@PreFilter"></a>@PreFilter</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@RequestMapping(&quot;getTestPreFilter&quot;)</span><br><span class="hljs-meta">@PreAuthorize(&quot;hasRole(&#x27;ROLE_管理员&#x27;)&quot;)</span><br><span class="hljs-meta">@PreFilter(value = &quot;filterObject.id%2==0&quot;)</span><br><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-keyword">public</span> List&lt;Users&gt; <span class="hljs-title function_">getTestPreFilter</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> List&lt;Users&gt;</span><br><span class="hljs-params">                                               list)</span>&#123;<br>    list.forEach(t-&gt; &#123;<br>        System.out.println(t.getId()+<span class="hljs-string">&quot;\t&quot;</span>+t.getUsername());<br>    &#125;);<br>    <span class="hljs-keyword">return</span> list;<br>&#125;<br></code></pre></td></tr></table></figure><p>使用postman发送post请求 <code>http://localhost:666/user/login?username=xiamu&amp;password=123456</code></p><p><img src="/assets/2023-06-01-20-45-42.png"></p><p>之后将会返回一个cookie</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">JSESSIONID</span><br><span class="hljs-keyword"></span><span class="hljs-number">57</span>DD13E<span class="hljs-symbol">39F</span><span class="hljs-symbol">7B</span>DAD3C871CCB4DA0664EF<br></code></pre></td></tr></table></figure><p>然后再给postman发送请求<br><a href="http://localhost:666/getTestPreFilter">http://localhost:666/getTestPreFilter</a></p><p>在header中携带cookie<br><img src="/assets/2023-06-01-21-01-23.png"></p><p>Body中发送JSON数据</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;username&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;admin1&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;password&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;666&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;username&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;admin2&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;password&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;888&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;3&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;username&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;admin3&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;password&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;999&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;4&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;username&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;admin4&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;password&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;999&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">]</span><br></code></pre></td></tr></table></figure><p><img src="/assets/2023-06-01-21-01-00.png"></p><p>可以发现最后返回的id都是偶数的, 这说明了传入的数据在后台进行了过滤, 过滤掉了id为奇数的</p><h2 id="用户注销"><a href="#用户注销" class="headerlink" title="用户注销"></a>用户注销</h2><p>在configure中添加</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-comment">// 退出</span><br>    http.logout().logoutUrl(<span class="hljs-string">&quot;/logout&quot;</span>).logoutSuccessUrl(<span class="hljs-string">&quot;/hello&quot;</span>).permitAll();<br><br>    <span class="hljs-comment">// 配置没有权限访问跳转自定义页面</span><br>    http.exceptionHandling().accessDeniedPage(<span class="hljs-string">&quot;/unauth.html&quot;</span>);<br>    http.formLogin()    <span class="hljs-comment">// 自定义自己编写的登录页面</span><br>            .loginPage(<span class="hljs-string">&quot;/login.html&quot;</span>)    <span class="hljs-comment">//登录页面设置</span><br>            .loginProcessingUrl(<span class="hljs-string">&quot;/user/login&quot;</span>)   <span class="hljs-comment">// 登录访问路径</span><br>            .defaultSuccessUrl(<span class="hljs-string">&quot;/success.html&quot;</span>)<br>            .permitAll()<br>        ...<br>    &#125;<br></code></pre></td></tr></table></figure><p><img src="/assets/2023-06-01-21-31-39.png"></p><p>接着浏览器请求 <a href="http://localhost:666/success.html">http://localhost:666/success.html</a> 浏览器跳转到&#x3D;&gt; <a href="http://localhost:666/login.html">http://localhost:666/login.html</a> </p><p><img src="/assets/2023-06-01-21-39-16.png"></p><p>输入账号密码登录, 登录成功之后跳转到success.html页面<br><img src="/assets/2023-06-01-21-40-19.png"></p><p>此时是可以直接访问 <a href="http://localhost:666/index">http://localhost:666/index</a><br><img src="/assets/2023-06-01-21-42-14.png"></p><p>然后点击退出, 此时退出之后再次请求, <a href="http://localhost:666/index">http://localhost:666/index</a> 就是需要输入账号密码的<br><img src="/assets/2023-06-01-21-44-49.png"></p><h2 id="自动登录-功能实现"><a href="#自动登录-功能实现" class="headerlink" title="自动登录(功能实现)"></a>自动登录(功能实现)</h2><p>修改login.html, 添加一个input复选框, 记得<code>name</code>需要是<code>remember-me</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span> <span class="hljs-attr">xmlns:th</span>=<span class="hljs-string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/user/login&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span><br>    用户名: <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> /&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>    密码: <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> /&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;remember-me&quot;</span> /&gt;</span> 自动登录 <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;login&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>然后创建表 </p><blockquote><p>来源于<code>JdbcTokenRepositoryImpl类</code>中, 在idea double shift可以搜到</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> persistent_logins <br>(<br>    username <span class="hljs-type">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>, <br>    series <span class="hljs-type">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">primary</span> key, <br>    token <span class="hljs-type">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>, <br>    last_used <span class="hljs-type">timestamp</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span><br>)<br></code></pre></td></tr></table></figure><p>然后修改SecurityConfig1</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-comment">// 注入数据源</span><br><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> DataSource dataSource;<br><br><span class="hljs-comment">// 给jdbcTokenRepository设置数据源</span><br><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> PersistentTokenRepository <span class="hljs-title function_">persistentTokenRepository</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">JdbcTokenRepositoryImpl</span> <span class="hljs-variable">jdbcTokenRepository</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JdbcTokenRepositoryImpl</span>();<br>    jdbcTokenRepository.setDataSource(dataSource);<br>    <span class="hljs-keyword">return</span> jdbcTokenRepository;<br>&#125;<br><br><span class="hljs-comment">// 配置token的过期时间</span><br>                .and().rememberMe().tokenRepository(persistentTokenRepository())<br>            .tokenValiditySeconds(<span class="hljs-number">60</span>)       <span class="hljs-comment">// 设置有效时长, 单位秒</span><br></code></pre></td></tr></table></figure><p>完整SecurityConfig1代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecurityConfig1</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WebSecurityConfigurerAdapter</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserDetailsService userDetailsService;<br><br>    <span class="hljs-comment">// 注入数据源</span><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> DataSource dataSource;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> PersistentTokenRepository <span class="hljs-title function_">persistentTokenRepository</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">JdbcTokenRepositoryImpl</span> <span class="hljs-variable">jdbcTokenRepository</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JdbcTokenRepositoryImpl</span>();<br>        jdbcTokenRepository.setDataSource(dataSource);<br>        <span class="hljs-keyword">return</span> jdbcTokenRepository;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        auth.userDetailsService(userDetailsService).passwordEncoder(password());<br>    &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    PasswordEncoder <span class="hljs-title function_">password</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BCryptPasswordEncoder</span>();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">// 退出</span><br>        http.logout().logoutUrl(<span class="hljs-string">&quot;/logout&quot;</span>).logoutSuccessUrl(<span class="hljs-string">&quot;/hello&quot;</span>).permitAll();<br><br>        <span class="hljs-comment">// 配置没有权限访问跳转自定义页面</span><br>        http.exceptionHandling().accessDeniedPage(<span class="hljs-string">&quot;/unauth.html&quot;</span>);<br>        http.formLogin()    <span class="hljs-comment">// 自定义自己编写的登录页面</span><br>                .loginPage(<span class="hljs-string">&quot;/login.html&quot;</span>)    <span class="hljs-comment">//登录页面设置</span><br>                .loginProcessingUrl(<span class="hljs-string">&quot;/user/login&quot;</span>)   <span class="hljs-comment">// 登录访问路径</span><br>                .defaultSuccessUrl(<span class="hljs-string">&quot;/success.html&quot;</span>)<br>                .permitAll()<br>                .and()<br>                .authorizeRequests()<br>                .antMatchers(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-string">&quot;/hello&quot;</span>, <span class="hljs-string">&quot;/user/login&quot;</span>)<br>                .permitAll()     <span class="hljs-comment">// 设置哪些路径可以直接访问, 不需要认证</span><br>                <span class="hljs-comment">// .antMatchers(&quot;/index&quot;)      // 当前登录用户, 只有具有admin才可以访问这个路径</span><br>                <span class="hljs-comment">// .hasAuthority(&quot;admin&quot;)</span><br>                <span class="hljs-comment">// .antMatchers(&quot;/index&quot;)</span><br>                <span class="hljs-comment">// .hasAnyAuthority(&quot;admin, manager&quot;)</span><br>                .antMatchers(<span class="hljs-string">&quot;/index&quot;</span>)<br>                .hasAnyRole(<span class="hljs-string">&quot;sale&quot;</span>)<br>                .anyRequest()<br>                .authenticated()<br>                .and().rememberMe().tokenRepository(persistentTokenRepository())<br>                .tokenValiditySeconds(<span class="hljs-number">60</span>)       <span class="hljs-comment">// 设置有效时长, 单位秒</span><br>                .and()<br>                .csrf()<br>                .disable();     <span class="hljs-comment">// 关闭csrf防护</span><br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>代码测试步骤, 请求 <a href="http://localhost:666/index">http://localhost:666/index</a> , 登录的时候需要勾选<code>记住我</code></p><p><img src="/assets/2023-06-02-20-11-08.png"><br>之后关闭浏览器, 再次请求 <a href="http://localhost:666/index">http://localhost:666/index</a> 这个时候就不需要输入密码就能直接看见index页面</p><p><img src="/assets/2023-06-02-20-10-16.png"></p><p>同样的数据库将会保存对应的token到表中, 一旦超过了60秒, 就需要再次输入一次密码<br><img src="/assets/2023-06-02-20-12-09.png"></p><h2 id="CSRF功能"><a href="#CSRF功能" class="headerlink" title="CSRF功能"></a>CSRF功能</h2><p>请求 <a href="http://localhost:8080/update_token">http://localhost:8080/update_token</a><br><img src="/assets/2023-06-02-21-10-13.png"></p><p>开启csrf防护</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">//关闭csrf保护功能</span><br><span class="language-xml">//http.csrf().disable();</span><br><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-comment">&lt;!-- 然后页面中, 在提交form, 传入一个token --&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">th:name</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;_csrf.parameterName&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span> <span class="hljs-attr">th:value</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;_csrf.token&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>/&gt;</span></span><br><span class="language-xml"></span><br></code></pre></td></tr></table></figure><p>项目demo:<br><img src="/assets/2023-06-02-21-11-06.png"></p><p>pom.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-devtools<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.security<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-security-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!--对Thymeleaf添加Spring Security标签支持--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.thymeleaf.extras<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>thymeleaf-extras-springsecurity5<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.14<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></td></tr></table></figure><p>application.yml</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://127.0.0.1:3306/spring-security?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=true&amp;serverTimezone=UTC</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>    <span class="hljs-comment">#    druid数据库连接池配置</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span><br>    <span class="hljs-attr">druid:</span><br>      <span class="hljs-attr">initial-size:</span> <span class="hljs-number">20</span>  <span class="hljs-comment"># 初始化数据连接池大小</span><br>      <span class="hljs-attr">min-idle:</span> <span class="hljs-number">10</span>     <span class="hljs-comment"># 空闲数</span><br>      <span class="hljs-attr">max-active:</span> <span class="hljs-number">100</span>   <span class="hljs-comment">#最大连接数</span><br><br><br><span class="hljs-comment">#配置Mybatis的相关属性</span><br><span class="hljs-attr">mybatis:</span><br>  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">classpath:mapper/*.xml</span> <span class="hljs-comment">#指定mapper XML文件的位置</span><br>  <span class="hljs-comment">#type-aliases-package: com.zsc.mybatis_demo.domain  #指定实体类的别名的映射路径</span><br><br>  <span class="hljs-attr">configuration:</span><br>    <span class="hljs-attr">log-impl:</span> <span class="hljs-string">org.apache.ibatis.logging.stdout.StdOutImpl</span>  <span class="hljs-comment">#打印输出SQL语句</span><br>    <span class="hljs-attr">map-underscore-to-camel-case:</span> <span class="hljs-literal">true</span>   <span class="hljs-comment"># 启动驼峰式转换</span><br>    <span class="hljs-attr">use-generated-keys:</span> <span class="hljs-literal">true</span>      <span class="hljs-comment">#开启自增组件</span><br><span class="hljs-comment">#de<span class="hljs-doctag">bug:</span> true</span><br><br></code></pre></td></tr></table></figure><p>SecurityConfig.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WebSecurityConfigurerAdapter</span> &#123;<br>    <span class="hljs-meta">@Resource</span><br>    UserDetailsService userDetailsService;<br><br>    <span class="hljs-comment">//实现用户身份认证</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">BCryptPasswordEncoder</span> <span class="hljs-variable">encoder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BCryptPasswordEncoder</span>();<br>        auth.userDetailsService(userDetailsService).passwordEncoder(encoder);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">//配置url的访问权限</span><br>        http.authorizeRequests()<br>                .antMatchers(<span class="hljs-string">&quot;/&quot;</span>).permitAll()<br>                .antMatchers(<span class="hljs-string">&quot;/**update**&quot;</span>).permitAll()<br>                .antMatchers(<span class="hljs-string">&quot;/login/**&quot;</span>).permitAll()<br>                .anyRequest().authenticated();<br><br>        <span class="hljs-comment">//关闭csrf保护功能</span><br>        <span class="hljs-comment">//http.csrf().disable();</span><br><span class="hljs-comment">//       </span><br>        <span class="hljs-comment">//使用自定义的登录窗口</span><br>      http.formLogin()<br>              .loginPage(<span class="hljs-string">&quot;/userLogin&quot;</span>).permitAll()<br>              .usernameParameter(<span class="hljs-string">&quot;username&quot;</span>).passwordParameter(<span class="hljs-string">&quot;password&quot;</span>)<br>              .defaultSuccessUrl(<span class="hljs-string">&quot;/&quot;</span>)<br>              .failureUrl(<span class="hljs-string">&quot;/userLogin?error&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>CSRFController.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CSRFController</span> &#123;<br><br>     <span class="hljs-meta">@GetMapping(&quot;/toupdate&quot;)</span><br>     <span class="hljs-keyword">public</span> String <span class="hljs-title function_">test</span><span class="hljs-params">(Model model)</span>&#123;<br>         <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;csrf/csrfTest&quot;</span>;<br>     &#125;<br><br>    <span class="hljs-meta">@PostMapping(&quot;/update_token&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getToken</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;csrf/csrf_token&quot;</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>LoginController.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginController</span> &#123;<br>    <span class="hljs-meta">@GetMapping(&quot;/userLogin&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">login</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;login/login&quot;</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>UserDetailsServiceImpl.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDetailsServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserDetailsService</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> UserDetails <span class="hljs-title function_">loadUserByUsername</span><span class="hljs-params">(String s)</span> <span class="hljs-keyword">throws</span> UsernameNotFoundException &#123;<br><br>            List&lt;SimpleGrantedAuthority&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>            list.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleGrantedAuthority</span>(<span class="hljs-string">&quot;role&quot;</span>));<br>            <span class="hljs-type">UserDetails</span> <span class="hljs-variable">userDetails</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;lucy&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BCryptPasswordEncoder</span>().encode(<span class="hljs-string">&quot;123&quot;</span>)<br>                    , list);<br>            <span class="hljs-keyword">return</span> userDetails;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>CsrfSecurityApplication.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CsrfSecurityApplication</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(CsrfSecurityApplication.class, args);<br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><p>csrf_token.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.w3.org/1999/xhtml&quot;</span> <span class="hljs-attr">xmlns:th</span>=<span class="hljs-string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>用户修改<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;_csrf.token&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>csrfTest.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.w3.org/1999/xhtml&quot;</span> <span class="hljs-attr">xmlns:th</span>=<span class="hljs-string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>用户修改<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">align</span>=<span class="hljs-string">&quot;center&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">form</span>  <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;update_token&quot;</span>&gt;</span><br><span class="hljs-comment">&lt;!--     --&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">th:name</span>=<span class="hljs-string">&quot;$&#123;_csrf.parameterName&#125;&quot;</span> <span class="hljs-attr">th:value</span>=<span class="hljs-string">&quot;$&#123;_csrf.token&#125;&quot;</span>/&gt;</span><br>        用户名: <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>        密<span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-symbol">&amp;nbsp;</span>码: <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span>&gt;</span>修改<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>login.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.w3.org/1999/xhtml&quot;</span> <span class="hljs-attr">xmlns:th</span>=<span class="hljs-string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;Content-Type&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>用户登录界面<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;text-center&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-signin&quot;</span> <span class="hljs-attr">th:method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">th:action</span>=<span class="hljs-string">&quot;@&#123;/userLogin&#125;&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;h3 mb-3 font-weight-normal&quot;</span>&gt;</span>请登录<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;用户名&quot;</span> <span class="hljs-attr">required</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">autofocus</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;密码&quot;</span> <span class="hljs-attr">required</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;checkbox mb-3&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;rememberme&quot;</span>&gt;</span> 记住我<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-lg btn-primary btn-block&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> &gt;</span>登录<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br><br></code></pre></td></tr></table></figure><h2 id="SpringSecurity整合到微服务项目"><a href="#SpringSecurity整合到微服务项目" class="headerlink" title="SpringSecurity整合到微服务项目"></a>SpringSecurity整合到微服务项目</h2><p><img src="/assets/2023-06-02-21-42-33.png"></p><p><img src="/assets/2023-06-02-21-43-55.png"></p><h4 id="导入sql"><a href="#导入sql" class="headerlink" title="导入sql"></a>导入sql</h4><p>创建数据库<code>acldb</code>, 然后导入如下sql到该数据库中</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># Host: localhost  (Version 5.7.19)<br># Date: 2019-11-18 15:49:15<br># Generator: MySQL-Front 6.1  (Build 1.26)<br><br><br>#<br># Structure for table &quot;acl_permission&quot;<br>#<br><br>CREATE TABLE `acl_permission` (<br>  `id` char(19) NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;编号&#x27;,<br>  `pid` char(19) NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;所属上级&#x27;,<br>  `name` varchar(20) NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;名称&#x27;,<br>  `type` tinyint(3) NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;类型(1:菜单,2:按钮)&#x27;,<br>  `permission_value` varchar(50) DEFAULT NULL COMMENT &#x27;权限值&#x27;,<br>  `path` varchar(100) DEFAULT NULL COMMENT &#x27;访问路径&#x27;,<br>  `component` varchar(100) DEFAULT NULL COMMENT &#x27;组件路径&#x27;,<br>  `icon` varchar(50) DEFAULT NULL COMMENT &#x27;图标&#x27;,<br>  `status` tinyint(4) DEFAULT NULL COMMENT &#x27;状态(0:禁止,1:正常)&#x27;,<br>  `is_deleted` tinyint(1) unsigned NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;逻辑删除 1（true）已删除， 0（false）未删除&#x27;,<br>  `gmt_create` datetime DEFAULT NULL COMMENT &#x27;创建时间&#x27;,<br>  `gmt_modified` datetime DEFAULT NULL COMMENT &#x27;更新时间&#x27;,<br>  PRIMARY KEY (`id`),<br>  KEY `idx_pid` (`pid`)<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT=&#x27;权限&#x27;;<br><br>#<br># Data for table &quot;acl_permission&quot;<br>#<br><br>INSERT INTO `acl_permission` VALUES (&#x27;1&#x27;,&#x27;0&#x27;,&#x27;全部数据&#x27;,0,NULL,NULL,NULL,NULL,NULL,0,&#x27;2019-11-15 17:13:06&#x27;,&#x27;2019-11-15 17:13:06&#x27;),(&#x27;1195268474480156673&#x27;,&#x27;1&#x27;,&#x27;权限管理&#x27;,1,NULL,&#x27;/acl&#x27;,&#x27;Layout&#x27;,NULL,NULL,0,&#x27;2019-11-15 17:13:06&#x27;,&#x27;2019-11-18 13:54:25&#x27;),(&#x27;1195268616021139457&#x27;,&#x27;1195268474480156673&#x27;,&#x27;用户管理&#x27;,1,NULL,&#x27;user/list&#x27;,&#x27;/acl/user/list&#x27;,NULL,NULL,0,&#x27;2019-11-15 17:13:40&#x27;,&#x27;2019-11-18 13:53:12&#x27;),(&#x27;1195268788138598401&#x27;,&#x27;1195268474480156673&#x27;,&#x27;角色管理&#x27;,1,NULL,&#x27;role/list&#x27;,&#x27;/acl/role/list&#x27;,NULL,NULL,0,&#x27;2019-11-15 17:14:21&#x27;,&#x27;2019-11-15 17:14:21&#x27;),(&#x27;1195268893830864898&#x27;,&#x27;1195268474480156673&#x27;,&#x27;菜单管理&#x27;,1,NULL,&#x27;menu/list&#x27;,&#x27;/acl/menu/list&#x27;,NULL,NULL,0,&#x27;2019-11-15 17:14:46&#x27;,&#x27;2019-11-15 17:14:46&#x27;),(&#x27;1195269143060602882&#x27;,&#x27;1195268616021139457&#x27;,&#x27;查看&#x27;,2,&#x27;user.list&#x27;,&#x27;&#x27;,&#x27;&#x27;,NULL,NULL,0,&#x27;2019-11-15 17:15:45&#x27;,&#x27;2019-11-17 21:57:16&#x27;),(&#x27;1195269295926206466&#x27;,&#x27;1195268616021139457&#x27;,&#x27;添加&#x27;,2,&#x27;user.add&#x27;,&#x27;user/add&#x27;,&#x27;/acl/user/form&#x27;,NULL,NULL,0,&#x27;2019-11-15 17:16:22&#x27;,&#x27;2019-11-15 17:16:22&#x27;),(&#x27;1195269473479483394&#x27;,&#x27;1195268616021139457&#x27;,&#x27;修改&#x27;,2,&#x27;user.update&#x27;,&#x27;user/update/:id&#x27;,&#x27;/acl/user/form&#x27;,NULL,NULL,0,&#x27;2019-11-15 17:17:04&#x27;,&#x27;2019-11-15 17:17:04&#x27;),(&#x27;1195269547269873666&#x27;,&#x27;1195268616021139457&#x27;,&#x27;删除&#x27;,2,&#x27;user.remove&#x27;,&#x27;&#x27;,&#x27;&#x27;,NULL,NULL,0,&#x27;2019-11-15 17:17:22&#x27;,&#x27;2019-11-15 17:17:22&#x27;),(&#x27;1195269821262782465&#x27;,&#x27;1195268788138598401&#x27;,&#x27;修改&#x27;,2,&#x27;role.update&#x27;,&#x27;role/update/:id&#x27;,&#x27;/acl/role/form&#x27;,NULL,NULL,0,&#x27;2019-11-15 17:18:27&#x27;,&#x27;2019-11-15 17:19:53&#x27;),(&#x27;1195269903542444034&#x27;,&#x27;1195268788138598401&#x27;,&#x27;查看&#x27;,2,&#x27;role.list&#x27;,&#x27;&#x27;,&#x27;&#x27;,NULL,NULL,0,&#x27;2019-11-15 17:18:47&#x27;,&#x27;2019-11-15 17:18:47&#x27;),(&#x27;1195270037005197313&#x27;,&#x27;1195268788138598401&#x27;,&#x27;添加&#x27;,2,&#x27;role.add&#x27;,&#x27;role/add&#x27;,&#x27;/acl/role/form&#x27;,NULL,NULL,0,&#x27;2019-11-15 17:19:19&#x27;,&#x27;2019-11-18 11:05:42&#x27;),(&#x27;1195270442602782721&#x27;,&#x27;1195268788138598401&#x27;,&#x27;删除&#x27;,2,&#x27;role.remove&#x27;,&#x27;&#x27;,&#x27;&#x27;,NULL,NULL,0,&#x27;2019-11-15 17:20:55&#x27;,&#x27;2019-11-15 17:20:55&#x27;),(&#x27;1195270621548568578&#x27;,&#x27;1195268788138598401&#x27;,&#x27;角色权限&#x27;,2,&#x27;role.acl&#x27;,&#x27;role/distribution/:id&#x27;,&#x27;/acl/role/roleForm&#x27;,NULL,NULL,0,&#x27;2019-11-15 17:21:38&#x27;,&#x27;2019-11-15 17:21:38&#x27;),(&#x27;1195270744097742849&#x27;,&#x27;1195268893830864898&#x27;,&#x27;查看&#x27;,2,&#x27;permission.list&#x27;,&#x27;&#x27;,&#x27;&#x27;,NULL,NULL,0,&#x27;2019-11-15 17:22:07&#x27;,&#x27;2019-11-15 17:22:07&#x27;),(&#x27;1195270810560684034&#x27;,&#x27;1195268893830864898&#x27;,&#x27;添加&#x27;,2,&#x27;permission.add&#x27;,&#x27;&#x27;,&#x27;&#x27;,NULL,NULL,0,&#x27;2019-11-15 17:22:23&#x27;,&#x27;2019-11-15 17:22:23&#x27;),(&#x27;1195270862100291586&#x27;,&#x27;1195268893830864898&#x27;,&#x27;修改&#x27;,2,&#x27;permission.update&#x27;,&#x27;&#x27;,&#x27;&#x27;,NULL,NULL,0,&#x27;2019-11-15 17:22:35&#x27;,&#x27;2019-11-15 17:22:35&#x27;),(&#x27;1195270887933009922&#x27;,&#x27;1195268893830864898&#x27;,&#x27;删除&#x27;,2,&#x27;permission.remove&#x27;,&#x27;&#x27;,&#x27;&#x27;,NULL,NULL,0,&#x27;2019-11-15 17:22:41&#x27;,&#x27;2019-11-15 17:22:41&#x27;),(&#x27;1195349439240048642&#x27;,&#x27;1&#x27;,&#x27;讲师管理&#x27;,1,NULL,&#x27;/edu/teacher&#x27;,&#x27;Layout&#x27;,NULL,NULL,0,&#x27;2019-11-15 22:34:49&#x27;,&#x27;2019-11-15 22:34:49&#x27;),(&#x27;1195349699995734017&#x27;,&#x27;1195349439240048642&#x27;,&#x27;讲师列表&#x27;,1,NULL,&#x27;list&#x27;,&#x27;/edu/teacher/list&#x27;,NULL,NULL,0,&#x27;2019-11-15 22:35:52&#x27;,&#x27;2019-11-15 22:35:52&#x27;),(&#x27;1195349810561781761&#x27;,&#x27;1195349439240048642&#x27;,&#x27;添加讲师&#x27;,1,NULL,&#x27;create&#x27;,&#x27;/edu/teacher/form&#x27;,NULL,NULL,0,&#x27;2019-11-15 22:36:18&#x27;,&#x27;2019-11-15 22:36:18&#x27;),(&#x27;1195349876252971010&#x27;,&#x27;1195349810561781761&#x27;,&#x27;添加&#x27;,2,&#x27;teacher.add&#x27;,&#x27;&#x27;,&#x27;&#x27;,NULL,NULL,0,&#x27;2019-11-15 22:36:34&#x27;,&#x27;2019-11-15 22:36:34&#x27;),(&#x27;1195349979797753857&#x27;,&#x27;1195349699995734017&#x27;,&#x27;查看&#x27;,2,&#x27;teacher.list&#x27;,&#x27;&#x27;,&#x27;&#x27;,NULL,NULL,0,&#x27;2019-11-15 22:36:58&#x27;,&#x27;2019-11-15 22:36:58&#x27;),(&#x27;1195350117270261762&#x27;,&#x27;1195349699995734017&#x27;,&#x27;修改&#x27;,2,&#x27;teacher.update&#x27;,&#x27;edit/:id&#x27;,&#x27;/edu/teacher/form&#x27;,NULL,NULL,0,&#x27;2019-11-15 22:37:31&#x27;,&#x27;2019-11-15 22:37:31&#x27;),(&#x27;1195350188359520258&#x27;,&#x27;1195349699995734017&#x27;,&#x27;删除&#x27;,2,&#x27;teacher.remove&#x27;,&#x27;&#x27;,&#x27;&#x27;,NULL,NULL,0,&#x27;2019-11-15 22:37:48&#x27;,&#x27;2019-11-15 22:37:48&#x27;),(&#x27;1195350299365969922&#x27;,&#x27;1&#x27;,&#x27;课程分类&#x27;,1,NULL,&#x27;/edu/subject&#x27;,&#x27;Layout&#x27;,NULL,NULL,0,&#x27;2019-11-15 22:38:15&#x27;,&#x27;2019-11-15 22:38:15&#x27;),(&#x27;1195350397751758850&#x27;,&#x27;1195350299365969922&#x27;,&#x27;课程分类列表&#x27;,1,NULL,&#x27;list&#x27;,&#x27;/edu/subject/list&#x27;,NULL,NULL,0,&#x27;2019-11-15 22:38:38&#x27;,&#x27;2019-11-15 22:38:38&#x27;),(&#x27;1195350500512206850&#x27;,&#x27;1195350299365969922&#x27;,&#x27;导入课程分类&#x27;,1,NULL,&#x27;import&#x27;,&#x27;/edu/subject/import&#x27;,NULL,NULL,0,&#x27;2019-11-15 22:39:03&#x27;,&#x27;2019-11-15 22:39:03&#x27;),(&#x27;1195350612172967938&#x27;,&#x27;1195350397751758850&#x27;,&#x27;查看&#x27;,2,&#x27;subject.list&#x27;,&#x27;&#x27;,&#x27;&#x27;,NULL,NULL,0,&#x27;2019-11-15 22:39:29&#x27;,&#x27;2019-11-15 22:39:29&#x27;),(&#x27;1195350687590748161&#x27;,&#x27;1195350500512206850&#x27;,&#x27;导入&#x27;,2,&#x27;subject.import&#x27;,&#x27;&#x27;,&#x27;&#x27;,NULL,NULL,0,&#x27;2019-11-15 22:39:47&#x27;,&#x27;2019-11-15 22:39:47&#x27;),(&#x27;1195350831744782337&#x27;,&#x27;1&#x27;,&#x27;课程管理&#x27;,1,NULL,&#x27;/edu/course&#x27;,&#x27;Layout&#x27;,NULL,NULL,0,&#x27;2019-11-15 22:40:21&#x27;,&#x27;2019-11-15 22:40:21&#x27;),(&#x27;1195350919074385921&#x27;,&#x27;1195350831744782337&#x27;,&#x27;课程列表&#x27;,1,NULL,&#x27;list&#x27;,&#x27;/edu/course/list&#x27;,NULL,NULL,0,&#x27;2019-11-15 22:40:42&#x27;,&#x27;2019-11-15 22:40:42&#x27;),(&#x27;1195351020463296513&#x27;,&#x27;1195350831744782337&#x27;,&#x27;发布课程&#x27;,1,NULL,&#x27;info&#x27;,&#x27;/edu/course/info&#x27;,NULL,NULL,0,&#x27;2019-11-15 22:41:06&#x27;,&#x27;2019-11-15 22:41:06&#x27;),(&#x27;1195351159672246274&#x27;,&#x27;1195350919074385921&#x27;,&#x27;完成发布&#x27;,2,&#x27;course.publish&#x27;,&#x27;publish/:id&#x27;,&#x27;/edu/course/publish&#x27;,NULL,NULL,0,&#x27;2019-11-15 22:41:40&#x27;,&#x27;2019-11-15 22:44:01&#x27;),(&#x27;1195351326706208770&#x27;,&#x27;1195350919074385921&#x27;,&#x27;编辑课程&#x27;,2,&#x27;course.update&#x27;,&#x27;info/:id&#x27;,&#x27;/edu/course/info&#x27;,NULL,NULL,0,&#x27;2019-11-15 22:42:19&#x27;,&#x27;2019-11-15 22:42:19&#x27;),(&#x27;1195351566221938690&#x27;,&#x27;1195350919074385921&#x27;,&#x27;编辑课程大纲&#x27;,2,&#x27;chapter.update&#x27;,&#x27;chapter/:id&#x27;,&#x27;/edu/course/chapter&#x27;,NULL,NULL,0,&#x27;2019-11-15 22:43:17&#x27;,&#x27;2019-11-15 22:43:17&#x27;),(&#x27;1195351862889254913&#x27;,&#x27;1&#x27;,&#x27;统计分析&#x27;,1,NULL,&#x27;/statistics/daily&#x27;,&#x27;Layout&#x27;,NULL,NULL,0,&#x27;2019-11-15 22:44:27&#x27;,&#x27;2019-11-15 22:44:27&#x27;),(&#x27;1195351968841568257&#x27;,&#x27;1195351862889254913&#x27;,&#x27;生成统计&#x27;,1,NULL,&#x27;create&#x27;,&#x27;/statistics/daily/create&#x27;,NULL,NULL,0,&#x27;2019-11-15 22:44:53&#x27;,&#x27;2019-11-15 22:44:53&#x27;),(&#x27;1195352054917074946&#x27;,&#x27;1195351862889254913&#x27;,&#x27;统计图表&#x27;,1,NULL,&#x27;chart&#x27;,&#x27;/statistics/daily/chart&#x27;,NULL,NULL,0,&#x27;2019-11-15 22:45:13&#x27;,&#x27;2019-11-15 22:45:13&#x27;),(&#x27;1195352127734386690&#x27;,&#x27;1195352054917074946&#x27;,&#x27;查看&#x27;,2,&#x27;daily.list&#x27;,&#x27;&#x27;,&#x27;&#x27;,NULL,NULL,0,&#x27;2019-11-15 22:45:30&#x27;,&#x27;2019-11-15 22:45:30&#x27;),(&#x27;1195352215768633346&#x27;,&#x27;1195351968841568257&#x27;,&#x27;生成&#x27;,2,&#x27;daily.add&#x27;,&#x27;&#x27;,&#x27;&#x27;,NULL,NULL,0,&#x27;2019-11-15 22:45:51&#x27;,&#x27;2019-11-15 22:45:51&#x27;),(&#x27;1195352547621965825&#x27;,&#x27;1&#x27;,&#x27;CMS管理&#x27;,1,NULL,&#x27;/cms&#x27;,&#x27;Layout&#x27;,NULL,NULL,0,&#x27;2019-11-15 22:47:11&#x27;,&#x27;2019-11-18 10:51:46&#x27;),(&#x27;1195352856645701633&#x27;,&#x27;1195353513549205505&#x27;,&#x27;查看&#x27;,2,&#x27;banner.list&#x27;,&#x27;&#x27;,NULL,NULL,NULL,0,&#x27;2019-11-15 22:48:24&#x27;,&#x27;2019-11-15 22:48:24&#x27;),(&#x27;1195352909401657346&#x27;,&#x27;1195353513549205505&#x27;,&#x27;添加&#x27;,2,&#x27;banner.add&#x27;,&#x27;banner/add&#x27;,&#x27;/cms/banner/form&#x27;,NULL,NULL,0,&#x27;2019-11-15 22:48:37&#x27;,&#x27;2019-11-18 10:52:10&#x27;),(&#x27;1195353051395624961&#x27;,&#x27;1195353513549205505&#x27;,&#x27;修改&#x27;,2,&#x27;banner.update&#x27;,&#x27;banner/update/:id&#x27;,&#x27;/cms/banner/form&#x27;,NULL,NULL,0,&#x27;2019-11-15 22:49:11&#x27;,&#x27;2019-11-18 10:52:05&#x27;),(&#x27;1195353513549205505&#x27;,&#x27;1195352547621965825&#x27;,&#x27;Bander列表&#x27;,1,NULL,&#x27;banner/list&#x27;,&#x27;/cms/banner/list&#x27;,NULL,NULL,0,&#x27;2019-11-15 22:51:01&#x27;,&#x27;2019-11-18 10:51:29&#x27;),(&#x27;1195353672110673921&#x27;,&#x27;1195353513549205505&#x27;,&#x27;删除&#x27;,2,&#x27;banner.remove&#x27;,&#x27;&#x27;,&#x27;&#x27;,NULL,NULL,0,&#x27;2019-11-15 22:51:39&#x27;,&#x27;2019-11-15 22:51:39&#x27;),(&#x27;1195354076890370050&#x27;,&#x27;1&#x27;,&#x27;订单管理&#x27;,1,NULL,&#x27;/order&#x27;,&#x27;Layout&#x27;,NULL,NULL,0,&#x27;2019-11-15 22:53:15&#x27;,&#x27;2019-11-15 22:53:15&#x27;),(&#x27;1195354153482555393&#x27;,&#x27;1195354076890370050&#x27;,&#x27;订单列表&#x27;,1,NULL,&#x27;list&#x27;,&#x27;/order/list&#x27;,NULL,NULL,0,&#x27;2019-11-15 22:53:33&#x27;,&#x27;2019-11-15 22:53:58&#x27;),(&#x27;1195354315093282817&#x27;,&#x27;1195354153482555393&#x27;,&#x27;查看&#x27;,2,&#x27;order.list&#x27;,&#x27;&#x27;,&#x27;&#x27;,NULL,NULL,0,&#x27;2019-11-15 22:54:12&#x27;,&#x27;2019-11-15 22:54:12&#x27;),(&#x27;1196301740985311234&#x27;,&#x27;1195268616021139457&#x27;,&#x27;分配角色&#x27;,2,&#x27;user.assgin&#x27;,&#x27;user/role/:id&#x27;,&#x27;/acl/user/roleForm&#x27;,NULL,NULL,0,&#x27;2019-11-18 13:38:56&#x27;,&#x27;2019-11-18 13:38:56&#x27;);<br><br>#<br># Structure for table &quot;acl_role&quot;<br>#<br><br>CREATE TABLE `acl_role` (<br>  `id` char(19) NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;角色id&#x27;,<br>  `role_name` varchar(20) NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;角色名称&#x27;,<br>  `role_code` varchar(20) DEFAULT NULL COMMENT &#x27;角色编码&#x27;,<br>  `remark` varchar(255) DEFAULT NULL COMMENT &#x27;备注&#x27;,<br>  `is_deleted` tinyint(1) unsigned NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;逻辑删除 1（true）已删除， 0（false）未删除&#x27;,<br>  `gmt_create` datetime NOT NULL COMMENT &#x27;创建时间&#x27;,<br>  `gmt_modified` datetime NOT NULL COMMENT &#x27;更新时间&#x27;,<br>  PRIMARY KEY (`id`)<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8;<br><br>#<br># Data for table &quot;acl_role&quot;<br>#<br><br>INSERT INTO `acl_role` VALUES (&#x27;1&#x27;,&#x27;普通管理员&#x27;,NULL,NULL,0,&#x27;2019-11-11 13:09:32&#x27;,&#x27;2019-11-18 10:27:18&#x27;),(&#x27;1193757683205607426&#x27;,&#x27;课程管理员&#x27;,NULL,NULL,0,&#x27;2019-11-11 13:09:45&#x27;,&#x27;2019-11-18 10:25:44&#x27;),(&#x27;1196300996034977794&#x27;,&#x27;test&#x27;,NULL,NULL,0,&#x27;2019-11-18 13:35:58&#x27;,&#x27;2019-11-18 13:35:58&#x27;);<br><br>#<br># Structure for table &quot;acl_role_permission&quot;<br>#<br><br>CREATE TABLE `acl_role_permission` (<br>  `id` char(19) NOT NULL DEFAULT &#x27;&#x27;,<br>  `role_id` char(19) NOT NULL DEFAULT &#x27;&#x27;,<br>  `permission_id` char(19) NOT NULL DEFAULT &#x27;&#x27;,<br>  `is_deleted` tinyint(1) unsigned NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;逻辑删除 1（true）已删除， 0（false）未删除&#x27;,<br>  `gmt_create` datetime NOT NULL COMMENT &#x27;创建时间&#x27;,<br>  `gmt_modified` datetime NOT NULL COMMENT &#x27;更新时间&#x27;,<br>  PRIMARY KEY (`id`),<br>  KEY `idx_role_id` (`role_id`),<br>  KEY `idx_permission_id` (`permission_id`)<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT=&#x27;角色权限&#x27;;<br><br>#<br># Data for table &quot;acl_role_permission&quot;<br>#<br><br>INSERT INTO `acl_role_permission` VALUES (&#x27;1196301979754455041&#x27;,&#x27;1&#x27;,&#x27;1&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301979792203778&#x27;,&#x27;1&#x27;,&#x27;1195268474480156673&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301979821563906&#x27;,&#x27;1&#x27;,&#x27;1195268616021139457&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301979842535426&#x27;,&#x27;1&#x27;,&#x27;1195269143060602882&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301979855118338&#x27;,&#x27;1&#x27;,&#x27;1195269295926206466&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301979880284161&#x27;,&#x27;1&#x27;,&#x27;1195269473479483394&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301979913838593&#x27;,&#x27;1&#x27;,&#x27;1195269547269873666&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301979926421506&#x27;,&#x27;1&#x27;,&#x27;1196301740985311234&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301979951587330&#x27;,&#x27;1&#x27;,&#x27;1195268788138598401&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980014501889&#x27;,&#x27;1&#x27;,&#x27;1195269821262782465&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980035473410&#x27;,&#x27;1&#x27;,&#x27;1195269903542444034&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980052250626&#x27;,&#x27;1&#x27;,&#x27;1195270037005197313&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980077416450&#x27;,&#x27;1&#x27;,&#x27;1195270442602782721&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980094193665&#x27;,&#x27;1&#x27;,&#x27;1195270621548568578&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980119359489&#x27;,&#x27;1&#x27;,&#x27;1195268893830864898&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980136136706&#x27;,&#x27;1&#x27;,&#x27;1195270744097742849&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980249382913&#x27;,&#x27;1&#x27;,&#x27;1195270810560684034&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980270354434&#x27;,&#x27;1&#x27;,&#x27;1195270862100291586&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980287131649&#x27;,&#x27;1&#x27;,&#x27;1195270887933009922&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980303908866&#x27;,&#x27;1&#x27;,&#x27;1195349439240048642&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980320686082&#x27;,&#x27;1&#x27;,&#x27;1195349699995734017&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980345851905&#x27;,&#x27;1&#x27;,&#x27;1195349979797753857&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980362629121&#x27;,&#x27;1&#x27;,&#x27;1195350117270261762&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980383600641&#x27;,&#x27;1&#x27;,&#x27;1195350188359520258&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980408766465&#x27;,&#x27;1&#x27;,&#x27;1195349810561781761&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980421349378&#x27;,&#x27;1&#x27;,&#x27;1195349876252971010&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980438126593&#x27;,&#x27;1&#x27;,&#x27;1195350299365969922&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980450709506&#x27;,&#x27;1&#x27;,&#x27;1195350397751758850&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980501041153&#x27;,&#x27;1&#x27;,&#x27;1195350612172967938&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980517818370&#x27;,&#x27;1&#x27;,&#x27;1195350500512206850&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980538789889&#x27;,&#x27;1&#x27;,&#x27;1195350687590748161&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980622675970&#x27;,&#x27;1&#x27;,&#x27;1195350831744782337&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980639453186&#x27;,&#x27;1&#x27;,&#x27;1195350919074385921&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980660424705&#x27;,&#x27;1&#x27;,&#x27;1195351159672246274&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980677201922&#x27;,&#x27;1&#x27;,&#x27;1195351326706208770&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980698173441&#x27;,&#x27;1&#x27;,&#x27;1195351566221938690&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980714950658&#x27;,&#x27;1&#x27;,&#x27;1195351020463296513&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980723339266&#x27;,&#x27;1&#x27;,&#x27;1195351862889254913&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980744310786&#x27;,&#x27;1&#x27;,&#x27;1195351968841568257&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980761088001&#x27;,&#x27;1&#x27;,&#x27;1195352215768633346&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980777865217&#x27;,&#x27;1&#x27;,&#x27;1195352054917074946&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980794642434&#x27;,&#x27;1&#x27;,&#x27;1195352127734386690&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980811419650&#x27;,&#x27;1&#x27;,&#x27;1195352547621965825&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980828196865&#x27;,&#x27;1&#x27;,&#x27;1195353513549205505&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980844974082&#x27;,&#x27;1&#x27;,&#x27;1195352856645701633&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980861751298&#x27;,&#x27;1&#x27;,&#x27;1195352909401657346&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980886917122&#x27;,&#x27;1&#x27;,&#x27;1195353051395624961&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980928860162&#x27;,&#x27;1&#x27;,&#x27;1195353672110673921&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980954025986&#x27;,&#x27;1&#x27;,&#x27;1195354076890370050&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980970803201&#x27;,&#x27;1&#x27;,&#x27;1195354153482555393&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196301980987580418&#x27;,&#x27;1&#x27;,&#x27;1195354315093282817&#x27;,1,&#x27;2019-11-18 13:39:53&#x27;,&#x27;2019-11-18 13:39:53&#x27;),(&#x27;1196305293070077953&#x27;,&#x27;1&#x27;,&#x27;1&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305293099438081&#x27;,&#x27;1&#x27;,&#x27;1195268474480156673&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305293120409602&#x27;,&#x27;1&#x27;,&#x27;1195268616021139457&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305293153964034&#x27;,&#x27;1&#x27;,&#x27;1195269143060602882&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305293183324162&#x27;,&#x27;1&#x27;,&#x27;1195269295926206466&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305293212684290&#x27;,&#x27;1&#x27;,&#x27;1195269473479483394&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305293237850114&#x27;,&#x27;1&#x27;,&#x27;1195269547269873666&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305293271404545&#x27;,&#x27;1&#x27;,&#x27;1196301740985311234&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305293485314049&#x27;,&#x27;1&#x27;,&#x27;1195268788138598401&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305293506285569&#x27;,&#x27;1&#x27;,&#x27;1195269821262782465&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305293527257089&#x27;,&#x27;1&#x27;,&#x27;1195269903542444034&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305293552422914&#x27;,&#x27;1&#x27;,&#x27;1195270037005197313&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305293565005825&#x27;,&#x27;1&#x27;,&#x27;1195270442602782721&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305293594365954&#x27;,&#x27;1&#x27;,&#x27;1195270621548568578&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305293611143169&#x27;,&#x27;1&#x27;,&#x27;1195268893830864898&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305293627920385&#x27;,&#x27;1&#x27;,&#x27;1195270744097742849&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305293657280513&#x27;,&#x27;1&#x27;,&#x27;1195349439240048642&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305293674057729&#x27;,&#x27;1&#x27;,&#x27;1195349699995734017&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305293690834946&#x27;,&#x27;1&#x27;,&#x27;1195349979797753857&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305293716000770&#x27;,&#x27;1&#x27;,&#x27;1195350117270261762&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305293736972290&#x27;,&#x27;1&#x27;,&#x27;1195350188359520258&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305293749555202&#x27;,&#x27;1&#x27;,&#x27;1195349810561781761&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305293766332417&#x27;,&#x27;1&#x27;,&#x27;1195349876252971010&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305293795692546&#x27;,&#x27;1&#x27;,&#x27;1195350299365969922&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305293812469762&#x27;,&#x27;1&#x27;,&#x27;1195350397751758850&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305293837635586&#x27;,&#x27;1&#x27;,&#x27;1195350612172967938&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305293858607106&#x27;,&#x27;1&#x27;,&#x27;1195350500512206850&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305293875384322&#x27;,&#x27;1&#x27;,&#x27;1195350687590748161&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305293892161538&#x27;,&#x27;1&#x27;,&#x27;1195350831744782337&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305293950881794&#x27;,&#x27;1&#x27;,&#x27;1195350919074385921&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305293976047617&#x27;,&#x27;1&#x27;,&#x27;1195351159672246274&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305294127042561&#x27;,&#x27;1&#x27;,&#x27;1195351326706208770&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305294156402690&#x27;,&#x27;1&#x27;,&#x27;1195351566221938690&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305294177374209&#x27;,&#x27;1&#x27;,&#x27;1195351862889254913&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305294194151425&#x27;,&#x27;1&#x27;,&#x27;1195351968841568257&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305294223511554&#x27;,&#x27;1&#x27;,&#x27;1195352215768633346&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305294240288770&#x27;,&#x27;1&#x27;,&#x27;1195352054917074946&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305294248677377&#x27;,&#x27;1&#x27;,&#x27;1195352127734386690&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305294248677378&#x27;,&#x27;1&#x27;,&#x27;1195352547621965825&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305294319980546&#x27;,&#x27;1&#x27;,&#x27;1195353513549205505&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305294319980547&#x27;,&#x27;1&#x27;,&#x27;1195352856645701633&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305294319980548&#x27;,&#x27;1&#x27;,&#x27;1195352909401657346&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305294378700802&#x27;,&#x27;1&#x27;,&#x27;1195353051395624961&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305294378700803&#x27;,&#x27;1&#x27;,&#x27;1195353672110673921&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305294458392577&#x27;,&#x27;1&#x27;,&#x27;1195354076890370050&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305294483558402&#x27;,&#x27;1&#x27;,&#x27;1195354153482555393&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305294500335618&#x27;,&#x27;1&#x27;,&#x27;1195354315093282817&#x27;,1,&#x27;2019-11-18 13:53:03&#x27;,&#x27;2019-11-18 13:53:03&#x27;),(&#x27;1196305566656139266&#x27;,&#x27;1&#x27;,&#x27;1&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305566689693698&#x27;,&#x27;1&#x27;,&#x27;1195268474480156673&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305566706470913&#x27;,&#x27;1&#x27;,&#x27;1195268616021139457&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305566740025346&#x27;,&#x27;1&#x27;,&#x27;1195269143060602882&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305566756802561&#x27;,&#x27;1&#x27;,&#x27;1195269295926206466&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305566781968385&#x27;,&#x27;1&#x27;,&#x27;1195269473479483394&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305566811328514&#x27;,&#x27;1&#x27;,&#x27;1195269547269873666&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305566828105730&#x27;,&#x27;1&#x27;,&#x27;1196301740985311234&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305566853271554&#x27;,&#x27;1&#x27;,&#x27;1195268788138598401&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305566878437378&#x27;,&#x27;1&#x27;,&#x27;1195269821262782465&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305566895214593&#x27;,&#x27;1&#x27;,&#x27;1195269903542444034&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305566916186113&#x27;,&#x27;1&#x27;,&#x27;1195270037005197313&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305566949740546&#x27;,&#x27;1&#x27;,&#x27;1195270442602782721&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305566966517761&#x27;,&#x27;1&#x27;,&#x27;1195270621548568578&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305566991683585&#x27;,&#x27;1&#x27;,&#x27;1195268893830864898&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305567012655106&#x27;,&#x27;1&#x27;,&#x27;1195270744097742849&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305567029432322&#x27;,&#x27;1&#x27;,&#x27;1195270810560684034&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305567042015233&#x27;,&#x27;1&#x27;,&#x27;1195270862100291586&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305567100735490&#x27;,&#x27;1&#x27;,&#x27;1195270887933009922&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305567117512705&#x27;,&#x27;1&#x27;,&#x27;1195349439240048642&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305567142678530&#x27;,&#x27;1&#x27;,&#x27;1195349699995734017&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305567155261442&#x27;,&#x27;1&#x27;,&#x27;1195349979797753857&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305567172038658&#x27;,&#x27;1&#x27;,&#x27;1195350117270261762&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305567188815873&#x27;,&#x27;1&#x27;,&#x27;1195350188359520258&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305567218176001&#x27;,&#x27;1&#x27;,&#x27;1195349810561781761&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305567234953217&#x27;,&#x27;1&#x27;,&#x27;1195349876252971010&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305567251730434&#x27;,&#x27;1&#x27;,&#x27;1195350299365969922&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305567272701954&#x27;,&#x27;1&#x27;,&#x27;1195350397751758850&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305567289479170&#x27;,&#x27;1&#x27;,&#x27;1195350612172967938&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305567310450690&#x27;,&#x27;1&#x27;,&#x27;1195350500512206850&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305567327227905&#x27;,&#x27;1&#x27;,&#x27;1195350687590748161&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305567448862722&#x27;,&#x27;1&#x27;,&#x27;1195350831744782337&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305567478222850&#x27;,&#x27;1&#x27;,&#x27;1195350919074385921&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305567495000065&#x27;,&#x27;1&#x27;,&#x27;1195351159672246274&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305567520165889&#x27;,&#x27;1&#x27;,&#x27;1195351326706208770&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305567541137409&#x27;,&#x27;1&#x27;,&#x27;1195351566221938690&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305567570497538&#x27;,&#x27;1&#x27;,&#x27;1195351862889254913&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305567587274754&#x27;,&#x27;1&#x27;,&#x27;1195351968841568257&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305567604051970&#x27;,&#x27;1&#x27;,&#x27;1195352215768633346&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305567633412098&#x27;,&#x27;1&#x27;,&#x27;1195352054917074946&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305567683743745&#x27;,&#x27;1&#x27;,&#x27;1195352127734386690&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305567721492481&#x27;,&#x27;1&#x27;,&#x27;1195352547621965825&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305567742464002&#x27;,&#x27;1&#x27;,&#x27;1195353513549205505&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305567771824129&#x27;,&#x27;1&#x27;,&#x27;1195352856645701633&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305567792795650&#x27;,&#x27;1&#x27;,&#x27;1195352909401657346&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305567809572866&#x27;,&#x27;1&#x27;,&#x27;1195353051395624961&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305567843127298&#x27;,&#x27;1&#x27;,&#x27;1195353672110673921&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305567868293122&#x27;,&#x27;1&#x27;,&#x27;1195354076890370050&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305567885070338&#x27;,&#x27;1&#x27;,&#x27;1195354153482555393&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196305567910236162&#x27;,&#x27;1&#x27;,&#x27;1195354315093282817&#x27;,1,&#x27;2019-11-18 13:54:08&#x27;,&#x27;2019-11-18 13:54:08&#x27;),(&#x27;1196312702601695234&#x27;,&#x27;1&#x27;,&#x27;1&#x27;,0,&#x27;2019-11-18 14:22:29&#x27;,&#x27;2019-11-18 14:22:29&#x27;),(&#x27;1196312702652026881&#x27;,&#x27;1&#x27;,&#x27;1195268474480156673&#x27;,0,&#x27;2019-11-18 14:22:29&#x27;,&#x27;2019-11-18 14:22:29&#x27;),(&#x27;1196312702668804098&#x27;,&#x27;1&#x27;,&#x27;1195268616021139457&#x27;,0,&#x27;2019-11-18 14:22:29&#x27;,&#x27;2019-11-18 14:22:29&#x27;),(&#x27;1196312702698164226&#x27;,&#x27;1&#x27;,&#x27;1195269143060602882&#x27;,0,&#x27;2019-11-18 14:22:29&#x27;,&#x27;2019-11-18 14:22:29&#x27;),(&#x27;1196312702723330049&#x27;,&#x27;1&#x27;,&#x27;1195269295926206466&#x27;,0,&#x27;2019-11-18 14:22:29&#x27;,&#x27;2019-11-18 14:22:29&#x27;),(&#x27;1196312702744301569&#x27;,&#x27;1&#x27;,&#x27;1195269473479483394&#x27;,0,&#x27;2019-11-18 14:22:29&#x27;,&#x27;2019-11-18 14:22:29&#x27;),(&#x27;1196312702765273089&#x27;,&#x27;1&#x27;,&#x27;1195269547269873666&#x27;,0,&#x27;2019-11-18 14:22:29&#x27;,&#x27;2019-11-18 14:22:29&#x27;),(&#x27;1196312702790438913&#x27;,&#x27;1&#x27;,&#x27;1196301740985311234&#x27;,0,&#x27;2019-11-18 14:22:29&#x27;,&#x27;2019-11-18 14:22:29&#x27;),(&#x27;1196312702945628161&#x27;,&#x27;1&#x27;,&#x27;1195268788138598401&#x27;,0,&#x27;2019-11-18 14:22:29&#x27;,&#x27;2019-11-18 14:22:29&#x27;),(&#x27;1196312702970793985&#x27;,&#x27;1&#x27;,&#x27;1195269821262782465&#x27;,0,&#x27;2019-11-18 14:22:29&#x27;,&#x27;2019-11-18 14:22:29&#x27;),(&#x27;1196312703000154114&#x27;,&#x27;1&#x27;,&#x27;1195269903542444034&#x27;,0,&#x27;2019-11-18 14:22:29&#x27;,&#x27;2019-11-18 14:22:29&#x27;),(&#x27;1196312703025319938&#x27;,&#x27;1&#x27;,&#x27;1195270037005197313&#x27;,0,&#x27;2019-11-18 14:22:29&#x27;,&#x27;2019-11-18 14:22:29&#x27;),(&#x27;1196312703046291458&#x27;,&#x27;1&#x27;,&#x27;1195270442602782721&#x27;,0,&#x27;2019-11-18 14:22:29&#x27;,&#x27;2019-11-18 14:22:29&#x27;),(&#x27;1196312703063068673&#x27;,&#x27;1&#x27;,&#x27;1195270621548568578&#x27;,0,&#x27;2019-11-18 14:22:29&#x27;,&#x27;2019-11-18 14:22:29&#x27;),(&#x27;1196312703084040193&#x27;,&#x27;1&#x27;,&#x27;1195268893830864898&#x27;,0,&#x27;2019-11-18 14:22:29&#x27;,&#x27;2019-11-18 14:22:29&#x27;),(&#x27;1196312703113400321&#x27;,&#x27;1&#x27;,&#x27;1195270744097742849&#x27;,0,&#x27;2019-11-18 14:22:29&#x27;,&#x27;2019-11-18 14:22:29&#x27;),(&#x27;1196312703134371842&#x27;,&#x27;1&#x27;,&#x27;1195270810560684034&#x27;,0,&#x27;2019-11-18 14:22:30&#x27;,&#x27;2019-11-18 14:22:30&#x27;),(&#x27;1196312703159537665&#x27;,&#x27;1&#x27;,&#x27;1195270862100291586&#x27;,0,&#x27;2019-11-18 14:22:30&#x27;,&#x27;2019-11-18 14:22:30&#x27;),(&#x27;1196312703184703490&#x27;,&#x27;1&#x27;,&#x27;1195270887933009922&#x27;,0,&#x27;2019-11-18 14:22:30&#x27;,&#x27;2019-11-18 14:22:30&#x27;),(&#x27;1196312703209869313&#x27;,&#x27;1&#x27;,&#x27;1195349439240048642&#x27;,0,&#x27;2019-11-18 14:22:30&#x27;,&#x27;2019-11-18 14:22:30&#x27;),(&#x27;1196312703230840834&#x27;,&#x27;1&#x27;,&#x27;1195349699995734017&#x27;,0,&#x27;2019-11-18 14:22:30&#x27;,&#x27;2019-11-18 14:22:30&#x27;),(&#x27;1196312703251812354&#x27;,&#x27;1&#x27;,&#x27;1195349979797753857&#x27;,0,&#x27;2019-11-18 14:22:30&#x27;,&#x27;2019-11-18 14:22:30&#x27;),(&#x27;1196312703272783873&#x27;,&#x27;1&#x27;,&#x27;1195350117270261762&#x27;,0,&#x27;2019-11-18 14:22:30&#x27;,&#x27;2019-11-18 14:22:30&#x27;),(&#x27;1196312703293755394&#x27;,&#x27;1&#x27;,&#x27;1195350188359520258&#x27;,0,&#x27;2019-11-18 14:22:30&#x27;,&#x27;2019-11-18 14:22:30&#x27;),(&#x27;1196312703327309826&#x27;,&#x27;1&#x27;,&#x27;1195349810561781761&#x27;,0,&#x27;2019-11-18 14:22:30&#x27;,&#x27;2019-11-18 14:22:30&#x27;),(&#x27;1196312703348281345&#x27;,&#x27;1&#x27;,&#x27;1195349876252971010&#x27;,0,&#x27;2019-11-18 14:22:30&#x27;,&#x27;2019-11-18 14:22:30&#x27;),(&#x27;1196312703365058561&#x27;,&#x27;1&#x27;,&#x27;1195350299365969922&#x27;,0,&#x27;2019-11-18 14:22:30&#x27;,&#x27;2019-11-18 14:22:30&#x27;),(&#x27;1196312703386030082&#x27;,&#x27;1&#x27;,&#x27;1195350397751758850&#x27;,0,&#x27;2019-11-18 14:22:30&#x27;,&#x27;2019-11-18 14:22:30&#x27;),(&#x27;1196312703440556034&#x27;,&#x27;1&#x27;,&#x27;1195350612172967938&#x27;,0,&#x27;2019-11-18 14:22:30&#x27;,&#x27;2019-11-18 14:22:30&#x27;),(&#x27;1196312703486693378&#x27;,&#x27;1&#x27;,&#x27;1195350500512206850&#x27;,0,&#x27;2019-11-18 14:22:30&#x27;,&#x27;2019-11-18 14:22:30&#x27;),(&#x27;1196312703511859202&#x27;,&#x27;1&#x27;,&#x27;1195350687590748161&#x27;,0,&#x27;2019-11-18 14:22:30&#x27;,&#x27;2019-11-18 14:22:30&#x27;),(&#x27;1196312703654465537&#x27;,&#x27;1&#x27;,&#x27;1195350831744782337&#x27;,0,&#x27;2019-11-18 14:22:30&#x27;,&#x27;2019-11-18 14:22:30&#x27;),(&#x27;1196312703683825665&#x27;,&#x27;1&#x27;,&#x27;1195350919074385921&#x27;,0,&#x27;2019-11-18 14:22:30&#x27;,&#x27;2019-11-18 14:22:30&#x27;),(&#x27;1196312703700602882&#x27;,&#x27;1&#x27;,&#x27;1195351159672246274&#x27;,0,&#x27;2019-11-18 14:22:30&#x27;,&#x27;2019-11-18 14:22:30&#x27;),(&#x27;1196312703717380098&#x27;,&#x27;1&#x27;,&#x27;1195351326706208770&#x27;,0,&#x27;2019-11-18 14:22:30&#x27;,&#x27;2019-11-18 14:22:30&#x27;),(&#x27;1196312703738351618&#x27;,&#x27;1&#x27;,&#x27;1195351566221938690&#x27;,0,&#x27;2019-11-18 14:22:30&#x27;,&#x27;2019-11-18 14:22:30&#x27;),(&#x27;1196312703759323137&#x27;,&#x27;1&#x27;,&#x27;1195351020463296513&#x27;,0,&#x27;2019-11-18 14:22:30&#x27;,&#x27;2019-11-18 14:22:30&#x27;),(&#x27;1196312703776100353&#x27;,&#x27;1&#x27;,&#x27;1195351862889254913&#x27;,0,&#x27;2019-11-18 14:22:30&#x27;,&#x27;2019-11-18 14:22:30&#x27;),(&#x27;1196312703792877570&#x27;,&#x27;1&#x27;,&#x27;1195351968841568257&#x27;,0,&#x27;2019-11-18 14:22:30&#x27;,&#x27;2019-11-18 14:22:30&#x27;),(&#x27;1196312703830626305&#x27;,&#x27;1&#x27;,&#x27;1195352215768633346&#x27;,0,&#x27;2019-11-18 14:22:30&#x27;,&#x27;2019-11-18 14:22:30&#x27;),(&#x27;1196312703843209217&#x27;,&#x27;1&#x27;,&#x27;1195352054917074946&#x27;,0,&#x27;2019-11-18 14:22:30&#x27;,&#x27;2019-11-18 14:22:30&#x27;),(&#x27;1196312703868375041&#x27;,&#x27;1&#x27;,&#x27;1195352127734386690&#x27;,0,&#x27;2019-11-18 14:22:30&#x27;,&#x27;2019-11-18 14:22:30&#x27;),(&#x27;1196312703889346561&#x27;,&#x27;1&#x27;,&#x27;1195352547621965825&#x27;,0,&#x27;2019-11-18 14:22:30&#x27;,&#x27;2019-11-18 14:22:30&#x27;),(&#x27;1196312703901929473&#x27;,&#x27;1&#x27;,&#x27;1195353513549205505&#x27;,0,&#x27;2019-11-18 14:22:30&#x27;,&#x27;2019-11-18 14:22:30&#x27;),(&#x27;1196312703918706689&#x27;,&#x27;1&#x27;,&#x27;1195352856645701633&#x27;,0,&#x27;2019-11-18 14:22:30&#x27;,&#x27;2019-11-18 14:22:30&#x27;),(&#x27;1196312703952261121&#x27;,&#x27;1&#x27;,&#x27;1195352909401657346&#x27;,0,&#x27;2019-11-18 14:22:30&#x27;,&#x27;2019-11-18 14:22:30&#x27;),(&#x27;1196312703973232642&#x27;,&#x27;1&#x27;,&#x27;1195353051395624961&#x27;,0,&#x27;2019-11-18 14:22:30&#x27;,&#x27;2019-11-18 14:22:30&#x27;),(&#x27;1196312703990009857&#x27;,&#x27;1&#x27;,&#x27;1195353672110673921&#x27;,0,&#x27;2019-11-18 14:22:30&#x27;,&#x27;2019-11-18 14:22:30&#x27;),(&#x27;1196312704048730114&#x27;,&#x27;1&#x27;,&#x27;1195354076890370050&#x27;,0,&#x27;2019-11-18 14:22:30&#x27;,&#x27;2019-11-18 14:22:30&#x27;),(&#x27;1196312704069701633&#x27;,&#x27;1&#x27;,&#x27;1195354153482555393&#x27;,0,&#x27;2019-11-18 14:22:30&#x27;,&#x27;2019-11-18 14:22:30&#x27;),(&#x27;1196312704094867457&#x27;,&#x27;1&#x27;,&#x27;1195354315093282817&#x27;,0,&#x27;2019-11-18 14:22:30&#x27;,&#x27;2019-11-18 14:22:30&#x27;);<br><br>#<br># Structure for table &quot;acl_user&quot;<br>#<br><br>CREATE TABLE `acl_user` (<br>  `id` char(19) NOT NULL COMMENT &#x27;会员id&#x27;,<br>  `username` varchar(20) NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;微信openid&#x27;,<br>  `password` varchar(32) NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;密码&#x27;,<br>  `nick_name` varchar(50) DEFAULT NULL COMMENT &#x27;昵称&#x27;,<br>  `salt` varchar(255) DEFAULT NULL COMMENT &#x27;用户头像&#x27;,<br>  `token` varchar(100) DEFAULT NULL COMMENT &#x27;用户签名&#x27;,<br>  `is_deleted` tinyint(1) unsigned NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;逻辑删除 1（true）已删除， 0（false）未删除&#x27;,<br>  `gmt_create` datetime NOT NULL COMMENT &#x27;创建时间&#x27;,<br>  `gmt_modified` datetime NOT NULL COMMENT &#x27;更新时间&#x27;,<br>  PRIMARY KEY (`id`),<br>  UNIQUE KEY `uk_username` (`username`)<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT=&#x27;用户表&#x27;;<br><br>#<br># Data for table &quot;acl_user&quot;<br>#<br><br>INSERT INTO `acl_user` VALUES (&#x27;1&#x27;,&#x27;admin&#x27;,&#x27;96e79218965eb72c92a549dd5a330112&#x27;,&#x27;admin&#x27;,&#x27;&#x27;,NULL,0,&#x27;2019-11-01 10:39:47&#x27;,&#x27;2019-11-01 10:39:47&#x27;),(&#x27;2&#x27;,&#x27;test&#x27;,&#x27;96e79218965eb72c92a549dd5a330112&#x27;,&#x27;test&#x27;,NULL,NULL,0,&#x27;2019-11-01 16:36:07&#x27;,&#x27;2019-11-01 16:40:08&#x27;);<br><br>#<br># Structure for table &quot;acl_user_role&quot;<br>#<br><br>CREATE TABLE `acl_user_role` (<br>  `id` char(19) NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;主键id&#x27;,<br>  `role_id` char(19) NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;角色id&#x27;,<br>  `user_id` char(19) NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;用户id&#x27;,<br>  `is_deleted` tinyint(1) unsigned NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;逻辑删除 1（true）已删除， 0（false）未删除&#x27;,<br>  `gmt_create` datetime NOT NULL COMMENT &#x27;创建时间&#x27;,<br>  `gmt_modified` datetime NOT NULL COMMENT &#x27;更新时间&#x27;,<br>  PRIMARY KEY (`id`),<br>  KEY `idx_role_id` (`role_id`),<br>  KEY `idx_user_id` (`user_id`)<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8;<br><br>#<br># Data for table &quot;acl_user_role&quot;<br>#<br><br>INSERT INTO `acl_user_role` VALUES (&#x27;1&#x27;,&#x27;1&#x27;,&#x27;2&#x27;,0,&#x27;2019-11-11 13:09:53&#x27;,&#x27;2019-11-11 13:09:53&#x27;);<br><br></code></pre></td></tr></table></figure><h4 id="创建工程"><a href="#创建工程" class="headerlink" title="创建工程"></a>创建工程</h4><blockquote><p>父工程需要加<code>&lt;packaging&gt;pom&lt;/packaging&gt;</code><br><img src="/assets/2023-06-02-22-05-10.png"></p></blockquote><p>最后创建出来的工程应该是这个样子的<br><img src="/assets/2023-06-02-22-11-05.png"></p><p>最外边的acl_parent的父工程boot版本指定成<code>2.2.1.RELEASE</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2.1.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>/&gt;</span> <span class="hljs-comment">&lt;!-- lookup parent from repository --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.atguigu<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>acl_parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="导入依赖"><a href="#导入依赖" class="headerlink" title="导入依赖"></a>导入依赖</h4><p>acl_parent</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">mybatis-plus.version</span>&gt;</span>3.0.5<span class="hljs-tag">&lt;/<span class="hljs-name">mybatis-plus.version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">velocity.version</span>&gt;</span>2.0<span class="hljs-tag">&lt;/<span class="hljs-name">velocity.version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">swagger.version</span>&gt;</span>2.7.0<span class="hljs-tag">&lt;/<span class="hljs-name">swagger.version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">jwt.version</span>&gt;</span>0.7.0<span class="hljs-tag">&lt;/<span class="hljs-name">jwt.version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">fastjson.version</span>&gt;</span>1.2.28<span class="hljs-tag">&lt;/<span class="hljs-name">fastjson.version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">gson.version</span>&gt;</span>2.8.2<span class="hljs-tag">&lt;/<span class="hljs-name">gson.version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">json.version</span>&gt;</span>20170516<span class="hljs-tag">&lt;/<span class="hljs-name">json.version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">cloud-alibaba.version</span>&gt;</span>0.2.2.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">cloud-alibaba.version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--Spring Cloud--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>Hoxton.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;cloud-alibaba.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--mybatis-plus 持久层--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;mybatis-plus.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!-- velocity 模板引擎, Mybatis Plus 代码生成器需要 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.velocity<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>velocity-engine-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;velocity.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.google.code.gson<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>gson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;gson.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--swagger--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-swagger2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;swagger.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--swagger ui--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;swagger.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- JWT --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.jsonwebtoken<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jjwt<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;jwt.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fastjson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;fastjson.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.json<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>json<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;json.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span><br></code></pre></td></tr></table></figure><p>service</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.atguigu<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>service_base<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!--服务注册--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--服务调用--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!--mybatis-plus--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--swagger--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-swagger2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--mysql--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- velocity 模板引擎, Mybatis Plus 代码生成器需要 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.velocity<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>velocity-engine-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><br>    <span class="hljs-comment">&lt;!--lombok用来简化实体类：需要安装lombok插件--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--gson--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.google.code.gson<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>gson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>src/main/java<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">includes</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>**/*.xml<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">includes</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">filtering</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">filtering</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></td></tr></table></figure><p>service_acl</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.atguigu<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring_security<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fastjson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><p>api_gateway</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.atguigu<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>service_base<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!--gson--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.google.code.gson<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>gson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!--服务调用--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><p>common</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided <span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!--mybatis-plus--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided <span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!--lombok用来简化实体类：需要安装lombok插件--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided <span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--swagger--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-swagger2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided <span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided <span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- redis --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- spring2.X集成redis所需common-pool2--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.commons<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-pool2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.6.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><p>spring_security</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.atguigu<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>service_base<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- Spring Security依赖 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.jsonwebtoken<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jjwt<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="启动Redis和Nacos"><a href="#启动Redis和Nacos" class="headerlink" title="启动Redis和Nacos"></a>启动Redis和Nacos</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xiamu ~]<span class="hljs-comment"># redis-server /etc/redis.config </span><br>[root@xiamu ~]<span class="hljs-comment"># ps -ef | grep redis</span><br>root       2975      1  0 15:56 ?        00:00:00 redis-server *:6379<br>root       2991   2856  0 15:56 pts/0    00:00:00 grep --color=auto redis<br>[root@xiamu ~]<span class="hljs-comment"># redis-cli </span><br>127.0.0.1:6379&gt; <br><br></code></pre></td></tr></table></figure><p>启动完成之后使用 Redis Desktop Manager 测试一下能够连接上<br><img src="/assets/2023-06-03-15-58-19.png"></p><p>nacos在linux没有安装, 直接上windows用了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">startup.cmd -m standalone<br></code></pre></td></tr></table></figure><p><img src="/assets/2023-06-03-16-06-24.png"></p><h4 id="引入工具类"><a href="#引入工具类" class="headerlink" title="引入工具类"></a>引入工具类</h4><p><img src="/assets/2023-06-03-16-13-54.png"></p><p>GlobalExceptionHandler.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@ControllerAdvice</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GlobalExceptionHandler</span> &#123;<br><br>    <span class="hljs-comment">//指定出现什么异常执行这个方法</span><br>    <span class="hljs-meta">@ExceptionHandler(Exception.class)</span><br>    <span class="hljs-meta">@ResponseBody</span> <span class="hljs-comment">//为了返回数据</span><br>    <span class="hljs-keyword">public</span> R <span class="hljs-title function_">error</span><span class="hljs-params">(Exception e)</span> &#123;<br>        e.printStackTrace();<br>        <span class="hljs-keyword">return</span> R.error().message(<span class="hljs-string">&quot;执行了全局异常处理..&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//特定异常</span><br>    <span class="hljs-meta">@ExceptionHandler(ArithmeticException.class)</span><br>    <span class="hljs-meta">@ResponseBody</span> <span class="hljs-comment">//为了返回数据</span><br>    <span class="hljs-keyword">public</span> R <span class="hljs-title function_">error</span><span class="hljs-params">(ArithmeticException e)</span> &#123;<br>        e.printStackTrace();<br>        <span class="hljs-keyword">return</span> R.error().message(<span class="hljs-string">&quot;执行了ArithmeticException异常处理..&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//自定义异常</span><br>    <span class="hljs-meta">@ExceptionHandler(GuliException.class)</span><br>    <span class="hljs-meta">@ResponseBody</span> <span class="hljs-comment">//为了返回数据</span><br>    <span class="hljs-keyword">public</span> R <span class="hljs-title function_">error</span><span class="hljs-params">(GuliException e)</span> &#123;<br>        log.error(e.getMessage());<br>        e.printStackTrace();<br><br>        <span class="hljs-keyword">return</span> R.error().code(e.getCode()).message(e.getMsg());<br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><p>GuliException.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@AllArgsConstructor</span>  <span class="hljs-comment">//生成有参数构造方法</span><br><span class="hljs-meta">@NoArgsConstructor</span>   <span class="hljs-comment">//生成无参数构造</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GuliException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RuntimeException</span> &#123;<br>    <span class="hljs-keyword">private</span> Integer code;<span class="hljs-comment">//状态码</span><br>    <span class="hljs-keyword">private</span> String msg;<span class="hljs-comment">//异常信息</span><br>&#125;<br><br></code></pre></td></tr></table></figure><p>MyMetaObjectHandler.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyMetaObjectHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MetaObjectHandler</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertFill</span><span class="hljs-params">(MetaObject metaObject)</span> &#123;<br>        <span class="hljs-comment">//属性名称，不是字段名称</span><br>        <span class="hljs-built_in">this</span>.setFieldValByName(<span class="hljs-string">&quot;gmtCreate&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(), metaObject);<br>        <span class="hljs-built_in">this</span>.setFieldValByName(<span class="hljs-string">&quot;gmtModified&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(), metaObject);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateFill</span><span class="hljs-params">(MetaObject metaObject)</span> &#123;<br>        <span class="hljs-built_in">this</span>.setFieldValByName(<span class="hljs-string">&quot;gmtModified&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(), metaObject);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>MD5.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MD5</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">encrypt</span><span class="hljs-params">(String strSrc)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">char</span> hexChars[] = &#123; <span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>, <span class="hljs-string">&#x27;4&#x27;</span>, <span class="hljs-string">&#x27;5&#x27;</span>, <span class="hljs-string">&#x27;6&#x27;</span>, <span class="hljs-string">&#x27;7&#x27;</span>, <span class="hljs-string">&#x27;8&#x27;</span>,<br>                    <span class="hljs-string">&#x27;9&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>, <span class="hljs-string">&#x27;e&#x27;</span>, <span class="hljs-string">&#x27;f&#x27;</span> &#125;;<br>            <span class="hljs-type">byte</span>[] bytes = strSrc.getBytes();<br>            <span class="hljs-type">MessageDigest</span> <span class="hljs-variable">md</span> <span class="hljs-operator">=</span> MessageDigest.getInstance(<span class="hljs-string">&quot;MD5&quot;</span>);<br>            md.update(bytes);<br>            bytes = md.digest();<br>            <span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> bytes.length;<br>            <span class="hljs-type">char</span>[] chars = <span class="hljs-keyword">new</span> <span class="hljs-title class_">char</span>[j * <span class="hljs-number">2</span>];<br>            <span class="hljs-type">int</span> <span class="hljs-variable">k</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; bytes.length; i++) &#123;<br>                <span class="hljs-type">byte</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> bytes[i];<br>                chars[k++] = hexChars[b &gt;&gt;&gt; <span class="hljs-number">4</span> &amp; <span class="hljs-number">0xf</span>];<br>                chars[k++] = hexChars[b &amp; <span class="hljs-number">0xf</span>];<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(chars);<br>        &#125; <span class="hljs-keyword">catch</span> (NoSuchAlgorithmException e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;MD5加密出错！！+&quot;</span> + e);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        System.out.println(MD5.encrypt(<span class="hljs-string">&quot;111111&quot;</span>));<br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><p>R.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-comment">//统一返回结果的类</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">R</span> &#123;<br><br>    <span class="hljs-keyword">private</span> Boolean success;<br><br>    <span class="hljs-keyword">private</span> Integer code;<br><br>    <span class="hljs-keyword">private</span> String message;<br><br>    <span class="hljs-keyword">private</span> Map&lt;String, Object&gt; data = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;String, Object&gt;();<br><br>    <span class="hljs-comment">//把构造方法私有</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">R</span><span class="hljs-params">()</span> &#123;&#125;<br><br>    <span class="hljs-comment">//成功静态方法</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> R <span class="hljs-title function_">ok</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">R</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">R</span>();<br>        r.setSuccess(<span class="hljs-literal">true</span>);<br>        r.setCode(<span class="hljs-number">20000</span>);<br>        r.setMessage(<span class="hljs-string">&quot;成功&quot;</span>);<br>        <span class="hljs-keyword">return</span> r;<br>    &#125;<br><br>    <span class="hljs-comment">//失败静态方法</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> R <span class="hljs-title function_">error</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">R</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">R</span>();<br>        r.setSuccess(<span class="hljs-literal">false</span>);<br>        r.setCode(<span class="hljs-number">20001</span>);<br>        r.setMessage(<span class="hljs-string">&quot;失败&quot;</span>);<br>        <span class="hljs-keyword">return</span> r;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> R <span class="hljs-title function_">success</span><span class="hljs-params">(Boolean success)</span>&#123;<br>        <span class="hljs-built_in">this</span>.setSuccess(success);<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> R <span class="hljs-title function_">message</span><span class="hljs-params">(String message)</span>&#123;<br>        <span class="hljs-built_in">this</span>.setMessage(message);<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> R <span class="hljs-title function_">code</span><span class="hljs-params">(Integer code)</span>&#123;<br>        <span class="hljs-built_in">this</span>.setCode(code);<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> R <span class="hljs-title function_">data</span><span class="hljs-params">(String key, Object value)</span>&#123;<br>        <span class="hljs-built_in">this</span>.data.put(key, value);<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> R <span class="hljs-title function_">data</span><span class="hljs-params">(Map&lt;String, Object&gt; map)</span>&#123;<br>        <span class="hljs-built_in">this</span>.setData(map);<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ResponseUtil.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ResponseUtil</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">out</span><span class="hljs-params">(HttpServletResponse response, R r)</span> &#123;<br>        <span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();<br>        response.setStatus(HttpStatus.OK.value());<br>        response.setContentType(MediaType.APPLICATION_JSON_UTF8_VALUE);<br>        <span class="hljs-keyword">try</span> &#123;<br>            mapper.writeValue(response.getWriter(), r);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>RedisConfig.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@EnableCaching</span> <span class="hljs-comment">//开启缓存</span><br><span class="hljs-meta">@Configuration</span>  <span class="hljs-comment">//配置类</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">CachingConfigurerSupport</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="hljs-title function_">redisTemplate</span><span class="hljs-params">(RedisConnectionFactory factory)</span> &#123;<br>        RedisTemplate&lt;String, Object&gt; template = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisTemplate</span>&lt;&gt;();<br>        RedisSerializer&lt;String&gt; redisSerializer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRedisSerializer</span>();<br>        <span class="hljs-type">Jackson2JsonRedisSerializer</span> <span class="hljs-variable">jackson2JsonRedisSerializer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jackson2JsonRedisSerializer</span>(Object.class);<br>        <span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">om</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();<br>        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);<br>        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);<br>        jackson2JsonRedisSerializer.setObjectMapper(om);<br>        template.setConnectionFactory(factory);<br>        <span class="hljs-comment">//key序列化方式</span><br>        template.setKeySerializer(redisSerializer);<br>        <span class="hljs-comment">//value序列化</span><br>        template.setValueSerializer(jackson2JsonRedisSerializer);<br>        <span class="hljs-comment">//value hashmap序列化</span><br>        template.setHashValueSerializer(jackson2JsonRedisSerializer);<br>        <span class="hljs-keyword">return</span> template;<br>    &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> CacheManager <span class="hljs-title function_">cacheManager</span><span class="hljs-params">(RedisConnectionFactory factory)</span> &#123;<br>        RedisSerializer&lt;String&gt; redisSerializer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRedisSerializer</span>();<br>        <span class="hljs-type">Jackson2JsonRedisSerializer</span> <span class="hljs-variable">jackson2JsonRedisSerializer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jackson2JsonRedisSerializer</span>(Object.class);<br>        <span class="hljs-comment">//解决查询缓存转换异常的问题</span><br>        <span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">om</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();<br>        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);<br>        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);<br>        jackson2JsonRedisSerializer.setObjectMapper(om);<br>        <span class="hljs-comment">// 配置序列化（解决乱码的问题）,过期时间600秒</span><br>        <span class="hljs-type">RedisCacheConfiguration</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> RedisCacheConfiguration.defaultCacheConfig()<br>                .entryTtl(Duration.ofSeconds(<span class="hljs-number">600</span>))<br>                .serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(redisSerializer))<br>                .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(jackson2JsonRedisSerializer))<br>                .disableCachingNullValues();<br>        <span class="hljs-type">RedisCacheManager</span> <span class="hljs-variable">cacheManager</span> <span class="hljs-operator">=</span> RedisCacheManager.builder(factory)<br>                .cacheDefaults(config)<br>                .build();<br>        <span class="hljs-keyword">return</span> cacheManager;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>SwaggerConfig.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@Configuration</span><span class="hljs-comment">//配置类</span><br><span class="hljs-meta">@EnableSwagger2</span> <span class="hljs-comment">//swagger注解</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SwaggerConfig</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Docket <span class="hljs-title function_">webApiConfig</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Docket</span>(DocumentationType.SWAGGER_2)<br>                .groupName(<span class="hljs-string">&quot;webApi&quot;</span>)<br>                .apiInfo(webApiInfo())<br>                .select()<br>                <span class="hljs-comment">//.paths(Predicates.not(PathSelectors.regex(&quot;/admin/.*&quot;)))</span><br>                .paths(Predicates.not(PathSelectors.regex(<span class="hljs-string">&quot;/error.*&quot;</span>)))<br>                .build();<br><br>    &#125;<br><br>    <span class="hljs-keyword">private</span> ApiInfo <span class="hljs-title function_">webApiInfo</span><span class="hljs-params">()</span>&#123;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApiInfoBuilder</span>()<br>                .title(<span class="hljs-string">&quot;网站-课程中心API文档&quot;</span>)<br>                .description(<span class="hljs-string">&quot;本文档描述了课程中心微服务接口定义&quot;</span>)<br>                .version(<span class="hljs-string">&quot;1.0&quot;</span>)<br>                .contact(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Contact</span>(<span class="hljs-string">&quot;java&quot;</span>, <span class="hljs-string">&quot;http://atguigu.com&quot;</span>, <span class="hljs-string">&quot;1123@qq.com&quot;</span>))<br>                .build();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="编写security工具类"><a href="#编写security工具类" class="headerlink" title="编写security工具类"></a>编写security工具类</h4><p><img src="/assets/2023-06-04-11-14-05.png"></p><p>编写DefaultPasswordEncoder</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultPasswordEncoder</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PasswordEncoder</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DefaultPasswordEncoder</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">this</span>(-<span class="hljs-number">1</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DefaultPasswordEncoder</span><span class="hljs-params">(<span class="hljs-type">int</span> strength)</span> &#123;<br><br>    &#125;<br><br>    <span class="hljs-comment">// 进行MD5加密</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">encode</span><span class="hljs-params">(CharSequence charSequence)</span> &#123;<br>        <span class="hljs-keyword">return</span> MD5.encrypt(charSequence.toString());<br>    &#125;<br><br>    <span class="hljs-comment">// 进行密码比对</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">matches</span><span class="hljs-params">(CharSequence charSequence, String s)</span> &#123;<br>        <span class="hljs-keyword">return</span> s.equals(MD5.encrypt(charSequence.toString()));<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>编写TokenManager</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TokenManager</span> &#123;<br>    <span class="hljs-comment">// token 有效时长</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Long</span> <span class="hljs-variable">tokenExpiration</span> <span class="hljs-operator">=</span> <span class="hljs-number">24</span>*<span class="hljs-number">60</span>*<span class="hljs-number">60</span>*<span class="hljs-number">1000L</span>;<br><br>    <span class="hljs-comment">// 编码秘钥</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">tokenSignKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;123456&quot;</span>;<br><br>    <span class="hljs-comment">// 1. 使用jwt根据用户名生成token</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">createToken</span><span class="hljs-params">(String username)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> Jwts.builder().setSubject(username).setExpiration(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(System.currentTimeMillis() + tokenExpiration))<br>                .signWith(SignatureAlgorithm.HS512, tokenSignKey)<br>                .compressWith(CompressionCodecs.GZIP)<br>                .compact();<br>        <span class="hljs-keyword">return</span> token;<br>    &#125;<br><br>    <span class="hljs-comment">// 2 根据token字符串得到用户信息</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUserInfoFromToken</span><span class="hljs-params">(String token)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">userInfo</span> <span class="hljs-operator">=</span> Jwts.parser().setSigningKey(tokenSignKey).parseClaimsJws(token).getBody().getSubject();<br>        <span class="hljs-keyword">return</span> userInfo;<br>    &#125;<br><br>    <span class="hljs-comment">// 3 删除token</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeToken</span><span class="hljs-params">(String token)</span> &#123;&#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><p>编写TokenLogoutHandler</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-comment">// 退出处理器</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TokenLogoutHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">LogoutHandler</span> &#123;<br><br>    <span class="hljs-keyword">private</span> TokenManager tokenManager;<br>    <span class="hljs-keyword">private</span> RedisTemplate redisTemplate;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">TokenLogoutHandler</span><span class="hljs-params">(TokenManager tokenManager, RedisTemplate redisTemplate)</span> &#123;<br>        <span class="hljs-built_in">this</span>.tokenManager = tokenManager;<br>        <span class="hljs-built_in">this</span>.redisTemplate = redisTemplate;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">logout</span><span class="hljs-params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Authentication authentication)</span> &#123;<br>        <span class="hljs-comment">// 1. 从header里面获取token</span><br>        <span class="hljs-comment">// 2. token不为空, 移除token, 从redis删除token</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> httpServletRequest.getHeader(<span class="hljs-string">&quot;token&quot;</span>);<br>        <span class="hljs-keyword">if</span> (token != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">// 移除</span><br>            tokenManager.removeToken(token);<br><br>            <span class="hljs-comment">// 从token获取用户名</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> tokenManager.getUserInfoFromToken(token);<br>            redisTemplate.delete(username);<br>        &#125;<br>        ResponseUtil.out(httpServletResponse, R.ok());<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>编写UnauthorizedEntryPoint</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-comment">// 未授权统一处理类</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UnauthorizedEntryPoint</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AuthenticationEntryPoint</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">commence</span><span class="hljs-params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, AuthenticationException e)</span> <span class="hljs-keyword">throws</span> IOException, ServletException &#123;<br>        ResponseUtil.out(httpServletResponse, R.error());<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>编写SecurityUser</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecurityUser</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserDetails</span> &#123;<br>    <span class="hljs-comment">//当前登录用户</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> User currentUserInfo;<br>    <span class="hljs-comment">//当前权限</span><br>    <span class="hljs-keyword">private</span> List&lt;String&gt; permissionValueList;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SecurityUser</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SecurityUser</span><span class="hljs-params">(User user)</span> &#123;<br>        <span class="hljs-keyword">if</span> (user != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-built_in">this</span>.currentUserInfo = user;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Collection&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">GrantedAuthority</span>&gt; getAuthorities() &#123;<br>        Collection&lt;GrantedAuthority&gt; authorities = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (String permissionValue : permissionValueList) &#123;<br>            <span class="hljs-keyword">if</span> (StringUtils.isEmpty(permissionValue)) <span class="hljs-keyword">continue</span>;<br>            <span class="hljs-type">SimpleGrantedAuthority</span> <span class="hljs-variable">authority</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span><br>                    <span class="hljs-title class_">SimpleGrantedAuthority</span>(permissionValue);<br>            authorities.add(authority);<br>        &#125;<br>        <span class="hljs-keyword">return</span> authorities;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getPassword</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> currentUserInfo.getPassword();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUsername</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> currentUserInfo.getUsername();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isAccountNonExpired</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isAccountNonLocked</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isCredentialsNonExpired</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isEnabled</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>编写User</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@ApiModel(description = &quot;用户实体类&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">private</span> String username;<br>    <span class="hljs-keyword">private</span> String password;<br>    <span class="hljs-keyword">private</span> String nickName;<br>    <span class="hljs-keyword">private</span> String salt;<br>    <span class="hljs-keyword">private</span> String token;<br>&#125;<br></code></pre></td></tr></table></figure><p>编写TokenLoginFilter</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-comment">// 认证过滤器</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TokenLoginFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">UsernamePasswordAuthenticationFilter</span> &#123;<br><br>    <span class="hljs-keyword">private</span> TokenManager tokenManager;<br>    <span class="hljs-keyword">private</span> RedisTemplate redisTemplate;<br>    <span class="hljs-keyword">private</span> AuthenticationManager authenticationManager;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">TokenLoginFilter</span><span class="hljs-params">(AuthenticationManager authenticationManager, TokenManager tokenManager, RedisTemplate redisTemplate)</span> &#123;<br>        <span class="hljs-built_in">this</span>.authenticationManager = authenticationManager;<br>        <span class="hljs-built_in">this</span>.tokenManager = tokenManager;<br>        <span class="hljs-built_in">this</span>.redisTemplate = redisTemplate;<br>        <span class="hljs-built_in">this</span>.setPostOnly(<span class="hljs-literal">false</span>);<br>        <span class="hljs-built_in">this</span>.setRequiresAuthenticationRequestMatcher(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AntPathRequestMatcher</span>(<span class="hljs-string">&quot;/admin/acl/login&quot;</span>,<span class="hljs-string">&quot;POST&quot;</span>));<br>    &#125;<br><br>    <span class="hljs-comment">// 1. 获取表单提交用户名和密码</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Authentication <span class="hljs-title function_">attemptAuthentication</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> AuthenticationException &#123;<br>        <span class="hljs-comment">// 获取表单提交数据</span><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>().readValue(request.getInputStream(), User.class);<br>            <span class="hljs-keyword">return</span> authenticationManager.authenticate(<span class="hljs-keyword">new</span> <span class="hljs-title class_">UsernamePasswordAuthenticationToken</span>(user.getUsername(), user.getPassword(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;()));<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// 2. 认证成功调用方法</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">successfulAuthentication</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, FilterChain chain, Authentication authResult)</span> <span class="hljs-keyword">throws</span> IOException, ServletException &#123;<br>        <span class="hljs-comment">// 认证成功, 得到认证成功之后用户信息</span><br>        <span class="hljs-type">SecurityUser</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> (SecurityUser) authResult.getPrincipal();<br>        <span class="hljs-comment">// 根据用户名生成token</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> tokenManager.createToken(user.getCurrentUserInfo().getUsername());<br>        <span class="hljs-comment">// 把用户名生成token</span><br>        redisTemplate.opsForValue().set(user.getCurrentUserInfo().getUsername(), user.getPermissionValueList());<br>        <span class="hljs-comment">// 返回token</span><br>        ResponseUtil.out(response, R.ok().data(<span class="hljs-string">&quot;token&quot;</span>, token));<br>    &#125;<br><br>    <span class="hljs-comment">// 3. 认证失败调用方法</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unsuccessfulAuthentication</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, AuthenticationException failed)</span> <span class="hljs-keyword">throws</span> IOException, ServletException &#123;<br>        ResponseUtil.out(response, R.error());<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>编写TokenAuthFilter</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TokenAuthFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BasicAuthenticationFilter</span> &#123;<br><br>    <span class="hljs-keyword">private</span> TokenManager tokenManager;<br>    <span class="hljs-keyword">private</span> RedisTemplate redisTemplate;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">TokenAuthFilter</span><span class="hljs-params">(AuthenticationManager authenticationManager,TokenManager tokenManager,RedisTemplate redisTemplate)</span> &#123;<br>        <span class="hljs-built_in">super</span>(authenticationManager);<br>        <span class="hljs-built_in">this</span>.tokenManager = tokenManager;<br>        <span class="hljs-built_in">this</span>.redisTemplate = redisTemplate;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilterInternal</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, FilterChain chain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException &#123;<br>        <span class="hljs-comment">// 获取当前认证成功用户权限信息</span><br>        <span class="hljs-type">UsernamePasswordAuthenticationToken</span> <span class="hljs-variable">authenticationToken</span> <span class="hljs-operator">=</span> getAuthentication(request);<br>        <span class="hljs-comment">// 判断如果有权限信息, 放到权限上下文中</span><br>        <span class="hljs-keyword">if</span> (authenticationToken != <span class="hljs-literal">null</span>) &#123;<br>            SecurityContextHolder.getContext().setAuthentication(authenticationToken);<br>        &#125;<br>        chain.doFilter(request, response);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> UsernamePasswordAuthenticationToken <span class="hljs-title function_">getAuthentication</span><span class="hljs-params">(HttpServletRequest request)</span> &#123;<br>        <span class="hljs-comment">// 从header获取token</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> request.getHeader(<span class="hljs-string">&quot;token&quot;</span>);<br>        <span class="hljs-keyword">if</span> (token != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">// 从token获取用户名</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> tokenManager.getUserInfoFromToken(token);<br><br>            <span class="hljs-comment">// 从redis获取对应权限列表</span><br>            List&lt;String&gt; permissionValueList = (List&lt;String&gt;) redisTemplate.opsForValue().get(username);<br>            ArrayList&lt;GrantedAuthority&gt; authorities = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>            <span class="hljs-keyword">for</span> (String permissionValue : permissionValueList) &#123;<br>                <span class="hljs-type">SimpleGrantedAuthority</span> <span class="hljs-variable">simpleGrantedAuthority</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleGrantedAuthority</span>(permissionValue);<br>                authorities.add(simpleGrantedAuthority);<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UsernamePasswordAuthenticationToken</span>(username, token, authorities);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>编写TokenWebSecurityConfig</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TokenWebSecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WebSecurityConfigurerAdapter</span> &#123;<br>    <span class="hljs-keyword">private</span> TokenManager tokenManager;<br>    <span class="hljs-keyword">private</span> RedisTemplate redisTemplate;<br>    <span class="hljs-keyword">private</span> DefaultPasswordEncoder defaultPasswordEncoder;<br>    <span class="hljs-keyword">private</span> UserDetailsService userDetailsService;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">TokenWebSecurityConfig</span><span class="hljs-params">(UserDetailsService userDetailsService,</span><br><span class="hljs-params">                                        DefaultPasswordEncoder defaultPasswordEncoder,</span><br><span class="hljs-params">                                        TokenManager tokenManager,</span><br><span class="hljs-params">                                        RedisTemplate redisTemplate)</span> &#123;<br>        <span class="hljs-built_in">this</span>.userDetailsService = userDetailsService;<br>        <span class="hljs-built_in">this</span>.defaultPasswordEncoder = defaultPasswordEncoder;<br>        <span class="hljs-built_in">this</span>.tokenManager = tokenManager;<br>        <span class="hljs-built_in">this</span>.redisTemplate = redisTemplate;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        http.exceptionHandling()<br>                .authenticationEntryPoint(<span class="hljs-keyword">new</span> <span class="hljs-title class_">UnauthorizedEntryPoint</span>())     <span class="hljs-comment">// 没有访问权限</span><br>                .and().csrf().disable()<br>                .authorizeRequests()<br>                .anyRequest().authenticated()<br>                .and().logout().logoutUrl(<span class="hljs-string">&quot;/admin/acl/index/logout&quot;</span>)        <span class="hljs-comment">// 退出路径</span><br>                .addLogoutHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TokenLogoutHandler</span>(tokenManager, redisTemplate))<br>                .and().addFilter(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TokenLoginFilter</span>(authenticationManager(), tokenManager, redisTemplate))<br>                .addFilter(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TokenAuthFilter</span>(authenticationManager(), tokenManager, redisTemplate))<br>                .httpBasic();<br>    &#125;<br><br>    <span class="hljs-comment">// 调用userDetailsService和密码处理</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        auth.userDetailsService(userDetailsService).passwordEncoder(defaultPasswordEncoder);<br>    &#125;<br><br>    <span class="hljs-comment">// 不进行认证的路径, 可以直接访问</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(WebSecurity web)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        web.ignoring().antMatchers(<span class="hljs-string">&quot;/api/**&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="编写UserDetailService"><a href="#编写UserDetailService" class="headerlink" title="编写UserDetailService"></a>编写UserDetailService</h4><p>复制aclservice模块, 太多了, 就不想粘贴了QAQ<br><img src="/assets/2023-06-04-20-18-40.png"></p><p>编写UserDetailService</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDetailServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserDetailsService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserService userService;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> PermissionService permissionService;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> UserDetails <span class="hljs-title function_">loadUserByUsername</span><span class="hljs-params">(String username)</span> <span class="hljs-keyword">throws</span> UsernameNotFoundException &#123;<br>        <span class="hljs-comment">// 根据用户名查询数据</span><br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userService.selectByUsername(username);<br><br>        <span class="hljs-comment">// 判断</span><br>        <span class="hljs-keyword">if</span> (user == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UsernameNotFoundException</span>(<span class="hljs-string">&quot;用户不存在! &quot;</span>);<br>        &#125;<br><br>        com.atguigu.entity.<span class="hljs-type">User</span> <span class="hljs-variable">curUser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">com</span>.atguigu.entity.User();<br>        BeanUtils.copyProperties(user, curUser);<br><br>        <span class="hljs-comment">// 根据用户查询用户权限列表</span><br>        List&lt;String&gt; permissionValueList = permissionService.selectPermissionValueByUserId(user.getId());<br>        <span class="hljs-type">SecurityUser</span> <span class="hljs-variable">securityUser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecurityUser</span>();<br>        securityUser.setCurrentUserInfo(curUser);<br>        securityUser.setPermissionValueList(permissionValueList);<br>        <span class="hljs-keyword">return</span> securityUser;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="整合网关"><a href="#整合网关" class="headerlink" title="整合网关"></a>整合网关</h4><p><img src="/assets/2023-06-04-21-09-36.png"></p><p>启动类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableDiscoveryClient</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiGatewayApplication</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(ApiGatewayApplication.class, args);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>解决跨域</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CorsConfig</span> &#123;<br><br>    <span class="hljs-comment">// 解决跨域</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> CorsWebFilter <span class="hljs-title function_">corsWebFilter</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">CorsConfiguration</span> <span class="hljs-variable">corsConfiguration</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CorsConfiguration</span>();<br>        corsConfiguration.addAllowedHeader(<span class="hljs-string">&quot;*&quot;</span>);<br>        corsConfiguration.addAllowedMethod(<span class="hljs-string">&quot;*&quot;</span>);<br>        corsConfiguration.addAllowedOrigin(<span class="hljs-string">&quot;*&quot;</span>);<br><br>        <span class="hljs-type">UrlBasedCorsConfigurationSource</span> <span class="hljs-variable">source</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UrlBasedCorsConfigurationSource</span>(<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">PathPatternParser</span>());<br>        source.registerCorsConfiguration(<span class="hljs-string">&quot;/**&quot;</span>, corsConfiguration);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CorsWebFilter</span>(source);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="整合前端"><a href="#整合前端" class="headerlink" title="整合前端"></a>整合前端</h4><p>修改dev.env.js<br><img src="/assets/2023-06-04-21-22-16.png"></p><p>安装node-sass</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install --save node-sass<br>npm run start<br></code></pre></td></tr></table></figure><blockquote><p>这里用时的node 版本是14版本<br>node -v<br>v14.21.3</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SpringSecurity</tag>
      
      <tag>Spring</tag>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>git保存密码</title>
    <link href="/git/git%E4%BF%9D%E5%AD%98%E5%AF%86%E7%A0%81/"/>
    <url>/git/git%E4%BF%9D%E5%AD%98%E5%AF%86%E7%A0%81/</url>
    
    <content type="html"><![CDATA[<p>git每次提交代码都要输入一次密码, 这太麻烦了, 可以在.git&#x2F;config中添加配置</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[credential]</span><br>    <span class="hljs-attr">helper</span> = store<br></code></pre></td></tr></table></figure><p>完整代码</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[core]</span><br><span class="hljs-attr">repositoryformatversion</span> = <span class="hljs-number">0</span><br><span class="hljs-attr">filemode</span> = <span class="hljs-literal">false</span><br><span class="hljs-attr">bare</span> = <span class="hljs-literal">false</span><br><span class="hljs-attr">logallrefupdates</span> = <span class="hljs-literal">true</span><br><span class="hljs-attr">symlinks</span> = <span class="hljs-literal">false</span><br><span class="hljs-attr">ignorecase</span> = <span class="hljs-literal">true</span><br><span class="hljs-section">[remote &quot;origin&quot;]</span><br><span class="hljs-attr">url</span> = https://gitee.com/xialonggui/yygh-admin.git<br><span class="hljs-attr">fetch</span> = +refs/heads/*:refs/remotes/origin/*<br><span class="hljs-section">[branch &quot;master&quot;]</span><br><span class="hljs-attr">remote</span> = origin<br><span class="hljs-attr">merge</span> = refs/heads/master<br><span class="hljs-section">[credential]</span><br>    <span class="hljs-attr">helper</span> = store<br><br></code></pre></td></tr></table></figure><p>参考: </p><ul><li>git设置用户名密码 <a href="https://blog.csdn.net/qq_15437667/article/details/51029757">https://blog.csdn.net/qq_15437667/article/details/51029757</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>git</category>
      
    </categories>
    
    
    <tags>
      
      <tag>git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo+github图片问题</title>
    <link href="/hexo/Hexo+github%E5%9B%BE%E7%89%87%E9%97%AE%E9%A2%98/"/>
    <url>/hexo/Hexo+github%E5%9B%BE%E7%89%87%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<p>当本地插入图片时, 本地是可以预览的, 当部署到web页面的时候, 这张图片就预览不了了</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown">![](<span class="hljs-link">/source/assets/笔芯.png</span>)<br></code></pre></td></tr></table></figure><p><img src="/assets/%E7%AC%94%E8%8A%AF.png"></p><p>如果想让web页面预览, 路径就应该修改成如下样子, 此时本地不能预览</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown">![](<span class="hljs-link">/assets/笔芯.png</span>)<br></code></pre></td></tr></table></figure><p><img src="/assets/%E7%AC%94%E8%8A%AF.png"></p><p>难道鱼和熊掌二者不可兼得?</p><p>后来找到一篇文章描述的也是这个<a href="https://www.jianshu.com/p/bbbcbb7c4911">问题</a></p><p>解决办法就是引入第三方的插件, 然后手动的修改一下插件</p><p>插件下载</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install hexo-renderer-marked --save<br></code></pre></td></tr></table></figure><p><img src="/assets/2023-05-19-11-37-31.png"></p><p>然后定位到118行, 修改如下代码<br><img src="/assets/2023-05-19-11-38-13.png"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">0</span>, href);<br><span class="hljs-keyword">if</span> (href.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&quot;/source&quot;</span>) &gt; -<span class="hljs-number">1</span>) &#123;<br>  href = href.<span class="hljs-title function_">replace</span>(<span class="hljs-string">&quot;/source&quot;</span>, <span class="hljs-string">&quot;&quot;</span>)<br>&#125;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">1</span>, href);<br></code></pre></td></tr></table></figure><p>此时部署到web, 问题解决</p><p>另外推荐一款插件, 可以快速将图片进行插入, 只需要按下快捷键 <code>Ctrl Alt V</code> 就能把剪切板的图片插入</p><p>插件名叫<code>Paste Image</code></p><p><img src="/assets/2023-05-19-11-47-37.png"></p><p>安装插件之后进行配置</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;pasteImage.path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;$&#123;projectRoot&#125;/source/assets&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;pasteImage.basePath&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;$&#123;projectRoot&#125;&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;pasteImage.prefix&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/&quot;</span><br></code></pre></td></tr></table></figure><p>大致就是配置三处</p><ul><li>basePath配置成${projectRoot}</li><li>path设置成${projectRoot}&#x2F;source&#x2F;assets</li><li>prefix设置成&#x2F;</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># basePath设置成currentFileDir的效果</span><br>![](<span class="hljs-link">/../assets/2023-05-19-11-53-14.png</span>)<br><span class="hljs-section"># basePath设置成projectRoot的效果</span><br>![](<span class="hljs-link">/source/assets/2023-05-19-11-53-32.png</span>)<br><br>一个是展示的是项目的路径, 另一个展示的相对路径<br><br>path这个是图片存储的路径$&#123;projectRoot&#125;/source/assets<br><br>prefix这个就是图片的前缀啦<br>设置前<br>![](<span class="hljs-link">source/assets/2023-05-19-11-53-32.png</span>)<br>设置之后<br>![](<span class="hljs-link">/source/assets/2023-05-19-11-53-32.png</span>)<br></code></pre></td></tr></table></figure><p>具体含义可以参考<a href="https://github.com/mushanshitiancai/vscode-paste-image">官方文档</a></p><blockquote><p>但是这将会在typora上无法预览, 没有别的办法兼容太多的平台…<br>除非是使用cdn外链了, 要不然想不到更好的办法解决</p></blockquote><h4 id="参考"><a href="#参考" class="headerlink" title="参考:"></a>参考:</h4><ul><li>图片路径问题 <a href="https://www.jianshu.com/p/bbbcbb7c4911">https://www.jianshu.com/p/bbbcbb7c4911</a></li><li>Hexo官网-资源文件夹 <a href="https://hexo.io/zh-cn/docs/asset-folders.html">https://hexo.io/zh-cn/docs/asset-folders.html</a></li><li>Paste Image插件 <a href="https://github.com/mushanshitiancai/vscode-paste-image">https://github.com/mushanshitiancai/vscode-paste-image</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>hexo</tag>
      
      <tag>github</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>开启run dashboard</title>
    <link href="/idea/%E5%BC%80%E5%90%AFrun-dashboard/"/>
    <url>/idea/%E5%BC%80%E5%90%AFrun-dashboard/</url>
    
    <content type="html"><![CDATA[<p>在.idea&#x2F;workspace.xml中随便找个位置添加如下代码</p><p>然后重启idea</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">component</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;RunDashboard&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;configurationTypes&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">set</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;SpringBootApplicationConfigurationType&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">set</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;ruleStates&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">RuleState</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;ConfigurationTypeDashboardGroupingRule&quot;</span> /&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">RuleState</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">RuleState</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;StatusDashboardGroupingRule&quot;</span> /&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">RuleState</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">component</span>&gt;</span><br></code></pre></td></tr></table></figure><p>效果图<br><img src="/assets/2023-05-19-10-23-15.png"></p>]]></content>
    
    
    <categories>
      
      <category>idea</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Spring</tag>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>云原生实战</title>
    <link href="/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%AE%9E%E6%88%98/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%AE%9E%E6%88%98/"/>
    <url>/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%AE%9E%E6%88%98/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%AE%9E%E6%88%98/</url>
    
    <content type="html"><![CDATA[<h2 id="云平台"><a href="#云平台" class="headerlink" title="云平台"></a>云平台</h2><p>上<a href="https://aliyun.com/">阿里云</a>购买服务器 , 直接选购按量付费</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 安装nginx</span><br>yum install nginx<br>systemctl start nginx<br><br><span class="hljs-comment"># 设置开机自启动</span><br>systemctl <span class="hljs-built_in">enable</span> nginx<br><br><span class="hljs-comment"># 记得启动完成nginx之后需要在安全组与之对应的端口放开, 否则就无法访问</span><br></code></pre></td></tr></table></figure><p>关闭所有端口<br><img src="/assets/a5710bfafab847aa88e66a7cfc7d2761.png"></p><h2 id="容器化"><a href="#容器化" class="headerlink" title="容器化"></a>容器化</h2><h2 id="VPC私有网络"><a href="#VPC私有网络" class="headerlink" title="VPC私有网络"></a>VPC私有网络</h2><p>同一VPC下的网络是互通的, 不同的VPC下的网络不是互通的<br><img src="/assets/5980f7c1ed5847a5924ccf85f534a2ff.png"><br><img src="/assets/d8f4b5716fa14696a596175ad0bab66d.png"><br>直接购买三台服务器<img src="/assets/1556da2698224265af925b6a4b97a731.png"><br>为多台服务器分配私有VPC, 选择刚刚创建的私有网络, 记得要勾选分配IPv4地址<br><img src="/assets/300432a7daf5406e811a567b17d09c04.png"></p><p>三台服务器的在私网都是互通的<br><img src="/assets/9e2e17c607004aed9e4b351ebf9f0dd1.png"><br><img src="/assets/cf9aa19710594e62a729fe863dec6380.png"></p><h2 id="Docker配置"><a href="#Docker配置" class="headerlink" title="Docker配置"></a>Docker配置</h2><p>移除以前的docker</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo yum remove docker \<br>                  docker-client \<br>                  docker-client-latest \<br>                  docker-common \<br>                  docker-latest \<br>                  docker-latest-logrotate \<br>                  docker-logrotate \<br>                  docker-engine<br></code></pre></td></tr></table></figure><p>配置yum源</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo yum install -y yum-utils<br>sudo yum-config-manager \<br>--add-repo \<br>http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo<br></code></pre></td></tr></table></figure><p>安装docker</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo yum install -y docker-ce docker-ce-cli containerd.io<br><br><br><span class="hljs-comment">#以下是在安装k8s的时候使用</span><br>yum install -y docker-ce-20.10.7 docker-ce-cli-20.10.7  containerd.io-1.4.6<br></code></pre></td></tr></table></figure><p>启动</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl <span class="hljs-built_in">enable</span> docker --now<br></code></pre></td></tr></table></figure><p>配置<a href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors">阿里云</a>加速器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo <span class="hljs-built_in">mkdir</span> -p /etc/docker<br>sudo <span class="hljs-built_in">tee</span> /etc/docker/daemon.json &lt;&lt;-<span class="hljs-string">&#x27;EOF&#x27;</span><br>&#123;<br>  <span class="hljs-string">&quot;registry-mirrors&quot;</span>: [<span class="hljs-string">&quot;https://ylmjgfp5.mirror.aliyuncs.com&quot;</span>]<br>&#125;<br>EOF<br>sudo systemctl daemon-reload<br>sudo systemctl restart docker<br></code></pre></td></tr></table></figure><h2 id="搭建Kubernetes集群"><a href="#搭建Kubernetes集群" class="headerlink" title="搭建Kubernetes集群"></a>搭建Kubernetes集群</h2><p>创建一个VPC私有网络<br><img src="/assets/77871e7edb6e4aa299773c6fa67d4acc.png"><br>创建交换机<br><img src="/assets/d525b2b4d4814177bc358049765ffa41.png"><br>12345Xia<br>创建三台服务器实例<br><img src="/assets/189ceae3b5ab4dd693d26898f9204889.png"></p><h3 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h3><p>基础环境, 每一台机器都要执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 各个机器设置自己的域名</span><br>hostnamectl set-hostname k8s-node1<br>hostnamectl set-hostname k8s-node2<br>hostnamectl set-hostname k8s-master<br><br><span class="hljs-comment"># 将 SELinux 设置为 permissive 模式（相当于将其禁用）</span><br>sudo setenforce 0<br>sudo sed -i <span class="hljs-string">&#x27;s/^SELINUX=enforcing$/SELINUX=permissive/&#x27;</span> /etc/selinux/config<br><br><span class="hljs-comment">#关闭swap</span><br>swapoff -a  <br>sed -ri <span class="hljs-string">&#x27;s/.*swap.*/#&amp;/&#x27;</span> /etc/fstab<br><br><span class="hljs-comment">#允许 iptables 检查桥接流量</span><br><span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF | sudo tee /etc/modules-load.d/k8s.conf</span><br><span class="hljs-string">br_netfilter</span><br><span class="hljs-string">EOF</span><br><br><span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF | sudo tee /etc/sysctl.d/k8s.conf</span><br><span class="hljs-string">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="hljs-string">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="hljs-string">EOF</span><br>sudo sysctl --system<br></code></pre></td></tr></table></figure><h3 id="安装kubelet、kubeadm、kubectl"><a href="#安装kubelet、kubeadm、kubectl" class="headerlink" title="安装kubelet、kubeadm、kubectl"></a>安装kubelet、kubeadm、kubectl</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF | sudo tee /etc/yum.repos.d/kubernetes.repo</span><br><span class="hljs-string">[kubernetes]</span><br><span class="hljs-string">name=Kubernetes</span><br><span class="hljs-string">baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64</span><br><span class="hljs-string">enabled=1</span><br><span class="hljs-string">gpgcheck=0</span><br><span class="hljs-string">repo_gpgcheck=0</span><br><span class="hljs-string">gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg</span><br><span class="hljs-string">   http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="hljs-string">exclude=kubelet kubeadm kubectl</span><br><span class="hljs-string">EOF</span><br><br><br>sudo yum install -y kubelet-1.20.9 kubeadm-1.20.9 kubectl-1.20.9 --disableexcludes=kubernetes<br><br>sudo systemctl <span class="hljs-built_in">enable</span> --now kubelet<br></code></pre></td></tr></table></figure><blockquote><p>kubelet 现在每隔几秒就会重启，因为它陷入了一个等待 kubeadm 指令的死循环</p></blockquote><p>使用<code>systemctl status kubelet</code>查看状态, 一会重启, 一起启动<br><img src="/assets/c7541d480f85442c81f62ebfc122845c.png"></p><h3 id="初始化主节点"><a href="#初始化主节点" class="headerlink" title="初始化主节点"></a>初始化主节点</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#所有机器添加master域名映射，以下需要修改为自己的</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;172.31.0.204  cluster-endpoint&quot;</span> &gt;&gt; /etc/hosts<br><br><br><br><span class="hljs-comment">#主节点初始化(只要主节点输入这段命令, 其他节点不需要输入)</span><br>kubeadm init \<br>--apiserver-advertise-address=172.31.0.204 \<br>--control-plane-endpoint=cluster-endpoint \<br>--image-repository registry.cn-hangzhou.aliyuncs.com/lfy_k8s_images \<br>--kubernetes-version v1.20.9 \<br>--service-cidr=10.96.0.0/16 \<br>--pod-network-cidr=192.168.0.0/16<br><br><span class="hljs-comment">#所有网络范围不重叠</span><br></code></pre></td></tr></table></figure><p>下载完成之后主节点会出现如下内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">Your Kubernetes control-plane has initialized successfully!<br><br>To start using your cluster, you need to run the following as a regular user:<br><br>  <span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$HOME</span>/.kube<br>  sudo <span class="hljs-built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="hljs-variable">$HOME</span>/.kube/config<br>  sudo <span class="hljs-built_in">chown</span> $(<span class="hljs-built_in">id</span> -u):$(<span class="hljs-built_in">id</span> -g) <span class="hljs-variable">$HOME</span>/.kube/config<br><br>Alternatively, <span class="hljs-keyword">if</span> you are the root user, you can run:<br><br>  <span class="hljs-built_in">export</span> KUBECONFIG=/etc/kubernetes/admin.conf<br><br>You should now deploy a pod network to the cluster.<br>Run <span class="hljs-string">&quot;kubectl apply -f [podnetwork].yaml&quot;</span> with one of the options listed at:<br>  https://kubernetes.io/docs/concepts/cluster-administration/addons/<br><br>You can now <span class="hljs-built_in">join</span> any number of control-plane nodes by copying certificate authorities<br>and service account keys on each node and <span class="hljs-keyword">then</span> running the following as root:<br><br>  kubeadm <span class="hljs-built_in">join</span> cluster-endpoint:6443 --token 1zh4aw.zsett7epmg4ka8g6 \<br>    --discovery-token-ca-cert-hash sha256:ac3d763eeb14a03d137c501f392346773b9a5e36d2b262789aa4c98d1c27dda6 \<br>    --control-plane <br><br>Then you can <span class="hljs-built_in">join</span> any number of worker nodes by running the following on each as root:<br><br>kubeadm <span class="hljs-built_in">join</span> cluster-endpoint:6443 --token 1zh4aw.zsett7epmg4ka8g6 \<br>    --discovery-token-ca-cert-hash sha256:ac3d763eeb14a03d137c501f392346773b9a5e36d2b262789aa4c98d1c27dda6 <br></code></pre></td></tr></table></figure><p><img src="/assets/a96bbb9709c84ed6abbd5ed26c238233.png"></p><p>然后在主节点输入</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$HOME</span>/.kube<br>sudo <span class="hljs-built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="hljs-variable">$HOME</span>/.kube/config<br>sudo <span class="hljs-built_in">chown</span> $(<span class="hljs-built_in">id</span> -u):$(<span class="hljs-built_in">id</span> -g) <span class="hljs-variable">$HOME</span>/.kube/config<br></code></pre></td></tr></table></figure><p>常用命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#查看集群所有节点</span><br>kubectl get nodes<br><br><span class="hljs-comment">#根据配置文件，给集群创建资源</span><br>kubectl apply -f xxxx.yaml<br><br><span class="hljs-comment">#查看集群部署了哪些应用？</span><br>docker ps   ===   kubectl get pods -A<br><span class="hljs-comment"># 运行中的应用在docker里面叫容器，在k8s里面叫Pod</span><br><span class="hljs-comment"># 查看运行的pod</span><br>kubectl get pods -A<br></code></pre></td></tr></table></figure><p>安装网络组件(主节点输入)<br><a href="https://docs.tigera.io/calico/latest/getting-started/kubernetes/self-managed-onprem/onpremises#install-calico-with-kubernetes-api-datastore-more-than-50-nodes">calico</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl https://docs.projectcalico.org/v3.20/manifests/calico.yaml -O<br><br>kubectl apply -f calico.yaml<br><br><span class="hljs-comment"># 查看运行的pod</span><br>kubectl get pods -A<br></code></pre></td></tr></table></figure><p>加入主节点(node1, node2输入)</p><blockquote><p>这行命令在24小时有效<br>新令牌(可以重新生成最新的令牌)<br>kubeadm token create –print-join-command</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubeadm <span class="hljs-built_in">join</span> cluster-endpoint:6443 --token 1zh4aw.zsett7epmg4ka8g6 \<br>    --discovery-token-ca-cert-hash sha256:ac3d763eeb14a03d137c501f392346773b9a5e36d2b262789aa4c98d1c27dda6 <br></code></pre></td></tr></table></figure><p>然后在主节点查看一下所有的节点</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 查看一下所有的节点</span><br>kubectl get nodes<br><br><span class="hljs-comment"># 查看一下应用状态</span><br>kubectl get pod -A<br></code></pre></td></tr></table></figure><p>补充一个linux命令, 每一秒刷新一次查看应用的状态</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">watch -n 1 kubectl get pod -A<br></code></pre></td></tr></table></figure><p>集群的自我修复能力测试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 重启云服务器</span><br>reboot<br><br><span class="hljs-comment"># 再次查看状态</span><br>kubectl get pod -A<br></code></pre></td></tr></table></figure><p><img src="/assets/25797a742c4248e587c51afda9d17cd1.png"></p><p>部署dashboard</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.3.1/aio/deploy/recommended.yaml<br></code></pre></td></tr></table></figure><p>设置访问端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl edit svc kubernetes-dashboard -n kubernetes-dashboard<br></code></pre></td></tr></table></figure><p>将 type: ClusterIP 改为 type: NodePort</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl get svc -A |grep kubernetes-dashboard<br><span class="hljs-comment">## 找到端口，在安全组放行</span><br></code></pre></td></tr></table></figure><p><img src="/assets/b9019914051a494380912d606729a4aa.png"><br>需要在安全组中放行30077端口<br><img src="/assets/4e2aaf67b797461e9fea414c3bc1ff40.png"><br>访问： https:&#x2F;&#x2F;集群任意IP:端口      <a href="https://47.106.11.25:30077/">https://47.106.11.25:30077</a></p><p>如果chrome出现了<strong>你的连接不是专用连接</strong><br>可以在页面输入<code>thisisunsafe</code><br><a href="https://blog.csdn.net/sdfsdfasfddsafwesd/article/details/109379788">你的连接不是专用连接的解决办法</a></p><p>创建访问账号</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment">#创建访问账号，准备一个yaml文件； vi dash.yaml</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ServiceAccount</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">admin-user</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">kubernetes-dashboard</span><br><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">rbac.authorization.k8s.io/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRoleBinding</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">admin-user</span><br><span class="hljs-attr">roleRef:</span><br>  <span class="hljs-attr">apiGroup:</span> <span class="hljs-string">rbac.authorization.k8s.io</span><br>  <span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRole</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">cluster-admin</span><br><span class="hljs-attr">subjects:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">kind:</span> <span class="hljs-string">ServiceAccount</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">admin-user</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">kubernetes-dashboard</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl apply -f dash.yaml<br></code></pre></td></tr></table></figure><p>获取令牌</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#获取访问令牌</span><br>kubectl -n kubernetes-dashboard get secret $(kubectl -n kubernetes-dashboard get sa/admin-user -o jsonpath=<span class="hljs-string">&quot;&#123;.secrets[0].name&#125;&quot;</span>) -o go-template=<span class="hljs-string">&quot;&#123;&#123;.data.token | base64decode&#125;&#125;&quot;</span><br></code></pre></td></tr></table></figure><p>token</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">eyJhbGciOiJSUzI1NiIsImtpZCI6IjVTb0ItUllsSEU5cjZkbXg0RlVEMmlnQnRHRzJLcHRDOFBXVi1yX3VxZEkifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJhZG1pbi11c2VyLXRva2VuLWpocnd6Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImFkbWluLXVzZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiIxNDc0YTFlZS03NGE5LTRjZWUtOWZjNS1lNjU2Y2I0ZmE4NjYiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZXJuZXRlcy1kYXNoYm9hcmQ6YWRtaW4tdXNlciJ9.cIVZrURSJXK9iTy9CM5lH5PbyqOihS1w61sgqiIF0bAfjpNrqBqlbniZXKWKcbtwEjiK5OVI7XWWgKgW7sCMkEVU_vpbOqwu62JuhLJDAXE1KBKruz-UW4PfTzYENCCTfdCozngLBok0VTEsyB9GRH_V3n1mhBKpsc3Ya0wstXH2u9nyDx4nOZkmy9PrWZXY9WIVFlN9OQ-1BouW_RtFE69sMxAcL2p2wpW-qlr76kgNOUD8oghS1BkAETKkRlChQEZKuWYlORpvy56JphZXIrGYPIVOfl0FALxb7baLkiahYS5UiZNvTMvmO0ii6OaSpZXY_blwMvBubU5B3s_g0A<br></code></pre></td></tr></table></figure><p>dashboard<br><img src="/assets/b96766ad39744f088eed4bd226e4ea48.png"></p><h2 id="云原生实战"><a href="#云原生实战" class="headerlink" title="云原生实战"></a>云原生实战</h2><h3 id="命名空间"><a href="#命名空间" class="headerlink" title="命名空间"></a>命名空间</h3><p>使用命令创建命名空间</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 查看命名空间</span><br>kubectl get ns<br>kubectl get namespace<br><br><span class="hljs-comment"># 查看所有应用</span><br>kubectl get pods -A<br><span class="hljs-comment"># 这个查看的是default的应用</span><br>kubectl get pods<br><br><span class="hljs-comment"># 查看pod</span><br>kubectl get pod -n kubernetes-dashboard<br><br><span class="hljs-comment"># 创建命名空间</span><br>kubectl create ns hello<br>kubectl get ns<br><br><span class="hljs-comment"># 删除命名空间</span><br>kubectl delete ns hello<br><br></code></pre></td></tr></table></figure><p>使用yaml的方式创建</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 通过yaml的方式创建命名空间</span><br>vi hello.yaml<br><br>apiVersion: v1<br>kind: Namespace<br>metadata:<br>  name: hello<br><br>kubectl apply -f hello.yaml<br><br><span class="hljs-comment"># 删除yaml方式创建的命名空间</span><br>kubectl delete -f hello.yaml <br></code></pre></td></tr></table></figure><h3 id="Pod"><a href="#Pod" class="headerlink" title="Pod"></a>Pod</h3><p>在kubernetes中运行的应用就叫pod<br>一个pod中可以运行多个容器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 创建nginx的pod</span><br>kubectl run mynginx --image=nginx<br><br><span class="hljs-comment"># 查看default的pod</span><br>kubectl get pod<br><br><span class="hljs-comment"># 查看所有的pod</span><br>kubectl get pod -A<br><br><span class="hljs-comment"># 也可以指定查看default的pod, 不指定默认查看的就是default</span><br>kubectl get pod -n default<br><br><span class="hljs-comment"># 描述mynginx的详细信息</span><br>kubectl describe pod mynginx<br><br>Events:<br>  Type    Reason     Age    From               Message<br>  ----    ------     ----   ----               -------<br>  Normal  Scheduled  7m29s  default-scheduler  Successfully assigned default/mynginx to k8s-node2<br>  Normal  Pulling    7m28s  kubelet            Pulling image <span class="hljs-string">&quot;nginx&quot;</span><br>  Normal  Pulled     7m20s  kubelet            Successfully pulled image <span class="hljs-string">&quot;nginx&quot;</span> <span class="hljs-keyword">in</span> 8.585906172s<br>  Normal  Created    7m19s  kubelet            Created container mynginx<br>  Normal  Started    7m19s  kubelet            Started container mynginx<br><span class="hljs-comment"># 这里Scheduled说明了nginx创建在了k8s-node2</span><br><br><span class="hljs-comment"># STATUS显示Running表示创建的应用正在运行了</span><br>[root@k8s-master ~]<span class="hljs-comment"># kubectl get pod </span><br>NAME      READY   STATUS    RESTARTS   AGE<br>mynginx   1/1     Running   0          3m47s<br><br><span class="hljs-comment"># 到k8s-node2上查看nginx容器</span><br>docker ps | grep mynginx<br><br><span class="hljs-comment"># 删除pod</span><br>kubectl delete pod mynginx<br><span class="hljs-comment"># 完整的写法可以指定命名空间</span><br>kubectl delete pod mynginx -n xxx<br><br><span class="hljs-comment"># 查看日志</span><br>kubectl logs mynginx<br><span class="hljs-comment"># 持续监控日志</span><br>kubectl logs -f mynginx<br><br><span class="hljs-comment"># 查看更完善的信息, 可以查看应用运行的IP</span><br><span class="hljs-comment"># 每一个pod - k8s都会分配一个ip</span><br>kubectl get pod -owide<br>kubectl get pod -o wide<br>NAME      READY   STATUS    RESTARTS   AGE     IP                NODE        NOMINATED NODE   READINESS GATES<br>mynginx   1/1     Running   0          3m38s   192.168.169.133   k8s-node2   &lt;none&gt;           &lt;none&gt;<br><br><span class="hljs-comment"># 使用pod的ip+pod里面运行容器的端口</span><br><span class="hljs-comment"># 请求一下IP(任何一个k8s都可以请求)</span><br>curl 192.168.169.133 <br><br><span class="hljs-comment"># 进入容器</span><br>kubectl <span class="hljs-built_in">exec</span> -it mynginx -- /bin/bash<br><br><span class="hljs-comment"># 随便改点啥</span><br><span class="hljs-built_in">cd</span> /usr/share/nginx/html/<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;roudoukouya&quot;</span> &gt; index.html <br><span class="hljs-built_in">exit</span><br>[root@k8s-master ~]<span class="hljs-comment"># curl 192.168.169.133</span><br>roudoukouya<br></code></pre></td></tr></table></figure><p>使用yaml方式创建</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">vi pod.yaml<br><br>apiVersion: v1<br>kind: Pod<br>metadata:<br>  labels:<br>    run: mynginx<br>  name: mynginx<br>spec:<br>  containers:<br>  - image: nginx<br>    name: mynginx<br><br><span class="hljs-comment"># 创建</span><br>kubectl apply -f pod.yaml<br><br><span class="hljs-comment"># 描述, 这次容器还是创建在了node2上</span><br>kubectl describe pod mynginx<br> Normal  Scheduled  72s   default-scheduler  Successfully assigned default/mynginx to k8s-node2<br><br><span class="hljs-comment"># 删除yaml</span><br>kubectl delete -f pod.yaml <br><br><span class="hljs-comment"># 再次查看一下</span><br>kubectl get pod<br><br></code></pre></td></tr></table></figure><p>web页面创建pod<br><img src="/assets/d881fb26d968469f9b676f1aa31f7831.png"><br>填写yaml创建, 点击上传<br><img src="/assets/ad54922c5d284c0a900e6346f472caa9.png"></p><p>多个容器的情况</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs bash">vi multicontainer-pod.yaml<br><br>apiVersion: v1<br>kind: Pod<br>metadata:<br>  labels:<br>    run: myapp<br>  name: myapp<br>spec:<br>  containers:<br>  - image: nginx<br>    name: nginx<br>  - image: tomcat:8.5.68<br>    name: tomcat<br><br><span class="hljs-comment"># 创建</span><br>kubectl apply -f multicontainer-pod.yaml <br><br><span class="hljs-comment"># 描述详细信息</span><br>kubectl describe pod myapp<br><br><span class="hljs-comment"># 查看容器分配的IP</span><br>kubectl get pod -o wide<br>curl 192.168.36.67:80<br>curl 192.168.36.67:8080<br><br><span class="hljs-comment"># 尝试创建两个nginx在同一个pod中</span><br>apiVersion: v1<br>kind: Pod<br>metadata:<br>  labels:<br>    run: myapp02<br>  name: myapp02<br>spec:<br>  containers:<br>  - image: nginx<br>    name: nginx01<br>  - image: nginx<br>    name: nginx02<br><br><span class="hljs-comment"># 查看pod, 显示error, 并且没有同时启动两个nginx</span><br>kubectl get pod<br>myapp02   1/2     Error     1          52s<br><br><span class="hljs-comment"># 查看日志, 很明显nginx02的要启动的端口被占用了, 所有nginx02启动不起来</span><br>kubectl logs myapp02 nginx01<br>kubectl logs myapp02 nginx02<br>(98: Address already <span class="hljs-keyword">in</span> use)<br></code></pre></td></tr></table></figure><h3 id="Deployment"><a href="#Deployment" class="headerlink" title="Deployment"></a>Deployment</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 先删除之前创建的pod</span><br>kubectl delete pod myapp myapp02 mynginx<br><br><span class="hljs-comment"># 创建nginx pod</span><br>kubectl run mynginx  --image=nginx<br><br>kubectl create deployment mytomcat --image=tomcat:8.5.68<br><br><span class="hljs-comment"># 监控pod</span><br>watch -n 1 kubectl get pod<br><br><span class="hljs-comment"># 删除刚刚创建的两个应用</span><br>kubectl delete pod mynginx<br>kubectl delete pod mytomcat-6f5f895f4f-6m68l<br>kubectl delete pod mytomcat-6f5f895f4f-bprxz<br><br><span class="hljs-comment"># 可以发现每一次删除tomcat, k8s都会再次创建出来一个新的应用</span><br><span class="hljs-comment"># k8s的自愈能力</span><br><br><span class="hljs-comment"># 删除由deployment创建的应用</span><br>kubectl get deploy<br>kubectl delete deploy mytomcat<br>kubectl delete deployment my-dep-01<br></code></pre></td></tr></table></figure><p>多副本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 创建多副本的应用, replicas指定副本的数量</span><br><span class="hljs-comment"># 这样可以创建多个应用, 平均分配在各个机器上</span><br>kubectl create deploy my-dep --image=nginx --replicas=3<br><br><span class="hljs-comment"># 查看完善信息</span><br>kubectl get pod -o wide<br></code></pre></td></tr></table></figure><p>使用web表单创建多副本<br><img src="/assets/db52c3e54aeb4e748d27d7db5060ad63.png"><br>也可以在web页面使用yaml创建</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">my-dep</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">my-dep</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">3</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">my-dep</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">my-dep</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">containers:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">image:</span> <span class="hljs-string">nginx</span><br>        <span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span><br></code></pre></td></tr></table></figure><p><img src="/assets/61990623f8c5494a909aee79d0c47ea4.png"></p><p>扩缩容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 创建</span><br>kubectl create deploy my-dep --image=nginx --replicas=3<br><br><span class="hljs-comment"># 扩缩容</span><br>kubectl scale deploy/my-dep --replicas=5<br>kubectl scale deploy/my-dep --replicas=2<br><br><span class="hljs-comment"># 监控</span><br>watch -n 1 kubectl get pod<br><br><span class="hljs-comment"># 获取deploy</span><br>kubectl get deploy<br>kubectl get deployment<br><br><span class="hljs-comment"># 修改yaml的方式来修改replicas副本数量</span><br>kubectl edit deploy my-dep<br><br>spec:<br>  progressDeadlineSeconds: 600<br>  replicas: 2<br><br><span class="hljs-comment"># 保存退出</span><br>:wq<br><br></code></pre></td></tr></table></figure><p><img src="/assets/8930fcf66052446891333dc3b2872324.png"></p><p>自愈&amp;故障转移</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># master节点</span><br>kubectl get pod -o wide<br>my-dep-5b7868d854-8dbvz  k8s-node1 ...<br><br><span class="hljs-comment"># 在node1查看</span><br>docker ps | grep my-dep-5b7868d854-8dbvz<br>66ba6931e335   nginx ...<br><br><span class="hljs-comment"># 停止这个容器</span><br>docker stop 66ba6931e335<br><span class="hljs-comment"># 可以发现, 虽然停止了容器, 但是过了一会, 容器就自愈又重启了</span><br><br><span class="hljs-comment"># 监控</span><br>kubectl get pod -w<br><br><span class="hljs-comment"># 然后将node1节点给关机, 五分钟之后就可以监控到会把node1中应用转移到了node2</span><br></code></pre></td></tr></table></figure><p>滚动更新</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 把yaml文件展示出来</span><br>kubectl get deploy my-dep -oyaml<br><br><span class="hljs-comment"># 监控</span><br>kubectl get pod -w<br><br><span class="hljs-comment"># 自动更新, 将会启动一个新的版本的容器, 然后停止旧版本的容器</span><br>kubectl <span class="hljs-built_in">set</span> image deploy/my-dep nginx=nginx:1.16.1 --record<br><br><span class="hljs-comment"># 再次查看yaml, nginx镜像被替换成了指定的版本</span><br>kubectl get deploy my-dep -oyaml<br>    spec:<br>      containers:<br>      - image: nginx:1.16.1<br></code></pre></td></tr></table></figure><p>版本回退</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 查看历史版本</span><br>kubectl rollout <span class="hljs-built_in">history</span> deployment/my-dep<br><br>REVISION  CHANGE-CAUSE<br>1         &lt;none&gt;<br>2         kubectl <span class="hljs-built_in">set</span> image deploy/my-dep nginx=nginx:1.16.1 --record=<span class="hljs-literal">true</span><br><br><span class="hljs-comment"># 回退到第一个版本</span><br>kubectl rollout undo deploy/my-dep --to-revision=1<br><br><span class="hljs-comment"># 查看当前nginx的版本, 此时是最新的nginx版本</span><br>kubectl get deploy/my-dep -oyaml | grep image<br><br>                f:imagePullPolicy: &#123;&#125;<br>                f:image: &#123;&#125;<br>      - image: nginx<br>        imagePullPolicy: Always<br><br><br></code></pre></td></tr></table></figure><p>工作负载<br><img src="/assets/f817227b8ed9434aa12a67d964b65e86.png"></p><h3 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h3><p>ClusterIP</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 查看容器的详细信息</span><br>kubectl get pod -owide<br><br><span class="hljs-comment"># 访问IP, 可以通过不同的IP访问到不同的nginx</span><br>[root@k8s-master ~]<span class="hljs-comment"># curl 192.168.36.95</span><br>3333<br>[root@k8s-master ~]<span class="hljs-comment"># curl 192.168.169.153</span><br>1111<br>[root@k8s-master ~]<span class="hljs-comment"># curl 192.168.36.94</span><br>2222<br><br><span class="hljs-comment"># 将应用内的nginx的80端口暴露出去到8000端口</span><br>kubectl expose deploy my-dep --port=8000 --target-port=80<br><br><span class="hljs-comment"># 查看一下CLUSTER-IP</span><br>kubectl get service<br><br><span class="hljs-comment"># 集群内访问CLUSTER-IP, 这个service会负载均衡将请求分配</span><br>[root@k8s-master ~]<span class="hljs-comment"># curl 10.96.69.174:8000</span><br>1111<br>[root@k8s-master ~]<span class="hljs-comment"># curl 10.96.69.174:8000</span><br>3333<br>[root@k8s-master ~]<span class="hljs-comment"># curl 10.96.69.174:8000</span><br>2222<br><br><span class="hljs-comment"># 同样的在容器内部也是也可以请求service IP的</span><br>root@my-dep-5b7868d854-74qft:/usr/share/nginx/html<span class="hljs-comment"># curl 10.96.69.174:8000</span><br>3333<br>root@my-dep-5b7868d854-74qft:/usr/share/nginx/html<span class="hljs-comment"># curl 10.96.69.174:8000</span><br>2222<br>root@my-dep-5b7868d854-74qft:/usr/share/nginx/html<span class="hljs-comment"># curl 10.96.69.174:8000</span><br>1111<br><br><span class="hljs-comment"># 在容器内部也可以通过域名来访问(域名的格式是 服务名.命名空间.svc)</span><br>root@my-dep-5b7868d854-74qft:/usr/share/nginx/html<span class="hljs-comment"># curl my-dep.default.svc:8000</span><br>3333<br>root@my-dep-5b7868d854-74qft:/usr/share/nginx/html<span class="hljs-comment"># curl my-dep.default.svc:8000</span><br>2222<br>root@my-dep-5b7868d854-74qft:/usr/share/nginx/html<span class="hljs-comment"># curl my-dep.default.svc:8000</span><br>1111<br><br><span class="hljs-comment"># 但是域名在k8s的终端上是不能访问的</span><br>[root@k8s-master ~]<span class="hljs-comment"># curl my-dep.default.svc:8000</span><br>curl: (6) Could not resolve host: my-dep.default.svc; Unknown error<br><br><span class="hljs-comment"># 创建mytomcat应用</span><br>kubectl create deploy my-tomcat --image=tomcat<br><br><span class="hljs-comment"># 查看service</span><br>kubectl get service<br><br><span class="hljs-comment"># 测试service的服务发现</span><br><span class="hljs-comment"># 将deployment缩放成2个容器, 再次curl测试, 此时就只会显示1111, 2222两种情况, </span><br><span class="hljs-comment"># 而不会显示3333</span><br>[root@k8s-master ~]<span class="hljs-comment"># curl 10.96.69.174:8000</span><br>1111<br>[root@k8s-master ~]<span class="hljs-comment"># curl 10.96.69.174:8000</span><br>2222<br><br><span class="hljs-comment"># 如果再缩放成3个容器, 再次curl测试, 这时, 将会出现</span><br>[root@k8s-master ~]<span class="hljs-comment"># curl 10.96.69.174:8000</span><br>1111<br>[root@k8s-master ~]<span class="hljs-comment"># curl 10.96.69.174:8000</span><br>2222<br>[root@k8s-master ~]<span class="hljs-comment"># curl 10.96.69.174:8000</span><br>...<br>&lt;p&gt;&lt;em&gt;Thank you <span class="hljs-keyword">for</span> using nginx.&lt;/em&gt;&lt;/p&gt;<br>...<br><br><br></code></pre></td></tr></table></figure><p>NodePort</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 查看service</span><br>kubectl get svc<br><br><span class="hljs-comment"># 删除service</span><br>kubectl delete svc my-dep<br><br><span class="hljs-comment"># 创建service为NodePort</span><br>kubectl expose deploy my-dep --port=8000 --target-port=80 --<span class="hljs-built_in">type</span>=NodePort<br><br><span class="hljs-comment"># 查看应用是否启动</span><br>kubectl get pod<br><br><span class="hljs-comment"># 查看service的IP</span><br>kubectl get service<br><br></code></pre></td></tr></table></figure><p>NodePort范围在 30000-32767 之间<br><img src="/assets/c9283379e2694ec0b2d6f9605682b0ad.png"><br><img src="/assets/243f23a107724730980359bd7e207430.png"><br>每个浏览器访问的服务器的结果不一致, 这是由负载均衡平均分配的请求</p><h3 id="Ingress"><a href="#Ingress" class="headerlink" title="Ingress"></a>Ingress</h3><p><img src="/assets/d3d6f73df5954644b8099c1e9ddf907c.png"><br>安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v0.47.0/deploy/static/provider/baremetal/deploy.yaml<br><br><span class="hljs-comment">#修改镜像</span><br>vi deploy.yaml<br><span class="hljs-comment">#将image的值改为如下值：</span><br>registry.cn-hangzhou.aliyuncs.com/lfy_k8s_images/ingress-nginx-controller:v0.46.0<br><br><span class="hljs-comment"># 加载yaml配置文件</span><br>kubectl apply -f deploy.yaml <br><br><span class="hljs-comment"># 检查安装的结果</span><br>kubectl get pod,svc -n ingress-nginx<br><br>NAME                                         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                      AGE<br>service/ingress-nginx-controller             NodePort    10.96.216.183   &lt;none&gt;        80:30391/TCP,443:30303/TCP   4s<br>service/ingress-nginx-controller-admission   ClusterIP   10.96.139.106   &lt;none&gt;        443/TCP                      4s<br><br><span class="hljs-comment"># 最后别忘记把svc暴露的端口要放行</span><br></code></pre></td></tr></table></figure><p>然后访问<br>80:30391&#x2F;TCP,443:30303&#x2F;TCP<br>80端口访问30391, 443端口访问30303<br><a href="http://47.107.101.255:30391/">http://47.107.101.255:30391/</a><br><a href="https://47.107.101.255:30303/">https://47.107.101.255:30303/</a><br><img src="/assets/87f6ef285fb6419ba37ba7057722594f.png"><br><img src="/assets/e23bdeabf5524882b28231ee251041de.png"><br>虽然访问到了404,但是这也说明了成功的访问到了nginx </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 查看service</span><br>kubectl get svc -A<br><br><span class="hljs-comment"># 查看nodes</span><br>kubectl get nodes<br><br><span class="hljs-comment"># 编写yaml</span><br>vi test.yaml<br><br>apiVersion: apps/v1<br>kind: Deployment<br>metadata:<br>  name: hello-server<br>spec:<br>  replicas: 2<br>  selector:<br>    matchLabels:<br>      app: hello-server<br>  template:<br>    metadata:<br>      labels:<br>        app: hello-server<br>    spec:<br>      containers:<br>      - name: hello-server<br>        image: registry.cn-hangzhou.aliyuncs.com/lfy_k8s_images/hello-server<br>        ports:<br>        - containerPort: 9000<br>---<br>apiVersion: apps/v1<br>kind: Deployment<br>metadata:<br>  labels:<br>    app: nginx-demo<br>  name: nginx-demo<br>spec:<br>  replicas: 2<br>  selector:<br>    matchLabels:<br>      app: nginx-demo<br>  template:<br>    metadata:<br>      labels:<br>        app: nginx-demo<br>    spec:<br>      containers:<br>      - image: nginx<br>        name: nginx<br>---<br>apiVersion: v1<br>kind: Service<br>metadata:<br>  labels:<br>    app: nginx-demo<br>  name: nginx-demo<br>spec:<br>  selector:<br>    app: nginx-demo<br>  ports:<br>  - port: 8000<br>    protocol: TCP<br>    targetPort: 80<br>---<br>apiVersion: v1<br>kind: Service<br>metadata:<br>  labels:<br>    app: hello-server<br>  name: hello-server<br>spec:<br>  selector:<br>    app: hello-server<br>  ports:<br>  - port: 8000<br>    protocol: TCP<br>    targetPort: 9000<br><br><span class="hljs-comment"># 应用yaml文件</span><br>kubectl apply -f test.yaml<br><br><span class="hljs-comment"># 查看service的IP</span><br>kubectl get svc<br>NAME           TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE<br>hello-server   ClusterIP   10.96.185.158   &lt;none&gt;        8000/TCP         19s<br>nginx-demo     ClusterIP   10.96.3.222     &lt;none&gt;        8000/TCP         19s<br><br><span class="hljs-comment"># 请求service的IP</span><br>curl 10.96.3.222:8000<br>curl 10.96.185.158:8000<br><br><br></code></pre></td></tr></table></figure><p>域名访问</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 再次编写配置文件</span><br>vi ingress-rule.yaml<br><br>apiVersion: networking.k8s.io/v1<br>kind: Ingress  <br>metadata:<br>  name: ingress-host-bar<br>spec:<br>  ingressClassName: nginx<br>  rules:<br>  - host: <span class="hljs-string">&quot;hello.atguigu.com&quot;</span><br>    http:<br>      paths:<br>      - pathType: Prefix<br>        path: <span class="hljs-string">&quot;/&quot;</span><br>        backend:<br>          service:<br>            name: hello-server<br>            port:<br>              number: 8000<br>  - host: <span class="hljs-string">&quot;demo.atguigu.com&quot;</span><br>    http:<br>      paths:<br>      - pathType: Prefix<br>        path: <span class="hljs-string">&quot;/nginx&quot;</span>  <span class="hljs-comment"># 把请求会转给下面的服务，下面的服务一定要能处理这个路径，不能处理就是404</span><br>        backend:<br>          service:<br>            name: nginx-demo  <span class="hljs-comment">## java，比如使用路径重写，去掉前缀nginx</span><br>            port:<br>              number: 8000<br><br><span class="hljs-comment"># 应用配置文件</span><br>kubectl apply -f ingress-rule.yaml<br><br><span class="hljs-comment"># 查看ingress, 查看绑定的域名</span><br>kubectl get ingress<br>NAME               CLASS   HOSTS                                ADDRESS   PORTS   AGE<br>ingress-host-bar   nginx   hello.atguigu.com,demo.atguigu.com             80      33s<br><br><span class="hljs-comment"># 查看端口</span><br>kubectl get pod,svc -n ingress-nginx<br>NAME                                         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                      AGE<br>service/ingress-nginx-controller             NodePort    10.96.216.183   &lt;none&gt;        80:30391/TCP,443:30303/TCP   12h<br>service/ingress-nginx-controller-admission   ClusterIP   10.96.139.106   &lt;none&gt;        443/TCP                      12h<br><br><span class="hljs-comment"># 然后再windows的hosts配置文件进行修改</span><br>C:\Windows\System32\drivers\etc<br><br>47.107.101.255 hello.atguigu.com<br>47.107.101.255 demo.atguigu.com<br><br></code></pre></td></tr></table></figure><p>当请求的域名前缀是hello, 把请求转给hello-service<br>当请求的域名前缀是demo, 把请求转给nginx-demo<br>然后浏览器访问<br><a href="http://hello.atguigu.com:30391/">http://hello.atguigu.com:30391/</a><br><a href="http://demo.atguigu.com:30391/">http://demo.atguigu.com:30391/</a><br><img src="/assets/af3a4b5335d0471998076a4aea42289f.png"><br><img src="/assets/934083c7c84f44e8a7f7855810ae2e77.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 查看ingress</span><br>kubectl get ing<br><br><span class="hljs-comment"># 编辑ingress, 将path修改成/nginx</span><br>kubectl edit ing ingress-host-bar<br><br>  - host: demo.atguigu.com<br>    http:<br>      paths:<br>      - backend:<br>          service:<br>            name: nginx-demo<br>            port:<br>              number: 8000<br>        path: /nginx<br>        pathType: Prefix<br><br>:wq<br><br><span class="hljs-comment"># 再次访问浏览器</span><br><br></code></pre></td></tr></table></figure><p>请求<a href="http://demo.atguigu.com:30391/nginx">http://demo.atguigu.com:30391</a><br><img src="/assets/b28a0a4a821042a5a26b5389576f8ebd.png"><br>请求<a href="http://demo.atguigu.com:30391/nginx">http://demo.atguigu.com:30391/nginx</a><br><img src="/assets/ddf429a115ad4845829c394a376b689e.png"><br>第二个请求是带有nginx版本号的<br>第一个请求是nginx没有版本号的, 因为第一个请求是被ingress的nginx管理了<br>第二个请求则是被nginx-demo管理的<br><img src="/assets/56e6adc7a50646959748dbcf82f285eb.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 当进入nginx容器进行修改</span><br><span class="hljs-built_in">cd</span> /usr/share/nginx/html/<br><br>/usr/share/nginx/html<span class="hljs-comment"># echo roudoukouya &gt; nginx</span><br><br><span class="hljs-comment"># 再次请求, 这次请求将会把nginx文件给下载下来</span><br></code></pre></td></tr></table></figure><p><img src="/assets/bf49a160de3b4571b3bedce013de3b49.png"></p><p>路径重写</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs bash">vi ingress-rule.yaml<br><br>apiVersion: networking.k8s.io/v1<br>kind: Ingress  <br>metadata:<br>  annotations:<br>    nginx.ingress.kubernetes.io/rewrite-target: /<span class="hljs-variable">$2</span><br>  name: ingress-host-bar<br>spec:<br>  ingressClassName: nginx<br>  rules:<br>  - host: <span class="hljs-string">&quot;hello.atguigu.com&quot;</span><br>    http:<br>      paths:<br>      - pathType: Prefix<br>        path: <span class="hljs-string">&quot;/&quot;</span><br>        backend:<br>          service:<br>            name: hello-server<br>            port:<br>              number: 8000<br>  - host: <span class="hljs-string">&quot;demo.atguigu.com&quot;</span><br>    http:<br>      paths:<br>      - pathType: Prefix<br>        path: <span class="hljs-string">&quot;/nginx(/|$)(.*)&quot;</span>  <span class="hljs-comment"># 把请求会转给下面的服务，下面的服务一定要能处理这个路径，不能处理就是404</span><br>        backend:<br>          service:<br>            name: nginx-demo  <span class="hljs-comment">## java，比如使用路径重写，去掉前缀nginx</span><br>            port:<br>              number: 8000<br><br><span class="hljs-comment"># 删除配置文件创建的service</span><br>kubectl delete -f ingress-rule.yaml <br><span class="hljs-comment"># 再次创建</span><br>kubectl apply -f ingress-rule.yaml <br><br><span class="hljs-comment"># 查看一下</span><br>kubectl get ing<br></code></pre></td></tr></table></figure><p>此时访问<a href="http://demo.atguigu.com:30391/nginx">http://demo.atguigu.com:30391/nginx</a><br>将会把路径重写成<a href="http://demo.atguigu.com:30391/nginx">http://demo.atguigu.com:30391/</a> 直接访问nginx的根目录的默认欢迎页<br><img src="/assets/9091c81f795c40709e1c0a19b4547826.png"><br>流量限制</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 再次修改hosts文件</span><br>47.107.101.255 hello.atguigu.com<br>47.107.101.255 demo.atguigu.com<br>47.107.101.255 haha.atguigu.com<br><br><span class="hljs-comment"># 创建一个新的yaml文件</span><br>vi ingress-rule-2.yaml <br><br>apiVersion: networking.k8s.io/v1<br>kind: Ingress<br>metadata:<br>  name: ingress-limit-rate<br>  annotations:<br>    nginx.ingress.kubernetes.io/limit-rps: <span class="hljs-string">&quot;1&quot;</span><br>spec:<br>  ingressClassName: nginx<br>  rules:<br>  - host: <span class="hljs-string">&quot;haha.atguigu.com&quot;</span><br>    http:<br>      paths:<br>      - pathType: Exact<br>        path: <span class="hljs-string">&quot;/&quot;</span><br>        backend:<br>          service:<br>            name: nginx-demo<br>            port:<br>              number: 8000<br><br><span class="hljs-comment"># 应用yaml</span><br>kubectl apply -f ingress-rule-2.yaml<br><br><span class="hljs-comment"># 查看是否应用成功</span><br>kubectl get ing<br></code></pre></td></tr></table></figure><p>浏览器请求<a href="http://haha.atguigu.com:30391/">http://haha.atguigu.com:30391/</a><br><img src="/assets/636db32f688a48fa9507a42ca6efd3b8.png"><br>疯狂按F5<br><img src="/assets/ed038fe4c2f4402e97563b20a40c73c3.png"></p><h2 id="NFS环境搭建"><a href="#NFS环境搭建" class="headerlink" title="NFS环境搭建"></a>NFS环境搭建</h2><h3 id="PV-amp-PVC"><a href="#PV-amp-PVC" class="headerlink" title="PV&amp;PVC"></a>PV&amp;PVC</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">########################################## 所有节点都安装</span><br>yum install -y nfs-utils<br><br><span class="hljs-comment">########################################## 主节点</span><br><span class="hljs-comment"># nfs主节点</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;/nfs/data/ *(insecure,rw,sync,no_root_squash)&quot;</span> &gt; /etc/exports<br><br><span class="hljs-built_in">mkdir</span> -p /nfs/data<br>systemctl <span class="hljs-built_in">enable</span> rpcbind --now<br>systemctl <span class="hljs-built_in">enable</span> nfs-server --now<br><span class="hljs-comment"># 配置生效</span><br>exportfs -r<br><br><span class="hljs-comment"># 查看暴露出去路径</span><br>exportfs<br><br><span class="hljs-comment">########################################## 子节点</span><br><span class="hljs-comment"># 换成master的私有IP地址</span><br>ip addr<br><span class="hljs-comment"># 查看master暴露出来可以挂载的路径</span><br>showmount -e 172.31.0.204<br><br><span class="hljs-comment"># 执行以下命令挂载 nfs 服务器上的共享目录到本机路径 /root/nfsmount</span><br><span class="hljs-built_in">mkdir</span> -p /nfs/data<br><br><span class="hljs-comment"># 这也换成master的私有IP地址</span><br>mount -t nfs 172.31.0.204:/nfs/data /nfs/data<br><br><span class="hljs-comment"># 写入一个测试文件</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;hello nfs server&quot;</span> &gt; /nfs/data/test.txt<br><br><span class="hljs-comment"># 每个节点都查看一下, 说明了这个测试文件在每个节点上都保存拥有了</span><br><span class="hljs-built_in">cat</span> /nfs/data/test.txt<br></code></pre></td></tr></table></figure><p>原始方式挂载</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs bash">vi deploy.yaml<br><br>apiVersion: apps/v1<br>kind: Deployment<br>metadata:<br>  labels:<br>    app: nginx-pv-demo<br>  name: nginx-pv-demo<br>spec:<br>  replicas: 2<br>  selector:<br>    matchLabels:<br>      app: nginx-pv-demo<br>  template:<br>    metadata:<br>      labels:<br>        app: nginx-pv-demo<br>    spec:<br>      containers:<br>      - image: nginx<br>        name: nginx<br>        volumeMounts:<br>        - name: html<br>          mountPath: /usr/share/nginx/html<br>      volumes:<br>        - name: html<br>          nfs:<br>            server: 172.31.0.204<br>            path: /nfs/data/nginx-pv<br><br><span class="hljs-comment"># 应用配置文件</span><br>kubectl apply -f deploy.yaml <br><br><span class="hljs-comment"># 描述</span><br>kubectl describe pod nginx-pv-demo-5f8d846496-fjph9<br><span class="hljs-comment"># 此时是挂载失败了, 要先创建把/nfs/data/nginx-pv创建出来才能进行挂载</span><br><span class="hljs-comment"># Output: mount.nfs: mounting 172.31.0.204:/nfs/data/nginx-pv failed, reason given by server: No such file or directory</span><br><br><span class="hljs-comment"># 创建nginx-pv</span><br><span class="hljs-built_in">cd</span> /nfs/data/<br><span class="hljs-built_in">mkdir</span> -p nginx-pv<br><br><span class="hljs-comment"># 删除</span><br>kubectl delete deploy nginx-pv-demo<br><br><span class="hljs-comment"># 创建</span><br><span class="hljs-built_in">cd</span> ~<br>kubectl apply -f deploy.yaml <br><br><span class="hljs-comment"># 查看容器的名称</span><br>kubectl get pod<br><br><span class="hljs-comment"># 随便往映射文件中写入文本</span><br><span class="hljs-built_in">echo</span> roudoukouya &gt; /nfs/data/nginx-pv/index.html<br><br><span class="hljs-comment"># 进入容器</span><br>kubectl <span class="hljs-built_in">exec</span> -it nginx-pv-demo-5f8d846496-cwjsd -- /bin/bash<br><span class="hljs-built_in">cat</span> /usr/share/nginx/html/index.html<br><span class="hljs-comment"># roudoukouya</span><br>kubectl <span class="hljs-built_in">exec</span> -it nginx-pv-demo-5f8d846496-n795r --/bin/bash<br><span class="hljs-built_in">cat</span> /usr/share/nginx/html/index.html<br><span class="hljs-comment"># roudoukouya</span><br></code></pre></td></tr></table></figure><p><img src="/assets/98c65a2536854e53873b4f00bffd4838.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 删除deploy部署的deploy</span><br>kubectl delete -f deploy.yaml <br><br><span class="hljs-comment">#nfs主节点</span><br><span class="hljs-built_in">mkdir</span> -p /nfs/data/01<br><span class="hljs-built_in">mkdir</span> -p /nfs/data/02<br><span class="hljs-built_in">mkdir</span> -p /nfs/data/03<br><br><span class="hljs-comment"># 创建pv配置文件</span><br>vi pv.yaml<br><br>apiVersion: v1<br>kind: PersistentVolume<br>metadata:<br>  name: pv01-10m<br>spec:<br>  capacity:<br>    storage: 10M<br>  accessModes:<br>    - ReadWriteMany<br>  storageClassName: nfs<br>  nfs:<br>    path: /nfs/data/01<br>    server: 172.31.0.204<br>---<br>apiVersion: v1<br>kind: PersistentVolume<br>metadata:<br>  name: pv02-1gi<br>spec:<br>  capacity:<br>    storage: 1Gi<br>  accessModes:<br>    - ReadWriteMany<br>  storageClassName: nfs<br>  nfs:<br>    path: /nfs/data/02<br>    server: 172.31.0.204<br>---<br>apiVersion: v1<br>kind: PersistentVolume<br>metadata:<br>  name: pv03-3gi<br>spec:<br>  capacity:<br>    storage: 3Gi<br>  accessModes:<br>    - ReadWriteMany<br>  storageClassName: nfs<br>  nfs:<br>    path: /nfs/data/03<br>    server: 172.31.0.204<br><br><span class="hljs-comment"># 应用</span><br>kubectl apply -f pv.yaml<br><br><span class="hljs-comment"># 查看pv</span><br>kubectl get pv<br>kubectl get persistentvolume<br><span class="hljs-comment"># NAME       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   REASON   AGE</span><br><span class="hljs-comment"># pv01-10m   10M        RWX            Retain           Available           nfs                     26s</span><br><span class="hljs-comment"># pv02-1gi   1Gi        RWX            Retain           Available           nfs                     26s</span><br><span class="hljs-comment"># pv03-3gi   3Gi        RWX            Retain           Available           nfs                     26s</span><br><br><span class="hljs-comment"># 创建pvc配置文件</span><br>vi pvc.yaml<br><br>kind: PersistentVolumeClaim<br>apiVersion: v1<br>metadata:<br>  name: nginx-pvc<br>spec:<br>  accessModes:<br>    - ReadWriteMany<br>  resources:<br>    requests:<br>      storage: 200Mi<br>  storageClassName: nfs<br><br><span class="hljs-comment"># 应用</span><br>kubectl apply -f pvc.yaml<br><br><span class="hljs-comment"># 查看pv</span><br>kubectl get persistentvolume<br><span class="hljs-comment"># NAME       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM               STORAGECLASS   REASON   AGE</span><br><span class="hljs-comment"># pv01-10m   10M        RWX            Retain           Available                       nfs                     3m25s</span><br><span class="hljs-comment"># pv02-1gi   1Gi        RWX            Retain           Bound       default/nginx-pvc   nfs                     3m25s</span><br><span class="hljs-comment"># pv03-3gi   3Gi        RWX            Retain           Available                       nfs                     3m25s</span><br><br><span class="hljs-comment"># 删除pvc.yaml配置文件绑定的资源</span><br>kubectl delete -f pvc.yaml<br><br><span class="hljs-comment"># 查看</span><br>kubectl get persistentvolume<br><span class="hljs-comment"># NAME       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM               STORAGECLASS   REASON   AGE</span><br><span class="hljs-comment"># pv01-10m   10M        RWX            Retain           Available                       nfs                     5m33s</span><br><span class="hljs-comment"># pv02-1gi   1Gi        RWX            Retain           Released    default/nginx-pvc   nfs                     5m33s</span><br><span class="hljs-comment"># pv03-3gi   3Gi        RWX            Retain           Available                       nfs                     5m33s</span><br><br><span class="hljs-comment"># 应用</span><br>kubectl apply -f pvc.yaml <br><br><span class="hljs-comment"># 查看</span><br>kubectl get persistentvolume<br><span class="hljs-comment"># NAME       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM               STORAGECLASS   REASON   AGE</span><br><span class="hljs-comment"># pv01-10m   10M        RWX            Retain           Available                       nfs                     6m27s</span><br><span class="hljs-comment"># pv02-1gi   1Gi        RWX            Retain           Released    default/nginx-pvc   nfs                     6m27s</span><br><span class="hljs-comment"># pv03-3gi   3Gi        RWX            Retain           Bound       default/nginx-pvc   nfs                     6m27s</span><br><br><br><span class="hljs-comment"># 创建yaml</span><br>vi dep02.yaml<br><br>apiVersion: apps/v1<br>kind: Deployment<br>metadata:<br>  labels:<br>    app: nginx-deploy-pvc<br>  name: nginx-deploy-pvc<br>spec:<br>  replicas: 2<br>  selector:<br>    matchLabels:<br>      app: nginx-deploy-pvc<br>  template:<br>    metadata:<br>      labels:<br>        app: nginx-deploy-pvc<br>    spec:<br>      containers:<br>      - image: nginx<br>        name: nginx<br>        volumeMounts:<br>        - name: html<br>          mountPath: /usr/share/nginx/html<br>      volumes:<br>        - name: html<br>          persistentVolumeClaim:<br>            claimName: nginx-pvc<br><br><span class="hljs-comment"># 应用</span><br>kubectl apply -f dep02.yaml<br><br><br>kubectl get pv,pvc<br><span class="hljs-comment"># NAME                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM               STORAGECLASS   REASON   AGE</span><br><span class="hljs-comment"># persistentvolume/pv01-10m   10M        RWX            Retain           Available                       nfs                     9m13s</span><br><span class="hljs-comment"># persistentvolume/pv02-1gi   1Gi        RWX            Retain           Released    default/nginx-pvc   nfs                     9m13s</span><br><span class="hljs-comment"># persistentvolume/pv03-3gi   3Gi        RWX            Retain           Bound       default/nginx-pvc   nfs                     9m13s</span><br><br><span class="hljs-comment"># NAME                              STATUS   VOLUME     CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span><br><span class="hljs-comment"># persistentvolumeclaim/nginx-pvc   Bound    pv03-3gi   3Gi        RWX            nfs            3m30s</span><br></code></pre></td></tr></table></figure><h3 id="ConfigMap"><a href="#ConfigMap" class="headerlink" title="ConfigMap"></a>ConfigMap</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 创建一个配置文件</span><br>vi redis.conf<br><br>appendonly <span class="hljs-built_in">yes</span><br><br>kubectl create cm redis-conf --from-file=redis.conf<br><br>kubectl get cm<br><br><span class="hljs-built_in">rm</span> -rf redis.conf <br><br>kubectl get cm redis-conf -oyaml<br><br>apiVersion: v1<br>data:<br>  redis.conf: |<br>    appendonly <span class="hljs-built_in">yes</span><br>kind: ConfigMap<br>metadata:<br>  creationTimestamp: <span class="hljs-string">&quot;2023-05-13T03:40:47Z&quot;</span><br>  managedFields:<br>  - apiVersion: v1<br>    fieldsType: FieldsV1<br>    fieldsV1:<br>      f:data:<br>        .: &#123;&#125;<br>        f:redis.conf: &#123;&#125;<br>    manager: kubectl-create<br>    operation: Update<br>    time: <span class="hljs-string">&quot;2023-05-13T03:40:47Z&quot;</span><br>  name: redis-conf<br>  namespace: default<br>  resourceVersion: <span class="hljs-string">&quot;58168&quot;</span><br>  uid: 7efa1eac-ad15-4b21-9322-7a2c92886e74<br><br><br>vi redis.yaml<br><br>apiVersion: v1<br>kind: Pod<br>metadata:<br>  name: redis<br>spec:<br>  containers:<br>  - name: redis<br>    image: redis<br>    <span class="hljs-built_in">command</span>:<br>      - redis-server<br>      - <span class="hljs-string">&quot;/redis-master/redis.conf&quot;</span>  <span class="hljs-comment">#指的是redis容器内部的位置</span><br>    ports:<br>    - containerPort: 6379<br>    volumeMounts:<br>    - mountPath: /data<br>      name: data<br>    - mountPath: /redis-master<br>      name: config<br>  volumes:<br>    - name: data<br>      emptyDir: &#123;&#125;<br>    - name: config<br>      configMap:<br>        name: redis-conf<br>        items:<br>        - key: redis.conf<br>          path: redis.conf<br><br><span class="hljs-comment"># 创建pod</span><br>kubectl apply -f redis.yaml<br><br><span class="hljs-comment"># 查看pod</span><br>kubectl get pod<br><br><span class="hljs-comment"># 进入redis容器</span><br>kubectl <span class="hljs-built_in">exec</span> -it redis -- bash<br><span class="hljs-built_in">cat</span> /redis-master/redis.conf <br><span class="hljs-comment"># appendonly yes</span><br><br><br>kubectl get cm<br><br><span class="hljs-comment"># 编辑配置文件(添加一行requirepass)</span><br>kubectl edit cm redis-conf<br><br>apiVersion: v1<br>data:<br>  redis.conf: |<br>    appendonly <span class="hljs-built_in">yes</span><br>    requirepass 123456<br><br><span class="hljs-comment"># 再次进入redis容器, 可以发现刚刚编辑的requirepass, 过了一会就出现了在redis.conf中</span><br>kubectl <span class="hljs-built_in">exec</span> -it redis -- bash<br><span class="hljs-built_in">cat</span> /redis-master/redis.conf <br><span class="hljs-comment"># appendonly yes</span><br><span class="hljs-comment"># requirepass 123456</span><br><br><span class="hljs-comment"># 检查默认配置, 默认配置并没有生效requirepass, 这需要重新创建一个pod, 就会出现requirepass</span><br>kubectl <span class="hljs-built_in">exec</span> -it redis -- redis-cli<br>CONFIG GET appendonly<br><span class="hljs-comment"># 1) &quot;appendonly&quot;</span><br><span class="hljs-comment"># 2) &quot;yes&quot;</span><br><br>CONFIG GET requirepass<br><span class="hljs-comment"># 1) &quot;requirepass&quot;</span><br><span class="hljs-comment"># 2) &quot;&quot;</span><br></code></pre></td></tr></table></figure><h3 id="Secret"><a href="#Secret" class="headerlink" title="Secret"></a>Secret</h3><blockquote><p>Secret 对象类型用来保存敏感信息，例如密码、OAuth 令牌和 SSH 密钥。 将这些信息放在 secret 中比放在 <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod-overview/">Pod</a> 的定义或者 <a href="https://kubernetes.io/zh/docs/reference/glossary/?all=true#term-image">容器镜像</a> 中来说更加安全和灵活。</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 登录docker</span><br>docker login<br><br><span class="hljs-comment"># 退出docker</span><br>docker <span class="hljs-built_in">logout</span><br><br><span class="hljs-comment"># 然后输入账号密码</span><br>Username:<br>Password:<br><br><span class="hljs-comment"># 提交镜像</span><br>docker commit b43e2104abd6 roudoukou/k8s-<span class="hljs-built_in">test</span><br><span class="hljs-comment"># 返回的sha256验证码</span><br><span class="hljs-comment"># sha256:ba6d93505b636cfc0746b0489c8f2c840b5ec1a66b2c667e8d4b165be02369b0</span><br><br><span class="hljs-comment"># 将镜像推送上docker-hub</span><br>docker push roudoukou/k8s-<span class="hljs-built_in">test</span><br><br><span class="hljs-comment"># 拉取镜像 </span><br>docker pull leifengyang/guignginx:v1.0<br><br><span class="hljs-comment"># 创建配置文件</span><br>vi mypod.yaml<br><br>apiVersion: v1<br>kind: Pod<br>metadata:<br>  name: private-nginx<br>spec:<br>  containers:<br>  - name: private-nginx<br>    image: leifengyang/guignginx:v1.0<br>  imagePullSecrets:<br>  - name: leifengyang-docker<br><br><span class="hljs-comment"># 应用</span><br>kubectl apply -f mypod.yaml<br><br>kubectl get pod<br><br>kubectl delete -f mypod.yaml<br><br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl create secret docker-registry leifengyang-docker \<br>--docker-username=leifengyang \<br>--docker-password=Lfy123456 \<br>--docker-email=534096094@qq.com<br><br>kubectl get secret<br><br>kubectl get secret leifengyang-docker -oyaml<br><br></code></pre></td></tr></table></figure><p>创建了secret之后, 可以通过账号密码来下载私有的容器镜像</p><h2 id="KubeSphere"><a href="#KubeSphere" class="headerlink" title="KubeSphere"></a>KubeSphere</h2><h3 id="1-kubenetes上安装kubesphere"><a href="#1-kubenetes上安装kubesphere" class="headerlink" title="1. kubenetes上安装kubesphere"></a>1. kubenetes上安装kubesphere</h3><h4 id="安装Docker"><a href="#安装Docker" class="headerlink" title="安装Docker"></a>安装Docker</h4><p>所有节点安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo yum remove docker*<br>sudo yum install -y yum-utils<br><br><span class="hljs-comment">#配置docker的yum地址</span><br>sudo yum-config-manager \<br>--add-repo \<br>http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo<br><br><br><span class="hljs-comment">#安装指定版本</span><br>sudo yum install -y docker-ce-20.10.7 docker-ce-cli-20.10.7 containerd.io-1.4.6<br><br><span class="hljs-comment">#启动&amp;开机启动docker</span><br>systemctl <span class="hljs-built_in">enable</span> docker --now<br><br><span class="hljs-comment"># docker加速配置</span><br>sudo <span class="hljs-built_in">mkdir</span> -p /etc/docker<br>sudo <span class="hljs-built_in">tee</span> /etc/docker/daemon.json &lt;&lt;-<span class="hljs-string">&#x27;EOF&#x27;</span><br>&#123;<br>  <span class="hljs-string">&quot;registry-mirrors&quot;</span>: [<span class="hljs-string">&quot;https://ylmjgfp5.mirror.aliyuncs.com&quot;</span>]<br>&#125;<br>EOF<br>sudo systemctl daemon-reload<br>sudo systemctl restart docker<br></code></pre></td></tr></table></figure><h4 id="安装kubenetes"><a href="#安装kubenetes" class="headerlink" title="安装kubenetes"></a>安装kubenetes</h4><blockquote><p>每个机器使用内网ip互通</p></blockquote><blockquote><p>每个机器配置自己的hostname，不能用localhost</p></blockquote><p>每个节点都设置hostname, 然后关闭虚拟化</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#设置每个机器自己的hostname</span><br>hostnamectl set-hostname k8s-master<br>hostnamectl set-hostname k8s-node1<br>hostnamectl set-hostname k8s-node2<br><br><span class="hljs-comment"># 将 SELinux 设置为 permissive 模式（相当于将其禁用）</span><br>sudo setenforce 0<br>sudo sed -i <span class="hljs-string">&#x27;s/^SELINUX=enforcing$/SELINUX=permissive/&#x27;</span> /etc/selinux/config<br><br><span class="hljs-comment">#关闭swap</span><br>swapoff -a  <br>sed -ri <span class="hljs-string">&#x27;s/.*swap.*/#&amp;/&#x27;</span> /etc/fstab<br><br><span class="hljs-comment">#允许 iptables 检查桥接流量</span><br><span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF | sudo tee /etc/modules-load.d/k8s.conf</span><br><span class="hljs-string">br_netfilter</span><br><span class="hljs-string">EOF</span><br><br><span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF | sudo tee /etc/sysctl.d/k8s.conf</span><br><span class="hljs-string">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="hljs-string">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="hljs-string">EOF</span><br>sudo sysctl --system<br></code></pre></td></tr></table></figure><h4 id="安装kubelet、kubeadm、kubectl-1"><a href="#安装kubelet、kubeadm、kubectl-1" class="headerlink" title="安装kubelet、kubeadm、kubectl"></a>安装kubelet、kubeadm、kubectl</h4><p>每个节点都执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 配置k8s的yum源地址</span><br><span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">EOF | sudo tee /etc/yum.repos.d/kubernetes.repo</span><br><span class="hljs-string">[kubernetes]</span><br><span class="hljs-string">name=Kubernetes</span><br><span class="hljs-string">baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64</span><br><span class="hljs-string">enabled=1</span><br><span class="hljs-string">gpgcheck=0</span><br><span class="hljs-string">repo_gpgcheck=0</span><br><span class="hljs-string">gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg</span><br><span class="hljs-string">   http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="hljs-string">EOF</span><br><br><br><span class="hljs-comment"># 安装 kubelet，kubeadm，kubectl</span><br>sudo yum install -y kubelet-1.20.9 kubeadm-1.20.9 kubectl-1.20.9<br><br><span class="hljs-comment"># 启动kubelet</span><br>sudo systemctl <span class="hljs-built_in">enable</span> --now kubelet<br><br><span class="hljs-comment"># 所有机器配置master域名</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;172.31.0.204  k8s-master&quot;</span> &gt;&gt; /etc/hosts<br></code></pre></td></tr></table></figure><h4 id="初始化master节点"><a href="#初始化master节点" class="headerlink" title="初始化master节点"></a>初始化master节点</h4><p>只需要在主节点master执行(node节点不要执行, 需要替换成master的IP)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubeadm init \<br>--apiserver-advertise-address=172.31.0.204 \<br>--control-plane-endpoint=k8s-master \<br>--image-repository registry.cn-hangzhou.aliyuncs.com/lfy_k8s_images \<br>--kubernetes-version v1.20.9 \<br>--service-cidr=10.96.0.0/16 \<br>--pod-network-cidr=192.168.0.0/16<br></code></pre></td></tr></table></figure><p>如果部署手误了, 可以使用如下命令重置, 然后重新部署</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubeadm reset<br></code></pre></td></tr></table></figure><h4 id="记录关键信息"><a href="#记录关键信息" class="headerlink" title="记录关键信息"></a>记录关键信息</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">Your Kubernetes control-plane has initialized successfully!<br><br>To start using your cluster, you need to run the following as a regular user:<br><br>  <span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$HOME</span>/.kube<br>  sudo <span class="hljs-built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="hljs-variable">$HOME</span>/.kube/config<br>  sudo <span class="hljs-built_in">chown</span> $(<span class="hljs-built_in">id</span> -u):$(<span class="hljs-built_in">id</span> -g) <span class="hljs-variable">$HOME</span>/.kube/config<br><br>Alternatively, <span class="hljs-keyword">if</span> you are the root user, you can run:<br><br>  <span class="hljs-built_in">export</span> KUBECONFIG=/etc/kubernetes/admin.conf<br><br>You should now deploy a pod network to the cluster.<br>Run <span class="hljs-string">&quot;kubectl apply -f [podnetwork].yaml&quot;</span> with one of the options listed at:<br>  https://kubernetes.io/docs/concepts/cluster-administration/addons/<br><br>You can now <span class="hljs-built_in">join</span> any number of control-plane nodes by copying certificate authorities<br>and service account keys on each node and <span class="hljs-keyword">then</span> running the following as root:<br><br>  kubeadm <span class="hljs-built_in">join</span> k8s-master:6443 --token 5ybzw0.jtbnx7tbb0t83tp9 \<br>    --discovery-token-ca-cert-hash sha256:f83a1db517489e43d02c836953d0cf680ea6a9a0c816567522635df8669c00c2 \<br>    --control-plane <br><br>Then you can <span class="hljs-built_in">join</span> any number of worker nodes by running the following on each as root:<br><br>kubeadm <span class="hljs-built_in">join</span> k8s-master:6443 --token 5ybzw0.jtbnx7tbb0t83tp9 \<br>    --discovery-token-ca-cert-hash sha256:f83a1db517489e43d02c836953d0cf680ea6a9a0c816567522635df8669c00c2 <br></code></pre></td></tr></table></figure><p>master节点输入</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$HOME</span>/.kube<br>sudo <span class="hljs-built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="hljs-variable">$HOME</span>/.kube/config<br>sudo <span class="hljs-built_in">chown</span> $(<span class="hljs-built_in">id</span> -u):$(<span class="hljs-built_in">id</span> -g) <span class="hljs-variable">$HOME</span>/.kube/config<br></code></pre></td></tr></table></figure><h4 id="安装Calico网络插件"><a href="#安装Calico网络插件" class="headerlink" title="安装Calico网络插件"></a>安装Calico网络插件</h4><p>只用在master节点输入这个</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># curl https://docs.projectcalico.org/v3.20/manifests/calico.yaml -O</span><br><span class="hljs-comment"># 使用下面这个版本, emm, 卡这个bug卡了一个晚上了</span><br>curl https://docs.projectcalico.org/v3.8/manifests/calico.yaml -O<br><br>kubectl apply -f calico.yaml<br><br><span class="hljs-comment"># 查看运行的pod</span><br>kubectl get pods -A<br><br></code></pre></td></tr></table></figure><p>所有的node节点输入</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 把node节点加入到master</span><br>kubeadm <span class="hljs-built_in">join</span> k8s-master:6443 --token 5ybzw0.jtbnx7tbb0t83tp9 \<br>    --discovery-token-ca-cert-hash sha256:f83a1db517489e43d02c836953d0cf680ea6a9a0c816567522635df8669c00c2 <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 查看节点</span><br>kubectl get nodes<br></code></pre></td></tr></table></figure><h4 id="nfs文件系统-安装nfs-server"><a href="#nfs文件系统-安装nfs-server" class="headerlink" title="nfs文件系统 - 安装nfs-server"></a>nfs文件系统 - 安装nfs-server</h4><p>每个节点安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 在每个机器。</span><br>yum install -y nfs-utils<br></code></pre></td></tr></table></figure><p>master下执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 在master 执行以下命令 </span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;/nfs/data/ *(insecure,rw,sync,no_root_squash)&quot;</span> &gt; /etc/exports<br><br><br><span class="hljs-comment"># 执行以下命令，启动 nfs 服务;创建共享目录</span><br><span class="hljs-built_in">mkdir</span> -p /nfs/data<br><br><br><span class="hljs-comment"># 在master执行</span><br>systemctl <span class="hljs-built_in">enable</span> rpcbind<br>systemctl <span class="hljs-built_in">enable</span> nfs-server<br>systemctl start rpcbind<br>systemctl start nfs-server<br><br><span class="hljs-comment"># 使配置生效</span><br>exportfs -r<br><br><br><span class="hljs-comment">#检查配置是否生效</span><br>exportfs<br></code></pre></td></tr></table></figure><h4 id="nfs文件系统-配置nfs-client（选做）"><a href="#nfs文件系统-配置nfs-client（选做）" class="headerlink" title="nfs文件系统 - 配置nfs-client（选做）"></a>nfs文件系统 - 配置nfs-client（选做）</h4><p>所有node节点下执行(需要替换成master的IP)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">showmount -e 172.31.0.204<br><br><span class="hljs-built_in">mkdir</span> -p /nfs/data<br><br>mount -t nfs 172.31.0.204:/nfs/data /nfs/data<br></code></pre></td></tr></table></figure><h4 id="nfs文件系统-配置默认存储"><a href="#nfs文件系统-配置默认存储" class="headerlink" title="nfs文件系统 - 配置默认存储"></a>nfs文件系统 - 配置默认存储</h4><blockquote><p>配置动态供应的默认存储类</p></blockquote><p>master下执行(需要替换成自己的master IP 172.31.0.204)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vi sc.yaml<br></code></pre></td></tr></table></figure><p>sc.yaml(要替换成master的 IP)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## 创建了一个存储类</span><br>apiVersion: storage.k8s.io/v1<br>kind: StorageClass<br>metadata:<br>  name: nfs-storage<br>  annotations:<br>    storageclass.kubernetes.io/is-default-class: <span class="hljs-string">&quot;true&quot;</span><br>provisioner: k8s-sigs.io/nfs-subdir-external-provisioner<br>parameters:<br>  archiveOnDelete: <span class="hljs-string">&quot;true&quot;</span>  <span class="hljs-comment">## 删除pv的时候，pv的内容是否要备份</span><br><br>---<br>apiVersion: apps/v1<br>kind: Deployment<br>metadata:<br>  name: nfs-client-provisioner<br>  labels:<br>    app: nfs-client-provisioner<br>  <span class="hljs-comment"># replace with namespace where provisioner is deployed</span><br>  namespace: default<br>spec:<br>  replicas: 1<br>  strategy:<br>    <span class="hljs-built_in">type</span>: Recreate<br>  selector:<br>    matchLabels:<br>      app: nfs-client-provisioner<br>  template:<br>    metadata:<br>      labels:<br>        app: nfs-client-provisioner<br>    spec:<br>      serviceAccountName: nfs-client-provisioner<br>      containers:<br>        - name: nfs-client-provisioner<br>          image: registry.cn-hangzhou.aliyuncs.com/lfy_k8s_images/nfs-subdir-external-provisioner:v4.0.2<br>          <span class="hljs-comment"># resources:</span><br>          <span class="hljs-comment">#    limits:</span><br>          <span class="hljs-comment">#      cpu: 10m</span><br>          <span class="hljs-comment">#    requests:</span><br>          <span class="hljs-comment">#      cpu: 10m</span><br>          volumeMounts:<br>            - name: nfs-client-root<br>              mountPath: /persistentvolumes<br>          <span class="hljs-built_in">env</span>:<br>            - name: PROVISIONER_NAME<br>              value: k8s-sigs.io/nfs-subdir-external-provisioner<br>            - name: NFS_SERVER<br>              value: 172.31.0.204 <span class="hljs-comment">## 指定自己nfs服务器地址</span><br>            - name: NFS_PATH  <br>              value: /nfs/data  <span class="hljs-comment">## nfs服务器共享的目录</span><br>      volumes:<br>        - name: nfs-client-root<br>          nfs:<br>            server: 172.31.0.204<br>            path: /nfs/data<br>---<br>apiVersion: v1<br>kind: ServiceAccount<br>metadata:<br>  name: nfs-client-provisioner<br>  <span class="hljs-comment"># replace with namespace where provisioner is deployed</span><br>  namespace: default<br>---<br>kind: ClusterRole<br>apiVersion: rbac.authorization.k8s.io/v1<br>metadata:<br>  name: nfs-client-provisioner-runner<br>rules:<br>  - apiGroups: [<span class="hljs-string">&quot;&quot;</span>]<br>    resources: [<span class="hljs-string">&quot;nodes&quot;</span>]<br>    verbs: [<span class="hljs-string">&quot;get&quot;</span>, <span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br>  - apiGroups: [<span class="hljs-string">&quot;&quot;</span>]<br>    resources: [<span class="hljs-string">&quot;persistentvolumes&quot;</span>]<br>    verbs: [<span class="hljs-string">&quot;get&quot;</span>, <span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>, <span class="hljs-string">&quot;create&quot;</span>, <span class="hljs-string">&quot;delete&quot;</span>]<br>  - apiGroups: [<span class="hljs-string">&quot;&quot;</span>]<br>    resources: [<span class="hljs-string">&quot;persistentvolumeclaims&quot;</span>]<br>    verbs: [<span class="hljs-string">&quot;get&quot;</span>, <span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>, <span class="hljs-string">&quot;update&quot;</span>]<br>  - apiGroups: [<span class="hljs-string">&quot;storage.k8s.io&quot;</span>]<br>    resources: [<span class="hljs-string">&quot;storageclasses&quot;</span>]<br>    verbs: [<span class="hljs-string">&quot;get&quot;</span>, <span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br>  - apiGroups: [<span class="hljs-string">&quot;&quot;</span>]<br>    resources: [<span class="hljs-string">&quot;events&quot;</span>]<br>    verbs: [<span class="hljs-string">&quot;create&quot;</span>, <span class="hljs-string">&quot;update&quot;</span>, <span class="hljs-string">&quot;patch&quot;</span>]<br>---<br>kind: ClusterRoleBinding<br>apiVersion: rbac.authorization.k8s.io/v1<br>metadata:<br>  name: run-nfs-client-provisioner<br>subjects:<br>  - kind: ServiceAccount<br>    name: nfs-client-provisioner<br>    <span class="hljs-comment"># replace with namespace where provisioner is deployed</span><br>    namespace: default<br>roleRef:<br>  kind: ClusterRole<br>  name: nfs-client-provisioner-runner<br>  apiGroup: rbac.authorization.k8s.io<br>---<br>kind: Role<br>apiVersion: rbac.authorization.k8s.io/v1<br>metadata:<br>  name: leader-locking-nfs-client-provisioner<br>  <span class="hljs-comment"># replace with namespace where provisioner is deployed</span><br>  namespace: default<br>rules:<br>  - apiGroups: [<span class="hljs-string">&quot;&quot;</span>]<br>    resources: [<span class="hljs-string">&quot;endpoints&quot;</span>]<br>    verbs: [<span class="hljs-string">&quot;get&quot;</span>, <span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>, <span class="hljs-string">&quot;create&quot;</span>, <span class="hljs-string">&quot;update&quot;</span>, <span class="hljs-string">&quot;patch&quot;</span>]<br>---<br>kind: RoleBinding<br>apiVersion: rbac.authorization.k8s.io/v1<br>metadata:<br>  name: leader-locking-nfs-client-provisioner<br>  <span class="hljs-comment"># replace with namespace where provisioner is deployed</span><br>  namespace: default<br>subjects:<br>  - kind: ServiceAccount<br>    name: nfs-client-provisioner<br>    <span class="hljs-comment"># replace with namespace where provisioner is deployed</span><br>    namespace: default<br>roleRef:<br>  kind: Role<br>  name: leader-locking-nfs-client-provisioner<br>  apiGroup: rbac.authorization.k8s.io<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl apply -f sc.yaml <br><br><span class="hljs-comment"># 查看storageclass</span><br><span class="hljs-comment"># 确认配置是否生效</span><br>kubectl get sc<br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl get sc<br><br><span class="hljs-comment"># 创建pvc申请书</span><br>vi pvc.yaml<br><br>kind: PersistentVolumeClaim<br>apiVersion: v1<br>metadata:<br>  name: nginx-pvc<br>spec:<br>  accessModes:<br>    - ReadWriteMany<br>  resources:<br>    requests:<br>      storage: 200Mi<br><br><span class="hljs-comment"># 应用</span><br>kubectl apply -f pvc.yaml<br><br>kubectl get pvc<br><br>kubectl get pv<br></code></pre></td></tr></table></figure><h4 id="metrics-server"><a href="#metrics-server" class="headerlink" title="metrics-server"></a>metrics-server</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vi metrics.yaml<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><code class="hljs bash">apiVersion: v1<br>kind: ServiceAccount<br>metadata:<br>  labels:<br>    k8s-app: metrics-server<br>  name: metrics-server<br>  namespace: kube-system<br>---<br>apiVersion: rbac.authorization.k8s.io/v1<br>kind: ClusterRole<br>metadata:<br>  labels:<br>    k8s-app: metrics-server<br>    rbac.authorization.k8s.io/aggregate-to-admin: <span class="hljs-string">&quot;true&quot;</span><br>    rbac.authorization.k8s.io/aggregate-to-edit: <span class="hljs-string">&quot;true&quot;</span><br>    rbac.authorization.k8s.io/aggregate-to-view: <span class="hljs-string">&quot;true&quot;</span><br>  name: system:aggregated-metrics-reader<br>rules:<br>- apiGroups:<br>  - metrics.k8s.io<br>  resources:<br>  - pods<br>  - nodes<br>  verbs:<br>  - get<br>  - list<br>  - watch<br>---<br>apiVersion: rbac.authorization.k8s.io/v1<br>kind: ClusterRole<br>metadata:<br>  labels:<br>    k8s-app: metrics-server<br>  name: system:metrics-server<br>rules:<br>- apiGroups:<br>  - <span class="hljs-string">&quot;&quot;</span><br>  resources:<br>  - pods<br>  - nodes<br>  - nodes/stats<br>  - namespaces<br>  - configmaps<br>  verbs:<br>  - get<br>  - list<br>  - watch<br>---<br>apiVersion: rbac.authorization.k8s.io/v1<br>kind: RoleBinding<br>metadata:<br>  labels:<br>    k8s-app: metrics-server<br>  name: metrics-server-auth-reader<br>  namespace: kube-system<br>roleRef:<br>  apiGroup: rbac.authorization.k8s.io<br>  kind: Role<br>  name: extension-apiserver-authentication-reader<br>subjects:<br>- kind: ServiceAccount<br>  name: metrics-server<br>  namespace: kube-system<br>---<br>apiVersion: rbac.authorization.k8s.io/v1<br>kind: ClusterRoleBinding<br>metadata:<br>  labels:<br>    k8s-app: metrics-server<br>  name: metrics-server:system:auth-delegator<br>roleRef:<br>  apiGroup: rbac.authorization.k8s.io<br>  kind: ClusterRole<br>  name: system:auth-delegator<br>subjects:<br>- kind: ServiceAccount<br>  name: metrics-server<br>  namespace: kube-system<br>---<br>apiVersion: rbac.authorization.k8s.io/v1<br>kind: ClusterRoleBinding<br>metadata:<br>  labels:<br>    k8s-app: metrics-server<br>  name: system:metrics-server<br>roleRef:<br>  apiGroup: rbac.authorization.k8s.io<br>  kind: ClusterRole<br>  name: system:metrics-server<br>subjects:<br>- kind: ServiceAccount<br>  name: metrics-server<br>  namespace: kube-system<br>---<br>apiVersion: v1<br>kind: Service<br>metadata:<br>  labels:<br>    k8s-app: metrics-server<br>  name: metrics-server<br>  namespace: kube-system<br>spec:<br>  ports:<br>  - name: https<br>    port: 443<br>    protocol: TCP<br>    targetPort: https<br>  selector:<br>    k8s-app: metrics-server<br>---<br>apiVersion: apps/v1<br>kind: Deployment<br>metadata:<br>  labels:<br>    k8s-app: metrics-server<br>  name: metrics-server<br>  namespace: kube-system<br>spec:<br>  selector:<br>    matchLabels:<br>      k8s-app: metrics-server<br>  strategy:<br>    rollingUpdate:<br>      maxUnavailable: 0<br>  template:<br>    metadata:<br>      labels:<br>        k8s-app: metrics-server<br>    spec:<br>      containers:<br>      - args:<br>        - --cert-dir=/tmp<br>        - --kubelet-insecure-tls<br>        - --secure-port=4443<br>        - --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname<br>        - --kubelet-use-node-status-port<br>        image: registry.cn-hangzhou.aliyuncs.com/lfy_k8s_images/metrics-server:v0.4.3<br>        imagePullPolicy: IfNotPresent<br>        livenessProbe:<br>          failureThreshold: 3<br>          httpGet:<br>            path: /livez<br>            port: https<br>            scheme: HTTPS<br>          periodSeconds: 10<br>        name: metrics-server<br>        ports:<br>        - containerPort: 4443<br>          name: https<br>          protocol: TCP<br>        readinessProbe:<br>          failureThreshold: 3<br>          httpGet:<br>            path: /readyz<br>            port: https<br>            scheme: HTTPS<br>          periodSeconds: 10<br>        securityContext:<br>          readOnlyRootFilesystem: <span class="hljs-literal">true</span><br>          runAsNonRoot: <span class="hljs-literal">true</span><br>          runAsUser: 1000<br>        volumeMounts:<br>        - mountPath: /tmp<br>          name: tmp-dir<br>      nodeSelector:<br>        kubernetes.io/os: linux<br>      priorityClassName: system-cluster-critical<br>      serviceAccountName: metrics-server<br>      volumes:<br>      - emptyDir: &#123;&#125;<br>        name: tmp-dir<br>---<br>apiVersion: apiregistration.k8s.io/v1<br>kind: APIService<br>metadata:<br>  labels:<br>    k8s-app: metrics-server<br>  name: v1beta1.metrics.k8s.io<br>spec:<br>  group: metrics.k8s.io<br>  groupPriorityMinimum: 100<br>  insecureSkipTLSVerify: <span class="hljs-literal">true</span><br>  service:<br>    name: metrics-server<br>    namespace: kube-system<br>  version: v1beta1<br>  versionPriority: 100<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl apply -f metrics.yaml<br><br>kubectl get pod -A<br><br>kubectl top nodes<br><br><span class="hljs-comment"># 查看pod占用的内存, CPU</span><br>kubectl top pods<br><br>kubectl top pods -A<br></code></pre></td></tr></table></figure><h4 id="安装KubeSphere"><a href="#安装KubeSphere" class="headerlink" title="安装KubeSphere"></a>安装KubeSphere</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum install -y wget<br><br>yum install -y vim<br><br><span class="hljs-comment"># 下载配置文件, 或者使用下面提供的两个配置文件</span><br>wget https://github.com/kubesphere/ks-installer/releases/download/v3.1.1/kubesphere-installer.yaml<br><br>wget https://github.com/kubesphere/ks-installer/releases/download/v3.1.1/cluster-configuration.yaml<br><br><span class="hljs-comment"># 建议用vi粘贴代码进去, 之后再用vim编辑代码</span><br>vi kubesphere-installer.yaml<br><br><span class="hljs-comment"># 修改配置文件(将false改为true, 下面提供的配置文件已经修改好了, 可以直接粘贴)</span><br>vi cluster-configuration.yaml<br><br></code></pre></td></tr></table></figure><p>kubesphere-installer.yaml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apiextensions.k8s.io/v1beta1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">CustomResourceDefinition</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">clusterconfigurations.installer.kubesphere.io</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">group:</span> <span class="hljs-string">installer.kubesphere.io</span><br>  <span class="hljs-attr">versions:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">v1alpha1</span><br>    <span class="hljs-attr">served:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">storage:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">scope:</span> <span class="hljs-string">Namespaced</span><br>  <span class="hljs-attr">names:</span><br>    <span class="hljs-attr">plural:</span> <span class="hljs-string">clusterconfigurations</span><br>    <span class="hljs-attr">singular:</span> <span class="hljs-string">clusterconfiguration</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterConfiguration</span><br>    <span class="hljs-attr">shortNames:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">cc</span><br><br><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Namespace</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">kubesphere-system</span><br><br><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ServiceAccount</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">ks-installer</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">kubesphere-system</span><br><br><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">rbac.authorization.k8s.io/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRole</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">ks-installer</span><br><span class="hljs-attr">rules:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">apps</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">extensions</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">batch</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">rbac.authorization.k8s.io</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">apiregistration.k8s.io</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">apiextensions.k8s.io</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">tenant.kubesphere.io</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">certificates.k8s.io</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">devops.kubesphere.io</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">monitoring.coreos.com</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">logging.kubesphere.io</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">jaegertracing.io</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">storage.k8s.io</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">admissionregistration.k8s.io</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">policy</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">autoscaling</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">networking.istio.io</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">config.istio.io</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">iam.kubesphere.io</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">notification.kubesphere.io</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">auditing.kubesphere.io</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">events.kubesphere.io</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">core.kubefed.io</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">installer.kubesphere.io</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">storage.kubesphere.io</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">security.istio.io</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">monitoring.kiali.io</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">kiali.io</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">networking.k8s.io</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">kubeedge.kubesphere.io</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">types.kubefed.io</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*&#x27;</span><br><br><span class="hljs-meta">---</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRoleBinding</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">rbac.authorization.k8s.io/v1</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">ks-installer</span><br><span class="hljs-attr">subjects:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">kind:</span> <span class="hljs-string">ServiceAccount</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">ks-installer</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">kubesphere-system</span><br><span class="hljs-attr">roleRef:</span><br>  <span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRole</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">ks-installer</span><br>  <span class="hljs-attr">apiGroup:</span> <span class="hljs-string">rbac.authorization.k8s.io</span><br><br><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">ks-installer</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">kubesphere-system</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">ks-install</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">ks-install</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">ks-install</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">serviceAccountName:</span> <span class="hljs-string">ks-installer</span><br>      <span class="hljs-attr">containers:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">installer</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">kubesphere/ks-installer:v3.1.1</span><br>        <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">&quot;Always&quot;</span><br>        <span class="hljs-attr">resources:</span><br>          <span class="hljs-attr">limits:</span><br>            <span class="hljs-attr">cpu:</span> <span class="hljs-string">&quot;1&quot;</span><br>            <span class="hljs-attr">memory:</span> <span class="hljs-string">1Gi</span><br>          <span class="hljs-attr">requests:</span><br>            <span class="hljs-attr">cpu:</span> <span class="hljs-string">20m</span><br>            <span class="hljs-attr">memory:</span> <span class="hljs-string">100Mi</span><br>        <span class="hljs-attr">volumeMounts:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/etc/localtime</span><br>          <span class="hljs-attr">name:</span> <span class="hljs-string">host-time</span><br>      <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">hostPath:</span><br>          <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/localtime</span><br>          <span class="hljs-attr">type:</span> <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-attr">name:</span> <span class="hljs-string">host-time</span><br><br></code></pre></td></tr></table></figure><p>cluster-configuration.yaml (已经将false改成true了, endpointIps需要换成对应的master的IP)</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">installer.kubesphere.io/v1alpha1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterConfiguration</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">ks-installer</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">kubesphere-system</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">version:</span> <span class="hljs-string">v3.1.1</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">persistence:</span><br>    <span class="hljs-attr">storageClass:</span> <span class="hljs-string">&quot;&quot;</span>        <span class="hljs-comment"># If there is no default StorageClass in your cluster, you need to specify an existing StorageClass here.</span><br>  <span class="hljs-attr">authentication:</span><br>    <span class="hljs-attr">jwtSecret:</span> <span class="hljs-string">&quot;&quot;</span>           <span class="hljs-comment"># Keep the jwtSecret consistent with the Host Cluster. Retrieve the jwtSecret by executing &quot;kubectl -n kubesphere-system get cm kubesphere-config -o yaml | grep -v &quot;apiVersion&quot; | grep jwtSecret&quot; on the Host Cluster.</span><br>  <span class="hljs-attr">local_registry:</span> <span class="hljs-string">&quot;&quot;</span>        <span class="hljs-comment"># Add your private registry address if it is needed.</span><br>  <span class="hljs-attr">etcd:</span><br>    <span class="hljs-attr">monitoring:</span> <span class="hljs-literal">true</span>       <span class="hljs-comment"># Enable or disable etcd monitoring dashboard installation. You have to create a Secret for etcd before you enable it.</span><br>    <span class="hljs-attr">endpointIps:</span> <span class="hljs-number">172.31</span><span class="hljs-number">.0</span><span class="hljs-number">.204</span>  <span class="hljs-comment"># etcd cluster EndpointIps. It can be a bunch of IPs here.</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">2379</span>              <span class="hljs-comment"># etcd port.</span><br>    <span class="hljs-attr">tlsEnable:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">common:</span><br>    <span class="hljs-attr">redis:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">openldap:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">minioVolumeSize:</span> <span class="hljs-string">20Gi</span> <span class="hljs-comment"># Minio PVC size.</span><br>    <span class="hljs-attr">openldapVolumeSize:</span> <span class="hljs-string">2Gi</span>   <span class="hljs-comment"># openldap PVC size.</span><br>    <span class="hljs-attr">redisVolumSize:</span> <span class="hljs-string">2Gi</span> <span class="hljs-comment"># Redis PVC size.</span><br>    <span class="hljs-attr">monitoring:</span><br>      <span class="hljs-comment"># type: external   # Whether to specify the external prometheus stack, and need to modify the endpoint at the next line.</span><br>      <span class="hljs-attr">endpoint:</span> <span class="hljs-string">http://prometheus-operated.kubesphere-monitoring-system.svc:9090</span> <span class="hljs-comment"># Prometheus endpoint to get metrics data.</span><br>    <span class="hljs-attr">es:</span>   <span class="hljs-comment"># Storage backend for logging, events and auditing.</span><br>      <span class="hljs-comment"># elasticsearchMasterReplicas: 1   # The total number of master nodes. Even numbers are not allowed.</span><br>      <span class="hljs-comment"># elasticsearchDataReplicas: 1     # The total number of data nodes.</span><br>      <span class="hljs-attr">elasticsearchMasterVolumeSize:</span> <span class="hljs-string">4Gi</span>   <span class="hljs-comment"># The volume size of Elasticsearch master nodes.</span><br>      <span class="hljs-attr">elasticsearchDataVolumeSize:</span> <span class="hljs-string">20Gi</span>    <span class="hljs-comment"># The volume size of Elasticsearch data nodes.</span><br>      <span class="hljs-attr">logMaxAge:</span> <span class="hljs-number">7</span>                     <span class="hljs-comment"># Log retention time in built-in Elasticsearch. It is 7 days by default.</span><br>      <span class="hljs-attr">elkPrefix:</span> <span class="hljs-string">logstash</span>              <span class="hljs-comment"># The string making up index names. The index name will be formatted as ks-&lt;elk_prefix&gt;-log.</span><br>      <span class="hljs-attr">basicAuth:</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>        <span class="hljs-attr">username:</span> <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-attr">password:</span> <span class="hljs-string">&quot;&quot;</span><br>      <span class="hljs-attr">externalElasticsearchUrl:</span> <span class="hljs-string">&quot;&quot;</span><br>      <span class="hljs-attr">externalElasticsearchPort:</span> <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">console:</span><br>    <span class="hljs-attr">enableMultiLogin:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment"># Enable or disable simultaneous logins. It allows different users to log in with the same account at the same time.</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">30880</span><br>  <span class="hljs-attr">alerting:</span>                <span class="hljs-comment"># (CPU: 0.1 Core, Memory: 100 MiB) It enables users to customize alerting policies to send messages to receivers in time with different time intervals and alerting levels to choose from.</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>         <span class="hljs-comment"># Enable or disable the KubeSphere Alerting System.</span><br>    <span class="hljs-comment"># thanosruler:</span><br>    <span class="hljs-comment">#   replicas: 1</span><br>    <span class="hljs-comment">#   resources: &#123;&#125;</span><br>  <span class="hljs-attr">auditing:</span>                <span class="hljs-comment"># Provide a security-relevant chronological set of records，recording the sequence of activities happening on the platform, initiated by different tenants.</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>         <span class="hljs-comment"># Enable or disable the KubeSphere Auditing Log System. </span><br>  <span class="hljs-attr">devops:</span>                  <span class="hljs-comment"># (CPU: 0.47 Core, Memory: 8.6 G) Provide an out-of-the-box CI/CD system based on Jenkins, and automated workflow tools including Source-to-Image &amp; Binary-to-Image.</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>             <span class="hljs-comment"># Enable or disable the KubeSphere DevOps System.</span><br>    <span class="hljs-attr">jenkinsMemoryLim:</span> <span class="hljs-string">2Gi</span>      <span class="hljs-comment"># Jenkins memory limit.</span><br>    <span class="hljs-attr">jenkinsMemoryReq:</span> <span class="hljs-string">1500Mi</span>   <span class="hljs-comment"># Jenkins memory request.</span><br>    <span class="hljs-attr">jenkinsVolumeSize:</span> <span class="hljs-string">8Gi</span>     <span class="hljs-comment"># Jenkins volume size.</span><br>    <span class="hljs-attr">jenkinsJavaOpts_Xms:</span> <span class="hljs-string">512m</span>  <span class="hljs-comment"># The following three fields are JVM parameters.</span><br>    <span class="hljs-attr">jenkinsJavaOpts_Xmx:</span> <span class="hljs-string">512m</span><br>    <span class="hljs-attr">jenkinsJavaOpts_MaxRAM:</span> <span class="hljs-string">2g</span><br>  <span class="hljs-attr">events:</span>                  <span class="hljs-comment"># Provide a graphical web console for Kubernetes Events exporting, filtering and alerting in multi-tenant Kubernetes clusters.</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>         <span class="hljs-comment"># Enable or disable the KubeSphere Events System.</span><br>    <span class="hljs-attr">ruler:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-attr">replicas:</span> <span class="hljs-number">2</span><br>  <span class="hljs-attr">logging:</span>                 <span class="hljs-comment"># (CPU: 57 m, Memory: 2.76 G) Flexible logging functions are provided for log query, collection and management in a unified console. Additional log collectors can be added, such as Elasticsearch, Kafka and Fluentd.</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>         <span class="hljs-comment"># Enable or disable the KubeSphere Logging System.</span><br>    <span class="hljs-attr">logsidecar:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-attr">replicas:</span> <span class="hljs-number">2</span><br>  <span class="hljs-attr">metrics_server:</span>                    <span class="hljs-comment"># (CPU: 56 m, Memory: 44.35 MiB) It enables HPA (Horizontal Pod Autoscaler).</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span>                   <span class="hljs-comment"># Enable or disable metrics-server.</span><br>  <span class="hljs-attr">monitoring:</span><br>    <span class="hljs-attr">storageClass:</span> <span class="hljs-string">&quot;&quot;</span>                 <span class="hljs-comment"># If there is an independent StorageClass you need for Prometheus, you can specify it here. The default StorageClass is used by default.</span><br>    <span class="hljs-comment"># prometheusReplicas: 1          # Prometheus replicas are responsible for monitoring different segments of data source and providing high availability.</span><br>    <span class="hljs-attr">prometheusMemoryRequest:</span> <span class="hljs-string">400Mi</span>   <span class="hljs-comment"># Prometheus request memory.</span><br>    <span class="hljs-attr">prometheusVolumeSize:</span> <span class="hljs-string">20Gi</span>       <span class="hljs-comment"># Prometheus PVC size.</span><br>    <span class="hljs-comment"># alertmanagerReplicas: 1          # AlertManager Replicas.</span><br>  <span class="hljs-attr">multicluster:</span><br>    <span class="hljs-attr">clusterRole:</span> <span class="hljs-string">none</span>  <span class="hljs-comment"># host | member | none  # You can install a solo cluster, or specify it as the Host or Member Cluster.</span><br>  <span class="hljs-attr">network:</span><br>    <span class="hljs-attr">networkpolicy:</span> <span class="hljs-comment"># Network policies allow network isolation within the same cluster, which means firewalls can be set up between certain instances (Pods).</span><br>      <span class="hljs-comment"># Make sure that the CNI network plugin used by the cluster supports NetworkPolicy. There are a number of CNI network plugins that support NetworkPolicy, including Calico, Cilium, Kube-router, Romana and Weave Net.</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># Enable or disable network policies.</span><br>    <span class="hljs-attr">ippool:</span> <span class="hljs-comment"># Use Pod IP Pools to manage the Pod network address space. Pods to be created can be assigned IP addresses from a Pod IP Pool.</span><br>      <span class="hljs-attr">type:</span> <span class="hljs-string">calico</span> <span class="hljs-comment"># Specify &quot;calico&quot; for this field if Calico is used as your CNI plugin. &quot;none&quot; means that Pod IP Pools are disabled.</span><br>    <span class="hljs-attr">topology:</span> <span class="hljs-comment"># Use Service Topology to view Service-to-Service communication based on Weave Scope.</span><br>      <span class="hljs-attr">type:</span> <span class="hljs-string">none</span> <span class="hljs-comment"># Specify &quot;weave-scope&quot; for this field to enable Service Topology. &quot;none&quot; means that Service Topology is disabled.</span><br>  <span class="hljs-attr">openpitrix:</span> <span class="hljs-comment"># An App Store that is accessible to all platform tenants. You can use it to manage apps across their entire lifecycle.</span><br>    <span class="hljs-attr">store:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># Enable or disable the KubeSphere App Store.</span><br>  <span class="hljs-attr">servicemesh:</span>         <span class="hljs-comment"># (0.3 Core, 300 MiB) Provide fine-grained traffic management, observability and tracing, and visualized traffic topology.</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>     <span class="hljs-comment"># Base component (pilot). Enable or disable KubeSphere Service Mesh (Istio-based).</span><br>  <span class="hljs-attr">kubeedge:</span>          <span class="hljs-comment"># Add edge nodes to your cluster and deploy workloads on edge nodes.</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>   <span class="hljs-comment"># Enable or disable KubeEdge.</span><br>    <span class="hljs-attr">cloudCore:</span><br>      <span class="hljs-attr">nodeSelector:</span> &#123;<span class="hljs-attr">&quot;node-role.kubernetes.io/worker&quot;:</span> <span class="hljs-string">&quot;&quot;</span>&#125;<br>      <span class="hljs-attr">tolerations:</span> []<br>      <span class="hljs-attr">cloudhubPort:</span> <span class="hljs-string">&quot;10000&quot;</span><br>      <span class="hljs-attr">cloudhubQuicPort:</span> <span class="hljs-string">&quot;10001&quot;</span><br>      <span class="hljs-attr">cloudhubHttpsPort:</span> <span class="hljs-string">&quot;10002&quot;</span><br>      <span class="hljs-attr">cloudstreamPort:</span> <span class="hljs-string">&quot;10003&quot;</span><br>      <span class="hljs-attr">tunnelPort:</span> <span class="hljs-string">&quot;10004&quot;</span><br>      <span class="hljs-attr">cloudHub:</span><br>        <span class="hljs-attr">advertiseAddress:</span> <span class="hljs-comment"># At least a public IP address or an IP address which can be accessed by edge nodes must be provided.</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;&quot;</span>            <span class="hljs-comment"># Note that once KubeEdge is enabled, CloudCore will malfunction if the address is not provided.</span><br>        <span class="hljs-attr">nodeLimit:</span> <span class="hljs-string">&quot;100&quot;</span><br>      <span class="hljs-attr">service:</span><br>        <span class="hljs-attr">cloudhubNodePort:</span> <span class="hljs-string">&quot;30000&quot;</span><br>        <span class="hljs-attr">cloudhubQuicNodePort:</span> <span class="hljs-string">&quot;30001&quot;</span><br>        <span class="hljs-attr">cloudhubHttpsNodePort:</span> <span class="hljs-string">&quot;30002&quot;</span><br>        <span class="hljs-attr">cloudstreamNodePort:</span> <span class="hljs-string">&quot;30003&quot;</span><br>        <span class="hljs-attr">tunnelNodePort:</span> <span class="hljs-string">&quot;30004&quot;</span><br>    <span class="hljs-attr">edgeWatcher:</span><br>      <span class="hljs-attr">nodeSelector:</span> &#123;<span class="hljs-attr">&quot;node-role.kubernetes.io/worker&quot;:</span> <span class="hljs-string">&quot;&quot;</span>&#125;<br>      <span class="hljs-attr">tolerations:</span> []<br>      <span class="hljs-attr">edgeWatcherAgent:</span><br>        <span class="hljs-attr">nodeSelector:</span> &#123;<span class="hljs-attr">&quot;node-role.kubernetes.io/worker&quot;:</span> <span class="hljs-string">&quot;&quot;</span>&#125;<br>        <span class="hljs-attr">tolerations:</span> []<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 应用完之后耐心等等</span><br>kubectl apply -f kubesphere-installer.yaml<br><br>kubectl apply -f cluster-configuration.yaml<br><br><span class="hljs-comment"># 添加secret</span><br>kubectl -n kubesphere-monitoring-system create secret generic kube-etcd-client-certs  --from-file=etcd-client-ca.crt=/etc/kubernetes/pki/etcd/ca.crt  --from-file=etcd-client.crt=/etc/kubernetes/pki/apiserver-etcd-client.crt  --from-file=etcd-client.key=/etc/kubernetes/pki/apiserver-etcd-client.key<br><br><span class="hljs-comment"># 监控日志</span><br>kubectl logs -n kubesphere-system $(kubectl get pod -n kubesphere-system -l app=ks-install -o jsonpath=<span class="hljs-string">&#x27;&#123;.items[0].metadata.name&#125;&#x27;</span>) -f<br><br><span class="hljs-comment"># Console: http://172.31.0.204:30880</span><br><span class="hljs-comment"># Account: admin</span><br><span class="hljs-comment"># Password: P@88w0rd</span><br><br><span class="hljs-comment"># 描述</span><br>kubectl describe pod -n pod名 命名空间<br>kubectl describe pod pod名 -n 命名空间<br></code></pre></td></tr></table></figure><p>集群密码: 12345Xia<br>需要开放30000-32767端口, 这个是NodePort默认端口</p><h3 id="2-Linux单节点部署KubeSphere"><a href="#2-Linux单节点部署KubeSphere" class="headerlink" title="2. Linux单节点部署KubeSphere"></a>2. Linux单节点部署KubeSphere</h3><blockquote><p>centos7.9 4C8G 配置主机名 安全组开放30000&#x2F;32767</p></blockquote><p><a href="https://www.kubesphere.io/zh/docs/v3.3/quick-start/all-in-one-on-linux/">官方文档</a></p><h4 id="准备kubeKey"><a href="#准备kubeKey" class="headerlink" title="准备kubeKey"></a>准备kubeKey</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 设置一下主机名</span><br>hostnamectl set-hostname node1<br><br><span class="hljs-built_in">export</span> KKZONE=cn<br><br>curl -sfL https://get-kk.kubesphere.io | VERSION=v3.0.7 sh -<br><br><span class="hljs-built_in">chmod</span> +x kk<br></code></pre></td></tr></table></figure><h4 id="使用KubeKey引导安装集群"><a href="#使用KubeKey引导安装集群" class="headerlink" title="使用KubeKey引导安装集群"></a>使用KubeKey引导安装集群</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">./kk create cluster --with-kubernetes v1.22.12 --with-kubesphere v3.3.2<br><br><span class="hljs-comment"># 中间输入一下yes</span><br><span class="hljs-built_in">yes</span><br><br><span class="hljs-comment"># 验证结果</span><br>kubectl logs -n kubesphere-system $(kubectl get pod -n kubesphere-system -l <span class="hljs-string">&#x27;app in (ks-install, ks-installer)&#x27;</span> -o jsonpath=<span class="hljs-string">&#x27;&#123;.items[0].metadata.name&#125;&#x27;</span>) -f<br><br></code></pre></td></tr></table></figure><p>如果见到如下内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">10:41:13 CST [ERRO] node1: conntrack is required.<br>10:41:13 CST [ERRO] node1: socat is required.<br><br><span class="hljs-comment"># 请先安装conntrack, socat, 缺什么安装什么, 安装完成之后再执行kk脚本</span><br>yum install -y conntrack<br>yum install -y socat<br></code></pre></td></tr></table></figure><p>安装完成之后出现</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs clean">#####################################################<br>###              Welcome to KubeSphere!           ###<br>#####################################################<br><br>Console: http:<span class="hljs-comment">//172.31.0.2:30880</span><br>Account: admin<br>Password: P@<span class="hljs-number">88</span>w0rd<br>NOTES：<br>  <span class="hljs-number">1.</span> After you log into the console, please check the<br>     monitoring status <span class="hljs-keyword">of</span> service components <span class="hljs-keyword">in</span><br>     <span class="hljs-string">&quot;Cluster Management&quot;</span>. If any service is not<br>     ready, please wait patiently until all components <br>     are up and running.<br>  <span class="hljs-number">2.</span> Please change the default password after login.<br><br>#####################################################<br>https:<span class="hljs-comment">//kubesphere.io             2023-05-21 12:04:23</span><br>#####################################################<br><span class="hljs-number">12</span>:<span class="hljs-number">04</span>:<span class="hljs-number">24</span> CST success: [node1]<br><span class="hljs-number">12</span>:<span class="hljs-number">04</span>:<span class="hljs-number">24</span> CST Pipeline[CreateClusterPipeline] execute successfully<br>Installation is complete.<br><br>Please check the result using the command:<br><br>        kubectl logs -n kubesphere-<span class="hljs-keyword">system</span> $(kubectl get pod -n kubesphere-<span class="hljs-keyword">system</span> -l <span class="hljs-string">&#x27;app in (ks-install, ks-installer)&#x27;</span> -o jsonpath=<span class="hljs-string">&#x27;&#123;.items[0].metadata.name&#125;&#x27;</span>) -f<br></code></pre></td></tr></table></figure><p>这种方式安装是最小安装, 如果想开启其他功能可以在自定义资源进行开启<br><img src="/assets/b6c9eea929b8422190a6cdcc0fe247bb.png"></p><p>另外遇到的一个bug</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 使用kk脚本之后, 出现的recognize &quot;/etc/kubernetes/network-plugin.yaml&quot;</span><br>error: unable to recognize <span class="hljs-string">&quot;/etc/kubernetes/network-plugin.yaml&quot;</span>: no matches <span class="hljs-keyword">for</span> kind <span class="hljs-string">&quot;PodDisruptionBudget&quot;</span> <span class="hljs-keyword">in</span> version <span class="hljs-string">&quot;policy/v1&quot;</span><br><br><span class="hljs-comment"># 额, 其实我也不知道怎么解决, github找的一个issue, 但是不会解决</span><br><span class="hljs-comment"># https://github.com/kubesphere/kubesphere/issues/5272</span><br><span class="hljs-comment"># 卸载kubenetes(光卸载还不够, 最好还是重装系统), 参考官方文档重新安装吧</span><br><span class="hljs-comment"># https://www.kubesphere.io/zh/docs/v3.3/quick-start/all-in-one-on-linux/</span><br><br></code></pre></td></tr></table></figure><h3 id="3-Linux多节点部署KubeSphere"><a href="#3-Linux多节点部署KubeSphere" class="headerlink" title="3. Linux多节点部署KubeSphere"></a>3. Linux多节点部署KubeSphere</h3><p><a href="https://www.kubesphere.io/zh/docs/v3.3/installing-on-linux/introduction/multioverview/">多节点安装</a></p><blockquote><p>两台centos7.9 2C4G(没钱了) 配置主机名 安全组开放30000&#x2F;32767</p></blockquote><h4 id="准备kubeKey-1"><a href="#准备kubeKey-1" class="headerlink" title="准备kubeKey"></a>准备kubeKey</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 设置一下主机名</span><br>hostnamectl set-hostname master<br>hostnamectl set-hostname node1<br><br><span class="hljs-comment"># master节点执行</span><br><span class="hljs-built_in">export</span> KKZONE=cn<br><br>curl -sfL https://get-kk.kubesphere.io | VERSION=v3.0.7 sh -<br><br><span class="hljs-built_in">chmod</span> +x kk<br></code></pre></td></tr></table></figure><h4 id="创建配置文件"><a href="#创建配置文件" class="headerlink" title="创建配置文件"></a>创建配置文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 指定kubernetes和kubesphere版本</span><br>./kk create config --with-kubernetes v1.22.12 --with-kubesphere v3.3.2<br></code></pre></td></tr></table></figure><h4 id="编辑配置文件"><a href="#编辑配置文件" class="headerlink" title="编辑配置文件"></a>编辑配置文件</h4><p>vi config-sample.yaml</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br>apiVersion: kubekey.kubesphere.io/v1alpha2<br>kind: Cluster<br>metadata:<br>  name: sample<br>spec:<br>  hosts:<br>  - &#123;name: master, address: 172.31.0.2, internalAddress: 172.31.0.2, user: root, password: <span class="hljs-string">&quot;12345@Xia&quot;</span>&#125;<br>  - &#123;name: node1, address: 172.31.0.3, internalAddress: 172.31.0.3, user: root, password: <span class="hljs-string">&quot;12345@Xia&quot;</span>&#125;<br>  roleGroups:<br>    etcd:<br>    - master<br>    control-plane: <br>    - master<br>    worker:<br>    - master<br>    - node1<br>  controlPlaneEndpoint:<br>    <span class="hljs-comment">## Internal loadbalancer for apiservers </span><br>    <span class="hljs-comment"># internalLoadbalancer: haproxy</span><br><br>    domain: lb.kubesphere.local<br>    address: <span class="hljs-string">&quot;&quot;</span><br>    port: 6443<br>  kubernetes:<br>    version: v1.22.12<br>    clusterName: cluster.local<br>    autoRenewCerts: <span class="hljs-literal">true</span><br>    containerManager: docker<br>  etcd:<br>    <span class="hljs-built_in">type</span>: kubekey<br>  network:<br>    plugin: calico<br>    kubePodsCIDR: 10.233.64.0/18<br>    kubeServiceCIDR: 10.233.0.0/18<br>    <span class="hljs-comment">## multus support. https://github.com/k8snetworkplumbingwg/multus-cni</span><br>    multusCNI:<br>      enabled: <span class="hljs-literal">false</span><br>  registry:<br>    privateRegistry: <span class="hljs-string">&quot;&quot;</span><br>    namespaceOverride: <span class="hljs-string">&quot;&quot;</span><br>    registryMirrors: []<br>    insecureRegistries: []<br>  addons: []<br><br><br><br>---<br>apiVersion: installer.kubesphere.io/v1alpha1<br>kind: ClusterConfiguration<br>metadata:<br>  name: ks-installer<br>  namespace: kubesphere-system<br>  labels:<br>    version: v3.3.2<br>spec:<br>  persistence:<br>    storageClass: <span class="hljs-string">&quot;&quot;</span><br>  authentication:<br>    jwtSecret: <span class="hljs-string">&quot;&quot;</span><br>  zone: <span class="hljs-string">&quot;&quot;</span><br>  local_registry: <span class="hljs-string">&quot;&quot;</span><br>  namespace_override: <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-comment"># dev_tag: &quot;&quot;</span><br>  etcd:<br>    monitoring: <span class="hljs-literal">false</span><br>    endpointIps: localhost<br>    port: 2379<br>    tlsEnable: <span class="hljs-literal">true</span><br>  common:<br>    core:<br>      console:<br>        enableMultiLogin: <span class="hljs-literal">true</span><br>        port: 30880<br>        <span class="hljs-built_in">type</span>: NodePort<br>    <span class="hljs-comment"># apiserver:</span><br>    <span class="hljs-comment">#  resources: &#123;&#125;</span><br>    <span class="hljs-comment"># controllerManager:</span><br>    <span class="hljs-comment">#  resources: &#123;&#125;</span><br>    redis:<br>      enabled: <span class="hljs-literal">false</span><br>      volumeSize: 2Gi<br>    openldap:<br>      enabled: <span class="hljs-literal">false</span><br>      volumeSize: 2Gi<br>    minio:<br>      volumeSize: 20Gi<br>    monitoring:<br>      <span class="hljs-comment"># type: external</span><br>      endpoint: http://prometheus-operated.kubesphere-monitoring-system.svc:9090<br>      GPUMonitoring:<br>        enabled: <span class="hljs-literal">false</span><br>    gpu:<br>      kinds:<br>      - resourceName: <span class="hljs-string">&quot;nvidia.com/gpu&quot;</span><br>        resourceType: <span class="hljs-string">&quot;GPU&quot;</span><br>        default: <span class="hljs-literal">true</span><br>    es:<br>      <span class="hljs-comment"># master:</span><br>      <span class="hljs-comment">#   volumeSize: 4Gi</span><br>      <span class="hljs-comment">#   replicas: 1</span><br>      <span class="hljs-comment">#   resources: &#123;&#125;</span><br>      <span class="hljs-comment"># data:</span><br>      <span class="hljs-comment">#   volumeSize: 20Gi</span><br>      <span class="hljs-comment">#   replicas: 1</span><br>      <span class="hljs-comment">#   resources: &#123;&#125;</span><br>      logMaxAge: 7<br>      elkPrefix: logstash<br>      basicAuth:<br>        enabled: <span class="hljs-literal">false</span><br>        username: <span class="hljs-string">&quot;&quot;</span><br>        password: <span class="hljs-string">&quot;&quot;</span><br>      externalElasticsearchHost: <span class="hljs-string">&quot;&quot;</span><br>      externalElasticsearchPort: <span class="hljs-string">&quot;&quot;</span><br>  alerting:<br>    enabled: <span class="hljs-literal">false</span><br>    <span class="hljs-comment"># thanosruler:</span><br>    <span class="hljs-comment">#   replicas: 1</span><br>    <span class="hljs-comment">#   resources: &#123;&#125;</span><br>  auditing:<br>    enabled: <span class="hljs-literal">false</span><br>    <span class="hljs-comment"># operator:</span><br>    <span class="hljs-comment">#   resources: &#123;&#125;</span><br>    <span class="hljs-comment"># webhook:</span><br>    <span class="hljs-comment">#   resources: &#123;&#125;</span><br>  devops:<br>    enabled: <span class="hljs-literal">false</span><br>    <span class="hljs-comment"># resources: &#123;&#125;</span><br>    jenkinsMemoryLim: 8Gi<br>    jenkinsMemoryReq: 4Gi<br>    jenkinsVolumeSize: 8Gi<br>  events:<br>    enabled: <span class="hljs-literal">false</span><br>    <span class="hljs-comment"># operator:</span><br>    <span class="hljs-comment">#   resources: &#123;&#125;</span><br>    <span class="hljs-comment"># exporter:</span><br>    <span class="hljs-comment">#   resources: &#123;&#125;</span><br>    <span class="hljs-comment"># ruler:</span><br>    <span class="hljs-comment">#   enabled: true</span><br>    <span class="hljs-comment">#   replicas: 2</span><br>    <span class="hljs-comment">#   resources: &#123;&#125;</span><br>  logging:<br>    enabled: <span class="hljs-literal">false</span><br>    logsidecar:<br>      enabled: <span class="hljs-literal">true</span><br>      replicas: 2<br>      <span class="hljs-comment"># resources: &#123;&#125;</span><br>  metrics_server:<br>    enabled: <span class="hljs-literal">false</span><br>  monitoring:<br>    storageClass: <span class="hljs-string">&quot;&quot;</span><br>    node_exporter:<br>      port: 9100<br>      <span class="hljs-comment"># resources: &#123;&#125;</span><br>    <span class="hljs-comment"># kube_rbac_proxy:</span><br>    <span class="hljs-comment">#   resources: &#123;&#125;</span><br>    <span class="hljs-comment"># kube_state_metrics:</span><br>    <span class="hljs-comment">#   resources: &#123;&#125;</span><br>    <span class="hljs-comment"># prometheus:</span><br>    <span class="hljs-comment">#   replicas: 1</span><br>    <span class="hljs-comment">#   volumeSize: 20Gi</span><br>    <span class="hljs-comment">#   resources: &#123;&#125;</span><br>    <span class="hljs-comment">#   operator:</span><br>    <span class="hljs-comment">#     resources: &#123;&#125;</span><br>    <span class="hljs-comment"># alertmanager:</span><br>    <span class="hljs-comment">#   replicas: 1</span><br>    <span class="hljs-comment">#   resources: &#123;&#125;</span><br>    <span class="hljs-comment"># notification_manager:</span><br>    <span class="hljs-comment">#   resources: &#123;&#125;</span><br>    <span class="hljs-comment">#   operator:</span><br>    <span class="hljs-comment">#     resources: &#123;&#125;</span><br>    <span class="hljs-comment">#   proxy:</span><br>    <span class="hljs-comment">#     resources: &#123;&#125;</span><br>    gpu:<br>      nvidia_dcgm_exporter:<br>        enabled: <span class="hljs-literal">false</span><br>        <span class="hljs-comment"># resources: &#123;&#125;</span><br>  multicluster:<br>    clusterRole: none<br>  network:<br>    networkpolicy:<br>      enabled: <span class="hljs-literal">false</span><br>    ippool:<br>      <span class="hljs-built_in">type</span>: none<br>    topology:<br>      <span class="hljs-built_in">type</span>: none<br>  openpitrix:<br>    store:<br>      enabled: <span class="hljs-literal">false</span><br>  servicemesh:<br>    enabled: <span class="hljs-literal">false</span><br>    istio:<br>      components:<br>        ingressGateways:<br>        - name: istio-ingressgateway<br>          enabled: <span class="hljs-literal">false</span><br>        cni:<br>          enabled: <span class="hljs-literal">false</span><br>  edgeruntime:<br>    enabled: <span class="hljs-literal">false</span><br>    kubeedge:<br>      enabled: <span class="hljs-literal">false</span><br>      cloudCore:<br>        cloudHub:<br>          advertiseAddress:<br>            - <span class="hljs-string">&quot;&quot;</span><br>        service:<br>          cloudhubNodePort: <span class="hljs-string">&quot;30000&quot;</span><br>          cloudhubQuicNodePort: <span class="hljs-string">&quot;30001&quot;</span><br>          cloudhubHttpsNodePort: <span class="hljs-string">&quot;30002&quot;</span><br>          cloudstreamNodePort: <span class="hljs-string">&quot;30003&quot;</span><br>          tunnelNodePort: <span class="hljs-string">&quot;30004&quot;</span><br>        <span class="hljs-comment"># resources: &#123;&#125;</span><br>        <span class="hljs-comment"># hostNetWork: false</span><br>      iptables-manager:<br>        enabled: <span class="hljs-literal">true</span><br>        mode: <span class="hljs-string">&quot;external&quot;</span><br>        <span class="hljs-comment"># resources: &#123;&#125;</span><br>      <span class="hljs-comment"># edgeService:</span><br>      <span class="hljs-comment">#   resources: &#123;&#125;</span><br>  terminal:<br>    <span class="hljs-built_in">timeout</span>: 600<br><br><br><br></code></pre></td></tr></table></figure><p><img src="/assets/7bece05b9fcb44ca99f59d42862d69d5.png"></p><h4 id="使用配置文件创建集群"><a href="#使用配置文件创建集群" class="headerlink" title="使用配置文件创建集群"></a>使用配置文件创建集群</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 这个只需要在master节点上安装就可以了</span><br>./kk create cluster -f config-sample.yaml<br><br><span class="hljs-comment"># 中途输入yes</span><br><span class="hljs-built_in">yes</span><br><br><span class="hljs-comment"># 然后耐心等等， 大概十多分钟</span><br><br><span class="hljs-comment"># 缺什么安装什么</span><br>12:36:51 CST [ERRO] master: conntrack is required.<br>12:36:51 CST [ERRO] master: socat is required.<br>12:36:51 CST [ERRO] node1: conntrack is required.<br>12:36:51 CST [ERRO] node1: socat is required.<br><br><span class="hljs-comment"># 每个节点都安装</span><br>yum install -y conntrack<br>yum install -y socat<br></code></pre></td></tr></table></figure><p>见到这一段就说明安装成功了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#####################################################</span><br><span class="hljs-comment">###              Welcome to KubeSphere!           ###</span><br><span class="hljs-comment">#####################################################</span><br><br>Console: http://172.31.0.2:30880<br>Account: admin<br>Password: P@88w0rd<br>NOTES：<br>  1. After you <span class="hljs-built_in">log</span> into the console, please check the<br>     monitoring status of service components <span class="hljs-keyword">in</span><br>     <span class="hljs-string">&quot;Cluster Management&quot;</span>. If any service is not<br>     ready, please <span class="hljs-built_in">wait</span> patiently until all components <br>     are up and running.<br>  2. Please change the default password after login.<br><br><span class="hljs-comment">#####################################################</span><br>https://kubesphere.io             2023-05-21 12:04:23<br><span class="hljs-comment">#####################################################</span><br>12:04:24 CST success: [node1]<br>12:04:24 CST Pipeline[CreateClusterPipeline] execute successfully<br>Installation is complete.<br><br>Please check the result using the <span class="hljs-built_in">command</span>:<br><br>        kubectl logs -n kubesphere-system $(kubectl get pod -n kubesphere-system -l <span class="hljs-string">&#x27;app in (ks-install, ks-installer)&#x27;</span> -o jsonpath=<span class="hljs-string">&#x27;&#123;.items[0].metadata.name&#125;&#x27;</span>) -f<br></code></pre></td></tr></table></figure><p>访问一下30880端口<br><img src="/assets/c8292999e3184419950f4940636d1999.png"></p><h2 id="多租户系统实战"><a href="#多租户系统实战" class="headerlink" title="多租户系统实战"></a>多租户系统实战</h2><p><img src="/assets/ed15bb064c6e46f99efd24ce63bc9e0a.png"></p><h2 id="中间件部署实战"><a href="#中间件部署实战" class="headerlink" title="中间件部署实战"></a>中间件部署实战</h2><blockquote><p>应用部署需要关注的信息【应用部署三要素】<br>1、应用的部署方式<br>2、应用的数据挂载（数据，配置文件）<br>3、应用的可访问性</p></blockquote><p><img src="/assets/10c6c1bce91446f9bc906a5906d9ff1d.png"></p><h3 id="部署MySQL"><a href="#部署MySQL" class="headerlink" title="部署MySQL"></a>部署MySQL</h3><h4 id="mysql容器启动"><a href="#mysql容器启动" class="headerlink" title="mysql容器启动"></a>mysql容器启动</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -p 3306:3306 --name mysql-01 \<br>-v /mydata/mysql/log:/var/log/mysql \<br>-v /mydata/mysql/data:/var/lib/mysql \<br>-v /mydata/mysql/conf:/etc/mysql/conf.d \<br>-e MYSQL_ROOT_PASSWORD=root \<br>--restart=always \<br>-d mysql:5.7 <br></code></pre></td></tr></table></figure><h4 id="mysql配置示例"><a href="#mysql配置示例" class="headerlink" title="mysql配置示例"></a>mysql配置示例</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">[client]<br>default-character-set=utf8mb4<br> <br>[mysql]<br>default-character-set=utf8mb4<br> <br>[mysqld]<br>init_connect=<span class="hljs-string">&#x27;SET collation_connection = utf8mb4_unicode_ci&#x27;</span><br>init_connect=<span class="hljs-string">&#x27;SET NAMES utf8mb4&#x27;</span><br>character-set-server=utf8mb4<br>collation-server=utf8mb4_unicode_ci<br>skip-character-set-client-handshake<br>skip-name-resolve<br>lower_case_table_names=1<br></code></pre></td></tr></table></figure><h4 id="mysql部署分析"><a href="#mysql部署分析" class="headerlink" title="mysql部署分析"></a>mysql部署分析</h4><p><img src="/assets/006d4ec02fc34aefb058cae16a826797.png"></p><blockquote><p>1、集群内部，直接通过应用的  【服务名.项目名】 直接访问<br>        mysql -uroot -h<strong>his-mysql-glgf.his</strong> -p<br>2、集群外部，</p></blockquote><p><img src="/assets/938aecd6d7664dffb9b817b505afc6ed.png"></p><h4 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h4><p>创建mysql容器<br>创建配置文件<br><img src="/assets/153cdf8c2605429eaddedc01c1cbad18.png"><br>键是配置文件的名称<br>值是配置文件的内容<br><img src="/assets/66da06d9b28c42d8874760488a25afd8.png"><br>持久卷的声明<br><img src="/assets/09f7b70d90474f0d825a9d2c28642cc0.png"><br><img src="/assets/48cb101e260f488681c0c5c94ca3b152.png"><br><img src="/assets/67ce5e728b6f4dfeba54627fd3c5ae4f.png"><br>工作负载<br><img src="/assets/b5704269a0bf44e2af99ea229326f8fc.png"><br><img src="/assets/99ebbb14af89483a99871ab63b75dbb1.png"></p><p>配置一个环境变量<br><code>MYSQL_ROOT_PASSWORD</code><br><code>123456</code><br><img src="/assets/e9776f16b5c74c45976f11391ada36c1.png"><br><img src="/assets/016c5f633b53418f9139821d2c223d5b.png"><br>读写<code>/var/lib/mysql</code><br><img src="/assets/808f59570d474c11aa4568f8573fe1f3.png"><br><img src="/assets/28acf0befb354679bc6497d2859af399.png"><br>只读<code>/etc/mysql/conf.d</code><br><img src="/assets/f28ac29da567457d9ea376de185d8c1c.png"><br><img src="/assets/b791571395df4f828437fd274e41befe.png"></p><p>登录mysql<br><img src="/assets/3ba0fd6544b749adbd2040ca98749fc5.png"><br><img src="/assets/8519cf6403674f7b8038a07d70379db6.png"></p><p>查看命名空间<br><img src="/assets/af1d2fb432984a848b766144d2e4a5a2.png"></p><p>因为自动生成的服务会出现suxm这几个随机的字符, 所以我们可以手动创建服务<br><img src="/assets/056b04c5da2243eea5b5895744f53c57.png"><br><img src="/assets/bb85ecb218c34cf998f53025c25a6e80.png"><br><img src="/assets/fd1f4fd5ef39464d901a7ccaa978b751.png"><br><img src="/assets/d2faa4a2cc9a4d218b0ea6c8af7f8649.png"><br><img src="/assets/3950ed52bdc94e7497ebb76ebbea3bb2.png"><br><img src="/assets/34ad9f4e2cc04f2cbf3f9a256be9bce4.png"><br>刚刚是采用的内部域名创建的, 这次采用虚拟IP的方式创建<br><img src="/assets/bb35ceca35f149159a4ec50c6e9eb551.png"><br><img src="/assets/563acd2b837d43e4aed2b254b82c5094.png"><br><img src="/assets/d95ad954f0dc41ae91ca1a4c4c357aff.png"><br><img src="/assets/3e429a26baa84bd597329a66608a597a.png"><br>之后会暴露一个端口, 只用IP加端口就可以连接上mysql了<br><img src="/assets/ed2ad053235a4ba1a11cbccf3aaf8e68.png"></p><h3 id="部署Redis"><a href="#部署Redis" class="headerlink" title="部署Redis"></a>部署Redis</h3><h4 id="redis容器启动"><a href="#redis容器启动" class="headerlink" title="redis容器启动"></a>redis容器启动</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#创建配置文件</span><br><span class="hljs-comment">## 1、准备redis配置文件内容</span><br><span class="hljs-built_in">mkdir</span> -p /mydata/redis/conf &amp;&amp; vim /mydata/redis/conf/redis.conf<br><br><br><span class="hljs-comment">##配置示例</span><br>appendonly <span class="hljs-built_in">yes</span><br>port 6379<br><span class="hljs-built_in">bind</span> 0.0.0.0<br><br><br><span class="hljs-comment">#docker启动redis</span><br>docker run -d -p 6379:6379 --restart=always \<br>-v /mydata/redis/conf/redis.conf:/etc/redis/redis.conf \<br>-v  /mydata/redis-01/data:/data \<br> --name redis-01 redis:6.2.5 \<br> redis-server /etc/redis/redis.conf<br></code></pre></td></tr></table></figure><h4 id="redis部署分析"><a href="#redis部署分析" class="headerlink" title="redis部署分析"></a>redis部署分析</h4><p><img src="/assets/9ff28ccf73e6448fa8b3ce4b24be376e.png"></p><h4 id="部署-1"><a href="#部署-1" class="headerlink" title="部署"></a>部署</h4><p>创建配置<br><img src="/assets/b4461f2d3bda4b1db208845a5f79a599.png"><br><img src="/assets/d12e1c6342c044f087585da99fc7eb37.png"><br>创建工作负载<br><img src="/assets/a1045c2b2bc94240ac3c37f5464b77b8.png"><br><img src="/assets/79582f0ab47b45d9ae50837b442c9c26.png"><br><img src="/assets/fc27b12239924ec28edfb806f62bf055.png"><br><img src="/assets/ec621cd46b0547ee8ecff557afc8fbf9.png"><br><img src="/assets/c47374866f1044138b5ce1b0d3a10e5e.png"><br>命令<code>redis-server</code><br>参数<code>/etc/redis/redis.conf</code><br><img src="/assets/acc9e368b52a444480c5a0ce00be45a2.png"><br><img src="/assets/7da2ef78ded64f9181c313845b8ccb5b.png"><br>然后创建存储卷<br><img src="/assets/52e65d42d3234254b25445b264e44e1a.png"><br><img src="/assets/ef1cce12af1f4719993ad617918f21eb.png"><br><img src="/assets/1da8a3780caf4b4b92577d065f2ac65b.png"><br><img src="/assets/8ce7e272686941e0bbec16725a311d2f.png"><br><img src="/assets/c4eff4837711400c8dfd7b7bd269ccd7.png"><br><img src="/assets/6961f1e0cfbc4874a6e0f15d644d13f5.png"><br>查看一下容器内的配置文件是否加载进去了<br><img src="/assets/5fbfe14e94cf4da2bd499fedc3eade61.png"><br>当然也可以自己手动创建服务, 因为自动生成会多几个字符<br><img src="/assets/df36c8a02d35469c919fa3fc235cdfbc.png"><br>删除刚刚创建出来的redis服务<br><img src="/assets/fe829d54a833481cbe37a810d0a249e1.png"><br>然后创建, 指定工作负载<br><img src="/assets/31103416f88945a9bf8135a96696b0c1.png"><br><img src="/assets/d3fbb0bab1ef4a73950ec6317ac3e54c.png"><br><img src="/assets/1c998cabfd5344e99225c6da15f22b7e.png"><br><img src="/assets/c360ccc4da60432887e624db3b7c89b9.png"><br><img src="/assets/28f5c4167b40426ca975e373c4ed80c1.png"><br>刚刚创建的是内部网络, 这次来创建虚拟IP地址访问<br><img src="/assets/d4c30781cbe842ef93f74c80b81b936a.png"><br><img src="/assets/b084a843c85648589ffd520ce24beeac.png"><br>记得勾选外部访问<br><img src="/assets/1bf9925f4cbf4f6a9273ab5117c66bd0.png"><br>之后会暴露出来一个端口, 可以使用该端口进行外部远程连接redis<br><img src="/assets/e0a28305b796462e920e2abe138a6412.png"><br>将redis的副本数量修改成3, 然后可以发现存储卷的数量也变成了3份<br><img src="/assets/b0fd367d19154d1d8c805a2a3f711575.png"><br><img src="/assets/996a9a8388e5457d98da1bf29700b6f7.png"><br>当调整mysql副本数量, 存储卷仍然是1个, 这是因为mysql的存储卷是事先创建出来, 而不是创建服务时创建的存储卷, 当调整了副本的数量, 存储卷的数量也不会发生变化<br>一般来说都是在创建服务指定工作负载的时候来创建一个新的存储卷, 而不是事先创建一个存储卷<br><img src="/assets/b31ca872afb44b619908bace1e91041a.png"><br><img src="/assets/942282d616fa40fdbae40e74ab30ffba.png"></p><h3 id="部署ElasticSearch"><a href="#部署ElasticSearch" class="headerlink" title="部署ElasticSearch"></a>部署ElasticSearch</h3><h4 id="es容器启动"><a href="#es容器启动" class="headerlink" title="es容器启动"></a>es容器启动</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 创建数据目录</span><br><span class="hljs-built_in">mkdir</span> -p /mydata/es-01 &amp;&amp; <span class="hljs-built_in">chmod</span> 777 -R /mydata/es-01<br><br><span class="hljs-comment"># 容器启动</span><br>docker run --restart=always -d -p 9200:9200 -p 9300:9300 \<br>-e <span class="hljs-string">&quot;discovery.type=single-node&quot;</span> \<br>-e ES_JAVA_OPTS=<span class="hljs-string">&quot;-Xms512m -Xmx512m&quot;</span> \<br>-v es-config:/usr/share/elasticsearch/config \<br>-v /mydata/es-01/data:/usr/share/elasticsearch/data \<br>--name es-01 \<br>elasticsearch:7.13.4<br></code></pre></td></tr></table></figure><h4 id="es部署分析"><a href="#es部署分析" class="headerlink" title="es部署分析"></a>es部署分析</h4><p><img src="/assets/5858f2532a0648bcaeb9a16c35e2c9f7.png"></p><blockquote><p>注意： 子路径挂载，配置修改后，k8s不会对其Pod内的相关配置文件进行热更新，需要自己重启Pod</p></blockquote><h4 id="应用商店"><a href="#应用商店" class="headerlink" title="应用商店"></a>应用商店</h4><blockquote><p>可以使用 dev-zhao 登录，从应用商店部署</p></blockquote><h4 id="应用仓库"><a href="#应用仓库" class="headerlink" title="应用仓库"></a>应用仓库</h4><blockquote><p>使用企业空间管理员（wuhan-boss）登录，设置应用仓库</p></blockquote><blockquote><p>学习Helm即可，去helm的应用市场添加一个仓库地址，比如：bitnami</p></blockquote><h4 id="部署-2"><a href="#部署-2" class="headerlink" title="部署"></a>部署</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 只需要在node1上执行一下就行了, 其实一会也会手动删除这个容器</span><br><br><span class="hljs-comment"># 创建数据目录</span><br><span class="hljs-built_in">mkdir</span> -p /mydata/es-01 &amp;&amp; <span class="hljs-built_in">chmod</span> 777 -R /mydata/es-01<br><br><span class="hljs-comment"># 容器启动</span><br>docker run --restart=always -d -p 9200:9200 -p 9300:9300 \<br>-e <span class="hljs-string">&quot;discovery.type=single-node&quot;</span> \<br>-e ES_JAVA_OPTS=<span class="hljs-string">&quot;-Xms512m -Xmx512m&quot;</span> \<br>-v es-config:/usr/share/elasticsearch/config \<br>-v /mydata/es-01/data:/usr/share/elasticsearch/data \<br>--name es-01 \<br>elasticsearch:7.13.4<br><br><span class="hljs-comment"># 查看</span><br>docker ps | grep es-01<br><br><span class="hljs-comment"># 再给次权限</span><br><span class="hljs-built_in">chmod</span> 777 -R /mydata/es-01<br><br><span class="hljs-comment"># 进入容器</span><br>docker <span class="hljs-built_in">exec</span> -it es-01 /bin/bash<br><br><span class="hljs-built_in">pwd</span><br><span class="hljs-comment"># /usr/share/elasticsearch</span><br><br><span class="hljs-built_in">cd</span> config/<br><span class="hljs-comment"># elasticsearch.keystore  jvm.options    log4j2.file.properties  role_mapping.yml  users</span><br><span class="hljs-comment"># elasticsearch.yml       jvm.options.d  log4j2.properties       roles.yml         users_roles</span><br><br><span class="hljs-built_in">cat</span> elasticsearch.yml<br>cluster.name: <span class="hljs-string">&quot;docker-cluster&quot;</span><br>network.host: 0.0.0.0<br><br><span class="hljs-built_in">cat</span> jvm.options<br><span class="hljs-comment">################################################################</span><br><span class="hljs-comment">##</span><br><span class="hljs-comment">## JVM configuration</span><br><span class="hljs-comment">##</span><br><span class="hljs-comment">################################################################</span><br><span class="hljs-comment">##</span><br><span class="hljs-comment">## WARNING: DO NOT EDIT THIS FILE. If you want to override the</span><br><span class="hljs-comment">## JVM options in this file, or set any additional options, you</span><br><span class="hljs-comment">## should create one or more files in the jvm.options.d</span><br><span class="hljs-comment">## directory containing your adjustments.</span><br><span class="hljs-comment">##</span><br><span class="hljs-comment">## See https://www.elastic.co/guide/en/elasticsearch/reference/current/jvm-options.html</span><br><span class="hljs-comment">## for more information.</span><br><span class="hljs-comment">##</span><br><span class="hljs-comment">################################################################</span><br><br><br><br><span class="hljs-comment">################################################################</span><br><span class="hljs-comment">## IMPORTANT: JVM heap size</span><br><span class="hljs-comment">################################################################</span><br><span class="hljs-comment">##</span><br><span class="hljs-comment">## The heap size is automatically configured by Elasticsearch</span><br><span class="hljs-comment">## based on the available memory in your system and the roles</span><br><span class="hljs-comment">## each node is configured to fulfill. If specifying heap is</span><br><span class="hljs-comment">## required, it should be done through a file in jvm.options.d,</span><br><span class="hljs-comment">## and the min and max should be set to the same value. For</span><br><span class="hljs-comment">## example, to set the heap to 4 GB, create a new file in the</span><br><span class="hljs-comment">## jvm.options.d directory containing these lines:</span><br><span class="hljs-comment">##</span><br><span class="hljs-comment">## -Xms4g</span><br><span class="hljs-comment">## -Xmx4g</span><br><span class="hljs-comment">##</span><br><span class="hljs-comment">## See https://www.elastic.co/guide/en/elasticsearch/reference/current/heap-size.html</span><br><span class="hljs-comment">## for more information</span><br><span class="hljs-comment">##</span><br><span class="hljs-comment">################################################################</span><br><br><br><span class="hljs-comment">################################################################</span><br><span class="hljs-comment">## Expert settings</span><br><span class="hljs-comment">################################################################</span><br><span class="hljs-comment">##</span><br><span class="hljs-comment">## All settings below here are considered expert settings. Do</span><br><span class="hljs-comment">## not adjust them unless you understand what you are doing. Do</span><br><span class="hljs-comment">## not edit them in this file; instead, create a new file in the</span><br><span class="hljs-comment">## jvm.options.d directory containing your adjustments.</span><br><span class="hljs-comment">##</span><br><span class="hljs-comment">################################################################</span><br><br><span class="hljs-comment">## GC configuration</span><br>8-13:-XX:+UseConcMarkSweepGC<br>8-13:-XX:CMSInitiatingOccupancyFraction=75<br>8-13:-XX:+UseCMSInitiatingOccupancyOnly<br><br><span class="hljs-comment">## G1GC Configuration</span><br><span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> G1 GC is only supported on JDK version 10 or later</span><br><span class="hljs-comment"># to use G1GC, uncomment the next two lines and update the version on the</span><br><span class="hljs-comment"># following three lines to your version of the JDK</span><br><span class="hljs-comment"># 10-13:-XX:-UseConcMarkSweepGC</span><br><span class="hljs-comment"># 10-13:-XX:-UseCMSInitiatingOccupancyOnly</span><br>14-:-XX:+UseG1GC<br><br><span class="hljs-comment">## JVM temporary directory</span><br>-Djava.io.tmpdir=<span class="hljs-variable">$&#123;ES_TMPDIR&#125;</span><br><br><span class="hljs-comment">## heap dumps</span><br><br><span class="hljs-comment"># generate a heap dump when an allocation from the Java heap fails; heap dumps</span><br><span class="hljs-comment"># are created in the working directory of the JVM unless an alternative path is</span><br><span class="hljs-comment"># specified</span><br>-XX:+HeapDumpOnOutOfMemoryError<br><br><span class="hljs-comment"># specify an alternative path for heap dumps; ensure the directory exists and</span><br><span class="hljs-comment"># has sufficient space</span><br>-XX:HeapDumpPath=data<br><br><span class="hljs-comment"># specify an alternative path for JVM fatal error logs</span><br>-XX:ErrorFile=logs/hs_err_pid%p.log<br><br><span class="hljs-comment">## JDK 8 GC logging</span><br>8:-XX:+PrintGCDetails<br>8:-XX:+PrintGCDateStamps<br>8:-XX:+PrintTenuringDistribution<br>8:-XX:+PrintGCApplicationStoppedTime<br>8:-Xloggc:logs/gc.log<br>8:-XX:+UseGCLogFileRotation<br>8:-XX:NumberOfGCLogFiles=32<br>8:-XX:GCLogFileSize=64m<br><br><span class="hljs-comment"># JDK 9+ GC logging</span><br>9-:-Xlog:gc*,gc+age=trace,safepoint:file=logs/gc.log:utctime,pid,tags:filecount=32,filesize=64m<br><br><br></code></pre></td></tr></table></figure><p>创建一个管理员账户<br><img src="/assets/6fad754af467464dafec747a1cf86ea4.png"><br>然后将管理员拉进企业空间<br><img src="/assets/a78a84c942244508bd96f9166ca3b75a.png"><br>创建es配置文件<br><img src="/assets/2f1f303b3d7449a7929fdb21f6d2efd6.png"><br><img src="/assets/9393eef2f8d74ae7a8120a665f3cc9bf.png"><br><img src="/assets/b1582595da2e47c2a7b934c8642cbb10.png"><br><img src="/assets/3f6ae8588faa4e699ea11f9700c85f31.png"><br><img src="/assets/811912cb7c544a22bfd955fbdd3edeab.png"><br>版本填写<code>elasticsearch:7.13.4</code><br><img src="/assets/8e9c755cad1f4482bfac20c8332e1d5b.png"><br><img src="/assets/e6a1fb9d5040432cb40811e3e84718a3.png"><br><code>discovery.type</code> <code>single-node</code><br><code>ES_JAVA_OPTS</code> <code>-Xms512m -Xmx512m</code><br><img src="/assets/47357ad04a994ffdbb3ae75d620c35cd.png"><br><img src="/assets/2b85a7a8354d433e915e69d262f2a2be.png"><br><code>/usr/share/elasticsearch/config/elasticsearch.yml</code><br><img src="/assets/578be5e4ffcb45b582fae57d0ab98f1e.png"><br><code>/usr/share/elasticsearch/config/jvm.options</code><br><img src="/assets/2c3f6a1a0c3d48db9ae2bab8c38c2282.png"><br>不知道kubesphere哪里抽风了, 这里没有选择创建pvc模板, 只好先提前创建一个pvc了, 或者直接使用临时的pvc</p><blockquote><p>如果有添加存储模板, 就选择添加存储模板<br><code>/usr/share/elasticsearch/data</code></p></blockquote><p><img src="/assets/69efe8fdc10f45348dd272815b78cc97.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 服务创建完成之后就可以删除这个容器了</span><br>docker ps | grep es-01<br><br>docker <span class="hljs-built_in">rm</span> -f es-01<br><br><span class="hljs-comment"># 之后kubesphere会自己创建一个 </span><br><br><br></code></pre></td></tr></table></figure><p><img src="/assets/3df9ca1abde04999b088683b2fbcd9f2.png"><br>创建工作负载<br><img src="/assets/9c1af19e318b4eb0a9d9a4b519a2024a.png"><br><img src="/assets/15c3fd44f42e46d2add818b12966e81d.png"><br><img src="/assets/51681a418f714dca95dbbc0b2b2ee4f3.png"><br>创建外网访问的的NodeIP<br><img src="/assets/8f18ab52ca5143f2bdbb556ea9309892.png"><br><img src="/assets/32b00db2e40a42a6ab62aee7901f6d82.png"><br><img src="/assets/9f7d68f279c74a13bcff9a35ad94770b.png"><br><img src="/assets/053ebdc0a90549f4ac70e6a050d0e6e2.png"><br>打开浏览器访问<a href="http://47.106.11.25:32348/">http://47.106.11.25:32348/</a><br><img src="/assets/f1593d5b62094a3cb44ad62a51fe9110.png"></p><h3 id="应用商店的安装"><a href="#应用商店的安装" class="headerlink" title="应用商店的安装"></a>应用商店的安装</h3><p>可以通过开启<a href="https://kubesphere.io/zh/docs/v3.3/pluggable-components/app-store/#%E5%9C%A8%E5%AE%89%E8%A3%85%E5%90%8E%E5%90%AF%E7%94%A8%E5%BA%94%E7%94%A8%E5%95%86%E5%BA%97">应用商店</a>的方式来安装应用, 简单粗暴, 不过应用商店的应用比较少<br><img src="/assets/4e5e9d0e9f17488f811731d0e047e7d3.png"><br><img src="/assets/498f4a5b397548cab68deb455f919479.png"><br><img src="/assets/d880c885efb844e58c85ea218d7271b8.png"><br>开启数据持久化<br>设置账号密码<br><img src="/assets/607296241747478780648166d59278c2.png"><br>还可以开启外网访问<br><img src="/assets/69d779f7bbb34c1a879d59caeb1e3039.png"><br><img src="/assets/eb39e3009d8d48a499637463c1dd35fd.png"></p><p>然后放开端口, 这里存粹是省事, 没有用自己的集群, 用的青云白送的10小时kubesphere<br><img src="/assets/b9c5eb2de9cb437da61f5e794f834147.png"><br>访问<a href="https://rabbitmq-snpokhhn.c.kubesphere.cloud:30443/">https://rabbitmq-snpokhhn.c.kubesphere.cloud:30443</a><br><img src="/assets/9af0d5b5eaf245a98d30ce773b187ef3.png"></p><h3 id="通过应用仓库部署"><a href="#通过应用仓库部署" class="headerlink" title="通过应用仓库部署"></a>通过应用仓库部署</h3><blockquote><p>使用这种方式来部署也很方便</p></blockquote><p><a href="https://helm.sh/">https://helm.sh/</a><br><img src="/assets/fa8d3943270f4dc68461ff35f5e06323.png"><br>搜索redis<br><img src="/assets/0d49ed6fdcce4a07951adc357266522d.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 仓库地址</span><br>https://charts.bitnami.com/bitnami<br></code></pre></td></tr></table></figure><p>先切换到企业空间, 添加应用仓库bitnami<br><img src="/assets/75ab9752f90749c3a51f0567b3bc9bb3.png"><br>然后再创建应用<br><img src="/assets/21124ee1fc9e4d6890e82704df4d000e.png"><br><img src="/assets/203ee718c32146aaaf35e41533614960.png"><br><img src="/assets/e0306470871f44808b91b641b2d70f82.png"><br><img src="/assets/d9255f973fce46278b522642d7f18cd6.png"><br><img src="/assets/3589fc4471b3421b938d67f23495a7a7.png"></p><h2 id="本地部署ruoyi项目"><a href="#本地部署ruoyi项目" class="headerlink" title="本地部署ruoyi项目"></a>本地部署ruoyi项目</h2><p>本地下载<a href="https://nacos.io/">nacos</a><br>修改bin&#x2F;application.properties</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment">#*************** Config Module Related Configurations ***************#</span><br><span class="hljs-comment">### If use MySQL as datasource:</span><br><span class="hljs-comment">### Deprecated configuration property, it is recommended to use `spring.sql.init.platform` replaced.</span><br><span class="hljs-comment"># spring.datasource.platform=mysql</span><br><span class="hljs-attr">spring.sql.init.platform</span>=<span class="hljs-string">mysql</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">### Count of DB:</span><br><span class="hljs-attr">db.num</span>=<span class="hljs-string">1</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">### Connect URL of DB:</span><br><span class="hljs-attr">db.url.0</span>=<span class="hljs-string">jdbc:mysql://127.0.0.1:3306/nacos1?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC</span><br><span class="hljs-attr">db.user.0</span>=<span class="hljs-string">root</span><br><span class="hljs-attr">db.password.0</span>=<span class="hljs-string">123456</span><br></code></pre></td></tr></table></figure><p>开启mysql并且执行该sql文件<br><img src="/assets/55fc21866d7d44859d779a67cd7a8a61.png"><br>然后单机启动</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">startup.cmd -m standalone<br></code></pre></td></tr></table></figure><p>修改localhost:8848中配置中心的mysql地址和redis地址就可以了</p><h2 id="上云部署ruoyi项目"><a href="#上云部署ruoyi项目" class="headerlink" title="上云部署ruoyi项目"></a>上云部署ruoyi项目</h2><h3 id="部署mysql"><a href="#部署mysql" class="headerlink" title="部署mysql"></a>部署mysql</h3><p>创建数据库<code>ry-cloud</code>并导入数据脚本ry_2021xxxx.sql（必须），quartz.sql（可选）<br>创建数据库<code>ry-config</code>并导入数据脚本ry_config_2021xxxx.sql（必须）<br>将如下的sql文件都执行到k8s部署的mysql容器上<br><img src="/assets/b74d2980a74f47e28a8b7c4b5d2241b7.png"></p><h3 id="部署nacos"><a href="#部署nacos" class="headerlink" title="部署nacos"></a>部署nacos</h3><p><img src="/assets/c50d684604594bcd83dfbe9aa8678806.png"><br>创建nacos服务<br><img src="/assets/cce1190d13974a10a48fb58d21277aa8.png"><br><img src="/assets/f2ad1160e3b243d5a103c1d8e46b0da6.png"><br>创建镜像<code>nacos/nacos-server:v2.0.3</code><br><img src="/assets/75980db468834d0e8feeef1371701bfc.png"><br><img src="/assets/9212c38999dc45fc81c9f590a60bfbda.png"><br><img src="/assets/84ec430242104064b5e616ec6c8ba3cf.png"><br>补充, 添加一个环境变量, 让nacos单节点启动<br><code>MODE</code> <code>standalone</code><br><img src="/assets/f34d8c562ca04ebab6818025dc2a7060.png"></p><p>暂时不用挂载配置文件<br><img src="/assets/9e7c789754ce4cdea583dc5d05503d6a.png"><br><img src="/assets/17f9b93e8f8541f496f5d7a2894fca8e.png"><br>这就说明了可以通过 <code>ping 副本名.服务名.企业空间.svc.cluster.local</code><br><code>ping his-nacos-v1-0.his-nacos.his.svc.cluster.local</code><br><code>ping his-nacos-v1-1.his-nacos.his.svc.cluster.local</code><br>cluster集群配置中也可以不用指定IP, 直接指定这个域名<br><img src="/assets/314fa6623b864ea092dd42328fee8a82.png"><br><img src="/assets/8538dc7ffef441fa933c3603f83d854a.png"><br>然后删除这个nacos服务, 因为刚刚创建的并没有挂载配置文件<br><img src="/assets/339c0852a95c49d6bf97837219b1c20a.png"><br>接下来正式部署nacos</p><blockquote><p>由于mysql可以使用his-mysql-node.his这个主机名直接连接上, 所以nacos网关的mysql的jdbc连接也采用这个主机名称</p></blockquote><p><img src="/assets/546c1ec826034064a25dd46291f970a3.png"><br><img src="/assets/ad1f8b1ea763437d89ba33d30fac54cf.png"></p><p>一个踩坑, Nacos 2.0.3开启持久化 application.properties<br>得使用<code>spring.datasource.platform</code>, 不然单机模式下启动的并没有做到真正的持久化</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">spring.datasource.platform=mysql<br><span class="hljs-comment"># spring.sql.init.platform=mysql</span><br></code></pre></td></tr></table></figure><p>application.properties</p><figure class="highlight roboconf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br></pre></td><td class="code"><pre><code class="hljs roboconf"><span class="hljs-comment">#</span><br><span class="hljs-comment"># Copyright 1999-2021 Alibaba Group Holding Ltd.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span><br><span class="hljs-comment"># you may not use this file except in compliance with the License.</span><br><span class="hljs-comment"># You may obtain a copy of the License at</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#      http://www.apache.org/licenses/LICENSE-2.0</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Unless required by applicable law or agreed to in writing, software</span><br><span class="hljs-comment"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><br><span class="hljs-comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br><span class="hljs-comment"># See the License for the specific language governing permissions and</span><br><span class="hljs-comment"># limitations under the License.</span><br><span class="hljs-comment">#</span><br><br><span class="hljs-comment">#*************** Spring Boot Related Configurations ***************#</span><br><span class="hljs-comment">### Default web context path:</span><br>server.servlet.contextPath=/nacos<br><span class="hljs-comment">### Include message field</span><br>server.error.include-message=ALWAYS<br><span class="hljs-comment">### Default web server port:</span><br>server.port=8848<br><br><span class="hljs-comment">#*************** Network Related Configurations ***************#</span><br><span class="hljs-comment">### If prefer hostname over ip for Nacos server addresses in cluster.conf:</span><br><span class="hljs-comment"># nacos.inetutils.prefer-hostname-over-ip=false</span><br><br><span class="hljs-comment">### Specify local server&#x27;s IP:</span><br><span class="hljs-comment"># nacos.inetutils.ip-address=</span><br><br><br><span class="hljs-comment">#*************** Config Module Related Configurations ***************#</span><br><span class="hljs-comment">### If use MySQL as datasource:</span><br><span class="hljs-comment">### Deprecated configuration property, it is recommended to use `spring.sql.init.platform` replaced.</span><br>spring.datasource.platform=mysql<br><span class="hljs-comment"># spring.sql.init.platform=mysql</span><br><br><span class="hljs-comment">### Count of DB:</span><br>db.num=1<br><br><span class="hljs-comment">### Connect URL of DB:</span><br>db.url.0=jdbc:mysql://his-mysql-node.his:3306/ry-config?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC<br>db.user.0=root<br>db.password.0=123456<br><br><span class="hljs-comment">### Connection pool configuration: hikariCP</span><br>db.pool.config.connectionTimeout=30000<br>db.pool.config.validationTimeout=10000<br>db.pool.config.maximumPoolSize=20<br>db.pool.config.minimumIdle=2<br><br><span class="hljs-comment">#*************** Naming Module Related Configurations ***************#</span><br><br><span class="hljs-comment">### If enable data warmup. If set to false, the server would accept request without local data preparation:</span><br><span class="hljs-comment"># nacos.naming.data.warmup=true</span><br><br><span class="hljs-comment">### If enable the instance auto expiration, kind like of health check of instance:</span><br><span class="hljs-comment"># nacos.naming.expireInstance=true</span><br><br><span class="hljs-comment">### Add in 2.0.0</span><br><span class="hljs-comment">### The interval to clean empty service, unit: milliseconds.</span><br><span class="hljs-comment"># nacos.naming.clean.empty-service.interval=60000</span><br><br><span class="hljs-comment">### The expired time to clean empty service, unit: milliseconds.</span><br><span class="hljs-comment"># nacos.naming.clean.empty-service.expired-time=60000</span><br><br><span class="hljs-comment">### The interval to clean expired metadata, unit: milliseconds.</span><br><span class="hljs-comment"># nacos.naming.clean.expired-metadata.interval=5000</span><br><br><span class="hljs-comment">### The expired time to clean metadata, unit: milliseconds.</span><br><span class="hljs-comment"># nacos.naming.clean.expired-metadata.expired-time=60000</span><br><br><span class="hljs-comment">### The delay time before push task to execute from service changed, unit: milliseconds.</span><br><span class="hljs-comment"># nacos.naming.push.pushTaskDelay=500</span><br><br><span class="hljs-comment">### The timeout for push task execute, unit: milliseconds.</span><br><span class="hljs-comment"># nacos.naming.push.pushTaskTimeout=5000</span><br><br><span class="hljs-comment">### The delay time for retrying failed push task, unit: milliseconds.</span><br><span class="hljs-comment"># nacos.naming.push.pushTaskRetryDelay=1000</span><br><br><span class="hljs-comment">### Since 2.0.3</span><br><span class="hljs-comment">### The expired time for inactive client, unit: milliseconds.</span><br><span class="hljs-comment"># nacos.naming.client.expired.time=180000</span><br><br><span class="hljs-comment">#*************** CMDB Module Related Configurations ***************#</span><br><span class="hljs-comment">### The interval to dump external CMDB in seconds:</span><br><span class="hljs-comment"># nacos.cmdb.dumpTaskInterval=3600</span><br><br><span class="hljs-comment">### The interval of polling data change event in seconds:</span><br><span class="hljs-comment"># nacos.cmdb.eventTaskInterval=10</span><br><br><span class="hljs-comment">### The interval of loading labels in seconds:</span><br><span class="hljs-comment"># nacos.cmdb.labelTaskInterval=300</span><br><br><span class="hljs-comment">### If turn on data loading task:</span><br><span class="hljs-comment"># nacos.cmdb.loadDataAtStart=false</span><br><br><br><span class="hljs-comment">#*************** Metrics Related Configurations ***************#</span><br><span class="hljs-comment">### Metrics for prometheus</span><br><span class="hljs-comment">#management.endpoints.web.exposure.include=*</span><br><br><span class="hljs-comment">### Metrics for elastic search</span><br>management.metrics.export.elastic.enabled=false<br><span class="hljs-comment">#management.metrics.export.elastic.host=http://localhost:9200</span><br><br><span class="hljs-comment">### Metrics for influx</span><br>management.metrics.export.influx.enabled=false<br><span class="hljs-comment">#management.metrics.export.influx.db=springboot</span><br><span class="hljs-comment">#management.metrics.export.influx.uri=http://localhost:8086</span><br><span class="hljs-comment">#management.metrics.export.influx.auto-create-db=true</span><br><span class="hljs-comment">#management.metrics.export.influx.consistency=one</span><br><span class="hljs-comment">#management.metrics.export.influx.compressed=true</span><br><br><span class="hljs-comment">#*************** Access Log Related Configurations ***************#</span><br><span class="hljs-comment">### If turn on the access log:</span><br>server.tomcat.accesslog.enabled=true<br><br><span class="hljs-comment">### The access log pattern:</span><br>server.tomcat.accesslog.pattern=%h %l %u %t &quot;%r&quot; %s %b %D %&#123;<span class="hljs-attribute">User-Agent&#125;i %&#123;Request-Source&#125;i</span><br><span class="hljs-attribute"></span><br><span class="hljs-attribute">### The directory of access log</span>:<br>server<span class="hljs-variable">.tomcat</span><span class="hljs-variable">.basedir</span>=file:.<br><br>#*************** Access Control Related Configurations ***************#<br>### If enable spring security, this option is deprecated in 1.2.0:<br>#spring<span class="hljs-variable">.security</span><span class="hljs-variable">.enabled</span>=false<br><br>### The ignore urls of auth<br>nacos<span class="hljs-variable">.security</span><span class="hljs-variable">.ignore</span><span class="hljs-variable">.urls</span>=/,/error,/**/*<span class="hljs-variable">.css</span>,/**/*<span class="hljs-variable">.js</span>,/**/*<span class="hljs-variable">.html</span>,/**/*<span class="hljs-variable">.map</span>,/**/*<span class="hljs-variable">.svg</span>,/**/*<span class="hljs-variable">.png</span>,/**/*<span class="hljs-variable">.ico</span>,/console-ui/public/**,/v1/auth/**,/v1/console/health/**,/actuator/**,/v1/console/server/**<br><br>### The auth system to use, currently only &#x27;nacos&#x27; and &#x27;ldap&#x27; is supported:<br>nacos<span class="hljs-variable">.core</span><span class="hljs-variable">.auth</span><span class="hljs-variable">.system</span><span class="hljs-variable">.type</span>=nacos<br><br>### If turn on auth system:<br>nacos<span class="hljs-variable">.core</span><span class="hljs-variable">.auth</span><span class="hljs-variable">.enabled</span>=false<br><br>### Turn on/off caching of auth information. By turning on this switch, the update of auth information would have a 15 seconds delay.<br>nacos<span class="hljs-variable">.core</span><span class="hljs-variable">.auth</span><span class="hljs-variable">.caching</span><span class="hljs-variable">.enabled</span>=true<br><br>### Since 1.4.1, Turn on/off white auth for user-agent: nacos-server, only for upgrade from old version.<br>nacos<span class="hljs-variable">.core</span><span class="hljs-variable">.auth</span><span class="hljs-variable">.enable</span><span class="hljs-variable">.userAgentAuthWhite</span>=false<br><br>### Since 1.4.1, worked when nacos<span class="hljs-variable">.core</span><span class="hljs-variable">.auth</span><span class="hljs-variable">.enabled</span>=true and nacos<span class="hljs-variable">.core</span><span class="hljs-variable">.auth</span><span class="hljs-variable">.enable</span><span class="hljs-variable">.userAgentAuthWhite</span>=false.<br>### The two properties is the white list for auth and used by identity the request from other server.<br>nacos<span class="hljs-variable">.core</span><span class="hljs-variable">.auth</span><span class="hljs-variable">.server</span><span class="hljs-variable">.identity</span><span class="hljs-variable">.key</span>=<br>nacos<span class="hljs-variable">.core</span><span class="hljs-variable">.auth</span><span class="hljs-variable">.server</span><span class="hljs-variable">.identity</span><span class="hljs-variable">.value</span>=<br><br>### worked when nacos<span class="hljs-variable">.core</span><span class="hljs-variable">.auth</span><span class="hljs-variable">.system</span><span class="hljs-variable">.type</span>=nacos<br>### The token expiration in seconds:<br>nacos<span class="hljs-variable">.core</span><span class="hljs-variable">.auth</span><span class="hljs-variable">.plugin</span><span class="hljs-variable">.nacos</span><span class="hljs-variable">.token</span><span class="hljs-variable">.cache</span><span class="hljs-variable">.enable</span>=false<br>nacos<span class="hljs-variable">.core</span><span class="hljs-variable">.auth</span><span class="hljs-variable">.plugin</span><span class="hljs-variable">.nacos</span><span class="hljs-variable">.token</span><span class="hljs-variable">.expire</span><span class="hljs-variable">.seconds</span>=18000<br>### The default token (Base64 String):<br>nacos<span class="hljs-variable">.core</span><span class="hljs-variable">.auth</span><span class="hljs-variable">.plugin</span><span class="hljs-variable">.nacos</span><span class="hljs-variable">.token</span><span class="hljs-variable">.secret</span><span class="hljs-variable">.key</span>=<br><br>### worked when nacos<span class="hljs-variable">.core</span><span class="hljs-variable">.auth</span><span class="hljs-variable">.system</span><span class="hljs-variable">.type</span>=ldap，&#123;0&#125; is Placeholder,replace login username<br>#nacos<span class="hljs-variable">.core</span><span class="hljs-variable">.auth</span><span class="hljs-variable">.ldap</span><span class="hljs-variable">.url</span>=ldap://localhost:389<br>#nacos<span class="hljs-variable">.core</span><span class="hljs-variable">.auth</span><span class="hljs-variable">.ldap</span><span class="hljs-variable">.basedc</span>=dc=example,dc=org<br>#nacos<span class="hljs-variable">.core</span><span class="hljs-variable">.auth</span><span class="hljs-variable">.ldap</span><span class="hljs-variable">.userDn</span>=cn=admin,$&#123;nacos<span class="hljs-variable">.core</span><span class="hljs-variable">.auth</span><span class="hljs-variable">.ldap</span><span class="hljs-variable">.basedc</span>&#125;<br>#nacos<span class="hljs-variable">.core</span><span class="hljs-variable">.auth</span><span class="hljs-variable">.ldap</span><span class="hljs-variable">.password</span>=admin<br>#nacos<span class="hljs-variable">.core</span><span class="hljs-variable">.auth</span><span class="hljs-variable">.ldap</span><span class="hljs-variable">.userdn</span>=cn=&#123;0&#125;,dc=example,dc=org<br>#nacos<span class="hljs-variable">.core</span><span class="hljs-variable">.auth</span><span class="hljs-variable">.ldap</span><span class="hljs-variable">.filter</span><span class="hljs-variable">.prefix</span>=uid<br>#nacos<span class="hljs-variable">.core</span><span class="hljs-variable">.auth</span><span class="hljs-variable">.ldap</span><span class="hljs-variable">.case</span><span class="hljs-variable">.sensitive</span>=true<br><br><br>#*************** Istio Related Configurations ***************#<br>### If turn on the MCP server:<br>nacos<span class="hljs-variable">.istio</span><span class="hljs-variable">.mcp</span><span class="hljs-variable">.server</span><span class="hljs-variable">.enabled</span>=false<br><br>#*************** Core Related Configurations ***************#<br><br>### set the WorkerID manually<br># nacos<span class="hljs-variable">.core</span><span class="hljs-variable">.snowflake</span><span class="hljs-variable">.worker-id</span>=<br><br>### Member-MetaData<br># nacos<span class="hljs-variable">.core</span><span class="hljs-variable">.member</span><span class="hljs-variable">.meta</span><span class="hljs-variable">.site</span>=<br># nacos<span class="hljs-variable">.core</span><span class="hljs-variable">.member</span><span class="hljs-variable">.meta</span><span class="hljs-variable">.adweight</span>=<br># nacos<span class="hljs-variable">.core</span><span class="hljs-variable">.member</span><span class="hljs-variable">.meta</span><span class="hljs-variable">.weight</span>=<br><br>### MemberLookup<br>### Addressing pattern category, If set, the priority is highest<br># nacos<span class="hljs-variable">.core</span><span class="hljs-variable">.member</span><span class="hljs-variable">.lookup</span><span class="hljs-variable">.type</span>=[file,address-server]<br>## Set the cluster list with a configuration file or command-line argument<br># nacos<span class="hljs-variable">.member</span><span class="hljs-variable">.list</span>=192.168.16.101:8847?raft_port=8807,192.168.16.101?raft_port=8808,192.168.16.101:8849?raft_port=8809<br>## for AddressServerMemberLookup<br># Maximum number of retries to query the address server upon initialization<br># nacos<span class="hljs-variable">.core</span><span class="hljs-variable">.address-server</span><span class="hljs-variable">.retry</span>=5<br>## Server domain name address of [address-server] mode<br># address<span class="hljs-variable">.server</span><span class="hljs-variable">.domain</span>=jmenv<span class="hljs-variable">.tbsite</span><span class="hljs-variable">.net</span><br>## Server port of [address-server] mode<br># address<span class="hljs-variable">.server</span><span class="hljs-variable">.port</span>=8080<br>## Request address of [address-server] mode<br># address<span class="hljs-variable">.server</span><span class="hljs-variable">.url</span>=/nacos/serverlist<br><br>#*************** JRaft Related Configurations ***************#<br><br>### Sets the Raft cluster election timeout, default value is 5 second<br># nacos<span class="hljs-variable">.core</span><span class="hljs-variable">.protocol</span><span class="hljs-variable">.raft</span><span class="hljs-variable">.data</span><span class="hljs-variable">.election_timeout_ms</span>=5000<br>### Sets the amount of time the Raft snapshot will execute periodically, default is 30 minute<br># nacos<span class="hljs-variable">.core</span><span class="hljs-variable">.protocol</span><span class="hljs-variable">.raft</span><span class="hljs-variable">.data</span><span class="hljs-variable">.snapshot_interval_secs</span>=30<br>### raft internal worker threads<br># nacos<span class="hljs-variable">.core</span><span class="hljs-variable">.protocol</span><span class="hljs-variable">.raft</span><span class="hljs-variable">.data</span><span class="hljs-variable">.core_thread_num</span>=8<br>### Number of threads required for raft business request processing<br># nacos<span class="hljs-variable">.core</span><span class="hljs-variable">.protocol</span><span class="hljs-variable">.raft</span><span class="hljs-variable">.data</span><span class="hljs-variable">.cli_service_thread_num</span>=4<br>### raft linear read strategy. Safe linear reads are used by default, that is, the Leader tenure is confirmed by heartbeat<br># nacos<span class="hljs-variable">.core</span><span class="hljs-variable">.protocol</span><span class="hljs-variable">.raft</span><span class="hljs-variable">.data</span><span class="hljs-variable">.read_index_type</span>=ReadOnlySafe<br>### rpc request timeout, default 5 seconds<br># nacos<span class="hljs-variable">.core</span><span class="hljs-variable">.protocol</span><span class="hljs-variable">.raft</span><span class="hljs-variable">.data</span><span class="hljs-variable">.rpc_request_timeout_ms</span>=5000<br><br>#*************** Distro Related Configurations ***************#<br><br>### Distro data sync delay time, when sync task delayed, task will be merged for same data key. Default 1 second.<br># nacos<span class="hljs-variable">.core</span><span class="hljs-variable">.protocol</span><span class="hljs-variable">.distro</span><span class="hljs-variable">.data</span><span class="hljs-variable">.sync</span><span class="hljs-variable">.delayMs</span>=1000<br><br>### Distro data sync timeout for one sync data, default 3 seconds.<br># nacos<span class="hljs-variable">.core</span><span class="hljs-variable">.protocol</span><span class="hljs-variable">.distro</span><span class="hljs-variable">.data</span><span class="hljs-variable">.sync</span><span class="hljs-variable">.timeoutMs</span>=3000<br><br>### Distro data sync retry delay time when sync data failed or timeout, same behavior with delayMs, default 3 seconds.<br># nacos<span class="hljs-variable">.core</span><span class="hljs-variable">.protocol</span><span class="hljs-variable">.distro</span><span class="hljs-variable">.data</span><span class="hljs-variable">.sync</span><span class="hljs-variable">.retryDelayMs</span>=3000<br><br>### Distro data verify interval time, verify synced data whether expired for a interval. Default 5 seconds.<br># nacos<span class="hljs-variable">.core</span><span class="hljs-variable">.protocol</span><span class="hljs-variable">.distro</span><span class="hljs-variable">.data</span><span class="hljs-variable">.verify</span><span class="hljs-variable">.intervalMs</span>=5000<br><br>### Distro data verify timeout for one verify, default 3 seconds.<br># nacos<span class="hljs-variable">.core</span><span class="hljs-variable">.protocol</span><span class="hljs-variable">.distro</span><span class="hljs-variable">.data</span><span class="hljs-variable">.verify</span><span class="hljs-variable">.timeoutMs</span>=3000<br><br>### Distro data load retry delay when load snapshot data failed, default 30 seconds.<br># nacos<span class="hljs-variable">.core</span><span class="hljs-variable">.protocol</span><span class="hljs-variable">.distro</span><span class="hljs-variable">.data</span><span class="hljs-variable">.load</span><span class="hljs-variable">.retryDelayMs</span>=30000<br><br>### enable to support prometheus service discovery<br>#nacos<span class="hljs-variable">.prometheus</span><span class="hljs-variable">.metrics</span><span class="hljs-variable">.enabled</span>=true<br><br>### Since 2.3<br>#*************** Grpc Configurations ***************#<br><br>## sdk grpc(between nacos server and client) configuration<br>## Sets the maximum message size allowed to be received on the server.<br>#nacos<span class="hljs-variable">.remote</span><span class="hljs-variable">.server</span><span class="hljs-variable">.grpc</span><span class="hljs-variable">.sdk</span><span class="hljs-variable">.max-inbound-message-size</span>=10485760<br><br>## Sets the time(milliseconds) without read activity before sending a keepalive ping. The typical default is two hours.<br>#nacos<span class="hljs-variable">.remote</span><span class="hljs-variable">.server</span><span class="hljs-variable">.grpc</span><span class="hljs-variable">.sdk</span><span class="hljs-variable">.keep-alive-time</span>=7200000<br><br>## Sets a time(milliseconds) waiting for read activity after sending a keepalive ping. Defaults to 20 seconds.<br>#nacos<span class="hljs-variable">.remote</span><span class="hljs-variable">.server</span><span class="hljs-variable">.grpc</span><span class="hljs-variable">.sdk</span><span class="hljs-variable">.keep-alive-timeout</span>=20000<br><br><br>## Sets a time(milliseconds) that specify the most aggressive keep-alive time clients are permitted to configure. The typical default is 5 minutes<br>#nacos<span class="hljs-variable">.remote</span><span class="hljs-variable">.server</span><span class="hljs-variable">.grpc</span><span class="hljs-variable">.sdk</span><span class="hljs-variable">.permit-keep-alive-time</span>=300000<br><br>## cluster grpc(inside the nacos server) configuration<br>#nacos<span class="hljs-variable">.remote</span><span class="hljs-variable">.server</span><span class="hljs-variable">.grpc</span><span class="hljs-variable">.cluster</span><span class="hljs-variable">.max-inbound-message-size</span>=10485760<br><br>## Sets the time(milliseconds) without read activity before sending a keepalive ping. The typical default is two hours.<br>#nacos<span class="hljs-variable">.remote</span><span class="hljs-variable">.server</span><span class="hljs-variable">.grpc</span><span class="hljs-variable">.cluster</span><span class="hljs-variable">.keep-alive-time</span>=7200000<br><br>## Sets a time(milliseconds) waiting for read activity after sending a keepalive ping. Defaults to 20 seconds.<br>#nacos<span class="hljs-variable">.remote</span><span class="hljs-variable">.server</span><span class="hljs-variable">.grpc</span><span class="hljs-variable">.cluster</span><span class="hljs-variable">.keep-alive-timeout</span>=20000<br><br>## Sets a time(milliseconds) that specify the most aggressive keep-alive time clients are permitted to configure. The typical default is 5 minutes<br>#nacos<span class="hljs-variable">.remote</span><span class="hljs-variable">.server</span><span class="hljs-variable">.grpc</span><span class="hljs-variable">.cluster</span><span class="hljs-variable">.permit-keep-alive-time</span>=300000<br><br></code></pre></td></tr></table></figure><p>cluster.conf</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment">#</span><br><span class="hljs-comment"># Copyright 1999-2021 Alibaba Group Holding Ltd.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span><br><span class="hljs-comment"># you may not use this file except in compliance with the License.</span><br><span class="hljs-comment"># You may obtain a copy of the License at</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#      http://www.apache.org/licenses/LICENSE-2.0</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Unless required by applicable law or agreed to in writing, software</span><br><span class="hljs-comment"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><br><span class="hljs-comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br><span class="hljs-comment"># See the License for the specific language governing permissions and</span><br><span class="hljs-comment"># limitations under the License.</span><br><span class="hljs-comment">#</span><br><br><span class="hljs-comment">#it is ip</span><br><span class="hljs-comment">#example</span><br><span class="hljs-attribute">his</span>-nacos-v1-<span class="hljs-number">0</span>.his-nacos.his.svc.cluster.local:<span class="hljs-number">8848</span><br><span class="hljs-attribute">his</span>-nacos-v1-<span class="hljs-number">1</span>.his-nacos.his.svc.cluster.local:<span class="hljs-number">8848</span><br><span class="hljs-attribute">his</span>-nacos-v1-<span class="hljs-number">2</span>.his-nacos.his.svc.cluster.local:<span class="hljs-number">8848</span><br></code></pre></td></tr></table></figure><p>TIPS: 单节点部署不用挂载cluster.conf, 后面的部署可能会出现bug<br><img src="/assets/d3853720f991421f9b4ea248952f0abb.png"><br>然后创建一个有状态服务<br><img src="/assets/b25f0363815c4347bac8e5febd9bdd29.png"><br><img src="/assets/ae69de0f32214b21bc1c0f5faf2fb58c.png"><br><img src="/assets/f2905a14e94a4e499e8c04d9fe542d8d.png"><br>指定nacos的版本<code>nacos/nacos-server:v2.0.3</code><br><img src="/assets/7decef743511431c8bc74284c037369d.png"><br><img src="/assets/aa5c24e382fe4cc0892d94dadb554125.png"><br><img src="/assets/91abb48b7c104c398502927a1702e6d6.png"><br><img src="/assets/ab2474a03f034641ae07054e91e8b808.png"><br>只读<code>/home/nacos/conf/application.properties</code>子路径填写<code>application.properties</code><br><img src="/assets/34aba25030984df0b7b0ad2dc4c4f2bd.png"><br>只读<code>/home/nacos/conf/cluster.conf</code>子路径填写<code>cluster.conf</code><br><img src="/assets/0f54ef6cee35412c98a75fc5a3f08f23.png"><br>接着创建一个对外暴露端口的nacos<br><img src="/assets/4db3c1db360542f0bb5c1b10d4b6f590.png"><br><img src="/assets/2bfea46694ae4b4abe17511837c889e4.png"><br><img src="/assets/6411be14f95049fd818bbe45a845d87d.png"><br><img src="/assets/2befa30176b744b8b6f878dd748adad3.png"><br>配置完成之后可以访问<a href="http://139.198.115.124:31695/nacos">http://139.198.115.124:31695/nacos</a><br><img src="/assets/3c7b00d58ace4040a0fa0aa690c1213c.png"></p><p>接着创建prod命名空间<br><img src="/assets/d7b24a728ae94bbeae64932e2e9913ca.png"><br><img src="/assets/45b01961c9944443a8fa1a573740e95f.png"></p><h3 id="maven打包"><a href="#maven打包" class="headerlink" title="maven打包"></a>maven打包</h3><p>跳过测试然后打包<br><img src="/assets/c29d7276428844939b72ba4e9e4ed44a.png"><br>本地运行打好的jar包<code>java -jar ruoyi-auth.jar</code><br>出现报错charset</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Caused by: java.nio.charset.MalformedInputException: Input length = 1<br></code></pre></td></tr></table></figure><p>需要指定一下编码集<br><code>java -Dfile.encoding=utf8 -jar ruoyi-auth.jar</code><br>将打包的jar整理成如下格式上传到服务器</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs cmake">.<br>├── ruoyi-auth<br>│   ├── Dockerfile<br>│   └── <span class="hljs-keyword">target</span><br>│       └── ruoyi-auth.jar<br>├── ruoyi-<span class="hljs-keyword">file</span><br>│   ├── Dockerfile<br>│   └── <span class="hljs-keyword">target</span><br>│       └── ruoyi-modules-<span class="hljs-keyword">file</span>.jar<br>├── ruoyi-gateway<br>│   ├── Dockerfile<br>│   └── <span class="hljs-keyword">target</span><br>│       └── ruoyi-gateway.jar<br>├── ruoyi-gen<br>│   ├── Dockerfile<br>│   └── <span class="hljs-keyword">target</span><br>│       └── ruoyi-modules-gen.jar<br>├── ruoyi-job<br>│   ├── Dockerfile<br>│   └── <span class="hljs-keyword">target</span><br>│       └── ruoyi-modules-job.jar<br>├── ruoyi-monitor<br>│   ├── Dockerfile<br>│   └── <span class="hljs-keyword">target</span><br>│       └── ruoyi-visual-monitor.jar<br>└── ruoyi-system<br>    ├── Dockerfile<br>    └── <span class="hljs-keyword">target</span><br>        └── ruoyi-modules-system.jar<br></code></pre></td></tr></table></figure><p>Dockerfile</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> openjdk:<span class="hljs-number">8</span>-jdk<br><span class="hljs-keyword">LABEL</span><span class="language-bash"> maintainer=leifengyang</span><br><br><br><span class="hljs-comment">#docker run -e PARAMS=&quot;--server.port 9090&quot;</span><br><span class="hljs-keyword">ENV</span> PARAMS=<span class="hljs-string">&quot;--server.port=8080 --spring.profiles.active=prod --spring.cloud.nacos.discovery.server-addr=his-nacos.his:8848 --spring.cloud.nacos.config.server-addr=his-nacos.his:8848 --spring.cloud.nacos.config.namespace=prod --spring.cloud.nacos.config.file-extension=yml&quot;</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> /bin/cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;Asia/Shanghai&#x27;</span> &gt;/etc/timezone</span><br><br><span class="hljs-keyword">COPY</span><span class="language-bash"> target/*.jar /app.jar</span><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">8080</span><br><br><span class="hljs-comment">#</span><br><span class="hljs-keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="hljs-string">&quot;/bin/sh&quot;</span>,<span class="hljs-string">&quot;-c&quot;</span>,<span class="hljs-string">&quot;java -Dfile.encoding=utf8 -Djava.security.egd=file:/dev/./urandom -jar app.jar <span class="hljs-variable">$&#123;PARAMS&#125;</span>&quot;</span>]</span><br></code></pre></td></tr></table></figure><h3 id="开通阿里云容器镜像服务"><a href="#开通阿里云容器镜像服务" class="headerlink" title="开通阿里云容器镜像服务"></a>开通阿里云容器镜像服务</h3><p><img src="/assets/ea14837b92bd4887860c3323cc144d47.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 登录阿里云容器镜像仓库</span><br>$ sudo docker login --username=肉豆蔻吖 registry.cn-shenzhen.aliyuncs.com<br><br>12345Xia<br></code></pre></td></tr></table></figure><p>创建一个命名空间<br><img src="/assets/1ec2268024c34f3397da800d7126918d.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 拉取</span><br>$ docker pull registry.cn-shenzhen.aliyuncs.com/roudoukou-ruoyi/ruoyi:[镜像版本号]<br><br><span class="hljs-comment"># 推送</span><br>$ docker login --username=肉豆蔻吖 registry.cn-shenzhen.aliyuncs.com<br>$ docker tag [ImageId] registry.cn-shenzhen.aliyuncs.com/roudoukou-ruoyi/ruoyi:[镜像版本号]<br>$ docker push registry.cn-shenzhen.aliyuncs.com/roudoukou-ruoyi/ruoyi:[镜像版本号]<br></code></pre></td></tr></table></figure><h3 id="docker打包-推送"><a href="#docker打包-推送" class="headerlink" title="docker打包, 推送"></a>docker打包, 推送</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 打包成镜像</span><br><span class="hljs-built_in">cd</span> ruoyi-file/<br>docker build -t ruoyi-file:v1 -f Dockerfile .<br><br><span class="hljs-comment"># 可以简写不写Dockerfile</span><br><span class="hljs-built_in">cd</span> ruoyi-gateway/<br>docker build -t ruoyi-gateway:v1 .<br><br><span class="hljs-built_in">cd</span> ruoyi-gen/<br>docker build -t ruoyi-gen:v1 .<br><br><span class="hljs-built_in">cd</span> ruoyi-job/<br>docker build -t ruoyi-job:v1 .<br><br><span class="hljs-built_in">cd</span> ruoyi-monitor/  <br>docker build -t ruoyi-monitor:v1 .<br><br><span class="hljs-built_in">cd</span> ruoyi-system/<br>docker build -t ruoyi-system:v1 .<br><br><span class="hljs-built_in">cd</span> ruoyi-auth/<br>docker build -t ruoyi-auth:v1 .<br><br><span class="hljs-comment"># 登录</span><br>docker login --username=肉豆蔻吖 registry.cn-shenzhen.aliyuncs.com<br><br><span class="hljs-comment"># 查看镜像</span><br>[root@k8s-master ruoyi-system]<span class="hljs-comment"># docker images | grep ruoyi</span><br>ruoyi-auth                                                                 v1         0db642b44949   4 seconds ago   617MB<br>ruoyi-system                                                               v1         c0b63feca088   8 minutes ago    632MB<br>ruoyi-monitor                                                              v1         b0f479101e96   10 minutes ago   592MB<br>ruoyi-job                                                                  v1         fd3bcefdb9d0   10 minutes ago   629MB<br>ruoyi-gen                                                                  v1         df9dae1e1581   10 minutes ago   628MB<br>ruoyi-gateway                                                              v1         1a37fc67241f   13 minutes ago   625MB<br>ruoyi-file                                                                 v1         85a54d4c38ea   15 minutes ago   622MB<br><br><span class="hljs-comment"># 命名</span><br>docker tag c0b63feca088 registry.cn-shenzhen.aliyuncs.com/roudoukou-ruoyi/ruoyi-system:v1<br>docker tag b0f479101e96 registry.cn-shenzhen.aliyuncs.com/roudoukou-ruoyi/ruoyi-monitor:v1<br>docker tag fd3bcefdb9d0 registry.cn-shenzhen.aliyuncs.com/roudoukou-ruoyi/ruoyi-job:v1<br>docker tag df9dae1e1581 registry.cn-shenzhen.aliyuncs.com/roudoukou-ruoyi/ruoyi-gen:v1<br>docker tag 1a37fc67241f registry.cn-shenzhen.aliyuncs.com/roudoukou-ruoyi/ruoyi-gateway:v1<br>docker tag 85a54d4c38ea registry.cn-shenzhen.aliyuncs.com/roudoukou-ruoyi/ruoyi-file:v1<br>docker tag 0db642b44949 registry.cn-shenzhen.aliyuncs.com/roudoukou-ruoyi/ruoyi-auth:v1<br><br><span class="hljs-comment"># 查看镜像</span><br>[root@k8s-master ruoyi-system]<span class="hljs-comment"># docker images | grep ruoyi</span><br>ruoyi-auth                                                                 v1         0db642b44949   49 seconds ago   617MB<br>registry.cn-shenzhen.aliyuncs.com/roudoukou-ruoyi/ruoyi-auth               v1         0db642b44949   49 seconds ago   617MB<br>ruoyi-system                                                               v1         c0b63feca088   12 hours ago     632MB<br>registry.cn-shenzhen.aliyuncs.com/roudoukou-ruoyi/ruoyi-system             v1         c0b63feca088   12 hours ago     632MB<br>ruoyi-monitor                                                              v1         b0f479101e96   12 hours ago     592MB<br>registry.cn-shenzhen.aliyuncs.com/roudoukou-ruoyi/ruoyi-monitor            v1         b0f479101e96   12 hours ago     592MB<br>registry.cn-shenzhen.aliyuncs.com/roudoukou-ruoyi/ruoyi-job                v1         fd3bcefdb9d0   12 hours ago     629MB<br>ruoyi-job                                                                  v1         fd3bcefdb9d0   12 hours ago     629MB<br>ruoyi-gen                                                                  v1         df9dae1e1581   12 hours ago     628MB<br>registry.cn-shenzhen.aliyuncs.com/roudoukou-ruoyi/ruoyi-gen                v1         df9dae1e1581   12 hours ago     628MB<br>ruoyi-gateway                                                              v1         1a37fc67241f   12 hours ago     625MB<br>registry.cn-shenzhen.aliyuncs.com/roudoukou-ruoyi/ruoyi-gateway            v1         1a37fc67241f   12 hours ago     625MB<br>ruoyi-file                                                                 v1         85a54d4c38ea   12 hours ago     622MB<br>registry.cn-shenzhen.aliyuncs.com/roudoukou-ruoyi/ruoyi-file               v1         85a54d4c38ea   12 hours ago     622MB<br><br><span class="hljs-comment"># 推送</span><br>docker push registry.cn-shenzhen.aliyuncs.com/roudoukou-ruoyi/ruoyi-auth:v1<br>docker push registry.cn-shenzhen.aliyuncs.com/roudoukou-ruoyi/ruoyi-system:v1<br>docker push registry.cn-shenzhen.aliyuncs.com/roudoukou-ruoyi/ruoyi-monitor:v1<br>docker push registry.cn-shenzhen.aliyuncs.com/roudoukou-ruoyi/ruoyi-job:v1<br>docker push registry.cn-shenzhen.aliyuncs.com/roudoukou-ruoyi/ruoyi-gen:v1<br>docker push registry.cn-shenzhen.aliyuncs.com/roudoukou-ruoyi/ruoyi-gateway:v1<br>docker push registry.cn-shenzhen.aliyuncs.com/roudoukou-ruoyi/ruoyi-file:v1<br></code></pre></td></tr></table></figure><h3 id="kubesphere部署微服务"><a href="#kubesphere部署微服务" class="headerlink" title="kubesphere部署微服务"></a>kubesphere部署微服务</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-comment"># 拉取镜像</span><br>docker pull registry.cn-shenzhen.aliyuncs.com/roudoukou-ruoyi/ruoyi-auth:v1<br>docker pull registry.cn-shenzhen.aliyuncs.com/roudoukou-ruoyi/ruoyi-system:v1<br>docker pull registry.cn-shenzhen.aliyuncs.com/roudoukou-ruoyi/ruoyi-monitor:v1<br>docker pull registry.cn-shenzhen.aliyuncs.com/roudoukou-ruoyi/ruoyi-job:v1<br>docker pull registry.cn-shenzhen.aliyuncs.com/roudoukou-ruoyi/ruoyi-gen:v1<br>docker pull registry.cn-shenzhen.aliyuncs.com/roudoukou-ruoyi/ruoyi-gateway:v1<br>docker pull registry.cn-shenzhen.aliyuncs.com/roudoukou-ruoyi/ruoyi-file:v1<br></code></pre></td></tr></table></figure><p>创建无状态服务<br><img src="/assets/57afae57a3924d0ea083b175701a161f.png"><br><img src="/assets/947a5310c9bb4c81b7e319d9e3b5e61f.png"><br>选择这个镜像<code>registry.cn-shenzhen.aliyuncs.com/roudoukou-ruoyi/ruoyi-monitor:v1</code><br><img src="/assets/c9a3ae855b624c8383fd50083a3f03b5.png"><br><img src="/assets/756acb5acffa4c2a9660d570e2d913fc.png"><br><img src="/assets/053c8267d15d4799bfe39ea82c51eece.png"><br><img src="/assets/263c2dd032524bd0aed491969cbd36ef.png">部署完成之后查看日志,没有报错就ok<br><img src="/assets/c8ab361ad21c4e8a8fd2047541ebdea4.png"><br>然后以相同的方式部署其他的微服务</p><h3 id="kubesphere部署前端"><a href="#kubesphere部署前端" class="headerlink" title="kubesphere部署前端"></a>kubesphere部署前端</h3><p>前端UI进行打包<br>将target的路径<code>localhost</code>修改成<code>ruoyi-gateway.his</code><br><img src="/assets/6b02f0a23df247fc8838ddbdb3c2a51b.png"><br>然后进行打包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm run build:prod<br></code></pre></td></tr></table></figure><p>然后将打包好的dist文件拖拽到nginx中html目录下<br>修改nginx.conf 的<code>server_name</code>为_ (表示可以处理任何IP代理的请求, 因为部署到k8s的pod的IP随时可能会发生变化 ,这个地方不能写死了, 一旦有请求进来了, 不管是发给哪一个pod的IP, 都进行处理)<br><code>proxy_pass</code>指定代理网关<code>http://ruoyi-gateway.his:8080/;</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs bash">worker_processes  1;<br><br>events &#123;<br>    worker_connections  1024;<br>&#125;<br><br>http &#123;<br>    include       mime.types;<br>    default_type  application/octet-stream;<br>    sendfile        on;<br>    keepalive_timeout  65;<br><br>    server &#123;<br>        listen       80;<br>        server_name  _;<br><br>        location / &#123;<br>            root   /home/ruoyi/projects/ruoyi-ui;<br>            try_files <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ /index.html;<br>            index  index.html index.htm;<br>        &#125;<br><br>        location /prod-api/&#123;<br>            proxy_set_header Host <span class="hljs-variable">$http_host</span>;<br>            proxy_set_header X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br>            proxy_set_header REMOTE-HOST <span class="hljs-variable">$remote_addr</span>;<br>            proxy_set_header X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br>            proxy_pass http://ruoyi-gateway.his:8080/;<br>        &#125;<br><br>        <span class="hljs-comment"># 避免actuator暴露</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$request_uri</span> ~ <span class="hljs-string">&quot;/actuator&quot;</span>) &#123;<br>            <span class="hljs-built_in">return</span> 403;<br>        &#125;<br><br>        error_page   500 502 503 504  /50x.html;<br>        location = /50x.html &#123;<br>            root   html;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/assets/a57119cde9c0476791462e4f9b2c3871.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 下载解压工具</span><br>yum install -y unzip zip<br><br><span class="hljs-comment"># 解压nginx</span><br>unzip nginx<br><br><span class="hljs-built_in">cd</span> nginx<br><br><span class="hljs-comment"># docker打包</span><br>docker build -t registry.cn-shenzhen.aliyuncs.com/roudoukou-ruoyi/ruoyi-ui:v1 -f dockerfile .<br><br><span class="hljs-comment"># 推送</span><br>docker push registry.cn-shenzhen.aliyuncs.com/roudoukou-ruoyi/ruoyi-ui:v1<br></code></pre></td></tr></table></figure><p>然后kubesphere创建服务<br>应用负载 - 服务 - 创建 - 无状态服务<br><img src="/assets/943c557cdfc6445d934c48927fc2ac03.png"><br><code>registry.cn-shenzhen.aliyuncs.com/roudoukou-ruoyi/ruoyi-ui:v1</code><br><img src="/assets/30fe8dda75d94bd9897bedf3d3c10459.png"><br><img src="/assets/606b918e1e2e42bea38343be12598965.png"><br><img src="/assets/52f48a32e84b4c029f0f0294188e86aa.png"></p><h3 id="部署的效果图"><a href="#部署的效果图" class="headerlink" title="部署的效果图"></a>部署的效果图</h3><p><img src="/assets/b69f24a0164c4abc8fb627069f819226.png"></p><h3 id="一个补充"><a href="#一个补充" class="headerlink" title="一个补充"></a>一个补充</h3><p>在服务器重启之后, nacos的启动会依赖mysql<br>会出现一种情况, 当nacos的pod启动的时候, 但是mysql的pod还没有启动<br>这样就会照成nacos的启动失败, 然后导致其他的微服务连接不上nacos, 最后导致的结果就是出现好几个微服务都不能正常启动<br>这个时候就可以给nacos添加一个存活探针<br><img src="/assets/d354224e66bf4d869dc1586cac52d7f6.png"></p><h2 id="上云部署尚医通"><a href="#上云部署尚医通" class="headerlink" title="上云部署尚医通"></a>上云部署尚医通</h2><h3 id="部署mongodb"><a href="#部署mongodb" class="headerlink" title="部署mongodb"></a>部署mongodb</h3><p><img src="/assets/d3730340e19648fcae8c273a94a9693c.png"><br><img src="/assets/1477f7b9ec1d4e5093557fb189bf6b11.png"><br><img src="/assets/f7e5227d150542cf8ee44a793203a07a.png"><br><img src="/assets/aa96f69e44ab438c935b85c2345aef16.png"><br><img src="/assets/d3ebcc01095e4f148d643d2318d16824.png"></p><h3 id="部署sentinel"><a href="#部署sentinel" class="headerlink" title="部署sentinel"></a>部署sentinel</h3><p><img src="/assets/ceab447d42fd4a3e8891705451d4c4c2.png"><br><img src="/assets/836b570dbb4c4f37b1a470f0ed4251d1.png"><br><code>leifengyang/sentinel:1.8.2</code><br><img src="/assets/03abc3572ee84a34ba741c62e0b74778.png"><br><img src="/assets/bdc5cedde28e465bb295245e85965b32.png"></p><h3 id="中间件配置"><a href="#中间件配置" class="headerlink" title="中间件配置"></a>中间件配置</h3><table><thead><tr><th>中间件</th><th>集群内地址</th><th>外部访问地址</th></tr></thead><tbody><tr><td>Nacos</td><td>his-nacos.his:8848</td><td><a href="http://139.198.127.220:31695/">http://139.198.127.220:31695/</a>nacos</td></tr><tr><td>MySQL</td><td>his-mysql-node.his:3306</td><td>139.198.127.220:32264</td></tr><tr><td>Redis</td><td>his-redis-node.his:6379</td><td>139.198.127.220:32756</td></tr><tr><td>Sentinel</td><td>his-sentinel.his:8080</td><td></td></tr><tr><td>MongoDB</td><td>mongodb.his:<strong>27017</strong></td><td></td></tr><tr><td></td><td></td><td></td></tr><tr><td>RabbitMQ</td><td>his-rabbitmq.his:5672</td><td>139.198.127.220:30853</td></tr><tr><td>ElasticSearch</td><td>his-es.his:9200</td><td>139.198.127.220:30820</td></tr></tbody></table><p>配置nacos的配置文件</p><p>service-cmn-prod.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span><br><span class="hljs-attr">mybatis-plus:</span><br>  <span class="hljs-attr">configuration:</span><br>    <span class="hljs-attr">log-impl:</span> <span class="hljs-string">org.apache.ibatis.logging.stdout.StdOutImpl</span><br>  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">classpath:mapper/*.xml</span><br>  <span class="hljs-attr">global-config:</span><br>    <span class="hljs-attr">db-config:</span><br>      <span class="hljs-attr">logic-delete-value:</span> <span class="hljs-number">1</span><br>      <span class="hljs-attr">logic-not-delete-value:</span> <span class="hljs-number">0</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">sentinel:</span><br>      <span class="hljs-attr">transport:</span><br>        <span class="hljs-attr">dashboard:</span> <span class="hljs-string">http://his-sentinel.his:8080</span><br>  <span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-string">his-redis-node.his</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span><br>    <span class="hljs-attr">database:</span> <span class="hljs-number">0</span><br>    <span class="hljs-attr">timeout:</span> <span class="hljs-number">1800000</span><br>    <span class="hljs-attr">password:</span><br>    <span class="hljs-attr">lettuce:</span><br>      <span class="hljs-attr">pool:</span><br>        <span class="hljs-attr">max-active:</span> <span class="hljs-number">20</span> <span class="hljs-comment">#最大连接数</span><br>        <span class="hljs-attr">max-wait:</span> <span class="hljs-number">-1</span>    <span class="hljs-comment">#最大阻塞等待时间(负数表示没限制)</span><br>        <span class="hljs-attr">max-idle:</span> <span class="hljs-number">5</span>    <span class="hljs-comment">#最大空闲</span><br>        <span class="hljs-attr">min-idle:</span> <span class="hljs-number">0</span>     <span class="hljs-comment">#最小空闲</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">com.zaxxer.hikari.HikariDataSource</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.jdbc.Driver</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://his-mysql-node.his:3306/yygh_cmn?characterEncoding=utf-8&amp;useSSL=false</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span><br>    <span class="hljs-attr">hikari:</span><br>      <span class="hljs-attr">connection-test-query:</span> <span class="hljs-string">SELECT</span> <span class="hljs-number">1</span><br>      <span class="hljs-attr">connection-timeout:</span> <span class="hljs-number">60000</span><br>      <span class="hljs-attr">idle-timeout:</span> <span class="hljs-number">500000</span><br>      <span class="hljs-attr">max-lifetime:</span> <span class="hljs-number">540000</span><br>      <span class="hljs-attr">maximum-pool-size:</span> <span class="hljs-number">12</span><br>      <span class="hljs-attr">minimum-idle:</span> <span class="hljs-number">10</span><br>      <span class="hljs-attr">pool-name:</span> <span class="hljs-string">GuliHikariPool</span><br>  <span class="hljs-attr">jackson:</span><br>    <span class="hljs-attr">date-format:</span> <span class="hljs-string">yyyy-MM-dd</span> <span class="hljs-string">HH:mm:ss</span><br>    <span class="hljs-attr">time-zone:</span> <span class="hljs-string">GMT+8</span><br></code></pre></td></tr></table></figure><p>service-hosp-prod.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span><br><span class="hljs-attr">mybatis-plus:</span><br>  <span class="hljs-attr">configuration:</span><br>    <span class="hljs-attr">log-impl:</span> <span class="hljs-string">org.apache.ibatis.logging.stdout.StdOutImpl</span><br>  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">classpath:mapper/*.xml</span><br><span class="hljs-attr">feign:</span><br>  <span class="hljs-attr">sentinel:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">config:</span><br>      <span class="hljs-attr">default:</span>   <span class="hljs-comment">#配置全局的feign的调用超时时间  如果 有指定的服务配置 默认的配置不会生效</span><br>        <span class="hljs-attr">connectTimeout:</span> <span class="hljs-number">30000</span> <span class="hljs-comment"># 指定的是 消费者 连接服务提供者的连接超时时间 是否能连接  单位是毫秒</span><br>        <span class="hljs-attr">readTimeout:</span> <span class="hljs-number">50000</span>  <span class="hljs-comment"># 指定的是调用服务提供者的 服务 的超时时间（）  单位是毫秒</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">main:</span><br>    <span class="hljs-attr">allow-bean-definition-overriding:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#当遇到同样名字的时候，是否允许覆盖注册</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">sentinel:</span><br>      <span class="hljs-attr">transport:</span><br>        <span class="hljs-attr">dashboard:</span> <span class="hljs-string">his-sentinel.his:8080</span><br>  <span class="hljs-attr">data:</span><br>    <span class="hljs-attr">mongodb:</span><br>      <span class="hljs-attr">host:</span> <span class="hljs-string">mongodb.his</span><br>      <span class="hljs-attr">port:</span> <span class="hljs-number">27017</span><br>      <span class="hljs-attr">database:</span> <span class="hljs-string">yygh_hosps</span> <span class="hljs-comment">#指定操作的数据库</span><br>  <span class="hljs-attr">rabbitmq:</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-string">his-rabbitmq.his</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">5672</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">admin</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">admin</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">com.zaxxer.hikari.HikariDataSource</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.jdbc.Driver</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://his-mysql-node.his:3306/yygh_hosp?characterEncoding=utf-8&amp;useSSL=false</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span><br>    <span class="hljs-attr">hikari:</span><br>      <span class="hljs-attr">connection-test-query:</span> <span class="hljs-string">SELECT</span> <span class="hljs-number">1</span><br>      <span class="hljs-attr">connection-timeout:</span> <span class="hljs-number">60000</span><br>      <span class="hljs-attr">idle-timeout:</span> <span class="hljs-number">500000</span><br>      <span class="hljs-attr">max-lifetime:</span> <span class="hljs-number">540000</span><br>      <span class="hljs-attr">maximum-pool-size:</span> <span class="hljs-number">12</span><br>      <span class="hljs-attr">minimum-idle:</span> <span class="hljs-number">10</span><br>      <span class="hljs-attr">pool-name:</span> <span class="hljs-string">GuliHikariPool</span><br>  <span class="hljs-attr">jackson:</span><br>    <span class="hljs-attr">date-format:</span> <span class="hljs-string">yyyy-MM-dd</span> <span class="hljs-string">HH:mm:ss</span><br>    <span class="hljs-attr">time-zone:</span> <span class="hljs-string">GMT+8</span><br>  <span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-string">his-redis-node.his</span><br></code></pre></td></tr></table></figure><p>service-order-prod.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span><br><span class="hljs-attr">mybatis-plus:</span><br>  <span class="hljs-attr">configuration:</span><br>    <span class="hljs-attr">log-impl:</span> <span class="hljs-string">org.apache.ibatis.logging.stdout.StdOutImpl</span><br>  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">classpath:mapper/*.xml</span><br><span class="hljs-attr">feign:</span><br>  <span class="hljs-attr">sentinel:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">config:</span><br>      <span class="hljs-attr">default:</span>   <span class="hljs-comment">#配置全局的feign的调用超时时间  如果 有指定的服务配置 默认的配置不会生效</span><br>        <span class="hljs-attr">connectTimeout:</span> <span class="hljs-number">30000</span> <span class="hljs-comment"># 指定的是 消费者 连接服务提供者的连接超时时间 是否能连接  单位是毫秒</span><br>        <span class="hljs-attr">readTimeout:</span> <span class="hljs-number">50000</span>  <span class="hljs-comment"># 指定的是调用服务提供者的 服务 的超时时间（）  单位是毫秒</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">main:</span><br>    <span class="hljs-attr">allow-bean-definition-overriding:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#当遇到同样名字的时候，是否允许覆盖注册</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">sentinel:</span><br>      <span class="hljs-attr">transport:</span><br>        <span class="hljs-attr">dashboard:</span> <span class="hljs-string">http://his-sentinel.his:8080</span><br>  <span class="hljs-attr">rabbitmq:</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-string">his-rabbitmq.his</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">5672</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">admin</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">admin</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">com.zaxxer.hikari.HikariDataSource</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.jdbc.Driver</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://his-mysql-node.his:3306/yygh_order?characterEncoding=utf-8&amp;useSSL=false</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span><br>    <span class="hljs-attr">hikari:</span><br>      <span class="hljs-attr">connection-test-query:</span> <span class="hljs-string">SELECT</span> <span class="hljs-number">1</span><br>      <span class="hljs-attr">connection-timeout:</span> <span class="hljs-number">60000</span><br>      <span class="hljs-attr">idle-timeout:</span> <span class="hljs-number">500000</span><br>      <span class="hljs-attr">max-lifetime:</span> <span class="hljs-number">540000</span><br>      <span class="hljs-attr">maximum-pool-size:</span> <span class="hljs-number">12</span><br>      <span class="hljs-attr">minimum-idle:</span> <span class="hljs-number">10</span><br>      <span class="hljs-attr">pool-name:</span> <span class="hljs-string">GuliHikariPool</span><br>  <span class="hljs-attr">jackson:</span><br>    <span class="hljs-attr">date-format:</span> <span class="hljs-string">yyyy-MM-dd</span> <span class="hljs-string">HH:mm:ss</span><br>    <span class="hljs-attr">time-zone:</span> <span class="hljs-string">GMT+8</span><br>  <span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-string">his-redis-node.his</span><br><span class="hljs-comment"># 微信</span><br><span class="hljs-comment">#weixin:</span><br><span class="hljs-comment">#  appid: wx8397f8696b538317</span><br><span class="hljs-comment">#  partner: 1473426802</span><br><span class="hljs-comment">#  partnerkey: T6m9iK73b0kn9g5v426MKfHQH7X8rKwb</span><br><span class="hljs-comment">#  notifyurl: http://a31ef7db.ngrok.io/WeChatPay/WeChatPayNotify</span><br><span class="hljs-attr">weixin:</span><br>  <span class="hljs-attr">appid:</span> <span class="hljs-string">wx74862e0dfcf69954</span><br>  <span class="hljs-attr">partner:</span> <span class="hljs-number">1558950191</span><br>  <span class="hljs-attr">partnerkey:</span> <span class="hljs-string">T6m9iK73b0kn9g5v426MKfHQH7X8rKwb</span><br>  <span class="hljs-attr">notifyurl:</span> <span class="hljs-string">http://qyben.free.idcfengye.com/api/order/weixin/notify</span><br>  <span class="hljs-attr">cert:</span> <span class="hljs-string">C:\Users\lfy\Desktop\yygh-parent\service\service-order\src\main\resources\apiclient_cert.p12</span><br></code></pre></td></tr></table></figure><p>service-oss-prod.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8205</span><br><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">sentinel:</span><br>      <span class="hljs-attr">transport:</span><br>        <span class="hljs-attr">dashboard:</span> <span class="hljs-string">http://his-sentinel.his:8080</span><br><span class="hljs-comment">#阿里云 OSS</span><br><span class="hljs-attr">aliyun:</span><br>  <span class="hljs-attr">oss:</span><br>    <span class="hljs-attr">file:</span><br>      <span class="hljs-attr">endpoint:</span> <span class="hljs-string">oss-cn-beijing.aliyuncs.com</span><br>      <span class="hljs-attr">keyid:</span> <span class="hljs-string">LTAI4FhtGRtRGtPvmLBv8vxk</span><br>      <span class="hljs-attr">keysecret:</span> <span class="hljs-string">sq8e8WLYoKwJoCNLbjRdlSTaOaFumD</span><br>      <span class="hljs-comment">#bucket可以在控制台创建，也可以使用java代码创建</span><br>      <span class="hljs-attr">bucketname:</span> <span class="hljs-string">online-teach-file</span><br><br></code></pre></td></tr></table></figure><p>service-sms-prod.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span><br><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">sentinel:</span><br>      <span class="hljs-attr">transport:</span><br>        <span class="hljs-attr">dashboard:</span> <span class="hljs-string">http://his-sentinel.his:8080</span><br>  <span class="hljs-attr">rabbitmq:</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-string">his-rabbitmq.his</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">5672</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">admin</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">admin</span><br>  <span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-string">his-redis-node.his</span><br><span class="hljs-comment">#阿里云 短信</span><br><span class="hljs-attr">aliyun:</span><br>  <span class="hljs-attr">sms:</span><br>    <span class="hljs-attr">regionId:</span> <span class="hljs-string">default</span><br>    <span class="hljs-attr">accessKeyId:</span> <span class="hljs-string">LTAI0YbQf3pX8WqC</span><br>    <span class="hljs-attr">secret:</span> <span class="hljs-string">jX8D04DmDI3gGKjW5kaFYSzugfqmmT</span><br><br></code></pre></td></tr></table></figure><p>service-statistics-prod.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8208</span><br><span class="hljs-attr">feign:</span><br>  <span class="hljs-attr">sentinel:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">config:</span><br>      <span class="hljs-attr">default:</span>   <span class="hljs-comment">#配置全局的feign的调用超时时间  如果 有指定的服务配置 默认的配置不会生效</span><br>        <span class="hljs-attr">connectTimeout:</span> <span class="hljs-number">30000</span> <span class="hljs-comment"># 指定的是 消费者 连接服务提供者的连接超时时间 是否能连接  单位是毫秒</span><br>        <span class="hljs-attr">readTimeout:</span> <span class="hljs-number">50000</span>  <span class="hljs-comment"># 指定的是调用服务提供者的 服务 的超时时间（）  单位是毫秒</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">main:</span><br>    <span class="hljs-attr">allow-bean-definition-overriding:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#当遇到同样名字的时候，是否允许覆盖注册</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">sentinel:</span><br>      <span class="hljs-attr">transport:</span><br>        <span class="hljs-attr">dashboard:</span> <span class="hljs-string">http://his-sentinel.his:8080</span><br></code></pre></td></tr></table></figure><p>service-task-prod.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">sentinel:</span><br>      <span class="hljs-attr">transport:</span><br>        <span class="hljs-attr">dashboard:</span> <span class="hljs-string">his-sentinel.his:8080</span><br>  <span class="hljs-attr">rabbitmq:</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-string">his-rabbitmq.his</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">5672</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">admin</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">admin</span><br></code></pre></td></tr></table></figure><p>service-user-prod.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span><br><span class="hljs-attr">mybatis-plus:</span><br>  <span class="hljs-attr">configuration:</span><br>    <span class="hljs-attr">log-impl:</span> <span class="hljs-string">org.apache.ibatis.logging.stdout.StdOutImpl</span><br>  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">classpath:mapper/*.xml</span><br><span class="hljs-attr">feign:</span><br>  <span class="hljs-attr">sentinel:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">config:</span><br>      <span class="hljs-attr">default:</span>   <span class="hljs-comment">#配置全局的feign的调用超时时间  如果 有指定的服务配置 默认的配置不会生效</span><br>        <span class="hljs-attr">connectTimeout:</span> <span class="hljs-number">30000</span> <span class="hljs-comment"># 指定的是 消费者 连接服务提供者的连接超时时间 是否能连接  单位是毫秒</span><br>        <span class="hljs-attr">readTimeout:</span> <span class="hljs-number">50000</span>  <span class="hljs-comment"># 指定的是调用服务提供者的 服务 的超时时间（）  单位是毫秒</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">main:</span><br>    <span class="hljs-attr">allow-bean-definition-overriding:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#当遇到同样名字的时候，是否允许覆盖注册</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">sentinel:</span><br>      <span class="hljs-attr">transport:</span><br>        <span class="hljs-attr">dashboard:</span> <span class="hljs-string">http://his-sentinel.his:8080</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">com.zaxxer.hikari.HikariDataSource</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.jdbc.Driver</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://his-mysql-node.his:3306/yygh_user?characterEncoding=utf-8&amp;useSSL=false</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span><br>    <span class="hljs-attr">hikari:</span><br>      <span class="hljs-attr">connection-test-query:</span> <span class="hljs-string">SELECT</span> <span class="hljs-number">1</span><br>      <span class="hljs-attr">connection-timeout:</span> <span class="hljs-number">60000</span><br>      <span class="hljs-attr">idle-timeout:</span> <span class="hljs-number">500000</span><br>      <span class="hljs-attr">max-lifetime:</span> <span class="hljs-number">540000</span><br>      <span class="hljs-attr">maximum-pool-size:</span> <span class="hljs-number">12</span><br>      <span class="hljs-attr">minimum-idle:</span> <span class="hljs-number">10</span><br>      <span class="hljs-attr">pool-name:</span> <span class="hljs-string">GuliHikariPool</span><br>  <span class="hljs-attr">jackson:</span><br>    <span class="hljs-attr">date-format:</span> <span class="hljs-string">yyyy-MM-dd</span> <span class="hljs-string">HH:mm:ss</span><br>    <span class="hljs-attr">time-zone:</span> <span class="hljs-string">GMT+8</span><br><span class="hljs-attr">wx:</span><br>  <span class="hljs-attr">open:</span><br>    <span class="hljs-comment"># 微信开放平台 appid</span><br>    <span class="hljs-attr">app_id:</span> <span class="hljs-string">wxc606fb748aedee7c</span><br>    <span class="hljs-comment"># 微信开放平台 appsecret</span><br>    <span class="hljs-attr">app_secret:</span> <span class="hljs-string">073e8e1117c1054b14586c8aa922bc9c</span><br>    <span class="hljs-comment"># 微信开放平台 重定向url（需要在微信开放平台配置）</span><br>    <span class="hljs-attr">redirect_url:</span> <span class="hljs-string">http://qyben.free.idcfengye.com/api/user/weixin/callback</span><br>    <span class="hljs-comment">#redirect_url: http://qyben.free.idcfengye.com/api/user/weixin/callback</span><br><span class="hljs-comment">#wx:</span><br><span class="hljs-comment">#  open:</span><br><span class="hljs-comment">#    # 微信开放平台 appid</span><br><span class="hljs-comment">#    app_id: wxed9954c01bb89b47</span><br><span class="hljs-comment">#    # 微信开放平台 appsecret</span><br><span class="hljs-comment">#    app_secret: 2cf9a4a81b6151d560e9bbc625c3297b</span><br><span class="hljs-comment">#    # 微信开放平台 重定向url（需要在微信开放平台配置）</span><br><span class="hljs-comment">#    redirect_url: http://guli.shop/api/ucenter/wx/callback</span><br><span class="hljs-attr">yygh:</span><br>  <span class="hljs-comment">#预约挂号平台baserul</span><br>  <span class="hljs-attr">baseUrl:</span> <span class="hljs-string">http://localhost:3000</span><br></code></pre></td></tr></table></figure><p>server-gateway-prod.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">80</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">server-gateway</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">nacos:</span><br>      <span class="hljs-attr">discovery:</span><br>        <span class="hljs-attr">server-addr:</span> <span class="hljs-string">his-nacos.his:8848</span><br>    <span class="hljs-attr">gateway:</span><br>      <span class="hljs-attr">discovery:</span>      <span class="hljs-comment">#是否与服务发现组件进行结合，通过 serviceId(必须设置成大写) 转发到具体的服务实例。默认为false，设为true便开启通过服务中心的自动根据 serviceId 创建路由的功能。</span><br>        <span class="hljs-attr">locator:</span>      <span class="hljs-comment">#路由访问方式：http://Gateway_HOST:Gateway_PORT/大写的serviceId/**，其中微服务应用名默认大写访问。</span><br>          <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-attr">routes:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">service-user</span><br>          <span class="hljs-attr">uri:</span> <span class="hljs-string">lb://service-user</span><br>          <span class="hljs-attr">predicates:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/*/user/**</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">service-cmn</span><br>          <span class="hljs-attr">uri:</span> <span class="hljs-string">lb://service-cmn</span><br>          <span class="hljs-attr">predicates:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/*/cmn/**</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">service-sms</span><br>          <span class="hljs-attr">uri:</span> <span class="hljs-string">lb://service-sms</span><br>          <span class="hljs-attr">predicates:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/*/sms/**</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">service-hosp</span><br>          <span class="hljs-attr">uri:</span> <span class="hljs-string">lb://service-hosp</span><br>          <span class="hljs-attr">predicates:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/*/hosp/**</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">service-order</span><br>          <span class="hljs-attr">uri:</span> <span class="hljs-string">lb://service-order</span><br>          <span class="hljs-attr">predicates:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/*/order/**</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">service-statistics</span><br>          <span class="hljs-attr">uri:</span> <span class="hljs-string">lb://service-statistics</span><br>          <span class="hljs-attr">predicates:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/*/statistics/**</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">service-cms</span><br>          <span class="hljs-attr">uri:</span> <span class="hljs-string">lb://service-cms</span><br>          <span class="hljs-attr">predicates:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/*/cms/**</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">service-oss</span><br>          <span class="hljs-attr">uri:</span> <span class="hljs-string">lb://service-oss</span><br>          <span class="hljs-attr">predicates:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/*/oss/**</span><br><br></code></pre></td></tr></table></figure><p>最后修改hospital-manage<br><img src="/assets/98cd720cf9484f5f81ca52d073b52d69.png"></p><h3 id="mysql导入sql文件"><a href="#mysql导入sql文件" class="headerlink" title="mysql导入sql文件"></a>mysql导入sql文件</h3><p>将项目中的data&#x2F;sql的sql文件导入到k8s搭建的mysql数据库<br><img src="/assets/628ad1e77d7f499b8ef3ae2bb3bb0c31.png"></p><h3 id="开启devops"><a href="#开启devops" class="headerlink" title="开启devops"></a>开启devops</h3><p>自定义资源 - 搜索”ClusterConfiguration”<br>ks-installer编辑, 将enabled的值改成true</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">devops:</span><br>  <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>创建一个角色self-provisioner分配给账户<br>然后创建一个devops工程<br><img src="/assets/ac027d7d95fa46d0852a80aa056e963d.png"><br><img src="/assets/b0256bec2953407ab5f9078d6b4ae0ee.png"><br><img src="/assets/777dc402be4943c9aba7ad9e597d265f.png"><br>使用xiamu普通账户创建devops工程, 然后切换到admin管理员进行编辑<br>点击一下空白处,然后设置label为maven<br><img src="/assets/f08b4eae414d4632a66a4219db3b1e49.png"></p><h3 id="拉取代码"><a href="#拉取代码" class="headerlink" title="拉取代码"></a>拉取代码</h3><p><img src="/assets/c64e84fcb02b4879ba7f4ace7d0e5f8a.png"><br>然后编写一个shell<br><img src="/assets/d1e245379a5a4f19bea1ef8b579f1454.png"><br><img src="/assets/fb387906e6144d4bac1b25ad602b1dfb.png"><br>然后点击运行<br><img src="/assets/f2ebb7dfa2d04964a603ec6ab42f7ca8.png"><br><img src="/assets/729d9b95246146ed8c4e47455a216221.png"><br><img src="/assets/cd8103e42c2d4b489b34e41911dd51f7.png"><br>可以看见成功的把代码拉取下来了, 并且ls打印出了文件的目录结构</p><h3 id="项目打包"><a href="#项目打包" class="headerlink" title="项目打包"></a>项目打包</h3><p>编写两个shell命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">ls</span><br>mvn clean package -Dmaven.test.skip=<span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p><img src="/assets/ec77dac191d64dbe926e078bbd547fac.png"><br>配置阿里云镜像仓库<code>ks-devops-agent</code><br><img src="/assets/1f34cfd3fc144104afd9d96a3e5020b4.png"><br><img src="/assets/034dcadb085e427daf4c257f1a8ee3cb.png"><br>然后运行, 查看运行日志, 下载的jar包都是从阿里云镜像下载的, 这说明了配置maven镜像仓库配置成功了<br><img src="/assets/95a9d17a80ef472ba02b3f923b8d8b1f.png"></p><h3 id="构建镜像"><a href="#构建镜像" class="headerlink" title="构建镜像"></a>构建镜像</h3><p>这部分直接复制下面的jkenis配置文件覆盖就可以了<br><img src="/assets/6aa784e255284153b0e6a58044e4de52.png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br></pre></td><td class="code"><pre><code class="hljs python">pipeline &#123;<br>  agent &#123;<br>    node &#123;<br>      label <span class="hljs-string">&#x27;maven&#x27;</span><br>    &#125;<br><br>  &#125;<br>  stages &#123;<br>    stage(<span class="hljs-string">&#x27;拉取代码&#x27;</span>) &#123;<br>      agent none<br>      steps &#123;<br>        container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>          git(url: <span class="hljs-string">&#x27;https://gitee.com/leifengyang/yygh-parent&#x27;</span>, branch: <span class="hljs-string">&#x27;master&#x27;</span>, changelog: true, poll: false)<br>          sh <span class="hljs-string">&#x27;ls -al&#x27;</span><br>        &#125;<br><br>      &#125;<br>    &#125;<br><br>    stage(<span class="hljs-string">&#x27;项目编译&#x27;</span>) &#123;<br>      agent none<br>      steps &#123;<br>        container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>          sh <span class="hljs-string">&#x27;ls -al&#x27;</span><br>          sh <span class="hljs-string">&#x27;mvn clean package -Dmaven.test.skip=true&#x27;</span><br>        &#125;<br><br>      &#125;<br>    &#125;<br><br>    stage(<span class="hljs-string">&#x27;default-2&#x27;</span>) &#123;<br>      parallel &#123;<br>        stage(<span class="hljs-string">&#x27;构建hospital-manage镜像&#x27;</span>) &#123;<br>          agent none<br>          steps &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              sh <span class="hljs-string">&#x27;&#x27;&#x27;ls hospital-manage/target</span><br><span class="hljs-string"></span><br><span class="hljs-string">docker build -t hospital-manage:latest -f hospital-manage/Dockerfile ./hospital-manage/&#x27;&#x27;&#x27;</span><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;构建server-gateway镜像&#x27;</span>) &#123;<br>          agent none<br>          steps &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              sh <span class="hljs-string">&#x27;&#x27;&#x27;ls server-gateway/target</span><br><span class="hljs-string"></span><br><span class="hljs-string">docker build -t server-gateway:latest -f server-gateway/Dockerfile ./server-gateway/&#x27;&#x27;&#x27;</span><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;构建service-cmn镜像&#x27;</span>) &#123;<br>          agent none<br>          steps &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              sh <span class="hljs-string">&#x27;&#x27;&#x27;ls service/service-cmn/target</span><br><span class="hljs-string"></span><br><span class="hljs-string">docker build -t service-cmn:latest -f service/service-cmn/Dockerfile ./service/service-cmn/&#x27;&#x27;&#x27;</span><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;构建service-hosp镜像&#x27;</span>) &#123;<br>          agent none<br>          steps &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              sh <span class="hljs-string">&#x27;&#x27;&#x27;ls service/service-hosp/target</span><br><span class="hljs-string"></span><br><span class="hljs-string">docker build -t service-hosp:latest -f service/service-hosp/Dockerfile ./service/service-hosp/&#x27;&#x27;&#x27;</span><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;构建service-order镜像&#x27;</span>) &#123;<br>          agent none<br>          steps &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              sh <span class="hljs-string">&#x27;&#x27;&#x27;ls service/service-order/target</span><br><span class="hljs-string"></span><br><span class="hljs-string">docker build -t service-order:latest -f service/service-order/Dockerfile ./service/service-order/&#x27;&#x27;&#x27;</span><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;构建service-oss镜像&#x27;</span>) &#123;<br>          agent none<br>          steps &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              sh <span class="hljs-string">&#x27;&#x27;&#x27;ls service/service-oss/target</span><br><span class="hljs-string"></span><br><span class="hljs-string">docker build -t service-oss:latest -f service/service-oss/Dockerfile ./service/service-oss/&#x27;&#x27;&#x27;</span><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;构建service-sms镜像&#x27;</span>) &#123;<br>          agent none<br>          steps &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              sh <span class="hljs-string">&#x27;&#x27;&#x27;ls service/service-sms/target</span><br><span class="hljs-string"></span><br><span class="hljs-string">docker build -t service-sms:latest -f service/service-sms/Dockerfile ./service/service-sms/&#x27;&#x27;&#x27;</span><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;构建service-statistics镜像&#x27;</span>) &#123;<br>          agent none<br>          steps &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              sh <span class="hljs-string">&#x27;&#x27;&#x27;ls service/service-statistics/target</span><br><span class="hljs-string"></span><br><span class="hljs-string">docker build -t service-statistics:latest -f service/service-statistics/Dockerfile ./service/service-statistics/&#x27;&#x27;&#x27;</span><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;构建service-task镜像&#x27;</span>) &#123;<br>          agent none<br>          steps &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              sh <span class="hljs-string">&#x27;&#x27;&#x27;ls service/service-task/target</span><br><span class="hljs-string"></span><br><span class="hljs-string">docker build -t service-task:latest -f service/service-task/Dockerfile ./service/service-task/&#x27;&#x27;&#x27;</span><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;构建service-user镜像&#x27;</span>) &#123;<br>          agent none<br>          steps &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              sh <span class="hljs-string">&#x27;&#x27;&#x27;ls service/service-user/target</span><br><span class="hljs-string"></span><br><span class="hljs-string">docker build -t service-user:latest -f service/service-user/Dockerfile ./service/service-user/&#x27;&#x27;&#x27;</span><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br><br>      &#125;<br>    &#125;<br><br>    stage(<span class="hljs-string">&#x27;push latest&#x27;</span>) &#123;<br>      when &#123;<br>        branch <span class="hljs-string">&#x27;master&#x27;</span><br>      &#125;<br>      steps &#123;<br>        container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>          sh <span class="hljs-string">&#x27;docker tag  $REGISTRY/$DOCKERHUB_NAMESPACE/$APP_NAME:SNAPSHOT-$BRANCH_NAME-$BUILD_NUMBER $REGISTRY/$DOCKERHUB_NAMESPACE/$APP_NAME:latest &#x27;</span><br>          sh <span class="hljs-string">&#x27;docker push  $REGISTRY/$DOCKERHUB_NAMESPACE/$APP_NAME:latest &#x27;</span><br>        &#125;<br><br>      &#125;<br>    &#125;<br><br>    stage(<span class="hljs-string">&#x27;deploy to dev&#x27;</span>) &#123;<br>      steps &#123;<br>        <span class="hljs-built_in">input</span>(<span class="hljs-built_in">id</span>: <span class="hljs-string">&#x27;deploy-to-dev&#x27;</span>, message: <span class="hljs-string">&#x27;deploy to dev?&#x27;</span>)<br>        kubernetesDeploy(configs: <span class="hljs-string">&#x27;deploy/dev-ol/**&#x27;</span>, enableConfigSubstitution: true, kubeconfigId: <span class="hljs-string">&quot;$KUBECONFIG_CREDENTIAL_ID&quot;</span>)<br>      &#125;<br>    &#125;<br><br>    stage(<span class="hljs-string">&#x27;deploy to production&#x27;</span>) &#123;<br>      steps &#123;<br>        <span class="hljs-built_in">input</span>(<span class="hljs-built_in">id</span>: <span class="hljs-string">&#x27;deploy-to-production&#x27;</span>, message: <span class="hljs-string">&#x27;deploy to production?&#x27;</span>)<br>        kubernetesDeploy(configs: <span class="hljs-string">&#x27;deploy/prod-ol/**&#x27;</span>, enableConfigSubstitution: true, kubeconfigId: <span class="hljs-string">&quot;$KUBECONFIG_CREDENTIAL_ID&quot;</span>)<br>      &#125;<br>    &#125;<br><br>  &#125;<br>  environment &#123;<br>    DOCKER_CREDENTIAL_ID = <span class="hljs-string">&#x27;dockerhub-id&#x27;</span><br>    GITHUB_CREDENTIAL_ID = <span class="hljs-string">&#x27;github-id&#x27;</span><br>    KUBECONFIG_CREDENTIAL_ID = <span class="hljs-string">&#x27;demo-kubeconfig&#x27;</span><br>    REGISTRY = <span class="hljs-string">&#x27;docker.io&#x27;</span><br>    DOCKERHUB_NAMESPACE = <span class="hljs-string">&#x27;docker_username&#x27;</span><br>    GITHUB_ACCOUNT = <span class="hljs-string">&#x27;kubesphere&#x27;</span><br>    APP_NAME = <span class="hljs-string">&#x27;devops-java-sample&#x27;</span><br>  &#125;<br>  parameters &#123;<br>    string(name: <span class="hljs-string">&#x27;TAG_NAME&#x27;</span>, defaultValue: <span class="hljs-string">&#x27;&#x27;</span>, description: <span class="hljs-string">&#x27;&#x27;</span>)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>运行测试:<br><img src="/assets/e63643e26756429fb7e2845f6ea99ce7.png"></p><h3 id="发布镜像"><a href="#发布镜像" class="headerlink" title="发布镜像"></a>发布镜像</h3><p><img src="/assets/670ad33ff22e4028b9bcb8830eb40790.png"><br><img src="/assets/c5c042a4ec28486c86175e6c65ab1883.png"><br>推送镜像到阿里云远程仓库</p><figure class="highlight puppet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br></pre></td><td class="code"><pre><code class="hljs puppet"><span class="hljs-keyword">pipeline</span> &#123;<br>  agent &#123;<br>    <span class="hljs-keyword">node</span> &#123;<br>      label <span class="hljs-string">&#x27;maven&#x27;</span><br>    &#125;<br><br>  &#125;<br>  <span class="hljs-keyword">stages</span> &#123;<br>    stage(<span class="hljs-string">&#x27;拉取代码&#x27;</span>) &#123;<br>      agent none<br>      steps &#123;<br>        container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>          git(url: <span class="hljs-string">&#x27;https://gitee.com/leifengyang/yygh-parent&#x27;</span>, branch: <span class="hljs-string">&#x27;master&#x27;</span>, changelog: <span class="hljs-keyword">true</span>, poll: <span class="hljs-keyword">false</span>)<br>          sh <span class="hljs-string">&#x27;ls -al&#x27;</span><br>        &#125;<br><br>      &#125;<br>    &#125;<br><br>    stage(<span class="hljs-string">&#x27;项目编译&#x27;</span>) &#123;<br>      agent none<br>      <span class="hljs-keyword">steps</span> &#123;<br>        container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>          sh <span class="hljs-string">&#x27;ls -al&#x27;</span><br>          sh <span class="hljs-string">&#x27;mvn clean package -Dmaven.test.skip=true&#x27;</span><br>        &#125;<br><br>      &#125;<br>    &#125;<br><br>    stage(<span class="hljs-string">&#x27;default-2&#x27;</span>) &#123;<br>      <span class="hljs-keyword">parallel</span> &#123;<br>        stage(<span class="hljs-string">&#x27;构建hospital-manage镜像&#x27;</span>) &#123;<br>          agent none<br>          steps &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              sh <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;ls hospital-manage/target</span><br><span class="hljs-string"></span><br><span class="hljs-string">docker build -t hospital-manage:latest -f hospital-manage/Dockerfile ./hospital-manage/&#x27;</span><span class="hljs-string">&#x27;&#x27;</span><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;构建server-gateway镜像&#x27;</span>) &#123;<br>          agent none<br>          <span class="hljs-keyword">steps</span> &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              sh <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;ls server-gateway/target</span><br><span class="hljs-string"></span><br><span class="hljs-string">docker build -t server-gateway:latest -f server-gateway/Dockerfile ./server-gateway/&#x27;</span><span class="hljs-string">&#x27;&#x27;</span><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;构建service-cmn镜像&#x27;</span>) &#123;<br>          agent none<br>          <span class="hljs-keyword">steps</span> &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              sh <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;ls service/service-cmn/target</span><br><span class="hljs-string"></span><br><span class="hljs-string">docker build -t service-cmn:latest -f service/service-cmn/Dockerfile ./service/service-cmn/&#x27;</span><span class="hljs-string">&#x27;&#x27;</span><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;构建service-hosp镜像&#x27;</span>) &#123;<br>          agent none<br>          <span class="hljs-keyword">steps</span> &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              sh <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;ls service/service-hosp/target</span><br><span class="hljs-string"></span><br><span class="hljs-string">docker build -t service-hosp:latest -f service/service-hosp/Dockerfile ./service/service-hosp/&#x27;</span><span class="hljs-string">&#x27;&#x27;</span><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;构建service-order镜像&#x27;</span>) &#123;<br>          agent none<br>          <span class="hljs-keyword">steps</span> &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              sh <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;ls service/service-order/target</span><br><span class="hljs-string"></span><br><span class="hljs-string">docker build -t service-order:latest -f service/service-order/Dockerfile ./service/service-order/&#x27;</span><span class="hljs-string">&#x27;&#x27;</span><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;构建service-oss镜像&#x27;</span>) &#123;<br>          agent none<br>          <span class="hljs-keyword">steps</span> &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              sh <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;ls service/service-oss/target</span><br><span class="hljs-string"></span><br><span class="hljs-string">docker build -t service-oss:latest -f service/service-oss/Dockerfile ./service/service-oss/&#x27;</span><span class="hljs-string">&#x27;&#x27;</span><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;构建service-sms镜像&#x27;</span>) &#123;<br>          agent none<br>          <span class="hljs-keyword">steps</span> &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              sh <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;ls service/service-sms/target</span><br><span class="hljs-string"></span><br><span class="hljs-string">docker build -t service-sms:latest -f service/service-sms/Dockerfile ./service/service-sms/&#x27;</span><span class="hljs-string">&#x27;&#x27;</span><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;构建service-statistics镜像&#x27;</span>) &#123;<br>          agent none<br>          <span class="hljs-keyword">steps</span> &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              sh <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;ls service/service-statistics/target</span><br><span class="hljs-string"></span><br><span class="hljs-string">docker build -t service-statistics:latest -f service/service-statistics/Dockerfile ./service/service-statistics/&#x27;</span><span class="hljs-string">&#x27;&#x27;</span><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;构建service-task镜像&#x27;</span>) &#123;<br>          agent none<br>          <span class="hljs-keyword">steps</span> &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              sh <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;ls service/service-task/target</span><br><span class="hljs-string"></span><br><span class="hljs-string">docker build -t service-task:latest -f service/service-task/Dockerfile ./service/service-task/&#x27;</span><span class="hljs-string">&#x27;&#x27;</span><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;构建service-user镜像&#x27;</span>) &#123;<br>          agent none<br>          <span class="hljs-keyword">steps</span> &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              sh <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;ls service/service-user/target</span><br><span class="hljs-string"></span><br><span class="hljs-string">docker build -t service-user:latest -f service/service-user/Dockerfile ./service/service-user/&#x27;</span><span class="hljs-string">&#x27;&#x27;</span><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>      &#125;<br>    &#125;<br><br>    stage(<span class="hljs-string">&#x27;default-3&#x27;</span>) &#123;<br>      <span class="hljs-keyword">parallel</span> &#123;<br>        stage(<span class="hljs-string">&#x27;推送hospital-manage镜像&#x27;</span>) &#123;<br>          agent none<br>          steps &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              withCredentials([usernamePassword(credentialsId : <span class="hljs-string">&#x27;aliyun-registry&#x27;</span> ,passwordVariable : <span class="hljs-string">&#x27;DOCKER_PWD_VAR&#x27;</span> ,usernameVariable : <span class="hljs-string">&#x27;DOCKER_USER_VAR&#x27;</span> ,)]) &#123;<br>                sh <span class="hljs-string">&#x27;echo &quot;<span class="hljs-variable">$DOCKER_PWD_VAR</span>&quot; | docker login <span class="hljs-variable">$REGISTRY</span> -u &quot;<span class="hljs-variable">$DOCKER_USER_VAR</span>&quot; --password-stdin&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker tag hospital-manage:latest <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/hospital-manage:SNAPSHOP-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker push <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/hospital-manage:SNAPSHOP-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>              &#125;<br><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;推送server-gateway镜像&#x27;</span>) &#123;<br>          agent none<br>          <span class="hljs-keyword">steps</span> &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              withCredentials([usernamePassword(credentialsId : <span class="hljs-string">&#x27;aliyun-registry&#x27;</span> ,passwordVariable : <span class="hljs-string">&#x27;DOCKER_PWD_VAR&#x27;</span> ,usernameVariable : <span class="hljs-string">&#x27;DOCKER_USER_VAR&#x27;</span> ,)]) &#123;<br>                sh <span class="hljs-string">&#x27;echo &quot;<span class="hljs-variable">$DOCKER_PWD_VAR</span>&quot; | docker login <span class="hljs-variable">$REGISTRY</span> -u &quot;<span class="hljs-variable">$DOCKER_USER_VAR</span>&quot; --password-stdin&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker tag server-gateway:latest <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/server-gateway:SNAPSHOP-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker push <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/server-gateway:SNAPSHOP-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>              &#125;<br><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;推送service-cmn镜像&#x27;</span>) &#123;<br>          agent none<br>          <span class="hljs-keyword">steps</span> &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              withCredentials([usernamePassword(credentialsId : <span class="hljs-string">&#x27;aliyun-registry&#x27;</span> ,passwordVariable : <span class="hljs-string">&#x27;DOCKER_PWD_VAR&#x27;</span> ,usernameVariable : <span class="hljs-string">&#x27;DOCKER_USER_VAR&#x27;</span> ,)]) &#123;<br>                sh <span class="hljs-string">&#x27;echo &quot;<span class="hljs-variable">$DOCKER_PWD_VAR</span>&quot; | docker login <span class="hljs-variable">$REGISTRY</span> -u &quot;<span class="hljs-variable">$DOCKER_USER_VAR</span>&quot; --password-stdin&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker tag service-cmn:latest <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/service-cmn:SNAPSHOP-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker push <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/service-cmn:SNAPSHOP-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>              &#125;<br><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;推送service-hosp镜像&#x27;</span>) &#123;<br>          agent none<br>          <span class="hljs-keyword">steps</span> &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              withCredentials([usernamePassword(credentialsId : <span class="hljs-string">&#x27;aliyun-registry&#x27;</span> ,passwordVariable : <span class="hljs-string">&#x27;DOCKER_PWD_VAR&#x27;</span> ,usernameVariable : <span class="hljs-string">&#x27;DOCKER_USER_VAR&#x27;</span> ,)]) &#123;<br>                sh <span class="hljs-string">&#x27;echo &quot;<span class="hljs-variable">$DOCKER_PWD_VAR</span>&quot; | docker login <span class="hljs-variable">$REGISTRY</span> -u &quot;<span class="hljs-variable">$DOCKER_USER_VAR</span>&quot; --password-stdin&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker tag service-hosp:latest <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/service-hosp:SNAPSHOP-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker push <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/service-hosp:SNAPSHOP-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>              &#125;<br><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;推送service-order镜像&#x27;</span>) &#123;<br>          agent none<br>          <span class="hljs-keyword">steps</span> &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              withCredentials([usernamePassword(credentialsId : <span class="hljs-string">&#x27;aliyun-registry&#x27;</span> ,passwordVariable : <span class="hljs-string">&#x27;DOCKER_PWD_VAR&#x27;</span> ,usernameVariable : <span class="hljs-string">&#x27;DOCKER_USER_VAR&#x27;</span> ,)]) &#123;<br>                sh <span class="hljs-string">&#x27;echo &quot;<span class="hljs-variable">$DOCKER_PWD_VAR</span>&quot; | docker login <span class="hljs-variable">$REGISTRY</span> -u &quot;<span class="hljs-variable">$DOCKER_USER_VAR</span>&quot; --password-stdin&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker tag service-order:latest <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/service-order:SNAPSHOP-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker push <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/service-order:SNAPSHOP-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>              &#125;<br><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;推送service-oss镜像&#x27;</span>) &#123;<br>          agent none<br>          <span class="hljs-keyword">steps</span> &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              withCredentials([usernamePassword(credentialsId : <span class="hljs-string">&#x27;aliyun-registry&#x27;</span> ,passwordVariable : <span class="hljs-string">&#x27;DOCKER_PWD_VAR&#x27;</span> ,usernameVariable : <span class="hljs-string">&#x27;DOCKER_USER_VAR&#x27;</span> ,)]) &#123;<br>                sh <span class="hljs-string">&#x27;echo &quot;<span class="hljs-variable">$DOCKER_PWD_VAR</span>&quot; | docker login <span class="hljs-variable">$REGISTRY</span> -u &quot;<span class="hljs-variable">$DOCKER_USER_VAR</span>&quot; --password-stdin&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker tag service-oss:latest <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/service-oss:SNAPSHOP-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker push <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/service-oss:SNAPSHOP-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>              &#125;<br><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;推送service-sms镜像&#x27;</span>) &#123;<br>          agent none<br>          <span class="hljs-keyword">steps</span> &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              withCredentials([usernamePassword(credentialsId : <span class="hljs-string">&#x27;aliyun-registry&#x27;</span> ,passwordVariable : <span class="hljs-string">&#x27;DOCKER_PWD_VAR&#x27;</span> ,usernameVariable : <span class="hljs-string">&#x27;DOCKER_USER_VAR&#x27;</span> ,)]) &#123;<br>                sh <span class="hljs-string">&#x27;echo &quot;<span class="hljs-variable">$DOCKER_PWD_VAR</span>&quot; | docker login <span class="hljs-variable">$REGISTRY</span> -u &quot;<span class="hljs-variable">$DOCKER_USER_VAR</span>&quot; --password-stdin&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker tag service-sms:latest <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/service-sms:SNAPSHOP-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker push <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/service-sms:SNAPSHOP-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>              &#125;<br><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;推送service-statistics镜像&#x27;</span>) &#123;<br>          agent none<br>          <span class="hljs-keyword">steps</span> &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              withCredentials([usernamePassword(credentialsId : <span class="hljs-string">&#x27;aliyun-registry&#x27;</span> ,passwordVariable : <span class="hljs-string">&#x27;DOCKER_PWD_VAR&#x27;</span> ,usernameVariable : <span class="hljs-string">&#x27;DOCKER_USER_VAR&#x27;</span> ,)]) &#123;<br>                sh <span class="hljs-string">&#x27;echo &quot;<span class="hljs-variable">$DOCKER_PWD_VAR</span>&quot; | docker login <span class="hljs-variable">$REGISTRY</span> -u &quot;<span class="hljs-variable">$DOCKER_USER_VAR</span>&quot; --password-stdin&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker tag service-statistics:latest <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/service-statistics:SNAPSHOP-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker push <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/service-statistics:SNAPSHOP-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>              &#125;<br><br>            &#125;<br><br>          &#125;<br>        &#125;<br>        <br>        stage(<span class="hljs-string">&#x27;推送service-task镜像&#x27;</span>) &#123;<br>          agent none<br>          <span class="hljs-keyword">steps</span> &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              withCredentials([usernamePassword(credentialsId : <span class="hljs-string">&#x27;aliyun-registry&#x27;</span> ,passwordVariable : <span class="hljs-string">&#x27;DOCKER_PWD_VAR&#x27;</span> ,usernameVariable : <span class="hljs-string">&#x27;DOCKER_USER_VAR&#x27;</span> ,)]) &#123;<br>                sh <span class="hljs-string">&#x27;echo &quot;<span class="hljs-variable">$DOCKER_PWD_VAR</span>&quot; | docker login <span class="hljs-variable">$REGISTRY</span> -u &quot;<span class="hljs-variable">$DOCKER_USER_VAR</span>&quot; --password-stdin&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker tag service-task:latest <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/service-task:SNAPSHOP-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker push <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/service-task:SNAPSHOP-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>              &#125;<br><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;推送service-user镜像&#x27;</span>) &#123;<br>          agent none<br>          <span class="hljs-keyword">steps</span> &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              withCredentials([usernamePassword(credentialsId : <span class="hljs-string">&#x27;aliyun-registry&#x27;</span> ,passwordVariable : <span class="hljs-string">&#x27;DOCKER_PWD_VAR&#x27;</span> ,usernameVariable : <span class="hljs-string">&#x27;DOCKER_USER_VAR&#x27;</span> ,)]) &#123;<br>                sh <span class="hljs-string">&#x27;echo &quot;<span class="hljs-variable">$DOCKER_PWD_VAR</span>&quot; | docker login <span class="hljs-variable">$REGISTRY</span> -u &quot;<span class="hljs-variable">$DOCKER_USER_VAR</span>&quot; --password-stdin&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker tag service-user:latest <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/service-user:SNAPSHOP-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker push <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/service-user:SNAPSHOP-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>              &#125;<br><br>            &#125;<br><br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br><br>    stage(<span class="hljs-string">&#x27;deploy to dev&#x27;</span>) &#123;<br>      <span class="hljs-keyword">steps</span> &#123;<br>        input(<span class="hljs-built_in">id</span>: <span class="hljs-string">&#x27;deploy-to-dev&#x27;</span>, <span class="hljs-literal">message</span>: <span class="hljs-string">&#x27;deploy to dev?&#x27;</span>)<br>        kubernetesDeploy(configs: <span class="hljs-string">&#x27;deploy/dev-ol/**&#x27;</span>, enableConfigSubstitution: <span class="hljs-keyword">true</span>, kubeconfigId: <span class="hljs-string">&quot;<span class="hljs-variable">$KUBECONFIG_CREDENTIAL_ID</span>&quot;</span>)<br>      &#125;<br>    &#125;<br><br>    stage(<span class="hljs-string">&#x27;deploy to production&#x27;</span>) &#123;<br>      <span class="hljs-keyword">steps</span> &#123;<br>        input(<span class="hljs-built_in">id</span>: <span class="hljs-string">&#x27;deploy-to-production&#x27;</span>, <span class="hljs-literal">message</span>: <span class="hljs-string">&#x27;deploy to production?&#x27;</span>)<br>        kubernetesDeploy(configs: <span class="hljs-string">&#x27;deploy/prod-ol/**&#x27;</span>, enableConfigSubstitution: <span class="hljs-keyword">true</span>, kubeconfigId: <span class="hljs-string">&quot;<span class="hljs-variable">$KUBECONFIG_CREDENTIAL_ID</span>&quot;</span>)<br>      &#125;<br>    &#125;<br><br>  &#125;<br>  <span class="hljs-keyword">environment</span> &#123;<br>    DOCKER_CREDENTIAL_ID = <span class="hljs-string">&#x27;dockerhub-id&#x27;</span><br>    GITHUB_CREDENTIAL_ID = <span class="hljs-string">&#x27;github-id&#x27;</span><br>    KUBECONFIG_CREDENTIAL_ID = <span class="hljs-string">&#x27;demo-kubeconfig&#x27;</span><br>    REGISTRY = <span class="hljs-string">&#x27;registry.cn-shenzhen.aliyuncs.com&#x27;</span><br>    DOCKERHUB_NAMESPACE = <span class="hljs-string">&#x27;roudoukou-ruoyi&#x27;</span><br>    GITHUB_ACCOUNT = <span class="hljs-string">&#x27;kubesphere&#x27;</span><br>    APP_NAME = <span class="hljs-string">&#x27;devops-java-sample&#x27;</span><br>  &#125;<br>  <span class="hljs-keyword">parameters</span> &#123;<br>    string(<span class="hljs-literal">name</span>: <span class="hljs-string">&#x27;TAG_NAME&#x27;</span>, defaultValue: <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-literal">description</span>: <span class="hljs-string">&#x27;&#x27;</span>)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="部署到dev环境"><a href="#部署到dev环境" class="headerlink" title="部署到dev环境"></a>部署到dev环境</h3><p>编辑流水线,创建一个凭证<br><img src="/assets/d05600e4402745a5a188c13244fd9650.png"><br><img src="/assets/60b2423747a34b1bae446eaa159cddaf.png"><br>kubeconfig默认选择的是<code>$KUBECONFIG_CREDENTIAL_ID</code>(用默认有的)<br>修改配置文件路径<code>hospital-manage/deploy/**</code><br><img src="/assets/c72b23bf722542a49cc3da03e372c9e3.png"><br><img src="/assets/f2962f2e55e64272b7ae835f6de28b47.png"><br>创建秘钥<code>aliyun-docker-hub</code>, 秘钥名应该跟deploy.yml中的name名一样<br><img src="/assets/d8c3ec0746c241a08654f1def24577eb.png"><br>仓库地址<code>registry.cn-shenzhen.aliyuncs.com</code>, 然后填写阿里云的容器镜像服务的用户名和密码<br>顺带点击一下验证<br><img src="/assets/48bb9408323243c98c609ac533520f1c.png"></p><p>把<code>&#39;$KUBECONFIG_CREDENTIAL_ID&#39;</code>替换成<code>&quot;$KUBECONFIG_CREDENTIAL_ID&quot;</code><br>添加一个环境变量<code>ALIYUNHUB_NAMESPACE = &#39;registry.cn-shenzhen.aliyuncs.com&#39;</code><br>在nacos的每一个文件中都添加上redis的配置</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">redis:</span><br><span class="hljs-symbol">    host:</span> his-redis-node.his<br></code></pre></td></tr></table></figure><p>如果使用的是阿里云的服务器,可以使用专有网络来推送镜像, 这样推送镜像走的流量是内网的流量, 更快<br><img src="/assets/01f355c5616e4f2c9847e8fb9f7f106f.png"></p><h3 id="配置邮箱提醒"><a href="#配置邮箱提醒" class="headerlink" title="配置邮箱提醒"></a>配置邮箱提醒</h3><blockquote><p>一个是流水线的邮箱通知, 另一个配置的是kubesphere系统的邮箱通知</p></blockquote><p>开启邮箱通知<br><img src="/assets/02c089f5f56a455685c1a4f5d434e890.png"><br><img src="/assets/e68f78abf0774188b41a83fa041de7cb.png"><br>记得将body中的单引号换成双引号<br><img src="/assets/8babec576c824d61b70102e01194063c.png"><br>配置ks-jenkins的邮箱地址, 这个相当于是系统通知, 刚刚上面配置的是流水线通知<br><img src="/assets/9ec95d31610548ea86143dd1c3fbb49d.png"><br>然后平台设置邮件<br><img src="/assets/ca52e50dc834446f99e82f02c53c0c2f.png"></p><p>然后创建一个devops工程进行测试邮箱服务<br><img src="/assets/a50d77b662cd467fa3a4a757033f9bda.png"><br>记得将这个变量的单引号变成双引号<br><img src="/assets/d3dcae5cd5134b3eba46049e29997112.png"><br>因为单引号不能读取这个变量<br><img src="/assets/3bac765128904cd9aa561b421e24e440.png"></p><p>完整流水线代码: </p><figure class="highlight puppet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br></pre></td><td class="code"><pre><code class="hljs puppet"><span class="hljs-keyword">pipeline</span> &#123;<br>  agent &#123;<br>    <span class="hljs-keyword">node</span> &#123;<br>      label <span class="hljs-string">&#x27;maven&#x27;</span><br>    &#125;<br><br>  &#125;<br>  <span class="hljs-keyword">stages</span> &#123;<br>    stage(<span class="hljs-string">&#x27;拉取代码&#x27;</span>) &#123;<br>      agent none<br>      steps &#123;<br>        container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>          git(url: <span class="hljs-string">&#x27;https://gitee.com/leifengyang/yygh-parent&#x27;</span>, branch: <span class="hljs-string">&#x27;master&#x27;</span>, changelog: <span class="hljs-keyword">true</span>, poll: <span class="hljs-keyword">false</span>)<br>          sh <span class="hljs-string">&#x27;ls -al&#x27;</span><br>        &#125;<br><br>      &#125;<br>    &#125;<br><br>    stage(<span class="hljs-string">&#x27;项目编译&#x27;</span>) &#123;<br>      agent none<br>      <span class="hljs-keyword">steps</span> &#123;<br>        container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>          sh <span class="hljs-string">&#x27;ls -al&#x27;</span><br>          sh <span class="hljs-string">&#x27;mvn clean package -Dmaven.test.skip=true&#x27;</span><br>        &#125;<br><br>      &#125;<br>    &#125;<br><br>    stage(<span class="hljs-string">&#x27;default-2&#x27;</span>) &#123;<br>      <span class="hljs-keyword">parallel</span> &#123;<br>        stage(<span class="hljs-string">&#x27;构建hospital-manage镜像&#x27;</span>) &#123;<br>          agent none<br>          steps &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              sh <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;ls hospital-manage/target</span><br><span class="hljs-string"></span><br><span class="hljs-string">docker build -t hospital-manage:latest -f hospital-manage/Dockerfile ./hospital-manage/&#x27;</span><span class="hljs-string">&#x27;&#x27;</span><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;构建server-gateway镜像&#x27;</span>) &#123;<br>          agent none<br>          <span class="hljs-keyword">steps</span> &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              sh <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;ls server-gateway/target</span><br><span class="hljs-string"></span><br><span class="hljs-string">docker build -t server-gateway:latest -f server-gateway/Dockerfile ./server-gateway/&#x27;</span><span class="hljs-string">&#x27;&#x27;</span><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;构建service-cmn镜像&#x27;</span>) &#123;<br>          agent none<br>          <span class="hljs-keyword">steps</span> &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              sh <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;ls service/service-cmn/target</span><br><span class="hljs-string"></span><br><span class="hljs-string">docker build -t service-cmn:latest -f service/service-cmn/Dockerfile ./service/service-cmn/&#x27;</span><span class="hljs-string">&#x27;&#x27;</span><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;构建service-hosp镜像&#x27;</span>) &#123;<br>          agent none<br>          <span class="hljs-keyword">steps</span> &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              sh <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;ls service/service-hosp/target</span><br><span class="hljs-string"></span><br><span class="hljs-string">docker build -t service-hosp:latest -f service/service-hosp/Dockerfile ./service/service-hosp/&#x27;</span><span class="hljs-string">&#x27;&#x27;</span><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;构建service-order镜像&#x27;</span>) &#123;<br>          agent none<br>          <span class="hljs-keyword">steps</span> &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              sh <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;ls service/service-order/target</span><br><span class="hljs-string"></span><br><span class="hljs-string">docker build -t service-order:latest -f service/service-order/Dockerfile ./service/service-order/&#x27;</span><span class="hljs-string">&#x27;&#x27;</span><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;构建service-oss镜像&#x27;</span>) &#123;<br>          agent none<br>          <span class="hljs-keyword">steps</span> &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              sh <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;ls service/service-oss/target</span><br><span class="hljs-string"></span><br><span class="hljs-string">docker build -t service-oss:latest -f service/service-oss/Dockerfile ./service/service-oss/&#x27;</span><span class="hljs-string">&#x27;&#x27;</span><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;构建service-sms镜像&#x27;</span>) &#123;<br>          agent none<br>          <span class="hljs-keyword">steps</span> &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              sh <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;ls service/service-sms/target</span><br><span class="hljs-string"></span><br><span class="hljs-string">docker build -t service-sms:latest -f service/service-sms/Dockerfile ./service/service-sms/&#x27;</span><span class="hljs-string">&#x27;&#x27;</span><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;构建service-statistics镜像&#x27;</span>) &#123;<br>          agent none<br>          <span class="hljs-keyword">steps</span> &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              sh <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;ls service/service-statistics/target</span><br><span class="hljs-string"></span><br><span class="hljs-string">docker build -t service-statistics:latest -f service/service-statistics/Dockerfile ./service/service-statistics/&#x27;</span><span class="hljs-string">&#x27;&#x27;</span><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;构建service-task镜像&#x27;</span>) &#123;<br>          agent none<br>          <span class="hljs-keyword">steps</span> &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              sh <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;ls service/service-task/target</span><br><span class="hljs-string"></span><br><span class="hljs-string">docker build -t service-task:latest -f service/service-task/Dockerfile ./service/service-task/&#x27;</span><span class="hljs-string">&#x27;&#x27;</span><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;构建service-user镜像&#x27;</span>) &#123;<br>          agent none<br>          <span class="hljs-keyword">steps</span> &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              sh <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;ls service/service-user/target</span><br><span class="hljs-string"></span><br><span class="hljs-string">docker build -t service-user:latest -f service/service-user/Dockerfile ./service/service-user/&#x27;</span><span class="hljs-string">&#x27;&#x27;</span><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>      &#125;<br>    &#125;<br><br>    stage(<span class="hljs-string">&#x27;default-3&#x27;</span>) &#123;<br>      <span class="hljs-keyword">parallel</span> &#123;<br>        stage(<span class="hljs-string">&#x27;推送hospital-manage镜像&#x27;</span>) &#123;<br>          agent none<br>          steps &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              withCredentials([usernamePassword(credentialsId : <span class="hljs-string">&#x27;aliyun-registry&#x27;</span> ,passwordVariable : <span class="hljs-string">&#x27;DOCKER_PWD_VAR&#x27;</span> ,usernameVariable : <span class="hljs-string">&#x27;DOCKER_USER_VAR&#x27;</span> ,)]) &#123;<br>                sh <span class="hljs-string">&#x27;echo &quot;<span class="hljs-variable">$DOCKER_PWD_VAR</span>&quot; | docker login <span class="hljs-variable">$REGISTRY</span> -u &quot;<span class="hljs-variable">$DOCKER_USER_VAR</span>&quot; --password-stdin&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker tag hospital-manage:latest <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/hospital-manage:SNAPSHOT-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker push <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/hospital-manage:SNAPSHOT-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>              &#125;<br><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;推送server-gateway镜像&#x27;</span>) &#123;<br>          agent none<br>          <span class="hljs-keyword">steps</span> &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              withCredentials([usernamePassword(credentialsId : <span class="hljs-string">&#x27;aliyun-registry&#x27;</span> ,passwordVariable : <span class="hljs-string">&#x27;DOCKER_PWD_VAR&#x27;</span> ,usernameVariable : <span class="hljs-string">&#x27;DOCKER_USER_VAR&#x27;</span> ,)]) &#123;<br>                sh <span class="hljs-string">&#x27;echo &quot;<span class="hljs-variable">$DOCKER_PWD_VAR</span>&quot; | docker login <span class="hljs-variable">$REGISTRY</span> -u &quot;<span class="hljs-variable">$DOCKER_USER_VAR</span>&quot; --password-stdin&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker tag server-gateway:latest <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/server-gateway:SNAPSHOT-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker push <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/server-gateway:SNAPSHOT-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>              &#125;<br><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;推送service-cmn镜像&#x27;</span>) &#123;<br>          agent none<br>          <span class="hljs-keyword">steps</span> &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              withCredentials([usernamePassword(credentialsId : <span class="hljs-string">&#x27;aliyun-registry&#x27;</span> ,passwordVariable : <span class="hljs-string">&#x27;DOCKER_PWD_VAR&#x27;</span> ,usernameVariable : <span class="hljs-string">&#x27;DOCKER_USER_VAR&#x27;</span> ,)]) &#123;<br>                sh <span class="hljs-string">&#x27;echo &quot;<span class="hljs-variable">$DOCKER_PWD_VAR</span>&quot; | docker login <span class="hljs-variable">$REGISTRY</span> -u &quot;<span class="hljs-variable">$DOCKER_USER_VAR</span>&quot; --password-stdin&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker tag service-cmn:latest <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/service-cmn:SNAPSHOT-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker push <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/service-cmn:SNAPSHOT-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>              &#125;<br><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;推送service-hosp镜像&#x27;</span>) &#123;<br>          agent none<br>          <span class="hljs-keyword">steps</span> &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              withCredentials([usernamePassword(credentialsId : <span class="hljs-string">&#x27;aliyun-registry&#x27;</span> ,passwordVariable : <span class="hljs-string">&#x27;DOCKER_PWD_VAR&#x27;</span> ,usernameVariable : <span class="hljs-string">&#x27;DOCKER_USER_VAR&#x27;</span> ,)]) &#123;<br>                sh <span class="hljs-string">&#x27;echo &quot;<span class="hljs-variable">$DOCKER_PWD_VAR</span>&quot; | docker login <span class="hljs-variable">$REGISTRY</span> -u &quot;<span class="hljs-variable">$DOCKER_USER_VAR</span>&quot; --password-stdin&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker tag service-hosp:latest <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/service-hosp:SNAPSHOT-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker push <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/service-hosp:SNAPSHOT-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>              &#125;<br><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;推送service-order镜像&#x27;</span>) &#123;<br>          agent none<br>          <span class="hljs-keyword">steps</span> &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              withCredentials([usernamePassword(credentialsId : <span class="hljs-string">&#x27;aliyun-registry&#x27;</span> ,passwordVariable : <span class="hljs-string">&#x27;DOCKER_PWD_VAR&#x27;</span> ,usernameVariable : <span class="hljs-string">&#x27;DOCKER_USER_VAR&#x27;</span> ,)]) &#123;<br>                sh <span class="hljs-string">&#x27;echo &quot;<span class="hljs-variable">$DOCKER_PWD_VAR</span>&quot; | docker login <span class="hljs-variable">$REGISTRY</span> -u &quot;<span class="hljs-variable">$DOCKER_USER_VAR</span>&quot; --password-stdin&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker tag service-order:latest <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/service-order:SNAPSHOT-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker push <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/service-order:SNAPSHOT-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>              &#125;<br><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;推送service-oss镜像&#x27;</span>) &#123;<br>          agent none<br>          <span class="hljs-keyword">steps</span> &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              withCredentials([usernamePassword(credentialsId : <span class="hljs-string">&#x27;aliyun-registry&#x27;</span> ,passwordVariable : <span class="hljs-string">&#x27;DOCKER_PWD_VAR&#x27;</span> ,usernameVariable : <span class="hljs-string">&#x27;DOCKER_USER_VAR&#x27;</span> ,)]) &#123;<br>                sh <span class="hljs-string">&#x27;echo &quot;<span class="hljs-variable">$DOCKER_PWD_VAR</span>&quot; | docker login <span class="hljs-variable">$REGISTRY</span> -u &quot;<span class="hljs-variable">$DOCKER_USER_VAR</span>&quot; --password-stdin&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker tag service-oss:latest <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/service-oss:SNAPSHOT-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker push <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/service-oss:SNAPSHOT-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>              &#125;<br><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;推送service-sms镜像&#x27;</span>) &#123;<br>          agent none<br>          <span class="hljs-keyword">steps</span> &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              withCredentials([usernamePassword(credentialsId : <span class="hljs-string">&#x27;aliyun-registry&#x27;</span> ,passwordVariable : <span class="hljs-string">&#x27;DOCKER_PWD_VAR&#x27;</span> ,usernameVariable : <span class="hljs-string">&#x27;DOCKER_USER_VAR&#x27;</span> ,)]) &#123;<br>                sh <span class="hljs-string">&#x27;echo &quot;<span class="hljs-variable">$DOCKER_PWD_VAR</span>&quot; | docker login <span class="hljs-variable">$REGISTRY</span> -u &quot;<span class="hljs-variable">$DOCKER_USER_VAR</span>&quot; --password-stdin&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker tag service-sms:latest <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/service-sms:SNAPSHOT-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker push <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/service-sms:SNAPSHOT-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>              &#125;<br><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;推送service-statistics镜像&#x27;</span>) &#123;<br>          agent none<br>          <span class="hljs-keyword">steps</span> &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              withCredentials([usernamePassword(credentialsId : <span class="hljs-string">&#x27;aliyun-registry&#x27;</span> ,passwordVariable : <span class="hljs-string">&#x27;DOCKER_PWD_VAR&#x27;</span> ,usernameVariable : <span class="hljs-string">&#x27;DOCKER_USER_VAR&#x27;</span> ,)]) &#123;<br>                sh <span class="hljs-string">&#x27;echo &quot;<span class="hljs-variable">$DOCKER_PWD_VAR</span>&quot; | docker login <span class="hljs-variable">$REGISTRY</span> -u &quot;<span class="hljs-variable">$DOCKER_USER_VAR</span>&quot; --password-stdin&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker tag service-statistics:latest <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/service-statistics:SNAPSHOT-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker push <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/service-statistics:SNAPSHOT-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>              &#125;<br><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;推送service-task镜像&#x27;</span>) &#123;<br>          agent none<br>          <span class="hljs-keyword">steps</span> &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              withCredentials([usernamePassword(credentialsId : <span class="hljs-string">&#x27;aliyun-registry&#x27;</span> ,passwordVariable : <span class="hljs-string">&#x27;DOCKER_PWD_VAR&#x27;</span> ,usernameVariable : <span class="hljs-string">&#x27;DOCKER_USER_VAR&#x27;</span> ,)]) &#123;<br>                sh <span class="hljs-string">&#x27;echo &quot;<span class="hljs-variable">$DOCKER_PWD_VAR</span>&quot; | docker login <span class="hljs-variable">$REGISTRY</span> -u &quot;<span class="hljs-variable">$DOCKER_USER_VAR</span>&quot; --password-stdin&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker tag service-task:latest <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/service-task:SNAPSHOT-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker push <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/service-task:SNAPSHOT-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>              &#125;<br><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;推送service-user镜像&#x27;</span>) &#123;<br>          agent none<br>          <span class="hljs-keyword">steps</span> &#123;<br>            container(<span class="hljs-string">&#x27;maven&#x27;</span>) &#123;<br>              withCredentials([usernamePassword(credentialsId : <span class="hljs-string">&#x27;aliyun-registry&#x27;</span> ,passwordVariable : <span class="hljs-string">&#x27;DOCKER_PWD_VAR&#x27;</span> ,usernameVariable : <span class="hljs-string">&#x27;DOCKER_USER_VAR&#x27;</span> ,)]) &#123;<br>                sh <span class="hljs-string">&#x27;echo &quot;<span class="hljs-variable">$DOCKER_PWD_VAR</span>&quot; | docker login <span class="hljs-variable">$REGISTRY</span> -u &quot;<span class="hljs-variable">$DOCKER_USER_VAR</span>&quot; --password-stdin&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker tag service-user:latest <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/service-user:SNAPSHOT-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>                sh <span class="hljs-string">&#x27;docker push <span class="hljs-variable">$REGISTRY</span>/<span class="hljs-variable">$DOCKERHUB_NAMESPACE</span>/service-user:SNAPSHOT-<span class="hljs-variable">$BUILD_NUMBER</span>&#x27;</span><br>              &#125;<br><br>            &#125;<br><br>          &#125;<br>        &#125;<br><br>      &#125;<br>    &#125;<br><br>    stage(<span class="hljs-string">&#x27;default-4&#x27;</span>) &#123;<br>      <span class="hljs-keyword">parallel</span> &#123;<br>        stage(<span class="hljs-string">&#x27;hospital-manage - 部署到dev环境&#x27;</span>) &#123;<br>          steps &#123;<br>            kubernetesDeploy(enableConfigSubstitution: <span class="hljs-keyword">true</span>, deleteResource: <span class="hljs-keyword">false</span>, kubeconfigId: <span class="hljs-string">&quot;<span class="hljs-variable">$KUBECONFIG_CREDENTIAL_ID</span>&quot;</span>, configs: <span class="hljs-string">&#x27;hospital-manage/deploy/**&#x27;</span>)<br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;server-gateway - 部署到dev环境&#x27;</span>) &#123;<br>          <span class="hljs-keyword">steps</span> &#123;<br>            kubernetesDeploy(enableConfigSubstitution: <span class="hljs-keyword">true</span>, deleteResource: <span class="hljs-keyword">false</span>, kubeconfigId: <span class="hljs-string">&quot;<span class="hljs-variable">$KUBECONFIG_CREDENTIAL_ID</span>&quot;</span>, configs: <span class="hljs-string">&#x27;server-gateway/deploy/**&#x27;</span>)<br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;service-cmn - 部署到dev环境&#x27;</span>) &#123;<br>          <span class="hljs-keyword">steps</span> &#123;<br>            kubernetesDeploy(enableConfigSubstitution: <span class="hljs-keyword">true</span>, deleteResource: <span class="hljs-keyword">false</span>, kubeconfigId: <span class="hljs-string">&quot;<span class="hljs-variable">$KUBECONFIG_CREDENTIAL_ID</span>&quot;</span>, configs: <span class="hljs-string">&#x27;service/service-cmn/deploy/**&#x27;</span>)<br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;service-hosp - 部署到dev环境&#x27;</span>) &#123;<br>          <span class="hljs-keyword">steps</span> &#123;<br>            kubernetesDeploy(enableConfigSubstitution: <span class="hljs-keyword">true</span>, deleteResource: <span class="hljs-keyword">false</span>, kubeconfigId: <span class="hljs-string">&quot;<span class="hljs-variable">$KUBECONFIG_CREDENTIAL_ID</span>&quot;</span>, configs: <span class="hljs-string">&#x27;service/service-hosp/deploy/**&#x27;</span>)<br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;service-order - 部署到dev环境&#x27;</span>) &#123;<br>          <span class="hljs-keyword">steps</span> &#123;<br>            kubernetesDeploy(enableConfigSubstitution: <span class="hljs-keyword">true</span>, deleteResource: <span class="hljs-keyword">false</span>, kubeconfigId: <span class="hljs-string">&quot;<span class="hljs-variable">$KUBECONFIG_CREDENTIAL_ID</span>&quot;</span>, configs: <span class="hljs-string">&#x27;service/service-order/deploy/**&#x27;</span>)<br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;service-oss - 部署到dev环境&#x27;</span>) &#123;<br>          <span class="hljs-keyword">steps</span> &#123;<br>            kubernetesDeploy(enableConfigSubstitution: <span class="hljs-keyword">true</span>, deleteResource: <span class="hljs-keyword">false</span>, kubeconfigId: <span class="hljs-string">&quot;<span class="hljs-variable">$KUBECONFIG_CREDENTIAL_ID</span>&quot;</span>, configs: <span class="hljs-string">&#x27;service/service-oss/deploy/**&#x27;</span>)<br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;service-sms - 部署到dev环境&#x27;</span>) &#123;<br>          <span class="hljs-keyword">steps</span> &#123;<br>            kubernetesDeploy(enableConfigSubstitution: <span class="hljs-keyword">true</span>, deleteResource: <span class="hljs-keyword">false</span>, kubeconfigId: <span class="hljs-string">&quot;<span class="hljs-variable">$KUBECONFIG_CREDENTIAL_ID</span>&quot;</span>, configs: <span class="hljs-string">&#x27;service/service-sms/deploy/**&#x27;</span>)<br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;service-statistics - 部署到dev环境&#x27;</span>) &#123;<br>          <span class="hljs-keyword">steps</span> &#123;<br>            kubernetesDeploy(enableConfigSubstitution: <span class="hljs-keyword">true</span>, deleteResource: <span class="hljs-keyword">false</span>, kubeconfigId: <span class="hljs-string">&quot;<span class="hljs-variable">$KUBECONFIG_CREDENTIAL_ID</span>&quot;</span>, configs: <span class="hljs-string">&#x27;service/service-statistics/deploy/**&#x27;</span>)<br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;service-task - 部署到dev环境&#x27;</span>) &#123;<br>          <span class="hljs-keyword">steps</span> &#123;<br>            kubernetesDeploy(enableConfigSubstitution: <span class="hljs-keyword">true</span>, deleteResource: <span class="hljs-keyword">false</span>, kubeconfigId: <span class="hljs-string">&quot;<span class="hljs-variable">$KUBECONFIG_CREDENTIAL_ID</span>&quot;</span>, configs: <span class="hljs-string">&#x27;service/service-task/deploy/**&#x27;</span>)<br>          &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;service-user - 部署到dev环境&#x27;</span>) &#123;<br>          <span class="hljs-keyword">steps</span> &#123;<br>            kubernetesDeploy(enableConfigSubstitution: <span class="hljs-keyword">true</span>, deleteResource: <span class="hljs-keyword">false</span>, kubeconfigId: <span class="hljs-string">&quot;<span class="hljs-variable">$KUBECONFIG_CREDENTIAL_ID</span>&quot;</span>, configs: <span class="hljs-string">&#x27;service/service-user/deploy/**&#x27;</span>)<br>          &#125;<br>        &#125;<br><br>      &#125;<br>    &#125;<br><br>    stage(<span class="hljs-string">&#x27;发送确认邮件&#x27;</span>) &#123;<br>      agent none<br>      <span class="hljs-keyword">steps</span> &#123;<br>        mail(to: <span class="hljs-string">&#x27;1023876294@qq.com&#x27;</span>, subject: <span class="hljs-string">&#x27;构建结果&#x27;</span>, body: <span class="hljs-string">&quot;构建成功了 <span class="hljs-variable">$BUILD_NUMBER</span>&quot;</span>)<br>      &#125;<br>    &#125;<br><br>  &#125;<br>  <span class="hljs-keyword">environment</span> &#123;<br>    DOCKER_CREDENTIAL_ID = <span class="hljs-string">&#x27;dockerhub-id&#x27;</span><br>    GITHUB_CREDENTIAL_ID = <span class="hljs-string">&#x27;github-id&#x27;</span><br>    KUBECONFIG_CREDENTIAL_ID = <span class="hljs-string">&#x27;demo-kubeconfig&#x27;</span><br>    REGISTRY = <span class="hljs-string">&#x27;registry.cn-shenzhen.aliyuncs.com&#x27;</span><br>    DOCKERHUB_NAMESPACE = <span class="hljs-string">&#x27;roudoukou-ruoyi&#x27;</span><br>    GITHUB_ACCOUNT = <span class="hljs-string">&#x27;kubesphere&#x27;</span><br>    APP_NAME = <span class="hljs-string">&#x27;devops-java-sample&#x27;</span><br>    ALIYUNHUB_NAMESPACE = <span class="hljs-string">&#x27;roudoukou-ruoyi&#x27;</span><br>  &#125;<br>  <span class="hljs-keyword">parameters</span> &#123;<br>    string(<span class="hljs-literal">name</span>: <span class="hljs-string">&#x27;TAG_NAME&#x27;</span>, defaultValue: <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-literal">description</span>: <span class="hljs-string">&#x27;&#x27;</span>)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="导入mongodb数据"><a href="#导入mongodb数据" class="headerlink" title="导入mongodb数据"></a>导入mongodb数据</h3><p>配置mongodb外网访问<br><img src="/assets/8c0f6769b38b45ae91a1fc5be9c1d0a8.png"><br>连接mongodb<br><img src="/assets/303e1bc672df4212ae414bdf2c95d19a.png"><br>导入如下的数据<br><img src="/assets/b600de6d8b044f0385871918e59e058f.png"></p><h3 id="本地运行尚医通后台项目"><a href="#本地运行尚医通后台项目" class="headerlink" title="本地运行尚医通后台项目"></a>本地运行尚医通后台项目</h3><blockquote><p>gitee仓库地址</p><p><a href="https://gitee.com/xialonggui/yygh-admin">https://gitee.com/xialonggui/yygh-admin</a><br><a href="https://gitee.com/xialonggui/yygh-site">https://gitee.com/xialonggui/yygh-site</a></p></blockquote><p>双击idea的shift键, 搜索到<code>JwtHelper</code><img src="/assets/0d7cfc4a1d214e45aa799a1e899f7651.png"><br>将生成的token记录下来, 在src\store\modules\user.js文件修改<br><img src="/assets/8932d07cb2c045e6a408bb8fa540abfa.png"><br>然后修改config&#x2F;dev.env.js 和 config&#x2F;prod.env.js<br>修改成暴露出来的server-gateway网关地址<br><img src="/assets/b6d15f88f83d4956af98dc6390e064f0.png"></p><p>安装相关依赖</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 建议将node版本降低到14版本, 不然会出来严重的历史残留bug, 比如sass版本的不匹配</span><br><span class="hljs-comment"># 所以最简单的办法就是降低nodejs的版本</span><br>node -v<br><span class="hljs-comment"># v14.21.3</span><br><br><span class="hljs-comment"># 安装node-sass</span><br>npm i node-sass --sass_binary_site=https://npm.taobao.org/mirrors/node-sass/<br><br><span class="hljs-comment"># 安装</span><br>npm install --registry=https://registry.npm.taobao.org<br><br><span class="hljs-comment"># 运行</span><br>npm run dev<br><br></code></pre></td></tr></table></figure><p>至此本地项目就运行起来了<br>然后在gitee上创建一个代码仓库, 为什么要创建仓库呢?<br>因为这个雷丰阳老师提供<a href="https://gitee.com/leifengyang/yygh-admin">仓库</a>的地址的网关是没有修改的, 我们得修改成自己的网关地址, 也就是得使用自己的代码</p><h3 id="上云部署尚医通后台项目"><a href="#上云部署尚医通后台项目" class="headerlink" title="上云部署尚医通后台项目"></a>上云部署尚医通后台项目</h3><p><img src="/assets/4de6b45db70e41b2963d099d137680aa.png"><br><img src="/assets/cfd9b8e78845494a8aa8de29894e2530.png"><br>稍微等待一下, 会自动拉取代码</p><p>webhook</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">139.198</span>.<span class="hljs-number">117.67</span>:<span class="hljs-number">30880</span><span class="hljs-regexp">/devops_webhook/gi</span>t<span class="hljs-regexp">/?url=https:/</span><span class="hljs-regexp">/gitee.com/</span>xialonggui/yygh-admin.git<br></code></pre></td></tr></table></figure><p>然后修改Jenkinsfile</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs javascript">pipeline &#123;<br>    agent &#123;<br>        node &#123;<br>            label <span class="hljs-string">&#x27;nodejs&#x27;</span><br>        &#125;<br><br>    &#125;<br>    stages &#123;<br>        <span class="hljs-title function_">stage</span>(<span class="hljs-params"><span class="hljs-string">&#x27;拉取代码&#x27;</span></span>) &#123;<br>            agent none<br>            steps &#123;<br>                <span class="hljs-title function_">container</span>(<span class="hljs-params"><span class="hljs-string">&#x27;nodejs&#x27;</span></span>) &#123;<br>                    <span class="hljs-title function_">git</span>(<span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;https://gitee.com/xialonggui/yygh-admin.git&#x27;</span>, <span class="hljs-attr">credentialsId</span>: <span class="hljs-string">&#x27;gitee-id&#x27;</span>, <span class="hljs-attr">branch</span>: <span class="hljs-string">&#x27;master&#x27;</span>, <span class="hljs-attr">changelog</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">poll</span>: <span class="hljs-literal">false</span>)<br>                    sh <span class="hljs-string">&#x27;ls -al&#x27;</span><br>                &#125;<br><br>            &#125;<br>        &#125;<br><br>        <span class="hljs-title function_">stage</span>(<span class="hljs-params"><span class="hljs-string">&#x27;项目编译&#x27;</span></span>) &#123;<br>            agent none<br>            steps &#123;<br>                <span class="hljs-title function_">container</span>(<span class="hljs-params"><span class="hljs-string">&#x27;nodejs&#x27;</span></span>) &#123;<br>                    sh <span class="hljs-string">&#x27;npm i node-sass --sass_binary_site=https://npm.taobao.org/mirrors/node-sass/&#x27;</span><br>                    sh <span class="hljs-string">&#x27;npm install --registry=https://registry.npm.taobao.org&#x27;</span><br>                    sh <span class="hljs-string">&#x27;npm run build&#x27;</span><br>                    sh <span class="hljs-string">&#x27;ls&#x27;</span><br>                &#125;<br><br>            &#125;<br>        &#125;<br><br>        <span class="hljs-title function_">stage</span>(<span class="hljs-params"><span class="hljs-string">&#x27;构建镜像&#x27;</span></span>) &#123;<br>            agent none<br>            steps &#123;<br>                <span class="hljs-title function_">container</span>(<span class="hljs-params"><span class="hljs-string">&#x27;nodejs&#x27;</span></span>) &#123;<br>                    sh <span class="hljs-string">&#x27;ls&#x27;</span><br>                    sh <span class="hljs-string">&#x27;docker build -t yygh-admin:latest -f Dockerfile  .&#x27;</span><br>                &#125;<br><br>            &#125;<br>        &#125;<br><br>        <span class="hljs-title function_">stage</span>(<span class="hljs-params"><span class="hljs-string">&#x27;推送镜像&#x27;</span></span>) &#123;<br>            agent none<br>            steps &#123;<br>                <span class="hljs-title function_">container</span>(<span class="hljs-params"><span class="hljs-string">&#x27;nodejs&#x27;</span></span>) &#123;<br>                    <span class="hljs-title function_">withCredentials</span>(<span class="hljs-params">[usernamePassword(credentialsId : <span class="hljs-string">&#x27;aliyun-registry&#x27;</span> ,usernameVariable : <span class="hljs-string">&#x27;DOCKER_USER_VAR&#x27;</span> ,passwordVariable : <span class="hljs-string">&#x27;DOCKER_PWD_VAR&#x27;</span> ,)]</span>) &#123;<br>                        sh <span class="hljs-string">&#x27;echo &quot;$DOCKER_PWD_VAR&quot; | docker login $REGISTRY -u &quot;$DOCKER_USER_VAR&quot; --password-stdin&#x27;</span><br>                        sh <span class="hljs-string">&#x27;docker tag yygh-admin:latest $REGISTRY/$DOCKERHUB_NAMESPACE/yygh-admin:SNAPSHOT-$BUILD_NUMBER&#x27;</span><br>                        sh <span class="hljs-string">&#x27;docker push  $REGISTRY/$DOCKERHUB_NAMESPACE/yygh-admin:SNAPSHOT-$BUILD_NUMBER&#x27;</span><br>                    &#125;<br><br>                &#125;<br><br>            &#125;<br>        &#125;<br><br>        <span class="hljs-title function_">stage</span>(<span class="hljs-params"><span class="hljs-string">&#x27;部署到dev环境&#x27;</span></span>) &#123;<br>            agent none<br>            steps &#123;<br>                <span class="hljs-title function_">kubernetesDeploy</span>(<span class="hljs-attr">configs</span>: <span class="hljs-string">&#x27;deploy/**&#x27;</span>, <span class="hljs-attr">enableConfigSubstitution</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">kubeconfigId</span>: <span class="hljs-string">&quot;$KUBECONFIG_CREDENTIAL_ID&quot;</span>)<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-comment">//1、配置全系统的邮件：                   全系统的监控</span><br>        <span class="hljs-comment">//2、修改ks-jenkins的配置，里面的邮件；   流水线发邮件</span><br>        <span class="hljs-title function_">stage</span>(<span class="hljs-params"><span class="hljs-string">&#x27;发送确认邮件&#x27;</span></span>) &#123;<br>            agent none<br>            steps &#123;<br>                <span class="hljs-title function_">mail</span>(<span class="hljs-attr">to</span>: <span class="hljs-string">&#x27;1023876294@qq.com&#x27;</span>, <span class="hljs-attr">subject</span>: <span class="hljs-string">&#x27;yygh-admin构建结果&#x27;</span>, <span class="hljs-attr">body</span>: <span class="hljs-string">&quot;构建成功了  $BUILD_NUMBER&quot;</span>)<br>            &#125;<br>        &#125;<br><br>    &#125;<br>    environment &#123;<br>        <span class="hljs-variable constant_">DOCKER_CREDENTIAL_ID</span> = <span class="hljs-string">&#x27;dockerhub-id&#x27;</span><br>        <span class="hljs-variable constant_">GITHUB_CREDENTIAL_ID</span> = <span class="hljs-string">&#x27;github-id&#x27;</span><br>        <span class="hljs-variable constant_">KUBECONFIG_CREDENTIAL_ID</span> = <span class="hljs-string">&#x27;demo-kubeconfig&#x27;</span><br>        <span class="hljs-variable constant_">REGISTRY</span> = <span class="hljs-string">&#x27;registry.cn-shenzhen.aliyuncs.com&#x27;</span><br>        <span class="hljs-variable constant_">DOCKERHUB_NAMESPACE</span> = <span class="hljs-string">&#x27;roudoukou-ruoyi&#x27;</span><br>        <span class="hljs-variable constant_">GITHUB_ACCOUNT</span> = <span class="hljs-string">&#x27;kubesphere&#x27;</span><br>        <span class="hljs-variable constant_">APP_NAME</span> = <span class="hljs-string">&#x27;devops-java-sample&#x27;</span><br>        <span class="hljs-variable constant_">ALIYUNHUB_NAMESPACE</span> = <span class="hljs-string">&#x27;roudoukou-ruoyi&#x27;</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>记得推送代码到仓库上<br><img src="/assets/9bf2903e6b1b4c47bd3c68430addb2f1.png"><br>然后访问这个端口, 此时已经说明了后台部署成功了<br><img src="/assets/ab334bafbcb24e34a15e71d40247025f.png"></p><h3 id="本地运行尚医通前台项目"><a href="#本地运行尚医通前台项目" class="headerlink" title="本地运行尚医通前台项目"></a>本地运行尚医通前台项目</h3><p>修改utils&#x2F;request.js成网关地址<br><img src="/assets/070e59d18ad049f1b1ede2e1ef94729f.png"></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs routeros">npm i<br><br>npm <span class="hljs-built_in">run</span> build<br><br>npm <span class="hljs-built_in">run</span> start<br><br></code></pre></td></tr></table></figure><p>然后浏览器访问<a href="http://127.0.0.1:3000/">http://127.0.0.1:3000/</a><br><img src="/assets/e0f7533ae6bc42868291fca836305647.png"></p><h3 id="上云部署尚医通前台项目"><a href="#上云部署尚医通前台项目" class="headerlink" title="上云部署尚医通前台项目"></a>上云部署尚医通前台项目</h3><p><img src="/assets/e56cb6d667424e43a53b362aaa6dbdd3.png"><br>webhook</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">139.198</span>.<span class="hljs-number">117.67</span>:<span class="hljs-number">30880</span><span class="hljs-regexp">/devops_webhook/gi</span>t<span class="hljs-regexp">/?url=https:/</span><span class="hljs-regexp">/gitee.com/</span>xialonggui/yygh-site.git<br></code></pre></td></tr></table></figure><h3 id="设置webhook"><a href="#设置webhook" class="headerlink" title="设置webhook"></a>设置webhook</h3><p><img src="/assets/b836f0f668424be4b0e2fff34d914d17.png"><br>当提交了代码之后, gitee就会通过webhook给流水线devops发送请求, 让流水线拉取代码运行<br><img src="/assets/89e220fe2a54404a8f6649af2db84cad.png"></p><h2 id="让master成为node节点工作-补充"><a href="#让master成为node节点工作-补充" class="headerlink" title="让master成为node节点工作(补充)"></a>让master成为node节点工作(补充)</h2><p><a href="https://www.hangge.com/blog/cache/detail_2431.html">https://www.hangge.com/blog/cache/detail_2431.html</a></p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">kubectl taint <span class="hljs-keyword">node</span> <span class="hljs-title">k8s-master</span> <span class="hljs-keyword">node</span><span class="hljs-title">-role</span>.kubernetes.io/<span class="hljs-literal">master</span>-<br></code></pre></td></tr></table></figure><h2 id="卸载kubernetes"><a href="#卸载kubernetes" class="headerlink" title="卸载kubernetes"></a>卸载kubernetes</h2><p><a href="https://www.cnblogs.com/wangzy-Zj/p/13273351.html">https://www.cnblogs.com/wangzy-Zj/p/13273351.html</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubeadm reset -f<br>modprobe -r ipip<br>lsmod<br><span class="hljs-built_in">rm</span> -rf ~/.kube/<br><span class="hljs-built_in">rm</span> -rf /etc/kubernetes/<br><span class="hljs-built_in">rm</span> -rf /etc/systemd/system/kubelet.service.d<br><span class="hljs-built_in">rm</span> -rf /etc/systemd/system/kubelet.service<br><span class="hljs-built_in">rm</span> -rf /usr/bin/kube*<br><span class="hljs-built_in">rm</span> -rf /etc/cni<br><span class="hljs-built_in">rm</span> -rf /opt/cni<br><span class="hljs-built_in">rm</span> -rf /var/lib/etcd<br><span class="hljs-built_in">rm</span> -rf /var/etcd<br>yum clean all<br>yum remove kube*<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>云原生实战</category>
      
    </categories>
    
    
    <tags>
      
      <tag>云原生</tag>
      
      <tag>kubenetes</tag>
      
      <tag>kubesphere</tag>
      
      <tag>Docker</tag>
      
      <tag>Jenkins</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringCloud</title>
    <link href="/Java/SpringCloud/"/>
    <url>/Java/SpringCloud/</url>
    
    <content type="html"><![CDATA[<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>SpringCloud&#x3D;分布式微服务架构的一站式解决方案, 是多种微服务架构落地技术的集合体, 俗称微服务全家桶</p><h2 id="版本选型"><a href="#版本选型" class="headerlink" title="版本选型"></a>版本选型</h2><p><a href="https://start.spring.io/actuator/info">https://start.spring.io/actuator/info</a></p><p>通过这个网站就可以查看到匹配的cloud版本</p><p><img src="/assets/ac772e76a0ba40b1b876be967043cfd2.png"></p><p>另外推荐跟视频中保持版本一致, </p><p><img src="/assets/867d889cef7b42a882a2c910776e7ff3.png"></p><p>cloud停更</p><p><img src="/assets/a5965e1969c340a2b14b63198cc4c6e0.png"></p><h2 id="dependencyManagement和dependencies"><a href="#dependencyManagement和dependencies" class="headerlink" title="dependencyManagement和dependencies"></a>dependencyManagement和dependencies</h2><p>dependencyManagement其实给父工程指定版本号, 让子工程无需指定自己的版本号, 父工程修改一处版本号, 子工程处处生效</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs jsx">&lt;!-- 子模块继承之后，提供作用：锁定版本+子modlue不用写groupId和version  --&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-comment">&lt;!--spring boot 2.2.2--&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2.2.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-comment">&lt;!--spring cloud Hoxton.SR1--&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>Hoxton.SR1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-comment">&lt;!--spring cloud alibaba 2.1.0.RELEASE--&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.0.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;mysql.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;druid.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;mybatis.spring.boot.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;junit.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>log4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>log4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;log4j.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;lombok.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span></span><br></code></pre></td></tr></table></figure><h2 id="新建模块的流程"><a href="#新建模块的流程" class="headerlink" title="新建模块的流程"></a>新建模块的流程</h2><ol><li>建module</li><li>改POM</li><li>写YML</li><li>主启动</li><li>业务类</li></ol><h2 id="RestTemplate"><a href="#RestTemplate" class="headerlink" title="RestTemplate"></a>RestTemplate</h2><p>使用RestTemplate访问restful接口非常的简单粗暴无脑(url, restMap, ResponseBean.class)这三个参数代表REST请求地址, 请求参数, HTTP响应转换成的对象类型</p><p>在config.ApplicationContextConfig 将RestTemplate 注入到spring容器中</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jsx">@<span class="hljs-title class_">Configuration</span><br>public <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApplicationContextConfig</span> &#123;<br>    @<span class="hljs-title class_">Bean</span><br>    public <span class="hljs-title class_">RestTemplate</span> <span class="hljs-title function_">getRestTemplate</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestTemplate</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>使用RestTemplate传递参数会自动将对象序列化成JSON对象</p><p>消费者</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><br>public <span class="hljs-keyword">static</span> final <span class="hljs-title class_">String</span> <span class="hljs-variable constant_">PAYMENT_URL</span> = <span class="hljs-string">&quot;http://localhost:8001&quot;</span>;<br><br>    @<span class="hljs-title class_">Resource</span><br>    private <span class="hljs-title class_">RestTemplate</span> restTemplate;<br><br>    @<span class="hljs-title class_">GetMapping</span>(<span class="hljs-string">&quot;/consumer/payment/create&quot;</span>)<br>    public <span class="hljs-title class_">CommonResult</span>&lt;<span class="hljs-title class_">Payment</span>&gt; <span class="hljs-title function_">create</span>(<span class="hljs-params">Payment payment</span>) &#123;<br>        <span class="hljs-keyword">return</span> restTemplate.<span class="hljs-title function_">postForObject</span>(<span class="hljs-variable constant_">PAYMENT_URL</span>+<span class="hljs-string">&quot;/payment/create&quot;</span>,payment, <span class="hljs-title class_">CommonResult</span>.<span class="hljs-property">class</span>);<br>    &#125;<br></code></pre></td></tr></table></figure><p>生产者</p><p>记得添加@RequestBody注解 </p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs jsx">@<span class="hljs-title class_">Resource</span><br>    private <span class="hljs-title class_">PaymentService</span> paymentService;<br><br>    @<span class="hljs-title class_">PostMapping</span>(<span class="hljs-string">&quot;/payment/create&quot;</span>)<br>    public <span class="hljs-title class_">CommonResult</span> <span class="hljs-title function_">create</span>(<span class="hljs-params">@RequestBody Payment payment</span>) &#123;<br>        int result = paymentService.<span class="hljs-title function_">create</span>(payment);<br>        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">&quot;插入结果 &#123;&#125;&quot;</span>, result);<br><br>        <span class="hljs-keyword">if</span> (result &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CommonResult</span>(<span class="hljs-number">200</span>, <span class="hljs-string">&quot;插入数据库成功&quot;</span>, result);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CommonResult</span>(<span class="hljs-number">444</span>, <span class="hljs-string">&quot;插入数据库失败&quot;</span>, <span class="hljs-literal">null</span>);<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><h2 id="开启services-run-dashboard"><a href="#开启services-run-dashboard" class="headerlink" title="开启services(run dashboard)"></a>开启services(<strong><strong>run dashboard</strong></strong>)</h2><p>在配置中随便拷贝一个boot工程就可以显示出来了</p><p><img src="/assets/8e8caf45f9fa42748e670b4a3507da3a.png"></p><p><img src="/assets/4ae789dcf52d49d7ae14ffb0bbfa916e.png"></p><p>另外一种方式通过配置.idea配置文件让其显示出来</p><p>参考:</p><ul><li><a href="https://blog.csdn.net/weixin_42641909/article/details/109361627">https://blog.csdn.net/weixin_42641909&#x2F;article&#x2F;details&#x2F;109361627</a></li></ul><h2 id="配置Eureka注册中心"><a href="#配置Eureka注册中心" class="headerlink" title="配置Eureka注册中心"></a>配置Eureka注册中心</h2><p>创建工程, 引入依赖</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs jsx">&lt;dependencies&gt;<br>        &lt;!--eureka-server--&gt;<br>        <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br>        &lt;!-- 引入自己定义的api通用包，可以使用<span class="hljs-title class_">Payment</span>支付<span class="hljs-title class_">Entity</span> --&gt;<br>        <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.atguigu.springcloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>cloud-api-commons<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;project.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br>        &lt;!--boot web actuator--&gt;<br>        <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br>        <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br>        &lt;!--一般通用配置--&gt;<br>        <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-devtools<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br>        <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br>        <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br>        <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br>    &lt;/dependencies&gt;<br></code></pre></td></tr></table></figure><p>配置application.yml</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-attr">server</span>:<br>  <span class="hljs-attr">port</span>: <span class="hljs-number">7001</span><br><br><span class="hljs-attr">eureka</span>:<br>  <span class="hljs-attr">instance</span>:<br>    <span class="hljs-attr">hostname</span>: localhost #eureka服务端的实例名称<br>  <span class="hljs-attr">client</span>:<br>    #<span class="hljs-literal">false</span>表示不向注册中心注册自己。<br>    register-<span class="hljs-keyword">with</span>-<span class="hljs-attr">eureka</span>: <span class="hljs-literal">false</span><br>    #<span class="hljs-literal">false</span>表示自己端就是注册中心，我的职责就是维护服务实例，并不需要去检索服务<br>    fetch-<span class="hljs-attr">registry</span>: <span class="hljs-literal">false</span><br>    service-<span class="hljs-attr">url</span>:<br>      #设置与<span class="hljs-title class_">Eureka</span> <span class="hljs-title class_">Server</span>交互的地址查询服务和注册服务都需要依赖这个地址。<br>      <span class="hljs-attr">defaultZone</span>: <span class="hljs-attr">http</span>:<span class="hljs-comment">//$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/</span><br></code></pre></td></tr></table></figure><p>编写入口Main</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jsx">@<span class="hljs-title class_">SpringBootApplication</span><br>@<span class="hljs-title class_">EnableEurekaServer</span><br>public <span class="hljs-keyword">class</span> <span class="hljs-title class_">EurekaMain7001</span> &#123;<br>    public <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) &#123;<br>        <span class="hljs-title class_">SpringApplication</span>.<span class="hljs-title function_">run</span>(<span class="hljs-title class_">EurekaMain7001</span>.<span class="hljs-property">class</span>, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>值得注意的是需要添加注解@EnableEurekaServer来标识这个是eureka的服务端</p><p>最后启动项目, 访问<a href="http://localhost:7001/">http://localhost:7001/</a></p><h2 id="引入服务的提供者到注册中心"><a href="#引入服务的提供者到注册中心" class="headerlink" title="引入服务的提供者到注册中心"></a>引入服务的提供者到注册中心</h2><p>在pom.xml中配置</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><br>&lt;dependency&gt;<br>            <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br>            <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br>        &lt;/dependency&gt;<br></code></pre></td></tr></table></figure><p>application.yml中配置eureka</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-attr">eureka</span>:<br>  <span class="hljs-attr">client</span>:<br>    #表示是否将自己注册进<span class="hljs-title class_">EurekaServer</span>默认为<span class="hljs-literal">true</span>。<br>    register-<span class="hljs-keyword">with</span>-<span class="hljs-attr">eureka</span>: <span class="hljs-literal">true</span><br>    #是否从<span class="hljs-title class_">EurekaServer</span>抓取已有的注册信息，默认为<span class="hljs-literal">true</span>。单节点无所谓，集群必须设置为<span class="hljs-literal">true</span>才能配合ribbon使用负载均衡<br>    <span class="hljs-attr">fetchRegistry</span>: <span class="hljs-literal">true</span><br>    service-<span class="hljs-attr">url</span>:<br>      <span class="hljs-attr">defaultZone</span>: <span class="hljs-attr">http</span>:<span class="hljs-comment">//localhost:7001/eureka</span><br></code></pre></td></tr></table></figure><p>最后标记注解@EnableEurekaClient</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jsx">@<span class="hljs-title class_">SpringBootApplication</span><br>@<span class="hljs-title class_">EnableEurekaClient</span><br>public <span class="hljs-keyword">class</span> <span class="hljs-title class_">PaymentMain8001</span> &#123;<br>    public <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) &#123;<br>        <span class="hljs-title class_">SpringApplication</span>.<span class="hljs-title function_">run</span>(<span class="hljs-title class_">PaymentMain8001</span>.<span class="hljs-property">class</span>, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>配置完成之后需要重启服务, 就能看见CLOUD-PAYMENT-SERVICE成功的注册到了eureka中</p><p><img src="/assets/09aa523cfab741feb3a2913727648971.png"></p><h2 id="配置eureka集群"><a href="#配置eureka集群" class="headerlink" title="配置eureka集群"></a>配置eureka集群</h2><p>引入依赖</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs jsx">&lt;dependencies&gt;<br>        &lt;!--eureka-server--&gt;<br>        <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br>        &lt;!-- 引入自己定义的api通用包，可以使用<span class="hljs-title class_">Payment</span>支付<span class="hljs-title class_">Entity</span> --&gt;<br>        <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.atguigu.springcloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>cloud-api-commons<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;project.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br>        &lt;!--boot web actuator--&gt;<br>        <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br>        <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br>        &lt;!--一般通用配置--&gt;<br>        <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-devtools<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br>        <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br>        <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br>        <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br>    &lt;/dependencies&gt;<br></code></pre></td></tr></table></figure><p>修改配置application.yml配置文件</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-attr">server</span>:<br>  <span class="hljs-attr">port</span>: <span class="hljs-number">7005</span><br><br><span class="hljs-attr">eureka</span>:<br>  <span class="hljs-attr">instance</span>:<br>    <span class="hljs-attr">hostname</span>: eureka7005.<span class="hljs-property">com</span> #eureka服务端的实例名称<br>  <span class="hljs-attr">client</span>:<br>    register-<span class="hljs-keyword">with</span>-<span class="hljs-attr">eureka</span>: <span class="hljs-literal">false</span>     #<span class="hljs-literal">false</span>表示不向注册中心注册自己。<br>    fetch-<span class="hljs-attr">registry</span>: <span class="hljs-literal">false</span>     #<span class="hljs-literal">false</span>表示自己端就是注册中心，我的职责就是维护服务实例，并不需要去检索服务<br>    service-<span class="hljs-attr">url</span>:<br>      <span class="hljs-attr">defaultZone</span>: <span class="hljs-attr">http</span>:<span class="hljs-comment">//eureka7001.com:7001/eureka/, http://eureka7002.com:7002/eureka/, http://eureka7003.com:7003/eureka/, http://eureka7004.com:7004/eureka/</span><br></code></pre></td></tr></table></figure><p>一般来说服务注册中心不会自己注册自己</p><p>但是多个服务注册中心需要互相注册</p><p>1 注册 2 3 4 5</p><p>2 注册 1 3 4 5</p><p>3 注册 1 2 4 5</p><p>4 注册 1 2 3 5</p><p>5 注册 1 2 3 4</p><p><strong>互相注册, 相互守望</strong></p><p>编写程序启动类, 记得需要添加@EnableEurekaServer这个注解</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs jsx">package com.<span class="hljs-property">atguigu</span>.<span class="hljs-property">springcloud</span>;<br><br><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">SpringApplication</span>;<br><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">autoconfigure</span>.<span class="hljs-property">SpringBootApplication</span>;<br><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">cloud</span>.<span class="hljs-property">netflix</span>.<span class="hljs-property">eureka</span>.<span class="hljs-property">server</span>.<span class="hljs-property">EnableEurekaServer</span>;<br><br>@<span class="hljs-title class_">SpringBootApplication</span><br>@<span class="hljs-title class_">EnableEurekaServer</span><br>public <span class="hljs-keyword">class</span> <span class="hljs-title class_">EurekaMain7005</span> &#123;<br>    public <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) &#123;<br>        <span class="hljs-title class_">SpringApplication</span>.<span class="hljs-title function_">run</span>(<span class="hljs-title class_">EurekaMain7005</span>.<span class="hljs-property">class</span>, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="将消费者注册到注册中心集群"><a href="#将消费者注册到注册中心集群" class="headerlink" title="将消费者注册到注册中心集群"></a>将消费者注册到注册中心集群</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-attr">eureka</span>:<br>  <span class="hljs-attr">client</span>:<br>    #表示是否将自己注册进<span class="hljs-title class_">EurekaServer</span>默认为<span class="hljs-literal">true</span>。<br>    register-<span class="hljs-keyword">with</span>-<span class="hljs-attr">eureka</span>: <span class="hljs-literal">true</span><br>    #是否从<span class="hljs-title class_">EurekaServer</span>抓取已有的注册信息，默认为<span class="hljs-literal">true</span>。单节点无所谓，集群必须设置为<span class="hljs-literal">true</span>才能配合ribbon使用负载均衡<br>    <span class="hljs-attr">fetchRegistry</span>: <span class="hljs-literal">true</span><br>    service-<span class="hljs-attr">url</span>:<br>      <span class="hljs-attr">defaultZone</span>: <span class="hljs-attr">http</span>:<span class="hljs-comment">//eureka7001.com:7001/eureka, http://eureka7002.com:7002/eureka, http://eureka7003.com:7003/eureka, http://eureka7004.com:7004/eureka, http://eureka7005.com:7005/eureka  # 集群版</span><br></code></pre></td></tr></table></figure><p>同样的提供者也是相同的方式注册到集群</p><h2 id="将提供者注册到注册中心集群"><a href="#将提供者注册到注册中心集群" class="headerlink" title="将提供者注册到注册中心集群"></a>将提供者注册到注册中心集群</h2><p>注意server.port不要跟其他的服务重名了</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-attr">server</span>:<br>  <span class="hljs-attr">port</span>: <span class="hljs-number">8002</span><br><br><span class="hljs-attr">spring</span>:<br>  <span class="hljs-attr">application</span>:<br>    <span class="hljs-attr">name</span>: cloud-payment-service<br>  <span class="hljs-attr">datasource</span>:<br>    <span class="hljs-attr">type</span>: com.<span class="hljs-property">alibaba</span>.<span class="hljs-property">druid</span>.<span class="hljs-property">pool</span>.<span class="hljs-property">DruidDataSource</span>            # 当前数据源操作类型<br>    driver-<span class="hljs-keyword">class</span>-<span class="hljs-attr">name</span>: com.<span class="hljs-property">mysql</span>.<span class="hljs-property">cj</span>.<span class="hljs-property">jdbc</span>.<span class="hljs-property">Driver</span>           # mysql驱动包<br>    <span class="hljs-attr">url</span>: <span class="hljs-attr">jdbc</span>:<span class="hljs-attr">mysql</span>:<span class="hljs-comment">//localhost:3306/db2019?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;setTimezone=UTC</span><br>    <span class="hljs-attr">username</span>: root<br>    <span class="hljs-attr">password</span>: <span class="hljs-number">123456</span><br><br><span class="hljs-attr">eureka</span>:<br>  <span class="hljs-attr">client</span>:<br>    #表示是否将自己注册进<span class="hljs-title class_">EurekaServer</span>默认为<span class="hljs-literal">true</span>。<br>    register-<span class="hljs-keyword">with</span>-<span class="hljs-attr">eureka</span>: <span class="hljs-literal">true</span><br>    #是否从<span class="hljs-title class_">EurekaServer</span>抓取已有的注册信息，默认为<span class="hljs-literal">true</span>。单节点无所谓，集群必须设置为<span class="hljs-literal">true</span>才能配合ribbon使用负载均衡<br>    <span class="hljs-attr">fetchRegistry</span>: <span class="hljs-literal">true</span><br>    service-<span class="hljs-attr">url</span>:<br>#      <span class="hljs-attr">defaultZone</span>: <span class="hljs-attr">http</span>:<span class="hljs-comment">//localhost:7001/eureka</span><br>      <span class="hljs-attr">defaultZone</span>: <span class="hljs-attr">http</span>:<span class="hljs-comment">//eureka7001.com:7001/eureka, http://eureka7002.com:7002/eureka, http://eureka7003.com:7003/eureka, http://eureka7004.com:7004/eureka, http://eureka7005.com:7005/eureka  # 集群版</span><br><br><span class="hljs-attr">mybatis</span>:<br>  <span class="hljs-attr">mapperLocations</span>: <span class="hljs-attr">classpath</span>:mapper<span class="hljs-comment">/*.xml</span><br><span class="hljs-comment">  type-aliases-package: com.atguigu.springcloud.entities    # 所有Entity别名类所在包</span><br></code></pre></td></tr></table></figure><p>消费者开启负载均衡@LoadBalanced</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs jsx">@<span class="hljs-title class_">Configuration</span><br>public <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApplicationContextConfig</span> &#123;<br>    @<span class="hljs-title class_">Bean</span><br>    @<span class="hljs-title class_">LoadBalanced</span><br>    public <span class="hljs-title class_">RestTemplate</span> <span class="hljs-title function_">getRestTemplate</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestTemplate</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>通过http:&#x2F;&#x2F;服务名</p><p>进行调用</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-comment">//    public static final String PAYMENT_URL = &quot;http://localhost:8001&quot;;</span><br>    public <span class="hljs-keyword">static</span> final <span class="hljs-title class_">String</span> <span class="hljs-variable constant_">PAYMENT_URL</span> = <span class="hljs-string">&quot;http://CLOUD-PAYMENT-SERVICE&quot;</span>;<br><br>    @<span class="hljs-title class_">Resource</span><br>    private <span class="hljs-title class_">RestTemplate</span> restTemplate;<br><br>    @<span class="hljs-title class_">GetMapping</span>(<span class="hljs-string">&quot;/consumer/payment/create&quot;</span>)<br>    public <span class="hljs-title class_">CommonResult</span>&lt;<span class="hljs-title class_">Payment</span>&gt; <span class="hljs-title function_">create</span>(<span class="hljs-params">Payment payment</span>) &#123;<br>        <span class="hljs-keyword">return</span> restTemplate.<span class="hljs-title function_">postForObject</span>(<span class="hljs-variable constant_">PAYMENT_URL</span>+<span class="hljs-string">&quot;/payment/create&quot;</span>,payment, <span class="hljs-title class_">CommonResult</span>.<span class="hljs-property">class</span>);<br>    &#125;<br><br>    @<span class="hljs-title class_">GetMapping</span>(<span class="hljs-string">&quot;/consumer/get/&#123;id&#125;&quot;</span>)<br>    public <span class="hljs-title class_">CommonResult</span> <span class="hljs-title function_">getPayment</span>(<span class="hljs-params">@PathVariable(<span class="hljs-string">&quot;id&quot;</span>) Long id</span>) &#123;<br>        <span class="hljs-keyword">return</span> restTemplate.<span class="hljs-title function_">getForObject</span>(<span class="hljs-variable constant_">PAYMENT_URL</span>+<span class="hljs-string">&quot;/payment/get/&quot;</span>+id, <span class="hljs-title class_">CommonResult</span>.<span class="hljs-property">class</span>);<br>    &#125;<br></code></pre></td></tr></table></figure><h2 id="actuator微服务信息完善"><a href="#actuator微服务信息完善" class="headerlink" title="actuator微服务信息完善"></a>actuator微服务信息完善</h2><p>在application.yml中</p><p>  instance:<br>    instance-id: payment8003<br>    prefer-ip-address: true     #访问路径可以显示IP地址</p><p>这段信息就能显示主机名, 并且点击之后就可以显示对应的IP地址</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-attr">eureka</span>:<br>  <span class="hljs-attr">client</span>:<br>    #表示是否将自己注册进<span class="hljs-title class_">EurekaServer</span>默认为<span class="hljs-literal">true</span>。<br>    register-<span class="hljs-keyword">with</span>-<span class="hljs-attr">eureka</span>: <span class="hljs-literal">true</span><br>    #是否从<span class="hljs-title class_">EurekaServer</span>抓取已有的注册信息，默认为<span class="hljs-literal">true</span>。单节点无所谓，集群必须设置为<span class="hljs-literal">true</span>才能配合ribbon使用负载均衡<br>    <span class="hljs-attr">fetchRegistry</span>: <span class="hljs-literal">true</span><br>    service-<span class="hljs-attr">url</span>:<br>#      <span class="hljs-attr">defaultZone</span>: <span class="hljs-attr">http</span>:<span class="hljs-comment">//localhost:7001/eureka</span><br>      <span class="hljs-attr">defaultZone</span>: <span class="hljs-attr">http</span>:<span class="hljs-comment">//eureka7001.com:7001/eureka, http://eureka7002.com:7002/eureka, http://eureka7003.com:7003/eureka, http://eureka7004.com:7004/eureka, http://eureka7005.com:7005/eureka  # 集群版</span><br>  <span class="hljs-attr">instance</span>:<br>    instance-<span class="hljs-attr">id</span>: payment8003<br>    prefer-ip-<span class="hljs-attr">address</span>: <span class="hljs-literal">true</span>     #访问路径可以显示<span class="hljs-variable constant_">IP</span>地址<br></code></pre></td></tr></table></figure><p><img src="/assets/74435800971a42caaffdf6fff36163cb.png"></p><h2 id="配置服务发现Discovery"><a href="#配置服务发现Discovery" class="headerlink" title="配置服务发现Discovery"></a>配置服务发现Discovery</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Resource</span><br><span class="hljs-keyword">private</span> DiscoveryClient discoveryClient;<br><br><span class="hljs-meta">@GetMapping(&quot;/payment/discovery&quot;)</span><br><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">discovery</span><span class="hljs-params">()</span> &#123;<br>    List&lt;String&gt; services = discoveryClient.getServices();<br>    <span class="hljs-keyword">for</span> (String service : services) &#123;<br>        log.info(<span class="hljs-string">&quot;service: &#123;&#125;&quot;</span>, service);<br>    &#125;<br><br>    List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances(<span class="hljs-string">&quot;CLOUD-PAYMENT-SERVICE&quot;</span>);<br>    <span class="hljs-keyword">for</span> (ServiceInstance instance : instances) &#123;<br>        log.info(<span class="hljs-string">&quot;instance: &quot;</span> + instance.getServiceId() + <span class="hljs-string">&quot;\t&quot;</span> + instance.getHost() + <span class="hljs-string">&quot;\t&quot;</span> + instance.getPort() + <span class="hljs-string">&quot;\t&quot;</span> + instance.getUri());<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.discoveryClient;<br>&#125;<br></code></pre></td></tr></table></figure><p>接着在入口函数添加注解<code>@EnableDiscoveryClient</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableEurekaClient</span><br><span class="hljs-meta">@EnableDiscoveryClient</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PaymentMain8001</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(PaymentMain8001.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>测试结果</p><p><img src="/assets/76ad85017f7e4524b9ef87961f6a4091.png"></p><h2 id="Eureka自我保护"><a href="#Eureka自我保护" class="headerlink" title="Eureka自我保护"></a>Eureka自我保护</h2><p><img src="/assets/f555ce2ebee849c3860c5ea68195e522.png"></p><p>当出现这个段英文时, <strong><strong>EMERGENCY! EUREKA MAY BE INCORRECTLY CLAIMING INSTANCES ARE UP WHEN THEY’RE NOT. RENEWALS ARE LESSER THAN THRESHOLD AND HENCE THE INSTANCES ARE NOT BEING EXPIRED JUST TO BE SAFE.</strong></strong></p><p>就说明eureka进入了自我保护</p><p>可能是因为网络状态正常接收某个微服务的心跳 </p><p>在某时刻某一个微服务不可用了, Eureka不会立刻清理, 依旧会对该微服务的信息进行保存</p><h2 id="关闭自我保护"><a href="#关闭自我保护" class="headerlink" title="关闭自我保护"></a>关闭自我保护</h2><p>配置了1秒发送心跳, 超过2秒没有收到心跳就剔除这个微服务</p><p><strong><strong>THE SELF PRESERVATION MODE IS TURNED OFF. THIS MAY NOT PROTECT INSTANCE EXPIRY IN CASE OF NETWORK&#x2F;OTHER PROBLEMS.</strong></strong></p><p><img src="/assets/4ba024922d584d6194a6376d9e73ed0d.png"></p><p>提供者</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java">eureka:<br>  client:<br>    #表示是否将自己注册进EurekaServer默认为<span class="hljs-literal">true</span>。<br>    register-with-eureka: <span class="hljs-literal">true</span><br>    #是否从EurekaServer抓取已有的注册信息，默认为<span class="hljs-literal">true</span>。单节点无所谓，集群必须设置为<span class="hljs-literal">true</span>才能配合ribbon使用负载均衡<br>    fetchRegistry: <span class="hljs-literal">true</span><br>    service-url:<br>#      defaultZone: http:<span class="hljs-comment">//localhost:7001/eureka</span><br>      defaultZone: http:<span class="hljs-comment">//eureka7001.com:7001/eureka, http://eureka7002.com:7002/eureka, http://eureka7003.com:7003/eureka, http://eureka7004.com:7004/eureka, http://eureka7005.com:7005/eureka  # 集群版</span><br>  instance:<br>    instance-id: payment8001<br>    prefer-ip-address: <span class="hljs-literal">true</span>     #访问路径可以显示IP地址<br>    #心跳检测与续约时间<br>    #开发时设置小些，保证服务关闭后注册中心能即使剔除服务<br>    #Eureka客户端向服务端发送心跳的时间间隔，单位为秒(默认是<span class="hljs-number">30</span>秒)<br>    lease-renewal-interval-in-seconds: <span class="hljs-number">1</span><br>    #Eureka服务端在收到最后一次心跳后等待时间上限，单位为秒(默认是<span class="hljs-number">90</span>秒)，超时将剔除服务<br>    lease-expiration-duration-in-seconds: <span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p>注册中心</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java">eureka:<br>  instance:<br>    hostname: eureka7001.com #eureka服务端的实例名称<br>  client:<br>    #<span class="hljs-literal">false</span>表示不向注册中心注册自己。<br>    register-with-eureka: <span class="hljs-literal">false</span><br>    #<span class="hljs-literal">false</span>表示自己端就是注册中心，我的职责就是维护服务实例，并不需要去检索服务<br>    fetch-registry: <span class="hljs-literal">false</span><br>    service-url:<br>      #设置与Eureka Server交互的地址查询服务和注册服务都需要依赖这个地址。<br>      defaultZone: http:<span class="hljs-comment">//eureka7002.com:7002/eureka/, http://eureka7003.com:7003/eureka/, http://eureka7004.com:7004/eureka/, http://eureka7005.com:7005/eureka/</span><br>  server:<br>    #关闭自我保护机制，保证不可用服务被及时踢除<br>    enable-self-preservation: <span class="hljs-literal">false</span><br>    eviction-interval-timer-in-ms: <span class="hljs-number">2000</span><br></code></pre></td></tr></table></figure><h2 id="替换成zookeeper为注册中心"><a href="#替换成zookeeper为注册中心" class="headerlink" title="替换成zookeeper为注册中心"></a>替换成zookeeper为注册中心</h2><p>在centos7中启动zookeeper集群</p><p><img src="/assets/b58195e7b2254817a346d3d1166b54eb.png"></p><p>创建一个新的微服务模块</p><p>中间排除了zookeeper的某个版本, 其实也可以不用, 因为我排不排除都能正常运行</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependencies&gt;<br>        &lt;!-- SpringBoot整合Web组件 --&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;&lt;!-- 引入自己定义的api通用包，可以使用Payment支付Entity --&gt;<br>            &lt;groupId&gt;com.atguigu.springcloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt;<br>            &lt;version&gt;$&#123;project.version&#125;&lt;/version&gt;<br>        &lt;/dependency&gt;<br>        &lt;!-- SpringBoot整合zookeeper客户端 --&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-cloud-starter-zookeeper-discovery&lt;/artifactId&gt;<br>            &lt;!--先排除自带的zookeeper3<span class="hljs-number">.5</span><span class="hljs-number">.3</span>--&gt;<br>            &lt;exclusions&gt;<br>                &lt;exclusion&gt;<br>                    &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt;<br>                    &lt;artifactId&gt;zookeeper&lt;/artifactId&gt;<br>                &lt;/exclusion&gt;<br>            &lt;/exclusions&gt;<br>        &lt;/dependency&gt;<br>        &lt;!--添加zookeeper3<span class="hljs-number">.5</span><span class="hljs-number">.7</span>版本--&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt;<br>            &lt;artifactId&gt;zookeeper&lt;/artifactId&gt;<br>            &lt;version&gt;<span class="hljs-number">3.5</span><span class="hljs-number">.7</span>&lt;/version&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;<br>            &lt;scope&gt;runtime&lt;/scope&gt;<br>            &lt;optional&gt;<span class="hljs-literal">true</span>&lt;/optional&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;<br>            &lt;artifactId&gt;lombok&lt;/artifactId&gt;<br>            &lt;optional&gt;<span class="hljs-literal">true</span>&lt;/optional&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;<br>            &lt;scope&gt;test&lt;/scope&gt;<br>        &lt;/dependency&gt;<br>    &lt;/dependencies&gt;<br></code></pre></td></tr></table></figure><p>配置application.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment">#8004表示注册到zookeeper服务器的支付服务提供者端口号</span><br><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8004</span><br><br><span class="hljs-comment">#服务别名----注册zookeeper到注册中心名称</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">cloud-provider-payment8004</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">zookeeper:</span><br>      <span class="hljs-attr">connect-string:</span> <span class="hljs-string">hadoop202:2181,hadoop203:2181,hadoop204:2181</span><br><br></code></pre></td></tr></table></figure><p>编写入口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@EnableDiscoveryClient</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PaymentController</span> &#123;<br>    <span class="hljs-meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String serverPort;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/payment/zk&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">paymentzk</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;springcloud with zookeeper: &quot;</span>+serverPort+<span class="hljs-string">&quot;\t&quot;</span>+ UUID.randomUUID().toString();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>测试代码</p><p><img src="/assets/7cf8c7dbbe724762baa40674fc487b07.png"></p><p>成功配置好了zookeeper注册中心</p><p><img src="/assets/06bb006edecb49bfbab1e9fc84a89c4c.png"></p><h2 id="zookeeper服务节点"><a href="#zookeeper服务节点" class="headerlink" title="zookeeper服务节点"></a>zookeeper服务节点</h2><p>zookeeper服务节点是临时节点</p><p>当把cloud-provider-payment8004关闭之后, zookeeper就会将cloud-provider-payment8004这个节点给删除, 当cloud-provider-payment8004重新启动之后, zookeeper就会再次把cloud-provider-payment8004注册上</p><p><img src="/assets/706591d5cd1f497ebf660aff33be8ec3.png"></p><p>编写相对应的消费者</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependencies&gt;<br>        &lt;!-- SpringBoot整合Web组件 --&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;&lt;!-- 引入自己定义的api通用包，可以使用Payment支付Entity --&gt;<br>            &lt;groupId&gt;com.atguigu.springcloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt;<br>            &lt;version&gt;$&#123;project.version&#125;&lt;/version&gt;<br>        &lt;/dependency&gt;<br>        &lt;!-- SpringBoot整合zookeeper客户端 --&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-cloud-starter-zookeeper-discovery&lt;/artifactId&gt;<br>            &lt;!--先排除自带的zookeeper3<span class="hljs-number">.5</span><span class="hljs-number">.3</span>--&gt;<br>            &lt;exclusions&gt;<br>                &lt;exclusion&gt;<br>                    &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt;<br>                    &lt;artifactId&gt;zookeeper&lt;/artifactId&gt;<br>                &lt;/exclusion&gt;<br>            &lt;/exclusions&gt;<br>        &lt;/dependency&gt;<br>        &lt;!--添加zookeeper3<span class="hljs-number">.4</span><span class="hljs-number">.9</span>版本--&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt;<br>            &lt;artifactId&gt;zookeeper&lt;/artifactId&gt;<br>            &lt;version&gt;<span class="hljs-number">3.5</span><span class="hljs-number">.7</span>&lt;/version&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;<br>            &lt;scope&gt;runtime&lt;/scope&gt;<br>            &lt;optional&gt;<span class="hljs-literal">true</span>&lt;/optional&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;<br>            &lt;artifactId&gt;lombok&lt;/artifactId&gt;<br>            &lt;optional&gt;<span class="hljs-literal">true</span>&lt;/optional&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;<br>            &lt;scope&gt;test&lt;/scope&gt;<br>        &lt;/dependency&gt;<br>    &lt;/dependencies&gt;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApplicationContextBean</span> &#123;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@LoadBalanced</span><br>    <span class="hljs-keyword">public</span> RestTemplate <span class="hljs-title function_">getRestTemplate</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestTemplate</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderZKController</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">INVOKE_URL</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;http://cloud-provider-payment8004&quot;</span>;<br><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> RestTemplate restTemplate;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/consumer/payment/zk&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getPaymentInfo</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> restTemplate.getForObject(INVOKE_URL + <span class="hljs-string">&quot;/payment/zk&quot;</span>, String.class);<br>        log.info(<span class="hljs-string">&quot;消费者调用支付服务(zookeeper) =&gt; result: &#123;&#125;&quot;</span>, result);<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableDiscoveryClient</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderZK80</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(OrderZK80.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java">#<span class="hljs-number">8004</span>表示注册到zookeeper服务器的支付服务提供者端口号<br>server:<br>  port: <span class="hljs-number">80</span><br><br>#服务别名----注册zookeeper到注册中心名称<br>spring:<br>  application:<br>    name: cloud-consumer-order<br>  cloud:<br>    zookeeper:<br>      connect-string: hadoop202:<span class="hljs-number">2181</span>,hadoop203:<span class="hljs-number">2181</span>,hadoop204:<span class="hljs-number">2181</span><br></code></pre></td></tr></table></figure><p>代码测试</p><p><img src="/assets/072f68239dcd42afb937f336fb6a5a9c.png"></p><p>启动了一个提供者和消费者</p><p>都能正常请求</p><p><img src="/assets/8799ca55272442c19a3095e51af0ccb3.png"></p><p><img src="/assets/b3b748dc90d44ff79f8c80a5c520d941.png"></p><h2 id="Consul"><a href="#Consul" class="headerlink" title="Consul"></a>Consul</h2><p>下载地址</p><p><a href="https://developer.hashicorp.com/consul/downloads?ajs_aid=cc9039da-f9af-4a8f-86e9-a9e6e2942e03&product_intent=consul">https://developer.hashicorp.com/consul/downloads?ajs_aid&#x3D;cc9039da-f9af-4a8f-86e9-a9e6e2942e03&amp;product_intent&#x3D;consul</a></p><p>查看consul版本</p><p><img src="/assets/ab240bcd64fd40e69927b41fa452fdb5.png"></p><p>输入<code>./consul agent -dev</code> 启动开发模式</p><p><img src="/assets/306f1f033fb54e82a1e8bb7b8fb89436.png"></p><p>启动完之后可以访问<a href="http://localhost:8500/">http://localhost:8500/</a></p><p><img src="/assets/49ffe4aad6b44fdaa67bcde7934d0489.png"></p><h2 id="配置Consul提供者"><a href="#配置Consul提供者" class="headerlink" title="配置Consul提供者"></a>配置Consul提供者</h2><p>pom.xml</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependencies&gt;<br><br>        &lt;!--SpringCloud consul-server --&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;!-- SpringBoot整合Web组件 --&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br><br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;!--日常通用jar包配置--&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;<br>            &lt;scope&gt;runtime&lt;/scope&gt;<br>            &lt;optional&gt;<span class="hljs-literal">true</span>&lt;/optional&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;<br>            &lt;artifactId&gt;lombok&lt;/artifactId&gt;<br>            &lt;optional&gt;<span class="hljs-literal">true</span>&lt;/optional&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;<br>            &lt;scope&gt;test&lt;/scope&gt;<br>        &lt;/dependency&gt;<br>    &lt;/dependencies&gt;<br></code></pre></td></tr></table></figure><p>application.yml</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java">###consul服务端口号<br>server:<br>  port: <span class="hljs-number">8006</span><br><br>spring:<br>  application:<br>    name: consul-provider-payment<br>  ####consul注册中心地址<br>  cloud:<br>    consul:<br>      host: localhost<br>      port: <span class="hljs-number">8500</span><br>      discovery:<br>        #hostname: <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><br>        service-name: $&#123;spring.application.name&#125;<br></code></pre></td></tr></table></figure><p>Controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PaymentController</span> &#123;<br>    <span class="hljs-meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String serverPort;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/payment/consul&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">paymentzk</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;springcloud with consul: &quot;</span>+serverPort+<span class="hljs-string">&quot;\t&quot;</span>+ UUID.randomUUID().toString();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>代码测试</p><p><img src="/assets/e0bb99b041624013845ee7733e283caf.png"></p><h2 id="配置Consul消费者"><a href="#配置Consul消费者" class="headerlink" title="配置Consul消费者"></a>配置Consul消费者</h2><p>pom.xml</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependencies&gt;<br><br>        &lt;!--SpringCloud consul-server --&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;!-- SpringBoot整合Web组件 --&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br><br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;!--日常通用jar包配置--&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;<br>            &lt;scope&gt;runtime&lt;/scope&gt;<br>            &lt;optional&gt;<span class="hljs-literal">true</span>&lt;/optional&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;<br>            &lt;artifactId&gt;lombok&lt;/artifactId&gt;<br>            &lt;optional&gt;<span class="hljs-literal">true</span>&lt;/optional&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;<br>            &lt;scope&gt;test&lt;/scope&gt;<br>        &lt;/dependency&gt;<br>    &lt;/dependencies&gt;<br></code></pre></td></tr></table></figure><p>application.yml</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java">###consul服务端口号<br>server:<br>  port: <span class="hljs-number">80</span><br><br>spring:<br>  application:<br>    name: cloud-consumer-order<br>  ####consul注册中心地址<br>  cloud:<br>    consul:<br>      host: localhost<br>      port: <span class="hljs-number">8500</span><br>      discovery:<br>        #hostname: <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><br>        service-name: $&#123;spring.application.name&#125;<br></code></pre></td></tr></table></figure><p>config&#x2F;ApplicationConfig </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.springcloud.config;<br><br><span class="hljs-keyword">import</span> org.springframework.cloud.client.loadbalancer.LoadBalanced;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><span class="hljs-keyword">import</span> org.springframework.web.client.RestTemplate;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApplicationConfig</span> &#123;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@LoadBalanced</span><br>    <span class="hljs-keyword">public</span> RestTemplate <span class="hljs-title function_">getRestTemplate</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestTemplate</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderConsulController</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">INVOKE_URL</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;http://consul-provider-payment&quot;</span>; <span class="hljs-comment">//consul-provider-payment</span><br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RestTemplate restTemplate;<br><br>    <span class="hljs-meta">@GetMapping(value = &quot;/consumer/payment/consul&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">paymentInfo</span><span class="hljs-params">()</span><br>    &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> restTemplate.getForObject(INVOKE_URL+<span class="hljs-string">&quot;/payment/consul&quot;</span>, String.class);<br>        System.out.println(<span class="hljs-string">&quot;消费者调用支付服务(consule)---&gt;result:&quot;</span> + result);<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>代码测试</p><p><img src="/assets/33dd8e91550d4e4daf6043b7b49db73c.png"></p><p><img src="/assets/8daf9ada7c4c4e93a2e04e8e721fbcc7.png"></p><h2 id="三个注册中心异同点"><a href="#三个注册中心异同点" class="headerlink" title="三个注册中心异同点"></a>三个注册中心异同点</h2><p><img src="/assets/656b9dc54b8744738e456aedf226f3cc.png"></p><p>CAP</p><p>C: Consistency(强一致性)</p><p>A: Availablility (可用性)</p><p>P: Partition tolerance(分区容错性)</p><p>CAP理论关注粒度是数据, 而不是整体系统设计的策略</p><p><img src="/assets/e926072cc5cf4e7ab60af470a5e2103b.png"></p><p>AP(Eureka)</p><p><img src="/assets/1a0d43769745465fab9864421ddd6b02.png"></p><p>CP(Zookeeper&#x2F;Consul)</p><p><img src="/assets/ef99a46feca9471085f1f5ce3d3c5552.png"></p><h2 id="Ribbon负载均衡"><a href="#Ribbon负载均衡" class="headerlink" title="Ribbon负载均衡"></a>Ribbon负载均衡</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br></code></pre></td></tr></table></figure><p><img src="/assets/d9ecfe6692bb405bb47899fb0d1f86c0.png"></p><p>当引入了eureka的依赖之后会自动的添加上ribbon的依赖, 所以自己手动加不加依赖都可以</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependency&gt;<br>    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br>    &lt;artifactId&gt;spring-cloud-starter-netflix-ribbon&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure><p>getForObject返回对象为响应体中数据转化成的对象，基本上可以理解为Json</p><p>getForEntity返回对象为ResponseEntity对象，包含了响应中的一些重要信息，比如响应头、响应状态码、响应体等</p><p>配置ribbon, 其实就是跟之前一样, 只用添加好@LoadBalanced注解, Controller就可以直接调用</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApplicationContextConfig</span> &#123;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@LoadBalanced</span><br>    <span class="hljs-keyword">public</span> RestTemplate <span class="hljs-title function_">getRestTemplate</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestTemplate</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderController</span> &#123;<br><br><span class="hljs-comment">//    public static final String PAYMENT_URL = &quot;http://localhost:8001&quot;;</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">PAYMENT_URL</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;http://CLOUD-PAYMENT-SERVICE&quot;</span>;<br><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> RestTemplate restTemplate;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/consumer/payment/create&quot;)</span><br>    <span class="hljs-keyword">public</span> CommonResult&lt;Payment&gt; <span class="hljs-title function_">create</span><span class="hljs-params">(Payment payment)</span> &#123;<br>        <span class="hljs-keyword">return</span> restTemplate.postForObject(PAYMENT_URL+<span class="hljs-string">&quot;/payment/create&quot;</span>,payment, CommonResult.class);<br>    &#125;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/consumer/get/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> CommonResult <span class="hljs-title function_">getPayment</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;<br>        <span class="hljs-keyword">return</span> restTemplate.getForObject(PAYMENT_URL+<span class="hljs-string">&quot;/payment/get/&quot;</span>+id, CommonResult.class);<br>    &#125;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/consumer/payment/getForEntity/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> CommonResult&lt;Payment&gt; <span class="hljs-title function_">getPayment2</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;<br>        ResponseEntity&lt;CommonResult&gt; entity = restTemplate.getForEntity(PAYMENT_URL + <span class="hljs-string">&quot;/payment/get/&quot;</span> + id, CommonResult.class);<br>        <span class="hljs-keyword">if</span> (entity.getStatusCode().is2xxSuccessful()) &#123;<br>            log.info(<span class="hljs-string">&quot;Headers: &#123;&#125;, status: &#123;&#125;&quot;</span>, entity.getHeaders(), entity.getStatusCode());<br>            <span class="hljs-keyword">return</span> entity.getBody();<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CommonResult</span>&lt;&gt;(<span class="hljs-number">444</span>, <span class="hljs-string">&quot;操作失败&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>一些特定的算法</p><p><img src="/assets/b89e02aa964e44b2825deec4fa349523.png"></p><h2 id="配置随机的规则"><a href="#配置随机的规则" class="headerlink" title="配置随机的规则"></a>配置随机的规则</h2><p>新建package, 注意不要建在Application的当前包及其子包下了</p><p><img src="/assets/0fe9a08b20f64e6f9d1f8570c8433eb2.png"></p><p>编写如下配置</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MySelfRule</span> &#123;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> IRule <span class="hljs-title function_">myRule</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RandomRule</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>启动类中添加注解@RibbonClient</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableEurekaClient</span><br><span class="hljs-meta">@RibbonClient(name=&quot;CLOUD-PAYMENT-SERVICE&quot;, configuration = MySelfRule.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderApplication</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(OrderApplication.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>配置完成之后规则就变成了随机的了</p><h2 id="负载均衡算法原理"><a href="#负载均衡算法原理" class="headerlink" title="负载均衡算法原理"></a>负载均衡算法原理</h2><p>负载均衡算法：rest接口第几次请求数 % 服务器集群总数量 &#x3D; 实际调用服务器位置下标  ，每次服务重启动后rest接口计数从1开始。</p><p>List<ServiceInstance> instances &#x3D; discoveryClient.getInstances(“CLOUD-PAYMENT-SERVICE”);</p><p>如：   List [0] instances &#x3D; 127.0.0.1:8002</p><p>List [1] instances &#x3D; 127.0.0.1:8001</p><p>8001+ 8002 组合成为集群，它们共计2台机器，集群总数为2， 按照轮询算法原理：</p><p>当总请求数为1时： 1 % 2 &#x3D;1 对应下标位置为1 ，则获得服务地址为127.0.0.1:8001</p><p>当总请求数位2时： 2 % 2 &#x3D;0 对应下标位置为0 ，则获得服务地址为127.0.0.1:8002</p><p>当总请求数位3时： 3 % 2 &#x3D;1 对应下标位置为1 ，则获得服务地址为127.0.0.1:8001</p><p>当总请求数位4时： 4 % 2 &#x3D;0 对应下标位置为0 ，则获得服务地址为127.0.0.1:8002</p><p>如此类推……</p><h2 id="使用OpenFeign"><a href="#使用OpenFeign" class="headerlink" title="使用OpenFeign"></a>使用OpenFeign</h2><p>pom.xml</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependencies&gt;<br>        &lt;!--openfeign--&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;!--eureka client--&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;!-- 引入自己定义的api通用包，可以使用Payment支付Entity --&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;com.atguigu.springcloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt;<br>            &lt;version&gt;$&#123;project.version&#125;&lt;/version&gt;<br>        &lt;/dependency&gt;<br>        &lt;!--web--&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;!--一般基础通用配置--&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;<br>            &lt;scope&gt;runtime&lt;/scope&gt;<br>            &lt;optional&gt;<span class="hljs-literal">true</span>&lt;/optional&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;<br>            &lt;artifactId&gt;lombok&lt;/artifactId&gt;<br>            &lt;optional&gt;<span class="hljs-literal">true</span>&lt;/optional&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;<br>            &lt;scope&gt;test&lt;/scope&gt;<br>        &lt;/dependency&gt;<br>    &lt;/dependencies&gt;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">server:<br>  port: <span class="hljs-number">80</span><br><br>eureka:<br>  client:<br>    register-with-eureka: <span class="hljs-literal">false</span><br>    service-url:<br>      defaultZone: http:<span class="hljs-comment">//eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/</span><br></code></pre></td></tr></table></figure><p>编写一个接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@FeignClient(&quot;CLOUD-PAYMENT-SERVICE&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">PaymentFeignService</span> &#123;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/payment/get/&#123;id&#125;&quot;)</span><br>    CommonResult <span class="hljs-title function_">getPayment</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>编写Controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderFeignController</span> &#123;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> PaymentFeignService paymentFeignService;<br><br>    <span class="hljs-meta">@GetMapping(value = &quot;/consumer/payment/get/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> CommonResult&lt;Payment&gt; <span class="hljs-title function_">getPaymentById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;<br>        <span class="hljs-keyword">return</span> paymentFeignService.getPayment(id);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>代码测试</p><p><img src="/assets/d71495fb90b5476fb8d7ee6dff1f6b2c.png"></p><h2 id="修改超时时间"><a href="#修改超时时间" class="headerlink" title="修改超时时间"></a>修改超时时间</h2><p>编写提供者的超时方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/payment/feign/timeout&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">paymentFeignTimeout</span><span class="hljs-params">()</span> &#123;<br>        log.info(<span class="hljs-string">&quot;serverPort: &#123;&#125;&quot;</span>, serverPort);<br>        <span class="hljs-keyword">try</span> &#123;<br>            Thread.sleep(<span class="hljs-number">3000</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> serverPort;<br>    &#125;<br></code></pre></td></tr></table></figure><p>消费者添加超时方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@FeignClient(&quot;CLOUD-PAYMENT-SERVICE&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">PaymentFeignService</span> &#123;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/payment/get/&#123;id&#125;&quot;)</span><br>    CommonResult <span class="hljs-title function_">getPayment</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/payment/feign/timeout&quot;)</span><br>    String <span class="hljs-title function_">paymentFeignTimeout</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/consumer/payment/feign/timeout&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">paymentFeignTimeout</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> paymentFeignService.paymentFeignTimeout();<br>    &#125;<br></code></pre></td></tr></table></figure><p>这样测试会造成OpenFeign的超时, 默认超时时长是1秒</p><p><img src="/assets/50e366fb0f474385a1f1f2cff00ec73d.png"></p><p>在application.yml中配置</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java">server:<br>  port: <span class="hljs-number">80</span><br><br>eureka:<br>  client:<br>    register-with-eureka: <span class="hljs-literal">false</span><br>    service-url:<br>      defaultZone: http:<span class="hljs-comment">//eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/</span><br><br>#设置feign客户端超时时间(OpenFeign默认支持ribbon)<br>ribbon:<br>  #指的是建立连接所用的时间，适用于网络状况正常的情况下,两端连接所用的时间<br>  ReadTimeout: <span class="hljs-number">5000</span><br>  #指的是建立连接后从服务器读取到可用资源所用的时间<br>  ConnectTimeout: <span class="hljs-number">5000</span><br></code></pre></td></tr></table></figure><p>这样就可以增大超时的时长了</p><h2 id="OpenFeign开启日志"><a href="#OpenFeign开启日志" class="headerlink" title="OpenFeign开启日志"></a>OpenFeign开启日志</h2><p>添加config[配置</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.springcloud.config;<br><br><span class="hljs-keyword">import</span> feign.Logger;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FeignConfig</span><br>&#123;<br>    <span class="hljs-meta">@Bean</span><br>    Logger.Level <span class="hljs-title function_">feignLoggerLevel</span><span class="hljs-params">()</span><br>    &#123;<br>        <span class="hljs-keyword">return</span> Logger.Level.FULL;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>然后再application.yml中进行配置</p><p>注意这个路径应该是OpenFeign的接口的路径</p><p>  com.atguigu.springcloud.services.PaymentFeignService: debug</p><p><img src="/assets/d997d39be232474f9fc1abc377908398.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">logging:<br>  level:<br>    # feign日志以什么级别监控哪个接口<br>    com.atguigu.springcloud.services.PaymentFeignService: debug<br></code></pre></td></tr></table></figure><p><img src="/assets/cee96df418964f378895205d1087ea89.png"></p><h2 id="搭建Hystrix模块"><a href="#搭建Hystrix模块" class="headerlink" title="搭建Hystrix模块"></a>搭建Hystrix模块</h2><p>pom</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependencies&gt;<br>        &lt;!--hystrix--&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;!--eureka client--&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;!--web--&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;&lt;!-- 引入自己定义的api通用包，可以使用Payment支付Entity --&gt;<br>            &lt;groupId&gt;com.atguigu.springcloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt;<br>            &lt;version&gt;$&#123;project.version&#125;&lt;/version&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;<br>            &lt;scope&gt;runtime&lt;/scope&gt;<br>            &lt;optional&gt;<span class="hljs-literal">true</span>&lt;/optional&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;<br>            &lt;artifactId&gt;lombok&lt;/artifactId&gt;<br>            &lt;optional&gt;<span class="hljs-literal">true</span>&lt;/optional&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;<br>            &lt;scope&gt;test&lt;/scope&gt;<br>        &lt;/dependency&gt;<br>    &lt;/dependencies&gt;<br></code></pre></td></tr></table></figure><p>yml</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java">server:<br>  port: <span class="hljs-number">8001</span><br><br>spring:<br>  application:<br>    name: cloud-provider-hystrix-payment<br><br>eureka:<br>  client:<br>    register-with-eureka: <span class="hljs-literal">true</span><br>    fetch-registry: <span class="hljs-literal">true</span><br>    service-url:<br>      #defaultZone: http:<span class="hljs-comment">//eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka</span><br>      defaultZone: http:<span class="hljs-comment">//eureka7001.com:7001/eureka</span><br></code></pre></td></tr></table></figure><p>service</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.springcloud.service;<br><br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><br><span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PaymentService</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 正常访问，一切OK</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">paymentInfo_OK</span><span class="hljs-params">(Integer id)</span><br>    &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;线程池:&quot;</span>+Thread.currentThread().getName()+<span class="hljs-string">&quot;paymentInfo_OK,id: &quot;</span>+id+<span class="hljs-string">&quot;\t&quot;</span>+<span class="hljs-string">&quot;O(∩_∩)O&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 超时访问，演示降级</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">paymentInfo_TimeOut</span><span class="hljs-params">(Integer id)</span><br>    &#123;<br>        <span class="hljs-keyword">try</span> &#123; TimeUnit.SECONDS.sleep(<span class="hljs-number">3</span>); &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123; e.printStackTrace(); &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;线程池:&quot;</span>+Thread.currentThread().getName()+<span class="hljs-string">&quot;paymentInfo_TimeOut,id: &quot;</span>+id+<span class="hljs-string">&quot;\t&quot;</span>+<span class="hljs-string">&quot;O(∩_∩)O，耗费3秒&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>Controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.springcloud.controller;<br><br><span class="hljs-keyword">import</span> com.atguigu.springcloud.service.PaymentService;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Value;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PathVariable;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PaymentController</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> PaymentService paymentService;<br><br>    <span class="hljs-meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> String serverPort;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/payment/hystrix/ok/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">paymentInfo_OK</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> paymentService.paymentInfo_OK(id);<br>        log.info(<span class="hljs-string">&quot;result: &#123;&#125;&quot;</span>, result);<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/payment/hystrix/timeout/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">paymentInfo_TimeOut</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> <span class="hljs-keyword">throws</span> InterruptedException<br>    &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> paymentService.paymentInfo_TimeOut(id);<br>        log.info(<span class="hljs-string">&quot;result: &#123;&#125;&quot;</span>, result);<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>main</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.springcloud;<br><br><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<br><span class="hljs-keyword">import</span> org.springframework.cloud.netflix.eureka.EnableEurekaClient;<br><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableEurekaClient</span> <span class="hljs-comment">//本服务启动后会自动注册进eureka服务中</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PaymentHystrixMain8001</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(PaymentHystrixMain8001.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="配置Hystrix的服务降级"><a href="#配置Hystrix的服务降级" class="headerlink" title="配置Hystrix的服务降级"></a>配置Hystrix的服务降级</h2><p>service中使用@HystrixCommand, fallbackMethod 指定失败之后的调用的方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PaymentService</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 正常访问，一切OK</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">paymentInfo_OK</span><span class="hljs-params">(Integer id)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;线程池:&quot;</span> + Thread.currentThread().getName() + <span class="hljs-string">&quot;paymentInfo_OK,id: &quot;</span> + id + <span class="hljs-string">&quot;\t&quot;</span> + <span class="hljs-string">&quot;O(∩_∩)O&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 超时访问，演示降级</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@HystrixCommand(fallbackMethod = &quot;paymentInfo_TimeOutHandler&quot;,</span><br><span class="hljs-meta">            commandProperties = &#123;</span><br><span class="hljs-meta">                    @HystrixProperty(name = &quot;execution.isolation.thread.timeoutInMilliseconds&quot;, value = &quot;3000&quot;)</span><br><span class="hljs-meta">            &#125;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">paymentInfo_TimeOut</span><span class="hljs-params">(Integer id)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>/<span class="hljs-number">0</span>;<br><span class="hljs-comment">//        try &#123;</span><br><span class="hljs-comment">//            TimeUnit.SECONDS.sleep(3);</span><br><span class="hljs-comment">//        &#125; catch (InterruptedException e) &#123;</span><br><span class="hljs-comment">//            e.printStackTrace();</span><br><span class="hljs-comment">//        &#125;</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;线程池:&quot;</span> + Thread.currentThread().getName() + <span class="hljs-string">&quot;paymentInfo_TimeOut,id: &quot;</span> + id + <span class="hljs-string">&quot;\t&quot;</span> + <span class="hljs-string">&quot;O(∩_∩)O，耗费3秒&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">paymentInfo_TimeOutHandler</span><span class="hljs-params">(Integer id)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;/(ㄒoㄒ)/调用支付接口超时或异常：\t&quot;</span>+ <span class="hljs-string">&quot;\t当前线程池名字&quot;</span> + Thread.currentThread().getName();<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>入口标记@EnableCircuitBreaker注解</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableEurekaClient</span> <span class="hljs-comment">//本服务启动后会自动注册进eureka服务中</span><br><span class="hljs-meta">@EnableCircuitBreaker</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PaymentHystrixMain8001</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(PaymentHystrixMain8001.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/assets/d68ec417767148c88558a949431505e0.png"></p><p>当调用的业务出现异常, 超时等就会调用兜底的方法<code>paymentInfo_TimeOutHandler</code></p><h2 id="配置Hystrix消费者服务降级"><a href="#配置Hystrix消费者服务降级" class="headerlink" title="配置Hystrix消费者服务降级"></a>配置Hystrix消费者服务降级</h2><p>pom</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependencies&gt;<br>        &lt;!--openfeign--&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;!--hystrix--&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;!--eureka client--&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;!-- 引入自己定义的api通用包，可以使用Payment支付Entity --&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;com.atguigu.springcloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt;<br>            &lt;version&gt;$&#123;project.version&#125;&lt;/version&gt;<br>        &lt;/dependency&gt;<br>        &lt;!--web--&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;!--一般基础通用配置--&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;<br>            &lt;scope&gt;runtime&lt;/scope&gt;<br>            &lt;optional&gt;<span class="hljs-literal">true</span>&lt;/optional&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;<br>            &lt;artifactId&gt;lombok&lt;/artifactId&gt;<br>            &lt;optional&gt;<span class="hljs-literal">true</span>&lt;/optional&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;<br>            &lt;scope&gt;test&lt;/scope&gt;<br>        &lt;/dependency&gt;<br>    &lt;/dependencies&gt;<br></code></pre></td></tr></table></figure><p>yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">80</span><br><br><span class="hljs-attr">eureka:</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">register-with-eureka:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-attr">service-url:</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://eureka7001.com:7001/eureka/</span><br><br><span class="hljs-attr">feign:</span><br>  <span class="hljs-attr">hystrix:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>Controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/consumer/payment/hystrix/timeout/&#123;id&#125;&quot;)</span><br>    <span class="hljs-meta">@HystrixCommand(fallbackMethod = &quot;paymentTimeOutFallbackMethod&quot;,commandProperties = &#123;</span><br><span class="hljs-meta">            @HystrixProperty(name=&quot;execution.isolation.thread.timeoutInMilliseconds&quot;,value=&quot;1500&quot;)</span><br><span class="hljs-meta">    &#125;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">paymentInfo_TimeOut</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span><br>    &#123;<br>        <span class="hljs-keyword">return</span> paymentHystrixService.paymentInfo_TimeOut(id);<br>    &#125;<br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">paymentTimeOutFallbackMethod</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span><br>    &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;我是消费者80,对方支付系统繁忙请10秒钟后再试或者自己运行出错请检查自己,o(╥﹏╥)o&quot;</span>;<br>    &#125;<br></code></pre></td></tr></table></figure><p>service</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@FeignClient(value = &quot;CLOUD-PROVIDER-HYSTRIX-PAYMENT&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">PaymentHystrixService</span><br>&#123;<br>    <span class="hljs-meta">@GetMapping(&quot;/payment/hystrix/ok/&#123;id&#125;&quot;)</span><br>    String <span class="hljs-title function_">paymentInfo_OK</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/payment/hystrix/timeout/&#123;id&#125;&quot;)</span><br>    String <span class="hljs-title function_">paymentInfo_TimeOut</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>入口函数,记得 需要标记这个@EnableHystrix这个注解</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableFeignClients</span><br><span class="hljs-meta">@EnableHystrix</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderHystrixMain80</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(OrderHystrixMain80.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>代码测试</p><p><img src="/assets/2413a4b9d0b14c91885e012a8498eba8.png"></p><h2 id="配置全局服务降级"><a href="#配置全局服务降级" class="headerlink" title="配置全局服务降级"></a>配置全局服务降级</h2><ol><li>Controller上面添加<code>@DefaultProperties(defaultFallback = &quot;payment_Global_FallbackMethod&quot;)</code></li><li>将</li></ol><p>&#x2F;&#x2F;    @HystrixCommand(fallbackMethod &#x3D; “paymentTimeOutFallbackMethod”,commandProperties &#x3D; {<br>&#x2F;&#x2F;            @HystrixProperty(name&#x3D;”execution.isolation.thread.timeoutInMilliseconds”,value&#x3D;”1500”)<br>&#x2F;&#x2F;    })</p><p>修改成<code>@HystrixCommand</code></p><ol><li>编写全局处理方法</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> String <span class="hljs-title function_">payment_Global_FallbackMethod</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Global异常处理信息，请稍后再试，/(ㄒoㄒ)/~~&quot;</span>;<br>    &#125;<br></code></pre></td></tr></table></figure><p>完整代码:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@DefaultProperties(defaultFallback = &quot;payment_Global_FallbackMethod&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderHystirxController</span><br>&#123;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> PaymentHystrixService paymentHystrixService;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/consumer/payment/hystrix/ok/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">paymentInfo_OK</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span><br>    &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> paymentHystrixService.paymentInfo_OK(id);<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/consumer/payment/hystrix/timeout/&#123;id&#125;&quot;)</span><br><span class="hljs-comment">//    @HystrixCommand(fallbackMethod = &quot;paymentTimeOutFallbackMethod&quot;,commandProperties = &#123;</span><br><span class="hljs-comment">//            @HystrixProperty(name=&quot;execution.isolation.thread.timeoutInMilliseconds&quot;,value=&quot;1500&quot;)</span><br><span class="hljs-comment">//    &#125;)</span><br>    <span class="hljs-meta">@HystrixCommand</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">paymentInfo_TimeOut</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span><br>    &#123;<br>        <span class="hljs-keyword">return</span> paymentHystrixService.paymentInfo_TimeOut(id);<br>    &#125;<br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">paymentTimeOutFallbackMethod</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span><br>    &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;我是消费者80,对方支付系统繁忙请10秒钟后再试或者自己运行出错请检查自己,o(╥﹏╥)o&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">payment_Global_FallbackMethod</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Global异常处理信息，请稍后再试，/(ㄒoㄒ)/~~&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>代码测试: </p><p><img src="/assets/dd493bea04334c06909969a8cabfcdff.png"></p><h2 id="将业务分开"><a href="#将业务分开" class="headerlink" title="将业务分开"></a>将业务分开</h2><p>yml配置</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java">server:<br>  port: <span class="hljs-number">80</span><br><br>eureka:<br>  client:<br>    register-with-eureka: <span class="hljs-literal">false</span><br>    service-url:<br>      defaultZone: http:<span class="hljs-comment">//eureka7001.com:7001/eureka/</span><br><br>feign:<br>  hystrix:<br>    enabled: <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>让PaymentFallbackService 实现PaymentHystrixService 接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.springcloud.service;<br><br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PaymentFallbackService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PaymentHystrixService</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">paymentInfo_OK</span><span class="hljs-params">(Integer id)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;服务调用失败，提示来自：cloud-consumer-feign-order80 PaymentFallbackService paymentInfo_OK&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">paymentInfo_TimeOut</span><span class="hljs-params">(Integer id)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;服务调用失败，提示来自：cloud-consumer-feign-order80 PaymentFallbackService paymentInfo_TimeOut&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>在PaymentHystrixService接口上标记注解FeignClient注解, 并且需要指定fallback 是哪一个类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@FeignClient(value = &quot;CLOUD-PROVIDER-HYSTRIX-PAYMENT&quot;, fallback = PaymentFallbackService.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">PaymentHystrixService</span><br>&#123;<br>    <span class="hljs-meta">@GetMapping(&quot;/payment/hystrix/ok/&#123;id&#125;&quot;)</span><br>    String <span class="hljs-title function_">paymentInfo_OK</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/payment/hystrix/timeout/&#123;id&#125;&quot;)</span><br>    String <span class="hljs-title function_">paymentInfo_TimeOut</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>代码测试</p><p><img src="/assets/89deadc963e74309a613ffe2ec1b32e6.png"></p><h2 id="服务熔断"><a href="#服务熔断" class="headerlink" title="服务熔断"></a>服务熔断</h2><p>service</p><p>这个注解的意思是: 在10秒内, 发送了10个请求, 出现60%的错误, 就开启断路器</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//=========服务熔断</span><br>    <span class="hljs-meta">@HystrixCommand(fallbackMethod = &quot;paymentCircuitBreaker_fallback&quot;,commandProperties = &#123;</span><br><span class="hljs-meta">            @HystrixProperty(name = &quot;circuitBreaker.enabled&quot;,value = &quot;true&quot;),</span><br><span class="hljs-meta">            @HystrixProperty(name = &quot;circuitBreaker.requestVolumeThreshold&quot;,value = &quot;10&quot;),</span><br><span class="hljs-meta">            @HystrixProperty(name = &quot;circuitBreaker.sleepWindowInMilliseconds&quot;,value = &quot;10000&quot;),</span><br><span class="hljs-meta">            @HystrixProperty(name = &quot;circuitBreaker.errorThresholdPercentage&quot;,value = &quot;60&quot;),</span><br><span class="hljs-meta">    &#125;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">paymentCircuitBreaker</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span><br>    &#123;<br>        <span class="hljs-keyword">if</span>(id &lt; <span class="hljs-number">0</span>)<br>        &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;******id 不能负数&quot;</span>);<br>        &#125;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">serialNumber</span> <span class="hljs-operator">=</span> IdUtil.simpleUUID();<br><br>        <span class="hljs-keyword">return</span> Thread.currentThread().getName()+<span class="hljs-string">&quot;\t&quot;</span>+<span class="hljs-string">&quot;调用成功，流水号: &quot;</span> + serialNumber;<br>    &#125;<br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">paymentCircuitBreaker_fallback</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span><br>    &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;id 不能负数，请稍后再试，/(ㄒoㄒ)/~~   id: &quot;</span> +id;<br>    &#125;<br></code></pre></td></tr></table></figure><p>controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/payment/circuit/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">paymentCircuitBreaker</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span><br>    &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> paymentService.paymentCircuitBreaker(id);<br>        log.info(<span class="hljs-string">&quot;****result: &quot;</span>+result);<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br></code></pre></td></tr></table></figure><p>代码测试</p><p><img src="/assets/c514b47d934e4708a0a977ee401a47b8.png"></p><p><img src="/assets/cd158c5310b04f2e873b7be38782ebf8.png"></p><p>总结:</p><p><img src="/assets/069f03b928234f6d980d4d14ce6f31d9.png"></p><h2 id="Hystrix图形化Dashboard搭建"><a href="#Hystrix图形化Dashboard搭建" class="headerlink" title="Hystrix图形化Dashboard搭建"></a>Hystrix图形化Dashboard搭建</h2><p>pom</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependencies&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix-dashboard&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br><br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;<br>            &lt;scope&gt;runtime&lt;/scope&gt;<br>            &lt;optional&gt;<span class="hljs-literal">true</span>&lt;/optional&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;<br>            &lt;artifactId&gt;lombok&lt;/artifactId&gt;<br>            &lt;optional&gt;<span class="hljs-literal">true</span>&lt;/optional&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;<br>            &lt;scope&gt;test&lt;/scope&gt;<br>        &lt;/dependency&gt;<br>    &lt;/dependencies&gt;<br></code></pre></td></tr></table></figure><p>yml</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">server:<br>  port: <span class="hljs-number">9001</span><br></code></pre></td></tr></table></figure><p>入口函数,记得添加@EnableHystrixDashboard</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.springcloud;<br><br><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<br><span class="hljs-keyword">import</span> org.springframework.cloud.netflix.hystrix.dashboard.EnableHystrixDashboard;<br><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableHystrixDashboard</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HystrixDashboardMain9001</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(HystrixDashboardMain9001.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>配置完成之后访问<a href="http://localhost:9001/hystrix">http://localhost:9001/hystrix</a></p><p><img src="/assets/1d15f043a5a449419dbfd1cc4e3f116e.png"></p><p>凡是要监控一定要添加actuator</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependency&gt;<br>    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>    &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure><p>9001监控8001</p><p>填写监控地址<a href="http://localhost:8001/hystrix.stream">http://localhost:8001/hystrix.stream</a></p><p>1：Delay：该参数用来控制服务器上轮询监控信息的延迟时间，默认为2000毫秒，可以通过配置该属性来降低客户端的网络和CPU消耗。</p><p>2：Title：该参数对应了头部标题Hystrix Stream之后的内容，默认会使用具体监控实例的URL，可以通过配置该信息来展示更合适的标题。</p><p><img src="/assets/f1a48b286fd44ea68f27332857234f91.png"></p><p><img src="/assets/71b2267529274a54b037d67a261819d3.png"></p><p><img src="/assets/36a1c26971b046d1be8e70101a64c152.png"></p><p>Open表示断路器开启了</p><p>实心圆：共有两种含义。它通过颜色的变化代表了实例的健康程度，它的健康度从绿色&lt;黄色&lt;橙色&lt;红色递减。</p><p>该实心圆除了颜色的变化之外，它的大小也会根据实例的请求流量发生变化，流量越大该实心圆就越大。所以通过该实心圆的展示，就可以在大量的实例中快速的发现故障实例和高压力实例。</p><h2 id="Gateway的配置"><a href="#Gateway的配置" class="headerlink" title="Gateway的配置"></a>Gateway的配置</h2><p>pom</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependencies&gt;<br>        &lt;!--gateway--&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;!--eureka-client--&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;!-- 引入自己定义的api通用包，可以使用Payment支付Entity --&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;com.atguigu.springcloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt;<br>            &lt;version&gt;$&#123;project.version&#125;&lt;/version&gt;<br>        &lt;/dependency&gt;<br>        &lt;!--一般基础配置类--&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;<br>            &lt;scope&gt;runtime&lt;/scope&gt;<br>            &lt;optional&gt;<span class="hljs-literal">true</span>&lt;/optional&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;<br>            &lt;artifactId&gt;lombok&lt;/artifactId&gt;<br>            &lt;optional&gt;<span class="hljs-literal">true</span>&lt;/optional&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;<br>            &lt;scope&gt;test&lt;/scope&gt;<br>        &lt;/dependency&gt;<br>    &lt;/dependencies&gt;<br></code></pre></td></tr></table></figure><p>yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">9527</span><br><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">cloud-gateway</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">gateway:</span><br>      <span class="hljs-attr">routes:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">payment_routh#payment_route</span>    <span class="hljs-comment">#路由的ID，没有固定规则但要求唯一，建议配合服务名</span><br><span class="hljs-attr">uri:</span> <span class="hljs-string">http://localhost:8001#匹配后提供服务的路由地址</span><br><span class="hljs-attr">predicates:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/payment/get/**#断言，路径相匹配的进行路由</span><br><br><span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">payment_routh2#payment_route</span>    <span class="hljs-comment">#路由的ID，没有固定规则但要求唯一，建议配合服务名</span><br><span class="hljs-attr">uri:</span> <span class="hljs-string">http://localhost:8001#匹配后提供服务的路由地址</span><br><span class="hljs-attr">predicates:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/payment/lb/**#断言，路径相匹配的进行路由</span><br><br><span class="hljs-attr">eureka:</span><br>  <span class="hljs-attr">instance:</span><br>    <span class="hljs-attr">hostname:</span> <span class="hljs-string">cloud-gateway-service</span><br>  <span class="hljs-string">client:#服务提供者provider注册进eureka服务列表内</span><br><span class="hljs-attr">service-url:</span><br>      <span class="hljs-attr">register-with-eureka:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-attr">fetch-registry:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://eureka7001.com:7001/eureka</span><br></code></pre></td></tr></table></figure><p>入口函数</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableEurekaClient</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GateWayMain9527</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(GateWayMain9527.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>另外第一个微服务的controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/payment/get/&#123;id&#125;&quot;)</span><br><span class="hljs-keyword">public</span> CommonResult <span class="hljs-title function_">getPayment</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;&#125;<br><span class="hljs-meta">@GetMapping(value = &quot;/payment/lb&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">getPaymentLB</span><span class="hljs-params">()</span>&#123;&#125;<br></code></pre></td></tr></table></figure><p>代码测试, 使用8001, 9527两个端口调用都可以</p><p><img src="/assets/e8c3ace1b69242528e52d2ebc83e4803.png"></p><p><img src="/assets/4209ed39cca34d39a121de9e96879645.png"></p><h2 id="网关配置路由"><a href="#网关配置路由" class="headerlink" title="网关配置路由"></a>网关配置路由</h2><p>9527端口的微服务配置config</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GateWayConfig</span> &#123;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> RouteLocator <span class="hljs-title function_">customRouteLocator</span><span class="hljs-params">(RouteLocatorBuilder builder)</span> &#123;<br>        RouteLocatorBuilder.<span class="hljs-type">Builder</span> <span class="hljs-variable">routes</span> <span class="hljs-operator">=</span> builder.routes();<br>        routes.route(<span class="hljs-string">&quot;path_router_atguigu&quot;</span>, r -&gt; r.path(<span class="hljs-string">&quot;/video/BV18E411x7eT&quot;</span>).uri(<span class="hljs-string">&quot;https://www.bilibili.com/video/BV18E411x7eT&quot;</span>))<br>        .route(<span class="hljs-string">&quot;anime&quot;</span>, r-&gt;r.path(<span class="hljs-string">&quot;/anime&quot;</span>).uri(<span class="hljs-string">&quot;https://www.bilibili.com/anime/&quot;</span>)).build();<br>        <span class="hljs-keyword">return</span> routes.build();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/assets/85e5fc6238d3486bbb05dfaff8eae7b1.png"></p><p>访问<a href="http://localhost:9527/anime">http://localhost:9527/anime</a>被转发到了B站番剧</p><p>虽然没有图片…</p><h2 id="动态路由"><a href="#动态路由" class="headerlink" title="动态路由"></a>动态路由</h2><p>修改9527服务的yml</p><p>开启动态路由</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">spring:<br>  application:<br>    name: cloud-gateway<br>  cloud:<br>    gateway:<br>      discovery:<br>        locator:<br>          enabled: <span class="hljs-literal">true</span> #开启从注册中心动态创建路由的功能，利用微服务名进行路由<br></code></pre></td></tr></table></figure><p>把原先的uri注释掉, 改成lb:&#x2F;&#x2F;服务名</p><p>uri的协议为lb, 表示启用Gateway的负载均衡功能</p><p>lb:&#x2F;&#x2F;serviceName 是springcloud Gateway在微服务中自动为我们创建的负载均衡uri</p><p>完整代码如下: </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java">server:<br>  port: <span class="hljs-number">9527</span><br><br>spring:<br>  application:<br>    name: cloud-gateway<br>  cloud:<br>    gateway:<br>      discovery:<br>        locator:<br>          enabled: <span class="hljs-literal">true</span> #开启从注册中心动态创建路由的功能，利用微服务名进行路由<br>      routes:<br>        - id: payment_routh #payment_route    #路由的ID，没有固定规则但要求唯一，建议配合服务名<br>#          uri: http:<span class="hljs-comment">//localhost:8001          #匹配后提供服务的路由地址</span><br>          uri: lb:<span class="hljs-comment">//cloud-payment-service #匹配后提供服务的路由地址</span><br>          predicates:<br>            - Path=/payment/get<span class="hljs-comment">/**         # 断言，路径相匹配的进行路由</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">        - id: payment_routh2 #payment_route    #路由的ID，没有固定规则但要求唯一，建议配合服务名</span><br><span class="hljs-comment">#          uri: http://localhost:8001          #匹配后提供服务的路由地址</span><br><span class="hljs-comment">          uri: lb://cloud-payment-service #匹配后提供服务的路由地址</span><br><span class="hljs-comment">          predicates:</span><br><span class="hljs-comment">            - Path=/payment/lb/**         # 断言，路径相匹配的进行路由</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">eureka:</span><br><span class="hljs-comment">  instance:</span><br><span class="hljs-comment">    hostname: cloud-gateway-service</span><br><span class="hljs-comment">  client: #服务提供者provider注册进eureka服务列表内</span><br><span class="hljs-comment">    service-url:</span><br><span class="hljs-comment">      register-with-eureka: true</span><br><span class="hljs-comment">      fetch-registry: true</span><br><span class="hljs-comment">      defaultZone: http://eureka7001.com:7001/eureka</span><br></code></pre></td></tr></table></figure><p>配置好之后, 测试9527就负载均衡了, 请求到了8001和8002</p><p><img src="/assets/440574f839b74df49e9025a42baac348.png"></p><p><img src="/assets/8a8dc381bdbc478ca740e2774f1adfcc.png"></p><h2 id="Gateway常用的Predicate"><a href="#Gateway常用的Predicate" class="headerlink" title="Gateway常用的Predicate"></a>Gateway常用的Predicate</h2><p>编写一个测试类获取当前时区的时间</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ZonedDateTimeDemo</span> &#123;<br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testTime</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">ZonedDateTime</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> ZonedDateTime.now();<br>        System.out.println(now);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>2023-04-30T11:01:33.030+08:00[Asia&#x2F;Shanghai]</p><p>然后配置yml</p><p>predicates下的After, 表示在这个时间点之后才能运行</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java">spring:<br>  application:<br>    name: cloud-gateway<br>  cloud:<br>    gateway:<br>      discovery:<br>        locator:<br>          enabled: <span class="hljs-literal">true</span> #开启从注册中心动态创建路由的功能，利用微服务名进行路由<br>      routes:<br>        - id: payment_routh #payment_route    #路由的ID，没有固定规则但要求唯一，建议配合服务名<br>#          uri: http:<span class="hljs-comment">//localhost:8001          #匹配后提供服务的路由地址</span><br>          uri: lb:<span class="hljs-comment">//cloud-payment-service #匹配后提供服务的路由地址</span><br>          predicates:<br>            - Path=/payment/get<span class="hljs-comment">/**         # 断言，路径相匹配的进行路由</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">        - id: payment_routh2 #payment_route    #路由的ID，没有固定规则但要求唯一，建议配合服务名</span><br><span class="hljs-comment">#          uri: http://localhost:8001          #匹配后提供服务的路由地址</span><br><span class="hljs-comment">          uri: lb://cloud-payment-service #匹配后提供服务的路由地址</span><br><span class="hljs-comment">          predicates:</span><br><span class="hljs-comment">            - Path=/payment/lb/**         # 断言，路径相匹配的进行路由</span><br><span class="hljs-comment">            - After=2023-04-30T12:01:33.030+08:00[Asia/Shanghai] # 断言，路径相匹配的进行路由</span><br></code></pre></td></tr></table></figure><p>时间到了测试</p><p>时间还没到测试</p><p><img src="/assets/7676b3f28d5b49dd831b5984bc88d4ec.png"></p><p>断言cookie</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">- id: payment_routh2 #payment_route    #路由的ID，没有固定规则但要求唯一，建议配合服务名<br>#          uri: http:<span class="hljs-comment">//localhost:8001          #匹配后提供服务的路由地址</span><br>          uri: lb:<span class="hljs-comment">//cloud-payment-service #匹配后提供服务的路由地址</span><br>          predicates:<br>            - Path=/payment/lb<span class="hljs-comment">/**         # 断言，路径相匹配的进行路由</span><br><span class="hljs-comment">#            - After=2023-04-30T11:01:33.030+08:00[Asia/Shanghai] # 断言，路径相匹配的进行路由</span><br><span class="hljs-comment">            - Cookie=username, roudoukouya</span><br></code></pre></td></tr></table></figure><p><img src="/assets/7135810edc1d4ddbbae0c77c78fd426a.png"></p><p>断言请求头</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">- id: payment_routh2 #payment_route    #路由的ID，没有固定规则但要求唯一，建议配合服务名<br>#          uri: http:<span class="hljs-comment">//localhost:8001          #匹配后提供服务的路由地址</span><br>          uri: lb:<span class="hljs-comment">//cloud-payment-service #匹配后提供服务的路由地址</span><br>          predicates:<br>            - Path=/payment/lb<span class="hljs-comment">/**         # 断言，路径相匹配的进行路由</span><br><span class="hljs-comment">#            - After=2023-04-30T11:01:33.030+08:00[Asia/Shanghai] # 断言，路径相匹配的进行路由</span><br><span class="hljs-comment">#            - Cookie=username, roudoukouya</span><br><span class="hljs-comment">            - Header=X-Request-Id, \d+  # 请求头要有X-Request-Id属性并且值为整数的正则表达式</span><br></code></pre></td></tr></table></figure><p><img src="/assets/397b64a7a1b54dd699750a8b348178a8.png"></p><p>断言主机名Host</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">- id: payment_routh2 #payment_route    #路由的ID，没有固定规则但要求唯一，建议配合服务名<br>#          uri: http:<span class="hljs-comment">//localhost:8001          #匹配后提供服务的路由地址</span><br>          uri: lb:<span class="hljs-comment">//cloud-payment-service #匹配后提供服务的路由地址</span><br>          predicates:<br>            - Path=/payment/lb<span class="hljs-comment">/**         # 断言，路径相匹配的进行路由</span><br><span class="hljs-comment">#            - After=2023-04-30T11:01:33.030+08:00[Asia/Shanghai] # 断言，路径相匹配的进行路由</span><br><span class="hljs-comment">#            - Cookie=username, roudoukouya</span><br><span class="hljs-comment">#            - Header=X-Request-Id, \d+  # 请求头要有X-Request-Id属性并且值为整数的正则表达式</span><br><span class="hljs-comment">            - Host=**.atguigu.com # 断言主机名</span><br></code></pre></td></tr></table></figure><p><img src="/assets/c0dad9ee845248daaca95f8864ccf8ba.png"></p><p>断言方法类型</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">- id: payment_routh2 #payment_route    #路由的ID，没有固定规则但要求唯一，建议配合服务名<br>#          uri: http:<span class="hljs-comment">//localhost:8001          #匹配后提供服务的路由地址</span><br>          uri: lb:<span class="hljs-comment">//cloud-payment-service #匹配后提供服务的路由地址</span><br>          predicates:<br>            - Path=/payment/lb<span class="hljs-comment">/**         # 断言，路径相匹配的进行路由</span><br><span class="hljs-comment">#            - After=2023-04-30T11:01:33.030+08:00[Asia/Shanghai] # 断言，路径相匹配的进行路由</span><br><span class="hljs-comment">#            - Cookie=username, roudoukouya</span><br><span class="hljs-comment">#            - Header=X-Request-Id, \d+  # 请求头要有X-Request-Id属性并且值为整数的正则表达式</span><br><span class="hljs-comment">#            - Host=**.atguigu.com # 断言主机名</span><br><span class="hljs-comment">            - Method=GET # 断言方法类型</span><br></code></pre></td></tr></table></figure><p><img src="/assets/c4ac7bbec00f4d8fb22a934758ac2160.png"></p><p>断言参数</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java">- id: payment_routh2 #payment_route    #路由的ID，没有固定规则但要求唯一，建议配合服务名<br>#          uri: http:<span class="hljs-comment">//localhost:8001          #匹配后提供服务的路由地址</span><br>          uri: lb:<span class="hljs-comment">//cloud-payment-service #匹配后提供服务的路由地址</span><br>          predicates:<br>            - Path=/payment/lb<span class="hljs-comment">/**         # 断言，路径相匹配的进行路由</span><br><span class="hljs-comment">#            - After=2023-04-30T11:01:33.030+08:00[Asia/Shanghai] # 断言，路径相匹配的进行路由</span><br><span class="hljs-comment">#            - Cookie=username, roudoukouya</span><br><span class="hljs-comment">#            - Header=X-Request-Id, \d+  # 请求头要有X-Request-Id属性并且值为整数的正则表达式</span><br><span class="hljs-comment">#            - Host=**.atguigu.com # 断言主机名</span><br><span class="hljs-comment">#            - Method=GET # 断言方法类型</span><br><span class="hljs-comment">            - Query=username, \d+  # 要有参数名username并且值还要是整数才能路由</span><br></code></pre></td></tr></table></figure><p><img src="/assets/291105915ecb496085731031e0158d06.png"></p><h2 id="配置自定义过滤器"><a href="#配置自定义过滤器" class="headerlink" title="配置自定义过滤器"></a>配置自定义过滤器</h2><p>编写filter过滤器MyLogGateWayFilter </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.springcloud.filter;<br><br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.cloud.gateway.filter.GatewayFilterChain;<br><span class="hljs-keyword">import</span> org.springframework.cloud.gateway.filter.GlobalFilter;<br><span class="hljs-keyword">import</span> org.springframework.core.Ordered;<br><span class="hljs-keyword">import</span> org.springframework.http.HttpStatus;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><span class="hljs-keyword">import</span> org.springframework.web.server.ServerWebExchange;<br><span class="hljs-keyword">import</span> reactor.core.publisher.Mono;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyLogGateWayFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">GlobalFilter</span>, Ordered &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title function_">filter</span><span class="hljs-params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;<br>        log.info(<span class="hljs-string">&quot;指定了自定义的全局过滤器 MyLogGateWayFilter&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">uname</span> <span class="hljs-operator">=</span> exchange.getRequest().getQueryParams().getFirst(<span class="hljs-string">&quot;uname&quot;</span>);<br>        <span class="hljs-keyword">if</span> (uname == <span class="hljs-literal">null</span>) &#123;<br>            log.info(<span class="hljs-string">&quot;用户名为null , 无法登录&quot;</span>);<br>            exchange.getResponse().setStatusCode(HttpStatus.NOT_ACCEPTABLE);<br>            <span class="hljs-keyword">return</span> exchange.getResponse().setComplete();<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> chain.filter(exchange);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getOrder</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>请求中就必须带上uname这个参数, 否则就会被406拒绝</p><p><img src="/assets/edb8bc7771b14aff86dca351ebd495fc.png"></p><p><img src="/assets/ebc19eb888864fb09e228fe304cb8dcc.png"></p><h2 id="配置中心Config-服务端"><a href="#配置中心Config-服务端" class="headerlink" title="配置中心Config 服务端"></a>配置中心Config 服务端</h2><p>创建<code>cloud-config-center-3344</code>项目</p><p>引入pom</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependencies&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-cloud-config-server&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br><br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;<br>            &lt;scope&gt;runtime&lt;/scope&gt;<br>            &lt;optional&gt;<span class="hljs-literal">true</span>&lt;/optional&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;<br>            &lt;artifactId&gt;lombok&lt;/artifactId&gt;<br>            &lt;optional&gt;<span class="hljs-literal">true</span>&lt;/optional&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;<br>            &lt;scope&gt;test&lt;/scope&gt;<br>        &lt;/dependency&gt;<br>    &lt;/dependencies&gt;<br></code></pre></td></tr></table></figure><p>需要提前创建一个gitee仓库, 为啥不用github, 因为我的代理垃圾呜呜呜</p><p>代理配置<a href="https://blog.csdn.net/qq_41731201/article/details/123527717">https://blog.csdn.net/qq_41731201&#x2F;article&#x2F;details&#x2F;123527717</a></p><p>yml配置</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java">server:<br>  port: <span class="hljs-number">3344</span><br><br>spring:<br>  application:<br>    name:  cloud-config-center #注册进Eureka服务器的微服务名<br>  cloud:<br>    config:<br>      server:<br>        git:<br>          uri: https:<span class="hljs-comment">//gitee.com/xialonggui/springcloud-config.git</span><br>#          uri: https:<span class="hljs-comment">//gitee.com/java-mohan/springcloud-config.git</span><br>#          ####搜索目录<br>          search-paths:<br>            - springcloud-config<br>      ###读取分支<br>      label: master<br><br>#服务注册到eureka地址<br>eureka:<br>  client:<br>    service-url:<br>      defaultZone: http:<span class="hljs-comment">//eureka7001.com:7001/eureka/, http://eureka7003.com:7003/eureka/, http://eureka7004.com:7004/eureka/, http://eureka7005.com:7005/eureka/</span><br></code></pre></td></tr></table></figure><p>启动类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableConfigServer</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigCenterMain3344</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(ConfigCenterMain3344.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>代码测试</p><p>这几种测试都可以</p><p>localhost:3344&#x2F;master&#x2F;config-dev.yml</p><p>localhost:3344&#x2F;config-dev.yml</p><p>localhost:3344&#x2F;config&#x2F;dev&#x2F;master</p><p><img src="/assets/b876c6e7f04449e4b269d19275952e88.png"></p><p><img src="/assets/70088f48f36d48aabafdc2a520e0a314.png"></p><p><img src="/assets/39d25c877bd54fb196efd4a171f49aa2.png"></p><h2 id="Config客户端的配置"><a href="#Config客户端的配置" class="headerlink" title="Config客户端的配置"></a>Config客户端的配置</h2><p>创建*<code>cloud-config-client-3355</code>项目*</p><p>pom</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><br>&lt;dependencies&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br><br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;<br>            &lt;scope&gt;runtime&lt;/scope&gt;<br>            &lt;optional&gt;<span class="hljs-literal">true</span>&lt;/optional&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;<br>            &lt;artifactId&gt;lombok&lt;/artifactId&gt;<br>            &lt;optional&gt;<span class="hljs-literal">true</span>&lt;/optional&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;<br>            &lt;scope&gt;test&lt;/scope&gt;<br>        &lt;/dependency&gt;<br>    &lt;/dependencies&gt;<br></code></pre></td></tr></table></figure><p>注意这里需要创建的是bootstrap.yml</p><blockquote><p>applicaiton.yml是用户级的资源配置项</p></blockquote><p>bootstrap.yml是系统级的，优先级更加高</p><p>Spring Cloud会创建一个“Bootstrap Context”，作为Spring应用的<code>Application Context</code>的父上下文。初始化的时候，<code>Bootstrap Context</code>负责从外部源加载配置属性并解析配置。这两个上下文共享一个从外部获取的<code>Environment</code>。</p><p><code>Bootstrap</code>属性有高优先级，默认情况下，它们不会被本地配置覆盖。 <code>Bootstrap context</code>和<code>Application Context</code>有着不同的约定，所以新增了一个<code>bootstrap.yml</code>文件，保证<code>Bootstrap Context</code>和<code>Application Context</code>配置的分离。</p><p>要将Client模块下的application.yml文件改为bootstrap.yml,这是很关键的，</p><p>因为bootstrap.yml是比application.yml先加载的。bootstrap.yml优先级高于application.yml</p><blockquote></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java">server:<br>  port: <span class="hljs-number">3355</span><br><br>spring:<br>  application:<br>    name: config-client<br>  cloud:<br>    #Config客户端配置<br>    config:<br>      label: master #分支名称<br>      name: config #配置文件名称<br>      profile: dev #读取后缀名称   上述<span class="hljs-number">3</span>个综合：master分支上config-dev.yml的配置文件被读取http:<span class="hljs-comment">//config-3344.com:3344/master/config-dev.yml</span><br>      uri: http:<span class="hljs-comment">//localhost:3344 #配置中心地址k</span><br><br>#服务注册到eureka地址<br>eureka:<br>  client:<br>    service-url:<br>      defaultZone: http:<span class="hljs-comment">//localhost:7001/eureka</span><br></code></pre></td></tr></table></figure><p>controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.springcloud.controller;<br><br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Value;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigClientController</span><br>&#123;<br>    <span class="hljs-meta">@Value(&quot;$&#123;config.info&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String configInfo;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/configInfo&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getConfigInfo</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> configInfo;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>入口函数</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@EnableEurekaClient</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigClientMain3355</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(ConfigClientMain3355.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>代码测试</p><p>请求3355端口同样能获取Info的信息</p><p><img src="/assets/6b01ed855f314c939c0fbdaace98f440.png"></p><p><img src="/assets/090c9de199a340c6ad1ceb52545abacf.png"></p><p>当gitee的配置中心的内容发生了变化, 3344可以请求可以立马反应过来,但是3355不能</p><p>需要重启3355才可以, 这样每次修改了配置,每次都重启就显得非常蛋疼, 所以就出现了动态刷新配置</p><h2 id="动态刷新之手动版"><a href="#动态刷新之手动版" class="headerlink" title="动态刷新之手动版"></a>动态刷新之手动版</h2><p>确保pom中包含</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br></code></pre></td></tr></table></figure><p>yml暴露监控端点</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java">server:<br>  port: <span class="hljs-number">3355</span><br><br>spring:<br>  application:<br>    name: config-client<br>  cloud:<br>    #Config客户端配置<br>    config:<br>      label: master #分支名称<br>      name: config #配置文件名称<br>      profile: dev #读取后缀名称   上述<span class="hljs-number">3</span>个综合：master分支上config-dev.yml的配置文件被读取http:<span class="hljs-comment">//config-3344.com:3344/master/config-dev.yml</span><br>      uri: http:<span class="hljs-comment">//localhost:3344 #配置中心地址k</span><br><br>#服务注册到eureka地址<br>eureka:<br>  client:<br>    service-url:<br>      defaultZone: http:<span class="hljs-comment">//localhost:7001/eureka</span><br><br># 暴露监控端点<br>management:<br>  endpoints:<br>    web:<br>      exposure:<br>        include: <span class="hljs-string">&quot;*&quot;</span><br></code></pre></td></tr></table></figure><p>controller添加注解<code>@RefreshScope</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RefreshScope</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigClientController</span><br>&#123;<br>    <span class="hljs-meta">@Value(&quot;$&#123;config.info&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String configInfo;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/configInfo&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getConfigInfo</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> configInfo;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>配置完成之后重启了3355, 发现3355的请求获取info仍然没有缓过来, 3344已经缓过来了</p><p><img src="/assets/e7e01e8482824a8094642d125900401d.png"></p><p><img src="/assets/f187529ff461441f8bdbdcfd00fa7a82.png"></p><p>我们需要给3355发送一个post请求提醒一下3355</p><p>“嘿, 哥们, 别睡着了”</p><p>POST localhost:3355&#x2F;actuator&#x2F;refresh</p><p>之后3355就缓过来能获取到最新的Info信息了</p><p><img src="/assets/59dc2ca181c64c81951fcc866510ba85.png"></p><p><img src="/assets/5750442874a440e39c2fbcbc0d946052.png"></p><p>如果微服务的数量达到了很多,这样做还是很麻烦, 由此就衍生出来了SpringCloud BUS总线Bus</p><h2 id="Bus动态刷新全局广播配置实现"><a href="#Bus动态刷新全局广播配置实现" class="headerlink" title="Bus动态刷新全局广播配置实现"></a>Bus动态刷新全局广播配置实现</h2><p>首先需要配置RabbitMQ的环境</p><p><img src="/assets/7260575cd5224982bb1f70e79983fac1.png"></p><p>对每一个*<code>cloud-config-center-3344</code> ,* <em><code>cloud-config-client-3355</code> ,</em> <em><code>cloud-config-client-3366</code></em></p><p>添加pom</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;!--添加消息总线RabbitMQ支持--&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br>    &lt;artifactId&gt;spring-cloud-starter-bus-amqp&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure><p>3344yml</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java">server:<br>  port: <span class="hljs-number">3344</span><br><br>spring:<br>  application:<br>    name:  cloud-config-center #注册进Eureka服务器的微服务名<br>  cloud:<br>    config:<br>      server:<br>        git:<br>          uri: https:<span class="hljs-comment">//gitee.com/xialonggui/springcloud-config.git</span><br>#          uri: https:<span class="hljs-comment">//gitee.com/java-mohan/springcloud-config.git</span><br>#          ####搜索目录<br>          search-paths:<br>            - springcloud-config<br>      ###读取分支<br>      label: master<br>  #rabbitmq相关配置<br>  rabbitmq:<br>    host: hadoop202<br>    port: <span class="hljs-number">5672</span><br>    username: admin<br>    password: <span class="hljs-number">123</span><br><br>#服务注册到eureka地址<br>eureka:<br>  client:<br>    service-url:<br>      defaultZone: http:<span class="hljs-comment">//eureka7001.com:7001/eureka/, http://eureka7003.com:7003/eureka/, http://eureka7004.com:7004/eureka/, http://eureka7005.com:7005/eureka/</span><br><br>##rabbitmq相关配置,暴露bus刷新配置的端点<br>management:<br>  endpoints: #暴露bus刷新配置的端点<br>    web:<br>      exposure:<br>        include: <span class="hljs-string">&#x27;bus-refresh&#x27;</span><br></code></pre></td></tr></table></figure><p>3355yml</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java">server:<br>  port: <span class="hljs-number">3355</span><br><br>spring:<br>  application:<br>    name: config-client<br>  cloud:<br>    #Config客户端配置<br>    config:<br>      label: master #分支名称<br>      name: config #配置文件名称<br>      profile: dev #读取后缀名称   上述<span class="hljs-number">3</span>个综合：master分支上config-dev.yml的配置文件被读取http:<span class="hljs-comment">//config-3344.com:3344/master/config-dev.yml</span><br>      uri: http:<span class="hljs-comment">//localhost:3344 #配置中心地址k</span><br>  #rabbitmq相关配置 <span class="hljs-number">15672</span>是Web管理界面的端口；<span class="hljs-number">5672</span>是MQ访问的端口<br>  rabbitmq:<br>    host: hadoop202<br>    port: <span class="hljs-number">5672</span><br>    username: admin<br>    password: <span class="hljs-number">123</span><br><br>#服务注册到eureka地址<br>eureka:<br>  client:<br>    service-url:<br>      defaultZone: http:<span class="hljs-comment">//localhost:7001/eureka</span><br><br># 暴露监控端点<br>management:<br>  endpoints:<br>    web:<br>      exposure:<br>        include: <span class="hljs-string">&quot;*&quot;</span><br></code></pre></td></tr></table></figure><p>3366yml</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java">server:<br>  port: <span class="hljs-number">3366</span><br><br>spring:<br>  application:<br>    name: config-client<br>  cloud:<br>    #Config客户端配置<br>    config:<br>      label: master #分支名称<br>      name: config #配置文件名称<br>      profile: dev #读取后缀名称   上述<span class="hljs-number">3</span>个综合：master分支上config-dev.yml的配置文件被读取http:<span class="hljs-comment">//config-3344.com:3344/master/config-dev.yml</span><br>      uri: http:<span class="hljs-comment">//localhost:3344 #配置中心地址</span><br>  #rabbitmq相关配置 <span class="hljs-number">15672</span>是Web管理界面的端口；<span class="hljs-number">5672</span>是MQ访问的端口<br>  rabbitmq:<br>    host: hadoop202<br>    port: <span class="hljs-number">5672</span><br>    username: admin<br>    password: <span class="hljs-number">123</span><br><br>#服务注册到eureka地址<br>eureka:<br>  client:<br>    service-url:<br>      defaultZone: http:<span class="hljs-comment">//localhost:7001/eureka</span><br><br># 暴露监控端点<br>management:<br>  endpoints:<br>    web:<br>      exposure:<br>        include: <span class="hljs-string">&quot;*&quot;</span><br></code></pre></td></tr></table></figure><p>通知3344去踹醒其他微服务 POST localhost:3344&#x2F;actuator&#x2F;bus-refresh</p><p>localhost:3344&#x2F;config-dev.yml</p><p>localhost:3355&#x2F;configInfo</p><p>localhost:3366&#x2F;configInfo</p><h2 id="动态刷新顶点通知"><a href="#动态刷新顶点通知" class="headerlink" title="动态刷新顶点通知"></a>动态刷新顶点通知</h2><p>只通知3355, 不通知3366</p><p>指定具体某一个实例生效而不是全部</p><p>公式: <a href="http://localhost:配置中心端口号/actuator/bus-refresh/{destination}">http://localhost:配置中心端口号/actuator/bus-refresh/{destination}</a></p><p>&#x2F;bus&#x2F;refresh请求不再发送到具体的服务实例上,而是发给config server并通过destination参数类指定需要更新配置的服务或实例</p><p>踹醒3355, 不要惊动3366</p><p>POST localhost:3344&#x2F;actuator&#x2F;bus-refresh&#x2F;config-client:3355</p><p>此时3355更新了, 但是3366没有更新</p><p><img src="/assets/5f145ab4b49c4023bf9555603c2e6292.png"></p><p><img src="/assets/0bfb08eed714407ca8fa994c0646be27.png"></p><p><img src="/assets/e40bf27fd90f4e1c97807c2bdf43fafa.png"></p><p>以上的配置执行的代码会在让rabbitmq的topic生成一个总线</p><p><img src="/assets/a4ef39e3ffee469cb8d59ccd22c01dac.png"></p><h2 id="消息驱动生产者"><a href="#消息驱动生产者" class="headerlink" title="消息驱动生产者"></a>消息驱动生产者</h2><p>创建模块*<code>cloud-stream-rabbitmq-provider8801</code>*</p><p>pom</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependencies&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br><br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-cloud-starter-stream-rabbit&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;!--基础配置--&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;<br>            &lt;scope&gt;runtime&lt;/scope&gt;<br>            &lt;optional&gt;<span class="hljs-literal">true</span>&lt;/optional&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;<br>            &lt;artifactId&gt;lombok&lt;/artifactId&gt;<br>            &lt;optional&gt;<span class="hljs-literal">true</span>&lt;/optional&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;<br>            &lt;scope&gt;test&lt;/scope&gt;<br>        &lt;/dependency&gt;<br>    &lt;/dependencies&gt;<br></code></pre></td></tr></table></figure><p>yml</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java">server:<br>  port: <span class="hljs-number">8801</span><br><br>spring:<br>  application:<br>    name: cloud-stream-provider<br>  cloud:<br>    stream:<br>      binders: # 在此处配置要绑定的rabbitmq的服务信息；<br>        defaultRabbit: # 表示定义的名称，用于于binding整合<br>          type: rabbit # 消息组件类型<br>          environment: # 设置rabbitmq的相关的环境配置<br>            spring:<br>              rabbitmq:<br>                host: hadoop202<br>                port: <span class="hljs-number">5672</span><br>                username: admin<br>                password: <span class="hljs-number">123</span><br>      bindings: # 服务的整合处理<br>        output: # 这个名字是一个通道的名称<br>          destination: studyExchange # 表示要使用的Exchange名称定义<br>          content-type: application/json # 设置消息类型，本次为json，文本则设置“text/plain”<br>          binder: defaultRabbit # 设置要绑定的消息服务的具体设置<br><br>eureka:<br>  client: # 客户端进行Eureka注册的配置<br>    service-url:<br>      defaultZone: http:<span class="hljs-comment">//localhost:7001/eureka</span><br>  instance:<br>    lease-renewal-interval-in-seconds: <span class="hljs-number">2</span> # 设置心跳的时间间隔（默认是<span class="hljs-number">30</span>秒）<br>    lease-expiration-duration-in-seconds: <span class="hljs-number">5</span> # 如果现在超过了<span class="hljs-number">5</span>秒的间隔（默认是<span class="hljs-number">90</span>秒）<br>    instance-id: send-<span class="hljs-number">8801.</span>com  # 在信息列表时显示主机名称<br>    prefer-ip-address: <span class="hljs-literal">true</span>     # 访问的路径变为IP地址<br></code></pre></td></tr></table></figure><p>service</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.springcloud.service;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IMessageProvider</span> &#123;<br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">send</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>接口实现,类名上面不要加<code>@Service</code>注解, 这并不是像之前一样写的业务类</p><p>而是添加<code>@EnableBinding</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.springcloud.service.impl;<br><br><span class="hljs-keyword">import</span> com.atguigu.springcloud.service.IMessageProvider;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.cloud.stream.annotation.EnableBinding;<br><span class="hljs-keyword">import</span> org.springframework.cloud.stream.messaging.Source;<br><span class="hljs-keyword">import</span> org.springframework.integration.support.MessageBuilder;<br><span class="hljs-keyword">import</span> org.springframework.messaging.MessageChannel;<br><br><span class="hljs-keyword">import</span> javax.annotation.Resource;<br><span class="hljs-keyword">import</span> java.util.UUID;<br><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@EnableBinding(Source.class)</span> <span class="hljs-comment">// 可以理解为是一个消息的发送管道的定义</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageProviderImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IMessageProvider</span> &#123;<br><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> MessageChannel output; <span class="hljs-comment">// 消息的发送管道</span><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">send</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">serial</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString();<br>        <span class="hljs-built_in">this</span>.output.send(MessageBuilder.withPayload(serial).build()); <span class="hljs-comment">// 创建并发送消息</span><br>        log.info(<span class="hljs-string">&quot;serial: &#123;&#125;&quot;</span>, serial);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.springcloud.controller;<br><br><span class="hljs-keyword">import</span> com.atguigu.springcloud.service.IMessageProvider;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><br><span class="hljs-keyword">import</span> javax.annotation.Resource;<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SendMessageController</span> &#123;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> IMessageProvider messageProvider;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/sendMessage&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">sendMessage</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> messageProvider.send();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>入口函数</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.springcloud;<br><br><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<br><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StreamMQMain8801</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(StreamMQMain8801.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>程序运行之后exchanges会出现studyExchange</p><p><img src="/assets/62ce407ad4e649059550c09a84a2c891.png"></p><p>生产者: localhost:8801&#x2F;sendMessage</p><p><img src="/assets/e2d1e7946d444538809c8d772fe3e84e.png"></p><p><img src="/assets/54a3005fd6a3430cb620cf01f4147ce8.png"></p><h2 id="消息驱动消费者"><a href="#消息驱动消费者" class="headerlink" title="消息驱动消费者"></a>消息驱动消费者</h2><p>创建模块*<code>cloud-stream-rabbitmq-consumer8802</code>*</p><p>pom</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependencies&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-cloud-starter-stream-rabbit&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;!--基础配置--&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;<br>            &lt;scope&gt;runtime&lt;/scope&gt;<br>            &lt;optional&gt;<span class="hljs-literal">true</span>&lt;/optional&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;<br>            &lt;artifactId&gt;lombok&lt;/artifactId&gt;<br>            &lt;optional&gt;<span class="hljs-literal">true</span>&lt;/optional&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;<br>            &lt;scope&gt;test&lt;/scope&gt;<br>        &lt;/dependency&gt;<br>    &lt;/dependencies&gt;<br></code></pre></td></tr></table></figure><p>yml</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java">server:<br>  port: <span class="hljs-number">8802</span><br><br>spring:<br>  application:<br>    name: cloud-stream-consumer<br>  cloud:<br>    stream:<br>      binders: # 在此处配置要绑定的rabbitmq的服务信息；<br>        defaultRabbit: # 表示定义的名称，用于于binding整合<br>          type: rabbit # 消息组件类型<br>          environment: # 设置rabbitmq的相关的环境配置<br>            spring:<br>              rabbitmq:<br>                host: hadoop202<br>                port: <span class="hljs-number">5672</span><br>                username: admin<br>                password: <span class="hljs-number">123</span><br>      bindings: # 服务的整合处理<br>        input: # 这个名字是一个通道的名称<br>          destination: studyExchange # 表示要使用的Exchange名称定义<br>          content-type: application/json # 设置消息类型，本次为对象json，如果是文本则设置“text/plain”<br>          binder: defaultRabbit # 设置要绑定的消息服务的具体设置<br><br>eureka:<br>  client: # 客户端进行Eureka注册的配置<br>    service-url:<br>      defaultZone: http:<span class="hljs-comment">//localhost:7001/eureka</span><br>  instance:<br>    lease-renewal-interval-in-seconds: <span class="hljs-number">2</span> # 设置心跳的时间间隔（默认是<span class="hljs-number">30</span>秒）<br>    lease-expiration-duration-in-seconds: <span class="hljs-number">5</span> # 如果现在超过了<span class="hljs-number">5</span>秒的间隔（默认是<span class="hljs-number">90</span>秒）<br>    instance-id: receive-<span class="hljs-number">8802.</span>com  # 在信息列表时显示主机名称<br>    prefer-ip-address: <span class="hljs-literal">true</span>     # 访问的路径变为IP地址<br></code></pre></td></tr></table></figure><p>controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.springcloud.controller;<br><br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Value;<br><span class="hljs-keyword">import</span> org.springframework.cloud.stream.annotation.EnableBinding;<br><span class="hljs-keyword">import</span> org.springframework.cloud.stream.annotation.StreamListener;<br><span class="hljs-keyword">import</span> org.springframework.cloud.stream.messaging.Sink;<br><span class="hljs-keyword">import</span> org.springframework.messaging.Message;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@EnableBinding(Sink.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReceiveMessageListener</span> &#123;<br>    <span class="hljs-meta">@Value(&quot;server.port&quot;)</span><br>    <span class="hljs-keyword">private</span> String serverPort;<br><br>    <span class="hljs-meta">@StreamListener(Sink.INPUT)</span> <span class="hljs-comment">// 监听接收消息</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">input</span><span class="hljs-params">(Message&lt;String&gt; message)</span> &#123;<br>        log.info(<span class="hljs-string">&quot;消费者1号 message: &#123;&#125;&quot;</span>, message.getPayload());<br>        log.info(<span class="hljs-string">&quot;消费者1号 port: &#123;&#125;&quot;</span>, serverPort);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>入口函数</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.springcloud;<br><br><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<br><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StreamMQMain8802</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(StreamMQMain8802.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>GET localhost:8801&#x2F;sendMessage</p><p>8801发送消息, 8802就能接收消息</p><p><img src="/assets/cd7122fd5274479b93f2cf181255ab1f.png"></p><p><img src="/assets/ce4d6c923a354943acd2086656925056.png"></p><h2 id="分组消费"><a href="#分组消费" class="headerlink" title="分组消费"></a>分组消费</h2><p>仿造*<code>cloud-stream-rabbitmq-consumer8802</code><em>相同的模块</em><code>cloud-stream-rabbitmq-consumer8803</code>*</p><p>可以看见当8801发送了一条消息, 8802和8803都会接收到这个消息, 如果是在订单模块的话, 同样的订单被处理了两次,这显然不是我们想要的</p><p><img src="/assets/3479807a18954ac4a908fa5f95605c50.png"></p><p><img src="/assets/b6a93bba0d3641768f6a2c6c66c8c26b.png"></p><p><img src="/assets/6114e6833fcb404fb0732761b9457e81.png"></p><p><img src="/assets/fa89385b23c9444f86dcf5bb47b7b09a.png"></p><p>8802和8803的队列名称不一样, 需要把这两个归为同一个组</p><p>给8802和8803的yml添加group配置, group的值需要保持一致</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java">server:<br>  port: <span class="hljs-number">8802</span><br><br>spring:<br>  application:<br>    name: cloud-stream-consumer<br>  cloud:<br>    stream:<br>      binders: # 在此处配置要绑定的rabbitmq的服务信息；<br>        defaultRabbit: # 表示定义的名称，用于于binding整合<br>          type: rabbit # 消息组件类型<br>          environment: # 设置rabbitmq的相关的环境配置<br>            spring:<br>              rabbitmq:<br>                host: hadoop202<br>                port: <span class="hljs-number">5672</span><br>                username: admin<br>                password: <span class="hljs-number">123</span><br>      bindings: # 服务的整合处理<br>        input: # 这个名字是一个通道的名称<br>          destination: studyExchange # 表示要使用的Exchange名称定义<br>          content-type: application/json # 设置消息类型，本次为对象json，如果是文本则设置“text/plain”<br>          binder: defaultRabbit # 设置要绑定的消息服务的具体设置<br>          group: atguiguA<br><br>eureka:<br>  client: # 客户端进行Eureka注册的配置<br>    service-url:<br>      defaultZone: http:<span class="hljs-comment">//localhost:7001/eureka</span><br>  instance:<br>    lease-renewal-interval-in-seconds: <span class="hljs-number">2</span> # 设置心跳的时间间隔（默认是<span class="hljs-number">30</span>秒）<br>    lease-expiration-duration-in-seconds: <span class="hljs-number">5</span> # 如果现在超过了<span class="hljs-number">5</span>秒的间隔（默认是<span class="hljs-number">90</span>秒）<br>    instance-id: receive-<span class="hljs-number">8802.</span>com  # 在信息列表时显示主机名称<br>    prefer-ip-address: <span class="hljs-literal">true</span>     # 访问的路径变为IP地址<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java">server:<br>  port: <span class="hljs-number">8803</span><br><br>spring:<br>  application:<br>    name: cloud-stream-consumer<br>  cloud:<br>    stream:<br>      binders: # 在此处配置要绑定的rabbitmq的服务信息；<br>        defaultRabbit: # 表示定义的名称，用于于binding整合<br>          type: rabbit # 消息组件类型<br>          environment: # 设置rabbitmq的相关的环境配置<br>            spring:<br>              rabbitmq:<br>                host: hadoop202<br>                port: <span class="hljs-number">5672</span><br>                username: admin<br>                password: <span class="hljs-number">123</span><br>      bindings: # 服务的整合处理<br>        input: # 这个名字是一个通道的名称，在分析具体源代码的时候会进行说明<br>          destination: studyExchange # 表示要使用的Exchange名称定义<br>          content-type: application/json # 设置消息类型，本次为对象json，如果是文本则设置“text/plain”<br>          binder: defaultRabbit # 设置要绑定的消息服务的具体设置<br>          group: atguiguA<br><br>eureka:<br>  client: # 客户端进行Eureka注册的配置<br>    service-url:<br>      defaultZone: http:<span class="hljs-comment">//localhost:7001/eureka</span><br>  instance:<br>    lease-renewal-interval-in-seconds: <span class="hljs-number">2</span> # 设置心跳的时间间隔（默认是<span class="hljs-number">30</span>秒）<br>    lease-expiration-duration-in-seconds: <span class="hljs-number">5</span> # 如果现在超过了<span class="hljs-number">5</span>秒的间隔（默认是<span class="hljs-number">90</span>秒）<br>    instance-id: receive-<span class="hljs-number">8803.</span>com  # 在信息列表时显示主机名称<br>    prefer-ip-address: <span class="hljs-literal">true</span>     # 访问的路径变为IP地址<br></code></pre></td></tr></table></figure><p>代码测试</p><p>8801发送了两次请求, 8802和8803都分别接收到了一次</p><p><img src="/assets/c91b58dade91408dbfc55d3fbf092480.png"></p><p><img src="/assets/d11fd0f8f74542558a5bdf4d992e8924.png"></p><p><img src="/assets/f3754e8f69934b91b5b36c120fdaad97.png"></p><h2 id="持久化"><a href="#持久化" class="headerlink" title="持久化"></a>持久化</h2><p>停止8802和8803服务</p><p>然后去除掉8802的group: atguiguA</p><p>保留8803的group: atguiguA</p><p>8801发送了4条消息, 先启动8802, 8802没有接收消息, 然后启动8803, 全部在8803接收到了</p><p>总结: <code>添加了group就自动支持了持久化</code></p><p><img src="/assets/b33882824b18434cab0965f35ba9a6a1.png"></p><p><img src="/assets/d7663fb60b79417c839fbc6dbe06e32a.png"></p><h2 id="Sleuth之zipkin搭建安装"><a href="#Sleuth之zipkin搭建安装" class="headerlink" title="Sleuth之zipkin搭建安装"></a>Sleuth之zipkin搭建安装</h2><p><a href="https://zipkin.io/pages/quickstart">https://zipkin.io/pages/quickstart</a></p><p>直接点击<a href="https://search.maven.org/remote_content?g=io.zipkin&a=zipkin-server&v=LATEST&c=exec">latest release</a>点击下载zipkin</p><p><img src="/assets/76c6fcfb71da43559c45f6bda0aa6379.png"></p><p>下载完成之后直接在控制台输入</p><p><code>java -jar zipkin-server-2.24.1-exec.jar</code></p><p>然后在浏览器中访问<a href="http://127.0.0.1:9411/zipkin/"><code>http://127.0.0.1:9411/zipkin/</code></a></p><p>这样就搭建完成了</p><h2 id="Nacos的下载"><a href="#Nacos的下载" class="headerlink" title="Nacos的下载"></a>Nacos的下载</h2><p><a href="https://github.com/alibaba/nacos">https://github.com/alibaba/nacos</a></p><p>Nacos &#x3D; Eureka + Config + Bus</p><p>下载完成之后解压, 直接使用命令<code>bin/startup.cmd</code>就可以运行</p><p><img src="/assets/9067682e797744fd868475481891dd3f.png"></p><p><img src="/assets/544482eb9cba4605857e2e92684c6a74.png"></p><p>运行完成之后浏览器输入<a href="http://localhost:8848/nacos">http://localhost:8848/nacos</a>进入控制台</p><p>用户名和密码都是nacos</p><h2 id="将服务注册到nacos"><a href="#将服务注册到nacos" class="headerlink" title="将服务注册到nacos"></a>将服务注册到nacos</h2><p>新建*<code>cloudalibaba-provider-payment9001</code>*模块</p><p>父POM</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependencyManagement&gt;<br>        &lt;dependencies&gt;<br>&lt;!--spring cloud alibaba <span class="hljs-number">2.1</span><span class="hljs-number">.0</span>.RELEASE--&gt;<br>            &lt;dependency&gt;<br>                &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;<br>                &lt;artifactId&gt;spring-cloud-alibaba-dependencies&lt;/artifactId&gt;<br>                &lt;version&gt;<span class="hljs-number">2.1</span><span class="hljs-number">.0</span>.RELEASE&lt;/version&gt;<br>                &lt;type&gt;pom&lt;/type&gt;<br>                &lt;scope&gt;<span class="hljs-keyword">import</span>&lt;/scope&gt;<br>            &lt;/dependency&gt;<br>&lt;/dependencies&gt;<br>    &lt;/dependencyManagement&gt;<br></code></pre></td></tr></table></figure><p>子pom</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependencies&gt;<br>        &lt;!--SpringCloud ailibaba nacos --&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;!-- SpringBoot整合Web组件 --&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;!--日常通用jar包配置--&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;<br>            &lt;scope&gt;runtime&lt;/scope&gt;<br>            &lt;optional&gt;<span class="hljs-literal">true</span>&lt;/optional&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;<br>            &lt;artifactId&gt;lombok&lt;/artifactId&gt;<br>            &lt;optional&gt;<span class="hljs-literal">true</span>&lt;/optional&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;<br>            &lt;scope&gt;test&lt;/scope&gt;<br>        &lt;/dependency&gt;<br>    &lt;/dependencies&gt;<br></code></pre></td></tr></table></figure><p>application.yml</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java">server:<br>  port: <span class="hljs-number">9001</span><br><br>spring:<br>  application:<br>    name: nacos-payment-provider<br>  cloud:<br>    nacos:<br>      discovery:<br>        server-addr: localhost:<span class="hljs-number">8848</span> #配置Nacos地址<br><br>management:<br>  endpoints:<br>    web:<br>      exposure:<br>        include: <span class="hljs-string">&#x27;*&#x27;</span><br></code></pre></td></tr></table></figure><p>controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PaymentController</span> &#123;<br>    <span class="hljs-meta">@Value(&quot;server.port&quot;)</span><br>    <span class="hljs-keyword">private</span> String serverPort;<br><br>    <span class="hljs-meta">@GetMapping(value = &quot;/payment/nacos/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getPayment</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span><br>    &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;nacos registry, serverPort: &quot;</span>+ serverPort+<span class="hljs-string">&quot;\t id&quot;</span>+id;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>入口函数</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@EnableDiscoveryClient</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PaymentMain9001</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(PaymentMain9001.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>代码测试GET localhost:9001&#x2F;payment&#x2F;nacos&#x2F;1</p><p><img src="/assets/3451455e487742d09d4af3035451fde1.png"></p><p>服务列表中出现了刚刚注册的微服务</p><p><img src="/assets/dbe5cc6204b34e58b48efc463b7543ed.png"></p><h2 id="Nacos的负载均衡"><a href="#Nacos的负载均衡" class="headerlink" title="Nacos的负载均衡"></a>Nacos的负载均衡</h2><p>与之对应的,创建出来*<code>cloudalibaba-provider-payment9002</code>*模块</p><p>再创建一个消费者<code>cloudalibaba-consumer-nacos-order83</code></p><p>pom</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-comment">&lt;!--SpringCloud ailibaba nacos --&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-comment">&lt;!--引入自己定义的api通用包，可以使用Payment支付Entity --&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.atguigu.springcloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>cloud-api-commons<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;project.version&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-comment">&lt;!-- SpringBoot整合Web组件--&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-comment">&lt;!--日常通用jar包配置--&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-devtools<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p>yml</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">server</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">port</span><span class="hljs-punctuation">:</span> <span class="hljs-string">83</span><br><br><span class="hljs-attribute">spring</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">application</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">nacos-order-consumer</span><br>  <span class="hljs-attribute">cloud</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">nacos</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-attribute">discovery</span><span class="hljs-punctuation">:</span><br>        <span class="hljs-attribute">server-addr</span><span class="hljs-punctuation">:</span> <span class="hljs-string">localhost:8848</span><br><br><span class="hljs-comment">#消费者将要去访问的微服务名称(注册成功进nacos的微服务提供者)</span><br><span class="hljs-attribute">service-url</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">nacos-user-service</span><span class="hljs-punctuation">:</span> <span class="hljs-string">http://nacos-payment-provider</span><br></code></pre></td></tr></table></figure><p>config</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span><br>public class ApplicationContextBean &#123;<br>    <span class="hljs-variable">@Bean</span><br>    <span class="hljs-variable">@LoadBalanced</span><br>    public RestTemplate <span class="hljs-built_in">getRestTemplate</span>() &#123;<br>        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">RestTemplate</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>controller</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderNacosController</span> &#123;<br><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> RestTemplate restTemplate;<br><br>    <span class="hljs-meta">@Value(<span class="hljs-string">&quot;service-url.nacos-user-service&quot;</span>)</span><br>    <span class="hljs-keyword">private</span> String serverURL;<br><br>    <span class="hljs-meta">@GetMapping(value = <span class="hljs-string">&quot;consumer/payment/nacos/&#123;id&#125;&quot;</span>)</span><br>    <span class="hljs-keyword">public</span> String getPayment(<span class="hljs-meta">@PathVariable(<span class="hljs-string">&quot;id&quot;</span>)</span> Integer id)<br>    &#123;<br>        <span class="hljs-keyword">return</span> restTemplate.getForObject(serverURL + <span class="hljs-string">&quot;/payment/nacos/&quot;</span> + id, String.<span class="hljs-keyword">class</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>入口函数</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@SpringBootApplication</span><br><span class="hljs-variable">@EnableDiscoveryClient</span><br>public class OrderNacosMain83 &#123;<br>    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">static</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">main</span>(String[] args) &#123;<br>        <span class="hljs-selector-tag">SpringApplication</span><span class="hljs-selector-class">.run</span>(OrderNacosMain83.class, args);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>nacos中的依赖自带了ribbon, 所以能够支持负载均衡</p><p><img src="/assets/b82aaeb09b06457ebabd2a4fa1049df7.png"></p><p>代码测试</p><p>GET localhost:83&#x2F;consumer&#x2F;payment&#x2F;nacos&#x2F;1</p><p>一次9001,一次9002, 负载均衡实现</p><p><img src="/assets/32d26c4c89b641b191f858df0d548729.png"></p><p><img src="/assets/7207f6eeea084c7f92029a99953c0f5b.png"></p><h2 id="Nacos的CP和AP的切换"><a href="#Nacos的CP和AP的切换" class="headerlink" title="Nacos的CP和AP的切换"></a>Nacos的CP和AP的切换</h2><p>Nacos默认是AP, 可以使用如下请求切换成CP</p><p>curl -X PUT ‘$NACOS_SERVER:8848&#x2F;nacos&#x2F;v1&#x2F;ns&#x2F;operator&#x2F;switches?entry&#x3D;serverMode&amp;value&#x3D;CP’</p><p><img src="/assets/788766d72e8446bf8d9f7f970eee0fb9.png"></p><h2 id="Nacos的配置中心"><a href="#Nacos的配置中心" class="headerlink" title="Nacos的配置中心"></a>Nacos的配置中心</h2><p>创建模块*<code>cloudalibaba-config-nacos-client3377</code>*</p><p>pom</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-comment">&lt;!--nacos-config--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--nacos-discovery--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--web + actuator--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--一般基础配置--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-devtools<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><p>bootstrap.yml</p><p>注意这个file-extension: yml#指定yaml格式的配置</p><p>这个yml跟nacos-config-client-dev.yml这个后缀名要保持一致</p><p>要么都叫yaml, 要么都叫yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># nacos配置</span><br><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">3377</span><br><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">nacos-config-client</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">nacos:</span><br>      <span class="hljs-attr">discovery:</span><br>        <span class="hljs-attr">server-addr:</span> <span class="hljs-string">localhost:8848#Nacos服务注册中心地址</span><br><span class="hljs-attr">config:</span><br>        <span class="hljs-attr">server-addr:</span> <span class="hljs-string">localhost:8848#Nacos作为配置中心地址</span><br><span class="hljs-attr">file-extension:</span> <span class="hljs-string">yml#指定yaml格式的配置</span><br><br><span class="hljs-comment"># $&#123;spring.application.name&#125;-$&#123;spring.profile.active&#125;.$&#123;spring.cloud.nacos.config.file-extension&#125;</span><br><span class="hljs-comment">#nacos-config-client-dev.yml</span><br></code></pre></td></tr></table></figure><p>application.yml</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">spring:</span><br><span class="hljs-symbol">  profiles:</span><br><span class="hljs-symbol">    active:</span> dev<span class="hljs-meta">#表示开发环境</span><br></code></pre></td></tr></table></figure><p>controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 开启自动刷新</span><br><span class="hljs-meta">@RefreshScope</span> <span class="hljs-comment">//在控制器类加入@RefreshScope注解使当前类下的配置支持Nacos的动态刷新功能。</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigClientController</span> &#123;<br>    <span class="hljs-meta">@Value(&quot;$&#123;config.info&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String configInfo;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/config/info&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getConfigInfo</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> configInfo;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>main</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@EnableDiscoveryClient</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NacosConfigClientMain3377</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(NacosConfigClientMain3377.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>创建好模块运行</p><p>在nacos的配置列表创建配置</p><p><img src="/assets/23734346be994adbace6a0a72a56e637.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">config:<br>    info: 富哥vivo50看看实力?<br></code></pre></td></tr></table></figure><p>代码测试</p><p>GET localhost:3377&#x2F;config&#x2F;info</p><p><img src="/assets/0d383f1b8ff74781865f6132d603312a.png"></p><p>以上这些代码是支持动态刷新的, 但是记得Controller头上要添加<code>@RefreshScope</code>注解才会开启自动刷新</p><h2 id="Nacos的DataID配置"><a href="#Nacos的DataID配置" class="headerlink" title="Nacos的DataID配置"></a>Nacos的DataID配置</h2><p>创建第二个配置文件<code>nacos-config-client-test.yml</code></p><p>配置了什么就是什么环境</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">config:<br>    info: 看看你的<br></code></pre></td></tr></table></figure><p><img src="/assets/a72146edc4e3464396f320a776d38e6c.png"></p><p>将3377的application.yml配置文件换成test</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">spring:</span><br><span class="hljs-symbol">  profiles:</span><br><span class="hljs-meta">#    active: dev #表示开发环境</span><br><span class="hljs-symbol">active:</span> test<span class="hljs-meta">#表示测试环境</span><br></code></pre></td></tr></table></figure><p>postman测试, 成功读取到了test环境的info</p><p><img src="/assets/e5e1c3b901f04160b682b8f2b0094a6e.png"></p><h2 id="Nacos的group分组方案"><a href="#Nacos的group分组方案" class="headerlink" title="Nacos的group分组方案"></a>Nacos的group分组方案</h2><p>创建两个group</p><p><code>nacos-config-client-info.yml</code>  <code>TEST_GROUP</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">config:<br>    info: nacos-config-client-info.yml TEST_GROUP<br></code></pre></td></tr></table></figure><p><code>nacos-config-client-info.yml</code>  <code>DEV_GROUP</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">config:<br>    info: nacos-config-client-info.yml DEV_GROUP<br></code></pre></td></tr></table></figure><p><img src="/assets/15cc8e6bc03a4002a04eb462e9d4d54d.png"></p><p>然后修改application.yml和bootstrap.yml</p><p>bootstrap.yml添加group</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"># nacos配置<br>server:<br>  port: <span class="hljs-number">3377</span><br><br>spring:<br>  application:<br>    name: nacos-config-client<br>  cloud:<br>    nacos:<br>      discovery:<br>        server-addr: localhost:<span class="hljs-number">8848</span> #Nacos服务注册中心地址<br>      config:<br>        server-addr: localhost:<span class="hljs-number">8848</span> #Nacos作为配置中心地址<br>        file-extension: yml #指定yaml格式的配置<br>        group: TEST_GROUP<br><br># $&#123;spring.application.name&#125;-$&#123;spring.profile.active&#125;.$&#123;spring.cloud.nacos.config.file-extension&#125;<br>#nacos-config-client-dev.yml<br></code></pre></td></tr></table></figure><p>application.yml切换active</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">spring:<br>  profiles:<br>#    active: dev # 表示开发环境<br>#    active: test # 表示测试环境<br>    active: info # 表示测试环境<br></code></pre></td></tr></table></figure><p>当处于DEV组的时候代码测试</p><p><img src="/assets/f8e0828308e84dd99f548560fb02b193.png"></p><p>当处于TEST组的时候代码测试</p><p><img src="/assets/c533cbb424cd4bcb8cdf3e8c819fa6b2.png"></p><h2 id="Nacos的命名空间namespace"><a href="#Nacos的命名空间namespace" class="headerlink" title="Nacos的命名空间namespace"></a>Nacos的命名空间namespace</h2><p>创建一个命名空间dev, 然后创建几个不同环境的配置文件</p><p><img src="/assets/6565f4cd27e0473f826d4e23a84f2ffb.png"></p><p><img src="/assets/050cb51cf55644c3aa825e8459945117.png"></p><p>bootstrap.yml</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"># nacos配置<br>server:<br>  port: <span class="hljs-number">3377</span><br><br>spring:<br>  application:<br>    name: nacos-config-client<br>  cloud:<br>    nacos:<br>      discovery:<br>        server-addr: localhost:<span class="hljs-number">8848</span> #Nacos服务注册中心地址<br>      config:<br>        server-addr: localhost:<span class="hljs-number">8848</span> #Nacos作为配置中心地址<br>        file-extension: yml #指定yaml格式的配置<br>        group: TEST_GROUP<br>        namespace: 80f0fdbc-e41a-4b42-8f0b-53b460d261d1<br><br># $&#123;spring.application.name&#125;-$&#123;spring.profile.active&#125;.$&#123;spring.cloud.nacos.config.file-extension&#125;<br>#nacos-config-client-dev.yml<br></code></pre></td></tr></table></figure><p>application.yml</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">spring:<br>  profiles:<br>    active: dev # 表示开发环境<br>#    active: test # 表示测试环境<br>#    active: info # 表示测试环境<br></code></pre></td></tr></table></figure><p>代码测试: </p><p><img src="/assets/8cfe8d3483c04479916f1e635e49905e.png"></p><h2 id="Nacos持久化切换配置"><a href="#Nacos持久化切换配置" class="headerlink" title="Nacos持久化切换配置"></a>Nacos持久化切换配置</h2><p>之前用的版本是1.1.4, 貌似不是很适配mysql8,所以我换了个版本</p><p><img src="/assets/2b2ef685f827493ebf55b9a7385a4f4f.png"></p><p>数据库中运行nacos-mysql.sql文件, 数据库创建名称是nacos</p><p><img src="/assets/e40a2807850e4bd0adb4ae710e98a261.png"></p><p>然后解开配置文件中的相关配置,让nacos切换成mysql数据库</p><p><img src="/assets/a8ff0478ffdb43a1a8fd6e6e19771c88.png"></p><p>由于1.4.5的启动方式是默认用的集群模式启动的</p><p>此时我们为了简单,可以直接先用单机模式(单机启动)启动一下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">./startup.cmd -m standalone<br></code></pre></td></tr></table></figure><p>启动完成登录进入,随便创建一个配置文件, 到数据库查看, 发现创建出来文件成功的保存到了数据库中</p><p><img src="/assets/46c3dddc45774eb0b20866964395d4b2.png"></p><p>此时的持久化操作配置就完成了</p><h2 id="搭建Nacos集群环境"><a href="#搭建Nacos集群环境" class="headerlink" title="搭建Nacos集群环境"></a>搭建Nacos集群环境</h2><p>我的linux用的是mysql5.7版本,所以这懒得切换了直接用的是1.1.4版本</p><p><a href="https://github.com/alibaba/nacos/releases/tag/1.4.5">https://github.com/alibaba/nacos/releases/tag</a></p><p>下载nacos</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ wget https://github.com/alibaba/nacos/releases/download/2.2.2/nacos-server-1.1.4.tar.gz<br></code></pre></td></tr></table></figure><p>解压</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ tar -zxvf nacos-server-1.1.4.tar.gz -C /opt/module/<br>$ <span class="hljs-built_in">cd</span> /opt/module/nacos/conf<br></code></pre></td></tr></table></figure><p>进入mysql,导入nacos的配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ mysql -uroot -p<br>mysql&gt; create database nacos;<br>mysql&gt; use nacos;<br><span class="hljs-comment"># 这个命令要在/opt/module/nacos/conf目录下进入的mysql才能直接执行</span><br><span class="hljs-comment"># source /opt/module/nacos/conf/nacos-mysql.sql 否则要写全路径</span><br>mysql&gt; <span class="hljs-built_in">source</span> nacos-mysql.sql<br><span class="hljs-comment"># 查看导入的SQL文件</span><br>mysql&gt; show tables;<br><span class="hljs-comment"># 退出mysql</span><br>mysql&gt; <span class="hljs-built_in">exit</span><br></code></pre></td></tr></table></figure><p>修改application.properties</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ vim application.properties<br><br><span class="hljs-comment">#*************** Config Module Related Configurations ***************#</span><br><span class="hljs-comment">### If use MySQL as datasource:</span><br>spring.datasource.platform=mysql<br><br><span class="hljs-comment">### Count of DB:</span><br>db.num=1<br><br><span class="hljs-comment">### Connect URL of DB:</span><br>db.url.0=jdbc:mysql://127.0.0.1:3306/nacos?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=<span class="hljs-literal">true</span>&amp;useUnicode=<span class="hljs-literal">true</span>&amp;useSSL=<span class="hljs-literal">false</span>&amp;serverTimezone=UTC<br>db.user.0=root<br>db.password.0=123456<br></code></pre></td></tr></table></figure><p>配置cluster</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cp</span> cluster.conf.example cluster.conf<br>$ hostname -i<br>192.168.1.202<br><span class="hljs-comment"># 记下这个IP, 配置这个IP</span><br>$ vim cluster.conf<br><br><span class="hljs-comment">#it is ip</span><br><span class="hljs-comment">#example</span><br><span class="hljs-comment">#192.168.16.101:8847</span><br><span class="hljs-comment">#192.168.16.102</span><br><span class="hljs-comment">#192.168.16.103</span><br>192.168.1.202:3333<br>192.168.1.202:4444<br>192.168.1.202:5555<br></code></pre></td></tr></table></figure><p>修改启动脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">57 <span class="hljs-keyword">while</span> <span class="hljs-built_in">getopts</span> <span class="hljs-string">&quot;:m:f:s:p:&quot;</span> opt<br>58 <span class="hljs-keyword">do</span><br>59     <span class="hljs-keyword">case</span> <span class="hljs-variable">$opt</span> <span class="hljs-keyword">in</span><br>60         m)<br>61             MODE=<span class="hljs-variable">$OPTARG</span>;;<br>62         f)<br>63             FUNCTION_MODE=<span class="hljs-variable">$OPTARG</span>;;<br>64         s)<br>65             SERVER=<span class="hljs-variable">$OPTARG</span>;;<br>66         p)<br>67             PORT=<span class="hljs-variable">$OPTARG</span>;;<br>68         ?)<br>69         <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Unknown parameter&quot;</span><br>70         <span class="hljs-built_in">exit</span> 1;;<br>71     <span class="hljs-keyword">esac</span><br>72 <span class="hljs-keyword">done</span><br>...<br>134 <span class="hljs-built_in">nohup</span> <span class="hljs-variable">$JAVA</span> -Dserver.port=<span class="hljs-variable">$&#123;PORT&#125;</span> <span class="hljs-variable">$&#123;JAVA_OPT&#125;</span> nacos.nacos &gt;&gt; <span class="hljs-variable">$&#123;BASE_DIR&#125;</span>/logs/start.out 2&gt;&amp;1 &amp;<br><br></code></pre></td></tr></table></figure><p><img src="/assets/57cb59fd2c224d8fae5d28c926b159cf.png"></p><p><img src="/assets/de0301a517904c77a27fde5623da353b.png"></p><p>启动集群</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ /opt/module/nacos/bin/startup.sh -p 3333<br>$ /opt/module/nacos/bin/startup.sh -p 4444<br>$ /opt/module/nacos/bin/startup.sh -p 5555<br>$ ps -ef | grep nacos | grep -v grep | <span class="hljs-built_in">wc</span> -l<br>3<br><span class="hljs-comment"># 此时说明启动了三台nacos</span><br></code></pre></td></tr></table></figure><p>配置nginx</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">pwd</span><br>/opt/module/nginx/conf<br>$ vim nginx.conf<br><br>http &#123;<br>upstream cluster &#123;<br>        server 127.0.0.1:3333;<br>        server 127.0.0.1:4444;<br>        server 127.0.0.1:5555;<br>    &#125;<br><br>    server &#123;<br>        listen       1111;<br>        server_name  localhost;<br><br>        location / &#123;<br>            <span class="hljs-comment">#root   html;</span><br>            <span class="hljs-comment">#index  index.html index.htm;</span><br>            proxy_pass http://cluster;<br>        &#125;<br>&#125;<br>&#125;<br><br>$ sudo systemctl stop nginx<br>$ sudo systemctl start nginx<br></code></pre></td></tr></table></figure><p>之后浏览器访问<a href="http://192.168.1.202:1111/nacos">http://192.168.1.202:1111/nacos</a></p><p><img src="/assets/354ee4d1350f4c6b89b40058dd10b5f2.png"></p><p>说明集群配置成功</p><p>将*<code>cloudalibaba-provider-payment9001</code>* 微服务注册注册到nacos</p><p>修改yml,换成nginx的地址</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">server:<br>  port: 9001<br><br>spring:<br>  application:<br>    name: nacos-payment-provider<br>  cloud:<br>    nacos:<br>      discovery:<br><span class="hljs-comment">#        server-addr: localhost:8848 #配置Nacos地址</span><br>        server-addr: 192.168.1.202:1111 <span class="hljs-comment"># 换成nginx的1111端口，做集群</span><br><br>management:<br>  endpoints:<br>    web:<br>      exposure:<br>        include: <span class="hljs-string">&#x27;*&#x27;</span><br></code></pre></td></tr></table></figure><p>可以看见服务列表中出现了刚刚注册进去的微服务</p><p><img src="/assets/e70faf95c80a4d09afcda332575562d0.png"></p><p>总结</p><p><img src="/assets/75d378be9b834ce787b40fc14afa8ed1.png"></p><h2 id="下载Sentinel"><a href="#下载Sentinel" class="headerlink" title="下载Sentinel"></a>下载Sentinel</h2><p>下载地址: <a href="https://github.com/alibaba/Sentinel/releases/tag/1.7.0">https://github.com/alibaba/Sentinel/releases/tag/1.7.0</a></p><p>下载之后直接使用命令运行<code>java -jar .\sentinel-dashboard-1.7.0.jar</code></p><p>浏览器访问<a href="http://localhost:8080/">http://localhost:8080/</a></p><p>账号密码都是sentinel</p><h2 id="初始化监控"><a href="#初始化监控" class="headerlink" title="初始化监控"></a>初始化监控</h2><p>创建*<code>cloudalibaba-sentinel-service8401</code>*模块</p><p>pom</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;dependencies&gt;<br>        &lt;!--SpringCloud ailibaba nacos --&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;!--SpringCloud ailibaba sentinel-datasource-nacos 后续做持久化用到--&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;com.alibaba.csp&lt;/groupId&gt;<br>            &lt;artifactId&gt;sentinel-datasource-nacos&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;!--SpringCloud ailibaba sentinel --&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-cloud-starter-alibaba-sentinel&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;!--openfeign--&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;!-- SpringBoot整合Web组件+actuator --&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;!--日常通用jar包配置--&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;<br>            &lt;scope&gt;runtime&lt;/scope&gt;<br>            &lt;optional&gt;<span class="hljs-literal">true</span>&lt;/optional&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;cn.hutool&lt;/groupId&gt;<br>            &lt;artifactId&gt;hutool-all&lt;/artifactId&gt;<br>            &lt;version&gt;4.6.3&lt;/version&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;<br>            &lt;artifactId&gt;lombok&lt;/artifactId&gt;<br>            &lt;optional&gt;<span class="hljs-literal">true</span>&lt;/optional&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;<br>            &lt;scope&gt;<span class="hljs-built_in">test</span>&lt;/scope&gt;<br>        &lt;/dependency&gt;<br><br>    &lt;/dependencies&gt;<br></code></pre></td></tr></table></figure><p>yml</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">server:<br>  port: 8401<br><br>spring:<br>  application:<br>    name: cloudalibaba-sentinel-service<br>  cloud:<br>    nacos:<br>      discovery:<br>        <span class="hljs-comment">#Nacos服务注册中心地址</span><br>        server-addr: localhost:8848<br>    sentinel:<br>      transport:<br>        <span class="hljs-comment">#配置Sentinel dashboard地址</span><br>        dashboard: localhost:8080<br>        <span class="hljs-comment">#默认8719端口，假如被占用会自动从8719开始依次+1扫描,直至找到未被占用的端口</span><br>        port: 8719<br><br>management:<br>  endpoints:<br>    web:<br>      exposure:<br>        include: <span class="hljs-string">&#x27;*&#x27;</span><br></code></pre></td></tr></table></figure><p>Controller</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">package com.atguigu.springcloud.alibaba.controller;<br><br>import org.springframework.web.bind.annotation.GetMapping;<br>import org.springframework.web.bind.annotation.RestController;<br><br>@RestController<br>public class FlowLimitController &#123;<br>    @GetMapping(<span class="hljs-string">&quot;/testA&quot;</span>)<br>    public String <span class="hljs-function"><span class="hljs-title">testA</span></span>()<br>    &#123;<br>        <span class="hljs-built_in">return</span> <span class="hljs-string">&quot;------testA&quot;</span>;<br>    &#125;<br><br>    @GetMapping(<span class="hljs-string">&quot;/testB&quot;</span>)<br>    public String <span class="hljs-function"><span class="hljs-title">testB</span></span>()<br>    &#123;<br>        <span class="hljs-built_in">return</span> <span class="hljs-string">&quot;------testB&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>入口函数</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">@EnableDiscoveryClient<br>@SpringBootApplication<br>public class MainApp8401 &#123;<br>    public static void main(String[] args) &#123;<br>        SpringApplication.run(MainApp8401.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>记得先要启动nacos把服务注册上去,同时也要启动sentinel在后台挂着</p><p><img src="/assets/aad0dad2b9f941bf887c6da6596f4c1d.png"></p><h2 id="流控-QPS直接失败"><a href="#流控-QPS直接失败" class="headerlink" title="流控 - QPS直接失败"></a>流控 - QPS直接失败</h2><p>对A进行流控</p><p><img src="/assets/369d6a62d37045a198e9ff8d6e5929f3.png"></p><p>单机阈值设置成1, 表示一秒只能请求一次,多了就会限流</p><p>QPS的意思是: 每秒钟的请求数量</p><p><img src="/assets/732e7b1320e84922a4a9cb2162530e96.png"></p><p>限流就会提示Blocked by Sentinel (flow limiting)</p><p><img src="/assets/290125dc7561483ab6a0f4753c0f92d6.png"></p><h2 id="流控-线程数直接失败"><a href="#流控-线程数直接失败" class="headerlink" title="流控 - 线程数直接失败"></a>流控 - 线程数直接失败</h2><p>配置流控规则线程数规则,单机阈值为1</p><p><img src="/assets/f03996ade0ef4d0b87f380795da4c41a.png"></p><p>然后修改Controller业务代码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">@RestController<br>public class FlowLimitController &#123;<br>    @GetMapping(<span class="hljs-string">&quot;/testA&quot;</span>)<br>    public String <span class="hljs-function"><span class="hljs-title">testA</span></span>()<br>    &#123;<br>        try &#123;<br>            Thread.<span class="hljs-built_in">sleep</span>(2000);<br>        &#125; catch (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-built_in">return</span> <span class="hljs-string">&quot;------testA&quot;</span>;<br>    &#125;<br><br>    @GetMapping(<span class="hljs-string">&quot;/testB&quot;</span>)<br>    public String <span class="hljs-function"><span class="hljs-title">testB</span></span>()<br>    &#123;<br>        <span class="hljs-built_in">return</span> <span class="hljs-string">&quot;------testB&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>让请求testA睡上两秒,来了一堆,请求, 但是实际处理线程的数量只有一个</p><p>第一个来了的可以立马处理, 第二个第三个.…后面来得请求就不能得到立刻处理, 所以被限流</p><p><img src="/assets/49ae0c5ea83d41e4a10edf796239e66e.png"></p><p><img src="/assets/153091d92dd74200855f3464728ed4d3.png"></p><p><img src="/assets/f3e0a778a2f740f2ac829ad02dc408c4.png"></p><h2 id="流控-关联"><a href="#流控-关联" class="headerlink" title="流控 -关联"></a>流控 -关联</h2><p>有点像连坐</p><p>当B犯事了, A也就被限流了</p><p><img src="/assets/d499ac3c3f0f46dba87334c5ad79eadc.png"></p><p>修改业务类Controller</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">@RestController<br>public class FlowLimitController &#123;<br>    @GetMapping(<span class="hljs-string">&quot;/testA&quot;</span>)<br>    public String <span class="hljs-function"><span class="hljs-title">testA</span></span>()<br>    &#123;<br>        <span class="hljs-built_in">return</span> <span class="hljs-string">&quot;------testA&quot;</span>;<br>    &#125;<br><br>    @GetMapping(<span class="hljs-string">&quot;/testB&quot;</span>)<br>    public String <span class="hljs-function"><span class="hljs-title">testB</span></span>()<br>    &#123;<br>        <span class="hljs-built_in">return</span> <span class="hljs-string">&quot;------testB&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>使用postman进行测试</p><p>循环2000次请求, 间隔1毫秒</p><p><img src="/assets/c16a0456c06b440480790ebfe4068d56.png"></p><p>然后切换到testA给A发送请求, 此时的B已经被限流了 </p><p>由于这个限流规则是关联的, 所以A也被限流了</p><p><img src="/assets/479e605dcdc04fa5ba1914a1c3c70a9a.png"></p><h2 id="流控-预热效果"><a href="#流控-预热效果" class="headerlink" title="流控 - 预热效果"></a>流控 - 预热效果</h2><p><img src="/assets/addd63b4ea164d8dae7c4230f443f87e.png"></p><p>对着浏览器狂点, 前5秒的阈值是10&#x2F;3&#x3D;3, 五秒之后的阈值就慢慢的预热到了10</p><blockquote><p>默认 coldFactor 为 3，即请求QPS从(threshold &#x2F; 3) 开始，经多少预热时长才逐渐升至设定的 QPS 阈值。</p></blockquote><blockquote><p>案例，阀值为10+预热时长设置5秒。<br>系统初始化的阀值为10 &#x2F; 3 约等于3,即阀值刚开始为3；然后过了5秒后阀值才慢慢升高恢复到10</p></blockquote><p><img src="/assets/3d231a0680a6414185352ee9fe62a8be.png"></p><h2 id="流控-排队等待"><a href="#流控-排队等待" class="headerlink" title="流控 - 排队等待"></a>流控 - 排队等待</h2><p>配置如下流控规则, 单机阈值是1, 每次只能处理一个请求, 多了的请求就在后面排队等待</p><p>等待的时间超过了20秒, 就会超时</p><p><img src="/assets/772b7468548343d4b87156fbd31b7dde.png"></p><p>模拟并发请求</p><p><img src="/assets/6dae7ef917174ebcb9f27d9f197c8467.png"></p><p>可以发现testB控制每一秒处理一个请求</p><p><img src="/assets/d93e0d316db04247a3914b4c0f9db2ab.png"></p><h2 id="降级-RT"><a href="#降级-RT" class="headerlink" title="降级-RT"></a>降级-RT</h2><p><img src="/assets/be1af08861bc4ecdb82003c3b4c23432.png"></p><p><img src="/assets/9215bfc6ea3c46febcd4208db733f9a7.png"></p><p>配置降级规则</p><p><img src="/assets/ce0abcb21fd84c6abf31e63e19fad679.png"></p><p>在200毫秒内的响应时间没有响应, 断路器将会在未来的1秒内打开(保险丝跳闸),微服务就不可用了</p><p>使用postman发送多个请求,间隔0毫秒</p><p><img src="/assets/bd1067493d5e4903ae7629a2ea9558c6.png"></p><p>由于testD的请求是1秒中才处理完一个请求, 1秒钟比200毫秒的阈值要大, 所以会被降级</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">@GetMapping(<span class="hljs-string">&quot;/testD&quot;</span>)<br>    public String <span class="hljs-function"><span class="hljs-title">testD</span></span>()<br>    &#123;<br>        //暂停几秒钟线程<br>        try &#123; TimeUnit.SECONDS.<span class="hljs-built_in">sleep</span>(1); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125;<br>        log.info(<span class="hljs-string">&quot;testD 测试RT&quot;</span>);<br>        <span class="hljs-built_in">return</span> <span class="hljs-string">&quot;------testD&quot;</span>;<br>    &#125;<br></code></pre></td></tr></table></figure><p><img src="/assets/00667b845c2e4ef3b14097882093d7dc.png"></p><h2 id="降级-异常比例"><a href="#降级-异常比例" class="headerlink" title="降级 - 异常比例"></a>降级 - 异常比例</h2><p>Controller</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs typescript">    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">&quot;/testD&quot;</span>)<br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">testD</span>(<span class="hljs-params"></span>)<br>    &#123;<br><span class="hljs-comment">//暂停几秒钟线程</span><br><span class="hljs-comment">//        try &#123; TimeUnit.SECONDS.sleep(1); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125;</span><br><span class="hljs-comment">//        log.info(&quot;testD测试RT&quot;);</span><br>int a = <span class="hljs-number">1</span>/<span class="hljs-number">0</span>;<br>log.<span class="hljs-title function_">info</span>(<span class="hljs-string">&quot;testD 测试异常比例&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;------testD&quot;</span>;<br>    &#125;<br></code></pre></td></tr></table></figure><p><img src="/assets/0848cbad7ec444c4bdc47b20a8a7e639.png"></p><p>代码测试</p><p>发送大量请求,每一次请求都会触发一个异常 , 每秒的请求的数量大于了5,并且异常的比例大于了20%,这必然会触发降级</p><p><img src="/assets/a39b16c17a3f4374a8d50b610a04625e.png"></p><p><img src="/assets/7e43e63422794a74934d004f8e1d42b8.png"></p><p>当stop大量请求之后 , 服务降级就恢复了</p><p><img src="/assets/0af99369fa674727b9a298bb1a38ca8c.png"></p><h2 id="降级-异常数"><a href="#降级-异常数" class="headerlink" title="降级 - 异常数"></a>降级 - 异常数</h2><p>Controller</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">&quot;/testE&quot;</span>)<br><span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">testE</span>(<span class="hljs-params"></span>)<br>&#123;<br>log.<span class="hljs-title function_">info</span>(<span class="hljs-string">&quot;testE 测试异常比例&quot;</span>);<br>    int age = <span class="hljs-number">10</span>/<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;------testE 测试异常比例&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>配置降级规则</p><p><img src="/assets/3f20f8321c194bd39c93c74ab7a91a1e.png"></p><p><img src="/assets/0c24dbccc37d43efa2e283a0161c99f8.png"></p><blockquote><p>时间窗口期一定要大于等于60秒</p></blockquote><p>代码测试, 连续点击send发送五次请求, 就会触发熔断降级, 因为每一次请求都是会触发异常的</p><p><img src="/assets/1aa1028d30e2400085f40e4135d85c1c.png"></p><h2 id="热点Key"><a href="#热点Key" class="headerlink" title="热点Key"></a>热点Key</h2><p>热点规则</p><p>注意资源名配置的应该是testHotKey, 而不是&#x2F;testHotKey, 跟sentinel的<code>SentinelResource</code>的value保持一致</p><p>参数索引表示是第0个参数(下面Controller中的参数p1), 单机阈值表示QPS每秒请求的数量是1,请求多了就会在1秒的窗口时间降级处理</p><p><img src="/assets/de852d5fea39411e97b5466ae6a0263e.png"></p><p>Controller</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">@GetMapping(<span class="hljs-string">&quot;/testHotKey&quot;</span>)<br>    @SentinelResource(value = <span class="hljs-string">&quot;testHotKey&quot;</span>, blockHandler = <span class="hljs-string">&quot;dealHandler_testHotKey&quot;</span>)<br>    public String testHotKey(@RequestParam(value = <span class="hljs-string">&quot;p1&quot;</span>, required = <span class="hljs-literal">false</span>) String p1,<br>                             @RequestParam(value = <span class="hljs-string">&quot;p2&quot;</span>, required = <span class="hljs-literal">false</span>) String p2) &#123;<br>        <span class="hljs-built_in">return</span> <span class="hljs-string">&quot;------testHotKey&quot;</span>;<br>    &#125;<br><br>    public String dealHandler_testHotKey(String p1, String p2, BlockException exception) &#123;<br>        <span class="hljs-built_in">return</span> <span class="hljs-string">&quot;-----dealHandler_testHotKey&quot;</span>;<br>    &#125;<br></code></pre></td></tr></table></figure><p>代码测试: </p><p>localhost:8401&#x2F;testHotKey?p1&#x3D;1             限流</p><p><a href="http://localhost:8401/testHotKey?p1=1&p2=1">localhost:8401&#x2F;testHotKey?p1&#x3D;1&amp;p2&#x3D;1</a>  限流</p><p><a href="http://localhost:8401/testHotKey?p2=1">localhost:8401&#x2F;testHotKey?p2&#x3D;1</a>             不限流</p><p>狂点send,当QPS超过秒就马上被限流</p><p><img src="/assets/a030d658e0f749598f545f6941cf9e20.png"></p><p>修改热点规则</p><p><img src="/assets/0fd69c86bd5a4166a2ae7d15c5e2433e.png"></p><p>当参数值等于p1&#x3D;5的时候,限流的阈值就不再是1了,而是两百</p><p>瞎点send也是—–testHotKey</p><p><img src="/assets/968c629ada1149a586933a5ceb713cf8.png"></p><h2 id="SentinelResource配置"><a href="#SentinelResource配置" class="headerlink" title="SentinelResource配置"></a>SentinelResource配置</h2><p>在<code>cloudalibaba-sentinel-service8401</code>模块</p><p>pom添加common</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;dependency&gt;&lt;!-- 引入自己定义的api通用包，可以使用Payment支付Entity --&gt;<br>            &lt;groupId&gt;com.atguigu.springcloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt;<br>            &lt;version&gt;<span class="hljs-variable">$&#123;project.version&#125;</span>&lt;/version&gt;<br>        &lt;/dependency&gt;<br></code></pre></td></tr></table></figure><p>编写一个新的Controller</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">@RestController<br>public class RateLimitController<br>&#123;<br>    @GetMapping(<span class="hljs-string">&quot;/byResource&quot;</span>)<br>    @SentinelResource(value = <span class="hljs-string">&quot;byResource&quot;</span>,blockHandler = <span class="hljs-string">&quot;handleException&quot;</span>)<br>    public CommonResult <span class="hljs-function"><span class="hljs-title">byResource</span></span>()<br>    &#123;<br>        <span class="hljs-built_in">return</span> new CommonResult(200,<span class="hljs-string">&quot;按资源名称限流测试OK&quot;</span>,new Payment(2020L,<span class="hljs-string">&quot;serial001&quot;</span>));<br>    &#125;<br>    public CommonResult handleException(BlockException exception)<br>    &#123;<br>        <span class="hljs-built_in">return</span> new CommonResult(444,exception.getClass().getCanonicalName()+<span class="hljs-string">&quot;\t 服务不可用&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>添加流控规则</p><p>资源名可以写请求的mapping,也可以填写Sentinel的value</p><p><img src="/assets/f68d24f642274c33aae7046b6f4c3541.png"></p><p><img src="/assets/8e4be2e9c3be400d86dc45ca39bbaed8.png"></p><p><img src="/assets/2fdf7cee94704a208ac16d70f296c3a6.png"></p><p>同样的可以按照url进行限流</p><p>编写Controller</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">@GetMapping(<span class="hljs-string">&quot;/rateLimit/byUrl&quot;</span>)<br>    @SentinelResource(value = <span class="hljs-string">&quot;byUrl&quot;</span>)<br>    public CommonResult <span class="hljs-function"><span class="hljs-title">byUrl</span></span>()<br>    &#123;<br>        <span class="hljs-built_in">return</span> new CommonResult(200,<span class="hljs-string">&quot;按url限流测试OK&quot;</span>,new Payment(2020L,<span class="hljs-string">&quot;serial002&quot;</span>));<br>    &#125;<br></code></pre></td></tr></table></figure><p>添加配置</p><p><img src="/assets/93c46e9f7741404cbc55e5a8ac39ffb9.png"></p><p>代码测试, 同样可以达到限流的效果</p><p><img src="/assets/043ce6a258b145bc8ce1d55a59241e90.png"></p><h2 id="客户自定义限流处理逻辑"><a href="#客户自定义限流处理逻辑" class="headerlink" title="客户自定义限流处理逻辑"></a>客户自定义限流处理逻辑</h2><p>编写handler</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">public class CustomerBlockHandler &#123;<br>    public static CommonResult handleException(BlockException exception)&#123;<br>        <span class="hljs-built_in">return</span> new CommonResult(4444,<span class="hljs-string">&quot;自定义的限流处理信息......CustomerBlockHandler&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>编写Controller</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">/**<br>     * 自定义通用的限流处理逻辑，<br>     blockHandlerClass = CustomerBlockHandler.class<br>     blockHandler = handleException2<br>     上述配置：找CustomerBlockHandler类里的handleException2方法进行兜底处理<br>     */<br>    /**<br>     * 自定义通用的限流处理逻辑<br>     */<br>    @GetMapping(<span class="hljs-string">&quot;/rateLimit/customerBlockHandler&quot;</span>)<br>    @SentinelResource(value = <span class="hljs-string">&quot;customerBlockHandler&quot;</span>,<br>            blockHandlerClass = CustomerBlockHandler.class,<br>            blockHandler = <span class="hljs-string">&quot;handleException&quot;</span>)<br>    public CommonResult <span class="hljs-function"><span class="hljs-title">customerBlockHandler</span></span>()<br>    &#123;<br>        <span class="hljs-built_in">return</span> new CommonResult(200,<span class="hljs-string">&quot;按客户自定义限流处理逻辑&quot;</span>);<br>    &#125;<br></code></pre></td></tr></table></figure><p>添加配置</p><p><img src="/assets/9981cad05aca4baeaf52163fc85e41a9.png"></p><p><img src="/assets/347910b255014f4da005660c2f93d7b0.png"></p><p>代码测试: </p><p><img src="/assets/15e113254758405a9988fb31f8ab122c.png"></p><p>当每秒请求的数量大于1了, 通过<code>@SentinelResource</code>注解中的<code>blockHandlerClass</code>属性指定将由哪一个类来处理异常, <code>blockHandler</code> 指定哪一个类的哪一个方法</p><p>这样做的好处就是可以将业务代码和自定义的处理方法进行解构, 而不会混在一起,还可以实现全局统一的处理异常</p><h2 id="服务熔断-Ribbon"><a href="#服务熔断-Ribbon" class="headerlink" title="服务熔断-Ribbon"></a>服务熔断-Ribbon</h2><p>创建<code>cloudalibaba-provider-payment9003``cloudalibaba-provider-payment9004</code>模块</p><p>pom</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;dependencies&gt;<br>        &lt;!--SpringCloud ailibaba nacos --&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;&lt;!-- 引入自己定义的api通用包，可以使用Payment支付Entity --&gt;<br>            &lt;groupId&gt;com.atguigu.springcloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt;<br>            &lt;version&gt;<span class="hljs-variable">$&#123;project.version&#125;</span>&lt;/version&gt;<br>        &lt;/dependency&gt;<br>        &lt;!-- SpringBoot整合Web组件 --&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;!--日常通用jar包配置--&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;<br>            &lt;scope&gt;runtime&lt;/scope&gt;<br>            &lt;optional&gt;<span class="hljs-literal">true</span>&lt;/optional&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;<br>            &lt;artifactId&gt;lombok&lt;/artifactId&gt;<br>            &lt;optional&gt;<span class="hljs-literal">true</span>&lt;/optional&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;<br>            &lt;scope&gt;<span class="hljs-built_in">test</span>&lt;/scope&gt;<br>        &lt;/dependency&gt;<br>    &lt;/dependencies&gt;<br></code></pre></td></tr></table></figure><p>yml</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">server:<br>  port: 9003<br><br>spring:<br>  application:<br>    name: nacos-payment-provider<br>  cloud:<br>    nacos:<br>      discovery:<br>        server-addr: localhost:8848 <span class="hljs-comment">#配置Nacos地址</span><br><br>management:<br>  endpoints:<br>    web:<br>      exposure:<br>        include: <span class="hljs-string">&#x27;*&#x27;</span><br></code></pre></td></tr></table></figure><p>controller</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">@RestController<br>public class PaymentController &#123;<br>    @Value(<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;server.port&#125;</span>&quot;</span>)<br>    private String serverPort;<br><br>    public static HashMap&lt;Long, Payment&gt; hashMap = new HashMap&lt;&gt;();<br>    static<br>    &#123;<br>        hashMap.put(1L,new Payment(1L,<span class="hljs-string">&quot;28a8c1e3bc2742d8848569891fb42181&quot;</span>));<br>        hashMap.put(2L,new Payment(2L,<span class="hljs-string">&quot;bba8c1e3bc2742d8848569891ac32182&quot;</span>));<br>        hashMap.put(3L,new Payment(3L,<span class="hljs-string">&quot;6ua8c1e3bc2742d8848569891xt92183&quot;</span>));<br>    &#125;<br><br>    @GetMapping(value = <span class="hljs-string">&quot;/paymentSQL/&#123;id&#125;&quot;</span>)<br>    public CommonResult&lt;Payment&gt; paymentSQL(@PathVariable(<span class="hljs-string">&quot;id&quot;</span>) Long <span class="hljs-built_in">id</span>)<br>    &#123;<br>        Payment payment = hashMap.get(<span class="hljs-built_in">id</span>);<br>        CommonResult&lt;Payment&gt; result = new CommonResult(200,<span class="hljs-string">&quot;from mysql,serverPort:  &quot;</span>+serverPort,payment);<br>        <span class="hljs-built_in">return</span> result;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>入口函数</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">@SpringBootApplication<br>@EnableDiscoveryClient<br>public class PaymentMain9003 &#123;<br>    public static void main(String[] args) &#123;<br>        SpringApplication.run(PaymentMain9003.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>然后创建<code>cloudalibaba-consumer-nacos-order84</code>模块</p><p>pom</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;dependencies&gt;<br>        &lt;!--SpringCloud ailibaba nacos --&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;!--SpringCloud ailibaba sentinel --&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-cloud-starter-alibaba-sentinel&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;!-- 引入自己定义的api通用包，可以使用Payment支付Entity --&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;com.atguigu.springcloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt;<br>            &lt;version&gt;<span class="hljs-variable">$&#123;project.version&#125;</span>&lt;/version&gt;<br>        &lt;/dependency&gt;<br>        &lt;!-- SpringBoot整合Web组件 --&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br>        &lt;!--日常通用jar包配置--&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;<br>            &lt;scope&gt;runtime&lt;/scope&gt;<br>            &lt;optional&gt;<span class="hljs-literal">true</span>&lt;/optional&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;<br>            &lt;artifactId&gt;lombok&lt;/artifactId&gt;<br>            &lt;optional&gt;<span class="hljs-literal">true</span>&lt;/optional&gt;<br>        &lt;/dependency&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;<br>            &lt;scope&gt;<span class="hljs-built_in">test</span>&lt;/scope&gt;<br>        &lt;/dependency&gt;<br>    &lt;/dependencies&gt;<br></code></pre></td></tr></table></figure><p>yml</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java">server:<br>  port: <span class="hljs-number">84</span><br><br>spring:<br>  application:<br>    name: nacos-order-consumer<br>  cloud:<br>    nacos:<br>      discovery:<br>        server-addr: localhost:<span class="hljs-number">8848</span><br>    sentinel:<br>      transport:<br>        #配置Sentinel dashboard地址<br>        dashboard: localhost:<span class="hljs-number">8080</span><br>        #默认<span class="hljs-number">8719</span>端口，假如被占用会自动从<span class="hljs-number">8719</span>开始依次+<span class="hljs-number">1</span>扫描,直至找到未被占用的端口<br>        port: <span class="hljs-number">8719</span><br><br>#消费者将要去访问的微服务名称(注册成功进nacos的微服务提供者)<br>service-url:<br>  nacos-user-service: http:<span class="hljs-comment">//nacos-payment-provider</span><br></code></pre></td></tr></table></figure><p>config</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApplicationContextConfig</span> &#123;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@LoadBalanced</span><br>    <span class="hljs-keyword">public</span> RestTemplate <span class="hljs-title function_">getRestTemplate</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestTemplate</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CircleBreakerController</span><br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">SERVICE_URL</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;http://nacos-payment-provider&quot;</span>;<br><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> RestTemplate restTemplate;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/consumer/fallback/&#123;id&#125;&quot;)</span><br>    <span class="hljs-meta">@SentinelResource(value = &quot;fallback&quot;)</span><br><br>    <span class="hljs-keyword">public</span> CommonResult&lt;Payment&gt; <span class="hljs-title function_">fallback</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span><br>    &#123;<br>        CommonResult&lt;Payment&gt; result = restTemplate.getForObject(SERVICE_URL + <span class="hljs-string">&quot;/paymentSQL/&quot;</span>+id, CommonResult.class,id);<br><br>        <span class="hljs-keyword">if</span> (id == <span class="hljs-number">4</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span> (<span class="hljs-string">&quot;IllegalArgumentException,非法参数异常....&quot;</span>);<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (result.getData() == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span> (<span class="hljs-string">&quot;NullPointerException,该ID没有对应记录,空指针异常&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>入口函数</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableDiscoveryClient</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderNacosMain84</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(OrderNacosMain84.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>请求1正常</p><p><img src="/assets/d779000bf422412e954f645e1ed2b2f7.png"></p><p>请求4显示非法参数异常</p><p><img src="/assets/5422b6f09a2b4206a933c8efe07cd2c0.png"></p><p>请求5显示空指针异常</p><p><img src="/assets/6348b69f159b4b659d77dfdcd6a75bb9.png"></p><p>可以发现当出现Error的时候, 出现的提示信息有点太多了,不够友好</p><h2 id="Sentinel服务熔断只配置fallback"><a href="#Sentinel服务熔断只配置fallback" class="headerlink" title="Sentinel服务熔断只配置fallback"></a>Sentinel服务熔断只配置fallback</h2><p>修改controller为</p><p>在CommonResult方法上给<code>@SentinelResource</code>注解添加fallback</p><p>当方法内部出现了异常, 就会去执行指定的fallback</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CircleBreakerController</span><br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">SERVICE_URL</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;http://nacos-payment-provider&quot;</span>;<br><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> RestTemplate restTemplate;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/consumer/fallback/&#123;id&#125;&quot;)</span><br><span class="hljs-comment">//    @SentinelResource(value = &quot;fallback&quot;)</span><br>    <span class="hljs-meta">@SentinelResource(value = &quot;fallback&quot;,fallback = &quot;handlerFallback&quot;)</span> <span class="hljs-comment">//fallback负责业务异常</span><br>    <span class="hljs-keyword">public</span> CommonResult&lt;Payment&gt; <span class="hljs-title function_">fallback</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span><br>    &#123;<br>        CommonResult&lt;Payment&gt; result = restTemplate.getForObject(SERVICE_URL + <span class="hljs-string">&quot;/paymentSQL/&quot;</span>+id, CommonResult.class,id);<br><br>        <span class="hljs-keyword">if</span> (id == <span class="hljs-number">4</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span> (<span class="hljs-string">&quot;IllegalArgumentException,非法参数异常....&quot;</span>);<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (result.getData() == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span> (<span class="hljs-string">&quot;NullPointerException,该ID没有对应记录,空指针异常&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> CommonResult <span class="hljs-title function_">handlerFallback</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span>  Long id,Throwable e)</span> &#123;<br>        <span class="hljs-type">Payment</span> <span class="hljs-variable">payment</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Payment</span>(id,<span class="hljs-string">&quot;null&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CommonResult</span>&lt;&gt;(<span class="hljs-number">444</span>,<span class="hljs-string">&quot;兜底异常handlerFallback,exception内容  &quot;</span>+e.getMessage(),payment);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>代码测试, 这样的错误信息看起来比之前的更为友好一些</p><p><img src="/assets/dce08b263a0b4127a5862fdced7fd76a.png"></p><p><img src="/assets/501e42515b4b4646b8d490c5f6c5638b.png"></p><h2 id="Sentinel服务熔断只配置blockHandler"><a href="#Sentinel服务熔断只配置blockHandler" class="headerlink" title="Sentinel服务熔断只配置blockHandler"></a>Sentinel服务熔断只配置blockHandler</h2><p>修改controller</p><p>配置<code>@SentinelResource</code>注解拥有<code>blockHandler</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CircleBreakerController</span><br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">SERVICE_URL</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;http://nacos-payment-provider&quot;</span>;<br><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> RestTemplate restTemplate;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/consumer/fallback/&#123;id&#125;&quot;)</span><br><span class="hljs-comment">//    @SentinelResource(value = &quot;fallback&quot;)</span><br><span class="hljs-comment">//    @SentinelResource(value = &quot;fallback&quot;,fallback = &quot;handlerFallback&quot;) //fallback负责业务异常</span><br>    <span class="hljs-meta">@SentinelResource(value = &quot;fallback&quot;,blockHandler = &quot;blockHandler&quot;)</span> <span class="hljs-comment">//blockHandler负责在sentinel里面配置的降级限流</span><br>    <span class="hljs-keyword">public</span> CommonResult&lt;Payment&gt; <span class="hljs-title function_">fallback</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span><br>    &#123;<br>        CommonResult&lt;Payment&gt; result = restTemplate.getForObject(SERVICE_URL + <span class="hljs-string">&quot;/paymentSQL/&quot;</span>+id, CommonResult.class,id);<br><br>        <span class="hljs-keyword">if</span> (id == <span class="hljs-number">4</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span> (<span class="hljs-string">&quot;IllegalArgumentException,非法参数异常....&quot;</span>);<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (result.getData() == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span> (<span class="hljs-string">&quot;NullPointerException,该ID没有对应记录,空指针异常&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> CommonResult <span class="hljs-title function_">handlerFallback</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span>  Long id,Throwable e)</span> &#123;<br>        <span class="hljs-type">Payment</span> <span class="hljs-variable">payment</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Payment</span>(id,<span class="hljs-string">&quot;null&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CommonResult</span>&lt;&gt;(<span class="hljs-number">444</span>,<span class="hljs-string">&quot;兜底异常handlerFallback,exception内容  &quot;</span>+e.getMessage(),payment);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> CommonResult <span class="hljs-title function_">blockHandler</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span>  Long id, BlockException blockException)</span> &#123;<br>        <span class="hljs-type">Payment</span> <span class="hljs-variable">payment</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Payment</span>(id,<span class="hljs-string">&quot;null&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CommonResult</span>&lt;&gt;(<span class="hljs-number">445</span>,<span class="hljs-string">&quot;blockHandler-sentinel限流,无此流水: blockException  &quot;</span>+blockException.getMessage(),payment);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>配置Sentinel降级</p><p><img src="/assets/c3dd98bed9064072846ea072cbedbf9d.png"></p><p>狂点发送异常请求, 此时请求异常数过大进入熔断降级</p><p><img src="/assets/64837979cb584dfe9e524281acd0ef5d.png"></p><p>未进入降级状态, 显示Java运行的异常</p><p><img src="/assets/ccdb48b872e54782aab3d041a26773c8.png"></p><h2 id="Sentinel服务熔断fallback和blockHandler都配置"><a href="#Sentinel服务熔断fallback和blockHandler都配置" class="headerlink" title="Sentinel服务熔断fallback和blockHandler都配置"></a>Sentinel服务熔断fallback和blockHandler都配置</h2><p>修改controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CircleBreakerController</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">SERVICE_URL</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;http://nacos-payment-provider&quot;</span>;<br><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> RestTemplate restTemplate;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/consumer/fallback/&#123;id&#125;&quot;)</span><br>    <span class="hljs-comment">//@SentinelResource(value = &quot;fallback&quot;)</span><br>    <span class="hljs-comment">//@SentinelResource(value = &quot;fallback&quot;,fallback = &quot;handlerFallback&quot;) //fallback负责业务异常</span><br><span class="hljs-comment">//    @SentinelResource(value = &quot;fallback&quot;,blockHandler = &quot;blockHandler&quot;) //blockHandler负责在sentinel里面配置的降级限流</span><br>    <span class="hljs-meta">@SentinelResource(value = &quot;fallback&quot;, fallback = &quot;handlerFallback&quot;, blockHandler = &quot;blockHandler&quot;)</span><br>    <span class="hljs-keyword">public</span> CommonResult&lt;Payment&gt; <span class="hljs-title function_">fallback</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> &#123;<br>        <span class="hljs-type">CommonResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> restTemplate.getForObject(SERVICE_URL + <span class="hljs-string">&quot;/paymentSQL/&quot;</span> + id, CommonResult.class, id);<br><br>        <span class="hljs-keyword">if</span> (id == <span class="hljs-number">4</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;IllegalArgumentException,非法参数异常....&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (result.getData() == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>(<span class="hljs-string">&quot;NullPointerException,该ID没有对应记录,空指针异常&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> CommonResult <span class="hljs-title function_">handlerFallback</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span>  Long id,Throwable e)</span> &#123;<br>        <span class="hljs-type">Payment</span> <span class="hljs-variable">payment</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Payment</span>(id,<span class="hljs-string">&quot;null&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CommonResult</span>&lt;&gt;(<span class="hljs-number">444</span>,<span class="hljs-string">&quot;fallback,无此流水,exception  &quot;</span>+e.getMessage(),payment);<br>    &#125;<br>    <span class="hljs-keyword">public</span> CommonResult <span class="hljs-title function_">blockHandler</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span>  Long id,BlockException blockException)</span> &#123;<br>        <span class="hljs-type">Payment</span> <span class="hljs-variable">payment</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Payment</span>(id,<span class="hljs-string">&quot;null&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CommonResult</span>&lt;&gt;(<span class="hljs-number">445</span>,<span class="hljs-string">&quot;blockHandler-sentinel限流,无此流水: blockException  &quot;</span>+blockException.getMessage(),payment);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>添加限流规则</p><p><img src="/assets/aff1b2e3074a47349cc5124cd4e3fc4e.png"></p><p>请求4, 会出现Java运行异常</p><p><img src="/assets/ecbaa0b129554029a70ca0b3de45d34f.png"></p><p>多次请求则被限流控制</p><p><img src="/assets/a1bb5f5834a14f2bb7c2f4fb6beffb3c.png"></p><p>同样的请求id为5也是一样的</p><p><img src="/assets/a14a10711d1f427dbaf74d790757bc45.png"></p><p>多次请求</p><p><img src="/assets/6a604fcc082c48829b03d161f95b665c.png"></p><p>如果同时配置了blockHandler和fallback </p><p>方法内部出现了异常则会走fallback 兜底方法 </p><p>请求多了达到了限流则会走blockHandler处理</p><h2 id="Sentinel服务熔断exceptionsToIgnore"><a href="#Sentinel服务熔断exceptionsToIgnore" class="headerlink" title="Sentinel服务熔断exceptionsToIgnore"></a>Sentinel服务熔断exceptionsToIgnore</h2><p>修改controller为</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SentinelResource(value = &quot;fallback&quot;,</span><br><span class="hljs-meta">            fallback = &quot;handlerFallback&quot;,</span><br><span class="hljs-meta">            blockHandler = &quot;blockHandler&quot;,</span><br><span class="hljs-meta">            exceptionsToIgnore = &#123;IllegalArgumentException.class&#125;)</span><br></code></pre></td></tr></table></figure><p>这个<code>exceptionsToIgnore</code> 的意思就是如果出现了<code>IllegalArgumentException</code>异常</p><p>就不会进入fallback兜底的方法, 没有服务降级的效果了</p><p>代码测试: </p><p><img src="/assets/8d1192547a524975b0c739547ed76d52.png"></p><h2 id="Sentinel服务熔断OpenFeign"><a href="#Sentinel服务熔断OpenFeign" class="headerlink" title="Sentinel服务熔断OpenFeign"></a>Sentinel服务熔断OpenFeign</h2><p>pom添加依赖</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;!--SpringCloud openfeign --&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br></code></pre></td></tr></table></figure><p>yml</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"># 激活Sentinel对Feign的支持<br>feign:<br>  sentinel:<br>    enabled: <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>编写service</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@FeignClient(value = &quot;nacos-payment-provider&quot;, fallback = PaymentFallbackService.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">PaymentService</span> &#123;<br>    <span class="hljs-meta">@GetMapping(value = &quot;/paymentSQL/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> CommonResult&lt;Payment&gt; <span class="hljs-title function_">paymentSQL</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PaymentFallbackService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PaymentService</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> CommonResult&lt;Payment&gt; <span class="hljs-title function_">paymentSQL</span><span class="hljs-params">(Long id)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CommonResult</span>&lt;&gt;(<span class="hljs-number">444</span>, <span class="hljs-string">&quot;服务降级返回,没有该流水信息&quot;</span>,<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">Payment</span>(id, <span class="hljs-string">&quot;errorSerial......&quot;</span>));<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//==================OpenFeign</span><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> PaymentService paymentService;<br><br>    <span class="hljs-meta">@GetMapping(value = &quot;/consumer/openfeign/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> CommonResult&lt;Payment&gt; <span class="hljs-title function_">paymentSQL</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Long id)</span><br>    &#123;<br>        <span class="hljs-keyword">if</span>(id == <span class="hljs-number">4</span>)<br>        &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;没有该id&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> paymentService.paymentSQL(id);<br>    &#125;<br></code></pre></td></tr></table></figure><p>代码测试: </p><p><img src="/assets/f425919f4afd43ccb4140025547d78d1.png"></p><p>然后关闭payment提供者微服务, 再次请求, 观察84微服务自动降级, 不会被耗死</p><p><img src="/assets/d082878f63dc44feb72ac186ffa01c37.png"></p><h2 id="规则持久化"><a href="#规则持久化" class="headerlink" title="规则持久化"></a>规则持久化</h2><p>修改<code>cloudalibaba-sentinel-service8401</code></p><p>pom</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;!--SpringCloud ailibaba sentinel-datasource-nacos --&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;com.alibaba.csp&lt;/groupId&gt;<br>            &lt;artifactId&gt;sentinel-datasource-nacos&lt;/artifactId&gt;<br>        &lt;/dependency&gt;<br></code></pre></td></tr></table></figure><p>yml</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java">server:<br>  port: <span class="hljs-number">8401</span><br><br>spring:<br>  application:<br>    name: cloudalibaba-sentinel-service<br>  cloud:<br>    nacos:<br>      discovery:<br>        #Nacos服务注册中心地址<br>        server-addr: localhost:<span class="hljs-number">8848</span><br>    sentinel:<br>      transport:<br>        #配置Sentinel dashboard地址<br>        dashboard: localhost:<span class="hljs-number">8080</span><br>        #默认<span class="hljs-number">8719</span>端口，假如被占用会自动从<span class="hljs-number">8719</span>开始依次+<span class="hljs-number">1</span>扫描,直至找到未被占用的端口<br>        port: <span class="hljs-number">8719</span><br>      datasource:<br>        ds1:<br>          nacos:<br>            server-addr: localhost:<span class="hljs-number">8848</span><br>            dataId: cloudalibaba-sentinel-service<br>            groupId: DEFAULT_GROUP<br>            data-type: json<br>            rule-type: flow<br><br>management:<br>  endpoints:<br>    web:<br>      exposure:<br>        include: <span class="hljs-string">&#x27;*&#x27;</span><br></code></pre></td></tr></table></figure><p>然后在nacos的配置列表添加配置</p><p>DataId <code>cloudalibaba-sentinel-service</code></p><p>内容配置</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java">[<br>    &#123;<br>        <span class="hljs-string">&quot;resource&quot;</span>: <span class="hljs-string">&quot;/rateLimit/byUrl&quot;</span>,<br>        <span class="hljs-string">&quot;limitApp&quot;</span>: <span class="hljs-string">&quot;default&quot;</span>,<br>        <span class="hljs-string">&quot;grade&quot;</span>: <span class="hljs-number">1</span>,<br>        <span class="hljs-string">&quot;count&quot;</span>: <span class="hljs-number">1</span>,<br>        <span class="hljs-string">&quot;strategy&quot;</span>: <span class="hljs-number">0</span>,<br>        <span class="hljs-string">&quot;controlBehavior&quot;</span>: <span class="hljs-number">0</span>,<br>        <span class="hljs-string">&quot;clusterMode&quot;</span>: <span class="hljs-literal">false</span><br>    &#125;<br>]<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">resource：资源名称；<br>limitApp：来源应用；<br>grade：阈值类型，<span class="hljs-number">0</span>表示线程数，<span class="hljs-number">1</span>表示QPS；<br>count：单机阈值；<br>strategy：流控模式，<span class="hljs-number">0</span>表示直接，<span class="hljs-number">1</span>表示关联，<span class="hljs-number">2</span>表示链路；<br>controlBehavior：流控效果，<span class="hljs-number">0</span>表示快速失败，<span class="hljs-number">1</span>表示Warm Up，<span class="hljs-number">2</span>表示排队等待；<br>clusterMode：是否集群。<br></code></pre></td></tr></table></figure><p><img src="/assets/64a6880b4d8c408c9d432be38c2f8ea0.png"></p><p>然后启动8401访问localhost:8401&#x2F;rateLimit&#x2F;byUrl</p><p><img src="/assets/186467fe1f20437bb39fcb7aef00a58c.png"></p><p>多次刷新, 说明流控配置起效了</p><p><img src="/assets/6bd67e60ab7f408ebb922ea82c7fdb52.png"></p><p>上Sentinel查看一下, 刚刚配置的json配置生效了, 这个流控规则是nacos读取json配置文件给我们加载进来的</p><p><img src="/assets/fa920c77b93745cbbf508d579ee5876f.png"></p><h2 id="Seata"><a href="#Seata" class="headerlink" title="Seata"></a>Seata</h2><p>这部分懒得做笔记了</p><p>核心注解<code>@GlobalTransactional</code></p><p>粘上一段核心代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">OrderService</span><br>&#123;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> OrderDao orderDao;<br><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> StorageService storageService;<br><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> AccountService accountService;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 创建订单-&gt;调用库存服务扣减库存-&gt;调用账户服务扣减账户余额-&gt;修改订单状态</span><br><span class="hljs-comment">     * 简单说：</span><br><span class="hljs-comment">     * 下订单-&gt;减库存-&gt;减余额-&gt;改状态</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-meta">@GlobalTransactional(name = &quot;fsp-create-order&quot;,rollbackFor = Exception.class)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">create</span><span class="hljs-params">(Order order)</span> &#123;<br>        log.info(<span class="hljs-string">&quot;-------&gt;下单开始&quot;</span>);<br>        <span class="hljs-comment">//本应用创建订单</span><br>        orderDao.create(order);<br><br>        <span class="hljs-comment">//远程调用库存服务扣减库存</span><br>        log.info(<span class="hljs-string">&quot;-------&gt;order-service中扣减库存开始&quot;</span>);<br>        storageService.decrease(order.getProductId(),order.getCount());<br>        log.info(<span class="hljs-string">&quot;-------&gt;order-service中扣减库存结束&quot;</span>);<br><br>        <span class="hljs-comment">//远程调用账户服务扣减余额</span><br>        log.info(<span class="hljs-string">&quot;-------&gt;order-service中扣减余额开始&quot;</span>);<br>        accountService.decrease(order.getUserId(),order.getMoney());<br>        log.info(<span class="hljs-string">&quot;-------&gt;order-service中扣减余额结束&quot;</span>);<br><br>        <span class="hljs-comment">//修改订单状态为已完成</span><br>        log.info(<span class="hljs-string">&quot;-------&gt;order-service中修改订单状态开始&quot;</span>);<br>        orderDao.update(order.getUserId(),<span class="hljs-number">0</span>);<br>        log.info(<span class="hljs-string">&quot;-------&gt;order-service中修改订单状态结束&quot;</span>);<br><br>        log.info(<span class="hljs-string">&quot;-------&gt;下单结束&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong><strong>Failed to fetch schema of <code>order</code>的解决办法</strong></strong></p><p>jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;orders</p><p>jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;orders?useInformationSchema&#x3D;false</p><p>给所有的微服务都添加上?useInformationSchema&#x3D;false, 然后重启</p><p>参考: </p><ul><li><a href="https://blog.csdn.net/L1Ha1Y1/article/details/108681489">https://blog.csdn.net/L1Ha1Y1/article/details/108681489</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>SpringCloud</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>git配置代理</title>
    <link href="/git/git%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%90%86/"/>
    <url>/git/git%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%90%86/</url>
    
    <content type="html"><![CDATA[<blockquote><p>前提是要知道7890端口是个啥</p></blockquote><p>因为使用git提交代码经常会超时, 所以可以通过配置代理的方式来解决</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">git config <span class="hljs-attr">--global</span> http<span class="hljs-selector-class">.proxy</span> socks5:<span class="hljs-comment">//127.0.0.1:7890</span><br>git config <span class="hljs-attr">--global</span> https<span class="hljs-selector-class">.proxy</span> socks5:<span class="hljs-comment">//127.0.0.1:7890</span><br></code></pre></td></tr></table></figure><p>取消代理</p><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs tcl"><span class="hljs-comment"># 取消代理</span><br>git config --<span class="hljs-keyword">global</span> --<span class="hljs-keyword">unset</span> <span class="hljs-keyword">http</span>.proxy<br><br>git config --<span class="hljs-keyword">global</span> --<span class="hljs-keyword">unset</span> https.proxy<br></code></pre></td></tr></table></figure><h4 id="参考"><a href="#参考" class="headerlink" title="参考:"></a>参考:</h4><ul><li>配置代理 <a href="https://gist.github.com/laispace/666dd7b27e9116faece6">https://gist.github.com/laispace/666dd7b27e9116faece6</a></li><li>取消代理 <a href="https://www.cnblogs.com/xueweihan/p/7242577.html">https://www.cnblogs.com/xueweihan/p/7242577.html</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>git</category>
      
    </categories>
    
    
    <tags>
      
      <tag>git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>word粘贴图片不全</title>
    <link href="/uncategorized/word%E7%B2%98%E8%B4%B4%E5%9B%BE%E7%89%87%E4%B8%8D%E5%85%A8/"/>
    <url>/uncategorized/word%E7%B2%98%E8%B4%B4%E5%9B%BE%E7%89%87%E4%B8%8D%E5%85%A8/</url>
    
    <content type="html"><![CDATA[<p>在某些word文档中直接按下Ctrl V, 会发现图片粘贴不全</p><p><img src="/assets/2023-05-23-15-36-35.png"></p><p>可以对着图片按Ctrl 1显示全</p><p>或者全选设置段落为<code>1.5倍行距</code>, 之后可以使用Ctrl V就可以显示完整的图片</p><p><img src="/assets/2023-05-23-15-55-48.png"></p>]]></content>
    
    
    
    <tags>
      
      <tag>word</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>美图</title>
    <link href="/%E6%A8%B1%E8%8A%B1/%E5%AD%A6%E6%A0%A1%E7%9A%84%E6%A8%B1%E8%8A%B1/"/>
    <url>/%E6%A8%B1%E8%8A%B1/%E5%AD%A6%E6%A0%A1%E7%9A%84%E6%A8%B1%E8%8A%B1/</url>
    
    <content type="html"><![CDATA[<p>搜集的一些樱花图片 <br><br><img src="https://cdn.xiamu.icu//images/dailyb90b43782f2d881e03bbb4408549b97735594837.jpg0.jpg" alt="b90b43782f2d881e03bbb4408549b97735594837.jpg0"><br><img src="https://cdn.xiamu.icu//images/dailyb90b43782f2d881e03bbb4408549b97735594837.jpg1.jpg" alt="b90b43782f2d881e03bbb4408549b97735594837.jpg1"><br><img src="https://cdn.xiamu.icu//images/dailyb90b43782f2d881e03bbb4408549b97735594837.jpg2.jpg" alt="b90b43782f2d881e03bbb4408549b97735594837.jpg2"><br><img src="https://cdn.xiamu.icu//images/dailyb90b43782f2d881e03bbb4408549b97735594837.jpg3.jpg" alt="b90b43782f2d881e03bbb4408549b97735594837.jpg3"></p>]]></content>
    
    
    <categories>
      
      <category>樱花</category>
      
    </categories>
    
    
    <tags>
      
      <tag>樱花</tag>
      
      <tag>校园</tag>
      
      <tag>美图</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>这么可爱真是抱歉</title>
    <link href="/%E5%8F%AF%E7%88%B1/%E8%BF%99%E4%B9%88%E5%8F%AF%E7%88%B1%E7%9C%9F%E6%98%AF%E6%8A%B1%E6%AD%89/"/>
    <url>/%E5%8F%AF%E7%88%B1/%E8%BF%99%E4%B9%88%E5%8F%AF%E7%88%B1%E7%9C%9F%E6%98%AF%E6%8A%B1%E6%AD%89/</url>
    
    <content type="html"><![CDATA[<h2 id="B站视频的嵌入"><a href="#B站视频的嵌入" class="headerlink" title="B站视频的嵌入"></a>B站视频的嵌入</h2><p>直接引入iframe嵌入, markdown是支持iframe标签的</p><p>通过设置width和height调整视频的大小</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf">&lt;iframe src<span class="hljs-operator">=</span><span class="hljs-string">&quot;//player.bilibili.com/player.html?aid=987809477&amp;bvid=BV1y44y1Q7uZ&amp;cid=895436270&amp;page=1&quot;</span> <br><span class="hljs-attribute">width</span><span class="hljs-operator">=</span><span class="hljs-string">&quot;100%&quot;</span> height<span class="hljs-operator">=</span><span class="hljs-string">&quot;500&quot;</span> scrolling<span class="hljs-operator">=</span><span class="hljs-string">&quot;no&quot;</span> border<span class="hljs-operator">=</span><span class="hljs-string">&quot;0&quot;</span> frameborder<span class="hljs-operator">=</span><span class="hljs-string">&quot;no&quot;</span> framespacing<span class="hljs-operator">=</span><span class="hljs-string">&quot;0&quot;</span> allowfullscreen<span class="hljs-operator">=</span><span class="hljs-string">&quot;true&quot;</span> allow<span class="hljs-operator">=</span><span class="hljs-string">&quot;autoplay&quot;</span>&gt; &lt;/iframe&gt;<br></code></pre></td></tr></table></figure><iframe src="//player.bilibili.com/player.html?aid=987809477&bvid=BV1y44y1Q7uZ&cid=895436270&page=1" width="100%" height="500" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" allow="autoplay"> </iframe>]]></content>
    
    
    <categories>
      
      <category>可爱</category>
      
    </categories>
    
    
    <tags>
      
      <tag>这么可爱真是抱歉</tag>
      
      <tag>可爱</tag>
      
      <tag>B站</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CSS樱花</title>
    <link href="/CSS/CSS%E6%A8%B1%E8%8A%B1/"/>
    <url>/CSS/CSS%E6%A8%B1%E8%8A%B1/</url>
    
    <content type="html"><![CDATA[<p>运行</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs axapta">npm install http-<span class="hljs-keyword">server</span> -g<br>http-<span class="hljs-keyword">server</span><br></code></pre></td></tr></table></figure><p>效果图:<br><img src="/assets/2023-05-19-12-21-15.png"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css">    <span class="hljs-selector-tag">body</span> &#123;</span><br><span class="language-css">      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;</span><br><span class="language-css">      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;</span><br><span class="language-css">      <span class="hljs-attribute">overflow</span>: hidden;</span><br><span class="language-css">      <span class="hljs-attribute">height</span>: <span class="hljs-number">600px</span>;</span><br><span class="language-css">    &#125;</span><br><span class="language-css"></span><br><span class="language-css">    <span class="hljs-selector-tag">canvas</span> &#123;</span><br><span class="language-css">      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;</span><br><span class="language-css">      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;</span><br><span class="language-css">    &#125;</span><br><span class="language-css"></span><br><span class="language-css">    <span class="hljs-selector-tag">div</span><span class="hljs-selector-class">.btnbg</span> &#123;</span><br><span class="language-css">      <span class="hljs-attribute">position</span>: fixed;</span><br><span class="language-css">      <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;</span><br><span class="language-css">      <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;</span><br><span class="language-css">    &#125;</span><br><span class="language-css">  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;sakura&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btnbg&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>  <span class="hljs-comment">&lt;!-- sakura shader --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;sakura_point_vsh&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;x-shader/x_vertex&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">uniform mat4 uProjection;</span><br><span class="language-javascript">uniform mat4 uModelview;</span><br><span class="language-javascript">uniform vec3 uResolution;</span><br><span class="language-javascript">uniform vec3 uOffset;</span><br><span class="language-javascript">uniform vec3 uDOF;  <span class="hljs-comment">//x:focus distance, y:focus radius, z:max radius</span></span><br><span class="language-javascript">uniform vec3 uFade; <span class="hljs-comment">//x:start distance, y:half distance, z:near fade start</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">attribute vec3 aPosition;</span><br><span class="language-javascript">attribute vec3 aEuler;</span><br><span class="language-javascript">attribute vec2 aMisc; <span class="hljs-comment">//x:size, y:fade</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">varying vec3 pposition;</span><br><span class="language-javascript">varying float psize;</span><br><span class="language-javascript">varying float palpha;</span><br><span class="language-javascript">varying float pdist;</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-comment">//varying mat3 rotMat;</span></span><br><span class="language-javascript">varying vec3 normX;</span><br><span class="language-javascript">varying vec3 normY;</span><br><span class="language-javascript">varying vec3 normZ;</span><br><span class="language-javascript">varying vec3 normal;</span><br><span class="language-javascript"></span><br><span class="language-javascript">varying float diffuse;</span><br><span class="language-javascript">varying float specular;</span><br><span class="language-javascript">varying float rstop;</span><br><span class="language-javascript">varying float distancefade;</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-keyword">void</span></span>) &#123;</span><br><span class="language-javascript">    <span class="hljs-comment">// Projection is based on vertical angle</span></span><br><span class="language-javascript">    vec4 pos = uModelview * <span class="hljs-title function_">vec4</span>(aPosition + uOffset, <span class="hljs-number">1.0</span>);</span><br><span class="language-javascript">    gl_Position = uProjection * pos;</span><br><span class="language-javascript">    gl_PointSize = aMisc.<span class="hljs-property">x</span> * uProjection[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] / -pos.<span class="hljs-property">z</span> * uResolution.<span class="hljs-property">y</span> * <span class="hljs-number">0.5</span>;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    pposition = pos.<span class="hljs-property">xyz</span>;</span><br><span class="language-javascript">    psize = aMisc.<span class="hljs-property">x</span>;</span><br><span class="language-javascript">    pdist = <span class="hljs-title function_">length</span>(pos.<span class="hljs-property">xyz</span>);</span><br><span class="language-javascript">    palpha = <span class="hljs-title function_">smoothstep</span>(<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>, (pdist - <span class="hljs-number">0.1</span>) / uFade.<span class="hljs-property">z</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">    vec3 elrsn = <span class="hljs-title function_">sin</span>(aEuler);</span><br><span class="language-javascript">    vec3 elrcs = <span class="hljs-title function_">cos</span>(aEuler);</span><br><span class="language-javascript">    mat3 rotx = <span class="hljs-title function_">mat3</span>(</span><br><span class="language-javascript">        <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>,</span><br><span class="language-javascript">        <span class="hljs-number">0.0</span>, elrcs.<span class="hljs-property">x</span>, elrsn.<span class="hljs-property">x</span>,</span><br><span class="language-javascript">        <span class="hljs-number">0.0</span>, -elrsn.<span class="hljs-property">x</span>, elrcs.<span class="hljs-property">x</span></span><br><span class="language-javascript">    );</span><br><span class="language-javascript">    mat3 roty = <span class="hljs-title function_">mat3</span>(</span><br><span class="language-javascript">        elrcs.<span class="hljs-property">y</span>, <span class="hljs-number">0.0</span>, -elrsn.<span class="hljs-property">y</span>,</span><br><span class="language-javascript">        <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>,</span><br><span class="language-javascript">        elrsn.<span class="hljs-property">y</span>, <span class="hljs-number">0.0</span>, elrcs.<span class="hljs-property">y</span></span><br><span class="language-javascript">    );</span><br><span class="language-javascript">    mat3 rotz = <span class="hljs-title function_">mat3</span>(</span><br><span class="language-javascript">        elrcs.<span class="hljs-property">z</span>, elrsn.<span class="hljs-property">z</span>, <span class="hljs-number">0.0</span>,</span><br><span class="language-javascript">        -elrsn.<span class="hljs-property">z</span>, elrcs.<span class="hljs-property">z</span>, <span class="hljs-number">0.0</span>,</span><br><span class="language-javascript">        <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span></span><br><span class="language-javascript">    );</span><br><span class="language-javascript">    mat3 rotmat = rotx * roty * rotz;</span><br><span class="language-javascript">    normal = rotmat[<span class="hljs-number">2</span>];</span><br><span class="language-javascript"></span><br><span class="language-javascript">    mat3 trrotm = <span class="hljs-title function_">mat3</span>(</span><br><span class="language-javascript">        rotmat[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>], rotmat[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>], rotmat[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>],</span><br><span class="language-javascript">        rotmat[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>], rotmat[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>], rotmat[<span class="hljs-number">2</span>][<span class="hljs-number">1</span>],</span><br><span class="language-javascript">        rotmat[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>], rotmat[<span class="hljs-number">1</span>][<span class="hljs-number">2</span>], rotmat[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>]</span><br><span class="language-javascript">    );</span><br><span class="language-javascript">    normX = trrotm[<span class="hljs-number">0</span>];</span><br><span class="language-javascript">    normY = trrotm[<span class="hljs-number">1</span>];</span><br><span class="language-javascript">    normZ = trrotm[<span class="hljs-number">2</span>];</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">const</span> vec3 lit = <span class="hljs-title function_">vec3</span>(<span class="hljs-number">0.6917144638660746</span>, <span class="hljs-number">0.6917144638660746</span>, -<span class="hljs-number">0.20751433915982237</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">    float tmpdfs = <span class="hljs-title function_">dot</span>(lit, normal);</span><br><span class="language-javascript">    <span class="hljs-keyword">if</span>(tmpdfs &lt; <span class="hljs-number">0.0</span>) &#123;</span><br><span class="language-javascript">        normal = -normal;</span><br><span class="language-javascript">        tmpdfs = <span class="hljs-title function_">dot</span>(lit, normal);</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript">    diffuse = <span class="hljs-number">0.4</span> + tmpdfs;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    vec3 eyev = <span class="hljs-title function_">normalize</span>(-pos.<span class="hljs-property">xyz</span>);</span><br><span class="language-javascript">    <span class="hljs-keyword">if</span>(<span class="hljs-title function_">dot</span>(eyev, normal) &gt; <span class="hljs-number">0.0</span>) &#123;</span><br><span class="language-javascript">        vec3 hv = <span class="hljs-title function_">normalize</span>(eyev + lit);</span><br><span class="language-javascript">        specular = <span class="hljs-title function_">pow</span>(<span class="hljs-title function_">max</span>(<span class="hljs-title function_">dot</span>(hv, normal), <span class="hljs-number">0.0</span>), <span class="hljs-number">20.0</span>);</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript">    <span class="hljs-keyword">else</span> &#123;</span><br><span class="language-javascript">        specular = <span class="hljs-number">0.0</span>;</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    rstop = <span class="hljs-title function_">clamp</span>((<span class="hljs-title function_">abs</span>(pdist - uDOF.<span class="hljs-property">x</span>) - uDOF.<span class="hljs-property">y</span>) / uDOF.<span class="hljs-property">z</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>);</span><br><span class="language-javascript">    rstop = <span class="hljs-title function_">pow</span>(rstop, <span class="hljs-number">0.5</span>);</span><br><span class="language-javascript">    <span class="hljs-comment">//-0.69315 = ln(0.5)</span></span><br><span class="language-javascript">    distancefade = <span class="hljs-title function_">min</span>(<span class="hljs-number">1.0</span>, <span class="hljs-title function_">exp</span>((uFade.<span class="hljs-property">x</span> - pdist) * <span class="hljs-number">0.69315</span> / uFade.<span class="hljs-property">y</span>));</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;sakura_point_fsh&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;x-shader/x_fragment&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">#ifdef <span class="hljs-variable constant_">GL_ES</span></span><br><span class="language-javascript"><span class="hljs-comment">//precision mediump float;</span></span><br><span class="language-javascript">precision highp float;</span><br><span class="language-javascript">#endif</span><br><span class="language-javascript"></span><br><span class="language-javascript">uniform vec3 uDOF;  <span class="hljs-comment">//x:focus distance, y:focus radius, z:max radius</span></span><br><span class="language-javascript">uniform vec3 uFade; <span class="hljs-comment">//x:start distance, y:half distance, z:near fade start</span></span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> vec3 fadeCol = <span class="hljs-title function_">vec3</span>(<span class="hljs-number">0.08</span>, <span class="hljs-number">0.03</span>, <span class="hljs-number">0.06</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">varying vec3 pposition;</span><br><span class="language-javascript">varying float psize;</span><br><span class="language-javascript">varying float palpha;</span><br><span class="language-javascript">varying float pdist;</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-comment">//varying mat3 rotMat;</span></span><br><span class="language-javascript">varying vec3 normX;</span><br><span class="language-javascript">varying vec3 normY;</span><br><span class="language-javascript">varying vec3 normZ;</span><br><span class="language-javascript">varying vec3 normal;</span><br><span class="language-javascript"></span><br><span class="language-javascript">varying float diffuse;</span><br><span class="language-javascript">varying float specular;</span><br><span class="language-javascript">varying float rstop;</span><br><span class="language-javascript">varying float distancefade;</span><br><span class="language-javascript"></span><br><span class="language-javascript">float <span class="hljs-title function_">ellipse</span>(<span class="hljs-params">vec2 p, vec2 o, vec2 r</span>) &#123;</span><br><span class="language-javascript">    vec2 lp = (p - o) / r;</span><br><span class="language-javascript">    <span class="hljs-keyword">return</span> <span class="hljs-title function_">length</span>(lp) - <span class="hljs-number">1.0</span>;</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-keyword">void</span></span>) &#123;</span><br><span class="language-javascript">    vec3 p = <span class="hljs-title function_">vec3</span>(gl_PointCoord - <span class="hljs-title function_">vec2</span>(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>), <span class="hljs-number">0.0</span>) * <span class="hljs-number">2.0</span>;</span><br><span class="language-javascript">    vec3 d = <span class="hljs-title function_">vec3</span>(<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, -<span class="hljs-number">1.0</span>);</span><br><span class="language-javascript">    float nd = normZ.<span class="hljs-property">z</span>; <span class="hljs-comment">//dot(-normZ, d);</span></span><br><span class="language-javascript">    <span class="hljs-keyword">if</span>(<span class="hljs-title function_">abs</span>(nd) &lt; <span class="hljs-number">0.0001</span>) discard;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    float np = <span class="hljs-title function_">dot</span>(normZ, p);</span><br><span class="language-javascript">    vec3 tp = p + d * np / nd;</span><br><span class="language-javascript">    vec2 coord = <span class="hljs-title function_">vec2</span>(<span class="hljs-title function_">dot</span>(normX, tp), <span class="hljs-title function_">dot</span>(normY, tp));</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-comment">//angle = 15 degree</span></span><br><span class="language-javascript">    <span class="hljs-keyword">const</span> float flwrsn = <span class="hljs-number">0.258819045102521</span>;</span><br><span class="language-javascript">    <span class="hljs-keyword">const</span> float flwrcs = <span class="hljs-number">0.965925826289068</span>;</span><br><span class="language-javascript">    mat2 flwrm = <span class="hljs-title function_">mat2</span>(flwrcs, -flwrsn, flwrsn, flwrcs);</span><br><span class="language-javascript">    vec2 flwrp = <span class="hljs-title function_">vec2</span>(<span class="hljs-title function_">abs</span>(coord.<span class="hljs-property">x</span>), coord.<span class="hljs-property">y</span>) * flwrm;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    float r;</span><br><span class="language-javascript">    <span class="hljs-keyword">if</span>(flwrp.<span class="hljs-property">x</span> &lt; <span class="hljs-number">0.0</span>) &#123;</span><br><span class="language-javascript">        r = <span class="hljs-title function_">ellipse</span>(flwrp, <span class="hljs-title function_">vec2</span>(<span class="hljs-number">0.065</span>, <span class="hljs-number">0.024</span>) * <span class="hljs-number">0.5</span>, <span class="hljs-title function_">vec2</span>(<span class="hljs-number">0.36</span>, <span class="hljs-number">0.96</span>) * <span class="hljs-number">0.5</span>);</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript">    <span class="hljs-keyword">else</span> &#123;</span><br><span class="language-javascript">        r = <span class="hljs-title function_">ellipse</span>(flwrp, <span class="hljs-title function_">vec2</span>(<span class="hljs-number">0.065</span>, <span class="hljs-number">0.024</span>) * <span class="hljs-number">0.5</span>, <span class="hljs-title function_">vec2</span>(<span class="hljs-number">0.58</span>, <span class="hljs-number">0.96</span>) * <span class="hljs-number">0.5</span>);</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">if</span>(r &gt; rstop) discard;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    vec3 col = <span class="hljs-title function_">mix</span>(<span class="hljs-title function_">vec3</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">0.8</span>, <span class="hljs-number">0.75</span>), <span class="hljs-title function_">vec3</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">0.9</span>, <span class="hljs-number">0.87</span>), r);</span><br><span class="language-javascript">    float grady = <span class="hljs-title function_">mix</span>(<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-title function_">pow</span>(coord.<span class="hljs-property">y</span> * <span class="hljs-number">0.5</span> + <span class="hljs-number">0.5</span>, <span class="hljs-number">0.35</span>));</span><br><span class="language-javascript">    col *= <span class="hljs-title function_">vec3</span>(<span class="hljs-number">1.0</span>, grady, grady);</span><br><span class="language-javascript">    col *= <span class="hljs-title function_">mix</span>(<span class="hljs-number">0.8</span>, <span class="hljs-number">1.0</span>, <span class="hljs-title function_">pow</span>(<span class="hljs-title function_">abs</span>(coord.<span class="hljs-property">x</span>), <span class="hljs-number">0.3</span>));</span><br><span class="language-javascript">    col = col * diffuse + specular;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    col = <span class="hljs-title function_">mix</span>(fadeCol, col, distancefade);</span><br><span class="language-javascript"></span><br><span class="language-javascript">    float alpha = (rstop &gt; <span class="hljs-number">0.001</span>)? (<span class="hljs-number">0.5</span> - r / (rstop * <span class="hljs-number">2.0</span>)) : <span class="hljs-number">1.0</span>;</span><br><span class="language-javascript">    alpha = <span class="hljs-title function_">smoothstep</span>(<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>, alpha) * palpha;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    gl_FragColor = <span class="hljs-title function_">vec4</span>(col * <span class="hljs-number">0.5</span>, alpha);</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-comment">&lt;!-- effects --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;fx_common_vsh&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;x-shader/x_vertex&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">uniform vec3 uResolution;</span><br><span class="language-javascript">attribute vec2 aPosition;</span><br><span class="language-javascript"></span><br><span class="language-javascript">varying vec2 texCoord;</span><br><span class="language-javascript">varying vec2 screenCoord;</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-keyword">void</span></span>) &#123;</span><br><span class="language-javascript">    gl_Position = <span class="hljs-title function_">vec4</span>(aPosition, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>);</span><br><span class="language-javascript">    texCoord = aPosition.<span class="hljs-property">xy</span> * <span class="hljs-number">0.5</span> + <span class="hljs-title function_">vec2</span>(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>);</span><br><span class="language-javascript">    screenCoord = aPosition.<span class="hljs-property">xy</span> * <span class="hljs-title function_">vec2</span>(uResolution.<span class="hljs-property">z</span>, <span class="hljs-number">1.0</span>);</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;bg_fsh&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;x-shader/x_fragment&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">#ifdef <span class="hljs-variable constant_">GL_ES</span></span><br><span class="language-javascript"><span class="hljs-comment">//precision mediump float;</span></span><br><span class="language-javascript">precision highp float;</span><br><span class="language-javascript">#endif</span><br><span class="language-javascript"></span><br><span class="language-javascript">uniform vec2 uTimes;</span><br><span class="language-javascript"></span><br><span class="language-javascript">varying vec2 texCoord;</span><br><span class="language-javascript">varying vec2 screenCoord;</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-keyword">void</span></span>) &#123;</span><br><span class="language-javascript">    vec3 col;</span><br><span class="language-javascript">    float c;</span><br><span class="language-javascript">    vec2 tmpv = texCoord * <span class="hljs-title function_">vec2</span>(<span class="hljs-number">0.8</span>, <span class="hljs-number">1.0</span>) - <span class="hljs-title function_">vec2</span>(<span class="hljs-number">0.95</span>, <span class="hljs-number">1.0</span>);</span><br><span class="language-javascript">    c = <span class="hljs-title function_">exp</span>(-<span class="hljs-title function_">pow</span>(<span class="hljs-title function_">length</span>(tmpv) * <span class="hljs-number">1.8</span>, <span class="hljs-number">2.0</span>));</span><br><span class="language-javascript">    col = <span class="hljs-title function_">mix</span>(<span class="hljs-title function_">vec3</span>(<span class="hljs-number">0.02</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.03</span>), <span class="hljs-title function_">vec3</span>(<span class="hljs-number">0.96</span>, <span class="hljs-number">0.98</span>, <span class="hljs-number">1.0</span>) * <span class="hljs-number">1.5</span>, c);</span><br><span class="language-javascript">    gl_FragColor = <span class="hljs-title function_">vec4</span>(col * <span class="hljs-number">0.5</span>, <span class="hljs-number">1.0</span>);</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;fx_brightbuf_fsh&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;x-shader/x_fragment&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">#ifdef <span class="hljs-variable constant_">GL_ES</span></span><br><span class="language-javascript"><span class="hljs-comment">//precision mediump float;</span></span><br><span class="language-javascript">precision highp float;</span><br><span class="language-javascript">#endif</span><br><span class="language-javascript">uniform sampler2D uSrc;</span><br><span class="language-javascript">uniform vec2 uDelta;</span><br><span class="language-javascript"></span><br><span class="language-javascript">varying vec2 texCoord;</span><br><span class="language-javascript">varying vec2 screenCoord;</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-keyword">void</span></span>) &#123;</span><br><span class="language-javascript">    vec4 col = <span class="hljs-title function_">texture2D</span>(uSrc, texCoord);</span><br><span class="language-javascript">    gl_FragColor = <span class="hljs-title function_">vec4</span>(col.<span class="hljs-property">rgb</span> * <span class="hljs-number">2.0</span> - <span class="hljs-title function_">vec3</span>(<span class="hljs-number">0.5</span>), <span class="hljs-number">1.0</span>);</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;fx_dirblur_r4_fsh&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;x-shader/x_fragment&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">#ifdef <span class="hljs-variable constant_">GL_ES</span></span><br><span class="language-javascript"><span class="hljs-comment">//precision mediump float;</span></span><br><span class="language-javascript">precision highp float;</span><br><span class="language-javascript">#endif</span><br><span class="language-javascript">uniform sampler2D uSrc;</span><br><span class="language-javascript">uniform vec2 uDelta;</span><br><span class="language-javascript">uniform vec4 uBlurDir; <span class="hljs-comment">//dir(x, y), stride(z, w)</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">varying vec2 texCoord;</span><br><span class="language-javascript">varying vec2 screenCoord;</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-keyword">void</span></span>) &#123;</span><br><span class="language-javascript">    vec4 col = <span class="hljs-title function_">texture2D</span>(uSrc, texCoord);</span><br><span class="language-javascript">    col = col + <span class="hljs-title function_">texture2D</span>(uSrc, texCoord + uBlurDir.<span class="hljs-property">xy</span> * uDelta);</span><br><span class="language-javascript">    col = col + <span class="hljs-title function_">texture2D</span>(uSrc, texCoord - uBlurDir.<span class="hljs-property">xy</span> * uDelta);</span><br><span class="language-javascript">    col = col + <span class="hljs-title function_">texture2D</span>(uSrc, texCoord + (uBlurDir.<span class="hljs-property">xy</span> + uBlurDir.<span class="hljs-property">zw</span>) * uDelta);</span><br><span class="language-javascript">    col = col + <span class="hljs-title function_">texture2D</span>(uSrc, texCoord - (uBlurDir.<span class="hljs-property">xy</span> + uBlurDir.<span class="hljs-property">zw</span>) * uDelta);</span><br><span class="language-javascript">    gl_FragColor = col / <span class="hljs-number">5.0</span>;</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-comment">&lt;!-- effect fragment shader template --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;fx_common_fsh&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;x-shader/x_fragment&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">#ifdef <span class="hljs-variable constant_">GL_ES</span></span><br><span class="language-javascript"><span class="hljs-comment">//precision mediump float;</span></span><br><span class="language-javascript">precision highp float;</span><br><span class="language-javascript">#endif</span><br><span class="language-javascript">uniform sampler2D uSrc;</span><br><span class="language-javascript">uniform vec2 uDelta;</span><br><span class="language-javascript"></span><br><span class="language-javascript">varying vec2 texCoord;</span><br><span class="language-javascript">varying vec2 screenCoord;</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-keyword">void</span></span>) &#123;</span><br><span class="language-javascript">    gl_FragColor = <span class="hljs-title function_">texture2D</span>(uSrc, texCoord);</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-comment">&lt;!-- post processing --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pp_final_vsh&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;x-shader/x_vertex&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">uniform vec3 uResolution;</span><br><span class="language-javascript">attribute vec2 aPosition;</span><br><span class="language-javascript">varying vec2 texCoord;</span><br><span class="language-javascript">varying vec2 screenCoord;</span><br><span class="language-javascript"><span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-keyword">void</span></span>) &#123;</span><br><span class="language-javascript">    gl_Position = <span class="hljs-title function_">vec4</span>(aPosition, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>);</span><br><span class="language-javascript">    texCoord = aPosition.<span class="hljs-property">xy</span> * <span class="hljs-number">0.5</span> + <span class="hljs-title function_">vec2</span>(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>);</span><br><span class="language-javascript">    screenCoord = aPosition.<span class="hljs-property">xy</span> * <span class="hljs-title function_">vec2</span>(uResolution.<span class="hljs-property">z</span>, <span class="hljs-number">1.0</span>);</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pp_final_fsh&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;x-shader/x_fragment&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">#ifdef <span class="hljs-variable constant_">GL_ES</span></span><br><span class="language-javascript"><span class="hljs-comment">//precision mediump float;</span></span><br><span class="language-javascript">precision highp float;</span><br><span class="language-javascript">#endif</span><br><span class="language-javascript">uniform sampler2D uSrc;</span><br><span class="language-javascript">uniform sampler2D uBloom;</span><br><span class="language-javascript">uniform vec2 uDelta;</span><br><span class="language-javascript">varying vec2 texCoord;</span><br><span class="language-javascript">varying vec2 screenCoord;</span><br><span class="language-javascript"><span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-keyword">void</span></span>) &#123;</span><br><span class="language-javascript">    vec4 srccol = <span class="hljs-title function_">texture2D</span>(uSrc, texCoord) * <span class="hljs-number">2.0</span>;</span><br><span class="language-javascript">    vec4 bloomcol = <span class="hljs-title function_">texture2D</span>(uBloom, texCoord);</span><br><span class="language-javascript">    vec4 col;</span><br><span class="language-javascript">    col = srccol + bloomcol * (<span class="hljs-title function_">vec4</span>(<span class="hljs-number">1.0</span>) + srccol);</span><br><span class="language-javascript">    col *= <span class="hljs-title function_">smoothstep</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-title function_">pow</span>(<span class="hljs-title function_">length</span>((texCoord - <span class="hljs-title function_">vec2</span>(<span class="hljs-number">0.5</span>)) * <span class="hljs-number">2.0</span>), <span class="hljs-number">1.2</span>) * <span class="hljs-number">0.5</span>);</span><br><span class="language-javascript">    col = <span class="hljs-title function_">pow</span>(col, <span class="hljs-title function_">vec4</span>(<span class="hljs-number">0.45454545454545</span>)); <span class="hljs-comment">//(1.0 / 2.2)</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">    gl_FragColor = <span class="hljs-title function_">vec4</span>(col.<span class="hljs-property">rgb</span>, <span class="hljs-number">1.0</span>);</span><br><span class="language-javascript">    gl_FragColor.<span class="hljs-property">a</span> = <span class="hljs-number">1.0</span>;</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-comment">// Utilities</span></span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> <span class="hljs-title class_">Vector3</span> = &#123;&#125;;</span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> <span class="hljs-title class_">Matrix44</span> = &#123;&#125;;</span><br><span class="language-javascript">    <span class="hljs-title class_">Vector3</span>.<span class="hljs-property">create</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">x, y, z</span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-keyword">return</span> &#123; <span class="hljs-string">&#x27;x&#x27;</span>: x, <span class="hljs-string">&#x27;y&#x27;</span>: y, <span class="hljs-string">&#x27;z&#x27;</span>: z &#125;;</span><br><span class="language-javascript">    &#125;;</span><br><span class="language-javascript">    <span class="hljs-title class_">Vector3</span>.<span class="hljs-property">dot</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">v0, v1</span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-keyword">return</span> v0.<span class="hljs-property">x</span> * v1.<span class="hljs-property">x</span> + v0.<span class="hljs-property">y</span> * v1.<span class="hljs-property">y</span> + v0.<span class="hljs-property">z</span> * v1.<span class="hljs-property">z</span>;</span><br><span class="language-javascript">    &#125;;</span><br><span class="language-javascript">    <span class="hljs-title class_">Vector3</span>.<span class="hljs-property">cross</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">v, v0, v1</span>) &#123;</span><br><span class="language-javascript">      v.<span class="hljs-property">x</span> = v0.<span class="hljs-property">y</span> * v1.<span class="hljs-property">z</span> - v0.<span class="hljs-property">z</span> * v1.<span class="hljs-property">y</span>;</span><br><span class="language-javascript">      v.<span class="hljs-property">y</span> = v0.<span class="hljs-property">z</span> * v1.<span class="hljs-property">x</span> - v0.<span class="hljs-property">x</span> * v1.<span class="hljs-property">z</span>;</span><br><span class="language-javascript">      v.<span class="hljs-property">z</span> = v0.<span class="hljs-property">x</span> * v1.<span class="hljs-property">y</span> - v0.<span class="hljs-property">y</span> * v1.<span class="hljs-property">x</span>;</span><br><span class="language-javascript">    &#125;;</span><br><span class="language-javascript">    <span class="hljs-title class_">Vector3</span>.<span class="hljs-property">normalize</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">v</span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> l = v.<span class="hljs-property">x</span> * v.<span class="hljs-property">x</span> + v.<span class="hljs-property">y</span> * v.<span class="hljs-property">y</span> + v.<span class="hljs-property">z</span> * v.<span class="hljs-property">z</span>;</span><br><span class="language-javascript">      <span class="hljs-keyword">if</span> (l &gt; <span class="hljs-number">0.00001</span>) &#123;</span><br><span class="language-javascript">        l = <span class="hljs-number">1.0</span> / <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(l);</span><br><span class="language-javascript">        v.<span class="hljs-property">x</span> *= l;</span><br><span class="language-javascript">        v.<span class="hljs-property">y</span> *= l;</span><br><span class="language-javascript">        v.<span class="hljs-property">z</span> *= l;</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">    &#125;;</span><br><span class="language-javascript">    <span class="hljs-title class_">Vector3</span>.<span class="hljs-property">arrayForm</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">v</span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-keyword">if</span> (v.<span class="hljs-property">array</span>) &#123;</span><br><span class="language-javascript">        v.<span class="hljs-property">array</span>[<span class="hljs-number">0</span>] = v.<span class="hljs-property">x</span>;</span><br><span class="language-javascript">        v.<span class="hljs-property">array</span>[<span class="hljs-number">1</span>] = v.<span class="hljs-property">y</span>;</span><br><span class="language-javascript">        v.<span class="hljs-property">array</span>[<span class="hljs-number">2</span>] = v.<span class="hljs-property">z</span>;</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">      <span class="hljs-keyword">else</span> &#123;</span><br><span class="language-javascript">        v.<span class="hljs-property">array</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>([v.<span class="hljs-property">x</span>, v.<span class="hljs-property">y</span>, v.<span class="hljs-property">z</span>]);</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">      <span class="hljs-keyword">return</span> v.<span class="hljs-property">array</span>;</span><br><span class="language-javascript">    &#125;;</span><br><span class="language-javascript">    <span class="hljs-title class_">Matrix44</span>.<span class="hljs-property">createIdentity</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>([<span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>]);</span><br><span class="language-javascript">    &#125;;</span><br><span class="language-javascript">    <span class="hljs-title class_">Matrix44</span>.<span class="hljs-property">loadProjection</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">m, aspect, vdeg, near, far</span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> h = near * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">tan</span>(vdeg * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">180.0</span> * <span class="hljs-number">0.5</span>) * <span class="hljs-number">2.0</span>;</span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> w = h * aspect;</span><br><span class="language-javascript"></span><br><span class="language-javascript">      m[<span class="hljs-number">0</span>] = <span class="hljs-number">2.0</span> * near / w;</span><br><span class="language-javascript">      m[<span class="hljs-number">1</span>] = <span class="hljs-number">0.0</span>;</span><br><span class="language-javascript">      m[<span class="hljs-number">2</span>] = <span class="hljs-number">0.0</span>;</span><br><span class="language-javascript">      m[<span class="hljs-number">3</span>] = <span class="hljs-number">0.0</span>;</span><br><span class="language-javascript"></span><br><span class="language-javascript">      m[<span class="hljs-number">4</span>] = <span class="hljs-number">0.0</span>;</span><br><span class="language-javascript">      m[<span class="hljs-number">5</span>] = <span class="hljs-number">2.0</span> * near / h;</span><br><span class="language-javascript">      m[<span class="hljs-number">6</span>] = <span class="hljs-number">0.0</span>;</span><br><span class="language-javascript">      m[<span class="hljs-number">7</span>] = <span class="hljs-number">0.0</span>;</span><br><span class="language-javascript"></span><br><span class="language-javascript">      m[<span class="hljs-number">8</span>] = <span class="hljs-number">0.0</span>;</span><br><span class="language-javascript">      m[<span class="hljs-number">9</span>] = <span class="hljs-number">0.0</span>;</span><br><span class="language-javascript">      m[<span class="hljs-number">10</span>] = -(far + near) / (far - near);</span><br><span class="language-javascript">      m[<span class="hljs-number">11</span>] = -<span class="hljs-number">1.0</span>;</span><br><span class="language-javascript"></span><br><span class="language-javascript">      m[<span class="hljs-number">12</span>] = <span class="hljs-number">0.0</span>;</span><br><span class="language-javascript">      m[<span class="hljs-number">13</span>] = <span class="hljs-number">0.0</span>;</span><br><span class="language-javascript">      m[<span class="hljs-number">14</span>] = -<span class="hljs-number">2.0</span> * far * near / (far - near);</span><br><span class="language-javascript">      m[<span class="hljs-number">15</span>] = <span class="hljs-number">0.0</span>;</span><br><span class="language-javascript">    &#125;;</span><br><span class="language-javascript">    <span class="hljs-title class_">Matrix44</span>.<span class="hljs-property">loadLookAt</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">m, vpos, vlook, vup</span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> frontv = <span class="hljs-title class_">Vector3</span>.<span class="hljs-title function_">create</span>(vpos.<span class="hljs-property">x</span> - vlook.<span class="hljs-property">x</span>, vpos.<span class="hljs-property">y</span> - vlook.<span class="hljs-property">y</span>, vpos.<span class="hljs-property">z</span> - vlook.<span class="hljs-property">z</span>);</span><br><span class="language-javascript">      <span class="hljs-title class_">Vector3</span>.<span class="hljs-title function_">normalize</span>(frontv);</span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> sidev = <span class="hljs-title class_">Vector3</span>.<span class="hljs-title function_">create</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>);</span><br><span class="language-javascript">      <span class="hljs-title class_">Vector3</span>.<span class="hljs-title function_">cross</span>(sidev, vup, frontv);</span><br><span class="language-javascript">      <span class="hljs-title class_">Vector3</span>.<span class="hljs-title function_">normalize</span>(sidev);</span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> topv = <span class="hljs-title class_">Vector3</span>.<span class="hljs-title function_">create</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>);</span><br><span class="language-javascript">      <span class="hljs-title class_">Vector3</span>.<span class="hljs-title function_">cross</span>(topv, frontv, sidev);</span><br><span class="language-javascript">      <span class="hljs-title class_">Vector3</span>.<span class="hljs-title function_">normalize</span>(topv);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      m[<span class="hljs-number">0</span>] = sidev.<span class="hljs-property">x</span>;</span><br><span class="language-javascript">      m[<span class="hljs-number">1</span>] = topv.<span class="hljs-property">x</span>;</span><br><span class="language-javascript">      m[<span class="hljs-number">2</span>] = frontv.<span class="hljs-property">x</span>;</span><br><span class="language-javascript">      m[<span class="hljs-number">3</span>] = <span class="hljs-number">0.0</span>;</span><br><span class="language-javascript"></span><br><span class="language-javascript">      m[<span class="hljs-number">4</span>] = sidev.<span class="hljs-property">y</span>;</span><br><span class="language-javascript">      m[<span class="hljs-number">5</span>] = topv.<span class="hljs-property">y</span>;</span><br><span class="language-javascript">      m[<span class="hljs-number">6</span>] = frontv.<span class="hljs-property">y</span>;</span><br><span class="language-javascript">      m[<span class="hljs-number">7</span>] = <span class="hljs-number">0.0</span>;</span><br><span class="language-javascript"></span><br><span class="language-javascript">      m[<span class="hljs-number">8</span>] = sidev.<span class="hljs-property">z</span>;</span><br><span class="language-javascript">      m[<span class="hljs-number">9</span>] = topv.<span class="hljs-property">z</span>;</span><br><span class="language-javascript">      m[<span class="hljs-number">10</span>] = frontv.<span class="hljs-property">z</span>;</span><br><span class="language-javascript">      m[<span class="hljs-number">11</span>] = <span class="hljs-number">0.0</span>;</span><br><span class="language-javascript"></span><br><span class="language-javascript">      m[<span class="hljs-number">12</span>] = -(vpos.<span class="hljs-property">x</span> * m[<span class="hljs-number">0</span>] + vpos.<span class="hljs-property">y</span> * m[<span class="hljs-number">4</span>] + vpos.<span class="hljs-property">z</span> * m[<span class="hljs-number">8</span>]);</span><br><span class="language-javascript">      m[<span class="hljs-number">13</span>] = -(vpos.<span class="hljs-property">x</span> * m[<span class="hljs-number">1</span>] + vpos.<span class="hljs-property">y</span> * m[<span class="hljs-number">5</span>] + vpos.<span class="hljs-property">z</span> * m[<span class="hljs-number">9</span>]);</span><br><span class="language-javascript">      m[<span class="hljs-number">14</span>] = -(vpos.<span class="hljs-property">x</span> * m[<span class="hljs-number">2</span>] + vpos.<span class="hljs-property">y</span> * m[<span class="hljs-number">6</span>] + vpos.<span class="hljs-property">z</span> * m[<span class="hljs-number">10</span>]);</span><br><span class="language-javascript">      m[<span class="hljs-number">15</span>] = <span class="hljs-number">1.0</span>;</span><br><span class="language-javascript">    &#125;;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-comment">//</span></span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> timeInfo = &#123;</span><br><span class="language-javascript">      <span class="hljs-string">&#x27;start&#x27;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;prev&#x27;</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// Date</span></span><br><span class="language-javascript">      <span class="hljs-string">&#x27;delta&#x27;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;elapsed&#x27;</span>: <span class="hljs-number">0</span> <span class="hljs-comment">// Number(sec)</span></span><br><span class="language-javascript">    &#125;;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-comment">//</span></span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> gl;</span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> renderSpec = &#123;</span><br><span class="language-javascript">      <span class="hljs-string">&#x27;width&#x27;</span>: <span class="hljs-number">0</span>,</span><br><span class="language-javascript">      <span class="hljs-string">&#x27;height&#x27;</span>: <span class="hljs-number">0</span>,</span><br><span class="language-javascript">      <span class="hljs-string">&#x27;aspect&#x27;</span>: <span class="hljs-number">1</span>,</span><br><span class="language-javascript">      <span class="hljs-string">&#x27;array&#x27;</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>(<span class="hljs-number">3</span>),</span><br><span class="language-javascript">      <span class="hljs-string">&#x27;halfWidth&#x27;</span>: <span class="hljs-number">0</span>,</span><br><span class="language-javascript">      <span class="hljs-string">&#x27;halfHeight&#x27;</span>: <span class="hljs-number">0</span>,</span><br><span class="language-javascript">      <span class="hljs-string">&#x27;halfArray&#x27;</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>(<span class="hljs-number">3</span>)</span><br><span class="language-javascript">      <span class="hljs-comment">// and some render targets. see setViewport()</span></span><br><span class="language-javascript">    &#125;;</span><br><span class="language-javascript">    renderSpec.<span class="hljs-property">setSize</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">w, h</span>) &#123;</span><br><span class="language-javascript">      renderSpec.<span class="hljs-property">width</span> = w;</span><br><span class="language-javascript">      renderSpec.<span class="hljs-property">height</span> = h;</span><br><span class="language-javascript">      renderSpec.<span class="hljs-property">aspect</span> = renderSpec.<span class="hljs-property">width</span> / renderSpec.<span class="hljs-property">height</span>;</span><br><span class="language-javascript">      renderSpec.<span class="hljs-property">array</span>[<span class="hljs-number">0</span>] = renderSpec.<span class="hljs-property">width</span>;</span><br><span class="language-javascript">      renderSpec.<span class="hljs-property">array</span>[<span class="hljs-number">1</span>] = renderSpec.<span class="hljs-property">height</span>;</span><br><span class="language-javascript">      renderSpec.<span class="hljs-property">array</span>[<span class="hljs-number">2</span>] = renderSpec.<span class="hljs-property">aspect</span>;</span><br><span class="language-javascript"></span><br><span class="language-javascript">      renderSpec.<span class="hljs-property">halfWidth</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(w / <span class="hljs-number">2</span>);</span><br><span class="language-javascript">      renderSpec.<span class="hljs-property">halfHeight</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(h / <span class="hljs-number">2</span>);</span><br><span class="language-javascript">      renderSpec.<span class="hljs-property">halfArray</span>[<span class="hljs-number">0</span>] = renderSpec.<span class="hljs-property">halfWidth</span>;</span><br><span class="language-javascript">      renderSpec.<span class="hljs-property">halfArray</span>[<span class="hljs-number">1</span>] = renderSpec.<span class="hljs-property">halfHeight</span>;</span><br><span class="language-javascript">      renderSpec.<span class="hljs-property">halfArray</span>[<span class="hljs-number">2</span>] = renderSpec.<span class="hljs-property">halfWidth</span> / renderSpec.<span class="hljs-property">halfHeight</span>;</span><br><span class="language-javascript">    &#125;;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">deleteRenderTarget</span>(<span class="hljs-params">rt</span>) &#123;</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">deleteFramebuffer</span>(rt.<span class="hljs-property">frameBuffer</span>);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">deleteRenderbuffer</span>(rt.<span class="hljs-property">renderBuffer</span>);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">deleteTexture</span>(rt.<span class="hljs-property">texture</span>);</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">createRenderTarget</span>(<span class="hljs-params">w, h</span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> ret = &#123;</span><br><span class="language-javascript">        <span class="hljs-string">&#x27;width&#x27;</span>: w,</span><br><span class="language-javascript">        <span class="hljs-string">&#x27;height&#x27;</span>: h,</span><br><span class="language-javascript">        <span class="hljs-string">&#x27;sizeArray&#x27;</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>([w, h, w / h]),</span><br><span class="language-javascript">        <span class="hljs-string">&#x27;dtxArray&#x27;</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>([<span class="hljs-number">1.0</span> / w, <span class="hljs-number">1.0</span> / h])</span><br><span class="language-javascript">      &#125;;</span><br><span class="language-javascript">      ret.<span class="hljs-property">frameBuffer</span> = gl.<span class="hljs-title function_">createFramebuffer</span>();</span><br><span class="language-javascript">      ret.<span class="hljs-property">renderBuffer</span> = gl.<span class="hljs-title function_">createRenderbuffer</span>();</span><br><span class="language-javascript">      ret.<span class="hljs-property">texture</span> = gl.<span class="hljs-title function_">createTexture</span>();</span><br><span class="language-javascript"></span><br><span class="language-javascript">      gl.<span class="hljs-title function_">bindTexture</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, ret.<span class="hljs-property">texture</span>);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">texImage2D</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, <span class="hljs-number">0</span>, gl.<span class="hljs-property">RGBA</span>, w, h, <span class="hljs-number">0</span>, gl.<span class="hljs-property">RGBA</span>, gl.<span class="hljs-property">UNSIGNED_BYTE</span>, <span class="hljs-literal">null</span>);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">texParameteri</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, gl.<span class="hljs-property">TEXTURE_WRAP_S</span>, gl.<span class="hljs-property">CLAMP_TO_EDGE</span>);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">texParameteri</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, gl.<span class="hljs-property">TEXTURE_WRAP_T</span>, gl.<span class="hljs-property">CLAMP_TO_EDGE</span>);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">texParameteri</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, gl.<span class="hljs-property">TEXTURE_MAG_FILTER</span>, gl.<span class="hljs-property">LINEAR</span>);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">texParameteri</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, gl.<span class="hljs-property">TEXTURE_MIN_FILTER</span>, gl.<span class="hljs-property">LINEAR</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      gl.<span class="hljs-title function_">bindFramebuffer</span>(gl.<span class="hljs-property">FRAMEBUFFER</span>, ret.<span class="hljs-property">frameBuffer</span>);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">framebufferTexture2D</span>(gl.<span class="hljs-property">FRAMEBUFFER</span>, gl.<span class="hljs-property">COLOR_ATTACHMENT0</span>, gl.<span class="hljs-property">TEXTURE_2D</span>, ret.<span class="hljs-property">texture</span>, <span class="hljs-number">0</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      gl.<span class="hljs-title function_">bindRenderbuffer</span>(gl.<span class="hljs-property">RENDERBUFFER</span>, ret.<span class="hljs-property">renderBuffer</span>);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">renderbufferStorage</span>(gl.<span class="hljs-property">RENDERBUFFER</span>, gl.<span class="hljs-property">DEPTH_COMPONENT16</span>, w, h);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">framebufferRenderbuffer</span>(gl.<span class="hljs-property">FRAMEBUFFER</span>, gl.<span class="hljs-property">DEPTH_ATTACHMENT</span>, gl.<span class="hljs-property">RENDERBUFFER</span>, ret.<span class="hljs-property">renderBuffer</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      gl.<span class="hljs-title function_">bindTexture</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, <span class="hljs-literal">null</span>);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">bindRenderbuffer</span>(gl.<span class="hljs-property">RENDERBUFFER</span>, <span class="hljs-literal">null</span>);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">bindFramebuffer</span>(gl.<span class="hljs-property">FRAMEBUFFER</span>, <span class="hljs-literal">null</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">return</span> ret;</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">compileShader</span>(<span class="hljs-params">shtype, shsrc</span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> retsh = gl.<span class="hljs-title function_">createShader</span>(shtype);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      gl.<span class="hljs-title function_">shaderSource</span>(retsh, shsrc);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">compileShader</span>(retsh);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">if</span> (!gl.<span class="hljs-title function_">getShaderParameter</span>(retsh, gl.<span class="hljs-property">COMPILE_STATUS</span>)) &#123;</span><br><span class="language-javascript">        <span class="hljs-keyword">var</span> errlog = gl.<span class="hljs-title function_">getShaderInfoLog</span>(retsh);</span><br><span class="language-javascript">        gl.<span class="hljs-title function_">deleteShader</span>(retsh);</span><br><span class="language-javascript">        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(errlog);</span><br><span class="language-javascript">        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">      <span class="hljs-keyword">return</span> retsh;</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">createShader</span>(<span class="hljs-params">vtxsrc, frgsrc, uniformlist, attrlist</span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> vsh = <span class="hljs-title function_">compileShader</span>(gl.<span class="hljs-property">VERTEX_SHADER</span>, vtxsrc);</span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> fsh = <span class="hljs-title function_">compileShader</span>(gl.<span class="hljs-property">FRAGMENT_SHADER</span>, frgsrc);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">if</span> (vsh == <span class="hljs-literal">null</span> || fsh == <span class="hljs-literal">null</span>) &#123;</span><br><span class="language-javascript">        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> prog = gl.<span class="hljs-title function_">createProgram</span>();</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">attachShader</span>(prog, vsh);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">attachShader</span>(prog, fsh);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      gl.<span class="hljs-title function_">deleteShader</span>(vsh);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">deleteShader</span>(fsh);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      gl.<span class="hljs-title function_">linkProgram</span>(prog);</span><br><span class="language-javascript">      <span class="hljs-keyword">if</span> (!gl.<span class="hljs-title function_">getProgramParameter</span>(prog, gl.<span class="hljs-property">LINK_STATUS</span>)) &#123;</span><br><span class="language-javascript">        <span class="hljs-keyword">var</span> errlog = gl.<span class="hljs-title function_">getProgramInfoLog</span>(prog);</span><br><span class="language-javascript">        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(errlog);</span><br><span class="language-javascript">        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">if</span> (uniformlist) &#123;</span><br><span class="language-javascript">        prog.<span class="hljs-property">uniforms</span> = &#123;&#125;;</span><br><span class="language-javascript">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; uniformlist.<span class="hljs-property">length</span>; i++) &#123;</span><br><span class="language-javascript">          prog.<span class="hljs-property">uniforms</span>[uniformlist[i]] = gl.<span class="hljs-title function_">getUniformLocation</span>(prog, uniformlist[i]);</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">if</span> (attrlist) &#123;</span><br><span class="language-javascript">        prog.<span class="hljs-property">attributes</span> = &#123;&#125;;</span><br><span class="language-javascript">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; attrlist.<span class="hljs-property">length</span>; i++) &#123;</span><br><span class="language-javascript">          <span class="hljs-keyword">var</span> attr = attrlist[i];</span><br><span class="language-javascript">          prog.<span class="hljs-property">attributes</span>[attr] = gl.<span class="hljs-title function_">getAttribLocation</span>(prog, attr);</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">return</span> prog;</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">useShader</span>(<span class="hljs-params">prog</span>) &#123;</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">useProgram</span>(prog);</span><br><span class="language-javascript">      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> attr <span class="hljs-keyword">in</span> prog.<span class="hljs-property">attributes</span>) &#123;</span><br><span class="language-javascript">        gl.<span class="hljs-title function_">enableVertexAttribArray</span>(prog.<span class="hljs-property">attributes</span>[attr]);;</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">unuseShader</span>(<span class="hljs-params">prog</span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> attr <span class="hljs-keyword">in</span> prog.<span class="hljs-property">attributes</span>) &#123;</span><br><span class="language-javascript">        gl.<span class="hljs-title function_">disableVertexAttribArray</span>(prog.<span class="hljs-property">attributes</span>[attr]);;</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">useProgram</span>(<span class="hljs-literal">null</span>);</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> projection = &#123;</span><br><span class="language-javascript">      <span class="hljs-string">&#x27;angle&#x27;</span>: <span class="hljs-number">60</span>,</span><br><span class="language-javascript">      <span class="hljs-string">&#x27;nearfar&#x27;</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>([<span class="hljs-number">0.1</span>, <span class="hljs-number">100.0</span>]),</span><br><span class="language-javascript">      <span class="hljs-string">&#x27;matrix&#x27;</span>: <span class="hljs-title class_">Matrix44</span>.<span class="hljs-title function_">createIdentity</span>()</span><br><span class="language-javascript">    &#125;;</span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> camera = &#123;</span><br><span class="language-javascript">      <span class="hljs-string">&#x27;position&#x27;</span>: <span class="hljs-title class_">Vector3</span>.<span class="hljs-title function_">create</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">100</span>),</span><br><span class="language-javascript">      <span class="hljs-string">&#x27;lookat&#x27;</span>: <span class="hljs-title class_">Vector3</span>.<span class="hljs-title function_">create</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>),</span><br><span class="language-javascript">      <span class="hljs-string">&#x27;up&#x27;</span>: <span class="hljs-title class_">Vector3</span>.<span class="hljs-title function_">create</span>(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>),</span><br><span class="language-javascript">      <span class="hljs-string">&#x27;dof&#x27;</span>: <span class="hljs-title class_">Vector3</span>.<span class="hljs-title function_">create</span>(<span class="hljs-number">10.0</span>, <span class="hljs-number">4.0</span>, <span class="hljs-number">8.0</span>),</span><br><span class="language-javascript">      <span class="hljs-string">&#x27;matrix&#x27;</span>: <span class="hljs-title class_">Matrix44</span>.<span class="hljs-title function_">createIdentity</span>()</span><br><span class="language-javascript">    &#125;;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> pointFlower = &#123;&#125;;</span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> meshFlower = &#123;&#125;;</span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> sceneStandBy = <span class="hljs-literal">false</span>;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> <span class="hljs-title class_">BlossomParticle</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">3</span>);</span><br><span class="language-javascript">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">rotation</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">3</span>);</span><br><span class="language-javascript">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">3</span>);</span><br><span class="language-javascript">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">euler</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">3</span>);</span><br><span class="language-javascript">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span> = <span class="hljs-number">1.0</span>;</span><br><span class="language-javascript">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">alpha</span> = <span class="hljs-number">1.0</span>;</span><br><span class="language-javascript">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">zkey</span> = <span class="hljs-number">0.0</span>;</span><br><span class="language-javascript">    &#125;;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-title class_">BlossomParticle</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">setVelocity</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">vx, vy, vz</span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span>[<span class="hljs-number">0</span>] = vx;</span><br><span class="language-javascript">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span>[<span class="hljs-number">1</span>] = vy;</span><br><span class="language-javascript">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span>[<span class="hljs-number">2</span>] = vz;</span><br><span class="language-javascript">    &#125;;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-title class_">BlossomParticle</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">setRotation</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">rx, ry, rz</span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">rotation</span>[<span class="hljs-number">0</span>] = rx;</span><br><span class="language-javascript">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">rotation</span>[<span class="hljs-number">1</span>] = ry;</span><br><span class="language-javascript">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">rotation</span>[<span class="hljs-number">2</span>] = rz;</span><br><span class="language-javascript">    &#125;;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-title class_">BlossomParticle</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">setPosition</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">nx, ny, nz</span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>[<span class="hljs-number">0</span>] = nx;</span><br><span class="language-javascript">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>[<span class="hljs-number">1</span>] = ny;</span><br><span class="language-javascript">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>[<span class="hljs-number">2</span>] = nz;</span><br><span class="language-javascript">    &#125;;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-title class_">BlossomParticle</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">setEulerAngles</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">rx, ry, rz</span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">euler</span>[<span class="hljs-number">0</span>] = rx;</span><br><span class="language-javascript">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">euler</span>[<span class="hljs-number">1</span>] = ry;</span><br><span class="language-javascript">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">euler</span>[<span class="hljs-number">2</span>] = rz;</span><br><span class="language-javascript">    &#125;;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-title class_">BlossomParticle</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">setSize</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">s</span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span> = s;</span><br><span class="language-javascript">    &#125;;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-title class_">BlossomParticle</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">update</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">dt, et</span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>[<span class="hljs-number">0</span>] += <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span>[<span class="hljs-number">0</span>] * dt;</span><br><span class="language-javascript">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>[<span class="hljs-number">1</span>] += <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span>[<span class="hljs-number">1</span>] * dt;</span><br><span class="language-javascript">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>[<span class="hljs-number">2</span>] += <span class="hljs-variable language_">this</span>.<span class="hljs-property">velocity</span>[<span class="hljs-number">2</span>] * dt;</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">euler</span>[<span class="hljs-number">0</span>] += <span class="hljs-variable language_">this</span>.<span class="hljs-property">rotation</span>[<span class="hljs-number">0</span>] * dt;</span><br><span class="language-javascript">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">euler</span>[<span class="hljs-number">1</span>] += <span class="hljs-variable language_">this</span>.<span class="hljs-property">rotation</span>[<span class="hljs-number">1</span>] * dt;</span><br><span class="language-javascript">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">euler</span>[<span class="hljs-number">2</span>] += <span class="hljs-variable language_">this</span>.<span class="hljs-property">rotation</span>[<span class="hljs-number">2</span>] * dt;</span><br><span class="language-javascript">    &#125;;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">createPointFlowers</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-comment">// get point sizes</span></span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> prm = gl.<span class="hljs-title function_">getParameter</span>(gl.<span class="hljs-property">ALIASED_POINT_SIZE_RANGE</span>);</span><br><span class="language-javascript">      renderSpec.<span class="hljs-property">pointSize</span> = &#123; <span class="hljs-string">&#x27;min&#x27;</span>: prm[<span class="hljs-number">0</span>], <span class="hljs-string">&#x27;max&#x27;</span>: prm[<span class="hljs-number">1</span>] &#125;;</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> vtxsrc = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;sakura_point_vsh&quot;</span>).<span class="hljs-property">textContent</span>;</span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> frgsrc = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;sakura_point_fsh&quot;</span>).<span class="hljs-property">textContent</span>;</span><br><span class="language-javascript"></span><br><span class="language-javascript">      pointFlower.<span class="hljs-property">program</span> = <span class="hljs-title function_">createShader</span>(</span><br><span class="language-javascript">        vtxsrc, frgsrc,</span><br><span class="language-javascript">        [<span class="hljs-string">&#x27;uProjection&#x27;</span>, <span class="hljs-string">&#x27;uModelview&#x27;</span>, <span class="hljs-string">&#x27;uResolution&#x27;</span>, <span class="hljs-string">&#x27;uOffset&#x27;</span>, <span class="hljs-string">&#x27;uDOF&#x27;</span>, <span class="hljs-string">&#x27;uFade&#x27;</span>],</span><br><span class="language-javascript">        [<span class="hljs-string">&#x27;aPosition&#x27;</span>, <span class="hljs-string">&#x27;aEuler&#x27;</span>, <span class="hljs-string">&#x27;aMisc&#x27;</span>]</span><br><span class="language-javascript">      );</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title function_">useShader</span>(pointFlower.<span class="hljs-property">program</span>);</span><br><span class="language-javascript">      pointFlower.<span class="hljs-property">offset</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>([<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>]);</span><br><span class="language-javascript">      pointFlower.<span class="hljs-property">fader</span> = <span class="hljs-title class_">Vector3</span>.<span class="hljs-title function_">create</span>(<span class="hljs-number">0.0</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">0.0</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-comment">// paramerters: velocity[3], rotate[3]</span></span><br><span class="language-javascript">      pointFlower.<span class="hljs-property">numFlowers</span> = <span class="hljs-number">1600</span>;</span><br><span class="language-javascript">      pointFlower.<span class="hljs-property">particles</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(pointFlower.<span class="hljs-property">numFlowers</span>);</span><br><span class="language-javascript">      <span class="hljs-comment">// vertex attributes &#123;position[3], euler_xyz[3], size[1]&#125;</span></span><br><span class="language-javascript">      pointFlower.<span class="hljs-property">dataArray</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>(pointFlower.<span class="hljs-property">numFlowers</span> * (<span class="hljs-number">3</span> + <span class="hljs-number">3</span> + <span class="hljs-number">2</span>));</span><br><span class="language-javascript">      pointFlower.<span class="hljs-property">positionArrayOffset</span> = <span class="hljs-number">0</span>;</span><br><span class="language-javascript">      pointFlower.<span class="hljs-property">eulerArrayOffset</span> = pointFlower.<span class="hljs-property">numFlowers</span> * <span class="hljs-number">3</span>;</span><br><span class="language-javascript">      pointFlower.<span class="hljs-property">miscArrayOffset</span> = pointFlower.<span class="hljs-property">numFlowers</span> * <span class="hljs-number">6</span>;</span><br><span class="language-javascript"></span><br><span class="language-javascript">      pointFlower.<span class="hljs-property">buffer</span> = gl.<span class="hljs-title function_">createBuffer</span>();</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">bindBuffer</span>(gl.<span class="hljs-property">ARRAY_BUFFER</span>, pointFlower.<span class="hljs-property">buffer</span>);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">bufferData</span>(gl.<span class="hljs-property">ARRAY_BUFFER</span>, pointFlower.<span class="hljs-property">dataArray</span>, gl.<span class="hljs-property">DYNAMIC_DRAW</span>);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">bindBuffer</span>(gl.<span class="hljs-property">ARRAY_BUFFER</span>, <span class="hljs-literal">null</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title function_">unuseShader</span>(pointFlower.<span class="hljs-property">program</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; pointFlower.<span class="hljs-property">numFlowers</span>; i++) &#123;</span><br><span class="language-javascript">        pointFlower.<span class="hljs-property">particles</span>[i] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BlossomParticle</span>();</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">initPointFlowers</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-comment">//area</span></span><br><span class="language-javascript">      pointFlower.<span class="hljs-property">area</span> = <span class="hljs-title class_">Vector3</span>.<span class="hljs-title function_">create</span>(<span class="hljs-number">20.0</span>, <span class="hljs-number">20.0</span>, <span class="hljs-number">20.0</span>);</span><br><span class="language-javascript">      pointFlower.<span class="hljs-property">area</span>.<span class="hljs-property">x</span> = pointFlower.<span class="hljs-property">area</span>.<span class="hljs-property">y</span> * renderSpec.<span class="hljs-property">aspect</span>;</span><br><span class="language-javascript"></span><br><span class="language-javascript">      pointFlower.<span class="hljs-property">fader</span>.<span class="hljs-property">x</span> = <span class="hljs-number">10.0</span>; <span class="hljs-comment">//env fade start</span></span><br><span class="language-javascript">      pointFlower.<span class="hljs-property">fader</span>.<span class="hljs-property">y</span> = pointFlower.<span class="hljs-property">area</span>.<span class="hljs-property">z</span>; <span class="hljs-comment">//env fade half</span></span><br><span class="language-javascript">      pointFlower.<span class="hljs-property">fader</span>.<span class="hljs-property">z</span> = <span class="hljs-number">0.1</span>;  <span class="hljs-comment">//near fade start</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-comment">//particles</span></span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> <span class="hljs-title class_">PI2</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2.0</span>;</span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> tmpv3 = <span class="hljs-title class_">Vector3</span>.<span class="hljs-title function_">create</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);</span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> tmpv = <span class="hljs-number">0</span>;</span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> symmetryrand = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123; <span class="hljs-keyword">return</span> (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">2.0</span> - <span class="hljs-number">1.0</span>); &#125;;</span><br><span class="language-javascript">      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; pointFlower.<span class="hljs-property">numFlowers</span>; i++) &#123;</span><br><span class="language-javascript">        <span class="hljs-keyword">var</span> tmpprtcl = pointFlower.<span class="hljs-property">particles</span>[i];</span><br><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-comment">//velocity</span></span><br><span class="language-javascript">        tmpv3.<span class="hljs-property">x</span> = <span class="hljs-title function_">symmetryrand</span>() * <span class="hljs-number">0.3</span> + <span class="hljs-number">0.8</span>;</span><br><span class="language-javascript">        tmpv3.<span class="hljs-property">y</span> = <span class="hljs-title function_">symmetryrand</span>() * <span class="hljs-number">0.2</span> - <span class="hljs-number">1.0</span>;</span><br><span class="language-javascript">        tmpv3.<span class="hljs-property">z</span> = <span class="hljs-title function_">symmetryrand</span>() * <span class="hljs-number">0.3</span> + <span class="hljs-number">0.5</span>;</span><br><span class="language-javascript">        <span class="hljs-title class_">Vector3</span>.<span class="hljs-title function_">normalize</span>(tmpv3);</span><br><span class="language-javascript">        tmpv = <span class="hljs-number">2.0</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">1.0</span>;</span><br><span class="language-javascript">        tmpprtcl.<span class="hljs-title function_">setVelocity</span>(tmpv3.<span class="hljs-property">x</span> * tmpv, tmpv3.<span class="hljs-property">y</span> * tmpv, tmpv3.<span class="hljs-property">z</span> * tmpv);</span><br><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-comment">//rotation</span></span><br><span class="language-javascript">        tmpprtcl.<span class="hljs-title function_">setRotation</span>(</span><br><span class="language-javascript">          <span class="hljs-title function_">symmetryrand</span>() * <span class="hljs-title class_">PI2</span> * <span class="hljs-number">0.5</span>,</span><br><span class="language-javascript">          <span class="hljs-title function_">symmetryrand</span>() * <span class="hljs-title class_">PI2</span> * <span class="hljs-number">0.5</span>,</span><br><span class="language-javascript">          <span class="hljs-title function_">symmetryrand</span>() * <span class="hljs-title class_">PI2</span> * <span class="hljs-number">0.5</span></span><br><span class="language-javascript">        );</span><br><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-comment">//position</span></span><br><span class="language-javascript">        tmpprtcl.<span class="hljs-title function_">setPosition</span>(</span><br><span class="language-javascript">          <span class="hljs-title function_">symmetryrand</span>() * pointFlower.<span class="hljs-property">area</span>.<span class="hljs-property">x</span>,</span><br><span class="language-javascript">          <span class="hljs-title function_">symmetryrand</span>() * pointFlower.<span class="hljs-property">area</span>.<span class="hljs-property">y</span>,</span><br><span class="language-javascript">          <span class="hljs-title function_">symmetryrand</span>() * pointFlower.<span class="hljs-property">area</span>.<span class="hljs-property">z</span></span><br><span class="language-javascript">        );</span><br><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-comment">//euler</span></span><br><span class="language-javascript">        tmpprtcl.<span class="hljs-title function_">setEulerAngles</span>(</span><br><span class="language-javascript">          <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2.0</span>,</span><br><span class="language-javascript">          <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2.0</span>,</span><br><span class="language-javascript">          <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2.0</span></span><br><span class="language-javascript">        );</span><br><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-comment">//size</span></span><br><span class="language-javascript">        tmpprtcl.<span class="hljs-title function_">setSize</span>(<span class="hljs-number">0.9</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">0.1</span>);</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">renderPointFlowers</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-comment">//update</span></span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> <span class="hljs-title class_">PI2</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2.0</span>;</span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> limit = [pointFlower.<span class="hljs-property">area</span>.<span class="hljs-property">x</span>, pointFlower.<span class="hljs-property">area</span>.<span class="hljs-property">y</span>, pointFlower.<span class="hljs-property">area</span>.<span class="hljs-property">z</span>];</span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> repeatPos = <span class="hljs-keyword">function</span> (<span class="hljs-params">prt, cmp, limit</span>) &#123;</span><br><span class="language-javascript">        <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(prt.<span class="hljs-property">position</span>[cmp]) - prt.<span class="hljs-property">size</span> * <span class="hljs-number">0.5</span> &gt; limit) &#123;</span><br><span class="language-javascript">          <span class="hljs-comment">//out of area</span></span><br><span class="language-javascript">          <span class="hljs-keyword">if</span> (prt.<span class="hljs-property">position</span>[cmp] &gt; <span class="hljs-number">0</span>) &#123;</span><br><span class="language-javascript">            prt.<span class="hljs-property">position</span>[cmp] -= limit * <span class="hljs-number">2.0</span>;</span><br><span class="language-javascript">          &#125;</span><br><span class="language-javascript">          <span class="hljs-keyword">else</span> &#123;</span><br><span class="language-javascript">            prt.<span class="hljs-property">position</span>[cmp] += limit * <span class="hljs-number">2.0</span>;</span><br><span class="language-javascript">          &#125;</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">      &#125;;</span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> repeatEuler = <span class="hljs-keyword">function</span> (<span class="hljs-params">prt, cmp</span>) &#123;</span><br><span class="language-javascript">        prt.<span class="hljs-property">euler</span>[cmp] = prt.<span class="hljs-property">euler</span>[cmp] % <span class="hljs-title class_">PI2</span>;</span><br><span class="language-javascript">        <span class="hljs-keyword">if</span> (prt.<span class="hljs-property">euler</span>[cmp] &lt; <span class="hljs-number">0.0</span>) &#123;</span><br><span class="language-javascript">          prt.<span class="hljs-property">euler</span>[cmp] += <span class="hljs-title class_">PI2</span>;</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">      &#125;;</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; pointFlower.<span class="hljs-property">numFlowers</span>; i++) &#123;</span><br><span class="language-javascript">        <span class="hljs-keyword">var</span> prtcl = pointFlower.<span class="hljs-property">particles</span>[i];</span><br><span class="language-javascript">        prtcl.<span class="hljs-title function_">update</span>(timeInfo.<span class="hljs-property">delta</span>, timeInfo.<span class="hljs-property">elapsed</span>);</span><br><span class="language-javascript">        <span class="hljs-title function_">repeatPos</span>(prtcl, <span class="hljs-number">0</span>, pointFlower.<span class="hljs-property">area</span>.<span class="hljs-property">x</span>);</span><br><span class="language-javascript">        <span class="hljs-title function_">repeatPos</span>(prtcl, <span class="hljs-number">1</span>, pointFlower.<span class="hljs-property">area</span>.<span class="hljs-property">y</span>);</span><br><span class="language-javascript">        <span class="hljs-title function_">repeatPos</span>(prtcl, <span class="hljs-number">2</span>, pointFlower.<span class="hljs-property">area</span>.<span class="hljs-property">z</span>);</span><br><span class="language-javascript">        <span class="hljs-title function_">repeatEuler</span>(prtcl, <span class="hljs-number">0</span>);</span><br><span class="language-javascript">        <span class="hljs-title function_">repeatEuler</span>(prtcl, <span class="hljs-number">1</span>);</span><br><span class="language-javascript">        <span class="hljs-title function_">repeatEuler</span>(prtcl, <span class="hljs-number">2</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">        prtcl.<span class="hljs-property">alpha</span> = <span class="hljs-number">1.0</span>;<span class="hljs-comment">//(pointFlower.area.z - prtcl.position[2]) * 0.5;</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">        prtcl.<span class="hljs-property">zkey</span> = (camera.<span class="hljs-property">matrix</span>[<span class="hljs-number">2</span>] * prtcl.<span class="hljs-property">position</span>[<span class="hljs-number">0</span>]</span><br><span class="language-javascript">          + camera.<span class="hljs-property">matrix</span>[<span class="hljs-number">6</span>] * prtcl.<span class="hljs-property">position</span>[<span class="hljs-number">1</span>]</span><br><span class="language-javascript">          + camera.<span class="hljs-property">matrix</span>[<span class="hljs-number">10</span>] * prtcl.<span class="hljs-property">position</span>[<span class="hljs-number">2</span>]</span><br><span class="language-javascript">          + camera.<span class="hljs-property">matrix</span>[<span class="hljs-number">14</span>]);</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-comment">// sort</span></span><br><span class="language-javascript">      pointFlower.<span class="hljs-property">particles</span>.<span class="hljs-title function_">sort</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">p0, p1</span>) &#123; <span class="hljs-keyword">return</span> p0.<span class="hljs-property">zkey</span> - p1.<span class="hljs-property">zkey</span>; &#125;);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-comment">// update data</span></span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> ipos = pointFlower.<span class="hljs-property">positionArrayOffset</span>;</span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> ieuler = pointFlower.<span class="hljs-property">eulerArrayOffset</span>;</span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> imisc = pointFlower.<span class="hljs-property">miscArrayOffset</span>;</span><br><span class="language-javascript">      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; pointFlower.<span class="hljs-property">numFlowers</span>; i++) &#123;</span><br><span class="language-javascript">        <span class="hljs-keyword">var</span> prtcl = pointFlower.<span class="hljs-property">particles</span>[i];</span><br><span class="language-javascript">        pointFlower.<span class="hljs-property">dataArray</span>[ipos] = prtcl.<span class="hljs-property">position</span>[<span class="hljs-number">0</span>];</span><br><span class="language-javascript">        pointFlower.<span class="hljs-property">dataArray</span>[ipos + <span class="hljs-number">1</span>] = prtcl.<span class="hljs-property">position</span>[<span class="hljs-number">1</span>];</span><br><span class="language-javascript">        pointFlower.<span class="hljs-property">dataArray</span>[ipos + <span class="hljs-number">2</span>] = prtcl.<span class="hljs-property">position</span>[<span class="hljs-number">2</span>];</span><br><span class="language-javascript">        ipos += <span class="hljs-number">3</span>;</span><br><span class="language-javascript">        pointFlower.<span class="hljs-property">dataArray</span>[ieuler] = prtcl.<span class="hljs-property">euler</span>[<span class="hljs-number">0</span>];</span><br><span class="language-javascript">        pointFlower.<span class="hljs-property">dataArray</span>[ieuler + <span class="hljs-number">1</span>] = prtcl.<span class="hljs-property">euler</span>[<span class="hljs-number">1</span>];</span><br><span class="language-javascript">        pointFlower.<span class="hljs-property">dataArray</span>[ieuler + <span class="hljs-number">2</span>] = prtcl.<span class="hljs-property">euler</span>[<span class="hljs-number">2</span>];</span><br><span class="language-javascript">        ieuler += <span class="hljs-number">3</span>;</span><br><span class="language-javascript">        pointFlower.<span class="hljs-property">dataArray</span>[imisc] = prtcl.<span class="hljs-property">size</span>;</span><br><span class="language-javascript">        pointFlower.<span class="hljs-property">dataArray</span>[imisc + <span class="hljs-number">1</span>] = prtcl.<span class="hljs-property">alpha</span>;</span><br><span class="language-javascript">        imisc += <span class="hljs-number">2</span>;</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-comment">//draw</span></span><br><span class="language-javascript">      gl.<span class="hljs-title function_">enable</span>(gl.<span class="hljs-property">BLEND</span>);</span><br><span class="language-javascript">      <span class="hljs-comment">//gl.disable(gl.DEPTH_TEST);</span></span><br><span class="language-javascript">      gl.<span class="hljs-title function_">blendFunc</span>(gl.<span class="hljs-property">SRC_ALPHA</span>, gl.<span class="hljs-property">ONE_MINUS_SRC_ALPHA</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> prog = pointFlower.<span class="hljs-property">program</span>;</span><br><span class="language-javascript">      <span class="hljs-title function_">useShader</span>(prog);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      gl.<span class="hljs-title function_">uniformMatrix4fv</span>(prog.<span class="hljs-property">uniforms</span>.<span class="hljs-property">uProjection</span>, <span class="hljs-literal">false</span>, projection.<span class="hljs-property">matrix</span>);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">uniformMatrix4fv</span>(prog.<span class="hljs-property">uniforms</span>.<span class="hljs-property">uModelview</span>, <span class="hljs-literal">false</span>, camera.<span class="hljs-property">matrix</span>);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">uniform3fv</span>(prog.<span class="hljs-property">uniforms</span>.<span class="hljs-property">uResolution</span>, renderSpec.<span class="hljs-property">array</span>);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">uniform3fv</span>(prog.<span class="hljs-property">uniforms</span>.<span class="hljs-property">uDOF</span>, <span class="hljs-title class_">Vector3</span>.<span class="hljs-title function_">arrayForm</span>(camera.<span class="hljs-property">dof</span>));</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">uniform3fv</span>(prog.<span class="hljs-property">uniforms</span>.<span class="hljs-property">uFade</span>, <span class="hljs-title class_">Vector3</span>.<span class="hljs-title function_">arrayForm</span>(pointFlower.<span class="hljs-property">fader</span>));</span><br><span class="language-javascript"></span><br><span class="language-javascript">      gl.<span class="hljs-title function_">bindBuffer</span>(gl.<span class="hljs-property">ARRAY_BUFFER</span>, pointFlower.<span class="hljs-property">buffer</span>);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">bufferData</span>(gl.<span class="hljs-property">ARRAY_BUFFER</span>, pointFlower.<span class="hljs-property">dataArray</span>, gl.<span class="hljs-property">DYNAMIC_DRAW</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      gl.<span class="hljs-title function_">vertexAttribPointer</span>(prog.<span class="hljs-property">attributes</span>.<span class="hljs-property">aPosition</span>, <span class="hljs-number">3</span>, gl.<span class="hljs-property">FLOAT</span>, <span class="hljs-literal">false</span>, <span class="hljs-number">0</span>, pointFlower.<span class="hljs-property">positionArrayOffset</span> * <span class="hljs-title class_">Float32Array</span>.<span class="hljs-property">BYTES_PER_ELEMENT</span>);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">vertexAttribPointer</span>(prog.<span class="hljs-property">attributes</span>.<span class="hljs-property">aEuler</span>, <span class="hljs-number">3</span>, gl.<span class="hljs-property">FLOAT</span>, <span class="hljs-literal">false</span>, <span class="hljs-number">0</span>, pointFlower.<span class="hljs-property">eulerArrayOffset</span> * <span class="hljs-title class_">Float32Array</span>.<span class="hljs-property">BYTES_PER_ELEMENT</span>);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">vertexAttribPointer</span>(prog.<span class="hljs-property">attributes</span>.<span class="hljs-property">aMisc</span>, <span class="hljs-number">2</span>, gl.<span class="hljs-property">FLOAT</span>, <span class="hljs-literal">false</span>, <span class="hljs-number">0</span>, pointFlower.<span class="hljs-property">miscArrayOffset</span> * <span class="hljs-title class_">Float32Array</span>.<span class="hljs-property">BYTES_PER_ELEMENT</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-comment">// doubler</span></span><br><span class="language-javascript">      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">2</span>; i++) &#123;</span><br><span class="language-javascript">        <span class="hljs-keyword">var</span> zpos = i * -<span class="hljs-number">2.0</span>;</span><br><span class="language-javascript">        pointFlower.<span class="hljs-property">offset</span>[<span class="hljs-number">0</span>] = pointFlower.<span class="hljs-property">area</span>.<span class="hljs-property">x</span> * -<span class="hljs-number">1.0</span>;</span><br><span class="language-javascript">        pointFlower.<span class="hljs-property">offset</span>[<span class="hljs-number">1</span>] = pointFlower.<span class="hljs-property">area</span>.<span class="hljs-property">y</span> * -<span class="hljs-number">1.0</span>;</span><br><span class="language-javascript">        pointFlower.<span class="hljs-property">offset</span>[<span class="hljs-number">2</span>] = pointFlower.<span class="hljs-property">area</span>.<span class="hljs-property">z</span> * zpos;</span><br><span class="language-javascript">        gl.<span class="hljs-title function_">uniform3fv</span>(prog.<span class="hljs-property">uniforms</span>.<span class="hljs-property">uOffset</span>, pointFlower.<span class="hljs-property">offset</span>);</span><br><span class="language-javascript">        gl.<span class="hljs-title function_">drawArrays</span>(gl.<span class="hljs-property">POINT</span>, <span class="hljs-number">0</span>, pointFlower.<span class="hljs-property">numFlowers</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">        pointFlower.<span class="hljs-property">offset</span>[<span class="hljs-number">0</span>] = pointFlower.<span class="hljs-property">area</span>.<span class="hljs-property">x</span> * -<span class="hljs-number">1.0</span>;</span><br><span class="language-javascript">        pointFlower.<span class="hljs-property">offset</span>[<span class="hljs-number">1</span>] = pointFlower.<span class="hljs-property">area</span>.<span class="hljs-property">y</span> * <span class="hljs-number">1.0</span>;</span><br><span class="language-javascript">        pointFlower.<span class="hljs-property">offset</span>[<span class="hljs-number">2</span>] = pointFlower.<span class="hljs-property">area</span>.<span class="hljs-property">z</span> * zpos;</span><br><span class="language-javascript">        gl.<span class="hljs-title function_">uniform3fv</span>(prog.<span class="hljs-property">uniforms</span>.<span class="hljs-property">uOffset</span>, pointFlower.<span class="hljs-property">offset</span>);</span><br><span class="language-javascript">        gl.<span class="hljs-title function_">drawArrays</span>(gl.<span class="hljs-property">POINT</span>, <span class="hljs-number">0</span>, pointFlower.<span class="hljs-property">numFlowers</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">        pointFlower.<span class="hljs-property">offset</span>[<span class="hljs-number">0</span>] = pointFlower.<span class="hljs-property">area</span>.<span class="hljs-property">x</span> * <span class="hljs-number">1.0</span>;</span><br><span class="language-javascript">        pointFlower.<span class="hljs-property">offset</span>[<span class="hljs-number">1</span>] = pointFlower.<span class="hljs-property">area</span>.<span class="hljs-property">y</span> * -<span class="hljs-number">1.0</span>;</span><br><span class="language-javascript">        pointFlower.<span class="hljs-property">offset</span>[<span class="hljs-number">2</span>] = pointFlower.<span class="hljs-property">area</span>.<span class="hljs-property">z</span> * zpos;</span><br><span class="language-javascript">        gl.<span class="hljs-title function_">uniform3fv</span>(prog.<span class="hljs-property">uniforms</span>.<span class="hljs-property">uOffset</span>, pointFlower.<span class="hljs-property">offset</span>);</span><br><span class="language-javascript">        gl.<span class="hljs-title function_">drawArrays</span>(gl.<span class="hljs-property">POINT</span>, <span class="hljs-number">0</span>, pointFlower.<span class="hljs-property">numFlowers</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">        pointFlower.<span class="hljs-property">offset</span>[<span class="hljs-number">0</span>] = pointFlower.<span class="hljs-property">area</span>.<span class="hljs-property">x</span> * <span class="hljs-number">1.0</span>;</span><br><span class="language-javascript">        pointFlower.<span class="hljs-property">offset</span>[<span class="hljs-number">1</span>] = pointFlower.<span class="hljs-property">area</span>.<span class="hljs-property">y</span> * <span class="hljs-number">1.0</span>;</span><br><span class="language-javascript">        pointFlower.<span class="hljs-property">offset</span>[<span class="hljs-number">2</span>] = pointFlower.<span class="hljs-property">area</span>.<span class="hljs-property">z</span> * zpos;</span><br><span class="language-javascript">        gl.<span class="hljs-title function_">uniform3fv</span>(prog.<span class="hljs-property">uniforms</span>.<span class="hljs-property">uOffset</span>, pointFlower.<span class="hljs-property">offset</span>);</span><br><span class="language-javascript">        gl.<span class="hljs-title function_">drawArrays</span>(gl.<span class="hljs-property">POINT</span>, <span class="hljs-number">0</span>, pointFlower.<span class="hljs-property">numFlowers</span>);</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-comment">//main</span></span><br><span class="language-javascript">      pointFlower.<span class="hljs-property">offset</span>[<span class="hljs-number">0</span>] = <span class="hljs-number">0.0</span>;</span><br><span class="language-javascript">      pointFlower.<span class="hljs-property">offset</span>[<span class="hljs-number">1</span>] = <span class="hljs-number">0.0</span>;</span><br><span class="language-javascript">      pointFlower.<span class="hljs-property">offset</span>[<span class="hljs-number">2</span>] = <span class="hljs-number">0.0</span>;</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">uniform3fv</span>(prog.<span class="hljs-property">uniforms</span>.<span class="hljs-property">uOffset</span>, pointFlower.<span class="hljs-property">offset</span>);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">drawArrays</span>(gl.<span class="hljs-property">POINT</span>, <span class="hljs-number">0</span>, pointFlower.<span class="hljs-property">numFlowers</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      gl.<span class="hljs-title function_">bindBuffer</span>(gl.<span class="hljs-property">ARRAY_BUFFER</span>, <span class="hljs-literal">null</span>);</span><br><span class="language-javascript">      <span class="hljs-title function_">unuseShader</span>(prog);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      gl.<span class="hljs-title function_">enable</span>(gl.<span class="hljs-property">DEPTH_TEST</span>);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">disable</span>(gl.<span class="hljs-property">BLEND</span>);</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-comment">// effects</span></span><br><span class="language-javascript">    <span class="hljs-comment">//common util</span></span><br><span class="language-javascript">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">createEffectProgram</span>(<span class="hljs-params">vtxsrc, frgsrc, exunifs, exattrs</span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> ret = &#123;&#125;;</span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> unifs = [<span class="hljs-string">&#x27;uResolution&#x27;</span>, <span class="hljs-string">&#x27;uSrc&#x27;</span>, <span class="hljs-string">&#x27;uDelta&#x27;</span>];</span><br><span class="language-javascript">      <span class="hljs-keyword">if</span> (exunifs) &#123;</span><br><span class="language-javascript">        unifs = unifs.<span class="hljs-title function_">concat</span>(exunifs);</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> attrs = [<span class="hljs-string">&#x27;aPosition&#x27;</span>];</span><br><span class="language-javascript">      <span class="hljs-keyword">if</span> (exattrs) &#123;</span><br><span class="language-javascript">        attrs = attrs.<span class="hljs-title function_">concat</span>(exattrs);</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">      ret.<span class="hljs-property">program</span> = <span class="hljs-title function_">createShader</span>(vtxsrc, frgsrc, unifs, attrs);</span><br><span class="language-javascript">      <span class="hljs-title function_">useShader</span>(ret.<span class="hljs-property">program</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      ret.<span class="hljs-property">dataArray</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>([</span><br><span class="language-javascript">        -<span class="hljs-number">1.0</span>, -<span class="hljs-number">1.0</span>,</span><br><span class="language-javascript">        <span class="hljs-number">1.0</span>, -<span class="hljs-number">1.0</span>,</span><br><span class="language-javascript">        -<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>,</span><br><span class="language-javascript">        <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span></span><br><span class="language-javascript">      ]);</span><br><span class="language-javascript">      ret.<span class="hljs-property">buffer</span> = gl.<span class="hljs-title function_">createBuffer</span>();</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">bindBuffer</span>(gl.<span class="hljs-property">ARRAY_BUFFER</span>, ret.<span class="hljs-property">buffer</span>);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">bufferData</span>(gl.<span class="hljs-property">ARRAY_BUFFER</span>, ret.<span class="hljs-property">dataArray</span>, gl.<span class="hljs-property">STATIC_DRAW</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      gl.<span class="hljs-title function_">bindBuffer</span>(gl.<span class="hljs-property">ARRAY_BUFFER</span>, <span class="hljs-literal">null</span>);</span><br><span class="language-javascript">      <span class="hljs-title function_">unuseShader</span>(ret.<span class="hljs-property">program</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">return</span> ret;</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">useEffect</span>(<span class="hljs-params">fxobj, srctex</span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> prog = fxobj.<span class="hljs-property">program</span>;</span><br><span class="language-javascript">      <span class="hljs-title function_">useShader</span>(prog);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">uniform3fv</span>(prog.<span class="hljs-property">uniforms</span>.<span class="hljs-property">uResolution</span>, renderSpec.<span class="hljs-property">array</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">if</span> (srctex != <span class="hljs-literal">null</span>) &#123;</span><br><span class="language-javascript">        gl.<span class="hljs-title function_">uniform2fv</span>(prog.<span class="hljs-property">uniforms</span>.<span class="hljs-property">uDelta</span>, srctex.<span class="hljs-property">dtxArray</span>);</span><br><span class="language-javascript">        gl.<span class="hljs-title function_">uniform1i</span>(prog.<span class="hljs-property">uniforms</span>.<span class="hljs-property">uSrc</span>, <span class="hljs-number">0</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">        gl.<span class="hljs-title function_">activeTexture</span>(gl.<span class="hljs-property">TEXTURE0</span>);</span><br><span class="language-javascript">        gl.<span class="hljs-title function_">bindTexture</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, srctex.<span class="hljs-property">texture</span>);</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">drawEffect</span>(<span class="hljs-params">fxobj</span>) &#123;</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">bindBuffer</span>(gl.<span class="hljs-property">ARRAY_BUFFER</span>, fxobj.<span class="hljs-property">buffer</span>);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">vertexAttribPointer</span>(fxobj.<span class="hljs-property">program</span>.<span class="hljs-property">attributes</span>.<span class="hljs-property">aPosition</span>, <span class="hljs-number">2</span>, gl.<span class="hljs-property">FLOAT</span>, <span class="hljs-literal">false</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">drawArrays</span>(gl.<span class="hljs-property">TRIANGLE_STRIP</span>, <span class="hljs-number">0</span>, <span class="hljs-number">4</span>);</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">unuseEffect</span>(<span class="hljs-params">fxobj</span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-title function_">unuseShader</span>(fxobj.<span class="hljs-property">program</span>);</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> effectLib = &#123;&#125;;</span><br><span class="language-javascript">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">createEffectLib</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> vtxsrc, frgsrc;</span><br><span class="language-javascript">      <span class="hljs-comment">//common</span></span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> cmnvtxsrc = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;fx_common_vsh&quot;</span>).<span class="hljs-property">textContent</span>;</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-comment">//background</span></span><br><span class="language-javascript">      frgsrc = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;bg_fsh&quot;</span>).<span class="hljs-property">textContent</span>;</span><br><span class="language-javascript">      effectLib.<span class="hljs-property">sceneBg</span> = <span class="hljs-title function_">createEffectProgram</span>(cmnvtxsrc, frgsrc, [<span class="hljs-string">&#x27;uTimes&#x27;</span>], <span class="hljs-literal">null</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-comment">// make brightpixels buffer</span></span><br><span class="language-javascript">      frgsrc = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;fx_brightbuf_fsh&quot;</span>).<span class="hljs-property">textContent</span>;</span><br><span class="language-javascript">      effectLib.<span class="hljs-property">mkBrightBuf</span> = <span class="hljs-title function_">createEffectProgram</span>(cmnvtxsrc, frgsrc, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-comment">// direction blur</span></span><br><span class="language-javascript">      frgsrc = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;fx_dirblur_r4_fsh&quot;</span>).<span class="hljs-property">textContent</span>;</span><br><span class="language-javascript">      effectLib.<span class="hljs-property">dirBlur</span> = <span class="hljs-title function_">createEffectProgram</span>(cmnvtxsrc, frgsrc, [<span class="hljs-string">&#x27;uBlurDir&#x27;</span>], <span class="hljs-literal">null</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-comment">//final composite</span></span><br><span class="language-javascript">      vtxsrc = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;pp_final_vsh&quot;</span>).<span class="hljs-property">textContent</span>;</span><br><span class="language-javascript">      frgsrc = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;pp_final_fsh&quot;</span>).<span class="hljs-property">textContent</span>;</span><br><span class="language-javascript">      effectLib.<span class="hljs-property">finalComp</span> = <span class="hljs-title function_">createEffectProgram</span>(vtxsrc, frgsrc, [<span class="hljs-string">&#x27;uBloom&#x27;</span>], <span class="hljs-literal">null</span>);</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-comment">// background</span></span><br><span class="language-javascript">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">createBackground</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-comment">//console.log(&quot;create background&quot;);</span></span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">initBackground</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-comment">//console.log(&quot;init background&quot;);</span></span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">renderBackground</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">disable</span>(gl.<span class="hljs-property">DEPTH_TEST</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title function_">useEffect</span>(effectLib.<span class="hljs-property">sceneBg</span>, <span class="hljs-literal">null</span>);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">uniform2f</span>(effectLib.<span class="hljs-property">sceneBg</span>.<span class="hljs-property">program</span>.<span class="hljs-property">uniforms</span>.<span class="hljs-property">uTimes</span>, timeInfo.<span class="hljs-property">elapsed</span>, timeInfo.<span class="hljs-property">delta</span>);</span><br><span class="language-javascript">      <span class="hljs-title function_">drawEffect</span>(effectLib.<span class="hljs-property">sceneBg</span>);</span><br><span class="language-javascript">      <span class="hljs-title function_">unuseEffect</span>(effectLib.<span class="hljs-property">sceneBg</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      gl.<span class="hljs-title function_">enable</span>(gl.<span class="hljs-property">DEPTH_TEST</span>);</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-comment">// post process</span></span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> postProcess = &#123;&#125;;</span><br><span class="language-javascript">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">createPostProcess</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-comment">//console.log(&quot;create post process&quot;);</span></span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">initPostProcess</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-comment">//console.log(&quot;init post process&quot;);</span></span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">renderPostProcess</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">enable</span>(gl.<span class="hljs-property">TEXTURE_2D</span>);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">disable</span>(gl.<span class="hljs-property">DEPTH_TEST</span>);</span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> bindRT = <span class="hljs-keyword">function</span> (<span class="hljs-params">rt, isclear</span>) &#123;</span><br><span class="language-javascript">        gl.<span class="hljs-title function_">bindFramebuffer</span>(gl.<span class="hljs-property">FRAMEBUFFER</span>, rt.<span class="hljs-property">frameBuffer</span>);</span><br><span class="language-javascript">        gl.<span class="hljs-title function_">viewport</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, rt.<span class="hljs-property">width</span>, rt.<span class="hljs-property">height</span>);</span><br><span class="language-javascript">        <span class="hljs-keyword">if</span> (isclear) &#123;</span><br><span class="language-javascript">          gl.<span class="hljs-title function_">clearColor</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);</span><br><span class="language-javascript">          gl.<span class="hljs-title function_">clear</span>(gl.<span class="hljs-property">COLOR_BUFFER_BIT</span> | gl.<span class="hljs-property">DEPTH_BUFFER_BIT</span>);</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">      &#125;;</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-comment">//make bright buff</span></span><br><span class="language-javascript">      <span class="hljs-title function_">bindRT</span>(renderSpec.<span class="hljs-property">wHalfRT0</span>, <span class="hljs-literal">true</span>);</span><br><span class="language-javascript">      <span class="hljs-title function_">useEffect</span>(effectLib.<span class="hljs-property">mkBrightBuf</span>, renderSpec.<span class="hljs-property">mainRT</span>);</span><br><span class="language-javascript">      <span class="hljs-title function_">drawEffect</span>(effectLib.<span class="hljs-property">mkBrightBuf</span>);</span><br><span class="language-javascript">      <span class="hljs-title function_">unuseEffect</span>(effectLib.<span class="hljs-property">mkBrightBuf</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-comment">// make bloom</span></span><br><span class="language-javascript">      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++) &#123;</span><br><span class="language-javascript">        <span class="hljs-keyword">var</span> p = <span class="hljs-number">1.5</span> + <span class="hljs-number">1</span> * i;</span><br><span class="language-javascript">        <span class="hljs-keyword">var</span> s = <span class="hljs-number">2.0</span> + <span class="hljs-number">1</span> * i;</span><br><span class="language-javascript">        <span class="hljs-title function_">bindRT</span>(renderSpec.<span class="hljs-property">wHalfRT1</span>, <span class="hljs-literal">true</span>);</span><br><span class="language-javascript">        <span class="hljs-title function_">useEffect</span>(effectLib.<span class="hljs-property">dirBlur</span>, renderSpec.<span class="hljs-property">wHalfRT0</span>);</span><br><span class="language-javascript">        gl.<span class="hljs-title function_">uniform4f</span>(effectLib.<span class="hljs-property">dirBlur</span>.<span class="hljs-property">program</span>.<span class="hljs-property">uniforms</span>.<span class="hljs-property">uBlurDir</span>, p, <span class="hljs-number">0.0</span>, s, <span class="hljs-number">0.0</span>);</span><br><span class="language-javascript">        <span class="hljs-title function_">drawEffect</span>(effectLib.<span class="hljs-property">dirBlur</span>);</span><br><span class="language-javascript">        <span class="hljs-title function_">unuseEffect</span>(effectLib.<span class="hljs-property">dirBlur</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-title function_">bindRT</span>(renderSpec.<span class="hljs-property">wHalfRT0</span>, <span class="hljs-literal">true</span>);</span><br><span class="language-javascript">        <span class="hljs-title function_">useEffect</span>(effectLib.<span class="hljs-property">dirBlur</span>, renderSpec.<span class="hljs-property">wHalfRT1</span>);</span><br><span class="language-javascript">        gl.<span class="hljs-title function_">uniform4f</span>(effectLib.<span class="hljs-property">dirBlur</span>.<span class="hljs-property">program</span>.<span class="hljs-property">uniforms</span>.<span class="hljs-property">uBlurDir</span>, <span class="hljs-number">0.0</span>, p, <span class="hljs-number">0.0</span>, s);</span><br><span class="language-javascript">        <span class="hljs-title function_">drawEffect</span>(effectLib.<span class="hljs-property">dirBlur</span>);</span><br><span class="language-javascript">        <span class="hljs-title function_">unuseEffect</span>(effectLib.<span class="hljs-property">dirBlur</span>);</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-comment">//display</span></span><br><span class="language-javascript">      gl.<span class="hljs-title function_">bindFramebuffer</span>(gl.<span class="hljs-property">FRAMEBUFFER</span>, <span class="hljs-literal">null</span>);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">viewport</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, renderSpec.<span class="hljs-property">width</span>, renderSpec.<span class="hljs-property">height</span>);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">clear</span>(gl.<span class="hljs-property">COLOR_BUFFER_BIT</span> | gl.<span class="hljs-property">DEPTH_BUFFER_BIT</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title function_">useEffect</span>(effectLib.<span class="hljs-property">finalComp</span>, renderSpec.<span class="hljs-property">mainRT</span>);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">uniform1i</span>(effectLib.<span class="hljs-property">finalComp</span>.<span class="hljs-property">program</span>.<span class="hljs-property">uniforms</span>.<span class="hljs-property">uBloom</span>, <span class="hljs-number">1</span>);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">activeTexture</span>(gl.<span class="hljs-property">TEXTURE1</span>);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">bindTexture</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, renderSpec.<span class="hljs-property">wHalfRT0</span>.<span class="hljs-property">texture</span>);</span><br><span class="language-javascript">      <span class="hljs-title function_">drawEffect</span>(effectLib.<span class="hljs-property">finalComp</span>);</span><br><span class="language-javascript">      <span class="hljs-title function_">unuseEffect</span>(effectLib.<span class="hljs-property">finalComp</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      gl.<span class="hljs-title function_">enable</span>(gl.<span class="hljs-property">DEPTH_TEST</span>);</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> <span class="hljs-title class_">SceneEnv</span> = &#123;&#125;;</span><br><span class="language-javascript">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">createScene</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-title function_">createEffectLib</span>();</span><br><span class="language-javascript">      <span class="hljs-title function_">createBackground</span>();</span><br><span class="language-javascript">      <span class="hljs-title function_">createPointFlowers</span>();</span><br><span class="language-javascript">      <span class="hljs-title function_">createPostProcess</span>();</span><br><span class="language-javascript">      sceneStandBy = <span class="hljs-literal">true</span>;</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">initScene</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-title function_">initBackground</span>();</span><br><span class="language-javascript">      <span class="hljs-title function_">initPointFlowers</span>();</span><br><span class="language-javascript">      <span class="hljs-title function_">initPostProcess</span>();</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-comment">//camera.position.z = 17.320508;</span></span><br><span class="language-javascript">      camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = pointFlower.<span class="hljs-property">area</span>.<span class="hljs-property">z</span> + projection.<span class="hljs-property">nearfar</span>[<span class="hljs-number">0</span>];</span><br><span class="language-javascript">      projection.<span class="hljs-property">angle</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">atan2</span>(pointFlower.<span class="hljs-property">area</span>.<span class="hljs-property">y</span>, camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> + pointFlower.<span class="hljs-property">area</span>.<span class="hljs-property">z</span>) * <span class="hljs-number">180.0</span> / <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2.0</span>;</span><br><span class="language-javascript">      <span class="hljs-title class_">Matrix44</span>.<span class="hljs-title function_">loadProjection</span>(projection.<span class="hljs-property">matrix</span>, renderSpec.<span class="hljs-property">aspect</span>, projection.<span class="hljs-property">angle</span>, projection.<span class="hljs-property">nearfar</span>[<span class="hljs-number">0</span>], projection.<span class="hljs-property">nearfar</span>[<span class="hljs-number">1</span>]);</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">renderScene</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-comment">//draw</span></span><br><span class="language-javascript">      <span class="hljs-title class_">Matrix44</span>.<span class="hljs-title function_">loadLookAt</span>(camera.<span class="hljs-property">matrix</span>, camera.<span class="hljs-property">position</span>, camera.<span class="hljs-property">lookat</span>, camera.<span class="hljs-property">up</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      gl.<span class="hljs-title function_">enable</span>(gl.<span class="hljs-property">DEPTH_TEST</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-comment">//gl.bindFramebuffer(gl.FRAMEBUFFER, null);</span></span><br><span class="language-javascript">      gl.<span class="hljs-title function_">bindFramebuffer</span>(gl.<span class="hljs-property">FRAMEBUFFER</span>, renderSpec.<span class="hljs-property">mainRT</span>.<span class="hljs-property">frameBuffer</span>);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">viewport</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, renderSpec.<span class="hljs-property">mainRT</span>.<span class="hljs-property">width</span>, renderSpec.<span class="hljs-property">mainRT</span>.<span class="hljs-property">height</span>);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">clearColor</span>(<span class="hljs-number">0.005</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.05</span>, <span class="hljs-number">0</span>);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">clear</span>(gl.<span class="hljs-property">COLOR_BUFFER_BIT</span> | gl.<span class="hljs-property">DEPTH_BUFFER_BIT</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title function_">renderBackground</span>();</span><br><span class="language-javascript">      <span class="hljs-title function_">renderPointFlowers</span>();</span><br><span class="language-javascript">      <span class="hljs-title function_">renderPostProcess</span>();</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">onResize</span>(<span class="hljs-params">e</span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-title function_">makeCanvasFullScreen</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;sakura&quot;</span>));</span><br><span class="language-javascript">      <span class="hljs-title function_">setViewports</span>();</span><br><span class="language-javascript">      <span class="hljs-keyword">if</span> (sceneStandBy) &#123;</span><br><span class="language-javascript">        <span class="hljs-title function_">initScene</span>();</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">setViewports</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">      renderSpec.<span class="hljs-title function_">setSize</span>(gl.<span class="hljs-property">canvas</span>.<span class="hljs-property">width</span>, gl.<span class="hljs-property">canvas</span>.<span class="hljs-property">height</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      gl.<span class="hljs-title function_">clearColor</span>(<span class="hljs-number">0.2</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">1.0</span>);</span><br><span class="language-javascript">      gl.<span class="hljs-title function_">viewport</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, renderSpec.<span class="hljs-property">width</span>, renderSpec.<span class="hljs-property">height</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> rtfunc = <span class="hljs-keyword">function</span> (<span class="hljs-params">rtname, rtw, rth</span>) &#123;</span><br><span class="language-javascript">        <span class="hljs-keyword">var</span> rt = renderSpec[rtname];</span><br><span class="language-javascript">        <span class="hljs-keyword">if</span> (rt) <span class="hljs-title function_">deleteRenderTarget</span>(rt);</span><br><span class="language-javascript">        renderSpec[rtname] = <span class="hljs-title function_">createRenderTarget</span>(rtw, rth);</span><br><span class="language-javascript">      &#125;;</span><br><span class="language-javascript">      <span class="hljs-title function_">rtfunc</span>(<span class="hljs-string">&#x27;mainRT&#x27;</span>, renderSpec.<span class="hljs-property">width</span>, renderSpec.<span class="hljs-property">height</span>);</span><br><span class="language-javascript">      <span class="hljs-title function_">rtfunc</span>(<span class="hljs-string">&#x27;wFullRT0&#x27;</span>, renderSpec.<span class="hljs-property">width</span>, renderSpec.<span class="hljs-property">height</span>);</span><br><span class="language-javascript">      <span class="hljs-title function_">rtfunc</span>(<span class="hljs-string">&#x27;wFullRT1&#x27;</span>, renderSpec.<span class="hljs-property">width</span>, renderSpec.<span class="hljs-property">height</span>);</span><br><span class="language-javascript">      <span class="hljs-title function_">rtfunc</span>(<span class="hljs-string">&#x27;wHalfRT0&#x27;</span>, renderSpec.<span class="hljs-property">halfWidth</span>, renderSpec.<span class="hljs-property">halfHeight</span>);</span><br><span class="language-javascript">      <span class="hljs-title function_">rtfunc</span>(<span class="hljs-string">&#x27;wHalfRT1&#x27;</span>, renderSpec.<span class="hljs-property">halfWidth</span>, renderSpec.<span class="hljs-property">halfHeight</span>);</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-title function_">renderScene</span>();</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> animating = <span class="hljs-literal">true</span>;</span><br><span class="language-javascript">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">toggleAnimation</span>(<span class="hljs-params">elm</span>) &#123;</span><br><span class="language-javascript">      animating ^= <span class="hljs-literal">true</span>;</span><br><span class="language-javascript">      <span class="hljs-keyword">if</span> (animating) <span class="hljs-title function_">animate</span>();</span><br><span class="language-javascript">      <span class="hljs-keyword">if</span> (elm) &#123;</span><br><span class="language-javascript">        elm.<span class="hljs-property">innerHTML</span> = animating ? <span class="hljs-string">&quot;Stop&quot;</span> : <span class="hljs-string">&quot;Start&quot;</span>;</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">stepAnimation</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-keyword">if</span> (!animating) <span class="hljs-title function_">animate</span>();</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">animate</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> curdate = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();</span><br><span class="language-javascript">      timeInfo.<span class="hljs-property">elapsed</span> = (curdate - timeInfo.<span class="hljs-property">start</span>) / <span class="hljs-number">1000.0</span>;</span><br><span class="language-javascript">      timeInfo.<span class="hljs-property">delta</span> = (curdate - timeInfo.<span class="hljs-property">prev</span>) / <span class="hljs-number">1000.0</span>;</span><br><span class="language-javascript">      timeInfo.<span class="hljs-property">prev</span> = curdate;</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">if</span> (animating) <span class="hljs-title function_">requestAnimationFrame</span>(animate);</span><br><span class="language-javascript">      <span class="hljs-title function_">render</span>();</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">makeCanvasFullScreen</span>(<span class="hljs-params">canvas</span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> b = <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>;</span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> d = <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>;</span><br><span class="language-javascript">      fullw = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(b.<span class="hljs-property">clientWidth</span>, b.<span class="hljs-property">scrollWidth</span>, d.<span class="hljs-property">scrollWidth</span>, d.<span class="hljs-property">clientWidth</span>);</span><br><span class="language-javascript">      fullh = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(b.<span class="hljs-property">clientHeight</span>, b.<span class="hljs-property">scrollHeight</span>, d.<span class="hljs-property">scrollHeight</span>, d.<span class="hljs-property">clientHeight</span>);</span><br><span class="language-javascript">      canvas.<span class="hljs-property">width</span> = fullw;</span><br><span class="language-javascript">      canvas.<span class="hljs-property">height</span> = fullh;</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;load&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> canvas = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;sakura&quot;</span>);</span><br><span class="language-javascript">      <span class="hljs-keyword">try</span> &#123;</span><br><span class="language-javascript">        <span class="hljs-title function_">makeCanvasFullScreen</span>(canvas);</span><br><span class="language-javascript">        gl = canvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">&#x27;experimental-webgl&#x27;</span>);</span><br><span class="language-javascript">      &#125; <span class="hljs-keyword">catch</span> (e) &#123;</span><br><span class="language-javascript">        <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;WebGL not supported.&quot;</span> + e);</span><br><span class="language-javascript">        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(e);</span><br><span class="language-javascript">        <span class="hljs-keyword">return</span>;</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;resize&#x27;</span>, onResize);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title function_">setViewports</span>();</span><br><span class="language-javascript">      <span class="hljs-title function_">createScene</span>();</span><br><span class="language-javascript">      <span class="hljs-title function_">initScene</span>();</span><br><span class="language-javascript"></span><br><span class="language-javascript">      timeInfo.<span class="hljs-property">start</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();</span><br><span class="language-javascript">      timeInfo.<span class="hljs-property">prev</span> = timeInfo.<span class="hljs-property">start</span>;</span><br><span class="language-javascript">      <span class="hljs-title function_">animate</span>();</span><br><span class="language-javascript">    &#125;);</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-comment">//set window.requestAnimationFrame</span></span><br><span class="language-javascript">    (<span class="hljs-keyword">function</span> (<span class="hljs-params">w, r</span>) &#123;</span><br><span class="language-javascript">      w[<span class="hljs-string">&#x27;r&#x27;</span> + r] = w[<span class="hljs-string">&#x27;r&#x27;</span> + r] || w[<span class="hljs-string">&#x27;webkitR&#x27;</span> + r] || w[<span class="hljs-string">&#x27;mozR&#x27;</span> + r] || w[<span class="hljs-string">&#x27;msR&#x27;</span> + r] || w[<span class="hljs-string">&#x27;oR&#x27;</span> + r] || <span class="hljs-keyword">function</span> (<span class="hljs-params">c</span>) &#123; w.<span class="hljs-built_in">setTimeout</span>(c, <span class="hljs-number">1000</span> / <span class="hljs-number">60</span>); &#125;;</span><br><span class="language-javascript">    &#125;)(<span class="hljs-variable language_">window</span>, <span class="hljs-string">&#x27;equestAnimationFrame&#x27;</span>);</span><br><span class="language-javascript">  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CSS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>樱花</tag>
      
      <tag>CSS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>局域网内共享文件夹</title>
    <link href="/%E5%B1%80%E5%9F%9F%E7%BD%91/%E5%B1%80%E5%9F%9F%E7%BD%91%E5%86%85%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6%E5%A4%B9/"/>
    <url>/%E5%B1%80%E5%9F%9F%E7%BD%91/%E5%B1%80%E5%9F%9F%E7%BD%91%E5%86%85%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6%E5%A4%B9/</url>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>有时候给同学需要发实验, 但是实验贼泥马的多<br><img src="/assets/43e1108031924763a9c4bad5b12e30ed.png"><br>这个时候如果还挨个用 QQ 发送文件夹就显得非常蛋疼</p><h2 id="开搞"><a href="#开搞" class="headerlink" title="开搞"></a>开搞</h2><p>因为平时我的实验都会放在一个固定的文件夹中, 所以只需要把这个文件夹共享出去, 对面同样连接着校园网就能直接访问到这个共享文件夹</p><h4 id="修改一个好记的主机名"><a href="#修改一个好记的主机名" class="headerlink" title="修改一个好记的主机名"></a>修改一个好记的主机名</h4><p><img src="/assets/01d8ef930faf4b6bb5c4324555cf4b27.png"><br>主要就是为了好记</p><h4 id="共享文件夹"><a href="#共享文件夹" class="headerlink" title="共享文件夹"></a>共享文件夹</h4><p>选中要共享的文件夹, 右键属性, 共享, 可以给 Everyone 设置访问权限<br><img src="/assets/d8cc7b0c361d4256b5d0c37739cfcd49.png"><br><img src="/assets/513e785aad5242a9b664d05bdfdcd17b.png"></p><h4 id="去掉密码保护"><a href="#去掉密码保护" class="headerlink" title="去掉密码保护"></a>去掉密码保护</h4><p>去掉密码保护之后, 别人就能不需要密码就能直接连接上共享文件夹<br><img src="/assets/a8502aff12594f44ba806a848428a18c.png"></p><h4 id="设置安全策略"><a href="#设置安全策略" class="headerlink" title="设置安全策略"></a>设置安全策略</h4><p>控制面板 - 防火墙 - 高级设置 - 入站规则 - 新建规则<br><img src="/assets/4013afdeb1554983ba8a88153499ac3d.png"><br>选择端口<br><img src="/assets/1a055d3da10f493aa8619ab7e9643d22.png"><br>输入 135-139,445<br><img src="/assets/ecae0466a9f64108ba00f4fac2022177.png"><br><img src="/assets/a7bd90d16b9649d5ab0f558966b433f7.png"><br><img src="/assets/91e32302cd9a4d0e98e283f1924497ec.png"><br><img src="/assets/ac2ba8012384402cbaf960ae65f97e93.png"><br>出现文件共享说明共享成功<br><img src="/assets/89fa960d4b7245d7b4723c6528c4289a.png"></p><h4 id="远程"><a href="#远程" class="headerlink" title="远程"></a>远程</h4><p>对面只要 win + r 输入你的主机名就可以访问共享文件夹</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livescript"><span class="hljs-string">\\roudoukouya</span><br></code></pre></td></tr></table></figure><p><img src="/assets/0162d77817614cc3bd4469d9b0920ff9.png"></p><h2 id="瞎逼逼"><a href="#瞎逼逼" class="headerlink" title="瞎逼逼"></a>瞎逼逼</h2><p>妈的作业太鸡巴多了<br><img src="/assets/14b33d90948542faadcd785d89ed8c8e.png"></p>]]></content>
    
    
    <categories>
      
      <category>局域网</category>
      
    </categories>
    
    
    <tags>
      
      <tag>局域网</tag>
      
      <tag>共享文件夹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PicGo</title>
    <link href="/%E8%BD%AF%E4%BB%B6/PicGo/"/>
    <url>/%E8%BD%AF%E4%BB%B6/PicGo/</url>
    
    <content type="html"><![CDATA[<blockquote><p>PicGo: 一个用于快速上传图片并获取图片 URL 链接的工具</p></blockquote><p>下载<a href="https://github.com/Molunerfinn/PicGo/releases">PicGo</a>, 双击 exe 文件运行<br><img src="/assets/4341632574bd4378a7b5a83cca5607a4.png"><br>配置相关的信息<br><img src="/assets/63f64961c08f4019802f2717b1d6e181.png"></p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">KeyId: XXX</span><br><span class="hljs-section">KeySecret: XXX</span><br><span class="hljs-section">Bucket: fine-food</span><br><span class="hljs-section">区域: oss-cn-shenzhen</span><br><span class="hljs-section">自定义域名: https://food.xiamu.icu</span><br></code></pre></td></tr></table></figure><p>可能当你看见这篇文档时, 这些秘钥都已经失效了<br>上传文件了, 就会保存在剪切板中</p>]]></content>
    
    
    <categories>
      
      <category>软件</category>
      
    </categories>
    
    
    <tags>
      
      <tag>软件</tag>
      
      <tag>小工具</tag>
      
      <tag>PicGo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MongoDB</title>
    <link href="/%E5%89%8D%E7%AB%AF/MongoDB/"/>
    <url>/%E5%89%8D%E7%AB%AF/MongoDB/</url>
    
    <content type="html"><![CDATA[<h2 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h2><p>数据库（database） 数据库是一个数据仓库，数据库服务下可以创建很多数据库，数据库中可以存放很多集合<br>集合（collection） 集合类似于 JS 中的数组，在集合中可以存放很多文档<br>文档（document） 文档是数据库中的最小单位，类似于 JS 中的对象</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;accounts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;3-YLju5f3&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;买电脑&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;time&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2023-02-08&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;-1&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;account&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;5500&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;remarks&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;为了上网课&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;3-YLju5f4&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;请女朋友吃饭&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;time&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2023-02-08&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;-1&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;account&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;214&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;remarks&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;情人节聚餐&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;mRQiD4s3K&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;发工资&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;time&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2023-02-19&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;account&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;4396&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;remarks&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;终于发工资啦!~~&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;users&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;zhangsan&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;age&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">18</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;lisi&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;age&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;wangwu&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;age&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">22</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><p><a href="https://www.mongodb.com/try/download/community">https://www.mongodb.com/try/download/community</a><br><img src="/assets/67ed48ea04474b14b483182a88064d65.png"><br>可以不选择最新版, 直接选择 msi 文件<br><img src="/assets/03a691b52e3345d4a025399a547c4f09.png"></p><h2 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h2><p>默认端口是 27017<br>给 bin 目录配置好环境变量之后, bin 目录配置到 PATH 目录<br>控制台直接输入</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">mongo<br></code></pre></td></tr></table></figure><p>查看所有的数据库</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">&gt; show dbs<br></code></pre></td></tr></table></figure><h2 id="命令行交互"><a href="#命令行交互" class="headerlink" title="命令行交互"></a>命令行交互</h2><h3 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h3><p>查看所有的数据库</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">show dbs<br></code></pre></td></tr></table></figure><p>切换数据库(如果没有数据库, 就会创建这个数据库)<br>tip:创建的数据库需要插入数据才能用 show dbs 查看到</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">use bilibili<br></code></pre></td></tr></table></figure><p>创建集合</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">db.createCollection(&#x27;users&#x27;)<br></code></pre></td></tr></table></figure><p>删除数据库, 需要先切换到对应的数据库下</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">db.dropDatabase();<br></code></pre></td></tr></table></figure><p>查看所有集合</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">show collections<br></code></pre></td></tr></table></figure><p>查看当前所在的 db</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">db<br></code></pre></td></tr></table></figure><p>删除集合</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">db.users.drop()<br></code></pre></td></tr></table></figure><h2 id="文档命令"><a href="#文档命令" class="headerlink" title="文档命令"></a>文档命令</h2><p>插入数据</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json">db.users.insert(<span class="hljs-punctuation">&#123;</span>name<span class="hljs-punctuation">:</span> &#x27;侯翠翠&#x27;<span class="hljs-punctuation">,</span> age<span class="hljs-punctuation">:</span> <span class="hljs-number">18</span><span class="hljs-punctuation">&#125;</span>)<br>db.users.insert(<span class="hljs-punctuation">&#123;</span>name<span class="hljs-punctuation">:</span> &#x27;哈奶啤&#x27;<span class="hljs-punctuation">,</span> age<span class="hljs-punctuation">:</span> <span class="hljs-number">19</span><span class="hljs-punctuation">&#125;</span>)<br>db.users.insert(<span class="hljs-punctuation">&#123;</span>name<span class="hljs-punctuation">:</span> &#x27;森树&#x27;<span class="hljs-punctuation">,</span> age<span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">&#125;</span>))<br>db.users.insert(<span class="hljs-punctuation">&#123;</span>name<span class="hljs-punctuation">:</span> &#x27;张三&#x27;<span class="hljs-punctuation">,</span> age<span class="hljs-punctuation">:</span> <span class="hljs-number">30</span><span class="hljs-punctuation">&#125;</span>)<br></code></pre></td></tr></table></figure><p>查看文档中数据</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">db.users.find()<br></code></pre></td></tr></table></figure><p>查询某一个数据, 按照年龄查询</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">db.users.find(<span class="hljs-punctuation">&#123;</span>age<span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">&#125;</span>)<br></code></pre></td></tr></table></figure><p>更新数据</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json">db.users.update(<span class="hljs-punctuation">&#123;</span>name<span class="hljs-punctuation">:</span> &#x27;张三&#x27;<span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">&#123;</span>age<span class="hljs-punctuation">:</span> <span class="hljs-number">25</span><span class="hljs-punctuation">&#125;</span>)<br>db.users.find()<br><br></code></pre></td></tr></table></figure><p>我们发现张三的名字没了, 此时修改的数据会覆盖掉之前字段<img src="/assets/948bb30cde6a4a6b87833f6eb247e7dc.png"><br>我们可以使用$set 来更新字段</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">db.users.update(<span class="hljs-punctuation">&#123;</span>name<span class="hljs-punctuation">:</span> &#x27;张三&#x27;<span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">&#123;</span>$set<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>age<span class="hljs-punctuation">:</span> <span class="hljs-number">32</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">&#125;</span>)<br></code></pre></td></tr></table></figure><p><img src="/assets/4d5222ae63ed4def849b390f2bb872b0.png"><br>此时的张三的名字就没有丢失了<br>删除数据</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">db.users.remove(<span class="hljs-punctuation">&#123;</span>name<span class="hljs-punctuation">:</span> &#x27;张三&#x27;<span class="hljs-punctuation">&#125;</span>)<br></code></pre></td></tr></table></figure><h2 id="使用-mongoose"><a href="#使用-mongoose" class="headerlink" title="使用 mongoose"></a>使用 mongoose</h2><p>使用 mongoose 可以用代码来操控 mongodb</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs json">npm init<br>npm i mongoose<br></code></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-comment">// 1.安装mongoose</span><br><span class="hljs-comment">// 2.导入mongoose</span><br><br>const mongoose = require(&#x27;mongoose&#x27;);<br><br><span class="hljs-comment">// 3.连接mongodb服务</span><br>mongoose.connect(&#x27;mongodb<span class="hljs-punctuation">:</span><span class="hljs-comment">//127.0.0.1:27017/bilibili&#x27;)</span><br><br><span class="hljs-comment">// 设置连接成功的回调 once 一次 时间回调函数只执行一次 当然也可以用on, 但是更推荐使用once</span><br>mongoose.connection.once(&#x27;open&#x27;<span class="hljs-punctuation">,</span> () =&gt; <span class="hljs-punctuation">&#123;</span><br>    console.log(&#x27;连接成功&#x27;);<br><span class="hljs-punctuation">&#125;</span>)<br><br><span class="hljs-comment">// 设置连接错误的回调</span><br>mongoose.connection.on(&#x27;error&#x27;<span class="hljs-punctuation">,</span> () =&gt; <span class="hljs-punctuation">&#123;</span><br>    console.log(&#x27;连接失败&#x27;);<br><span class="hljs-punctuation">&#125;</span>)<br><br><span class="hljs-comment">// 设置连接关闭的回调</span><br>mongoose.connection.on(&#x27;close&#x27;<span class="hljs-punctuation">,</span> () =&gt; <span class="hljs-punctuation">&#123;</span><br>    console.log(&#x27;连接关闭&#x27;);<br><span class="hljs-punctuation">&#125;</span>)<br><br><span class="hljs-comment">// 关闭mongodb的连接</span><br>setTimeout(() =&gt; <span class="hljs-punctuation">&#123;</span><br>    mongoose.disconnect()<br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span> <span class="hljs-number">2000</span>);<br></code></pre></td></tr></table></figure><h2 id="文档的创建"><a href="#文档的创建" class="headerlink" title="文档的创建"></a>文档的创建</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-comment">// 1.安装mongoose</span><br><span class="hljs-comment">// 2.导入mongoose</span><br><br>const mongoose = require(&#x27;mongoose&#x27;);<br><br><span class="hljs-comment">// 3.连接mongodb服务</span><br>mongoose.connect(&#x27;mongodb<span class="hljs-punctuation">:</span><span class="hljs-comment">//127.0.0.1:27017/bilibili&#x27;)</span><br><br><span class="hljs-comment">// 4.设置连接成功的回调</span><br>mongoose.connection.once(&#x27;open&#x27;<span class="hljs-punctuation">,</span> () =&gt; <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-comment">// console.log(&#x27;连接成功&#x27;);</span><br>    <span class="hljs-comment">// 5.创建文档的结构对象</span><br>    <span class="hljs-comment">// 设置集合中文档的属性以及属性值的类型</span><br>    let BookSchema = new mongoose.Schema(<span class="hljs-punctuation">&#123;</span><br>        name<span class="hljs-punctuation">:</span> String<span class="hljs-punctuation">,</span><br>        author<span class="hljs-punctuation">:</span> String<span class="hljs-punctuation">,</span><br>        price<span class="hljs-punctuation">:</span> Number<br>    <span class="hljs-punctuation">&#125;</span>);<br><br>    <span class="hljs-comment">// 6.创建模型对象 对文档操作的封装对象</span><br>    let BookModel = mongoose.model(&#x27;books&#x27;<span class="hljs-punctuation">,</span> BookSchema);<br><br>    <span class="hljs-comment">// 7.新增</span><br>    BookModel.create(<span class="hljs-punctuation">&#123;</span><br>        name<span class="hljs-punctuation">:</span> &#x27;西游记&#x27;<span class="hljs-punctuation">,</span><br>        author<span class="hljs-punctuation">:</span> &#x27;吴承恩&#x27;<span class="hljs-punctuation">,</span><br>        price<span class="hljs-punctuation">:</span> <span class="hljs-number">19.9</span><br>    <span class="hljs-punctuation">&#125;</span>).then((err<span class="hljs-punctuation">,</span> data) =&gt; <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-comment">// 判断是否有错误</span><br>        if (err) <span class="hljs-punctuation">&#123;</span><br>            console.log(err);<br>            return;<br>        <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-comment">// 如果没有出错, 则输出插入后的文档对象</span><br>        console.log(data);<br>        <span class="hljs-comment">// 8.关闭数据库连接 (项目运行过程中, 不会添加该代码)</span><br>        mongoose.disconnect();<br>    <span class="hljs-punctuation">&#125;</span>)<br><span class="hljs-punctuation">&#125;</span>)<br><br><span class="hljs-comment">// 设置连接错误的回调</span><br>mongoose.connection.on(&#x27;error&#x27;<span class="hljs-punctuation">,</span> () =&gt; <span class="hljs-punctuation">&#123;</span><br>    console.log(&#x27;连接失败&#x27;);<br><span class="hljs-punctuation">&#125;</span>)<br><br><span class="hljs-comment">// 设置连接关闭的回调</span><br>mongoose.connection.on(&#x27;close&#x27;<span class="hljs-punctuation">,</span> () =&gt; <span class="hljs-punctuation">&#123;</span><br>    console.log(&#x27;连接关闭&#x27;);<br><span class="hljs-punctuation">&#125;</span>)<br></code></pre></td></tr></table></figure><h2 id="字段类型"><a href="#字段类型" class="headerlink" title="字段类型"></a>字段类型</h2><p>String 字符串<br>Number 数字<br>Boolean 布尔值<br>Array 数组，也可以使用 [] 来标识<br>Date 日期<br>Buffer Buffer 对象<br>Mixed 任意类型，需要使用 mongoose.Schema.Types.Mixed 指定<br>ObjectId 对象 ID，需要使用 mongoose.Schema.Types.ObjectId 指定<br>Decimal128 高精度数字，需要使用 mongoose.Schema.Types.Decimal128 指定</p><h2 id="字段值验证"><a href="#字段值验证" class="headerlink" title="字段值验证"></a>字段值验证</h2><p>**必填项 **</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dart">title: &#123;<br>type: <span class="hljs-built_in">String</span>,<br><span class="hljs-keyword">required</span>: <span class="hljs-keyword">true</span> <span class="hljs-comment">// 设置必填项</span><br>&#125;,<br></code></pre></td></tr></table></figure><p>**默认值 **</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dart">author: &#123;<br>type: <span class="hljs-built_in">String</span>,<br><span class="hljs-keyword">default</span>: <span class="hljs-string">&#x27;匿名&#x27;</span> <span class="hljs-comment">//默认值</span><br>&#125;,<br></code></pre></td></tr></table></figure><p>**枚举值 **</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">gender:</span> <span class="hljs-punctuation">&#123;</span><br><span class="hljs-symbol">type:</span> String,<br><span class="hljs-symbol">enum:</span> [<span class="hljs-string">&#x27;男&#x27;</span>,<span class="hljs-string">&#x27;女&#x27;</span>] <span class="hljs-comment">//设置的值必须是数组中的</span><br><span class="hljs-punctuation">&#125;</span>,<br></code></pre></td></tr></table></figure><p>**唯一值 **</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">username: &#123;<br><span class="hljs-built_in">type</span>: String,<br>unique: <span class="hljs-literal">true</span><br>&#125;,<br>```&lt;/div&gt;success<br>unique 需要 重建集合 才能有效果<br>永远不要相信用户的输入&lt;/div&gt;<br><br><span class="hljs-comment">## 删除文档</span><br>删除一条<br></code></pre></td></tr></table></figure><p>SongModel.deleteOne({_id:’5dd65f32be6401035cb5b1ed’}, function(err){<br>if(err) throw err;<br>console.log(‘删除成功’);<br>mongoose.connection.close();<br>});</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">批量删除<br></code></pre></td></tr></table></figure><p>SongModel.deleteMany({author:’Jay’}, function(err){<br>if(err) throw err;<br>console.log(‘删除成功’);<br>mongoose.connection.close();<br>});</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs clean"><br>## 更新文档<br>更新一条数据<br></code></pre></td></tr></table></figure><p>SongModel.updateOne({author: ‘JJ Lin’}, {author: ‘林俊杰’}, function (err) {<br>if(err) throw err;<br>mongoose.connection.close();<br>});</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">批量更新数据<br></code></pre></td></tr></table></figure><p>SongModel.updateMany({author: ‘Leehom Wang’}, {author: ‘王力宏’}, function (err) {<br>if(err) throw err;<br>mongoose.connection.close();<br>});</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs clean"><br>## 读取文档<br>查询一条数据<br></code></pre></td></tr></table></figure><p>SongModel.findOne({author: ‘王力宏’}, function(err, data){<br>if(err) throw err;<br>console.log(data);<br>mongoose.connection.close();<br>});<br>&#x2F;&#x2F;根据 id 查询数据<br>SongModel.findById(‘5dd662b5381fc316b44ce167’,function(err, data){<br>if(err) throw err;<br>console.log(data);<br>mongoose.connection.close();<br>});</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">批量查询数据<br></code></pre></td></tr></table></figure><p>&#x2F;&#x2F;不加条件查询<br>SongModel.find(function(err, data){<br>if(err) throw err;<br>console.log(data);<br>mongoose.connection.close();<br>});<br>&#x2F;&#x2F;加条件查询<br>SongModel.find({author: ‘王力宏’}, function(err, data){<br>if(err) throw err;<br>console.log(data);<br>mongoose.connection.close();<br>});</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs gams"><br>## 条件控制<br> 运算符<br> 在 mongodb 不能 &gt; &lt; &gt;= &lt;= !== 等运算符，需要使用替代符号<br> &gt; 使用 <span class="hljs-symbol">$</span><span class="hljs-keyword">gt</span><br>&lt; 使用 <span class="hljs-symbol">$</span><span class="hljs-keyword">lt</span><br>&gt;= 使用 <span class="hljs-symbol">$</span>gte<br>&lt;= 使用 <span class="hljs-symbol">$</span>lte<br>!== 使用 <span class="hljs-symbol">$</span><span class="hljs-keyword">ne</span><br></code></pre></td></tr></table></figure><p>db.students.find({id:{$gt:3}}); id 号比 3 大的所有的记录</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gams">逻辑运算<br><span class="hljs-meta"><span class="hljs-keyword">$or</span> 逻辑或的情况</span><br></code></pre></td></tr></table></figure><p>db.students.find({$or:[{age:18},{age:24}]});</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-meta"><span class="hljs-keyword">$and</span> 逻辑与的情况</span><br></code></pre></td></tr></table></figure><p>db.students.find({$and: [{age: {$lt:20}}, {age: {$gt: 15}}]});</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">正则匹配<br>条件中可以直接使用 <span class="hljs-keyword">JS </span>的正则语法，通过正则可以进行模糊查询<br></code></pre></td></tr></table></figure><p>db.students.find({name:&#x2F;imissyou&#x2F;});</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs clean"><br>## 个性化读取<br> 字段筛选<br></code></pre></td></tr></table></figure><p>&#x2F;&#x2F;0:不要的字段<br>&#x2F;&#x2F;1:要的字段<br>SongModel.find().select({_id:0,title:1}).exec(function(err,data){<br>if(err) throw err;<br>console.log(data);<br>mongoose.connection.close();<br>});</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">数据排序<br></code></pre></td></tr></table></figure><p>&#x2F;&#x2F;sort 排序<br>&#x2F;&#x2F;1:升序<br>&#x2F;&#x2F;-1:倒序<br>SongModel.find().sort({hot:1}).exec(function(err,data){<br>if(err) throw err;<br>console.log(data);<br>mongoose.connection.close();<br>});</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">数据截取<br></code></pre></td></tr></table></figure><p>&#x2F;&#x2F;skip 跳过 limit 限定<br>SongModel.find().skip(10).limit(10).exec(function(err,data){<br>if(err) throw err;<br>console.log(data);<br>mongoose.connection.close();<br>});</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk"><br><span class="hljs-comment">## 图形化界面</span><br>Robo <span class="hljs-number">3</span>T [https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/Studio3T/</span>robomongo<span class="hljs-regexp">/releases](https:/</span><span class="hljs-regexp">/github.com/</span>Studio3T<span class="hljs-regexp">/robomongo/</span>releases)<br>Navicat<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>前端</category>
      
    </categories>
    
    
    <tags>
      
      <tag>前端</tag>
      
      <tag>NodeJs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>字符串反转</title>
    <link href="/%E7%AE%97%E6%B3%95/%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8F%8D%E8%BD%AC/"/>
    <url>/%E7%AE%97%E6%B3%95/%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8F%8D%E8%BD%AC/</url>
    
    <content type="html"><![CDATA[<p>输入一个 abcd, 输出一个 dcba</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">public String solve (String str) &#123;<br>    // write code here<br>    return return new StringBuffer(str).reverse().toString();<br>&#125;<br></code></pre></td></tr></table></figure><p>或者遍历到 StringBuffer</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">public String solve (String str) &#123;<br>    // write code here<br>    if (str.length() == 0) &#123;<br>        return &quot;&quot;;<br>    &#125;<br>    char c[] = str.toCharArray();<br>    StringBuffer s = new StringBuffer();<br>    for (int i = c.length-1; i &gt;= 0; i--) &#123;<br>        s.append(c[i]);<br>    &#125;<br>    return s.toString();<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>算法</category>
      
    </categories>
    
    
    <tags>
      
      <tag>字符串</tag>
      
      <tag>算法</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>最大公约数gcd</title>
    <link href="/%E7%AE%97%E6%B3%95/%E6%9C%80%E5%A4%A7%E5%85%AC%E7%BA%A6%E6%95%B0gcd/"/>
    <url>/%E7%AE%97%E6%B3%95/%E6%9C%80%E5%A4%A7%E5%85%AC%E7%BA%A6%E6%95%B0gcd/</url>
    
    <content type="html"><![CDATA[<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">public int gcd (int a, int b) &#123; // 2 4  4 2  2 0<br>    // write code here;<br>    if (b == 0) &#123;<br>        return a;<br>    &#125; else &#123;<br>        return gcd(b, a%b);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>算法</category>
      
    </categories>
    
    
    <tags>
      
      <tag>字符串</tag>
      
      <tag>算法</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ZoomIt</title>
    <link href="/%E8%BD%AF%E4%BB%B6/ZoomIt/"/>
    <url>/%E8%BD%AF%E4%BB%B6/ZoomIt/</url>
    
    <content type="html"><![CDATA[<p><a href="https://learn.microsoft.com/en-us/sysinternals/downloads/zoomit">下载</a>解压, 双击 ZoomIt.exe 运行, 可以自行创建快捷方式<br><img src="/assets/8688af6e412b44c08f92f6687a28b28e.png"></p><p><strong>Ctrl 1</strong> 进入缩放模式<br>滑动鼠标&#x2F;方向键 缩放<br>左键开始绘画<br>右键退出绘画</p><p><strong>Ctrl 2</strong> 开始绘画不进入缩放<br>Ctrl +&#x2F;- 或者 Ctrl ↑ Ctrl ↓ 调整光标或者线条大小<br>空格 光标居中<br>W 白板<br>B 黑板<br>T 左对齐输入文本<br>Shift T 右对齐输入文本<br>Ctrl +&#x2F;- 或者 Ctrl ↑ Ctrl ↓ 调整文本大小<br>R 红笔 Red Pen<br>G 绿笔 Green Pen<br>B 蓝笔 Blue Pen<br>Y 黄笔 Yellow Pen<br>O 橙笔 Orange Pen<br>P 粉笔 Pink Pen<br>按住 Shift 直线<br>按住 Ctrl 矩形<br>按住 Tab 椭圆(Ellipse)<br>安装 Ctrl Shit 箭头(Arrow)<br>Ctrl Z 擦掉上一张图(撤销)<br>E 擦掉所有图(撤销全部)<br>Ctrl C 拷贝截图到剪切板<br>Ctrl S 保存截图 PNG</p><p><strong>Ctrl 5</strong> 开始&#x2F;结束录屏</p><p><strong>Ctrl 3</strong> 展示倒数计时器<br>Ctrl +&#x2F;- 或者 Ctrl ↑ Ctrl ↓ 增加或减少时间<br>Alt Tab 最小化计时器, 不会停止</p><p><strong>Ctrl 4</strong> 进入&#x2F;退出 实时缩放模式</p><p>退出画板 Esc 或者 鼠标右键</p><p><strong>参考:</strong></p><ul><li><a href="https://learn.microsoft.com/en-us/sysinternals/downloads/zoomit">https://learn.microsoft.com/en-us/sysinternals/downloads/zoomit</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>软件</category>
      
    </categories>
    
    
    <tags>
      
      <tag>软件</tag>
      
      <tag>小工具</tag>
      
      <tag>ZoomIt</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Node.js</title>
    <link href="/%E5%89%8D%E7%AB%AF/Node.js/"/>
    <url>/%E5%89%8D%E7%AB%AF/Node.js/</url>
    
    <content type="html"><![CDATA[<h2 id="NodeJs"><a href="#NodeJs" class="headerlink" title="NodeJs"></a>NodeJs</h2><p>Node.js 就是一款应用程序, 是一款软件, 它可以运行 JavaScript</p><h2 id="下载安装"><a href="#下载安装" class="headerlink" title="下载安装"></a>下载安装</h2><p><a href="https://nodejs.org/en">https://nodejs.org/en</a><br>推荐下载左边的<br><img src="/assets/fdee5820060246ac96ed43796480aff4.png"></p><h2 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">node 文件名.js<br></code></pre></td></tr></table></figure><h2 id="NodeJs-编码注意事项"><a href="#NodeJs-编码注意事项" class="headerlink" title="NodeJs 编码注意事项"></a>NodeJs 编码注意事项</h2><ul><li>NodeJs 中不能使用 BOM 和 DOM 的 API, 可以使用 console 和定时器 API</li><li>NodeJs 中的顶级对象为 global, 也可以用 globalThis 访问顶级对象</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs shell"><br><br>// BOM<br>// console.log(window);<br>// ReferenceError: window is not defined<br>// console.log(history);<br>// console.log(navigator);<br>// console.log(location);<br><br>// DOM<br>// console.log(document);<br><br>// AJAX<br>// let xhr = new XMLHttpRequest();<br><br>// console.log(&#x27;i love you&#x27;);<br><br>// setTimeout(() =&gt; &#123;<br>//     console.log(&#x27;i love you&#x27;);<br>// &#125;, 1000)<br><br>// global 顶级对象<br>console.log(global);<br>console.log(globalThis); // ES2020<br><br>console.log(global === globalThis);<br></code></pre></td></tr></table></figure><h2 id="Buffer-介绍与创建"><a href="#Buffer-介绍与创建" class="headerlink" title="Buffer 介绍与创建"></a>Buffer 介绍与创建</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell">// 1.alloc<br>//创建了一个长度为 10 字节的 Buffer，相当于申请了 10 字节的内存空间，每个字节的值为 0<br>let buf = Buffer.alloc(10);<br>// console.log(buf);<br>// &lt;Buffer 00 00 00 00 00 00 00 00 00 00&gt;<br><br>// 2.allocUnsafe<br>// //创建了一个长度为 10 字节的 Buffer，buffer 中可能存在旧的数据, 可能会影响执行结果，所以叫unsafe<br>let buf_2 = Buffer.allocUnsafe(10000);<br>// console.log(buf_2);<br><br>// 3.from<br>let buf_3 = Buffer.from(&#x27;hello&#x27;)<br>let buf_4 = Buffer.from([105, 108, 111, 118, 101, 121, 117]);<br>// console.log(buf_3);<br></code></pre></td></tr></table></figure><h2 id="操作-Buffer"><a href="#操作-Buffer" class="headerlink" title="操作 Buffer"></a>操作 Buffer</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs shell">// buffer 与字符串的转化<br>// let buf_4 = Buffer.from([105, 108, 111, 118, 101, 121, 111, 117]);<br>// console.log(buf_4.toString()); // utf-8<br><br>// []<br>// let buf = Buffer.from(&#x27;hello&#x27;);<br>// console.log(buf[0].toString(2)); // 01101000<br>// console.log(buf);<br>// buf[0] = 95;<br>// console.log(buf.toString());<br><br>// 溢出<br>// let buf = Buffer.from(&#x27;hello&#x27;);<br>// buf[0] = 361; // 舍弃高位的数字 0001 0110 1001 =&gt; 0110 1001<br>// console.log(buf);<br><br>// 中文<br>let buf = Buffer.from(&#x27;你好&#x27;)<br>console.log(buf);<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>前端</category>
      
    </categories>
    
    
    <tags>
      
      <tag>前端</tag>
      
      <tag>NodeJs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Vue样式穿透</title>
    <link href="/CSS/Vue%E6%A0%B7%E5%BC%8F%E7%A9%BF%E9%80%8F/"/>
    <url>/CSS/Vue%E6%A0%B7%E5%BC%8F%E7%A9%BF%E9%80%8F/</url>
    
    <content type="html"><![CDATA[<p>在开发中, 多多少少会用到组件库, 但是组件库的样式非常有限, 如果不懂 scoped 的话, 想要修改就有可能会变得有点困难<br>常见的组件化开发都会见到 scoped, scoped 就相当于一个作用域, 只作用于当前这个组件, 不会被其他的组件所影响</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">&lt;style lang=&quot;scss&quot; scoped&gt;<br>...<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure><p>此时页面上存在一个按钮, 如果直接使用标签名 &#x2F; class 来修改样式, 样式是不会被修改的(有可能有的组件可以修改)<br><img src="/assets/2efeb4e583334a6eb00b899b9c82e6e3.png"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell">&lt;template&gt;<br>  &lt;u-button type=&quot;warning&quot; size=&quot;mini&quot; class=&quot;u-button&quot;&gt;button&lt;/u-button&gt;<br>&lt;/template&gt;<br><br>&lt;style lang=&quot;scss&quot; scoped&gt;<br>u-button &#123;<br>  color: white;<br>  background-color: pink;<br>&#125;<br>.u-button &#123;<br>  color: white;<br>  background-color: pink;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure><p>定位元素, 观察页面, 发现是.u-btn–warning[data-v-6e15e680]控制的颜色<br><img src="/assets/2f3e1e26675f4264a06454f22929dfdb.png"><br>直接修改</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">.u-btn--warning[data-v-6e15e680] &#123;<br>  color: white;<br>  background-color: pink;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CSS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Vue</tag>
      
      <tag>CSS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>npm 安装yarn</title>
    <link href="/%E5%89%8D%E7%AB%AF/npm%20%E5%AE%89%E8%A3%85yarn/"/>
    <url>/%E5%89%8D%E7%AB%AF/npm%20%E5%AE%89%E8%A3%85yarn/</url>
    
    <content type="html"><![CDATA[<p>安装</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">npm install -g yarn --registry=https:<span class="hljs-regexp">//</span>registry.npm.taobao.org<br></code></pre></td></tr></table></figure><p>配置源</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs arduino">yarn config set registry https:<span class="hljs-comment">//registry.npm.taobao.org -g</span><br><br>yarn config set sass_binary_site http:<span class="hljs-comment">//cdn.npm.taobao.org/dist/node-sass -g</span><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>前端</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NodeJs</tag>
      
      <tag>npm</tag>
      
      <tag>yarn</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>语雀自动同步Hexo</title>
    <link href="/uncategorized/%E8%AF%AD%E9%9B%80%E8%87%AA%E5%8A%A8%E5%90%8C%E6%AD%A5Hexo/"/>
    <url>/uncategorized/%E8%AF%AD%E9%9B%80%E8%87%AA%E5%8A%A8%E5%90%8C%E6%AD%A5Hexo/</url>
    
    <content type="html"><![CDATA[<p><a href="https://www.yuque.com/hxfqg9/web/gtb5ck#kyyUC">https://www.yuque.com/hxfqg9/web/gtb5ck#kyyUC</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>CSS居中</title>
    <link href="/CSS/CSS%E5%B1%85%E4%B8%AD/"/>
    <url>/CSS/CSS%E5%B1%85%E4%B8%AD/</url>
    
    <content type="html"><![CDATA[<p>居中</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.class</span> &#123;<br>  <span class="hljs-attribute">text-align</span>: center;<br>&#125;<br><br><span class="hljs-selector-class">.class</span> &#123;<br>  <span class="hljs-attribute">position</span>: absolute;<br>  <span class="hljs-attribute">left</span>: <span class="hljs-number">50%</span>;<br>  <span class="hljs-attribute">top</span>: <span class="hljs-number">50%</span>;<br>  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translate</span>(-<span class="hljs-number">50%</span>, -<span class="hljs-number">50%</span>); <span class="hljs-comment">/* 50%为自身尺寸的一半 */</span><br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CSS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CSS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redis远程连接阿里云</title>
    <link href="/Java/Redis%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5%E9%98%BF%E9%87%8C%E4%BA%91/"/>
    <url>/Java/Redis%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5%E9%98%BF%E9%87%8C%E4%BA%91/</url>
    
    <content type="html"><![CDATA[<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript">[root@xiamu redis]<span class="hljs-comment"># pwd</span><br>/www/server/redis<br><br>[root@xiamu redis]<span class="hljs-comment"># vim redis.conf</span><br>bind <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><br>daemonize <span class="hljs-literal">yes</span><br>protected-mode <span class="hljs-literal">no</span><br><br><span class="hljs-comment"># 查看进程号</span><br>[root@xiamu redis]<span class="hljs-comment"># ps -ef | grep redis</span><br></code></pre></td></tr></table></figure><p>另外阿里云需要开放端口<br><img src="/assets/2c0bc60a4ac3488f88d94800cc2288db.png"><br>防火墙放行<br><img src="/assets/615a1f0c59094853978121fdf61ac2a5.png"></p><h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><ul><li><a href="https://www.modb.pro/db/83748">https://www.modb.pro/db/83748</a></li><li><a href="https://blog.csdn.net/yxzone/article/details/114862063">https://blog.csdn.net/yxzone/article/details/114862063</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pyautogui</title>
    <link href="/Python/pyautogui/"/>
    <url>/Python/pyautogui/</url>
    
    <content type="html"><![CDATA[<p>介绍一个 python 库, 能够操控我们的鼠标和键盘来完成一些每天不必要的, 但又不得不去做的牛马事</p><blockquote><p>体验了一波感觉还是比较鸡肋的, 主要是图片找不到</p></blockquote><div style="background: #E8F7FF;padding:10px;border: 1px solid #ABD2DA;border-radius:5px;margin-bottom:5px;">体验了一波感觉还是比较鸡肋的, 主要是图片找不到</div><h4 id="安装-pyautogui"><a href="#安装-pyautogui" class="headerlink" title="安装 pyautogui"></a>安装 pyautogui</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install pyautogui<br></code></pre></td></tr></table></figure><p>可能会报错,<br><a href="https://github.com/pypa/pip/issues/4251">https://github.com/pypa/pip/issues/4251</a><br>升级 pip 就好了</p><h4 id="获取屏幕大小"><a href="#获取屏幕大小" class="headerlink" title="获取屏幕大小"></a>获取屏幕大小</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">import pyautogui<br><br>screenWidth, screenHeight = pyautogui.size()<br>print(screenWidth, screenHeight)<br><span class="hljs-meta prompt_"># </span><span class="language-bash">1920 1080</span><br></code></pre></td></tr></table></figure><h4 id="获取鼠标的坐标"><a href="#获取鼠标的坐标" class="headerlink" title="获取鼠标的坐标"></a>获取鼠标的坐标</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">import pyautogui<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">获取鼠标的坐标</span><br>currentMouseX, currentMouseY = pyautogui.position()<br>print(currentMouseX, currentMouseY)<br><span class="hljs-meta prompt_"># </span><span class="language-bash">1521 848</span><br></code></pre></td></tr></table></figure><h4 id="移动鼠标"><a href="#移动鼠标" class="headerlink" title="移动鼠标"></a>移动鼠标</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">import pyautogui<br>pyautogui.moveTo(100, 150)<br></code></pre></td></tr></table></figure><h4 id="鼠标点击"><a href="#鼠标点击" class="headerlink" title="鼠标点击"></a>鼠标点击</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">import pyautogui<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">点击</span><br>pyautogui.click()<br><span class="hljs-meta prompt_"># </span><span class="language-bash">移动鼠标到100, 200之后点击</span><br>pyautogui.click(100, 200)<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">找到QQ.png的图片之后点击</span><br>pyautogui.click(&#x27;QQ.png&#x27;)<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">双击</span><br>pyautogui.doubleClick()<br></code></pre></td></tr></table></figure><h4 id="键盘输入"><a href="#键盘输入" class="headerlink" title="键盘输入"></a>键盘输入</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">import pyautogui<br><span class="hljs-meta prompt_"># </span><span class="language-bash">输入Hello</span><br>pyautogui.write(&#x27;Hello World!&#x27;, interval=0.25)<br>pyautogui.press(&#x27;enter&#x27;)<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">移动方向键</span><br>with pyautogui.hold(&#x27;shift&#x27;):  # 按住shift<br>    pyautogui.press([&#x27;left&#x27;, &#x27;left&#x27;, &#x27;left&#x27;, &#x27;left&#x27;])<br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">shift</span>自动释放了</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">组合键Ctrl C</span><br>pyautogui.hotkey(&#x27;ctrl&#x27;, &#x27;c&#x27;)<br></code></pre></td></tr></table></figure><h4 id="弹出警告框"><a href="#弹出警告框" class="headerlink" title="弹出警告框"></a>弹出警告框</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">import pyautogui<br><br>pyautogui.alert(&#x27;This is the message to display.&#x27;)<br></code></pre></td></tr></table></figure><h4 id="按住鼠标滑动"><a href="#按住鼠标滑动" class="headerlink" title="按住鼠标滑动"></a>按住鼠标滑动</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">import pyautogui<br><br>distance = 200<br>while distance &gt; 0:<br>    pyautogui.drag(distance, 0, duration=0.5)   # move right<br>    distance -= 5<br>    pyautogui.drag(0, distance, duration=0.5)   # move down<br>    pyautogui.drag(-distance, 0, duration=0.5)  # move left<br>    distance -= 5<br>    pyautogui.drag(0, -distance, duration=0.5)  # move up<br></code></pre></td></tr></table></figure><p><img src="/assets/fca6b02848034c84b6a6e100a2189f04.png"></p>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>快速删除node_modules</title>
    <link href="/node/%E5%BF%AB%E9%80%9F%E5%88%A0%E9%99%A4node_modules/"/>
    <url>/node/%E5%BF%AB%E9%80%9F%E5%88%A0%E9%99%A4node_modules/</url>
    
    <content type="html"><![CDATA[<p>因为手动删除 node_modules 非常的慢, 我们可以安装 rimraf 来快速删除</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install rimraf -g<br>rimraf node_modules<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>node</category>
      
    </categories>
    
    
    <tags>
      
      <tag>node</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>快速入门</title>
    <link href="/uncategorized/%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"/>
    <url>/uncategorized/%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<h4 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell">┌─pages<br>│  ├─index<br>│  │  └─index.vue<br>│  └─login<br>│     └─login.vue<br>├─static<br>├─main.js<br>├─App.vue<br>├─manifest.json<br>└─pages.json<br><br></code></pre></td></tr></table></figure><h4 id="pages"><a href="#pages" class="headerlink" title="pages"></a>pages</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell">&#123;<br>    &quot;pages&quot;: [<br>        &#123;<br>            &quot;path&quot;: &quot;pages/index/index&quot;,<br>            &quot;style&quot;: &#123; ... &#125;<br>        &#125;, &#123;<br>            &quot;path&quot;: &quot;pages/login/login&quot;,<br>            &quot;style&quot;: &#123; ... &#125;<br>        &#125;<br>    ]<br>&#125;<br></code></pre></td></tr></table></figure><p>pages[0]默认显示在首页, 如果想 login 放在首页的位置, 则把 login 放在 index 前面<br>注意 path 的路径不要添加后缀</p><h4 id="常见标签替换"><a href="#常见标签替换" class="headerlink" title="常见标签替换"></a>常见标签替换</h4><p>div &#x3D;&gt; view<br>span &#x3D;&gt; text<br>img &#x3D;&gt; image<br>a &#x3D;&gt; navigator 只能跳转本地页面, 目标必须在 pages.json 注册</p><h4 id="onRead-和-onLoad-区别"><a href="#onRead-和-onLoad-区别" class="headerlink" title="onRead 和 onLoad 区别"></a>onRead 和 onLoad 区别</h4><p>1.onready 比 onload 先执行<br>onLoad 需要等待页面中所有元素(包括图片)加载完成之后才会执行<br>onRead 是 DOM 是 DOM 结构绘制完毕后就执行， 不需要等待所有元素加载执行<br>2.onload 只执行最后一个而 onready 可以执行多个。<br>编写个数不同 window.onload 不能同时编写多个，如果有多个 window.onload 方法，只会执行一个。 $(document).ready()可以同时编写多个，并且都可以得到执行<br>$(document).ready(function(){})可以简写成$(function(){});</p><h4 id="localStorage"><a href="#localStorage" class="headerlink" title="localStorage"></a>localStorage</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs shell">onLoad() &#123;<br>// 异步存储<br>uni.setStorage(&#123;<br>key: &#x27;name&#x27;,<br>data: &#x27;夏珑桂&#x27;<br>&#125;)<br>uni.getStorage(&#123;<br>key: &#x27;name&#x27;,<br>success: res =&gt; &#123;<br>console.log(&#x27;getStorage&#x27;, res)<br>&#125;<br>&#125;)<br><br>// 同步存储<br>uni.setStorageSync(&#x27;age&#x27;, &#x27;18&#x27;)<br><br>let age = uni.getStorageSync(&#x27;age&#x27;)<br>console.log(&#x27;age&#x27;, age)<br><br>// 同步存储对象<br>// 正常写法应该是这样的, 但是在uniapp会给我们自动转换<br>/* uni.setStorageSync(&#x27;person&#x27;, JSON.stringify(&#123;name: &#x27;张三&#x27;, age: 18&#125;))<br>let person = uni.getStorageSync(&#x27;person&#x27;)<br>console.log(&#x27;person&#x27;, JSON.parse(person)) */<br><br>// 直接存储对象也可以直接获取, 但是在vue中写将会获取的是 [Object, Object]<br>uni.setStorageSync(&#x27;person&#x27;, &#123;name: &#x27;张三&#x27;, age: 18&#125;)<br>let person = uni.getStorageSync(&#x27;person&#x27;)<br>console.log(&#x27;person&#x27;, person)<br>&#125;<br>// 清除指定缓存<br>uni.removeStorageSync(&#x27;person&#x27;)<br><br>// 清除所有缓存<br>uni.clearStorageSync()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>scrapy</title>
    <link href="/python/scrapy/"/>
    <url>/python/scrapy/</url>
    
    <content type="html"><![CDATA[<h4 id="shell-调试"><a href="#shell-调试" class="headerlink" title="shell 调试"></a>shell 调试</h4><p>格式 scrapy shell url</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">scrapy shell https://www.9ku.com/geshou/798/info.htm<br><br></code></pre></td></tr></table></figure><h4 id="scrapy-创建项目"><a href="#scrapy-创建项目" class="headerlink" title="scrapy 创建项目"></a>scrapy 创建项目</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">创建项目</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">scrapy startproject scrapy_baidu_091</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">创建爬虫文件, 需要进入spiders目录</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">scrapy genspider baidu www.baidu.com</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">运行爬虫文件</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">scrapy crawl baidu</span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"> scrapy shell https://www.dushu.com/book/1611.html<br><br><br>from scrapy.linkextractors import LinkExtractor<br> link = LinkExtractor(allow=r&#x27;/book/1611_\d+\.html&#x27;)<br>link.extract_links(response)<br><br> link1 = LinkExtractor(restrict_xpaths=r&#x27;//div[@class=&quot;pages&quot;]/a&#x27;)<br>link1.extract_links(response)<br></code></pre></td></tr></table></figure><h4 id="parse-self-response"><a href="#parse-self-response" class="headerlink" title="parse(self, response)"></a>parse(self, response)</h4><p>获取网页源码, 二进制 , xpath 的使用</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell">def parse(self, response):<br>    # print(&#x27;山东菏泽曹县&#x27;)<br>    # 获取网页源码 字符串<br>    # content = response.text<br>    print(&#x27;===============================&#x27;)<br>    # 二进制网页源码<br>    # content = response.body<br>    # print(content)<br><br>    span = response.xpath(&#x27;//div[@id=&quot;filter&quot;]/div[@class=&quot;tabs&quot;]//span&#x27;)[0]<br>    print(span.extract()) # 提取<br><br><br></code></pre></td></tr></table></figure><h4 id="Selector-转换-extract"><a href="#Selector-转换-extract" class="headerlink" title="Selector 转换 (extract())"></a>Selector 转换 (extract())</h4><p>当我们直接使用 xpath 获取元素时, 发现打印出来的是 Selector 标签, 并不是我们想要的</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">def parse(self, response):<br>    name_list = response.xpath(&quot;//div[@class=&#x27;songName&#x27;]/a[@class=&#x27;songNameA&#x27;]//text()&quot;)<br>    url_list = response.xpath(&quot;//div[@class=&#x27;songName&#x27;]/a[@class=&#x27;songNameA&#x27;]/@href&quot;)<br>    for index in range(len(name_list)):<br>        print(name_list[index])<br>        print(url_list[index])<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">&lt;Selector xpath=&quot;//div[@class=&#x27;songName&#x27;]/a[@class=&#x27;songNameA&#x27;]//text()&quot; data=&#x27;晴天&#x27;&gt;<br>&lt;Selector xpath=&quot;//div[@class=&#x27;songName&#x27;]/a[@class=&#x27;songNameA&#x27;]/@href&quot; data=&#x27;/play/41813.htm&#x27;&gt;<br>&lt;Selector xpath=&quot;//div[@class=&#x27;songName&#x27;]/a[@class=&#x27;songNameA&#x27;]//text()&quot; data=&#x27;青花瓷&#x27;&gt;<br>&lt;Selector xpath=&quot;//div[@class=&#x27;songName&#x27;]/a[@class=&#x27;songNameA&#x27;]/@href&quot; data=&#x27;/play/91161.htm&#x27;&gt;<br></code></pre></td></tr></table></figure><p>加入把以上 extract(), 代码修改成下面代码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">def parse(self, response):<br>    name_list = response.xpath(&quot;//div[@class=&#x27;songName&#x27;]/a[@class=&#x27;songNameA&#x27;]//text()&quot;)<br>    url_list = response.xpath(&quot;//div[@class=&#x27;songName&#x27;]/a[@class=&#x27;songNameA&#x27;]/@href&quot;)<br>    for index in range(len(name_list)):<br>        print(name_list[index].extract())<br>        print(url_list[index].extract())<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">晴天<br>/play/41813.htm<br>青花瓷<br>/play/91161.htm<br></code></pre></td></tr></table></figure><p>extract()是从<Selector>标签中获取数据<br>extract_first() 是从[<Selector>, <Selector>]列表中获取第一个数据</p><h4 id="向管道传输数据-管道下载数据"><a href="#向管道传输数据-管道下载数据" class="headerlink" title="向管道传输数据, 管道下载数据"></a>向管道传输数据, 管道下载数据</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><br>from scrapy_dangdang_095.items import ScrapyDangdang095Item<br><br>            book = ScrapyDangdang095Item(src=src, name=alt, price=price)<br><br>            yield book<br></code></pre></td></tr></table></figure><p>items.py</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell">class ScrapyDangdang095Item(scrapy.Item):<br>    # define the fields for your item here like:<br>    # name = scrapy.Field()<br>    # 通俗的说就是你要下载的数据都有什么<br><br>    # 图片<br>    src = scrapy.Field()<br>    # 名字<br>    name = scrapy.Field()<br>    # 价格<br>    price = scrapy.Field()<br></code></pre></td></tr></table></figure><p>管道 pipelines.py 下载</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs shell">class ScrapyDangdang095Pipeline:<br>    def open_spider(self, spider):<br>        self.fp = open(&#x27;book.json&#x27;, &#x27;w&#x27;, encoding=&#x27;utf-8&#x27;)<br><br>    def process_item(self, item, spider):<br>        # return item<br>        # 以下这种模式不推荐 因为没床底过来一个对象那么就打开一次文件 对文件的操作过于频繁<br>        # (1) write方法必须要写一个字符串 而不能是其他的对象<br>        # (2) w模式 会没一个对象都打开一次文件 覆盖之前的内容<br>        # with open(&quot;book.json&quot;, &#x27;a&#x27;, encoding=&#x27;utf-8&#x27;) as fp:<br>        #     fp.write(str(item))<br>        self.fp.write(str(item))<br><br>        return item<br><br>    def close_spider(self, spider):<br>        self.fp.close()<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">多条管道开启</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">(1) 定义管道类</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">(2) 在settings中开启管道</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">   <span class="hljs-string">&quot;scrapy_dangdang_095.pipelines.DangDangDownloadPipeline&quot;</span>: 301,</span><br>import urllib.request<br>class DangDangDownloadPipeline:<br>    def process_item(self, item, spider):<br>        url = &#x27;http:&#x27; + item.get(&#x27;src&#x27;)<br>        filename = &#x27;./books/&#x27; + item.get(&#x27;name&#x27;) + &#x27;.jpg&#x27;<br>        urllib.request.urlretrieve(url=url, filename=filename)<br><br>        return item<br></code></pre></td></tr></table></figure><h4 id="yield-调用函数"><a href="#yield-调用函数" class="headerlink" title="yield 调用函数"></a>yield 调用函数</h4><p>自己调用自己</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"> def parse(self, response):<br> ...<br>yield scrapy.Request(url, callback=self.parse)<br></code></pre></td></tr></table></figure><p>调用其他函数, 并且携带 meta 参数, 接收参数</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"> def parse(self, response):<br> ...<br> yield scrapy.Request(url=url, callback=self.parse_second, meta=&#123;&#x27;name&#x27;: name&#125;)<br>def parse_second(self, response):<br><span class="hljs-meta prompt_">   # </span><span class="language-bash">接收到请求的那个meta参数的值</span><br>   name = response.meta[&#x27;name&#x27;]<br> ...<br></code></pre></td></tr></table></figure><h4 id="引入-crawlspider-正则-Rule"><a href="#引入-crawlspider-正则-Rule" class="headerlink" title="引入 crawlspider(正则 Rule)"></a>引入 crawlspider(正则 Rule)</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">创建项目</span><br>scrapy startproject scrapy_readbook_101<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">创建爬虫文件</span><br>scrapy genspider -t crawl read https://www.dushu.com/book/1188.html<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">运行爬虫文件</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">scrapy crawl <span class="hljs-built_in">read</span></span><br></code></pre></td></tr></table></figure><p>此时的目录结构如下:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;pages&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;disabled&quot;</span>&gt;</span>«上一页<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;current&quot;</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/book/1188_2.html&quot;</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/book/1188_3.html&quot;</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/book/1188_4.html&quot;</span>&gt;</span>4<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/book/1188_5.html&quot;</span>&gt;</span>5<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/book/1188_6.html&quot;</span>&gt;</span>6<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/book/1188_7.html&quot;</span>&gt;</span>7<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/book/1188_8.html&quot;</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/book/1188_9.html&quot;</span>&gt;</span>9<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/book/1188_10.html&quot;</span>&gt;</span>10<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/book/1188_11.html&quot;</span>&gt;</span>11<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/book/1188_12.html&quot;</span>&gt;</span>12<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/book/1188_13.html&quot;</span>&gt;</span>13<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;disabled&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/book/1188_2.html&quot;</span>&gt;</span>下一页»<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><p>我们编写如下的代码来匹配这个目录规则</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">pipelines.py管道</span><br>class ScrapyReadbook101Pipeline:<br>    def open_spider(self, spider):<br>        self.fp = open(&quot;gushiwen.json&quot;, &#x27;w&#x27;, encoding=&#x27;utf-8&#x27;)<br><br>    def process_item(self, item, spider):<br>        self.fp.write(str(item))<br>        return item<br><br>    def stop_spider(self, spider):<br>        self.fp.close()<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">items.py</span><br>class ScrapyReadbook101Item(scrapy.Item):<br>    # define the fields for your item here like:<br>    # name = scrapy.Field()<br>    name = scrapy.Field()<br>    url = scrapy.Field()<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">settings.py中开启管道</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Configure item pipelines</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">See https://docs.scrapy.org/en/latest/topics/item-pipeline.html</span><br>ITEM_PIPELINES = &#123;<br>   &quot;scrapy_readbook_101.pipelines.ScrapyReadbook101Pipeline&quot;: 300,<br>&#125;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">read.py</span><br>import scrapy<br>from scrapy.linkextractors import LinkExtractor<br>from scrapy.spiders import CrawlSpider, Rule<br>from scrapy_readbook_101.items import ScrapyReadbook101Item<br><br>class ReadSpider(CrawlSpider):<br>    name = &quot;read&quot;<br>    allowed_domains = [&quot;www.dushu.com&quot;]<br>    start_urls = [&quot;https://www.dushu.com/book/1188_1.html&quot;]<br><br>    rules = [Rule(LinkExtractor(allow=r&quot;/book/1188_\d+\.html&quot;), callback=&quot;parse_item&quot;, follow=False)]<br><br>    def parse_item(self, response):<br>        img_list = response.xpath(&#x27;//div[@class=&quot;bookslist&quot;]//img&#x27;)<br><br>        for img in img_list:<br>            name = img.xpath(&#x27;./@data-original&#x27;).extract_first()<br>            src = img.xpath(&#x27;./@src&#x27;).extract_first()<br>            # print(name, src)<br>            book = ScrapyReadbook101Item(url=src, name=name)<br>            yield book<br></code></pre></td></tr></table></figure><h4 id="pysql-引入"><a href="#pysql-引入" class="headerlink" title="pysql 引入"></a>pysql 引入</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">登录mysql</span><br>mysql -uroot -p123456<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">创建数据库</span><br>create database spider01<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">使用数据库</span><br>use spider01<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">创建一个表</span><br>create table book(<br>id int primary key auto_increment,<br>name varchar(128),<br>src varchar(128));<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">查看ip</span><br>ifconfig<br></code></pre></td></tr></table></figure><p>在 settings.py 引入数据库的信息</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">DB_HOST = &#x27;192.168.1.100&#x27;<br><span class="hljs-meta prompt_"># </span><span class="language-bash">端口号是一个整数</span><br>DB_PORT = 3306<br>DB_USER = &#x27;root&#x27;<br>DB_PASSWORD = &#x27;123456&#x27;<br>DB_NAME = &#x27;spider01&#x27;<br>DB_CHARSET = &#x27;utf8&#x27;<br><br></code></pre></td></tr></table></figure><p>下载 pymysql</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install pymysql -i https://pypi.douban.com/simple<br></code></pre></td></tr></table></figure><h4 id="日志输出"><a href="#日志输出" class="headerlink" title="日志输出"></a>日志输出</h4><p>settings.py</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">不常用</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">指定日志级别</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">LOG_LEVEL = <span class="hljs-string">&quot;WARNING&quot;</span></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">常用</span><br>LOG_FILE = &quot;logdemo.log&quot;<br></code></pre></td></tr></table></figure><h4 id=""><a href="#" class="headerlink" title=""></a></h4>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>scrapy</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>linux常用命令</title>
    <link href="/linux/linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
    <url>/linux/linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
    
    <content type="html"><![CDATA[<p>查看服务的位置的命令</p><blockquote><p>whereis 命令是定位可执行文件、源代码文件、帮助文件在文件系统中的位置。这些文件的属性应属于原始代码，二进制文件，或是帮助文件。whereis 程序还具有搜索源代码、指定备用搜索路径和搜索不寻常项的能力。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@d23096201e11:/# whereis mysql<br>mysql: /usr/bin/mysql /usr/lib/mysql /etc/mysql /usr/share/mysql<br><br></code></pre></td></tr></table></figure><p>清空文件内容<br>:%d</p>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Docker</title>
    <link href="/Java/Docker/"/>
    <url>/Java/Docker/</url>
    
    <content type="html"><![CDATA[<h1 id="0-安装-Docker"><a href="#0-安装-Docker" class="headerlink" title="0.安装 Docker"></a>0.安装 Docker</h1><p>Docker 分为 CE 和 EE 两大版本。CE 即社区版（免费，支持周期 7 个月），EE 即企业版，强调安全，付费使用，支持周期 24 个月。</p><p>Docker CE 分为 <code>stable</code> <code>test</code> 和 <code>nightly</code> 三个更新频道。</p><p>官方网站上有各种环境下的 <a href="https://docs.docker.com/install/">安装指南</a>，这里主要介绍 Docker CE 在 CentOS 上的安装。</p><h1 id="1-CentOS-安装-Docker"><a href="#1-CentOS-安装-Docker" class="headerlink" title="1.CentOS 安装 Docker"></a>1.CentOS 安装 Docker</h1><p>Docker CE 支持 64 位版本 CentOS 7，并且要求内核版本不低于 3.10， CentOS 7 满足最低内核的要求，所以我们在 CentOS 7 安装 Docker。</p><h2 id="1-1-卸载（可选）"><a href="#1-1-卸载（可选）" class="headerlink" title="1.1.卸载（可选）"></a>1.1.卸载（可选）</h2><p>如果之前安装过旧版本的 Docker，可以使用下面命令卸载：</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs livescript">yum remove docker <span class="hljs-string">\</span><br>                  docker-client <span class="hljs-string">\</span><br>                  docker-client-latest <span class="hljs-string">\</span><br>                  docker-common <span class="hljs-string">\</span><br>                  docker-latest <span class="hljs-string">\</span><br>                  docker-latest-logrotate <span class="hljs-string">\</span><br>                  docker-logrotate <span class="hljs-string">\</span><br>                  docker-selinux <span class="hljs-string">\</span><br>                  docker-engine-selinux <span class="hljs-string">\</span><br>                  docker-engine <span class="hljs-string">\</span><br>                  docker-ce<br></code></pre></td></tr></table></figure><h2 id="1-2-安装-docker"><a href="#1-2-安装-docker" class="headerlink" title="1.2.安装 docker"></a>1.2.安装 docker</h2><p>首先需要大家虚拟机联网，安装 yum 工具</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum install -y yum-utils \<br>           device-mapper-persistent-data \<br>           lvm2 --skip-broken<br></code></pre></td></tr></table></figure><p>然后更新本地镜像源：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">设置docker镜像源</span><br>yum-config-manager \<br>    --add-repo \<br>    https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo<br><br>sed -i &#x27;s/download.docker.com/mirrors.aliyun.com\/docker-ce/g&#x27; /etc/yum.repos.d/docker-ce.repo<br><br>yum makecache fast<br></code></pre></td></tr></table></figure><p>然后输入命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum install -y docker-ce<br></code></pre></td></tr></table></figure><p>docker-ce 为社区免费版本。稍等片刻，docker 即可安装成功。</p><h2 id="1-3-启动-docker"><a href="#1-3-启动-docker" class="headerlink" title="1.3.启动 docker"></a>1.3.启动 docker</h2><p>Docker 应用需要用到各种端口，逐一去修改防火墙设置。非常麻烦，因此建议大家直接关闭防火墙！</p><p>启动 docker 前，一定要关闭防火墙后！！</p><p>启动 docker 前，一定要关闭防火墙后！！</p><p>启动 docker 前，一定要关闭防火墙后！！</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">关闭</span><br>systemctl stop firewalld<br><span class="hljs-meta prompt_"># </span><span class="language-bash">禁止开机启动防火墙</span><br>systemctl disable firewalld<br></code></pre></td></tr></table></figure><p>通过命令启动 docker：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl start docker  # 启动docker服务<br><br>systemctl stop docker  # 停止docker服务<br><br>systemctl restart docker  # 重启docker服务<br><br>systemctl enable docker  # 开机自启动<br></code></pre></td></tr></table></figure><p>然后输入命令，可以查看 docker 版本：</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">docker -v</span><br></code></pre></td></tr></table></figure><p>如图：<br><img src="/assets/ac9d54ff1f1d4a17a5d56eaf154deda8.png"></p><h2 id="1-4-配置镜像加速"><a href="#1-4-配置镜像加速" class="headerlink" title="1.4.配置镜像加速"></a>1.4.配置镜像加速</h2><p>docker 官方镜像仓库网速较差，我们需要设置国内镜像服务：</p><p>参考阿里云的镜像加速文档：<a href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors">https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors</a></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs awk">sudo mkdir -p <span class="hljs-regexp">/etc/</span>docker<br>sudo tee <span class="hljs-regexp">/etc/</span>docker/daemon.json &lt;&lt;-<span class="hljs-string">&#x27;EOF&#x27;</span><br>&#123;<br>  <span class="hljs-string">&quot;registry-mirrors&quot;</span>: [<span class="hljs-string">&quot;https://ylmjgfp5.mirror.aliyuncs.com&quot;</span>]<br>&#125;<br>EOF<br>sudo systemctl daemon-reload<br>sudo systemctl restart docker<br></code></pre></td></tr></table></figure><h1 id="2-CentOS7-安装-DockerCompose"><a href="#2-CentOS7-安装-DockerCompose" class="headerlink" title="2.CentOS7 安装 DockerCompose"></a>2.CentOS7 安装 DockerCompose</h1><h2 id="2-1-下载"><a href="#2-1-下载" class="headerlink" title="2.1.下载"></a>2.1.下载</h2><p>Linux 下需要通过命令下载：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">安装</span><br>curl -L https://github.com/docker/compose/releases/download/1.23.1/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose<br></code></pre></td></tr></table></figure><p>如果下载速度较慢，或者下载失败，可以使用课前资料提供的 docker-compose 文件：</p><p><img src="/assets/66435fab1b7547f0a08a26437c744c65.png"></p><p>上传到<code>/usr/local/bin/</code>目录也可以。</p><h2 id="2-2-修改文件权限"><a href="#2-2-修改文件权限" class="headerlink" title="2.2.修改文件权限"></a>2.2.修改文件权限</h2><p>修改文件权限：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">修改权限</span><br>chmod +x /usr/local/bin/docker-compose<br></code></pre></td></tr></table></figure><h2 id="2-3-Base-自动补全命令："><a href="#2-3-Base-自动补全命令：" class="headerlink" title="2.3.Base 自动补全命令："></a>2.3.Base 自动补全命令：</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">补全命令</span><br>curl -L https://raw.githubusercontent.com/docker/compose/1.29.1/contrib/completion/bash/docker-compose &gt; /etc/bash_completion.d/docker-compose<br></code></pre></td></tr></table></figure><p>如果这里出现错误，需要修改自己的 hosts 文件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">echo &quot;199.232.68.133 raw.githubusercontent.com&quot; &gt;&gt; /etc/hosts<br></code></pre></td></tr></table></figure><h1 id="3-Docker-镜像仓库"><a href="#3-Docker-镜像仓库" class="headerlink" title="3.Docker 镜像仓库"></a>3.Docker 镜像仓库</h1><p>搭建镜像仓库可以基于 Docker 官方提供的 DockerRegistry 来实现。</p><p>官网地址：<a href="https://hub.docker.com/_/registry">https://hub.docker.com/_&#x2F;registry</a></p><h2 id="3-1-简化版镜像仓库"><a href="#3-1-简化版镜像仓库" class="headerlink" title="3.1.简化版镜像仓库"></a>3.1.简化版镜像仓库</h2><p>Docker 官方的 Docker Registry 是一个基础版本的 Docker 镜像仓库，具备仓库管理的完整功能，但是没有图形化界面。</p><p>搭建方式比较简单，命令如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -d \<br>    --restart=always \<br>    --name registry\<br>    -p 5000:5000 \<br>    -v registry-data:/var/lib/registry \<br>    registry<br></code></pre></td></tr></table></figure><p>命令中挂载了一个数据卷 registry-data 到容器内的&#x2F;var&#x2F;lib&#x2F;registry 目录，这是私有镜像库存放数据的目录。</p><p>访问 <a href="http://yourip:5000/v2//_catalog">http://YourIp:5000/v2/\_catalog</a> 可以查看当前私有镜像服务中包含的镜像</p><h2 id="3-2-带有图形化界面版本"><a href="#3-2-带有图形化界面版本" class="headerlink" title="3.2.带有图形化界面版本"></a>3.2.带有图形化界面版本</h2><p>使用 DockerCompose 部署带有图象界面的 DockerRegistry，命令如下：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3.0&quot;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">registry:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">registry</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./registry-data:/var/lib/registry</span><br>  <span class="hljs-attr">ui:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">joxit/docker-registry-ui:static</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">8080</span><span class="hljs-string">:80</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">REGISTRY_TITLE=传智教育私有仓库</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">REGISTRY_URL=http://registry:5000</span><br>    <span class="hljs-attr">depends_on:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">registry</span><br></code></pre></td></tr></table></figure><h2 id="3-3-配置-Docker-信任地址"><a href="#3-3-配置-Docker-信任地址" class="headerlink" title="3.3.配置 Docker 信任地址"></a>3.3.配置 Docker 信任地址</h2><p>我们的私服采用的是 http 协议，默认不被 Docker 信任，所以需要做一个配置：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">打开要修改的文件</span><br>vi /etc/docker/daemon.json<br><span class="hljs-meta prompt_"># </span><span class="language-bash">添加内容：</span><br>&quot;insecure-registries&quot;:[&quot;http://192.168.150.101:8080&quot;]<br><span class="hljs-meta prompt_"># </span><span class="language-bash">重加载</span><br>systemctl daemon-reload<br><span class="hljs-meta prompt_"># </span><span class="language-bash">重启docker</span><br>systemctl restart docker<br></code></pre></td></tr></table></figure><h1 id="4-Docker-基本操作"><a href="#4-Docker-基本操作" class="headerlink" title="4.Docker 基本操作"></a>4.Docker 基本操作</h1><h2 id="镜像"><a href="#镜像" class="headerlink" title="镜像"></a>镜像</h2><h4 id="帮助文档"><a href="#帮助文档" class="headerlink" title="帮助文档"></a>帮助文档</h4><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stata"><br>docker --<span class="hljs-keyword">help</span><br>docker <span class="hljs-keyword">save</span> --<span class="hljs-keyword">help</span><br></code></pre></td></tr></table></figure><h4 id="拉取镜像"><a href="#拉取镜像" class="headerlink" title="拉取镜像"></a>拉取镜像</h4><p>从 DockerHub 拉取一个 nginx 镜像并查看<br>从<a href="https://hub.docker.com/">Docker</a>搜索 nginx</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">docker pull nginx</span><br><br></code></pre></td></tr></table></figure><h4 id="查看镜像"><a href="#查看镜像" class="headerlink" title="查看镜像"></a>查看镜像</h4><p>查看拉取到的镜像</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">docker images</span><br></code></pre></td></tr></table></figure><p><img src="/assets/a9e29557e11d4429be6331a43f386cc9.png"></p><h4 id="打包镜像"><a href="#打包镜像" class="headerlink" title="打包镜像"></a>打包镜像</h4><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs fortran">docker <span class="hljs-keyword">save</span> -o nginx.tar nginx:latest<br></code></pre></td></tr></table></figure><h4 id="删除镜像"><a href="#删除镜像" class="headerlink" title="删除镜像"></a>删除镜像</h4><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">docker</span> images<br>docker rmi nginx:latest<br>docker images<br><br></code></pre></td></tr></table></figure><h4 id="加载镜像"><a href="#加载镜像" class="headerlink" title="加载镜像"></a>加载镜像</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus">docker load -<span class="hljs-selector-tag">i</span> nginx<span class="hljs-selector-class">.tar</span><br>docker images<br><br></code></pre></td></tr></table></figure><h2 id="容器"><a href="#容器" class="headerlink" title="容器"></a>容器</h2><h4 id="运行容器"><a href="#运行容器" class="headerlink" title="运行容器"></a>运行容器</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> run --name mn -p <span class="hljs-number">80</span>:<span class="hljs-number">80</span> -d nginx<br></code></pre></td></tr></table></figure><p>容器运行完成之后会产生一个唯一的 id</p><h4 id="查看容器运行状态"><a href="#查看容器运行状态" class="headerlink" title="查看容器运行状态"></a>查看容器运行状态</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xiamu ~]<span class="hljs-comment"># docker ps</span><br>CONTAINER ID   IMAGE     COMMAND                   CREATED          STATUS          PORTS                               NAMES<br>1276f236aab4   nginx     <span class="hljs-string">&quot;/docker-entrypoint.…&quot;</span>   33 seconds ago   Up 32 seconds   0.0.0.0:80-&gt;80/tcp,&lt;/div&gt;80-&gt;80/tcp   mn<br><br></code></pre></td></tr></table></figure><h4 id="查看容器的日志"><a href="#查看容器的日志" class="headerlink" title="查看容器的日志"></a>查看容器的日志</h4><p>记得加上容器的名称 mn</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">docker</span> logs mn<br><br>docker logs mn -f<br><span class="hljs-comment"># -f表示持续输出日志信息</span><br></code></pre></td></tr></table></figure><p>nginx 启动成功, 能够正常访问<br><img src="/assets/faf5d0fc1aa54a2eb832a4ceb7505839.png"></p><h4 id="进入容器"><a href="#进入容器" class="headerlink" title="进入容器"></a>进入容器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">exec</span> -it mn bash<br><br><span class="hljs-comment"># 容器内存在linux常用的命令, 但是没有vi,</span><br><span class="hljs-comment"># 所以不能修改容器内部的文件, 并且我们也不建议去修改容器内的文件</span><br><span class="hljs-built_in">pwd</span><br><span class="hljs-built_in">ls</span><br><span class="hljs-built_in">cd</span><br><br><span class="hljs-comment"># 进入redis容器的两种方式, 第一种先进入容器的再进入bash, 第二种直接进入redis-cli</span><br>docker <span class="hljs-built_in">exec</span> -it my-redis bash<br>docker <span class="hljs-built_in">exec</span> -it my-redis redis-cli<br></code></pre></td></tr></table></figure><h4 id="进入-nginx-目录"><a href="#进入-nginx-目录" class="headerlink" title="进入 nginx 目录"></a>进入 nginx 目录</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">find / -name nginx<br>cd <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/nginx/</span>html<br><br><span class="hljs-comment"># 我们可以使用sed来修改容器内的内容, 但是还是建议尽量不要修改容器内的东西</span><br>sed -i -e <span class="hljs-string">&#x27;s#Welcome to nginx#传智教育欢迎您#g&#x27;</span> -e <span class="hljs-string">&#x27;s#&lt;head&gt;#&lt;head&gt;&lt;meta charset=&quot;utf-8&quot;&gt;#g&#x27;</span> index.html<br></code></pre></td></tr></table></figure><p>修改完成之后页面也发生了变化<br><img src="/assets/9ae9b3a470834898baa887ad64b9089d.png"></p><h4 id="退出容器"><a href="#退出容器" class="headerlink" title="退出容器"></a>退出容器</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-keyword">exit</span><br></code></pre></td></tr></table></figure><h4 id="停止容器"><a href="#停止容器" class="headerlink" title="停止容器"></a>停止容器</h4><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">docker <span class="hljs-built_in">stop</span> mn<br><br><span class="hljs-comment"># 表示查看当前正在运行的容器</span><br>docker ps<br><br><span class="hljs-comment"># -a表示查看所有的容器</span><br>docker ps -<span class="hljs-keyword">a</span><br></code></pre></td></tr></table></figure><h4 id="开启容器"><a href="#开启容器" class="headerlink" title="开启容器"></a>开启容器</h4><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">docker <span class="hljs-literal">start</span> mn<br></code></pre></td></tr></table></figure><h4 id="删除容器"><a href="#删除容器" class="headerlink" title="删除容器"></a>删除容器</h4><p>注意我们无法删除一个正在运行的容器, 我们得先把容器停止了, 再删除, 或者使用-f 强制删除</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell">docker stop mn<br>docker <span class="hljs-built_in">rm</span> mn<br><br>docker <span class="hljs-built_in">rm</span> mn <span class="hljs-operator">-f</span><br></code></pre></td></tr></table></figure><h4 id="容器开启开机启动"><a href="#容器开启开机启动" class="headerlink" title="容器开启开机启动"></a>容器开启开机启动</h4><p>因为容器每次关机之后, 就会被关闭, 执行如下命令就能解决</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker update mysql --restart=always<br></code></pre></td></tr></table></figure><h2 id="数据卷"><a href="#数据卷" class="headerlink" title="数据卷"></a>数据卷</h2><h4 id="创建数据卷"><a href="#创建数据卷" class="headerlink" title="创建数据卷"></a>创建数据卷</h4><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gauss">docker <span class="hljs-built_in">volume</span> <span class="hljs-keyword">create</span> html<br></code></pre></td></tr></table></figure><h4 id="查看所有的数据卷"><a href="#查看所有的数据卷" class="headerlink" title="查看所有的数据卷"></a>查看所有的数据卷</h4><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">docker <span class="hljs-keyword">volume</span><span class="language-bash"> <span class="hljs-built_in">ls</span></span><br></code></pre></td></tr></table></figure><h4 id="查看数据卷的详细信息"><a href="#查看数据卷的详细信息" class="headerlink" title="查看数据卷的详细信息"></a>查看数据卷的详细信息</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">docker volume inspect <span class="hljs-selector-tag">html</span><br></code></pre></td></tr></table></figure><h4 id="删除未使用的数据卷"><a href="#删除未使用的数据卷" class="headerlink" title="删除未使用的数据卷"></a>删除未使用的数据卷</h4><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">docker <span class="hljs-keyword">volume</span><span class="language-bash"> prune</span><br></code></pre></td></tr></table></figure><h4 id="删除指定的数据卷"><a href="#删除指定的数据卷" class="headerlink" title="删除指定的数据卷"></a>删除指定的数据卷</h4><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">docker <span class="hljs-keyword">volume</span><span class="language-bash"> <span class="hljs-built_in">rm</span> html</span><br><br></code></pre></td></tr></table></figure><h4 id="挂载数据卷"><a href="#挂载数据卷" class="headerlink" title="挂载数据卷"></a>挂载数据卷</h4><p>使用-v 参数将数据卷挂载到容器上</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs gradle">docker run --name mn -p <span class="hljs-number">80</span>:<span class="hljs-number">80</span> -v html:<span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/nginx/</span>html -d nginx<br><br>查看运行的容器<br>docker ps<br><br>查看容器的详细信息<br>docker <span class="hljs-keyword">inspect</span> html<br> <span class="hljs-string">&quot;Mountpoint&quot;</span>: <span class="hljs-string">&quot;/var/lib/docker/volumes/html/_data&quot;</span>,<br><br>进入挂载点的目录<br>cd <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/docker/</span>volumes<span class="hljs-regexp">/html/</span>_data<br><br>使用vi命令随便修改index.html内容, 访问虚拟机ip, 发现nginx默认页面被修改掉了<br><br><br></code></pre></td></tr></table></figure><p>tips: 以上挂载数据卷, 可以先提前创建数据卷<br>也可以不创建数据卷, 执行-v 参数, 会自动帮我们创建一个数据卷</p><h4 id="练习题"><a href="#练习题" class="headerlink" title="练习题:"></a>练习题:</h4><p><img src="/assets/151b7f48a75149929c2a88d10aeaa57a.png"></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs awk">docker load -i mysql.tar<br>docker run \<br>--name mysql \<br>-v <span class="hljs-regexp">/tmp/my</span>sql<span class="hljs-regexp">/data:/</span>var<span class="hljs-regexp">/lib/my</span>sql \<br>-v <span class="hljs-regexp">/tmp/my</span>sql<span class="hljs-regexp">/conf/</span>hmy.cnf:<span class="hljs-regexp">/etc/my</span>sql<span class="hljs-regexp">/conf.d/</span>hmy.cnf \<br>-p <span class="hljs-number">3306</span>:<span class="hljs-number">3306</span> \<br>-e MYSQL_ROOT_PASSWORD=<span class="hljs-number">123456</span> \<br>-d \<br>mysql:<span class="hljs-number">5.7</span>.<span class="hljs-number">25</span><br>docker exec -it mysql mysql -uroot -p123456<br></code></pre></td></tr></table></figure><p>不建议使用-v &#x2F;tmp&#x2F;mysql&#x2F;conf&#x2F;hmy.cnf:&#x2F;etc&#x2F;mysql&#x2F;my.cnf<br>更建议使用-v &#x2F;tmp&#x2F;mysql&#x2F;conf&#x2F;hmy.cnf:&#x2F;etc&#x2F;mysql&#x2F;conf.d&#x2F;hmy.cnf<br>conf.d 目录下的配置文件会加载到 my.cnf 中去, 如果用了第一种方式将会直接覆盖了 my.cnf<br>第二种方式将不会覆盖 my.cnf<br>-e 表示是环境变量</p><h2 id="DockerFile-自定义镜像"><a href="#DockerFile-自定义镜像" class="headerlink" title="DockerFile 自定义镜像"></a>DockerFile 自定义镜像</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">cd</span> /tmp/<br><span class="hljs-attribute">mkdir</span> docker-demo<br><span class="hljs-attribute">cd</span> docker-demo/<br><br><span class="hljs-comment"># 上传三个文件</span><br><span class="hljs-attribute">docker</span>-demo.jar<br><span class="hljs-attribute">Dockerfile</span><br><span class="hljs-attribute">jdk8</span>.tar.gz<br><br><span class="hljs-comment"># 注意最后的点不要忘了</span><br><span class="hljs-attribute">docker</span> build -t javaweb:<span class="hljs-number">1</span>.<span class="hljs-number">0</span> .<br><br><span class="hljs-comment"># 查看构建出来的镜像</span><br><span class="hljs-attribute">docker</span> images<br><br><span class="hljs-comment"># 运行构建的javaweb镜像</span><br><span class="hljs-attribute">docker</span> run --name web -p <span class="hljs-number">8090</span>:<span class="hljs-number">8090</span> -d javaweb:<span class="hljs-number">1</span>.<span class="hljs-number">0</span><br><br><span class="hljs-comment"># 访问http://192.168.1.100:8090/hello/count</span><br></code></pre></td></tr></table></figure><p>此时的 Dockerfile 文件</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-comment"># 指定基础镜像</span><br><span class="hljs-keyword">FROM</span> ubuntu:<span class="hljs-number">16.04</span><br><span class="hljs-comment"># 配置环境变量，JDK的安装目录</span><br><span class="hljs-keyword">ENV</span> JAVA_DIR=/usr/local<br><br><span class="hljs-comment"># 拷贝jdk和java项目的包</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> ./jdk8.tar.gz <span class="hljs-variable">$JAVA_DIR</span>/</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> ./docker-demo.jar /tmp/app.jar</span><br><br><span class="hljs-comment"># 安装JDK</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">cd</span> <span class="hljs-variable">$JAVA_DIR</span> \</span><br><span class="language-bash"> &amp;&amp; tar -xf ./jdk8.tar.gz \</span><br><span class="language-bash"> &amp;&amp; <span class="hljs-built_in">mv</span> ./jdk1.8.0_144 ./java8</span><br><br><span class="hljs-comment"># 配置环境变量</span><br><span class="hljs-keyword">ENV</span> JAVA_HOME=$JAVA_DIR/java8<br><span class="hljs-keyword">ENV</span> PATH=$PATH:$JAVA_HOME/bin<br><br><span class="hljs-comment"># 暴露端口</span><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">8090</span><br><span class="hljs-comment"># 入口，java项目的启动命令</span><br><span class="hljs-keyword">ENTRYPOINT</span><span class="language-bash"> java -jar /tmp/app.jar</span><br><br></code></pre></td></tr></table></figure><p>如果每次打包镜像都安装一遍 java 环境, 那就显得太麻烦了, 所以我们可以引入 java:8-alpine 修改成</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-comment"># 指定基础镜像</span><br><span class="hljs-keyword">FROM</span> java:<span class="hljs-number">8</span>-alpine<br><br><span class="hljs-keyword">COPY</span><span class="language-bash"> ./docker-demo.jar /tmp/app.jar</span><br><br><span class="hljs-comment"># 暴露端口</span><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">8090</span><br><span class="hljs-comment"># 入口，java项目的启动命令</span><br><span class="hljs-keyword">ENTRYPOINT</span><span class="language-bash"> java -jar /tmp/app.jar</span><br><br></code></pre></td></tr></table></figure><p>再次构建运行</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> build -t javaweb:<span class="hljs-number">2</span>.<span class="hljs-number">0</span> .<br><span class="hljs-attribute">docker</span> run --name web -p <span class="hljs-number">8090</span>:<span class="hljs-number">8090</span> -d javaweb:<span class="hljs-number">2</span>.<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><h2 id="安装-DockerCompose"><a href="#安装-DockerCompose" class="headerlink" title="安装 DockerCompose"></a>安装 DockerCompose</h2><p>参考上面</p><h2 id="DockerCompose-部署微服务集群"><a href="#DockerCompose-部署微服务集群" class="headerlink" title="DockerCompose 部署微服务集群"></a>DockerCompose 部署微服务集群</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># 创建并执行容器</span><br>docker<span class="hljs-literal">-compose</span> up <span class="hljs-literal">-d</span><br><br><span class="hljs-comment"># 输出日志</span><br>docker<span class="hljs-literal">-compose</span> logs <span class="hljs-operator">-f</span><br><br><span class="hljs-comment"># 重启容器服务</span><br>docker<span class="hljs-literal">-compose</span> restart gateway userservice orderservice<br><br>docker<span class="hljs-literal">-compose</span> logs <span class="hljs-operator">-f</span><br></code></pre></td></tr></table></figure><p><img src="/assets/876cbf2ef53a427395d864ee9adf9b5d.png"><br><img src="/assets/db2f768b60584ad2aab64b00cef71d7a.png"></p><h2 id="Docker-镜像仓库"><a href="#Docker-镜像仓库" class="headerlink" title="Docker 镜像仓库"></a>Docker 镜像仓库</h2><p>参考上面的 <code>带有图形化界面版本</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs shell">vi /etc/docker/daemon.json<br>,&quot;insecure-registries&quot;:[&quot;http://192.168.1.100:8080&quot;]<br>systemctl daemon-reload<br>systemctl restart docker<br><br>cd /tmp/<br>mkdir registry-ui<br>cd registry-ui/<br>vim docker-compose.yml<br><br>version: &#x27;3.0&#x27;<br>services:<br>  registry:<br>    image: registry<br>    volumes:<br>      - ./registry-data:/var/lib/registry<br>  ui:<br>    image: joxit/docker-registry-ui:static<br>    ports:<br>      - 8080:80<br>    environment:<br>      - REGISTRY_TITLE=传智教育私有仓库<br>      - REGISTRY_URL=http://registry:5000<br>    depends_on:<br>      - registry<br><br><br>docker-compose up -d<br>docker-compose logs -f<br><span class="hljs-meta prompt_"># </span><span class="language-bash">访问http://192.168.1.100:8080/</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">上传镜像</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">下载镜像</span><br>docker images<br>docker tag nginx:latest 192.168.1.100:8080/nginx:1.0<br>docker images<br>docker push 192.168.1.100:8080/nginx:1.0<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">删除已有的镜像</span><br>docker rmi nginx:latest<br>docker rmi 192.168.1.100:8080/nginx:1.0<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">拉取镜像</span><br>docker pull 192.168.1.100:8080/nginx:1.0<br>docker images<br></code></pre></td></tr></table></figure><p><img src="/assets/9cdb1b9bf5044a21a71255d4d1dcdedb.png"><br>推送镜像到仓库前需要重命名镜像(docker tag), 以镜像仓库地址为前缀<br>镜像仓库推送前需要把仓库地址配置到 docker 服务的 daemon.json 文件中, 被 docker 信任</p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>Docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>python基本语法</title>
    <link href="/python/python%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/"/>
    <url>/python/python%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<h2 id="格式化输出"><a href="#格式化输出" class="headerlink" title="格式化输出"></a>格式化输出</h2><h4 id="大小写-12-题"><a href="#大小写-12-题" class="headerlink" title="大小写 12 题"></a>大小写 12 题</h4><p>.lower() — 全部小写<br>.upper() — 全部大写<br>.title() — 各个字符的首字母大写<br>.capitalize() — 首字母大写</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus">name = <span class="hljs-selector-tag">input</span>()<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(name.lower()</span></span>)<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(name.upper()</span></span>)<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(name.title()</span></span>)<br></code></pre></td></tr></table></figure><h4 id="去除空格"><a href="#去除空格" class="headerlink" title="去除空格"></a>去除空格</h4><p>.strip() — 删除两边空格<br>.lstrip() — 删除左边空格<br>.rstrip() — 删除右边空格<br>.replace(“ “,””) — 删除所有空格<br>.split() — 先切分，””.join() — 再拼接</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(input()</span></span><span class="hljs-selector-class">.strip</span>())<br></code></pre></td></tr></table></figure><h4 id="不用循环语句的重复输出"><a href="#不用循环语句的重复输出" class="headerlink" title="不用循环语句的重复输出"></a>不用循环语句的重复输出</h4><p>使用*可以重复输出这段字符串</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-function"><span class="hljs-title">print</span>(<span class="hljs-title">input</span>() * <span class="hljs-number">100</span>)</span><br></code></pre></td></tr></table></figure><h4 id="截取字符串前-10-个字符"><a href="#截取字符串前-10-个字符" class="headerlink" title="截取字符串前 10 个字符"></a>截取字符串前 10 个字符</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(input()</span></span><span class="hljs-selector-attr">[0:10]</span>)<br></code></pre></td></tr></table></figure><h4 id="list-列表的添加和移除"><a href="#list-列表的添加和移除" class="headerlink" title="list 列表的添加和移除"></a>list 列表的添加和移除</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs stylus">offer_list = <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;Allen&#x27;</span>, <span class="hljs-string">&#x27;Tom&#x27;</span>]</span><br><span class="hljs-keyword">for</span> <span class="hljs-selector-tag">i</span> <span class="hljs-keyword">in</span> offer_list:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;&#123;&#125;, you have passed our interview and will soon become a member of our company.&#x27;</span><span class="hljs-selector-class">.format</span>(i))<br><br>offer_list<span class="hljs-selector-class">.remove</span>(<span class="hljs-string">&#x27;Tom&#x27;</span>)<br>offer_list<span class="hljs-selector-class">.append</span>(<span class="hljs-string">&#x27;Andy&#x27;</span>)<br><br><span class="hljs-keyword">for</span> <span class="hljs-selector-tag">i</span> <span class="hljs-keyword">in</span> offer_list:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;&#123;&#125;, welcome to join us!&#x27;</span><span class="hljs-selector-class">.format</span>(i))<br></code></pre></td></tr></table></figure><h4 id="slice-切片函数"><a href="#slice-切片函数" class="headerlink" title="slice 切片函数"></a>slice 切片函数</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">group_list = [ &#x27;Tom&#x27;, &#x27;Allen&#x27;, &#x27;Jane&#x27;, &#x27;William&#x27;, &#x27;Tony&#x27; ]<br><br>print(group_list[slice(0, 2)])<br>print(group_list[slice(1, 4)])<br>print(group_list[slice(3, 5)])<br></code></pre></td></tr></table></figure><h4 id="与或非"><a href="#与或非" class="headerlink" title="与或非"></a>与或非</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">x, y = input().split()<br><br>print(x and y)<br>print(x or y)<br>print(not int(x))<br>print(not int(y))<br><br></code></pre></td></tr></table></figure><h4 id="成员与列表-in"><a href="#成员与列表-in" class="headerlink" title="成员与列表 in"></a>成员与列表 in</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">line = input().split()<br>name = input()<br><br>print(name in line)<br></code></pre></td></tr></table></figure><h4 id="保存数据到文件"><a href="#保存数据到文件" class="headerlink" title="保存数据到文件"></a>保存数据到文件</h4><p>两种保存的方式</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">fp = open(<span class="hljs-string">&#x27;douban.json&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>)</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">fp.write(content)</span><br><br>with open(&#x27;douban1.json&#x27;, &#x27;w&#x27;, encoding=&#x27;utf-8&#x27;) as fp:<br>    fp.write(content)<br></code></pre></td></tr></table></figure><p><a href="https://www.zhihu.com/question/56927648">https://www.zhihu.com/question/56927648</a></p>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>正则表达式给Headers快速加双引号，单引号</title>
    <link href="/python/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%BB%99Headers%E5%BF%AB%E9%80%9F%E5%8A%A0%E5%8F%8C%E5%BC%95%E5%8F%B7%EF%BC%8C%E5%8D%95%E5%BC%95%E5%8F%B7/"/>
    <url>/python/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%BB%99Headers%E5%BF%AB%E9%80%9F%E5%8A%A0%E5%8F%8C%E5%BC%95%E5%8F%B7%EF%BC%8C%E5%8D%95%E5%BC%95%E5%8F%B7/</url>
    
    <content type="html"><![CDATA[<h4 id="pycharm-方式"><a href="#pycharm-方式" class="headerlink" title="pycharm 方式"></a>pycharm 方式</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">Ctrl R<br><br>勾选正则表达式<br>(.*): (.*)<br>&#x27;$1&#x27;: &#x27;$2&#x27;,<br><br>选中替换的文本<br>Replace All<br></code></pre></td></tr></table></figure><p><img src="/assets/3b4bbacaaabb42c8a1876098a9dd0501.png"><br><img src="/assets/ba3064f6bb424d5dafb3d68f66df5326.png"><br>简单快速, 非常好用</p><h4 id="vscode-也可以"><a href="#vscode-也可以" class="headerlink" title="vscode 也可以"></a>vscode 也可以</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">Ctrl H<br><br>勾选正则表达式<br>(.*): (.*)<br>&#x27;$1&#x27;: &#x27;$2&#x27;,<br><br>选中替换的文本<br>Replace All<br></code></pre></td></tr></table></figure><p><img src="/assets/307d08a8f5b1419a9fde6b72932ec878.png"><br><img src="/assets/bfbbc9c6c64c4a78a25c0e0cc2d3676c.png"></p>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>hexo url大小写bug</title>
    <link href="/hexo/hexo%20url%E5%A4%A7%E5%B0%8F%E5%86%99bug/"/>
    <url>/hexo/hexo%20url%E5%A4%A7%E5%B0%8F%E5%86%99bug/</url>
    
    <content type="html"><![CDATA[<p>非常蛋疼的 bug, 大写的时候代码会报错, 手动改成消息就能正常访问页面了<br><img src="/assets/224c535bf8fd4af793bb9f22c04d277c.png"><br><img src="/assets/e84d6f0ef7f849d5a633dae7a4f8e4fa.png"></p><p>参考<a href="https://trifond.github.io/2018/12/05/hexo-folder-ignore-case/">Hexo 部署到 Github 后文件夹名大小写引起的问题</a></p><p>因为 git 的命令忽略了文件名的大小写<br>进入 hexo 根目录, .deploy_git&#x2F;.git&#x2F;config<br>将 ignorecase 修改成 false</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[core]</span><br><span class="hljs-attr">symlinks</span> = <span class="hljs-literal">false</span><br><span class="hljs-attr">ignorecase</span> = <span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure><p>接着把.deploy_git 的其他目录删除干净, github 仓库也清理下</p><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nsis">git rm -rf *<br>git commit -m ‘clean <span class="hljs-literal">all</span> <span class="hljs-keyword">file</span>’<br>git <span class="hljs-keyword">push</span><br></code></pre></td></tr></table></figure><p>接着再重新部署到 github 就行了</p>]]></content>
    
    
    <categories>
      
      <category>hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo绑定域名</title>
    <link href="/hexo/Hexo%E7%BB%91%E5%AE%9A%E5%9F%9F%E5%90%8D/"/>
    <url>/hexo/Hexo%E7%BB%91%E5%AE%9A%E5%9F%9F%E5%90%8D/</url>
    
    <content type="html"><![CDATA[<h4 id="购买域名"><a href="#购买域名" class="headerlink" title="购买域名"></a>购买域名</h4><p>上<a href="https://wanwang.aliyun.com/domain/searchresult/">阿里云</a>购买一个域名</p><h4 id="解析域名"><a href="#解析域名" class="headerlink" title="解析域名"></a>解析域名</h4><p>购买之后去 <a href="https://dc.console.aliyun.com/">域名控制台</a>解析域名到我们的 roudoukou.github.io<br><img src="/assets/fb866523c594419b9fc15825515f3f5b.png"></p><p>通过 ping 获取 ip<br><img src="/assets/8a3ac202bb444fc5892866fb12d8bee2.png"><br>添加三个记录<br><img src="/assets/91d487956f5e4b8fbb3ff6114e570fdc.png"><br>CNAME 表示将域名指向另外一个域名<br>www 表示<a href="http://www.xiamu.icu就能访问/">www.xiamu.icu就能访问</a> *表示泛解析, 匹配所有其他的域名</p><p>接下来来到 roudoukou.github.io 仓库, 绑定域名<br><img src="/assets/9ac01f4486fe415297637125cfe96791.png"><br>记得在 hexo 根目录中 source 创建 CNAME 文件(无后缀), 里面写上域名, 不要有多余的符号<br><img src="/assets/0bbafb0cd200446aaccef33e2b559970.png"></p><p>参考链接: <a href="https://juejin.cn/post/6998140713334472740">【Hexo】域名绑定篇 - 掘金</a></p><h4 id="关于-SSL-证书的-bug"><a href="#关于-SSL-证书的-bug" class="headerlink" title="关于 SSL 证书的 bug"></a>关于 SSL 证书的 bug</h4><p>记得是昨天晚上才绑定完域名, 开开心心的就去睡觉了, 第二天早上一起床就发现有点不对劲<br><img src="/assets/6a0e229b0764483f8d31376c372a9206.png"><br>网站页面能正常显示出来, 但是图片却加载不出来了<br>大致看了看控制台的报错信息, 大概是请求的图片给加上了 https, 原先一直都是 http 去请求图片<br>这个还算好解决, 去 cdn 开启 https 就可以了(需要上传证书绑定 cdn)<br><img src="/assets/dd4c104ed3264639b7dbfad83d1d2247.png"></p>]]></content>
    
    
    <categories>
      
      <category>hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>切换title和网站logo</title>
    <link href="/hexo/%E5%88%87%E6%8D%A2title%E5%92%8C%E7%BD%91%E7%AB%99logo/"/>
    <url>/hexo/%E5%88%87%E6%8D%A2title%E5%92%8C%E7%BD%91%E7%AB%99logo/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    <categories>
      
      <category>hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>hexo添加音乐播放器</title>
    <link href="/hexo/hexo%E6%B7%BB%E5%8A%A0%E9%9F%B3%E4%B9%90%E6%92%AD%E6%94%BE%E5%99%A8/"/>
    <url>/hexo/hexo%E6%B7%BB%E5%8A%A0%E9%9F%B3%E4%B9%90%E6%92%AD%E6%94%BE%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>在网页中添加音乐播放器<br>参考网站:<br><a href="https://ftzzloo.com/hexo-add-aplayer-plugins/#Start">给 Hexo 添加音乐播放器插件</a><br><a href="https://easyhexo.com/3-Plugins-use-and-config/3-1-hexo-tag-aplayer/#%E4%BB%8B%E7%BB%8D">hexo-tag-aplayer | Easy Hexo 👨‍💻</a><br><a href="https://moechun.fun/2022/07/28/Hexo%E5%8D%9A%E5%AE%A2%E4%BD%BF%E7%94%A8aplayer%E9%9F%B3%E4%B9%90%E6%92%AD%E6%94%BE%E6%8F%92%E4%BB%B6/">Hexo 博客使用 aplayer 音乐播放插件</a></p><h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livescript">PS E:<span class="hljs-string">\Code\Blog\hexo-blog&gt;</span> <span class="hljs-built_in">npm</span> install hexo-tag-aplayer -s<br></code></pre></td></tr></table></figure><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>在_config.yml 配置</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">aplayer:</span><br>  <span class="hljs-attr">meting:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># MetingJS 支持</span><br>  <span class="hljs-attr">asset_inject:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># 自动插入Aplayer.js与Meting.js资源脚本（默认开启）</span><br></code></pre></td></tr></table></figure><h2 id="单曲实例"><a href="#单曲实例" class="headerlink" title="单曲实例"></a>单曲实例</h2><p>之后在页面中引入播放器</p><script>console.error("Error: [hexo-tag-aplayer] Specified asset file not found ([https://cn-south-17-aplayer-46154810.oss.dogecdn.com/hikarunara.jpg](https://cn-south-17-aplayer-46154810.oss.dogecdn.com/hikarunara.jpg"))");</script><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs erlang-repl">&#123;<span class="hljs-comment">% aplayer</span><br><span class="hljs-string">&quot;光るなら&quot;</span><br><span class="hljs-string">&quot;Goose house&quot;</span><br><span class="hljs-string">&quot;https://cn-south-17-aplayer-46154810.oss.dogecdn.com/hikarunara.mp3&quot;</span><br><span class="hljs-string">&quot;https://cn-south-17-aplayer-46154810.oss.dogecdn.com/hikarunara.jpg&quot;</span><br><span class="hljs-string">&quot;lrc:https://cn-south-17-aplayer-46154810.oss.dogecdn.com/hikarunara.lrc&quot;</span><br><span class="hljs-string">&quot;width:100%&quot;</span><br><span class="hljs-comment">%&#125;</span><br></code></pre></td></tr></table></figure>歌单实例<script>console.error("SyntaxError: Unexpected token / in JSON at position 55");</script><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs ruby">&#123;% aplayerlist %&#125;<br>&#123;<br>    <span class="hljs-string">&quot;narrow&quot;</span>: <span class="hljs-literal">false</span>,<br>    <span class="hljs-string">&quot;autoplay&quot;</span>: <span class="hljs-literal">false</span>,<br>    <span class="hljs-string">&quot;mode&quot;</span>: <span class="hljs-string">&quot;random&quot;</span>,<span class="hljs-regexp">//</span>（可选）<span class="hljs-string">&#x27;random&#x27;</span>, <span class="hljs-string">&#x27;single&#x27;</span> (单曲播放), <span class="hljs-string">&#x27;circulation&#x27;</span> (循环播放), <span class="hljs-string">&#x27;order&#x27;</span> (列表播放)， 默认：<span class="hljs-string">&#x27;circulation&#x27;</span><br>    <span class="hljs-string">&quot;showlrc&quot;</span>: <span class="hljs-number">3</span>,<br>    <span class="hljs-string">&quot;mutex&quot;</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-string">&quot;theme&quot;</span>: <span class="hljs-string">&quot;#e6d0b2&quot;</span>,<br>    <span class="hljs-string">&quot;preload&quot;</span>: <span class="hljs-string">&quot;metadata&quot;</span>,<br>    <span class="hljs-string">&quot;listmaxheight&quot;</span>: <span class="hljs-string">&quot;513px&quot;</span>,<br>    <span class="hljs-string">&quot;music&quot;</span>: [<br>        &#123;<br>            <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;前前前世&quot;</span>,<br>            <span class="hljs-string">&quot;author&quot;</span>: <span class="hljs-string">&quot;RADWIMPS&quot;</span>,<br>            <span class="hljs-string">&quot;url&quot;</span>: <span class="hljs-string">&quot;https://cn-south-17-aplayer-46154810.oss.dogecdn.com/yourname.mp3&quot;</span>,<br>            <span class="hljs-string">&quot;pic&quot;</span>: <span class="hljs-string">&quot;https://cn-south-17-aplayer-46154810.oss.dogecdn.com/yourname.jpg&quot;</span>,<br>            <span class="hljs-string">&quot;lrc&quot;</span>: <span class="hljs-string">&quot;https://cn-south-17-aplayer-46154810.oss.dogecdn.com/yourname.lrc&quot;</span><br>        &#125;,<br>        &#123;<br>            <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;光るなら&quot;</span>,<br>            <span class="hljs-string">&quot;author&quot;</span>: <span class="hljs-string">&quot;Goose house&quot;</span>,<br>            <span class="hljs-string">&quot;url&quot;</span>: <span class="hljs-string">&quot;https://cn-south-17-aplayer-46154810.oss.dogecdn.com/hikarunara.mp3&quot;</span>,<br>            <span class="hljs-string">&quot;pic&quot;</span>: <span class="hljs-string">&quot;https://cn-south-17-aplayer-46154810.oss.dogecdn.com/hikarunara.jpg&quot;</span>,<br>            <span class="hljs-string">&quot;lrc&quot;</span>: <span class="hljs-string">&quot;https://cn-south-17-aplayer-46154810.oss.dogecdn.com/hikarunara.lrc&quot;</span><br>        &#125;<br>    ]<br>&#125;<br>&#123;% endaplayerlist %&#125;<br></code></pre></td></tr></table></figure><table><thead><tr><th><strong>参数</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td>title</td><td>歌曲标题</td></tr><tr><td>author</td><td>歌曲作者</td></tr><tr><td>url</td><td>音乐文件 URL 地址</td></tr><tr><td>picture_url</td><td>（可选）封面图片地址</td></tr><tr><td>narrow</td><td>（可选）播放器袖珍风格</td></tr><tr><td>autoplay</td><td>（可选）自动播放，移动端浏览器暂时不支持此功能</td></tr><tr><td>width</td><td>（可选）播放器宽度 (默认: 100%)</td></tr><tr><td>lrc</td><td>（可选）歌词文件 URL 地址</td></tr></tbody></table><h2 id="MetingJS-支持"><a href="#MetingJS-支持" class="headerlink" title="MetingJS 支持"></a>MetingJS 支持</h2><p>引入 MetingJS, 播放器支持 QQ 音乐, 网易云等</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">aplayer:</span><br>  <span class="hljs-attr">meting:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># MetingJS 支持</span><br>  <span class="hljs-attr">asset_inject:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># 自动插入Aplayer.js与Meting.js资源脚本（默认开启）</span><br></code></pre></td></tr></table></figure><p>设置后页面在初始化播放器时会引入 1.2.0 版本的 Meting.min.js 文件<br>注意不是在主题配置文件_config.yml 设置，设置后要重启 hexo 服务才能生效</p><h2 id="Meting-JS-单曲"><a href="#Meting-JS-单曲" class="headerlink" title="Meting JS 单曲"></a>Meting JS 单曲</h2><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mel">&#123;% meting <span class="hljs-string">&quot;1330348068&quot;</span> <span class="hljs-string">&quot;netease&quot;</span> <span class="hljs-string">&quot;song&quot;</span>  <span class="hljs-string">&quot;theme: #1da496&quot;</span> %&#125;<br></code></pre></td></tr></table></figure>    <div id="aplayer-OtQPURIn" class="aplayer aplayer-tag-marker meting-tag-marker"         data-id="1330348068" data-server="netease" data-type="song" data-mode="circulation" data-autoplay="false" data-mutex="true" data-listmaxheight="340px" data-preload="auto" data-theme=" #1da496"    ></div><h2 id="Meting-JS-歌单"><a href="#Meting-JS-歌单" class="headerlink" title="Meting JS 歌单"></a>Meting JS 歌单</h2><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livescript">&#123;% meting <span class="hljs-string">&quot;5237049130&quot;</span> <span class="hljs-string">&quot;netease&quot;</span> <span class="hljs-string">&quot;playlist&quot;</span> <span class="hljs-string">&quot;&quot;</span> <span class="hljs-string">&quot;mutex: false&quot;</span> <span class="hljs-string">&quot;listmaxheight: 340px&quot;</span> <span class="hljs-string">&quot;preload: none&quot;</span> <span class="hljs-string">&quot;theme: <span class="hljs-subst">#ad7a86</span>&quot;</span> %&#125;<br></code></pre></td></tr></table></figure>    <div id="aplayer-SBWhdCdR" class="aplayer aplayer-tag-marker meting-tag-marker"         data-id="5237049130" data-server="netease" data-type="playlist" data-mode="circulation" data-autoplay="false" data-mutex="false" data-listmaxheight=" 340px" data-preload=" none" data-theme=" #ad7a86"    ></div><table><thead><tr><th><strong>选项</strong></th><th><strong>默认值</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td>id</td><td>必须值</td><td>歌曲 id &#x2F; 播放列表 id &#x2F; 相册 id &#x2F; 搜索关键字</td></tr><tr><td>server</td><td>必须值</td><td>音乐平台: netease, tencent, kugou, xiami, baidu</td></tr><tr><td>type</td><td>必须值</td><td>song, playlist, album, search, artist</td></tr><tr><td>fixed</td><td>false</td><td>开启固定模式</td></tr><tr><td>mini</td><td>false</td><td>开启迷你模式</td></tr><tr><td>loop</td><td>all</td><td>列表循环模式：all, one,none</td></tr><tr><td>order</td><td>list</td><td>列表播放模式： list, random</td></tr><tr><td>volume</td><td>0.7</td><td>播放器音量</td></tr><tr><td>lrctype</td><td>0</td><td>歌词格式类型</td></tr><tr><td>listfolded</td><td>false</td><td>指定音乐播放列表是否折叠</td></tr><tr><td>storagename</td><td>metingjs</td><td>LocalStorage 中存储播放器设定的键名</td></tr><tr><td>autoplay</td><td>true</td><td>自动播放，移动端浏览器暂时不支持此功能</td></tr><tr><td>mutex</td><td>true</td><td>该选项开启时，如果同页面有其他 aplayer 播放，该播放器会暂停</td></tr><tr><td>listmaxheight</td><td>340px</td><td>播放列表的最大长度</td></tr><tr><td>preload</td><td>auto</td><td>音乐文件预载入模式，可选项： none, metadata, auto</td></tr><tr><td>theme</td><td>#ad7a86</td><td>播放器风格色彩设置</td></tr></tbody></table><h2 id="播放器设置吸底模式"><a href="#播放器设置吸底模式" class="headerlink" title="播放器设置吸底模式"></a>播放器设置吸底模式</h2><p>在 themes&#x2F;fluid&#x2F;layout&#x2F;layout.ejs 文件, <body>标签添加</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs abnf">&lt;div class<span class="hljs-operator">=</span><span class="hljs-string">&quot;aplayer&quot;</span><br>  data-id<span class="hljs-operator">=</span><span class="hljs-string">&quot;5237049130&quot;</span><br>  data-server<span class="hljs-operator">=</span><span class="hljs-string">&quot;netease&quot;</span><br>  data-type<span class="hljs-operator">=</span><span class="hljs-string">&quot;playlist&quot;</span><br>  data-fixed<span class="hljs-operator">=</span><span class="hljs-string">&quot;true&quot;</span><br>  data-autoplay<span class="hljs-operator">=</span><span class="hljs-string">&quot;false&quot;</span><br>  data-order<span class="hljs-operator">=</span><span class="hljs-string">&quot;list&quot;</span><br>  data-volume<span class="hljs-operator">=</span><span class="hljs-string">&quot;0.5&quot;</span><br>  data-theme<span class="hljs-operator">=</span><span class="hljs-string">&quot;#1da496&quot;</span><br>  data-preload<span class="hljs-operator">=</span><span class="hljs-string">&quot;auto&quot;</span><br>  &gt;<br>&lt;/div&gt;<br><br></code></pre></td></tr></table></figure><header>或者<footer>加入<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.jsdelivr.net/npm/meting@1.2.0/dist/Meting.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure>因为在主题文件中手动加入了依赖文件，所以可以在hexo配置文件中关闭插件的自动脚本插入功能：<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">aplayer:</span><br>  <span class="hljs-attr">meting:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># MetingJS 支持</span><br>  <span class="hljs-attr">asset_inject:</span> <span class="hljs-literal">false</span> <span class="hljs-comment"># 关闭自动脚本插入</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>语雀导出到hexo</title>
    <link href="/hexo/%E8%AF%AD%E9%9B%80%E5%AF%BC%E5%87%BA%E5%88%B0hexo/"/>
    <url>/hexo/%E8%AF%AD%E9%9B%80%E5%AF%BC%E5%87%BA%E5%88%B0hexo/</url>
    
    <content type="html"><![CDATA[<p>因为语雀收费了, 编写的笔记在互联网中分享需要会员, 本人比较屌丝, 充不起会员<br><a href="https://github.com/x-cold/yuque-hexo">https://github.com/x-cold/yuque-hexo</a><br>使用 yuque-hexo 将语雀编写的文章</p><p>在 hexo 博客根目录中下载 yuque-hexo 插件</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">PS</span> <span class="hljs-selector-tag">E</span>:\<span class="hljs-selector-tag">Code</span>\<span class="hljs-selector-tag">Blog</span>\<span class="hljs-selector-tag">hexo-blog</span>&gt; <span class="hljs-selector-tag">npm</span> <span class="hljs-selector-tag">i</span> <span class="hljs-selector-tag">-g</span> <span class="hljs-selector-tag">yuque-hexo</span><br></code></pre></td></tr></table></figure><p>如果安装插件的时候发生了警告, 请先把 package-lock.json 删除掉重新生成<br><img src="/assets/778418c4d40c40d7a3c70f1a59c95a7c.png"><br>然后打开 package.json<br>配置</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;yuqueConfig&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;postPath&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;source/_posts&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;cachePath&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;yuque.json&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;mdNameFormat&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;title&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;adapter&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hexo&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;concurrency&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;baseUrl&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://www.yuque.com/api/v2&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;login&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;roudoukou-umqjd&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;repo&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;xn56rg&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;onlyPublished&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;onlyPublic&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;lastGeneratePath&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;lastGeneratePath.log&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;imgCdn&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;enabled&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;concurrency&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;imageBed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;github&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;host&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;cdn.jsdelivr.net&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;bucket&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;roudoukou.github.io&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;region&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;prefixKey&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;blog-img&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>postPath 表示文档下载的路径<br>login 表示是个人路径<br>repo 仓库路径<br>imgCdn 图床的配置<br>enable 开启图床<br>concurrency 并发量<br>host 是使用的图床的主机<br>bucket 图床 bucket 名称<br>region 图床的 region<br>prefixKey 文件名的前缀</p><p>同步文档到本地</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">PS</span> E:\<span class="hljs-meta">Code</span>\Blog\hexo-blog&gt; yuque-hexo sync<br></code></pre></td></tr></table></figure><p><img src="/assets/b332208ba70848a3a00e0aab93517cf8.png"><br>配置三个 token</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">set</span> <span class="hljs-attribute">YUQUE_TOKEN</span>=XXX<br><span class="hljs-built_in">set</span> <span class="hljs-attribute">SECRET_ID</span>=XXX<br><span class="hljs-built_in">set</span> <span class="hljs-attribute">SECRET_KEY</span>=XXX<br></code></pre></td></tr></table></figure><p>可以把环境变量写在一个.env 文件中, 记得给.gitignore 中排除这个.env 文件, 以防上传到了 github, 因为 TOKEN 是敏感信息</p>]]></content>
    
    
    <categories>
      
      <category>hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RabbitMQ</title>
    <link href="/Java/RabbitMQ/"/>
    <url>/Java/RabbitMQ/</url>
    
    <content type="html"><![CDATA[<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>记得在有管理员权限安装</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs crystal">[root<span class="hljs-variable">@hadoop202</span> software]<span class="hljs-comment"># rpm -ivh erlang-21.3-1.el7.x86_64.rpm</span><br><br>[root<span class="hljs-variable">@hadoop202</span> software]<span class="hljs-comment"># yum install socat -y</span><br><br>[xiamu<span class="hljs-variable">@hadoop202</span> software]<span class="hljs-variable">$ </span>rpm -ivh rabbitmq-server-<span class="hljs-number">3.8</span>.<span class="hljs-number">8</span>-<span class="hljs-number">1</span>.el7.noarch.rpm<br></code></pre></td></tr></table></figure><h2 id="开启服务"><a href="#开启服务" class="headerlink" title="开启服务"></a>开启服务</h2><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs autoit">[root<span class="hljs-symbol">@hadoop202</span> software]<span class="hljs-meta"># systemctl start rabbitmq-server</span><br><br>[root<span class="hljs-symbol">@hadoop202</span> software]<span class="hljs-meta"># systemctl statua rabbitmq-server</span><br><br>[root<span class="hljs-symbol">@hadoop202</span> software]<span class="hljs-meta"># systemctl stop rabbitmq-server</span><br></code></pre></td></tr></table></figure><h2 id="安装-Web-界面插件"><a href="#安装-Web-界面插件" class="headerlink" title="安装 Web 界面插件"></a>安装 Web 界面插件</h2><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs autoit">[root<span class="hljs-symbol">@hadoop202</span> software]<span class="hljs-meta"># systemctl stop rabbitmq-server</span><br><br>[root<span class="hljs-symbol">@hadoop202</span> software]<span class="hljs-meta"># rabbitmq-plugins enable rabbitmq_management</span><br><br>[root<span class="hljs-symbol">@hadoop202</span> software]<span class="hljs-meta"># systemctl start rabbitmq-server</span><br><br>[root<span class="hljs-symbol">@hadoop202</span> software]<span class="hljs-meta"># systemctl status rabbitmq-server</span><br><br></code></pre></td></tr></table></figure><p>安装 Web 界面完成之后, 访问如下地址<br><a href="http://hadoop202:15672/">http://hadoop202:15672/</a><br>注意记得关闭防火墙<br><img src="/assets/dc38d8ef0d3f4b93858b84ee66f2f2e3.png"><br>第一次登录不了, 需要添加账户才能登录<br>username: guest<br>password: guest</p><h2 id="添加账户-给予权限"><a href="#添加账户-给予权限" class="headerlink" title="添加账户 给予权限"></a>添加账户 给予权限</h2><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs prolog">创建账号<br>[root@hadoop202 software]# rabbitmqctl add_user admin <span class="hljs-number">123</span><br><span class="hljs-symbol">Adding</span> user <span class="hljs-string">&quot;admin&quot;</span> ...<br><br>设置用户角色<br>[root@hadoop202 software]# rabbitmqctl set_user_tags admin administrator<br><span class="hljs-symbol">Setting</span> tags for user <span class="hljs-string">&quot;admin&quot;</span> to [administrator] ...<br><br>设置用户权限<br>set_permissions [-p &lt;vhostpath&gt;] &lt;user&gt; &lt;conf&gt; &lt;write&gt; &lt;read&gt;<br>[root@hadoop202 software]# rabbitmqctl set_permissions -p <span class="hljs-string">&quot;/&quot;</span> admin <span class="hljs-string">&quot;.*&quot;</span> <span class="hljs-string">&quot;.*&quot;</span> <span class="hljs-string">&quot;.*&quot;</span><br><span class="hljs-symbol">Setting</span> permissions for user <span class="hljs-string">&quot;admin&quot;</span> in vhost <span class="hljs-string">&quot;/&quot;</span> ...<br>用户 user_admin 具有/vhost1 这个 virtual host 中所有资源的配置、写、读权限<br><br>当前用户和角色<br>[root@hadoop202 software]#    rabbitmqctl list_users<br><span class="hljs-symbol">Listing</span> users ...<br>usertags<br>admin[administrator]<br>guest[administrator]<br>[root@hadoop202 software]#<br><br></code></pre></td></tr></table></figure><p>再次登录<br>账号 admin<br>密码 123</p><h2 id="创建-JAVA-开发环境"><a href="#创建-JAVA-开发环境" class="headerlink" title="创建 JAVA 开发环境"></a>创建 JAVA 开发环境</h2><p>引入依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--rabbitmq 依赖客户端--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.rabbitmq<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>amqp-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.8.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--操作文件流的一个依赖--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-io<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-io<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.6<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br></code></pre></td></tr></table></figure><h2 id="创建生产者"><a href="#创建生产者" class="headerlink" title="创建生产者"></a>创建生产者</h2><p>com.atguigu.one<br>Producer 代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.one;<br><br><span class="hljs-keyword">import</span> com.rabbitmq.client.Channel;<br><span class="hljs-keyword">import</span> com.rabbitmq.client.Connection;<br><span class="hljs-keyword">import</span> com.rabbitmq.client.ConnectionFactory;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.nio.charset.StandardCharsets;<br><span class="hljs-keyword">import</span> java.util.concurrent.TimeoutException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Producer</span> &#123;<br>    <span class="hljs-comment">// 队列名称</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">QUEUE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;hello&quot;</span>;<br><br>    <span class="hljs-comment">// 发消息</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, TimeoutException &#123;<br>        <span class="hljs-type">ConnectionFactory</span> <span class="hljs-variable">connectionFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConnectionFactory</span>();<br>        <span class="hljs-comment">// 工程IP 连接RabbitMQ的队列</span><br>        connectionFactory.setHost(<span class="hljs-string">&quot;hadoop202&quot;</span>);<br>        <span class="hljs-comment">// 用户名</span><br>        connectionFactory.setUsername(<span class="hljs-string">&quot;admin&quot;</span>);<br>        <span class="hljs-comment">// 密码</span><br>        connectionFactory.setPassword(<span class="hljs-string">&quot;123&quot;</span>);<br><br>        <span class="hljs-comment">// 创建连接</span><br>        <span class="hljs-type">Connection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> connectionFactory.newConnection();<br><br>        <span class="hljs-comment">// 获取信道</span><br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> connection.createChannel();<br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * 生成一个队列</span><br><span class="hljs-comment">         * 1. 队列名称</span><br><span class="hljs-comment">         * 2. 队列里面的消息是否持久化(磁盘), 默认情况下消息存储在内存中</span><br><span class="hljs-comment">         * 3. 该队列是否只供一个消费者进行消费 是否进行消息共享, true可以多个消费者消费 false: 只能一个消费者消费</span><br><span class="hljs-comment">         * 4. 是否自动删除 最后一个消费者断开连接以后, 该队列是否自动删除 true自动删除 false 不自动删除</span><br><span class="hljs-comment">         * 5. 其他参数</span><br><span class="hljs-comment">          */</span><br>        channel.queueDeclare(QUEUE_NAME, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">null</span>);<br><br>        <span class="hljs-comment">// 发消息</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;hello world&quot;</span>; <span class="hljs-comment">// 初次使用</span><br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * 发送一个消息</span><br><span class="hljs-comment">         * 1. 发送到哪个交换机</span><br><span class="hljs-comment">         * 2. 路由的Key是哪个 本次是队列名称</span><br><span class="hljs-comment">         * 3. 其他参数信息</span><br><span class="hljs-comment">         * 4. 发送的消息</span><br><span class="hljs-comment">         */</span><br>        channel.basicPublish(<span class="hljs-string">&quot;&quot;</span>, QUEUE_NAME, <span class="hljs-literal">null</span>, message.getBytes());<br>        System.out.println(<span class="hljs-string">&quot;消息发送完毕&quot;</span>);<br><br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="创建消费者"><a href="#创建消费者" class="headerlink" title="创建消费者"></a>创建消费者</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.one;<br><br><span class="hljs-keyword">import</span> com.rabbitmq.client.*;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.util.concurrent.TimeoutException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Consumer</span> &#123;<br>    <span class="hljs-comment">// 队列的名称</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">QUEUE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;hello&quot;</span>;<br><br>    <span class="hljs-comment">//接收消息</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, TimeoutException &#123;<br>        <span class="hljs-comment">// 创建连接工厂</span><br>        <span class="hljs-type">ConnectionFactory</span> <span class="hljs-variable">connectionFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConnectionFactory</span>();<br>        connectionFactory.setHost(<span class="hljs-string">&quot;hadoop202&quot;</span>);<br>        connectionFactory.setUsername(<span class="hljs-string">&quot;admin&quot;</span>);<br>        connectionFactory.setPassword(<span class="hljs-string">&quot;123&quot;</span>);<br>        <span class="hljs-type">Connection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> connectionFactory.newConnection();<br><br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> connection.createChannel();<br><br>        <span class="hljs-comment">// 声明 接收消息</span><br>        <span class="hljs-type">DeliverCallback</span> <span class="hljs-variable">deliverCallback</span> <span class="hljs-operator">=</span> (consumerTag,message) -&gt; &#123;<br>            System.out.println(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(message.getBody()));<br>        &#125;;<br><br>        <span class="hljs-comment">// 取消消息时的回调</span><br>        <span class="hljs-type">CancelCallback</span> <span class="hljs-variable">cancelCallback</span> <span class="hljs-operator">=</span> (consumerTag) -&gt; &#123;<br>            System.out.println(<span class="hljs-string">&quot;消息消费被中断&quot;</span>);<br>        &#125;;<br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * 消费者消费消息</span><br><span class="hljs-comment">         * 1. 消息哪个队列</span><br><span class="hljs-comment">         * 2. 消费成功之后是否要自动应答 true 代表的自动应答</span><br><span class="hljs-comment">         * 3. 消费者未成功消费的回调</span><br><span class="hljs-comment">         * 4. 消费者取消消费的回调</span><br><span class="hljs-comment">         */</span><br>        channel.basicConsume(QUEUE_NAME, <span class="hljs-literal">true</span>, deliverCallback, cancelCallback);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="工作队列原理"><a href="#工作队列原理" class="headerlink" title="工作队列原理"></a>工作队列原理</h2><p>工作队列(又称任务队列)的主要思想是避免立即执行资源密集型任务，而不得不等待它完成。相反我们安排任务在之后执行。我们把任务封装为消息并将其发送到队列。在后台运行的工作进程将弹出任务并最终执行作业。当有多个工作线程时，这些工作线程将一起处理这些任务。<br><img src="/assets/2fb6d086ad5a4d07b8c046537e83bd48.png"></p><h2 id="抽取连接工厂工具类"><a href="#抽取连接工厂工具类" class="headerlink" title="抽取连接工厂工具类"></a>抽取连接工厂工具类</h2><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">package</span> com.atguigu.utils;<br><br><span class="hljs-keyword">import</span> com.rabbitmq.client.Channel;<br><span class="hljs-keyword">import</span> com.rabbitmq.client.Connection;<br><span class="hljs-keyword">import</span> com.rabbitmq.client.ConnectionFactory;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 此类为连接工厂创建信道的工具类</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RabbitMqUtils</span> </span>&#123;<br>    <span class="hljs-comment">//得到一个连接的 channel</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Channel getChannel() throws Exception &#123;<br>        <span class="hljs-comment">//创建一个连接工厂</span><br>        ConnectionFactory factory = <span class="hljs-keyword">new</span> <span class="hljs-type">ConnectionFactory</span>();<br>        factory.setHost(<span class="hljs-string">&quot;hadoop202S&quot;</span>);<br>        factory.setUsername(<span class="hljs-string">&quot;admin&quot;</span>);<br>        factory.setPassword(<span class="hljs-string">&quot;123&quot;</span>);<br>        Connection connection = factory.<span class="hljs-keyword">new</span><span class="hljs-type">Connection</span>();<br>        Channel channel = connection.createChannel();<br>        <span class="hljs-keyword">return</span> channel;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="启动多个工作线程"><a href="#启动多个工作线程" class="headerlink" title="启动多个工作线程"></a>启动多个工作线程</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.two;<br><br><span class="hljs-keyword">import</span> com.atguigu.utils.RabbitMqUtils;<br><span class="hljs-keyword">import</span> com.rabbitmq.client.CancelCallback;<br><span class="hljs-keyword">import</span> com.rabbitmq.client.Channel;<br><span class="hljs-keyword">import</span> com.rabbitmq.client.DeliverCallback;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 这是一个工作线程(相当于之前消费者)</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Worker01</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">QUEUE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;hello&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> RabbitMqUtils.getChannel();<br><br>        <span class="hljs-type">DeliverCallback</span> <span class="hljs-variable">deliverCallback</span> <span class="hljs-operator">=</span> (consumerTag, message) -&gt; &#123;<br>            System.out.println(<span class="hljs-string">&quot;接收到的消息: &quot;</span> + <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(message.getBody()));<br>        &#125;;<br><br>        <span class="hljs-type">CancelCallback</span> <span class="hljs-variable">cancelCallback</span> <span class="hljs-operator">=</span> (consumerTag) -&gt; &#123;<br>            System.out.println(consumerTag + <span class="hljs-string">&quot;消费者取消消费接口回调逻辑&quot;</span>);<br>        &#125;;<br><br>        System.out.println(<span class="hljs-string">&quot;C3等待接收消息...&quot;</span>);<br><br>        <span class="hljs-comment">// 消息的接收</span><br>        channel.basicConsume(QUEUE_NAME, <span class="hljs-literal">true</span>, deliverCallback, cancelCallback);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/assets/2866cbe65c324762b5899d1653522bd3.png"><br>然后运行三个工作线程(实例)<br><img src="/assets/33661b2f400646ff8885a01518489233.png"></p><h2 id="工作队列-生产者代码"><a href="#工作队列-生产者代码" class="headerlink" title="工作队列 - 生产者代码"></a>工作队列 - 生产者代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.two;<br><br><span class="hljs-keyword">import</span> com.atguigu.utils.RabbitMqUtils;<br><span class="hljs-keyword">import</span> com.rabbitmq.client.Channel;<br><br><span class="hljs-keyword">import</span> java.util.Scanner;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 生产者 发送大量消息</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Task01</span> &#123;<br>    <span class="hljs-comment">// 队列名称</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">QUEUE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;hello&quot;</span>;<br><br>    <span class="hljs-comment">// 发送大量消息</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> RabbitMqUtils.getChannel();<br><br>        <span class="hljs-comment">// 队列的声明</span><br>        channel.queueDeclare(QUEUE_NAME, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">null</span>);<br><br>        <span class="hljs-comment">// 从控制台当中接收消息</span><br>        <span class="hljs-type">Scanner</span> <span class="hljs-variable">scanner</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(System.in);<br>        <span class="hljs-keyword">while</span> (scanner.hasNext()) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> scanner.next();<br>            channel.basicPublish(<span class="hljs-string">&quot;&quot;</span>, QUEUE_NAME, <span class="hljs-literal">null</span>, message.getBytes());<br>            System.out.println(<span class="hljs-string">&quot;发送消息完成: &quot;</span> + message);<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>测试结果:<br><img src="/assets/2cc5124b5deb41788858129816a79bbb.png"><br><img src="/assets/db48a7fda0744d4f997fe24fb969c6c3.png"><br><img src="/assets/514c7178cabe442c9047f0ee79b72392.png"><br><img src="/assets/e86c2d4b7f7447998016b3afc6303dde.png"></p><h2 id="消息应答生产者"><a href="#消息应答生产者" class="headerlink" title="消息应答生产者"></a>消息应答生产者</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.three;<br><br><span class="hljs-keyword">import</span> com.atguigu.utils.RabbitMqUtils;<br><span class="hljs-keyword">import</span> com.rabbitmq.client.Channel;<br><br><span class="hljs-keyword">import</span> java.nio.charset.StandardCharsets;<br><span class="hljs-keyword">import</span> java.util.Scanner;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 消息在手动应答时是不丢失, 放回队列中重新消费</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Task2</span> &#123;<br><br>    <span class="hljs-comment">// 队列名称</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TASK_QUEUE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;ack_queue&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> RabbitMqUtils.getChannel();<br><br>        <span class="hljs-comment">// 声明队列</span><br>        channel.queueDeclare(TASK_QUEUE_NAME, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">null</span>);<br><br>        <span class="hljs-comment">// 在控制台中输入信息</span><br>        <span class="hljs-type">Scanner</span> <span class="hljs-variable">scanner</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(System.in);<br>        <span class="hljs-keyword">while</span> (scanner.hasNext()) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> scanner.next();<br>            channel.basicPublish(<span class="hljs-string">&quot;&quot;</span>, TASK_QUEUE_NAME, <span class="hljs-literal">null</span>, message.getBytes(StandardCharsets.UTF_8));<br>            System.out.println(<span class="hljs-string">&quot;生产者发出消息: &quot;</span> + message);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="消息应答消费者"><a href="#消息应答消费者" class="headerlink" title="消息应答消费者"></a>消息应答消费者</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">package</span> com.atguigu.three;<br><br><span class="hljs-keyword">import</span> com.atguigu.utils.RabbitMqUtils;<br><span class="hljs-keyword">import</span> com.atguigu.utils.SleepUtils;<br><span class="hljs-keyword">import</span> com.rabbitmq.client.CancelCallback;<br><span class="hljs-keyword">import</span> com.rabbitmq.client.Channel;<br><span class="hljs-keyword">import</span> com.rabbitmq.client.DeliverCallback;<br><span class="hljs-keyword">import</span> com.rabbitmq.client.Delivery;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 消息在手动应答时是不丢失, 放回队列中重新消费</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> Work03 &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String TASK_QUEUE_NAME = <span class="hljs-string">&quot;ack_queue&quot;</span>;<br><br>    <span class="hljs-comment">// 接收消息</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> main(String[] args) <span class="hljs-keyword">throws</span> Exception &#123;<br>        Channel channel = RabbitMqUtils.getChannel();<br>        System.out.<span class="hljs-keyword">println</span>(<span class="hljs-string">&quot;C1等待接收消息处理时间较短&quot;</span>);<br><br>        DeliverCallback deliverCallback = (consumerTag, message) -&gt; &#123;<br>            <span class="hljs-comment">// 沉睡1S</span><br>            SleepUtils.sleep(<span class="hljs-number">1</span>);<br>            System.out.<span class="hljs-keyword">println</span>(<span class="hljs-string">&quot;接收到的消息&quot;</span> + <span class="hljs-keyword">new</span> String(message.getBody(), <span class="hljs-string">&quot;UTF-8&quot;</span>));<br>            <span class="hljs-comment">// 手动应答</span><br>            <span class="hljs-comment">/**</span><br><span class="hljs-comment">             * 1. 消息的标记tag</span><br><span class="hljs-comment">             * 2. 是否批量应答 false 不批量应答新道中的消息 true 批量</span><br><span class="hljs-comment">             */</span><br>            channel.basicAck(message.getEnvelope().getDeliveryTag(), <span class="hljs-keyword">false</span>);<br><br>        &#125;;<br><br><br>        CancelCallback cancelCallback = consumerTag -&gt; &#123;<br>            System.out.<span class="hljs-keyword">println</span>(<span class="hljs-string">&quot;消费者取消消费接口回调逻辑&quot;</span>);<br>        &#125;;<br><br>        <span class="hljs-comment">// 采用手动应答</span><br>        <span class="hljs-keyword">boolean</span> autoAsk = <span class="hljs-keyword">false</span>;<br>        channel.basicConsume(TASK_QUEUE_NAME, autoAsk, deliverCallback, cancelCallback);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">package</span> com.atguigu.three;<br><br><span class="hljs-keyword">import</span> com.atguigu.utils.RabbitMqUtils;<br><span class="hljs-keyword">import</span> com.atguigu.utils.SleepUtils;<br><span class="hljs-keyword">import</span> com.rabbitmq.client.CancelCallback;<br><span class="hljs-keyword">import</span> com.rabbitmq.client.Channel;<br><span class="hljs-keyword">import</span> com.rabbitmq.client.DeliverCallback;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 消息在手动应答时是不丢失, 放回队列中重新消费</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> Work04 &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String TASK_QUEUE_NAME = <span class="hljs-string">&quot;ack_queue&quot;</span>;<br><br>    <span class="hljs-comment">// 接收消息</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> main(String[] args) <span class="hljs-keyword">throws</span> Exception &#123;<br>        Channel channel = RabbitMqUtils.getChannel();<br>        System.out.<span class="hljs-keyword">println</span>(<span class="hljs-string">&quot;C2等待接收消息处理时间较快&quot;</span>);<br><br>        DeliverCallback deliverCallback = (consumerTag, message) -&gt; &#123;<br>            <span class="hljs-comment">// 沉睡1S</span><br>            SleepUtils.sleep(<span class="hljs-number">30</span>);<br>            System.out.<span class="hljs-keyword">println</span>(<span class="hljs-string">&quot;接收到的消息&quot;</span> + <span class="hljs-keyword">new</span> String(message.getBody(), <span class="hljs-string">&quot;UTF-8&quot;</span>));<br>            <span class="hljs-comment">// 手动应答</span><br>            <span class="hljs-comment">/**</span><br><span class="hljs-comment">             * 1. 消息的标记tag</span><br><span class="hljs-comment">             * 2. 是否批量应答 false 不批量应答新道中的消息 true 批量</span><br><span class="hljs-comment">             */</span><br>            channel.basicAck(message.getEnvelope().getDeliveryTag(), <span class="hljs-keyword">false</span>);<br><br>        &#125;;<br><br><br>        CancelCallback cancelCallback = consumerTag -&gt; &#123;<br>            System.out.<span class="hljs-keyword">println</span>(<span class="hljs-string">&quot;消费者取消消费接口回调逻辑&quot;</span>);<br>        &#125;;<br><br>        <span class="hljs-comment">// 采用手动应答</span><br>        <span class="hljs-keyword">boolean</span> autoAsk = <span class="hljs-keyword">false</span>;<br>        channel.basicConsume(TASK_QUEUE_NAME, autoAsk, deliverCallback, cancelCallback);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs processing"><span class="hljs-keyword">package</span> com.<span class="hljs-property">atguigu</span>.<span class="hljs-property">utils</span>;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 睡眠工具类</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SleepUtils</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sleep</span>(<span class="hljs-type">int</span> <span class="hljs-built_in">second</span>) &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Thread.<span class="hljs-property">sleep</span>(<span class="hljs-number">1000</span> * <span class="hljs-built_in">second</span>);<br>        &#125; <span class="hljs-title function_">catch</span> (InterruptedException e) &#123;<br>            e.<span class="hljs-property">printStackTrace</span>();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>测试结果:<br>work04 运行到一半时, 给挂掉, work03 成功处理 work04 未能处理的消息<br><img src="/assets/209658fbc97d4ade9f25c69ba73d6c04.png"><br><img src="/assets/a377757e38354e578c77a724e9252569.png"><br><img src="/assets/b616453832554fffb7ce2e47174110b0.png"></p><h2 id="队列持久化"><a href="#队列持久化" class="headerlink" title="队列持久化"></a>队列持久化</h2><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">channel.queue<span class="hljs-constructor">Declare(TASK_QUEUE_NAME, <span class="hljs-params">null</span>, <span class="hljs-params">false</span>, <span class="hljs-params">false</span>, <span class="hljs-params">null</span>)</span>;<br><br><span class="hljs-comment">// 声明队列</span><br>boolean durable = <span class="hljs-literal">true</span>;<br>channel.queue<span class="hljs-constructor">Declare(TASK_QUEUE_NAME, <span class="hljs-params">durable</span>, <span class="hljs-params">false</span>, <span class="hljs-params">false</span>, <span class="hljs-params">null</span>)</span>;<br></code></pre></td></tr></table></figure><p>如果队列在未持久化运行过, 把 durable 修改成 true 变成持久化之后就会报如下错误</p><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs oxygene">Caused <span class="hljs-keyword">by</span>: com.rabbitmq.client.ShutdownSignalException: channel error<span class="hljs-punctuation">;</span> protocol <span class="hljs-keyword">method</span>: #<span class="hljs-keyword">method</span>&lt;<span class="hljs-title function_">channel</span>.<span class="hljs-title function_">close</span>&gt;<span class="hljs-params">(reply-code=406, reply-text=PRECONDITION_FAILED - inequivalent arg <span class="hljs-string">&#x27;durable&#x27;</span> <span class="hljs-keyword">for</span> queue <span class="hljs-string">&#x27;ack_queue&#x27;</span> <span class="hljs-keyword">in</span> vhost <span class="hljs-string">&#x27;/&#x27;</span>: received <span class="hljs-string">&#x27;true&#x27;</span> but current <span class="hljs-keyword">is</span> <span class="hljs-string">&#x27;false&#x27;</span>, <span class="hljs-keyword">class</span>-id=50, <span class="hljs-keyword">method</span>-id=10)</span><br></code></pre></td></tr></table></figure><p>我们只需要删除这个队列 , 再次运行就可以了<br><img src="/assets/b75a65a11fcb4b77b28ec349d7f87788.png"></p><p>Features 显示 D 说明持久化成功<br><img src="/assets/d973f909073c488ab0cb67c0a885f8e4.png"></p><h2 id="消息持久化"><a href="#消息持久化" class="headerlink" title="消息持久化"></a>消息持久化</h2><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">channel.basic<span class="hljs-constructor">Publish(<span class="hljs-string">&quot;&quot;</span>, TASK_QUEUE_NAME, <span class="hljs-params">null</span>, <span class="hljs-params">message</span>.<span class="hljs-params">getBytes</span>(StandardCharsets.UTF_8)</span>);<br>channel.basic<span class="hljs-constructor">Publish(<span class="hljs-string">&quot;&quot;</span>, TASK_QUEUE_NAME, MessageProperties.PERSISTENT_TEXT_PLAIN, <span class="hljs-params">message</span>.<span class="hljs-params">getBytes</span>(StandardCharsets.UTF_8)</span>);<br></code></pre></td></tr></table></figure><h2 id="不公平分发"><a href="#不公平分发" class="headerlink" title="不公平分发"></a>不公平分发</h2><p>所有的消费设置</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-comment">// 设置不公平分发</span><br><span class="hljs-built_in">int</span> prefetchCount = <span class="hljs-number">1</span>;<br>channel.basic<span class="hljs-constructor">Qos(<span class="hljs-params">prefetchCount</span>)</span>;<br></code></pre></td></tr></table></figure><h2 id="预取值"><a href="#预取值" class="headerlink" title="预取值"></a>预取值</h2><p>消费者 1 设置</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-comment">// 设置预取值</span><br><span class="hljs-built_in">int</span> prefetchCount = <span class="hljs-number">2</span>;<br>channel.basic<span class="hljs-constructor">Qos(<span class="hljs-params">prefetchCount</span>)</span>;<br></code></pre></td></tr></table></figure><p>消费者 2 设置</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-comment">// 设置预取值</span><br><span class="hljs-built_in">int</span> prefetchCount = <span class="hljs-number">5</span>;<br>channel.basic<span class="hljs-constructor">Qos(<span class="hljs-params">prefetchCount</span>)</span>;<br></code></pre></td></tr></table></figure><h2 id="发布确认"><a href="#发布确认" class="headerlink" title="发布确认"></a>发布确认</h2><p>生产者设置信道</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> 开启发布确认的方法<br>channel.confirmSelect();<br></code></pre></td></tr></table></figure><p>发布确认分三种</p><ul><li>单个确认</li><li>批量确认</li><li>异步批量确认</li></ul><h3 id="单个确认"><a href="#单个确认" class="headerlink" title="单个确认"></a>单个确认</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> <span class="hljs-number">1</span>.单个确认<br><span class="hljs-regexp">//</span> publicMessageIndividually();  <span class="hljs-regexp">//</span> 发布<span class="hljs-number">1000</span>个单独确认消息, 耗时<span class="hljs-number">616</span>ms<br></code></pre></td></tr></table></figure><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-comment">// 1.单个确认</span><br>public static void public<span class="hljs-constructor">MessageIndividually()</span> throws Exception &#123;<br>    Channel channel = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">RabbitMqUtils</span>.</span></span>get<span class="hljs-constructor">Channel()</span>;<br>    <span class="hljs-comment">// 队列的声明</span><br>    String queueName = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">UUID</span>.</span></span>random<span class="hljs-constructor">UUID()</span>.<span class="hljs-keyword">to</span><span class="hljs-constructor">String()</span>;<br>    channel.queue<span class="hljs-constructor">Declare(<span class="hljs-params">queueName</span>, <span class="hljs-params">true</span>, <span class="hljs-params">false</span>, <span class="hljs-params">false</span>, <span class="hljs-params">null</span>)</span>;<br><br>    <span class="hljs-comment">// 开启发布确认</span><br>    channel.confirm<span class="hljs-constructor">Select()</span>;<br><br>    <span class="hljs-comment">// 开始时间</span><br>    long <span class="hljs-keyword">begin</span> = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>current<span class="hljs-constructor">TimeMillis()</span>;<br><br>    <span class="hljs-comment">// 批量发消息</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; MESSAGE_COUNT; i++) &#123;<br>        String message = i + <span class="hljs-string">&quot;&quot;</span>;<br>        channel.basic<span class="hljs-constructor">Publish(<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-params">queueName</span>, <span class="hljs-params">null</span>, <span class="hljs-params">message</span>.<span class="hljs-params">getBytes</span>()</span>);<br><br>        <span class="hljs-comment">// 单个消息就马上进行发布确认</span><br>        boolean flag = channel.wait<span class="hljs-constructor">ForConfirms()</span>;<br>        <span class="hljs-keyword">if</span> (flag) &#123;<br>            <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;消息发送成功&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// 结束时间</span><br>    long <span class="hljs-keyword">end</span> = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>current<span class="hljs-constructor">TimeMillis()</span>;<br>    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;发布&quot;</span> + MESSAGE_COUNT + <span class="hljs-string">&quot;个单独确认消息, 耗时&quot;</span> + (<span class="hljs-keyword">end</span> - <span class="hljs-keyword">begin</span>) + <span class="hljs-string">&quot;ms&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="批量确认"><a href="#批量确认" class="headerlink" title="批量确认"></a>批量确认</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> <span class="hljs-number">2</span>.批量确认<br><span class="hljs-regexp">//</span> publishMessageBatch() ;  <span class="hljs-regexp">//</span> 发布<span class="hljs-number">1000</span>个批量确认消息, 耗时<span class="hljs-number">93</span>ms<br></code></pre></td></tr></table></figure><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-comment">// 2.批量确认</span><br>public static void publish<span class="hljs-constructor">MessageBatch()</span> throws Exception &#123;<br>    Channel channel = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">RabbitMqUtils</span>.</span></span>get<span class="hljs-constructor">Channel()</span>;<br>    String queueName = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">UUID</span>.</span></span>random<span class="hljs-constructor">UUID()</span>.<span class="hljs-keyword">to</span><span class="hljs-constructor">String()</span>;<br>    channel.queue<span class="hljs-constructor">Declare(<span class="hljs-params">queueName</span>, <span class="hljs-params">true</span>, <span class="hljs-params">false</span>, <span class="hljs-params">false</span>, <span class="hljs-params">null</span>)</span>;<br><br>    <span class="hljs-comment">// 开启发布确认</span><br>    channel.confirm<span class="hljs-constructor">Select()</span>;<br><br>    long <span class="hljs-keyword">begin</span> = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>current<span class="hljs-constructor">TimeMillis()</span>;<br><br>    <span class="hljs-built_in">int</span> batchSize = <span class="hljs-number">100</span>;<br><br>    <span class="hljs-comment">// 批量发送消息 批量发布确认</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; MESSAGE_COUNT; i++) &#123;<br>        String message = i + <span class="hljs-string">&quot;&quot;</span>;<br>        channel.basic<span class="hljs-constructor">Publish(<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-params">queueName</span>, <span class="hljs-params">null</span>, <span class="hljs-params">message</span>.<span class="hljs-params">getBytes</span>()</span>);<br>        <span class="hljs-comment">// 判断打到100条消息的时候 批量确认一次</span><br>        <span class="hljs-keyword">if</span> (i % batchSize<span class="hljs-operator"> == </span><span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">// 发布确认</span><br>            channel.wait<span class="hljs-constructor">ForConfirms()</span>;<br>        &#125;<br>    &#125;<br><br>    long <span class="hljs-keyword">end</span> = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>current<span class="hljs-constructor">TimeMillis()</span>;<br>    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;发布&quot;</span> + MESSAGE_COUNT + <span class="hljs-string">&quot;个批量确认消息, 耗时&quot;</span> + (<span class="hljs-keyword">end</span> - <span class="hljs-keyword">begin</span>) + <span class="hljs-string">&quot;ms&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="异步批量确认"><a href="#异步批量确认" class="headerlink" title="异步批量确认"></a>异步批量确认</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> <span class="hljs-number">3</span>.异步批量确认<br>publishMessageAsync();  <span class="hljs-regexp">//</span> 发布<span class="hljs-number">1000</span>个异步批量确认消息, 耗时<span class="hljs-number">47</span>ms<br>                        <span class="hljs-regexp">//</span> 发布<span class="hljs-number">1000</span>个异步批量确认消息, 耗时<span class="hljs-number">62</span>ms<br></code></pre></td></tr></table></figure><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-comment">// 3.异步批量确认</span><br>public static void publish<span class="hljs-constructor">MessageAsync()</span> throws Exception &#123;<br>    Channel channel = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">RabbitMqUtils</span>.</span></span>get<span class="hljs-constructor">Channel()</span>;<br>    String queueName = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">UUID</span>.</span></span>random<span class="hljs-constructor">UUID()</span>.<span class="hljs-keyword">to</span><span class="hljs-constructor">String()</span>;<br>    channel.queue<span class="hljs-constructor">Declare(<span class="hljs-params">queueName</span>, <span class="hljs-params">true</span>, <span class="hljs-params">false</span>, <span class="hljs-params">false</span>, <span class="hljs-params">null</span>)</span>;<br><br>    channel.confirm<span class="hljs-constructor">Select()</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 线程安全有序的一个哈希表 适用于高并发的情况下</span><br><span class="hljs-comment">     *  1.轻松的将序号与消息进行关联</span><br><span class="hljs-comment">     *  2.轻松批量删除条目 只要给到序号</span><br><span class="hljs-comment">     *  3.支持高并发(多线程)</span><br><span class="hljs-comment">     */</span><br>    ConcurrentSkipListMap&lt;Long, String&gt; outstandingConfirms =<br>            <span class="hljs-keyword">new</span> ConcurrentSkipListMap&lt;&gt;<span class="hljs-literal">()</span>;<br><br>    <span class="hljs-comment">// 消息确认成功 回调函数</span><br>    ConfirmCallback ackCallback = (deliveryTag, multiple) -&gt; &#123;<br>        <span class="hljs-keyword">if</span> (multiple) &#123;<br>            <span class="hljs-comment">// 2.删除到已经确认的消息 剩下的就是未确认的消息</span><br>            ConcurrentNavigableMap&lt;Long, String&gt; confirmed =<br>                    outstandingConfirms.head<span class="hljs-constructor">Map(<span class="hljs-params">deliveryTag</span>)</span>;<br>            confirmed.clear<span class="hljs-literal">()</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            outstandingConfirms.remove(deliveryTag);<br>        &#125;<br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;确认的消息: &quot;</span> + deliveryTag);<br>    &#125;;<br>    <span class="hljs-comment">// 消息确认失败 回调函数</span><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 1.消息的标记</span><br><span class="hljs-comment">     * 2.是否为批量确认</span><br><span class="hljs-comment">     */</span><br>    ConfirmCallback nackCallback = (deliveryTag, multiple) -&gt; &#123;<br>        <span class="hljs-comment">// 3.打印一下未确认的消息有哪些</span><br>        String message = outstandingConfirms.get(deliveryTag);<br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;未确认的消息是: &quot;</span> + message + <span class="hljs-string">&quot;, 未确认的消息tag: &quot;</span> + deliveryTag);<br>    &#125;;<br>    <span class="hljs-comment">// 准备消息的监听器 监听哪些消息成功了 哪些消息失败了</span><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 1.监听哪些消息成功了</span><br><span class="hljs-comment">     * 2.监听哪些消息失败了</span><br><span class="hljs-comment">     */</span><br><br>    channel.add<span class="hljs-constructor">ConfirmListener(<span class="hljs-params">ackCallback</span>, <span class="hljs-params">nackCallback</span>)</span>;  <span class="hljs-comment">// 异步通知</span><br><br>    long <span class="hljs-keyword">begin</span> = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>current<span class="hljs-constructor">TimeMillis()</span>;<br><br>    <span class="hljs-comment">// 批量发送消息</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; MESSAGE_COUNT; i++) &#123;<br>        String message = <span class="hljs-string">&quot;消息&quot;</span> + i;<br>        channel.basic<span class="hljs-constructor">Publish(<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-params">queueName</span>, <span class="hljs-params">null</span>, <span class="hljs-params">message</span>.<span class="hljs-params">getBytes</span>()</span>);<br>        <span class="hljs-comment">// 1.此处记录下所有要发送的消息 消息的总和</span><br>        outstandingConfirms.put(channel.get<span class="hljs-constructor">NextPublishSeqNo()</span>, message);<br>    &#125;<br><br>    long <span class="hljs-keyword">end</span> = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>current<span class="hljs-constructor">TimeMillis()</span>;<br>    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;发布&quot;</span> + MESSAGE_COUNT + <span class="hljs-string">&quot;个异步批量确认消息, 耗时&quot;</span> + (<span class="hljs-keyword">end</span> - <span class="hljs-keyword">begin</span>) + <span class="hljs-string">&quot;ms&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>单独发布消息:<br>同步等待确认，简单，但吞吐量非常有限。<br>批量发布消息:<br>批量同步等待确认，简单，合理的吞吐量，一旦出现问题但很难推断出是那条消息出现了问题。<br>异步处理：<br>最佳性能和资源使用，在出现错误的情况下可以很好地控制，但是实现起来稍微难些</p><h2 id="交换机"><a href="#交换机" class="headerlink" title="交换机"></a>交换机</h2><p>简单模式 工作模式<br><img src="/assets/e1c9d8b94cab463c8b356011e5ffe491.png"><br>发布, 订阅模式<br><img src="/assets/4dc407f52a2345cc9e01cca0cfa13594.png"></p><h2 id="绑定"><a href="#绑定" class="headerlink" title="绑定"></a>绑定</h2><p>创建一个队列<br><img src="/assets/841d8aa23c5c46679654df8474353d05.png"><br>创建一个交换机<br><img src="/assets/f8def80264a04d648402cd36e0068221.png"><br>让交换机和队列进行绑定<br><img src="/assets/6d1cfe2758b84aa6ac1dd5ad9d2b4179.png"></p><h3 id="fanout-交换机"><a href="#fanout-交换机" class="headerlink" title="fanout 交换机"></a>fanout 交换机</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.five;<br><br><span class="hljs-keyword">import</span> com.atguigu.utils.RabbitMqUtils;<br><span class="hljs-keyword">import</span> com.rabbitmq.client.CancelCallback;<br><span class="hljs-keyword">import</span> com.rabbitmq.client.Channel;<br><span class="hljs-keyword">import</span> com.rabbitmq.client.DeliverCallback;<br><span class="hljs-keyword">import</span> com.rabbitmq.client.Delivery;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 接收消息</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReceiveLogs01</span> &#123;<br>    <span class="hljs-comment">// 交换机的名称</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">EXCHANGE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;logs&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> RabbitMqUtils.getChannel();<br>        <span class="hljs-comment">// 声明一个交换机</span><br>        channel.exchangeDeclare(EXCHANGE_NAME, <span class="hljs-string">&quot;fanout&quot;</span>);<br><br>        <span class="hljs-comment">// 声明一个队列 临时队列</span><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * 生成一个临时队列 , 队列的名称是随机的</span><br><span class="hljs-comment">         * 当消费者断开与队列的连接的时候 队列就会自动删除</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">queueName</span> <span class="hljs-operator">=</span> channel.queueDeclare().getQueue();<br><br>        <span class="hljs-comment">// 绑定交换机与队列</span><br>        channel.queueBind(queueName, EXCHANGE_NAME, <span class="hljs-string">&quot;&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;等待接收消息, 把接收到消息打印到屏幕上...&quot;</span>);<br><br>        <span class="hljs-comment">// 接收消息 回调接口</span><br>        <span class="hljs-type">DeliverCallback</span> <span class="hljs-variable">deliverCallback</span> <span class="hljs-operator">=</span> (consumerTag, message) -&gt; &#123;<br>            System.out.println(<span class="hljs-string">&quot;ReceiveLogs01控制台打印接收到的消息: &quot;</span> + <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(message.getBody(), <span class="hljs-string">&quot;UTF-8&quot;</span>));<br>        &#125;;<br><br>        <span class="hljs-comment">// 消费者取消消息时回调接口</span><br>        <span class="hljs-type">CancelCallback</span> <span class="hljs-variable">cancelCallback</span> <span class="hljs-operator">=</span> (consumerTag) -&gt; &#123;<br><br>        &#125;;<br><br>        channel.basicConsume(queueName, <span class="hljs-literal">true</span>, deliverCallback, cancelCallback);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.five;<br><br><span class="hljs-keyword">import</span> com.atguigu.utils.RabbitMqUtils;<br><span class="hljs-keyword">import</span> com.rabbitmq.client.CancelCallback;<br><span class="hljs-keyword">import</span> com.rabbitmq.client.Channel;<br><span class="hljs-keyword">import</span> com.rabbitmq.client.DeliverCallback;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 接收消息</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReceiveLogs02</span> &#123;<br>    <span class="hljs-comment">// 交换机的名称</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">EXCHANGE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;logs&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> RabbitMqUtils.getChannel();<br>        <span class="hljs-comment">// 声明一个交换机</span><br>        channel.exchangeDeclare(EXCHANGE_NAME, <span class="hljs-string">&quot;fanout&quot;</span>);<br><br>        <span class="hljs-comment">// 声明一个队列 临时队列</span><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * 生成一个临时队列 , 队列的名称是随机的</span><br><span class="hljs-comment">         * 当消费者断开与队列的连接的时候 队列就会自动删除</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">queueName</span> <span class="hljs-operator">=</span> channel.queueDeclare().getQueue();<br><br>        <span class="hljs-comment">// 绑定交换机与队列</span><br>        channel.queueBind(queueName, EXCHANGE_NAME, <span class="hljs-string">&quot;&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;等待接收消息, 把接收到消息打印到屏幕上...&quot;</span>);<br><br>        <span class="hljs-comment">// 接收消息 回调接口</span><br>        <span class="hljs-type">DeliverCallback</span> <span class="hljs-variable">deliverCallback</span> <span class="hljs-operator">=</span> (consumerTag, message) -&gt; &#123;<br>            System.out.println(<span class="hljs-string">&quot;ReceiveLogs02控制台打印接收到的消息: &quot;</span> + <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(message.getBody(), <span class="hljs-string">&quot;UTF-8&quot;</span>));<br>        &#125;;<br><br>        <span class="hljs-comment">// 消费者取消消息时回调接口</span><br>        <span class="hljs-type">CancelCallback</span> <span class="hljs-variable">cancelCallback</span> <span class="hljs-operator">=</span> (consumerTag) -&gt; &#123;<br><br>        &#125;;<br><br>        channel.basicConsume(queueName, <span class="hljs-literal">true</span>, deliverCallback, cancelCallback);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.five;<br><br><span class="hljs-keyword">import</span> com.atguigu.utils.RabbitMqUtils;<br><span class="hljs-keyword">import</span> com.rabbitmq.client.Channel;<br><br><span class="hljs-keyword">import</span> java.util.Scanner;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 发消息 交换机</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EmitLog</span> &#123;<br>    <span class="hljs-comment">// 交换机的名称</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">EXCHANGE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;logs&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> RabbitMqUtils.getChannel();<br>        channel.exchangeDeclare(EXCHANGE_NAME, <span class="hljs-string">&quot;fanout&quot;</span>);<br><br>        <span class="hljs-type">Scanner</span> <span class="hljs-variable">scanner</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(System.in);<br>        <span class="hljs-keyword">while</span> (scanner.hasNext()) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> scanner.next();<br>            channel.basicPublish(EXCHANGE_NAME, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-literal">null</span>, message.getBytes(<span class="hljs-string">&quot;UTF-8&quot;</span>));<br>            System.out.println(<span class="hljs-string">&quot;生产者发出消息: &quot;</span> + message);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>运行效果如下 : 通过交换机实现每个队列都能接收到消息<br><img src="/assets/f190ef17a406413cb8bdcd6ab0e894f1.png"></p><h2 id="direct-交换机"><a href="#direct-交换机" class="headerlink" title="direct 交换机"></a>direct 交换机</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DirectLogs</span> &#123;<br>    <span class="hljs-comment">// 交换机的名称</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">EXCHANGE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;direct_logs&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> RabbitMqUtils.getChannel();<br><br>        <span class="hljs-type">Scanner</span> <span class="hljs-variable">scanner</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(System.in);<br>        <span class="hljs-keyword">while</span> (scanner.hasNext()) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> scanner.next();<br>            channel.basicPublish(EXCHANGE_NAME, <span class="hljs-string">&quot;warning&quot;</span>, <span class="hljs-literal">null</span>, message.getBytes(<span class="hljs-string">&quot;UTF-8&quot;</span>));<br>            System.out.println(<span class="hljs-string">&quot;生产者发出消息: &quot;</span> + message);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>交换机发送的 routerKey 是 warning, 那么只有对应的消费者是 warning 才会接收到发送来的消息</p><h2 id="Topics-交换机"><a href="#Topics-交换机" class="headerlink" title="Topics 交换机"></a>Topics 交换机</h2><p>发送 topic 交换机的消息的 routerKey 必须是以<strong>点号</strong>分隔开<br>_(星号)可以代替一个单词<br>#(井号)可以代替零个或多个单词<br><img src="/assets/9c0e8bcf3d75486f975d13f389ba4580.png"><br>C1 有一个 RouterKey, <em>.orange.</em><br>C2 有两个个 RouterKey, _.*rabbit lazy.#</p><p>quick.orange.rabbit 匹配 Q1 Q2<br>lazy.orange.elephant 匹配 Q1 Q2<br>quick.orange.fox 匹配 Q1<br>lazy.brown.fox 匹配 Q2<br>lazy.pink.rabbit 匹配 Q2<br>quick.brown.fox 匹配不到<br>quick.orange.male.rabbit 匹配不到<br>lazy.orange.male.rabbit 匹配 Q2</p><h2 id="死信队列"><a href="#死信队列" class="headerlink" title="死信队列"></a>死信队列</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 声明普通队列</span><br>        <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt; <span class="hljs-variable language_">arguments</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        <span class="hljs-comment">// 过期时间 10s = 10000ms</span><br><span class="hljs-comment">//        arguments.put(&quot;x-message-ttl&quot;, 10000);</span><br>        <span class="hljs-comment">// 正常队列设置死信交换机</span><br>        <span class="hljs-variable language_">arguments</span>.<span class="hljs-title function_">put</span>(<span class="hljs-string">&quot;x-dead-letter-exchange&quot;</span>, <span class="hljs-variable constant_">DEAD_EXCHANGE</span>);<br>        <span class="hljs-comment">// 设置死信RoutingKey</span><br>        <span class="hljs-variable language_">arguments</span>.<span class="hljs-title function_">put</span>(<span class="hljs-string">&quot;x-dead-letter-routing-key&quot;</span>, <span class="hljs-string">&quot;lisi&quot;</span>);<br><br>        channel.<span class="hljs-title function_">queueDeclare</span>(<span class="hljs-variable constant_">NORMAL_QUEUE</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-variable language_">arguments</span>);<br></code></pre></td></tr></table></figure><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">    DeliverCallback deliverCallback = (consumerTag, message) -&gt; &#123;<br>        String msg = <span class="hljs-keyword">new</span> <span class="hljs-constructor">String(<span class="hljs-params">message</span>.<span class="hljs-params">getBody</span>()</span>, <span class="hljs-string">&quot;UTF-8&quot;</span>);<br>        <span class="hljs-keyword">if</span> (msg.equals(<span class="hljs-string">&quot;info5&quot;</span>)) &#123;<br>            <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;Consumer01接收到的消息: &quot;</span> + msg + <span class="hljs-string">&quot;: 此消息是被C1拒绝的&quot;</span>);<br>            channel.basic<span class="hljs-constructor">Reject(<span class="hljs-params">message</span>.<span class="hljs-params">getEnvelope</span>()</span>.get<span class="hljs-constructor">DeliveryTag()</span>, <span class="hljs-literal">false</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;Consumer01接收到的消息: &quot;</span> + msg);<br>            channel.basic<span class="hljs-constructor">Ack(<span class="hljs-params">message</span>.<span class="hljs-params">getEnvelope</span>()</span>.get<span class="hljs-constructor">DeliveryTag()</span>, <span class="hljs-literal">false</span>);<br>        &#125;<br>    &#125;;<br><br>    CancelCallback cancelCallback = (consumer) -&gt; &#123;<br><br>    &#125;;<br><br>    <span class="hljs-comment">// 开启手动应答</span><br>    channel.basic<span class="hljs-constructor">Consume(NORMAL_QUEUE, <span class="hljs-params">false</span>, <span class="hljs-params">deliverCallback</span>, <span class="hljs-params">cancelCallback</span>)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/assets/5ca25cddd5f94a74966e4f553d0a954d.png"><br>当发送的消息处于 消息被拒绝, 消息的 TTL 过期, 队列打到最大长度 三种情况的一种, 就会发生死信<br>C1 拒收消息, 将由配置好的死信 C2 来接收处理消息</p><h2 id="延迟队列"><a href="#延迟队列" class="headerlink" title="延迟队列"></a>延迟队列</h2>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>MQ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo切换主题以及主题的美化</title>
    <link href="/hexo/Hexo%E5%88%87%E6%8D%A2%E4%B8%BB%E9%A2%98%E4%BB%A5%E5%8F%8A%E4%B8%BB%E9%A2%98%E7%9A%84%E7%BE%8E%E5%8C%96/"/>
    <url>/hexo/Hexo%E5%88%87%E6%8D%A2%E4%B8%BB%E9%A2%98%E4%BB%A5%E5%8F%8A%E4%B8%BB%E9%A2%98%E7%9A%84%E7%BE%8E%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<h2 id="下载一个喜欢的主题"><a href="#下载一个喜欢的主题" class="headerlink" title="下载一个喜欢的主题"></a>下载一个喜欢的主题</h2><p>下载一个主题到 themes&#x2F;yilia</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">E:\Code\Blog\hexo-blog&gt;git <span class="hljs-built_in">clone</span> git@github.com:litten/hexo-theme-yilia.git themes/yilia<br></code></pre></td></tr></table></figure><h2 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h2><p>将 theme 的参数修改成 yilia, 然后报错</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs clean"># Extensions<br>## Plugins: https:<span class="hljs-comment">//hexo.io/plugins/</span><br>## Themes: https:<span class="hljs-comment">//hexo.io/themes/</span><br>theme: yilia<br></code></pre></td></tr></table></figure><h2 id="重新启动"><a href="#重新启动" class="headerlink" title="重新启动"></a>重新启动</h2><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs excel"><span class="hljs-symbol">E:</span>\Code\B<span class="hljs-built_in">log</span>\hexo-blog&gt;hexo <span class="hljs-built_in">clean</span><br><br><span class="hljs-symbol">E:</span>\Code\B<span class="hljs-built_in">log</span>\hexo-blog&gt;hexo generate<br><br><span class="hljs-symbol">E:</span>\Code\B<span class="hljs-built_in">log</span>\hexo-blog&gt;hexo server<br><br><span class="hljs-symbol">E:</span>\Code\B<span class="hljs-built_in">log</span>\hexo-blog&gt;hexo deploy<br></code></pre></td></tr></table></figure><p>修改了主题不会立马生效, 我们可以喝杯茶, 抽根烟耐心等待下</p><p>另外推荐的主题:<br>quiet<br>doc: <a href="https://github.com/79E/hexo-theme-quiet">https://github.com/79E/hexo-theme-quiet</a><br>fluid<br>demo: <a href="https://hexo.fluid-dev.com/">https://hexo.fluid-dev.com/</a><br>doc: <a href="https://hexo.fluid-dev.com/docs/start/">https://hexo.fluid-dev.com/docs/start/</a><br>easyhexo<br>demo: <a href="https://easyhexo.com/">https://easyhexo.com/</a></p><h2 id="更换网站的-title"><a href="#更换网站的-title" class="headerlink" title="更换网站的 title"></a>更换网站的 title</h2><p>在_config.yaml 直接修改 title 的值</p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs vbnet"># Site<br><span class="hljs-symbol">title:</span> xiamu<br><span class="hljs-symbol">subtitle:</span> <span class="hljs-comment">&#x27;&#x27;</span><br><span class="hljs-symbol">description:</span> <span class="hljs-comment">&#x27;&#x27;</span><br><span class="hljs-symbol">keywords:</span><br><span class="hljs-symbol">author:</span> 肉豆蔻吖<br><span class="hljs-symbol">language:</span> zh-CN<br><span class="hljs-symbol">timezone:</span> <span class="hljs-comment">&#x27;&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="更换网站的-favicon-ico"><a href="#更换网站的-favicon-ico" class="headerlink" title="更换网站的 favicon.ico"></a>更换网站的 favicon.ico</h2><p>在这个网站中找的一个 emoji 表情包做的 favicon.ico<br><a href="https://www.flaticon.com/">https://www.flaticon.com/</a><br><img src="/assets/a9f52c4c235044309ee577750e6f04de.png"><br>把图片下载下来到 themes&#x2F;fluid&#x2F;source&#x2F;img<br>在_config.fluid.yaml 中引入下载好的图片</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># 用于浏览器标签的图标</span><br><span class="hljs-comment"># Icon for browser tab</span><br>favicon: <span class="hljs-regexp">/img/</span>smile.png<br><span class="hljs-comment"># /img/fluid.png</span><br></code></pre></td></tr></table></figure><h2 id="引入自定义的-CSS"><a href="#引入自定义的-CSS" class="headerlink" title="引入自定义的 CSS"></a>引入自定义的 CSS</h2><p>当前选中文本的颜色是浏览器默认自带的蓝色的<br><img src="/assets/57ae8c660c4e4ab8bd9ba4f23d994814.png"><br>在 themes&#x2F;fluid&#x2F;source&#x2F;css&#x2F;创建 custom.css, 填写如下 css 代码</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-pseudo">::selection</span> &#123;<br>    <span class="hljs-attribute">color</span>: unset;<br>    <span class="hljs-attribute">padding</span>: <span class="hljs-number">0px</span>;<br>    <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgb</span>(<span class="hljs-number">209</span>, <span class="hljs-number">234</span>, <span class="hljs-number">254</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>_config&#x2F;fluid.yaml 引入 custom.css 的路径</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># 指定自定义 .css 文件路径，用法和 custom_js 相同</span><br><span class="hljs-comment"># The usage is the same as custom_js</span><br>custom_css: <span class="hljs-regexp">/css/</span>custom.css<br></code></pre></td></tr></table></figure><p>保存预览, 文本选中的样式就发生了变化<br><img src="/assets/55607bcd7bed401aaf0a6e8ef709b494.png"></p><h2 id="url-的设置"><a href="#url-的设置" class="headerlink" title="url 的设置"></a>url 的设置</h2><p>doc: <a href="https://hexo.io/docs/configuration.html">https://hexo.io/docs/configuration.html</a></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># URL</span><br><span class="hljs-comment">## Set your site url here. For example, if you use GitHub Page, set url as &#x27;https://username.github.io/project&#x27;</span><br>url: http:<span class="hljs-regexp">//</span>roudoukou.github.io<br>permalink: :category<span class="hljs-regexp">/:name/</span><br></code></pre></td></tr></table></figure><h2 id="添加樱花落下效果"><a href="#添加樱花落下效果" class="headerlink" title="添加樱花落下效果"></a>添加樱花落下效果</h2><p>在 themes&#x2F;source&#x2F;js&#x2F;中创建 sakura.js, 添加如下 js 代码</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><code class="hljs json">var stop<span class="hljs-punctuation">,</span> staticx;<br>var img = new Image();<br>img.src = <span class="hljs-string">&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAUgAAAEwCAYAAADVZeifAAAACXBIWXMAAACYAAAAmAGiyIKYAAAHG2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXBSaWdodHM9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9yaWdodHMvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtcFJpZ2h0czpNYXJrZWQ9IkZhbHNlIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6NDFDMjQxQjYyNjIwNjgxMTgwODNEMjE2MDAzOTU1NDQiIHhtcE1NOkRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDozNDVjOWViOC04NDc4LTFkNDctOGRjMi0yZDkyOGNhYTYxZWQiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6YjAzN2ZiMGItNTU5Mi0xYjRkLWJjZGQtOWU4NGExMDJiMGM2IiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAoV2luZG93cykiIHhtcDpDcmVhdGVEYXRlPSIyMDE4LTA1LTA5VDE0OjQ5OjM3KzA4OjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAxOC0wNS0wOVQxNDo1MToyNSswODowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAxOC0wNS0wOVQxNDo1MToyNSswODowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjEyMjVlZWE3LTEyY2QtMTY0NC04ZDAzLWFjOTE2ZTAxZDQ1YyIgc3RSZWY6ZG9jdW1lbnRJRD0idXVpZDoxRDIwNUFGNjZCRDlFNTExOUM5REMwMzg2RjlEQjFGNyIvPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDphYmMzNjIzMy1hOWNkLWNiNDQtODViYi0zZTgyMjEwYmIxMjYiIHN0RXZ0OndoZW49IjIwMTgtMDUtMDlUMTQ6NTE6MjUrMDg6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE4IChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6YjAzN2ZiMGItNTU5Mi0xYjRkLWJjZGQtOWU4NGExMDJiMGM2IiBzdEV2dDp3aGVuPSIyMDE4LTA1LTA5VDE0OjUxOjI1KzA4OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOCAoV2luZG93cykiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+XCpBoAAApBxJREFUeNrs/cmSI8u2LIipLnMHosnc59Z7jyxhjSg1oggn/EWO+SP8B34JhRyWCItk1at7786MBnBbWoNlZm4OOLrIvc8+t45bCjIQjibQuKuvTlUpCdva1ra2ta3zZdtHsK1tbWtbG0Bua1vb2tYGkNva1ra2tQHktra1rW1tALmtbW1rWxtAbmtb29rWBpDb2ta2trUB5La2ta1tbQC5rW1ta1sbQG5rW9va1gaQ29rWtra1AeS2trWtbW1rA8htbWtb29oAclvb2ta2NoDc1ra2ta0NILe1rW1tawPIbW1rW9vaAHJb29rWtjaA3Na2trWtDSC3ta1tbWsDyG1ta1vb2gByW9va1rY2gNzWtra1rW1tALmtbW1rWxtAbmtb29rWBpDb2ta2trUB5La2ta1tbQC5rW1ta1sbQG5rW9va1gaQ29rWtra1AeS2trWtbW0Aua1tbWtbG0Bua1vb2tY/3xr+o7+Bf/2//z/+1OfPAIgJErGbMj7M8fue+O1A7LLjcxyw+5hwZMbgQnLgKIftRsgMyYUjBYNhOn6AADiMOGDCyIQBCflwwNEdw24HHA5AzhjHJxyQwZTADLgmHJPhDRnfjo6PlPHbNOJDGZgEZsIgOAHPR/yPwxv+28MONOBghIEAiXce8LkzuAG/vRP7o+EzAcMRyNlxoJByxj4T/8su4+UgPE3A++jg5yfe/lvD73/b4eVfM17/zfE//y3h6UjsJ8f/9N8m/Of/Cnz/d0cegHES/t///Q7HHfG/+/8JT0fABGQTzIEkYMyGf/0vBh8N3/99wv/rP/1/sDs6/i//+t8DZhCATOFwzPj4/R3/MhkOmPBz/47dB+CY8LZ/w/NnQh4cu88dppSRU4abQwbQCRPhdDx/PCGbI9f7JLXbRfHpYw+n4MOkPAAUSacBmfv30f/rf+f+8m+GpyPw8Zrhl0IMAmK5KgAOWCY4Ib6r8pO+/hiV/5c/LyyVe6g8TnH5P/3f/q8bwv2zA+TfZ7HtvKbY4ScCOxCU4EaYE04hxb0hOYgEATAJTsGYkP2IQQBocAkkAGMBQcdgA47HA3aMg0cQkhmOGRhEZAMoIpdDhiREQYzXJQBDSQwygFGLdwET2/3c2luLx9fXzjhKk4hs8QTmsd2OAiHkIR4wZmFKxNMRGI7C5xPxt3+Lv+0GvL47/r/fBgBCJpAcYPwVAICbsPsE/v0VSJl49if8+/C/IEMwCIQBcCQLUBeBlOOFi4K5wanyGcgAiPEe5XSApInJsllCQkAVQNFStpTcUjoakxtNZqJIwtIx2XigpUyaG2xSdvPj9/+aPy3zoORuorKVD7OCoZfLxAUgMhegrEBYf1p8x2pYdxUKITVEXIBhewFit21bG0D+HWoQDgJwiERSAF622CFNgpsh5YypHPck4S7YEEcjQQhAsoRj/ixARHiBOVpAhsthNkCKPZwCvNvTB1Ugi7/dnpunr9mQYJjoGGWLOooVUAcDbAWV6CleN9sxJwzOeE/lczgakQ4OkzCNhBuwOwo/n+M+u4Pwsbd4dQLciJefwvR/CLDsgyWVP+SMxx0HgSCe8h7/037CwY7YY1cPeyQzwAxe3j9FeBKSwOf3p7Q7cuQ7d0oYCbPkifvDnqaULNvOhAE0c7p2ACEbTBwIjhCMYIJhAJggWICsMuQTnEdCB7m/7f6rv2XLb2781ITP6bdpSgcrgNhFhTqJChnv9eGosILijKAnCIvlxQsQbwC5AeTfM4IkACdhHtHUlBTxjYSjEYMATxHGEQyQK5GFlZ3daOWsLxgjyiphYAMVJIv9XsIC9xgHg4HIDFBzUxyM5QCUShxBYifDwYSXErlkCkmEkaAcEDFRERUKmCxA0ARMiIN5EHBIcT2JkapPgmVhShHRjZOQU5xExqPw43uNQCOqffp0iEAegDShe9Nz4DUcK6Aa9nmACLylT+ynXYlwC4CbYWLGHoTJzFxj8rTfH8ZnE14pfqP4Ctke0EBoEG0gMJLcK3J2Lx9XIrFz2kjBIhSvpx9NgI6QPgR/B/Qu6YNIo8kHTpYcU0IWcRw+NJ9HIoAjIAroTja/FhWeRIblUoGQHShSZV9J3A7bDSD/jil2xHQgiOTCNJRoToISW9rYsi2tnMZZ7ieHwSINhSJyYyBc7N8J7hmkAS7IAhgFYRRxNGFww2SOEQm5/e2IVZ3AToY3HiEMEfGWtJkIQGRJgfsIEuU1wAzKGUmEM0oHgwMYo3aWJuG4B3IidlNJlQnYFJ/JNMxvfXcUxqNw2AHjJxalgPbpuDAchePOsJsGJAz4Mb7jPx2/zyUAAPsUibbD0+v77nlwvEJ4pfEbHN9o9h20AEnoWcQe5FgvRrIU6wSjCRzNbIRAQBmug9wPcv+A9A66RR4vp7vk7hIyQTc3pckwCjo+C26atIj3r4PhalSIdSBswFeAsAEiojyjRGAgfGQ5LRBRTdjWBpB/F2ic910i9r1oHnQ1vpoml9splFSZ7XkC/AxZ7V5wCAMY4ZviEDMLgByGVEDTYSQkxyji04BnByY49khz8bBEgBkBkP9ucSBaV9+K9DRenxuQLeqC9TnqfZ3AWHJit7IBBmYgHQU8AXkE+AGYRxS5c4AufO6Ap/d4CB14+hA+98Tr74LXskWLeuNV7Y7A5154+knsfI8fw0d/WjIAw+uwG7lLT7T8QscLhb8B/AbxVcI30r6J/E7yReArpReSexhHGEeAVivEIBNrBUWYIP/UlN/o/i53wN3hzHBM5UWCJheY4cwwy0lJOEKi++dTdqUOIS80TuZwv1z3C1FhD4g1KjQ0AFyAoZWovfyhRYq/rQ0g/z4gyZq/IpXTfyYxOqJpYRGZycqODUDuYBoiNS6NmkSDKyOVWqXkAIeIIl1wd1hKyIdPjGNt1EQEeSwR5E8DkgyfzC2lriktSp1y5ylSWyqaQl2xoDaacgHI9h47gFRJ+02R0gNAAiEwABJAHuMPDpOQzcBJSBn4fDK8/MzwFK/l5V34t78ZYHMzCTWYKwXO3Qfw/h349jux0w7/y+7f4HASHEzpaWB64WivML0y41mO7yC+B0DiheR3AN9p9h3CK4QXCi8AX5H4DHJHlWoHlAMUNcl1gPs7MsiELKNzQgaZReS4rwQgR9GYmcQEV3bQkTnZu3Y05fyEI7y8rXujQs2NHdQSiUWKrH0PhoASAwgLxrfnyIiGliKjadu3tQHk32upprGtURN1O2SWRg1hU9QFkUsTptQRo/tNTCU6nKYJYzl8MoQdAJiBk8PlGC1hUmnBqEal0egZakMFbMEHu2OwrgSDIeqMQ9c3NtROdjwyW3SAWdPs2jcuzzeUjj0AmBMTiXSIDnNOhEod8rADcIiGy/ue+M/lL7oRr2+O//9/SS3qHnwZmTuF/Yfwb/9ZSJ7sv3x8p/yZlnZ7s+HVYP9C2t8A+4aBz3A8EfwO4G8k/ybhO8hvAL4B/BvEVwLfALwAeIH4VEJ2h3SE6x3SO+QfpFPQEbIRwo6uSWY7yI9AGgmMyvkIcgA50JjgHEEOFAY6Bk5INJl2BubrjRMuosI5Rdae0EmKXKcJILXHm6sBKaVF/RGurUGzAeRfC5Nexm/MgamOwCgiqADN2qgpoz4EvKS50ahJLXIKkPNlJ7uApTpYLt2Z+LvluKpZcWaN8ro8vkSVgwxHCs9eRnvK7cYAdbQ6ZAC+swSjJYIUHENJ6VVGdI5G2NEjrR5YGjXA23O82vEg/PitSzMNeH4XpgRMI8AM7HNL4xlRnWhZ9t/9D3gaNDz/H//tvzxZGp990Ctov8HSfwbtPwH2G42vAJ8B/Bbb8DfIvpN4AfgC4hniC4AR4gBglJQgOOSfdP0EPcN9kvMIMtFsiHOBEpgGAiZnYsTAiZCJTIASYANMBnmCmQmeIA12QMInjWU0oQGXz40zJEI7LFPkRMhWokKP/SoATw1UI9LUIgI9LQWBceLa1gaQf5dlAHKNwkr9Owk4lu4t5ZBx0XwgCLjXqnzbgdkQyBsaqTRqWhWfAZju5a/WbYzu+ABiStGVzgwQy2T721agdSfDkRkx+CNMc5INenRUss3znZlzJ9tLFJmc8DKuZCIwGGzKSEchjwZPMf9Yu7fjUTiOpVFTXs/uIPvb756ePmT7AwgyARgH8WV0vg6y1+T2Yjb8liz9N0rDd5l9S7TfSuT4n0H7TzT7DeQLYDsAz2B6BflMYF/qi0NpeZeOdE1bBbgTriTCYJYAGKUksv6eKCVQJiiRGkQNoCUQA+GDkBLgAwYlMg0gkkEDMAwpY0xHHc2RwZPGyVh+TwgwPI0Kc9lHSorMRdSpeZi8gqHmUiYsTlK5wLkb4WkDyA0g/6JKpJMYSif7EzO4tC5wqQVaS7GWjRqQIC1mHjG0TraBoAWo9o0aszEaNXUApetk77Ih07HDUEqkpQ1T7r9TwrtN8KlEjCxRbN+oKSMp9HJQ1eiSbI0aMUoHqZQOWDrZ2gF5IMZPlXonbJxg338XRRikJHBH4uX//P/ML0jpGbRXks8mfjOkvxntO5L9zWz4jTb8N0zpPyGlb6Q9C/YK8jst/Q3kd4A7gClCdMb+a8b5xNNNcdaB+DZuVUYFDAMcCcYBsARggDSUKsYAVyIxKvuRRESgwAhwonGQ5QGZOwAThR2TJhsxjsDgUx4+/xs7+rNpngo4AcNpJSos6fHNqLAAbE4xUuY2/+zvvKXZG0D+5SuVs/rMDomzd40ya51IcsASpEIFhJCY4HKk0qxwCKmM4sEFV4z6ZJ+Q0q7UIR1GQ9aEQYZPAs9u+BimBYbXCHIisHNDLiwTw3mjxrpO9pBxdlT27JpMRK1UMaRtk0MJOOwN40e2//SveXg62n50e/6XH3pS4p4Yni3ba5L9C2m/Uek3Mr0AfKHZNzL9C8jfMNg32PAd5DeZ/UZL30R7htmOiXvQ9rUBTVr5cNkiqPa61b3D2qwGoUhLCXII0NOoqCPumHiUcwQ0wG1E0g7EBGCMuiMGug2QBrmPzDiIHAAMoAYyJQMSpGEEh4MVNmUuJZK+cdJHhX2N8hQMLU5W2UpU2IGhuomFuRYJMKul3zWT2dYGkH/n+LFSDlm6hsJkjPGW0pCwfEo5VJthrBGb0TB5xoCumUMAaaYcjmnAYTqU7nZEmQMNDmAsqbFhnXJYj46xDMNlRM0UXce6drLFZSe7giJKpgpUiuPcyXYDhk/x+aenl5++e/7g0+j2bEzfEu03o73S+ULwBbDvNPsbLf2NKX2D2Uu5vIL2HcbfmIZvMPuGZM8wvsDsqTRFDMlIszLmwnlWc65ZtGHyGh/DS4W2lTe8zICnAe4DrKTMZgniyKwjqAGmJNcAq80YT8hIck9wGSkTUjIyRVVYKSJaJINScqTxmBNM2bwUiqUrUWFEhEolRbY5TZZhmSarn4EszRmfh9G9AGpO1kB1WxtA/l0B0k872Q5MKcI18wDI4QhMiWXULiiHaEPlbNxqz3OjRpVewplyyDQuKIf9wWU6jfQ0N2G610sQA6JRM2ruZLNUJU872T3l0MrQuiNqnUcDMsRxorl24/P/7Pv//f/ozyBeYOnV0vDNLP1Gpt9g9g3kE2ivMH6Dpd8wDL8hpW80vsLsGcZXpHJfS68kn2C2gzHBzFCH560Dxu4zmqPIOts0b2ojRLWhYdZ6IDGFj1ZzFDxF+J4S5ImUyd1gTCUFTyQTzJMcieSAXMBRiQGSyaCo/KWjp0xnPVedNk6WtcIZDE+jwqhNFhAsoFgJNW6lLpwMuYIp59Es1Kh1WxtA/r1hMvrOAZCpKNO0up/ZYgh6QTnEspONQuhgNyvMtoPPB39POWx8aUUkN1mkzo16eEI5FImxNGqoITrPIeew6GT3jZqpNmoATCUqHR1042hmuwTuTXjmgO9M9s2Mr6R9o9k3DMN3JPtOS99APsPSC82+I9lvGNJvsPQdZi+MKDHqkSk9wzjAaCyt/Dpu1MqK5Gl42803laICT0QjyvuPOcHCdnJHNGAsmjXuibJSK1WCEF1rIkE00VNoXdAgJgJJ8ZEnSoOSBiolSQNTSiYNhog+RUxrjZOzFPk0KtQ8XF6jQt+xpNlzvVGljlxPoOYqDR6169vaAPLvn2KjU7tx4DCUtFkq2++jHAIGyWFIFyiHgplFo4ZWGjVapxxS2LcBoNJDL42avQw/LEMeZYHcQX0cUGyNGpsbNZRcTjBDu72npxeMLzbaa4omyyuZvtHsN5KvoL0i2SstfUeyfynp8zONLyC/YUi/IdlvTOkVtBeQe5IDzAYYU4sEO3BbhLu12cE5bZ5BspxMvBuuNLaTT2OXKNJsmgFSIpkUnE6L35XgSKIMYoJ8IBlda5bGTulNCxpgliANMB8BO0ApUT6kbImUvX/nQgptnmOMhgxPokIZMaWICltkyXlf6zvcdMHc599PwXDLrjeA/CtX7SgndTxkYQZPLaXRYh4yaIOlxRCMGnfQUmvUNMqhA64TyqELSoKRIYsm4pPAixsOKeOpoxzWRk1QDhMmO8QsZn2Na5TDMr5EIhk5PCENL459Srvn0exvTOk7LX1jslcwvdL4Cto3pBI9WnSckdJvNLZaI81eo76YvpEstcX409FgYddUWUZXC0mcpuZhC5qINPPHu43dvFUB0FrQcxjkA+QDwSRwgJDgSjAOFEYJRzgToKF0vaPLHcdLuc4EMoE0kAOMiWZmE5MdkXiEcYTbpEXjRIz6YB4rGJ5EhZjrln1UOF/O+lEzAHtXm9wCyA0g/8pGDYqSD4r02Th1jRpFo6YBkgtMaKl4pRxmTaVRE3VHcACNsCy4hJQGTIcPjIzmjVI0ZhzCrlAOq7pPTzn0bvRo9FSkttY72RBwHIRjgo0TxidPz8PA55TshUwvNHvlkH4zS39DgF13YYhDmH2LdDkAEuQ3kC8lWnyC2UjaGKjcNVWkReS4TJuxLKrWcSl2qKD+ffeqOZ0ihs/RKI0xhOU0CKkOiUseMmcOA5noPihAb4CYKCaZDYAKmHpEvuIAs5Hyg8xGmI3GNI5HH3cfPn1KftwRXrQsaxe6jwpbp9sjyrWabnfzszqNCl2LSLQ1fFhS+cEi1t3WBpB/9+ixUuhOKYclovREpOM8OmOIiI9cUg5DG/LQmimqrBkGBFbKobyqPtY0PFg2qaMcLnDg5LhIMRY+Uw5rdAtgkNnLgUP6tOF5sv3A9C1Z+s3S8MqUXkh7jXqifceQvsMsmixM30C+wvgK8htSeiH5rTRkvpfbngAOJAmjtWix6zjXmmKNaJvAQz803wPpXFxdnrUUz9X6NewjzWXXO05UMsBGSCNcx4gUbQS0g/sEcgI5wmyEYwS1I5QV23cwTnBOJOu2PYEsINNsGvKQn96P+Zjgb//ZcprYGicBgL6MCCsl9TRF1gyGfVSo0vDRYJGKr4z/bGsDyL8kgmxipyVKi8ZGZUIE5TD4yx3l0NXogbVRQ1oLlAgid5TDFg0VdsxMOZxfR22keO2Ol0ZNTzms0dUow4GOZw9Gt4MmID35sN8d+ZxqpJjSb0zjbxxS7TTXkZzfmNJvsPQadcUWQb7C7HvUIUtaXSLGYJ90tUXyvLi4YIYQ6IByrvXqvKjGC8U2dpVilU+tpuOpfFjugJkRGuW+gyHTLUueg96ECVImmSXlKNsyI2jzU8AzXULcJmSILjED5jRNyZV3U/KXn9nfPvRBufrGyXpUWHjWJ3xqWVAR887K6A9XGz3WcbzNN7GKDSD/Qpis4rlDbdSMNX32og15QjnUFcqhO5g4n/g519tUBqPdc6TSRRuyNnJqJzsJmOgYZI1y6F1cupPhwyYgJ9t5SkTaJeNLYnrhzl4taojfYKk0VNILaS8FAF+R7BtS+h6pdNlGey2/RzptfCK5g1lapMEATnL7lQinn6w/AfhirXAeWhXw8/qZnQBph43tk6c3ewtAA4CnUqrNJF1kjujRIoRXqPqAnGBWwNK9gOZUznnRYyMdNAc9w+B0aH9E/tu/Kr+9+lEzvT5q0bk0V3yuJsRMZKTHbkXG7OQz6wGwB0V2Cj7asusNIP/SGiTqzFmk1VWlJmlGBCLP0l41XSwNnBrZWaEcsnwNHkUwGAsYJsHSCeUQYQDmcOwq5XAyTCaMLYWtaucRNO2VeKQncngelJ5pw0tKqTZXXsg5GsQwfGdKtab4DNoLkn2D2d+i3sgy5M3XEjGGlBhhTXGjfUxcDfRaCl3nWQwz0J1OVGu2mJgbTDYDXzoJx9RHp/GZN8ohu46GEZANkO9Bc8AzaBOoDMKjIMiQOKsgWPkwpIPI7ScoEi4iB5Aym5lrUt7/nqfPQZ6TJssnUWGaxSrWUmSqsLRWokSsRKGN+SRujewNIP8xVqMclpojywFAzLYF9QCt9UMWyqEVyqEtKIcxGM1JrZOd8xEp7Zp1A0lkBaPm3YBnGY6cFplnsXYwN/LZx6fvenrGwG9mwWYpIFi6z/bCxG+gvZYI8ltJoV9gfIbFSA8s7kOzVwD7Uo9LbXrbeAEI+0YLunpi1502Ow8S+yutR8MFcAo6p6csOj5YgCWWQEkQO6iLBJeXDGACmRURY+hE1u3ABDBqlrIR1A7gRNok00TDbsx+fHrD9Pbd8uGbCcLVFPmeqLAHwrO3j3Ppu21tAPn3jyJLSpQ0Uw73uQjjJoKFctgyJPcYncMsLZaYcPTphHLIpk6e5dilAdPxs1EOM4SRhiOEQdEdPaUcgjAmSwlpN5JPNvAbad9Ya4fkK0qUWBoqLzD7VmqPpRljESEanyP9DjsDGF/Aop7DhQrHEhA5lyPmkIjz9M5ippHLuqL6dPvk9xMcpDpFJMxNn/aArs6rOvJTRY2NkGigxgB8ZJBHEDuQE8Bo3AQY7kBWwAwbB3CkcZRzB+IIsylE5tNIYGfExGncPR95PE4+fRimlNF8jf6IqLCnltJLXdznz2VbG0D+3VfrZFfRB5872dGoCSOq44Jy6G2HtmLb2iiH5T5tjLu5HAo0a5TDM7DWMtjyoBymIY27RD6b2XMRh/ge9D/7RvKlpcelpkizVyS8wtIrLH2PWUeWYW97QeJrqHenl7Au6LLeKsWGrhlzFsydjuU02t9y8PviGel2e7Y1d7qm1VyILN+DV0Xuyl2y+DKlAbCR9AFmO8EngCMzR1kBQnEEeJRspDTCtFPSERk7Jkwi9nTPgE/FnWeitMPAPDqm17fJkVxTQvC0L0WF5ReufA5trLOPOisYllFPT8S027jYG0D+hRFk7UnX6mFSiOdWl8PJUjBeOINH72zXLLZoHeT2CuE8mRMMgOUJIFXKYTYVN0Ifnrh/5pBezNIrYw7xpUSKdfzmhbRvAF9h+AZLLzP9j9+Q0jekcjvtOSJIfgP4XCInsAcq8nK9se9anwAie5Ds0+/TGuXiOVdS9v6uNtcYAwwLCFbZotoeVjdyZARgpuwjyD2gieSoKB9kyjKArLBoyCHxWy5uOWZ2zEuLusSGWWB8KXSHAb4/mPBD+v27Phor9EpU2INhBULT/Bm7ET6iSfp6whmne1sbQP5lKXbTdsRMOawuh30kdY/LoVpbZ6Yc1vk+L3ax7jlYN61+WcRzRXyY8zXvxmEYnxKGV6bgPAP2EmISjHojUBkwpdGCOvQdQ93G11DcwbfClnkR8EyzZwCpAZCwmk7fcWa5L2rsgXIBnKdpNpflxh5IF4SbWUC2DlbLrEz1lNCLGmC2j06ZZkNqoa8IYhYYK3VKQTPfvmj4EIGMQax2Mnki8+5Af/7wfNj7wa14KXaZQANC74oTVgBwDBEUH9CJU8yPpUfcSg9bXubtWN0A8q9OtcNhCUlx1OXSlGlJX601VkrfCeXQgRn8aAvKIYvFgmvuZI/DALqCUUMiy/HkRgC7JxueacMrWSLASKVfCLwUEPxeosbCcLHXoqzzjU2CLH6PemM0aEjuEPqHJ5HahaLgSTFiFehqHH62eQU8yfWI8fLZa/X5iE4+7EShe+Z7awQoSF7a3oI89HRi3CdH8E8HmNs2WgYxgdrDFHOVhuICzgnME4H9IOSnT005MWvQlKYKvWWkp6j0TEPRgExdQ6ebHaMDqdIKs5rqz2nJZVsbQP7ljRp0LoFT8WcxlEaNF23Iely7Qna/iUlUvvU55TDm9RS86zRgmt6DEyNvquAC0rNsHDi8KKUXtHlG+4ZQ2SlyZEV2DGVMJwa7X1qjxkKyDAwhW6SWUu/CyuDkzZ+2y09T7AZyXZTG7raODdNG4XtBitOU+xqAXsJmXkEKzlqYsBApDqYTCShSbbMM+QSzHeWThGPpWGcQI2g70CeQR5K7YNRogjiCGgnsREwghpmVo3Fw2+0/NHFPPz7Da91QaaW7XaPJrPaTroUv9ql5Ysdu3w7UDSD/ARo1JUK00smuHO1shOXiKV2sCrIcAzsPmEI5nK5RDov9gjT7ljhE0tLTsHsysxdZegHthWTrQkcEaOHqx0inafY9utB8IdMrUv97F0HGY8e+C3yxccKVSG8BZNbV/dCJTixT7kXz5ioYnozqXIs411g4beZydu/pRTMQJcORKHVIcoK4I3UUORGYRI4gpnafUIkbFaLrE4gjYBOJUcQuuuOaSB5Ndtxljdkx/XiVW52uLN40lmd1cKtakDinIZ6CIRfSaZw52tvaAPKvadQAPeWQjqa6bRKOZhgVZl81nawmXrXmGOm01ZnFmG9slMMyDK04gIOAEY8fPA1DGp4xpG9geo5h79qd5rfSkAnQrCl2cKWDAYMuqmSpSSa+lLnIpwhh1wDn2jYsGttL5e9+5OYEKC81b26B5KXXsjA/6wbDy3fULILMolzRasZR02AEvSlAkVMBvSOAEcQYGj3sxoBahLiDFCNAsB2gwtu2oCiaRkA7unKk2j69f/rEo2T5clS4PA9xtlhozZslGHpRIs+77TjdAPIvhsnwoTEM7kgSDmVqBPKmvFNtEFpXeiYglqeZgbBu9drAqdqQlXKYM4dhGJiGZ6ThG9MQqTLw2mqIQKH/pVdCRZiWryC+weqYj9VI8VsnYPuKiJjGRbh1Jz4uDmNqCZK6kvOuNG/OQPJiyn3ltdWZSz9piplDnfBDWFUUcKwkd6cBGIE6D1l+kkeA8zbDEc49SC8d7glmR7jvC1jGdsOEzBxtlJwJ5HGCf/s3Tp9ppiGupchtTrIAYT84HgrlgO/QLBrax7YVIjeA/MtrkF0SlzyuT12jpkrg991GnVAORcDKrGOl0Dm8MWrC5RBIw2gwjmm3e0EaXsPyFKW22NLpnh/9ihpVlq513IbXIlz7isqeIZ9o3M8E8T5BXQO2C+IRutSn0QozRg8UDnUmc3b6Gshz5K6iwejEMNpAO3UuylsRMpBogHEHVaaMjgj2UDBsGj2RXpo3s8BFNHWmMvw6hdhF5XnT4XTA8tM7nvKLNCUdZyAErPiYz4IVRbNzDMk7txNBI3UfE+fHbGsDyH8YxKw87GzAmJeS/wvKoQNMbJRDVZdDz0iaxXNHFGUeF9xz2j+/7DkML7DU6IEgvoP2CvC5a768wvgbwDnt7uuLxhgIJ56RUhkI53DWjOkaKOuh2uXq7Hz1iv9oHyZWoLKV5s1a9ElejmJ5GuWrWGRrZtAUqbgFolQQrq8h1G1HsIBidKy9ux68a1dwtWdwzIXYlGH0xuUuEmmwlAFOnPLOsk37g46UT5aL9m+JCqN5M4/znEaFvTf2ormDUoPcIsgNIP8hokiiyEfkuVGTo5OtRNh0QjksNgs95dBgOGqmHNYok8k4piGNaffEIYU2YwhEvBZ/6W9zlMiQJwNLBGnfQMQ22jPIb0ypmGgFU4ZRb9xdjgZXLFV5IfVt7L5LIzxYkaY5AUlcS+d5IejklUbOaWNmQVcJ/ndhOHXacUFBdAPoBtoOVqTOqAKMjPEdZybtKPqudLOjgSMbI/G1ifQRxCgxapXhwR12ssQ4HDlOxun9VUesRYX9V2KnJwGe8LUFTw4fHJ62Ls0GkH/xuko5LC6HScCxWTkXymE5SGfKYSqUQzTKoQAmS6Ol4cnSEGM4xm8QX4uvdIkWESk2AijJ2pCxlmaTpcaYwiYhHmv7JiPUj+rwJBLkJYZMB0Z+oeh1rX64FkneYh1eUgVae23dnUktM/MEMBtkRYzYS0Rpc/rPVIRFpKRozIwkByQOoQKkncyOSBopHlWoiNHZxgjwACAFKGIs9d0MsyPkExIzpMnc9uNR+Z3KVDHOxAkrBh3rprxEN4cPOQCxgqI5VBwqt7UB5F8eQVbKocpIT4BhoRy645gGjNVfmlpoQ85DJmod61nFkUZyZ2l8YhpeYYVPXaJFNh41OhC0l07l+3uxO4gh8Jpip3AgLAerLWt8p9YHvCOFxUK/sfeROcNE/YlfxAIQT8d65hdXbW6logvpAOhBpIkRn/iubCZ8SiRlIwyjpFAYN02QTRCiW610hLiDFOmzsBMsQ17qjZhozIJN8LyL+iUUabjnQZaf35Q/XvUZNPK5BinTDIJddOjmjcpawkeYE2lKSNmQctoO0g0g//oUu8magUgufFaXQyxrQ+oyO501GaJjrXAZtKe026dhfMUwvIDptYsOq5rOa6UPkqWDDb5Eio0XgK80fgfTS5Esey2jQK+IjqytR3q4PHR9rdzYOtUn4KhL5lFdmn2JSrhIv3kHOHYAeVKTa7NYrnn+0dTKruEu2LhN85sTUeZ+UmvYBKI6pEwhS6UWaa66Pc50RY08OtlBIqSKOvnMxAndJ+T9IU3TPk+fTz7l8bgAxUVUWJg35gZza2AYF2sSaNvaAPIfDC1nl8PcXA6FUNPyNlAemKBqP9odlobJJ9sPL3sbdt8xDNFpZhn2BkrXGt/mSBKRTgNl3KfYrLINfL8Go4ZhhQDu7qJYPCJ4cDev+s7nuxXFrgnytlopz9N/aT5bEUAimHMrj7S/Ue7DaqpVO9tWJ/stIkSVOmTxD8SsQp5BTbWjXTrWRR4t5iIJTTI7AspwTlDVkfRxEHYvH3b8/PbpP//24Smz2MTaIipM2WCeELfPJYaqi6lSQyU3Js0GkP8gUWQ9GBvlMAG7Y2nUcHY5TPVYlYNIRcNHcDjHYZfM0pMNu1em4RuQvgF4IYpeIxAdaFhEiOQrYK+lKfNalL1fmSK1jm53BUd7KjJlt6PC0/usCVGcguKicX1aT7wkNtEB1K0Zx9XIdm2SWkuwXESf9W/5PPKjlaiVWvjoFM1IIIulNDGRnBRd6bEoHO1ozPI2EjQWDvskaRfzkxoBG2m+A+woaAyQ1L4qmSdhennf+TTiMOSkNFmLFNE1Ymrnmtap02MDxQ0g/wHXrMVYhFClMOwCYS54MlhxOURxOcwusKj/JIHZOI7j/gnD+NpYL80Eq7BegjIY+o1FiKIo8lR71dqMCRuEVLQcgeewL30AHO850IRVIIxSAWbb1VvqPfdEoLzyurjyuk/GgNqoUKcRWcewUJoz9Jmb3eYnuYxKCaSgH2Iq4rpTaL+HwjiJ4GQXaTQVNXJAuejdldS6EAhpcRYtRWk69fJjh/Ew6v3Fj2U4do4KEeImVUVq/QvhSclhWxtA/oURZNOGZIx5mxcwLLWtnIjxEATdefylb9SkYbd7Kt4v6SXmF/FcGDABkORzEY94otkTyKcSMbYLw02w3GbxO7CH2XBTBecRYDytPV7CO115XKvx6f5UfK0Jsxjb6cDx7KEl6gqD8Koc0qjYdQ4ovpvz+ZpOAZMQRgjPBCXWVgpV/gjn1L4PaRWhKFQKoYlMZZzLqRD0cKeihjhm+XGStOPxelTIJpnXAPehesa2NoD8O8BkjUas1CEnq6M/wpGz3L/OFBmQOKQnDOMzhCeATySfQAS4oV7nHrQnxvYKkPvycwZN4xOMzzTW+4wXI8YzrcV7osaTIfCT6FG6cL9rKfc5nK2MDHH9PRjvfOm9M4SKnWy4UM7q5mi2XI1N0/4O+lpkgrAvJkNFOBcOMxQdSQ/JTjljLAGKAcYio1Z/0ilJpEOMmiTcQU6JmJ4n5o8xu6g8fwbF5eK0KYXzkQFtEeQGkP9INci6i6aCG9mAsUnrn1AOBcidwzDuOe6foPwE8Bmw8jOiRViAJsBnEjVafAIQ95nB8gnWRZSw5wBVcE2k9zoonk6F6xzoFpHfnbJkZ2bQddDpWk59X6Tb61JcfHg/62mITlpPOaxeNdWeQZ2orrMMlQcmKhwc90ghmkshy92RKmumMGrkEySnNAEaIeygdJS0AzxHJ5zHYOxwB6RQ/Uk8DoZx0DRNzA4mXYoKtdgHefVr2dYGkH8tWrLrZBeAJBQuh4U1MzqQzEhLe9rwBOkJwhNoBfgUUWMAYWyjngtQ7su2JxBPjIhxD+Kp+FI/wdI+6HEFfR4p3J+msTrpYtwY2VlV4lmjFN5VCL0PHMmVSPNarVKlzGEsNgy589U+oRuiu94MvwofUCKdOxknJAsZNGmibFRSKP84dtGx1g7QEdIEYEdogjBJOsIVohhmpeONEQyfmx0sS8c8UVMnhHceHZ7Ul0UCmyfNBpD/eFFk7WTXRk0Rz7WgHGYL+4RkaWTa7WGpRIn2BHBPtNR5P6fZ2JWO6K7wgvfRNcUeZjuQeyQr221fHPkSfrWj2RcT9Ug4ogduuqNzdNqEIdfvwJO6JK5Ekb14BZfgR2cwbIQyN1ll0Agli3YMPRRGwpU7xHGFidKk0CuZypjPBCiLHt3qiCqPMWBuE6ESbTK3pg6UBTlhnkTfHZWnYXJPJedfqKDXRlPvrU1shoYbQP5DrUWjxkPZJxo1oTnoyTAegUMyaBjsWWnEYPui2B3gZngqPtO7th0FCAMw42K19lhA0Qpg0vaI+44Pz3vwxhjP4x/I1Vrlw6+HNyJHPlBH7SNNI5AtZrl7S9iyrbf3jT5LQBeLwK6QEsE9oMzEo2A7Vt9sY0bmBHkmkVXqklFv9OhsU2WbHJSzno0IIZkAaaDpRaY3TJ9ucNkMiMBS1acGwEmcDb62tQHkXx1BqmvUpFKHPDTKoTAl1mkSM3EH2r6lywX4iC6tZkmnWaLLmGOMNLs1ZSy61i215nOJLtOXQOgWOJ42YLQEPOlK3fIesLr4Oy6o93AdPM/ENFaA1oN2qJo+O8NeFyp9EsyptJe5SYtZRJrHXCQtABNMwLAHsoMUphDlgXtUMkXCS2fdPQDQoj2DuJQPrzPPiYF2FWEnH5h8T/rbqEOmWn/cOjBMiJ+zS/hWhNwA8h8sxe4ph+ooh3Wa91nDSKUn0BrYRW3RajpdfscTWNwEaxMm/GXKOE9cgmfNSifcL5TA7wXEe1LtVXC8kguf1h9P/bFPX9OqVezaS+f1qPEaTbKl1/PraWZZsJB2rNlA0eFkituoMEqbtccK/yk63gS0K6QpaHAieNBOZJfMm64d4YAcromQwz1LyARzKJBjAjDBUAbQ46fRxh25m3TMWT6NMMw0bJW2uWMqFh0bOG4A+Y8Jlc3EK3bQyYB9Lmf03TBEGpyekCLyK9HiC/uZxuIjQ5b7lJlHptLEKVFjzDxiX67vL36XjwDjGUPm/gNt0aC59LgL5cPrjZcr4HitVolrf6uOJ6JjzljURtrrLypFVjjZjjbqQ5TRxdo9T6RgI1xOYBI0gtgh40hpJ8dU5idHACPoY2nYjNGw0RDbWTxtNACFpWMYAe6MnF6AacoH/7Sjq8WJzfyj+alb+betDSD/gaLIGiSx2bzmcsMoJRuG6FqHx/QeQp1ZrHXIaNCgNF/M9rUpQ2tD37sKiESpTQJj0Nh+sSuzNrt4mlqfDHpLK4+/ixlza9ToCqrySgR670fApYDunKYzxnhaYDin2oTHPKOV8aRUHucRFNKYxDQAGEmNiu9lh6yJxhHwSW4jgVHCDtIx5lQ1wRXsHARoAtgXm/QJQBYwkbYbwEnK0xEfbkEuREKCgTAWWKRFOcA2gNwA8h9uFRMvX7gccnSOGNK+RHq7SKWxh7iLg0HRfY665J5QgGMZEI/HcNcAFK2bXZ+TFwGHJ3XBa3XFS2m0n9NjzqJFfaEBczNy5PUI9FdKCD0tEaUeWecdK+HFBPqsGxnzkQZZGbQxQVMZFzKBwgCkndwnShOYJtAnuU9AyjTV2ccJ0qRo0ITIBZSLj01QEUNQPsMQXW6ji/DBzJ+y54Hm7MBQRrgx9jnDNii+AeQ/VgRZlRwr5TA5cEwCmEYwBZhJT3O0aE8kS7OmMGWMzzGAXJkxFg2ZiBqfYfZEoDZnngt4jlebFOgpkV9Io3+VR32j5ngznb4FhsbHQbOfyyzAyPJcKu6SoXbGAnzsZiDLeUIxRM5kwc7xQsFh3pE2KTxpJpBOs6yoPZbh8RjnobsQoz+5FDWn+KrowfVGBjGRFkBpdHLIrwccPwb/zKlojZ7MqVrYr29rA8h/pBX5mpMYSh1yhCUbUpl3tKdCHXwGbE+zfakxPjcWTEodMNY6oz0h8Zm0+b7RvHmOOtVpGZRXE1VV0PA75hUvAKBuWbHeDZzCXfOPi0j4D4gmyeUQfN9EKr6vKCK66lPwWoP00GhsdcrUE4VSAn1PegYti8pw7MOIQxPEDCGLmMpw+B4qTRpoV8QsolZp2JE8hlsiM82OSBjT8Lwz/8xZ05QU6XUCYcUJc2NibwD5D1uDrCuJ6bc87Gcwq6wYhsJOFaGoTZiIEJ9BvsR1vlZzLsaIT+lWl851FPQXbBleAged9DUvpcXSn/8p3RMxPqrecylKvHeUqXc3NBYaYh+SYaZJ1qaNGaDcGY7NlgiiDTGwr0ziKCuRI0LlB9KR4C5Sa2RJRxA7gsX3JgbNy8B51CeNGYk7GDOGNO0nTfspTMSKTBAiDFULcv+2HZobQP4joqUIe9W4DwFbe4Y6Yy3wmSygSQT4mT0jxTaWn61RY71ARTBuYqRnNq3mIynyqUDF2u8rXtX3l2EvRJe90RTvONvwESfFC6/hEkieqpV396vU0LaN8/OEgpu6Jk83azlbnoM0KnMEfQKwD+Xx4q0tZbhCNDcEdZ3QMcCwptUMMI1tU6TXlklGqk1mI48ZyO/5cOizBj74UW1rA8i/WxSplmYPg7E0WIT9TBG0ffhP2x7GPRP3SGkP2B5WWDRmu5kxgx1phWbIXYx9cFd1rXhvSrkGDg/nYV9kwdxMq08Ebe8N0/mYoMWq4O7C0kHLKLcqkPcMG6F0h1WMvkpXuzZ15s+WHNIAZ4jhSjlSawWLxqIG2eYeiX00aJABHEuDLsNKoyaAMaLICp5mu2Q22dtxIgsNkdVJZwPIDSD/QWHSgDSkFNEfuINxT7MdaDskq6M6e7JQDYNPvWNKMzAad4TtQOwa3xqoNMT0JWB8NI3mWp2yalpWa9o7sbM1jHkZ9b4kqvGF2gdPJsd7kKzvuc5F0os1RklcC1cb5mGlES5fpbFTHW87NQ6zEcl3yB4ptWOS5xj1gaLOGJeJqKM+2CG8tUcE72AE609O7THSjsbjmIYj5Idea4PaAHIDyH/ICBI2wHahqMOSInMPS/saHbLOMtZo0orARAx+72gFOIsoBYAAV+OeKEIUD4Kh1sDxFqjpNNqcQ0498jwXwYz3RYf31BxvDoavxKsNEM/rlqTmURmvwGjFilWAF3YNZtpigNMchRYBIIMwyriDa4JppDBA5SdUZlgxgRyg8MsGkOKnxhJRhpd28HkSFD8lDQOYMBWieP06pPVG2rY2gPwLAZID0xApdNrDsGcKYIyOtdWZxT0shWdJ4pw+G4eWRofwRJ193MGwK+A43AuKvxRN9pqPq/Pj/PMaOuSvF9F4DnoXn/I0Cu4iTJKhCVlR1LumjSMUfur8pDSfRBbVAhvoGgAfBA7wAnQqP6kBYgrwU4rvWAlCApliOl2p/NUymEQrKrwGJpMmyiep6vVK2PrYG0D+dWDYFeQ1p4+WjCMtjUgWF9oA4xjgZ9XgaYQVsCMHoPwkRgL19qHwqseiCj4ATOCJOu8jlcNTJsw15syqWvgVHvYlZfJTIy3cEQF+iRXz+G1nJdhe7d0Qw9+Nb118bNgJ1KYaPWJm13hRK2/lhyInTiQYE91NNKNkCoBLpS5DiEbQQFLu1kqJhEVxWzMwtt9BDoNp+jT/OPjSqGxLsjeA/ItCxWkAfIwJm927h0iumTGlAWkYkAL0aBxBG2EcCyAmsl5HEUrFDiw83SpQgHJbjHiMxa41PRoU6FKkeEuxZxVBrmznZdsE3hzVeSCVvicNP7mdVx4X5ly87o1TGzRFeYRC4WHrZHCcMQ95irphY2nyGFLkbOBgIK2oYaQicGyAjMYKoFYiyfgJDfU+BVwHGBOGXfJ0mEArehobOG4A+ffAQi41Wi0BBziOuwQfDGkqFLUJhHGHZDukQhlkAb6oHwXgFQHccmmWoQCLKG67rT52BLhjPP7XyLVfzrhOGjN3p7+88Tt+mT5+Czx5x99r7oY1NWi+NCuCwU1jt+hEOtbl1RbMzBBPA0vKzAJ6YJrBjgXwPLaLA6VB7kOAoyLLqD+BYU7R02jD7pjH4VgkNFone1sbQP6xZS9eEK3uliGMPlnECmQkiB1SKkK3KOM5AXyo3OngU4/dyM6+AiKJuRaJrvZYQZNXmGPSdSy8Gj1ekDKTfg18O8vXuQTY6UX20mP1g+8z8YfNxPA1K9sSPXZVxw4IOxvbM+/sApSmog1ZIshqs7MAyJgcJ5hgSJJGOo6CD6XGOBY7hgG0AEFogDCQHKTSqFFr0ARARkaRICUKw8jBIHn0kTaA3ADyF6PC0+t34UBT6FeR+AM0kLQ0YEi7ovK9Y9QNd4sLuSOxn9PnqsbD9jgQI8wWAEnw60o9a3XDi8PfXALm4ml0OQLVSV5+Zs71B5y57gXpC1Yt7L+8CyB5cUeRgn0IzN40laZoRPBYeuoiAjQbP5qIaNEHuI2UDjAkRmNmiGgSg4SBYhJLFGnZICa6EsTQxJ3rltaiUiE5xAFmyDmMa7VpQm4A+WCK/Idkc4rOJeUNA0amMcAxOtBRY8S+ixR3MIvtZmNLrc0GgANrysSqB9jqlQPjerr5JrsDXGu3XRwKPwFFnYeDelS+rOLkNQXwRdj+i8C49hx1XOfK61sC64qxWKs9ls0dSBKaQdDURYroxn2slzwiYEmUQSpjOrWu6AmA0d0AJXoy0Q1uBriF900YLcDNBI/naPVLkEZzIWE6HsGNib0B5B8YFX6lIkcBYwYSaGZWO9Q90M21ImAgNLRu9HzbSNYuNUMgFYxmjWEHcQcrvtbXIqCLDZcLmo6n97klcnsRhGrNYaWux2vK4Q8yYK7dfmV+kvfc/+SxrWnTK483OmEAYz0zUjOaVnzkqUZmD7gSaR6gFl3qBJcBiapGN9HxNkZDx1TVMQxW5KJsblGrXI+fTAkKVd+tgb0BZPcG/s7voA5Q2OQYLaV5DKcAnjCC6tPkWdKs2ioUx0IBT5T2MDyXbVXt5xnEc6k73QRD3QOO9wLrCtjpUpf3KjCuRYg36H+PjOzcy0rUHRRGnYIkTmwjsBCl6BBxlkqrVUyd2EzMNxlESgrZHclAFRsuWknkQ1ySMe6D2sQJDmupenO5LVL0xGFIPljxscWfGyVsALmta2l2MgJmI20oplpVrYcBbGG+9QyEYo9gz6xKPuQLwBfAXsr9Q9ACKD419sx4vuER0NaltHuOYG7XKq+A5EMp96Wi4C997idAJ6yn7F9J17lSp23beSKHdgKcpuUMJbCsSc7fA+GWSJnkBi+D34YEZyJkmoEwle//jDnTmjRAbeiUcR8bOOwM8jAP29YGkH8JPgoY05CQdk+0IaTLtJAvewaKbmOA5p5W1Xj4VMy1omFjnJXBg01T2DYcFuhSDzZeBrbFMf4IFXAVYR8tcXwBCPkFIHs0erw3vV7ch3NTB7boSuuEU77obosnNcyz8wVb53nuQg8dGI5lznEGR2ko87ED5P32erFGPwQGmiVNPgnaypAbQP5lywDbFwHbJ0j7rimzbyl1a9hUr+syMA6OIV6BodALB7BrzLDOx50cuZcGtE/51l8uHOhO1HxQoeLB2uHN7V9t6twKaO00NT4X0uBC/af8Ts5Ne52re/cKPyUljrEdMIGNUhiRYwVQ1rlJWLGGteiEy0p3qBhzK81VH4cEunubpNrWBpB/fs2x1sRn/2VDSkEFlAojJlgysZPTQCaalaYNE2gh+wwayaCRkWUouLgvRWXKVg9jPhjp3dJxvJom8wFQvXHbvdasX603XhCiWE3L7wFldrYUXAHW03lNzEDZmuF9CHmqOVlmuCkyOtp1XKcMjKr8XHzdbShTi9NhdCPLrJkXnrhhom/1xw0g/xQoLPtVB4ZsvvJRfspAolk545ezeJjKtR29zqhJhBnLfYNeRrGMZ3B+DIJjrQKY/Bpj5o8f7tAV7NXt9NpOo7A/MJ0mb9+NvBtYr95+OrzOlQ+9NHfOt+NUBINoTyMJjIFa95i3JCGSgYrtxCyYAe5xCoV1NWUS8jKWK8BlFGgubVXIDSB/JSyctbhXgFAUvOxh6lhoMXRBErQQFKgRISsoVtCLCFFIhWdbo8WhCBeMUTdSAi0Vb5lyPz02p3Ft0Plsu9aBULeB8XrN8YKT4iPp8D3p9DVg5BfHh8g7ouprn/MMknM0WbnoPI9mibC89Fbu5Dw42g2kspyxFyk1SroNwj24CiqD6xIJYcj4k60zNoD8326KjCUYegHDyhI79XCqwNiuG81gg1TmG9l3EzH0Iz8QhmL6XpV5BoEDIzVPqCl4KbwTLFqAN470K6Hi8qYbPtdn2++tN57pg11Opx+NGB+sL/KR57p3jrSf1TxLtbl8rtNJgf57WB/SVzG/nOV2GkUHlPt8ShYgiY3DqFhF7LFPe+IOwxA6P0cD8nFLszeAvJYir0eFqiUbroBff8x3B5PIJmYwZJjYgGyUOHKuPRZJMo6k1WHwrkPJgf2wONBJoDVhitvptc4P8NU5yNUBcF4AO8xNilMwuUgb5IoSz+m2B6M6PQBsuNF3+cqUEU8+5C+m6GcBec+o0QnALd/n7DfLk+InSRpNDkIl3fYyLG5R1yYH2n4H7HdhR7utDSAjQ12PCtu5+VJUuJDbZwFPzqDYgSMgmhfmy6z8XJkzvTx+6jrTPasmGjhWbouIMYEYCKujGnb3kXcPg+ZWqtiGn3GiIM4rEavujE7u6SzrHHAeALaH8O+ujjgvn4luTBEsyjenJ63ZZpYldSak+GmVHWOxzRHy5aDRRLkZVIbHi2aajISMoUOJMmAOg5HcDxS5dbE3gIx1HJcp8mlxmheiQnRAqH57N6ZBAKmoSJvLQvCspdKJxjTLWC3GdEpUiQSL+iNtTqeL1NUQ4MiQ14/n5FVQPEv3tLR17g/GPqpbOYjPUsirh5TuRCWtp6fXRn7uif5Wosi7qYRfHiBf4VaudbYXpmOYudv9/qTF37NyojR6EG+KmTUZ0kAsjyNoRnoR5ymm1yajF+YNW/sw6pIpmaaJG9dwA8h5t+VJinwSlaxFhOJJSFBEpM0FK/oDptn8aKKQHBYAaKns5DHH2BTBm0J4iRyt/R56joWvzSJYYZzT686p8CwK5LVj90KD4ZKd66Vo8lFfmVtAdJVeyMfCwXsbMw9NJz0CIPfRLBdNlr5hc16LtK4OWZy2C32QNBiIXFzDWFNoI1yRSjsMFg1Bqj4WRiKBljrtoW1tANkD5bWocN7RKcA8GomnQMgTycIWLAikONCsT5lDXKLWGFvKXRR4qPn2XsgCqhYLJaLkWNRZ/rjT/urICW/PP+pe2s0VsLiHT303mF3zkuHjdcIvf8KXBukxa1+e1mD7z9JOuYow0AymBIGwAoSOUPThDHwwhTQakYSSkgtGIUGWGIrk/aiZxQGwoeQGkADyMNxMkXsgbNRZ4YxxIK6DTXIlkDtBA6WhjeXM4DgCGJt0mTQuQJClo92zZsCui91Jml0DKd4ZMX7l2OdKREqe1wm/0rj4EhXxzsfoDpDmpajwkVoq7wRPXa5Hxv5pkKWoM2IeFu91Ho0JXsbGWHxoiKo8Ps/gAjXKjG2EGcyU86Z5tgFkLLdo+FEFDNEBoS5HhdeODXV1S/OJgAXIteaMauQ3G2+BdXsFvXkUqHa40XFv5/pjHBiXAO6s06uLL5h9HXIBdDitgy2FFewKcNyTxv5BPOqz90RexMA/Bowvdfj5hcc/9Ak08kDQCWmwwqxRFwkGOLL9nEE0tVTd0bTtY04SxLSN+WwAWdbT8Twq7Hdd8fZxeP1go4E2AJYgjFKbf0yd5mPqQHFu0MxjPgvQnB/TUnTe9QJ1JeO7dbgu5pD14AdxAzOkP/6AvJZeX3xdj6TVp/Oc94Kj7svAL/9ZFuZURH8qHOsZFFmHvsvJrvpWnEvhVtXezuZVBhzp3AByA8go7+jBqPCBIEcAYSmBqZgkoShCl2gxmi61ez2Uxk0vPNHVK2v90cYSPVbHwvRYoKIl6i/k9blus3Dtg5BWZiVX/rBuRGePguRaNLvaqeb1RtXNCPfRbvUDe8c1kY+T5vb8aTbB21rADAa2Y/4ioxvOLpVe/7wXX3yVIaLlTTN3A8gvR4VXoKAOkTvisiMY9aLqIseRxgp01dq1gKLNzZdeJTy8sUvE2SLHoUuV+Hj6ttJ51pXHPDIzeZaW4yaQPYota4rjIq+PJf5qTfOPqH8uPi9bfkDsPzeenzSk5dxEhIg1mmQbEq9CAIboXMeJKWYd1aXntTZZapJSMYkQaLOq77b+2QHyUTCsd6+kLqEMl+O81O6CJXBUrTHS0gx0HNFqiJyFTsnOxlPWakPzdjuPDPRARrfWkOHSJfAMYO7kG6/1Gppg7B0D6GvVQi6UkC5yp+8Gx2sR62ogrMeemFfS7TUOum7UPU6mCBimg31qXT4dUqYY41EXPc71x46euGDicI5LCZqBoHKeNnTbAPL+qFAnoLh22NTj2CTICIrE1DyNizhplSsDQJiExFm6qqn7FJv5viBfo0VbKPl8hRN3j0DFPbKNq7YC10B2BZTWbBZOwfFugDulOGKdHdlTIi+Bl+6oT34Jmb9Yt7l8X56dmYoMRciZuYAOMpuquc+WOL04iMXsubtv6LYB5BIHBCBzmSpfih+s7VMsx7Ha9O5hHLH7PMIMJlZA88Q4PacuEizyZEyFDdFGNQTYkqfdUqOTbXdENLoNkjc72NeA9e763BdrjJcaLpcYPmtR4d0iu3du/MPTdD12xz7gLkXI9rpcVRCX89kr2DSEF7k5XiiJOpMl2++f8wZvG0DiwPuiwqYt1YFhm4sIBYD2oB/jC/afR+Pk0b1m6DRKlbFQ5xlhbGl3qz+WGqSlpbshRzCUxFl52v1efrXWt5L7drOLPB3z+VLEswaouCNqvAaMV8DxV0aD+IvRIHm5pnpt21dwUme/Fi72EiVrs3px0psp3IRbFH1IwJqlrOYsoLowpqZfsa0NIJG7E2kfFTatUVRAzFHJlhpAzjvtfDCYVIWaDY4EFukyVNWdWaWH4A7V55rdIDg4kph9sVGvY8fZ7XBYrQmsAcDpAX1Bv1H3pOE9uko3gOYXOtO883638OxeaiAfiHLXOvlfiW4vPXYxd7oMgVnGcjo6Q1ghigyd8bIne7FwDXL36Q67/GvdmE8VDMKWYm8ACQCJpylyiQyltl/VfUtLg86L2LH/PNBypQpyrBauNNsBCN8Zsxn8gF340mBPYA8rBlzEvt2/XcceAay8O51ezEKuN1x0K6I5HeW5ysZZYc18RYX7RmPmLNW8P2e+oXN2B1heGsDnF+rBa6UA6kQhafESy47JdTk6dc2Y5rsQE0FyoRfJbT/bexDhkvKWYW8ACWDHY4sKy+n0fjA8jagAOA1Pb5+jkPYweyqgtouLdqAVUNSumHPtYWHa1UWHBTzbTGQqqfUsiXb+p3EzT66jPLpR/bo1C4k7WTtfSalv1R1X73sniN2FXbz/5hO5u19aC7C7cPJZloytT3xQxyCFogXZCeqqbicj2jx5N2xpE2snG1sXewPISIn95NDnHQWibla3tmbUthHwofKrq64j4/cdemZMa7hYKIWH7Fk1dK/d6jR3wUHQbrdpz7rJt7UJL+LqqljFhbGgPxg077ZD+EPAsRmAX3+AVj7TSxMBX0fL5d9YNsy4SAeqsk+Z/xG7HZlGmLMIWbCNCVVVn8rL6XdgiUyJrfa0rX9ugLwnKqyKugsgXMPMODCsqPDOIraVI1tNucjEBnizswhqx7tuJQkjgyXGfrznygtYi8wYrnUV1E4aCGemh6fNnUuKPmu/X/0cb0WCvI1n/IWvc7XWqMdS6z9zXfp8z8evoj8YquBVAr9IniHEcOmEifQQk2qRI0m6OH/tZKMq1hkgS3bUBpAbQK4dOeJ5VHjxroxR7sL+EoHkIkWr6Uox5uIcAVZV6AKYpBGsoz7N9rUOlbPnZkc0ao+hRnnRlRxxqi94r+nUQxHiHSn4nZj5kMTZ3f7W/PPB8F7q5EWlcb/6RkPbWTXUbj41JZCs8va92s/SETMAc75NRUKNSjAzsw0gN4AEil8WT/jJK5hZTszhT3MlvpEPQNsxh9nUvamGJ4KpU+cJebPmca2hVwwXMYRgbk3NT10L7ykJ4Ob4SK1irT7naqNGjxUF76xD8lfS1EugxDsB/HbH506Au6d+eSGj5ok82pmKSnUshAXf2sIopPqlCwZ4YV3V7QrFHyBhJiWksu/V/bPN6BJIiXMLfFv/zBGk22pUWCNC8Xqoo05SyzwTk1LImFnQC10JVpwIyQHSKGKg2PxoNDsczp1vFWEKYWw+NPPA+OMBcg9w0nWsWHMrvGrt+ovRxq1o6+8WzDyozMNTEMPFsaKeP64awbMpRMzbVofyT9TGVeTJWKiq3tLrsAaGJdDjpAwZScqQiklXCnJse5FF+kzsMpxC5trWPz1AeloqiF88dDh7setCWsmMZMIoFFuEohAuYmR0pkvDxsIywZpi+FjmHMcmacbF3GQ19Upf1hpcUwk/w6EiknVmWK91Tve90dZpFHTP4PZXx2UeCvluhXRrz3+RmnM9Ib7y++WXd6kmiSpO0UWDpc7YG7abAgtZOoq0SN2tRJ3ejQN1zSe5/lCB+g0g/0MHkHYeFTb/64f8i5ico2wItR40t8KRVbexeV1rDMmz4o+96GxjBsTwu65GX8MsWVP3ZrsJemcH1+nBfNKNXoBk+1M8twZYmkrcD9r3sGp+ZWD8y3NB9848Pj46JF0GHOmKZ40uRKuVPCNCQYid3dfqV7XouGmefGDYxrJeiRfnZUaoDEIKWZuazwaQAGRcgOJXFiWkyQdkjS2VXgjhdhcV/nWzcsWsCr6sVyY2znb5yXs7rTeYHbr1qD461B0NnBuva9EMwtd1H/jAjOKXc3R+3ZPrSpAprZ1QrnwYZ/Jz5xlAU7qdwbDTV5EroNJBeCGUFnkBOtpj58fEdUqkMnxDyA0gC0A+CIarx9Qhl0J4a7DM4MYGfkvAi/GfVFKg0rjp71drRqj374I3XbVhvr3tRm2xDZX/icfJWnPmq6K6X8mwLz7HtRT8yoe+ep7glRrnLbDvgHQ5dtPoL6IVcJMHJs5A18bIPdKOyLBNwYf1yBZK7LiY9fKA0G1tAPkYEK6AjaQoZwtUdqNZmVMMYCRP/ENYZcpi7ILhIpfa0DiUoBjtERkD5EAq3iI3lLmvHP2L8Z4HdB1PZ/CEO8ED66rdX60xfukxl17PtaBXD551eAEd/6D5yiage8auEYxOD8LgLGWG6heLMuRaxAHiu6dFbAkxvA1rfbkSyIwCo7W9rQ0gr4Ph6X4uzYopXUOYkBmQZEWZp3aohehYg0Mx6Jq71IV6qHAzLE0dVvrhrt2XqmwcnqdmvP6ia71SVw74K6r/NzFHVw78O2uHD2XFd4/x3F95uIbv94ejK9+Fvo6JF6PJWXNzKT61vNYjnpbbOz4tIYii0ZVLHRJFCy2I2FsMuQHkBXAsALgAwwXIsDPOJDD5oBCcGKHCsxYHUDGmEw2bHRoQYoxokWnuWvdpOVhqk0Nzp2slpu6o46zAcl/080gKvlK7/MU0+tJLeIhSeEkJ/I8Aopugtian/EAn/JGywZlljU7UfSpItp99XdEhOUOYJzTGQcHhkBykg/BIyymaMkSX3CHP0M2hjm3900SQfh4VLk++TWm5sGYsrrNofrvMjrl4zqgyYJoPMecmTKUZ2syWQSKZYDSYRb3RYqCcjVVTa5RXOrvU3Zh4KVLUtcaO/mDQ6UDhvDFzi5r4R7sfXgLGW2NMt8YGTk5e7GuJuuN0sVbWaFe8NVoIDyJpAT15Ab8KkswQPBo0AY4MSy8XrQBmbexQ8vi52XZtABm73NSFhyWLlYWoaBsaZ9fpLjtq7f2Zy5jdJBqNQ6EEhgCFWYBfAGKwaKzUG60waqqALjqmDdmeo/jXnKo3rId7l2qEPHEt/DNt4R8Yy7kYOf4ZPtlr970YMfL8hgVWfkWk4/og+fl31mcK3UmbnKNHwaFIjVnEywCbz/i19lhri8FOjG3mdQBIceYPnxBCFElY2tBtA0hAA5dRYZWw73ZslsEIkxfR3Dk1H4/ZPCPNEV9REDdLsOJIWMd2mnpPsX61JmjRHAvZ0xKtWTA8UFC748B9NG3mFzLIlVnGi6rgizHDP7E9cFfPhdcdHk8/mBrxrvgG19nHanFwxqY5+6iW85Y6He5fUnYCAJtu5On303X01LFkmoFXgceS6TSHQ0shZDEMG7ptAAnk3XBWj6Q7rIBgD4YrxwddiLTainyZMQFWALPUGclEa4yH1HnP9I6GBhYvGslmjZ8yyc47wFEXNuoLNcVrA8w3QeNPSodvFjEfuvH6+76HT306m7j4CHgGlGvguZpWN5nGc0AlyXK9eln3dq48uZw6Gp46YgZQxnhQsfqSYJTn6c/MMzaA/I+yzL2BYAXEi4d+BUvNdi4MSleCGZGSlf26SpOxjfbADLQibmZF4ac4fs3PVpV/ak5vV6zfrwDjg/7WX6kl6ko6eepw2PHVV7FngREX5NOuzUBeba58QXziUvR8IRXnH6L9+Gi9YAmG0upkeedSLM0/1f+eQTgc0bmWe9bkRz9s4LgBJDBMvgqEqNFjtzuKgFI0ZzwRzMJwFGXNuJ3hXMim5QgjaVX+DAajFVwttcnZxpWzrWvXwb5w1FxNlS+RrU9mGr0eSbrjWDxt2PDOKOtGtHaNYXPL+6XXS7yKhV+YublBtebf2dRqEXESKjaGcSEcKqZJUgE9eeEhZoV2Wq6/g20UPDMaOJqfR06XzLZJyA0g16LCCoala+1V79FWSnBGkyE1KalZt7E2WWIQPDKZ2qFOMzCWbjaaDuRyW7BoLqerp34li1rUyTykLoAkihL12X1XuqlnSHEqvou7vF5KRe48FD0zqlrDuC+6BT4KiLgs/vvXCjm0dnjpSiNDyCRdXoASZZyn3E5Et1qUR+OGFUgFg+hwGRyCi5JMGLYmzQaQsbsJSCFt5la71idgWDvWJSmJpo2DjgTHrBzulWddtqnxsZv4RPzUiFD8GcLQCyOBHVS8a6CxGHqlS+DYWXqeBHo9YPIc4NZEc9GJVKxg4GVOMK9ni8Kyr3B3VFnPUmvOgCcozF8MY3mlhoq/Nmq88AF5ix5Jh6uY0eCEl12iwlJX1GJESJWTXW5D7YoLDplxS683gIw1PdnZuRmO0qRpu9GZcTZJ45SHxpqpA+DCDqoApzDoUpEuqw6Gdai8SpyRO5jV7btuqJxtwucKW0+6lnrzel2yA7MFSN6Vyt9Rs1yJKolbKuG8An4XwPFXxn0Wf/NaevsPkvOwgOL8ZblqxNgAsESKrdZYLl6hsNYiG4hW+HRgA8gNIMuyTt+kgeGlslV/3TXAa8SHoA5WjUez6kg4CtzNWpDYlVnHIYCzsmwwRByLENlVEca90qOYfy8Ubd0ztHwFxNaz4a+B4yob8E7zrlVWyVdMsW4p5VyLcpdpfnzW1040f2cAVQXBGk0uBI57hk2fKFVQVJ8WqEalNS1nliH9uSIlG0D+BwLIw4V9fKV7qTIjScDsU4OEwrFuQrdBIZRi7AelPknFthiwTC0F78cupNLcOTHl6pBxrWcxzwI/AGjSdcuFtZrlnRxo4lFJssvAdFY6uPakq32Yex0KT3FVN17jX5thY71bXSPFHiAdkAvKi/ucAmywbkJ6xSUdPzd03ADyQgbaWS+0znWvE0GAWUxZqUmYVfMttmZNdZAraj5tdIctWLE2lF7+ryOPDYV5T6S0ihu6JFfzgHzZmar4bYxo9gFNE4G3Azud1DfuPTRPRojuxq4HS5ZcZcTcW9/kymvm+kjT/ZWLXtOxASJJV4seC2smrCyjBVc711oAqkhIEEhTONeEqt7GpNkAcg4+yNnW+oa5VN3FZXUEh8V/2KqBfMhH22JbBURidjhsQEhyHuSdx35mhmFpTlzPovs0esXLpAeUX6UbCqtU5dP65UWgXO1IzyW2i5YHa6B4ExzvFLa45Fe2qgauO2qla5kIV/je95zxzj6HCoTxzITgJbKMlGJu2BTAZFE4mzUi6/6nOssbFgyWaC/fsXGxN4AEAORhvTOpAmxVtb6Zc5FIx0N/pHGOJGcv64UWZBGdYGXNWFUUX3Cwa0pe+dxnB+Tj/RLhTyNDXO35PKD/eM94zb12rldT+A7R7xkf5Z0fwrXONtd8ePQ1YDx/iVzJCrrh8YrGoRYpNJvXer/Um71LKrNsAty3GuQGkCtgeGLepc6wqqMsIOUc9UMVIy0plfQ6LFzFkVzImI0hfMulCVf1p0Hrco/F9vVB58Lbhlz3HXwnXexbPlX31h5PRR74SO6LFVWha6LAN/723X+aVyLHa4B/h7/u2gd699mvKegu+dWz2+HyzlqJn7VA1tK1DkVy5UnyjI1luAFkiSCHhZxir+NiVcG+bScsHxOFQUxhzmWMBg05NqtXY2ynjZ1d6wD2ornVpIvVqKuyZ9KXHP1upmZ/wD5/BShVHOlPr68Cxa2Gyj0WOLwRYd4Lwv0A/NX0erVDhou2C3fVQ0+sFO4CyVY+7LQgq9CtuvGdnlqIbvynXTKADMil+AnPDmaBxy3F3gByXuatldzA8HTyo2mgOA2OAMcqU2YYGghajR41G3KxRpJVvWc25wqFn6oPaamfRr7lVKC7rBF+ATR1AZUu1etuiWjw2vNfaQRdA527mjT3AKge17ZY6+4/7AqxpkPKi1+I1M0uFoADCl2QhU4YIz25aD2WrjVDIDfmHHOhFQqkk3A4Y5Yynn9bG0DGGl0LMKwsOy/FbHG+mDuHrEEqijxmiUXDMWiEmPUeOdcbuRDJpVWNSLYOeDP3Cmner568V0HyJDzWSqSyBpT3AOwvWRXgPGy/9MRnKTrP8/9HP7Rbc673ft6/XN956ENXAFvpYFfuC+BBNSwjO0AuXe4MZ24CFV7AUl0nXLEKrDozvXIUtrUBJICiNlophuyzHi2yGicBVxOZYDRkAtwC9NhGdyoQVlfCyr+e5x+LU6FCO7JSEzmrq50yZVaZMxfrdHfWLO+OLrl+261ZSF5Lp7+wbS3l5bUX9PUD/SKD5lpK/+hJozfbuvn9UXFqK5FhAFzhxhRlcK/pNWfjrn4+cp4pnS0aamqefaXTvq1/aoCcxhUwRG3YpKYs7pbw/O9vJkcqQ91prh0yNdtWIYGyMjgeArhAgntEmVbuAyWhCO2q528vpHqv49rdncYb4HnLoEuXcYf4RRvWR2urWukc64Fojn/Sa730XGs1kdNm0lod9MJ3q8aG6QAOHVGQlYKoZYtG1air/ITUWjas/pwSubVnNoA83elood5DK9dt7mq3QmVEj8xuIge4AhSNEQUCBlNv1Tor/Aizko8asNaa5BD1TMRjtHKQ3Eu/u1cX8lqAtsrHvvYUus2e+fIXc6mm6RdA8o/A5Dv9cPilJ7+vPnHxxNc1XNTnNn2jpt5NfnZ78bDpeKnqTbw8IeeKrAReN3zbAPK4f17OPCJGeSw7UnaknJGmHDHl5ElQbbQEGNbmTHSyB6KCXlwEVMAs9ymKPlG/HNs8pJgekoshz4Vp7wHD01T8zwgX/ki8PIu0LoS1d81T/kGvlV8BxItpwFKeTteUiWs6XJ5IRf9xaQMroNYdUW+fa44sgOheFYEESSSzAGXiLo3mbf0TRZBpygGIU0bKcd2yN53IMh9JuEZZkSkjB0ZKPDQPmRi+XUaJqBJo9fZmuVAFKazjZl8cX1mrP9JOJc/0ZcDTFx94V/T4q0fbaf2SvAGOXwPGu2qOvFAGeMhojJdnO9ttJyZfVTGcFOSzOk/cEh1rMFwN4wWFhSuQQTojN3e4qud1GfOBE8hyd/Pso4JUswHkBpAAgO//9XfQQ0GqORcWwdxc0m2RGPKUMJWxHfWeMq12WFJpW6TXxblw3lYEdTtzruZbczP6wGXxmzYhYl1StSaa+1X5skejPq78fknz4dG5x7UH6aSW92DOzWszVbzzS3gkqlwTO16tvS46hl2HujZelAlkkRnS1EZ9oAyyiudOAiZIE8AM+YT4/SjpCPcJ0zTR5WmDxg0gT5enqEF6cTaUnbFqOExT1BFDFDeRNszq4JzBLrrSQwd6qabfkUJzjjgDHOuw+Fm4yFu83e7IimboykjPpZy1YUh5vPqaol2sNfaRJq8XJ5cv/StjRLhQsjtr62NF8fw+pfObUeMtcPy1guf8Xio/+vR9zL8L0gQhLsAE6AjgWMEO0BHSJ6BPCAdIB7gfJB0W24RPAAep3N/9U56Pmw7kBpBn6/N5V8Z6Ouvp6iBXJiaSaMhIcnXWrR0DRphTbHbWC5I1a9e5822ts02VIfGiAHTxOOSN/PESV/tC6NYrj2vpvXzRAqcDR+JP8q2+67n460/+iGXtrzZ/bllE9Ldbdz+enJ0CAD/ni39C+IR0EPAZQKcDgOMMhDoIOEA6QjjGNi9A6cfYrsmPH0cKXns3y5Lmtv7pI0ieNv1avhoTteMEQ5ZBSOGuXmYbGyMmhCoC+MxiqpJW9Mti7CfMvGqqXeXMbP6dC/y6HwC0PPZ0MvG+Kvx4uwN+Sh3s7yNqFThXwXM1urtEmH5Ad5G8DwH5YFr95b955+23yhur340yoINchwKUBziOkI4Cjg0AI4KcCosmrkeEeQQ0xQUZqCm3H5F9gmtyuf6hdC83gPxHya+nJdB0sSSL6i2nCXKVKI8sAtPs6ooGyESLMdvCnAn716Z3ZiFs1plzwdgcEBe7Ja8Firfz1DVRh0td7K6Lekmu7OxPLWjTN1Ju3vGaz6hM/ZnrEhCtjUDdoP3xVs1xBVx5AzBugaIe9ONZ/biUpVJDjPQ6n4BhLtzqqQDjcVl3RI0gSyqOCcIBjklTPiq7B3izjKJzyRHf1j93BBm7fyphXS/qbaBPpI6mascKVS51ifysPICh6GOFXNhRChu1cGbYVMphUBOvna7/iP1UuANwq9/TnxlFXJqvXKM96vbnwQs58BprZzERsMK86V8L+cd+Cfc2xtbv5129sUSBOqIBZr1eAbBFluU6Jni77xTCFIhmDe0IV+Y06E8tjWwA+R/5DewaLC4Py6IFQBBmiUkGs6glwlIBvQRjpNxxfYDZwFJr7JoxVawilH5Y1H/QzL7srvTwLBOdN8z9in7kh3MkpjVgPBe3OB8Uv8D+uLc+95UaHq+lsHdIgvfOiLiXOscLAPzFyLHVFXnh9fFyTXK5vUSGNRrUsVi7TiLL9ZY+RxcbFp1qVb9sOMQM2kQoKyLO2gnPs5Yf54SHG0JuAAmUjq1m/v6CgABQMMgGmIZIk+sMYxhxhVgFxhn0GLeBxaWQI2A7Ll0NRwgjDDuBA8+Q5AaqrPKku0ZNa750Q8jU8qkXIz9d46YdLbqetp4Fg3/Pxs2tz+ce1L6Rkv8KdfHa/fq51btAUiWCRIztCA4pg3AKLiKAkJyNtyr4sSn/eB0sb4o9ksuzABN3dr1EvK1/4hRbhw4QV+gYk3bhXsgKbvsW+Tl2gu9oFo6FYe+6EzAGS6YAIYsd7GzutWuD5JLNDgR6DGS0fgTyNMjsGzYtEjw14ekroBfGxq+U+/5UyuEquGkh6r4uxssruHnFW/tekYq7rWk4s/vOhgp4rbutEiF2M5DwOuuodjZvdciq8uMtNZcyXBOEEjnWGiYmuB/L/TZg3ADynmii832lwImGSaEEHkA3NPdCFf40rQJgGfvRQHIsjJo2ChSUQwxFQbyojyOtkwt5O5o5HwX5wwqUuizLvdJE4e0I8tLg+MMv9RI3vYt8r7m96s/1uOYVcA2QrDXOcu/bMk25gV/Vd4wGTC51xwx5BceoOTqOqg0cV03LJ6l0wFVS8ZyPcB1Xm39bdr0B5LwzOLBmMwAQ8koJ7PjVTSh3gCGxCU8ggRqIVBV+hqb4Y8WPJlg0s1iunU5kn5hA8cGj80QBTCHPdn6nvra2oMmpzULqFBG1gjx6QBrrHpB8uD/EyyDOL6TYpzXCO6LHBeDeaMbEzY+MXilDiFGeiPxqB/ooV5lrxBHAAW1YHLEtRoLiAh2IyprBAfADPB9KpLkB4gaQ144xLVTsZ784gblZI6SZBYNZARyc5x2jITOL387zjbNj4Rny8TKN95Fh5j6i7A5A1oSbV+TOzM6HxtdA5M+wbBBuj0BeVde5p9N9y5EQWHSuLzFneB4RXkHBGyB5T8hfZhmhI6WD6vA3yhwkcADL8HcbDkdcJw4ga9c7AJM8wOwT1AHOg1zThowbQN4+Zo9+pmxTsILR3yMQBl02k51bRmkhhCJBFBT+muxTvarAZ12bmTBoFsa9O4q5lXp2L77ZxBKPmRt2jBpdYuA8gOSr7JtLwPhQLru2gV3aryvnlNPz1Bci9lvfw33FyUv1R5V5x0MBwwnEAWAZCMeR0FHAAeBnA8w6FK4aXepQR4BU0233I7IfQ/FnWxtA3lrela8SIYtJR5tITAC85pHNpIlN1eLU0zqGOsKooabS89xk6lR76vULGKjHQfJXapEXvLLnuchr4eMXClhflR27aMTFk4hSq0pIt/8Q74oeH4rsV0C0Rp/qJwn6OmTImB1r9Cfw2FEDD5COoo7I/Sxk/BS81h5z2+YFGKUM9ymix21tAHnHmp5tNtEsO6iMGKaWFs8WCbX2uFDgYQKtn28cFiZdYacwLoBxlkI7H3r80qjJuhdNSP2t1yhX5yEbuGAxF4k+ab/kRHiFw/046OHBjrG+9rn17+dGzZH8ol/3F3fLuaGiaKaoRoCaShMmQBMdtXBmzFQ+dtQdm6iFPkE/gnRcqoX+qUKhG0D+x0uxGxIYNBAaEmzK4O/HBC+qPNXHGp3mo5V65Oxa2AlVWCqPi+ZObdY0cV2kk+r+18HxztrX5XR6pTOs00YOznnZJy94bcxHXS0U96bY10SLeC+6PoDEQjfMfQFD/whwPPluVuuQsTHP7BgdJU2AH1rq3FJobw2bkl4fCnDOQhVz5/oQXG4/UDqSRR1yA8MNIG9m2P/yBCUL9xgLkLTfD8Z8nO0QwKrzWGTNMIamY4sYUxHQ7VkzKTyx63gPYjyIHGkc54mTC/WwK/XBy+BymiqfRJFroSR5/lwL1sytdvP8vIKfgKQW/7OPNM+e9nQuU3cOfK+NIC0fG091Wk/l8iRB/lpq/YVT8wUgnapkWSjx1NpidKhVa40hThE1ygqkrgPcPwF8tqaNynX3A7IfJc/96OO2NoC8DpAvI+gCJgc/DrBDRvr0iBrnwe5xjiKDNUOWuciwTRhZwK88prJoBiJuh3EE4iLQVjUW7vE86UGSF0DS9QdFl10auqAiXjrQuYDE9UHNa/7aK3OMp0ZXZySfJjF0Ho3dq6t5Lzj+Skp96TtYbnLUMZ1FswXdxQ9wfZbmzOcCBOvYT02tu2gSWdGcsQ20NoB85A38D/8OfE7g0YHsIMDENEppBH0IlkxLjWcGTFAKi/0C+tpkNzepoUu1E8LzOqlxr3/BEfCa9estwYc1ZF1THL9rtId3bzsFVi6iyRUAxBVAuUXJPgPHr0WIJP+4euMaSHIRaJdutA4xx1ilygIcBR0A1qixgWE3+jMB7H+v85OTTlkz29oA8q599t8/owZFADsLWbNPTyWtTmLpTLPYLKjVHYuTdtlmtZEDxM9WvCpajyQIqgqlrUUmq5HOSs3vhjXoldLXjed/JOK8ZC7FO4qHfv46pMv12EdOII/WKq/InvGesscXQXJm1rTPzkMBPOqMRei21h472bKm6Vhpg5U6WH7XVOwWqlnXBOUMuD801L+tDSABQE+AzOdR7p8Oz8aUShIb1AeDe5U2qxaILKDImW1HFo/rGVADNGtUWQaJuFJ7vDcauzD0rXPtxjMR3a8cCSuzj6dNFy3437r776h52dt5in32UxfqpZfqkXH/q6XMS4ybZkXxdxukVtAFC9AFIHq7XoEweNmOxqmO29Ru96roE11s6AgqhsWJfNd5jjGYts2QbwAZ+8fYMWlcUFbxufZwJwwxiWK0pdqdHgQNFBOoAeIQu5UGVK8a1e42xy7FTgLTZQ1WXQfFh87+OteluJU2L+p7p1zhy2wc/uLU90WhC30xijw7d+gKB/sXgHDNTuEyr3plu/qQulAJe6FbNb8ZoSmGH4DwlEFr4hQrhZqeS5+oPjSeP5w6inTzrnRSVZ9Wrm9R5AaQ8/rwaGqENgpxQKKQJCay2LqiORmGKZercK2VIFaLhSFAUXVGcqYbNuXxe3yveSMdPh2KPk2/1WWwhQ/Dk71+ofBz5WiQ7gYs3YVmOolBr8mN3UiDr4HdWtR5+r7Iy+aH1/72XUo/V0zTVssXytVgC+EvcwDwgeo1IxzCg8Y/IXwUIIzbomP9WWqTnw08VYCSJQW3IhRuOPc105ZebwB5aR1yJxYKs1DlMULWjLbAct2smGwt2DOFk113NyupuZFWZMlbQbI89pLU1o3h6F4cQpcOyEK36+mGF0HukqXCrwDjtZok78K3i0D9R5pprX3+Z6rjayDbvS/eqAPfx1/PDfDAg1TNuEqK3CJBHdq2efwnhCeqkddML2zNHicOcq/8rg0MN4B88PjYpWIZQ+h9osGMZgGG8bNAYbFTICqNkFCxU5hBswJlZd70kaQBNJWk8r6o6BQwa4SkyzVJab2DrTVbgxtH8AUK4sWIUWsAchkbr2pIfgkAeWWKp4++2U6Kp+BIu3Oy4FID55pa+Mn3QFKdKs8B0JHAUdAB1AFZnxA+BR3n7nR1KVRv2rWgHAa1sNYfuek9/oXrP/5U1VCGxAkYzSwlo6UARzPCaDQbWP1larOFtNJdKOztav2qjk0j621g1SQreG6itboHC1e72Fcz87mBXpvo9USwvD8Xdal7S6C3DbqW7pAzcF95Dt4Z6Z3dd4XqeGYbcAKOa899z+zjLTsCPiRZ52iug40Rc+y8rzu2jFehimmejSxdbyH418BRxdpVjOfiowXbbW0R5GJ/noeqabPBVqMNkhiaf3UFvgZ6TGHAhRkIK0ebSoD14hQ2d7BPIhDeAkDdTotuNGIemty50f2+Wm/kWjSJs7opT8PLR3yyeKUksSpSwfO/swJyXxPTvTUuheVY1vw3pBCQ6CPCT6mly58I+uAnpA84Ptp24UPuH4DeIb1DeoPwJukNQFyID6hEj18hCmxrA8ioALGzn0HiYkRH0XWOIydBMJhSeFyjDkMYYSGHZquqDXNnhAUNLx6kl6hzuA2ci6jt/HZdtH29kAKe3E/35GcPNdv78Z5H6oQrH8ZVcsyJ7uMjij28hwaq2/jZK4mH7miNHN8AvTdQA94hvEF8A/QzruMNqMCnN7h+SqiP+QnpHe5v3e8/RXwQyDorpWyR5AaQj9YISmWQgvBujECvHA0x1xguIE3PkUXh8VTNwcpQXwPC0sohTw4VnnVZT6lz4mMAtKo5oJUMfsUTu0/2TgFWt+qND65+hKgYpXE1Pb6vJPv1tOGOv8c7OfLkzVrjSUQvAJOkn5AC9GoECL0HYOoNKj/h76iA6HiD9EZ43Dc62u+IjvcH5B8wfbqUU+Xiw0+G0re11SAfeQOjKhmQ5iEkXgbCOxvMDjAZDtddPaoU+3oFBNVHVVXxohP5F64FOAqL5o5OwFEXwFG4Lr4rLS/9trPS6ok6kK6UXqWV7dc78NIDYIYV64SvAO09tcuQYQ4gdA9wE94h/4AUaTP8A23Mp4AfFD/JD8A+AH5A5feUPgB/B/wT7tOlevS2tgjy8eUejnNOIlUXhSJ+Ww2zSYJi8cCu7JhozvTjP8G/jtojS42y1SA5T6DxzrraJXaNVmh+K4igs872pchTqym67qp96jYo87bqeFNh77UddeGxp9niPaOKq5xqfp3SSN4HoEtBTi8jPB8N+CI6/ATxAcc7xAJ++oiIEnGRYpvwEdFliRxj+zukDxmOm074BpB/bGDlpY491Q61J8CMTAFqrOITTICZiBggD6HcuG5NC9KKFmTtdtuSt80rMv93AOMaUtyTOpEX0+cz6bPFoHlnvXBt8PkaWJ4qZuMEBNs7rf7cK7XFS1x1YkXYdqX2yAuAZleix2up9SXVJV07kckrmKkAGsh3ZH+H9CZXSaXL71FvfIN7pOLSm2qt0fM7XFFzdH9TAOYn2H1zveRdzWm2PHsDyC+VoyiCKr4zMbsowVjtEjiP+LAOhluNIrs5x4gqZ/fCGDInybToSNwyiLp48K0wYarp2ClbRmwaiE3af20o8XTOcUHW+QPSMq3YR3AJwOu89BsnkrvA8Zyb/VAK/QeehiH/gONN8gA+6CdcPyF/l1rNMYDP9Q55qUe2CPK9dK1r1PkO+bsT7xA+KeW6P9RznJ3tTBtAbjXIB1eMQBKQzeM6kpGaf2+K4epmHzmgDYNXhg0NZrUTXofF7aRpcxIlnhgeXioZ9ffXlRLTyuwfr3XNeULA7eqMKv/W6466UHO8o1Z5Mde/M429qWbUg7Ju1GN/5ex663cCgVWfMaaD2oSpqfFHuV4aMnqLWqMHILoq3fBdro8ATr3D/UM5vyvnGP2xEKKoPILZbk1BvpI2gNwiyK+tLECi8WhWhCZK5NdTCGuNsVi8miWYxb5IskWYNGNr5sQgOSsPe+m4ff3AWmRml0xl1hof511qnd7WR6OnNUi/0JTB/dTDPybgwhckzf6A+15K7R+pPfKstnssM43vgn8E6KmvKb61mqTrQ7W+qDL60yLKOvIzjwQ58GHHnH0/gtnL2y2ptGEx4hOd7K1Rs0WQD67jETge3NxlkKKK46TUUwRVj436e+FVlzaO5u0z5bAdTWnOJHkCPKdRzUno5Vh4dp8Blq7dXp9jJbo7BcdyEe7oFusLYHdl8FxnrXPdPzT+iHNhrz7eRfEXu9e3GDQ8id65EtGTxxIhvrX0GfgJcZ5vjJ8/44J3BjjW1PoNLPOR1BtYZiapN98PH++/PU88PfHxsn3atjaAfHj5JOggImdTdsKzQTlOtyqgCYQEmkpxL/LcLjJUE4xSO02HZqTQuSOdjbzocqqoS2i0NhZz/pyX/tQS8C50qa9R8dYuX4kQv3THP8or5gbS33p9vCsTmKK7vIz6ECM7AXQqg+JCzDRKb0LMOqJ2rt3fJY8aJfEO9w8of+YxrFv9SmQrbiC5AeSvLgrMgLwbfBQICXKVESBhYdAndpW5vpvKJh8ewCrd7d7HOw/CP6qetsJlJjqhonrAmS0jqEsK3PeMy/CLaHrJgkF64D12G8R1Tva15763AxzPmbtU+r3VGBstMK6rRYv1PmWER/goM5LvAD5IvoN8h/guw7uOPNokwQBPFlJ9Z4SDRRW6jfJudcgNIB88/gikKtJTJa5ttqhqyi+n6SB7qdEGtkvQYC/c3wHNnRHRvSC5Ej2uRn+4Ehl2f5S40e3lg+K2N0BmOSzOE2bQg3YJV+9zp9cOcbtBdPnG3KLEOs4DvSkaLrUL/dkaNXUAPABznnFUHSDHu0okiZzfAXwSzMxB2vKUYO49RyFeSWfcJt7xWW5rA8jVlRIwGpjI6MWUoXAyBnjO9qzS9tZZTlrDMHUeo7Ng7mkN8mIYdhKOXaoHXuxac0XI5o6pagIrhc3zlPwSM+ZLafalfP0atfHe/PfGbRfnOu8E49XoVCgqOx+l5hjgOA9zl3S6zkKiRZiS3gqn+h3yMgbkP+X5J6b8A+4/M/yD7i4jMAmUkAcDszdR5DrzSADe8c8JfVGMY1u/sv7jM2liONrU8WZa8wWsLJly16L1KAbdcEYiNiyZc1ScbLsgvnriQb0Y51lTAF/h+J5ZItTOJc5x/OIws84juq+C3yUguSD2wLvsBbsrtxTDcf4R34yebjVobj6FVMDxDfKYcQxw/AnXDyiEJgog/oTjB+Q/4rpmsQn3H5B+RNRZnsfw5gnHnM3TMUfGMzlMQh7SPMta369da9RsILkB5EMlSAKfYbsgiEwdvUJ9Os1uCLFFUiyD4pwLW7Bm3FVG0Ll2ILcDt5tR40oqiAuRyuUM+3Kt7rSxc0JF1L0K45dR6E5NxTVw1PVa5dnn9Wggecfj7vXCPt+US9r8E0K9/IDwBsdPAD8A/Kwd6xjlUWxz/JACTDE3c4qQhf+E4S27Dlac0VTyEjpgckxp2KqKW4r9J69cGjJQHRarTZYiXrEQngj71joCpBZ3WgNSluexahlLnnWJ761D3lX7uqPk14PnJaD8cubKXwxO+Pgb1Ree+uxl8/bzaeVktbzvVGqLP+D6HfAf8ADEAnw/5yjR30u6HR3sOv5TfWXcP8t85CfcP+D6nAY7tsriaTk7x0nFjcVlg2ejsmJfW8ZfwCLaAPI/9nIRZkXXkT0DhnX4u9QQa2ExBsIjJS/WC6hMmTmSZFP8Ifo5yLV5vYV4Lq+ne9eOet6BCuq0AQn0g3NdjaEDvI5tc0tNG7g843lhpEiLB1xRnXj0hHIt8taF8alrQeb6ZJBDOMCLaERT39FneMtoeUEMg9f7QPhQ3d5Ue0qNkniX/CDJK/CRpa5YXBobQCYD3We1+PJ2rXy6vDcD2dYGkGd7OEGYrMWJ5FxHjNpeiR/JYrOADi1mVKkPIM87D+R94HgWld0h338m6DC3vmdcK1YLaymqnUSAXMQb654r9wPIDaA/tV040zm7O0y+aE62EABeRozShWbQtRGfudMeNUfXrKgTUV+hA84NmK6TXSJHfy/36+qO+Sfcf8L9DdJPAB8yxSC4ca5AWBSWZQCn0skeEpDnTjZ7c7fynS8ph1sUuQHk/YkoNbkBTnXGmKzRYMz5GJeodaoBybBqqGk4ToHyesTXBZv95TrAnIg8cA3oeN6fuCcK/NrnONcReSMn/qXZzpPbSPyhmeNdTfLarcY74D+hqriD2ph5gwrQlYvq/GNjx+hNtYsNvEN8g6U30GIkSMikgYoZx9J7gYyooMkMJHl0st07e1+0gqVOPvStk70B5MOZl1zwRhdEh1JmcyiGTkT3RNeR61JlhZpd65ZLYOseuwqIJ4B5GVxuq49L1248j5CaSMUlAHwgQvylIuqvPt1qFPmF5z2NzoVjRIb+BqFEg0EPVFUEb8IUqOK25bp/tBlHKFTA5R/w/KHp+CHPn2JRdSSBMuMYjWrBYfE2LFJsSvCUzt/3RjncAPIPCRi8ZsblrIszQNIqKM2gSZBkY2dYBbfZWJnSzRrbH/aGdBkle842dBEcV8HzHjXxvt54bVbykijvpec7y77PueTShTRdv/h5n08fZMg/y4B3SZ/xIeld7nONcRageJd7Fad4g4f2o9zf4TlmH7MH2Hp+B3Xsx7dYRniEWa2nLyUyR7vQr4w9nVEOaRtybQB55zoqZnGiLzMPeVcz5T56YJuVLFhqs5xEISgWemEcsmHO5NCJ5tYciT6W8nDFovWe6PHUH+VujxldzzsvgeGlF3UPk0b3Fjh1JoQhXXpDDzB/TlXMe+R1TQUQ30rNMcRt5TWlDvWdSKd/yovTYMw//oDrp2YR3JmnTfz0Ib37uD9erEU06ueMjgRgFSBtTscXZpHqObLEZgO7AeRjAYLDzcyN5hbAJRBeZLSLZVf5GfZdBfSUS5XfEfSy+rNen+I6w+kGd47CXKgR8pf4zLhguX0D+BaR4wX9x1vRrHTX61k3BtPV6HMtlZb6AFPr0W0HyFf/7nJNQR8s9UYvIBhD30X8Vm8BhB6R4SyO+wHXZ6k3vjUnwsawwYfIg8xcZ8xUgvIGfIYY60FNs6cASh+sdLVPKIf9x0M8wEja1gaQAGwwYKCnZBlpyDTzADVmMMCOPQCKGWAG6304hRETc4AnM4CJLPcBpgKSCwAkVyKER42jLo2+XFLjuWigdVp35P3SZmusRN1ZAtAdkeQCqE/BeaHu2+4jrQhc6EJN9aa1LsKmNUZ15igRKhzpTunb9Q7XAdLHnG4rdB7dSwpeZh2hz6g96gOuA13zFFlPvyKbGIU6gKQEGYGswqgZViiHRXD+jHJoWxS5AeSd6297IZkwJGcyhzHDLCMxIzEAk8yxnZlEhtEL+DkIESXqLL93qbaXUXL1ALgAxzWdwQs867Mo8gwEsNB8bJjgK3OIHYjoatPmMqhejeZugvraTXdYqN4TnV56mHTfizk/OR0h/4TrE9BB0kGuzxIV1p8fkH9I+lDW7EQo/4gaZJmBLGk5XG/K/ib4Z4SI8YGq1AfFckomy4xjd64ojcXWqIHDh6KQe8vwbFt/1/W/AS42wNEUUz5ymEUdklSJ/HxpS1CPtHafAohAScnLVMbZYOEVSfH7cmStCs9qBdhW7kssGzVrUdtdwPRrn/Wa7sfNeutdKHuDSviQCrnmGnQogr/VrrMcVVSiKn6/V0ZMqIN7UA0jlf4Jb9TB+RJqPT8BfgDKoGBCqetwmRe3Rk2dcdQ8EF4ph1mYjI99NZuJ1xZB3rNSNFBcYW9Y8jNUoEMDQqOzryfOCFLqi5yTPLFr2sDBUJs8K0Je4hzfm9reAi1dF4XVNfHdS4/lvUCIx/Uj7xXhvZKmX/wsHrFomM8yUwPAqDf+CBEKdHXIMvvYQLCK4OoNjiqAW71oYvzH/d2NH27IrcVcxniunRh63Y2+M9062daBad/qWaMcbin2BpD3LC+QBlekyiUKXKTFkT4rmNmmqD+W5s0MhHMtnK2gpy5M+3NP19Klwt7y570isdcGynkB1G4BH3gvOAF/5kem0/Jkb/LVPoupsF7eivNgY8QA6IVw3+dZyMaqeYtUus44+kfrXHuRQSNOOtY+T4OdfMAsr61RDjHbuC4phwn0UptcHKEb5XADyC+urAxPLOGiz23OVtlWG+VhPZpUDFxqtBldAV+0SFndFq60Lh5KcXgBRHCZecIVpZxuO/GgB/Q9UeDVx+m6OPA9jJ+rTKDzcoO0UpPjIoxee4oc3OgARnnpOlePai/daXmdaZy3ZY/aosclHuM/4flDefp5HPWWTYca6WklRFQnX0edpNknAFkph4bQhkTOS8oh+vnJmXJIbpTDrQZ5T4oNAAPhR4c0t0mLRtnpkLg6l/v+4ic/T7ZHj/LhmvkagNbi/cV60ppm5Eq0wAtg+0cHFhcrCnw8/b33j63RyGsN1ri8w+ksqtS8ZKRSa5QqMP4EUMRt53lHSD/Ue10DP+G58Kz1A/I3UD8s4f34mvLwE7JjV0tsFey5UWPwWeezNGrcEpQjKslkixaZBZPDhwS+H+DsReRYGDinX/wGjhtA3pVtCTA45C4t0uwKbn0K3YMgVmW6aspeAbaELl9qKJ4U0tuvbe/v0Ixcj4guRUq/8DrujhoX4Mj1TH9VUJfXhTmuojAuK6iTp9W808/pGPxo/9HADwpNR+n39rtQ5Mv0E9CPEJmYwbKJUKjOTeIHdukdUh6Ojjwadp8hfHsuoza/NnURZE85NJSmzKR4jslBL/40p+c8u3VC2dLsLcW+cUwHQzBpRV6i1BKrZkWvAhG5SnBkej2wQFj0nMVL9beHDLB0FxCtR6C8opDWh1u8et+HI17Nf6UfTSSuKRf9QnDDe7af/4FSNTkUlsu/F7HbuGT8gPRDRd9RGbVR81YEcd+lYtG6cC3UR2HKvOeRnx8vYyaANDl8mP3cVKVHGefUlj6fjHv1lEOcUA5j3qJSDnlOOVzOjne75BZFbhHkrXUsvVySCmEIsXEAixN2LXLPdgitey1SpArDhg6DszZyULZJ3gpB/AP0DB8LkW9H0Lce8NVxkL7Wx5XuKW+96Fuf1ZpP9cmsaf/zNLKcf53g/lFA7iM8YYpxFqraTp1txCeAz9Kk+ZzdCKvJlj4BfhQ/mg+RH0opO0KJxyYsmyirpQ6767Ot3jONcjgCnggrg+W9cVeVOjtRWdkQbAPIG/vZVMtTcpbmi6KWXUFPEMpgeO1el6FwwIN2TZURtgqGHo+J+iNmCqL9KfulLgeOa4IUd9c7vxKOr26+y7bggc/lcqjIi+wirpQdyoSCilBtdRrU7C6oar7V7uPFbMs/VOuQdS7SS0oNvMv1k8QHyANLnqGi/B0dZ658Fyp86qU6eFXVozzAVcVviJ30WaUcpoQ0Zagq/Ih1unI29+D8vUhbPXJLsa8daglggpDkytmVsxDlSBWKWeVe1+tFhEIVJINmWOmIXABijkHgBbiup5aXMGAtnb7Kb75jRrDLd4kVAP2Kx/aFtJ9r9cCzzwCXZdxuybudamFeCrp1Qv+J1+WzbFkRlYhB8PeuW915WfsbXD/k/lOOyr3+aPcN+bM3SD+ZWCxaJRZfdU9Fe9mBnEqE11sfLb4zw8LUrVEOraMcYh7rqZTDMTjZ6j++Zskw5+ebeO4WQd4XfNlchnLPbp6DbghOgDKkCoAV+KYOEOMS95nm3wtQCoWfXbncF1q6p+oxrY50ClacIwC/rHq93lPR12vyPZf7nojuDBx5G/i/ElryQRBffl4TgEM0Vprg7ZsiAnxrArgqzZg6BB4iE8WZsEaOsU3AG4U3GN58sAOP7vQYnTWPzvNAwrLDR4CTlzN0y4O7TnZUdyqfukWQyQoYxvNJDli4HFKOnIrRQk9H3TBwiyC/DJDeJhjdhawpT8hyZA+Ac8Ul1HscLofcIWa4XFXRRyWylDug3M9PwiXJPQbScdua4BSI7klRydvD2LqVm19Jvy8yay7wyNeC0UfB8cuzerfkzZQhHcps4zty2CGERqPeI5Jsw95vcP8os40/y0zkT7iX2qT/lMKilZ5/wvATAz4Bzco8EswVKjwk0hSdbPjcqFmQVde8W9lHnJztF8pRSAfMHTI713+89iltjZotgrwOkG3P9AxkTtmJKVNDFrKYTHAINJcj0+QQwycWdIgudy+iFg7BFQpABSgX6fac2N47GHlv1Cfdi4o3tv9CzVHL6FEP4dhXm1eX3tvFJ4oh8JpGR3f6DTVyjFnHn5VFI/Bns0qIFPpH+92L1Bnwg8BPGd5IHQVTSJTNSt/MQB4JJSJlx+feFm9dYi8n2kQr1r7/3m2it5+xDGCHuUHDpbd6S7P1lR1sW/+UANkFehLl2U3MdDM6RZeQSTocGSYXlANLmcGUIU0gs6RM9wxahinLPRfJs5BNE7KgieTw8LH+0H11G5BOjpJWrP/VY4W38e/+iIX333TmS3OpfIEM4KOkxAUcy5xim3FU52GNLv1W8bfWLEQBvcHwRuGHkr1DfigsK5CKkZsughQYnexjRH26MM5F1dmCK5RDF5jmRg1JYBKwDxOvwb0Nkfe1axXjpHaS3gbHN4C8ttwzOv0v1zFnuKZkyInIQIp0OiHTzUG5DJnQrA3pNsGKQC5V65BRl3SV26KmKSgTSHcNX+vO0HIBbCVpaxYSOhe2YH+AXHD3uxqVXgetGj3yEZC7J3q84Fixqux1/lxTmU382YRuZ6Otny0iFH4KnSBFb7bVvKzxBvINxDtyflPiu5NHy9D6CUmojRqRSCWV9mEeyVHv7KEKoHOmUdXCm5qP65xymGfK4fBxBNLQTogxdB73g9Rqm3Fy3MBxA8iLmWme6dXumZMmZWTCMpyTgRNTngBkGSfCj4DtRE6ET6BNMGUIk8gj3ScwTQAmSZnABPEIqDRxlEHaXEj6hWjtCpNGrXZ4AqjX1Hr0x4EjHq09nukYLihDJ2k4V84fa42gdj1D+Kwd5qKwMxtnodgfFOMtAFXpe770s5BVscc9ZM6YjrXmSHX+2pxBLchVQLYASHNHHgg76Ezfk00kykBM867SUw5RTLzKiE9POczJQFejHDbxXGCjHG4A+diajgd0jn0OQ/YjciYzwcmNE8mJ5BFAAKLziIQBwgRognyCpwxqAnmMtBtHiEcQA6QxHssD5AOEATBC/EKbawXg1uwTqu5GL6rr54+V9Dg4XnBgXELZjZriqngElhxEXg4Hr0aMy+cN/2pVCbKmwlNVed6KKviboDamM/Os8R4ca48UO1LwN8rfNNibMg6QO8y6z25W766ZQhvvsfAotwnw0cCPE8ohZ1M19ba9RTy3Ug5dQBIw1fJIMuDoMfaThlURjF8vdG/rnw4gzRZ0PGmfJ590yBNHJhtt4tGSHUCONBwhDBCPkI0AjqCOAI+AHyAbQB4AjIAGyA8SR9KOAA4QBpAHAWODxms776P7bXMrvGBw9WhkeAscb9EX7wTXu/Jr3ik8fFpzlA6RVntnoOU/OyCMlBuqArc/CpMm6o3Bjvkp9+BdQz9p/Jl3fPdkx+E9O0rNUJ2orcqsoTMhwVua7QmAEcPk+HxKJ5TDYol0Sjk8E8/FarQcICwgoQ2UgyelmGX1eZGmb2sDyAuRDBoL0J45Zddxes8H5mnAYMndBjM7SjywGDRAGgsYDpAGkAnAIGAg9AlxgHEAeICQQAzl80rxWE8xwMbLc5CLTOi0qP4nrgcPGOICz/rasPvddUlewNabfyfog9K7QmXnR5ldLDVIvEUUqR9t3rEOgwMlWvTCtVZT9SHxU4O9fb7sj8PxqDrAjVbuY9WVj2jQorACCZaFvLPSqPEis3fpZHiDcthVG3rKISeAY7gcRn2zcLlKOYaru9CWZv9pAdh/+DewE1K9jILtTPbEo2M65Hw8ep6O7joKOkA6AjoKfoR0UMjxHyOS5IT+d7BeP8TvmK8HsB5XkY68EWndXVy96Xx6H2hxeVnW9hav9Rwc7zEi++qs41XKTy7gWFXA30ok+Napfhf2TBG/rRYKYAXDD4jvIN5IvtP4DvJDg30AOnoaJM6RGlek406rsfQiB2VETVyaQ+FJFtDEKZqHdbNgby6HKtQDL40XpEI5lEod0mef9laHnMVza+OG3FLsLYK8BJCpYEkGPAvKDj8o03T0KR91nBIGH5X9aGYHSiOFI4QjpAPIMdJnpRpFImQmR8RITzq59BGnQRgf4yD7eQTQF6pCzRJAl14tfscJ64ZzLZKo6hVepkHqK6u0SpaTIvu5RV1Jh2+D4/XokUtq4JXoEfPrlz6B2ljB+wyIeINY6o8VKFEB8Ue5/hPgG4gfIH7WrjeMPwG8H16fDvvf38TSfcZCvduiRrj2VqoCngIUU6lJaiAsX+hkd99ri0wLi0rGkDkDoxmTyzYPCQAfEniY4ENnhV6637WTvcxKtihyA8iVdfjXDGXN7T0SNML2Non8lMs854E+JAgGcCincisgsgBARofaQCWI6ew+PTiiXpddract0m2WQeJaY7JFYwAxagSSptlOrB9U7529Cs+8DLVLXuKc3LjmTWuVA8g9yD2APaChhSc4bcqcyqytRJb31ijXujGXGzK50QCln3L9LDTBt6bLCP8RIz6oVMEy0tPMtspjUPQfY0DczT7pONYBbHOHm0HV0be4DKq6EGq2Kop0NywVzDEzanJ0soejA4PNJz7TiXhu7mTOLGqcRfvRpGj8TA4kgx0AEzANtkpG2GBwA8gHMzWGN3ayIPUbIxJIzPjUp78refaU3JO7zKCBgsV7ZwI4BFjIACVAKSLHiCzZgBEJ1Bg1SSUJicYR8AGw3dVUmVgfAm9KE5ogHYv81iel4H6H104uKtkZkiTl0ryYWgtbqHYRtUyQy8FlAeTcw7gH+AzwFeALyCcQewDDdeuGK1Ei76k13tGQYetUf0D+U1Fv/H0xx+h6E/QDrh9w/xHRZXEYRBkUlxqLRmUwnEN6d/BTxEQA9OBD2+SYdgYZYHUWsSspFJ3Qs8idLuQhIs90dBzGVKLO2dyItVZYT3onI1DMGcAAR0SiTfCi/jl3KA3wByiH2jrZG0Cuptjf9pF6LJolpYa0t6zJP3VUgmsgMDD0ACvoDaIOhA0tfa7ptXAAkQQNEAZSR8A+y30MwqCsAw0DTLHttFmzLGkt/a4jXfPC3vgJ11sHDB+QH1EiGwUYTp2fDjplovnZGq9czqAWDTQ8AfYMyGFGgAYpomdjKscoF2lhjVz6aPLOmirvUe9ZRpEO4VDYMT/lTQn8Z2nKvKt0sQtjpjBlqiJ47WZjBkjgJ4kfMLzJcFBKGR5eB5wETwabMrDfwQ1IXVNr1k9WSSQc6shT5mU0x4poRerg6UR9aEE5vFCFRU0iFpRDL51smymHuEQ55Jcac9v6Z4kgB1sAUJy5rSqoCHtOBA5yHwAfIA2CDoRGQEeAB0BjRJI4SBjoOoA+QBzhPIJIcR0DoAMMQzRrcAA4wnEAtUcvaHi6w57vvI4A65n2xtaJrV3ZrAakcrhrBlZ1zyx0JmRepoIMxJPAEZBTRZ0I6iTdpBq+8bS5dNpx1u365FVw7G+z9n1lQMezUZ0yjlOYMe9AU+uZARKa02vgJ4g3gIVVo59I9gboE9PkTLtSqiPoGT6OSJ8HCPsyilNqf2ym6K3eSHZ+MKWTfUo5dLsAfxdcDufMogfXQjms2pB7BKMmd5TD2lnvKIdq8nnb4PgGkGsRi1tzf8NaFjvQkXDIP6fRjuloKR1gNpZ0NhoujkNJsweYjoKOhB0hHICIsiR8Ej6AVuYkIxKNmUgNBWCHs3BKOrtetFRj+Jkh66+Z8fEB4gPSm6KbPgNffX/qxsNVwdFP7Wn34cwIsdjeloPSu6ZNGSDpEO4kCsc1Pch7ZiIv39cBHIoXTAXEt9aAKWM9wZrBO+roDvGjCEzUBs0PkOUEwzfQfmiwt2k3fI5vH4Ln9kLUWCvBhAGii131GC9mqDZ/f32jZihA6olItenTzaxSpXBDCwZr525I96h5rlIOUTrZCePxABXKYYXTnnJYB9pZ/G62tQHkCUAuR1eYYoSbsye2IOT8Nh3S5KOmHLONZCIYg+J1OFyqTZjobMfnM0I6lo72saTfE9i0I48gpjjgpbMuBMtZ3xcQfmwK1+UnAySrVcA7xA9An6hOjcX7W65KqSmhTGgVBTi2sGSAcQToJIv/d/sZYVGUJcLkjFgR/+UFtYpbNcdbne2aVhd6YIkANfOq39rMY40U222In8TP0s0uQFnGfKSfID60Hw4AhcHiG+v/fKfAba6QFzOfy8EkziiHmC0Q5OXrLN1vy8GdTodZPJeLv1XnIXPX2C5D6ClB2ZuJV6UcIntQDocl5bBXUfPVD3aLHjeAPN0tdqUx05lWRZBVSPwl1dZOx3z0Q8p5sJSOlEZAJRpkoRKiCueWmh+DfghGk4Q2FXAs98FEFn62MJXmzrr4I5u69CR5HVWpcv9lmLnS6BCG9q4PSBnRVS3FS69SMdXb+6SqxRhqJ6NSujh+OrfHCq88rYrdYsTgJEU8bbZqmZYT551qFF510P/CnnUxyhOGWZFye40UP0paHXxqcjbZCguFNyS+6+ifcDmSNWYMWh2v/J4DGC1neLJS/zuRsOsGBqwCZG3ANMqhIU3RtOGHN8qhRNA6Xn1/7llQDlvTO1L7QjnksbB5Unqw7bI1ajaAPEt/xjib+orlaOXFZgmkO3zyacpMadKQJqoAG1QUyDFVdXEBmVGnm4qyT1XyqeCYQWQFMB5Zt0F2rrPYdtpJ0EfxPnmr3imK0ZYPyD/g+pD0AffPApClm918vxEeOt6n2HMySFlMIDW8U/vXW+vx3CTgOjhqCXr3oOip8Va8+ENT1AHepeoRow4gUeuRc+RYa47Ez8Ke+YFasyR/YkhvMBx4cEd2YEgxYkOGBnJKc+/JVTrZGXkYI62t84lpSTmsqkmt2VLFcwvlMGXH8ckWlMP60bI1as6jb0qXe1maTbxmyiHOND82yuEGkDeXuoo/JMC9zEWWSwWKRAeR8zRNtJQ5DBMteYyX20RoghjRYWhEltEbjiFcoQmOCYYMx7HIo0XKHduPEAdQyyhyBjCH/Aj3zwAJHOI6jnAcIP8soy7zBfgEkeGiFh1s1zzis5CwHnFufUsYCGOxsS0lx4U/1q+6D14Ax6VKei7g+BOuH6pzi637rJ9FiOJHAcffw6O6Ct2q8KvrAHi5zfAG4kNDOgRGZKA0OVSEJeABmDV6s5zhYwCk2DdqOhGQEjGq6Yp1e1wG8o5RyzwI+jLlcAY+Wkc5ZEifcQfkZEhZpY7pG+VwA8gHAfJjmsGwP6MaYh6y7vxGgD5pOh5Rx2ZQABA6llriLrZzQti6TwxFn7HcfpRwJNsYUKTmWGyfAI1L5BAgHBWNoUMwRQIAJX0A/gHwE/JP1RSy1iIhL2XIiALdl+5VLK0AcQfaGKM8wMyjYU2t48JWo43Kvp0i3cnrfuj44xJAa70xhtirXNnvcP8x0wabX8xPQFGLDL717xB+LzXKSiX8CeB3CD9g/ImU3ny0I4UJU1HVMQDZ54jKDJxyeTcsTRBH3o8Y8zHuZ5hZLJojyNZUOzFSYxHPdSt0pVKTpE4LFbPLYSCgt1vYpM/KEHpJgpL3LodRpxwOEzSkGX85C2pYBXP55nK4AeTKymVEpR4cNVA6H1sRyMxRUUfMPinrSOoIV+hDUtGYCWm0yr3eYeZi95exu89A4oiafsfn2u+lh9AtxGLGr4i+Ric7+MY/Cbwp0swfxcY0NxLbPPtYjr5m1r2DcZg1/1mSLgOMmgGSABm+3/H4akaW1hHwktzPnQrgdXB9LikEt1repchebA/0ozVq4vI7gN9Lal3qjfoB8HcQP0F+YLCJoGTBSHEi6tFTLko8hTSg6SS99VIWDgBzsxhwXH8PbVMbxVE03dyIVBsuAzEUyuEseTajpWNp4qUTERMDka1SDg3M8R7yYOBneW8tID2hHK4IaG5rA8gIlHbDuRDDSgBED7NM7McJH9MROY+Y8hGDHeE8MJWONVrqXDrWOrYmTnVFjJbk1KJOICwboqFTHRRTY8nUCGhWtn6H8NbAEDPfWHNkVTyclVXVc+WnHRmV1zy07nR0q3P3OryAoXfujj43bOgPCWFcGxi3xWs71uaJvNNndMwzjkABxTLb6K1J86PMQv5YcK6JMNUCPpDdgx6IODlWsLESqVWhh3RBtrw0biog1fT2EuWw8amLTmdQDuMNh4kXMR6LFlTLm7UQzwVzVxuO59eYutGdSjlEa9R42iiHG0D+ykp2BoS1P8PTZoERGpn96Ee6T0l5gg8ZVtTD59pjdKZh4UnjPsGsNHSaN01YNsiatazMQ8k8ut+pdLc/AH9XE3rFB1zvUjG5b+rX+igp+EfUH3UohvdBG3QthsPLAVMc6QvQRZLnnD28Z7/vGRgdzdq2ejTyel62EAe/aVZWxSaqNFk1yXqfU+ei0hP1xbkO2TNoajodohPxeOOHxnTgMftcuuCi9qdSYaAXsKqpfp07VKnzlREfmzKmfWqUQxWAPKMcVt58bb64kAtBNWUVyuFUSsGCnKX6cVKH7CJHypdVyp5y6EByx1Q72Xf0XjbK4QaQ50FL7vt4Xe2rCH7Hzt6lhYmuwbI+pknZM7JPNGVQM0gCAXJh3jXBLFPdOI8x6pOzp3ZElsIkKJNe/G5wAPSpaL58QvqE+6GrRZbtOAj6BPDZcbIPAA6Kn3O9Mfo0zpD82UXdlLk5MJJFqIIdOCqHg6NUPL8FFnYO6Lfw8TprZsGn9tnKAL8rao0/Oz71T0F1249gyhTmzMJjBm+AfofxB8AfSPah/XBQknOSN+pdEZeNHcFQI0oC0OTBISqdbBR+c2tnucOHGPUBh0hXq/oQTymHkR7n7sSQPGorbVzoaR2e5k725Q+1dZ87yiERjRokwJv02brLITfK4QaQF49dCwHTFimw7uhrgU6Zud7R/ZOZk6Y0eFbyicaSNndAozrmozmKpAplD1O5Tx0Uz+Wxk4BjKZfPHWvUDjU+55/4LKM+8wXNV6WaS310w+KuSPEowwhYIpBnsAt/bzFUfCgKJhUQDNAUlja31bwsuu+PpdTz6E6uYhOaVXZ+j1qjfkgFNGv6XKLIOWLELFVGVJCs4PgOw6RkChHG3Im4FWfAEjkyR9SIMmyNrlGD0ghplMPs8GFAOh6j4dJRDtFFczEwXoyra6m2mnjBADPYMV7TLcqhmnJT9yF3lMO54VKAfsJMOZxCZGONctgAeKMcbgB5tvvt0gUFLp1V2VvzZs+MT59wKPau7i63ifQsWKZhAkszh8yQjiJHBqOmzDsiSzoyxnxi7CduOzanGLX6Y+vUqgLBzDn+0Qm+/ixMkd9jkBo/QHyUlBjK2RESgns4ExjIyVpjnIfAvTRswtHRTrbV6DLKZd7Cpjlpn+UGaxf3koxZiAp/FKGJ9yYiESD4e0mr3zuLhBjVAWJ+EfwJlt/lbyCjeUP8REqf8d69dXx7Be7WZVbt/Hp8LAUgiVLXMwOmYwMmGcFjSbFr57qnHPqVWsMFyqF5NGpS73K4VLmbO+Id5dDkcFoTz50ph1ZMvKKTzUOGRps79AvKYc2hNsrhBpBn3cWVUZQKhqdSU01CUcIuTZ6niXk6YmIAHYYcpl08wD0sF5SGYtwVHWvHAEMRy2W1Ykhh5KVqYwdUybKQH/sA8KNZlM4Uux+dkX0Flx+ztmGZDXSflCfAS1ods5klnGqgV2uKGVBudUir21BMySxHw6bVJ+N1XhAP77FzRtCYHyifyRukH/LOWjXkx36H63dVemDxse7UeCqVcAZM4A3UTyR+Kg1HTkVBApESR/eim0usxmaOiK5qt9oIHLzR9Joobi803I9ZqzZqfNEpPqUckieUQy9RI1kA0pA+Qhl80divDl2wEuTPlEPUIfaMVcohFaUASk3xeKMcbgD5QIrNfuZuPhBUpmLWbVLlO8uY0oGTUsqeYNmC2yVKSkQTzo04qyFumzCMU7Xq3krCdSyUippuF1TGISJJ/WTzbW6c4zcFYLzP+ocxHK1Cs5PxSNIElY51bbjAyRK5ogAhkUurqgNA5jbqE6XZHC3WmadNzpI+yz7MWdpddSc/K+BJ/vv/2t7V9cax5cYiT/eMfDfJBkHy/39dkJcAC3sszUf3YeWBPB89GvlugnvzsixA8FiS7RlrupqHxSoGoU9rEXgZ/cZpZ4yP7rz3XTKNJBUfUL1S+BDSq96m/hrGnOvsG+///08/fx2WQizq5Bk/iIPlMAQZ3Q22SI899g7F85bDIFLRbjlUA+oSBBmWwxNdPe9LvCbLoak6TwLDclgNWF5ZDj1nSo1DqPmFhvZKrkkkQaKPBxq+3hkt4ndpUUDj11Iql+2G6wZsFsPmpqDGEmThRIQa/R7x012vKoxN4TR7+GUaPcpYfTDNDm9xzLyOAAbeYjD6NoQMu4K80uwGq1cAV57XTXZZoVKc5NQAWAx7N8NwRVs3JTEjOX+dJPr8Y1MT/HXKU8P2FytZW0TbdeyLsZhZ7MnfXlG2FastqWfYBb1iVLkA+BDgnaVcAdxRZIeFVfATC0xZHLOzZc4vKuLVZMt3rwasxas+CcIs2v8az3Ms0Lqjrs1y2KyJOinZrfrjYYhcjdjFe+DLbth+myyHc4RjE2qeHTXyYn/kcyfD3HJobfaxizKvCsW0HCZBPl83ez0SoQioJVw0BZzdNNPFRhJyWkxE7/W6sWzWqMT85h9bjdkrEvd5kQS15+cEBT4AKiXcLl5hHYePSAuXzS1UaxdlYnNfe0yzCKkIoixyExoJlilwAuI9xzbw7aM6GiM77NXiUAlcufavuSjQxoIYqvgUCnm4+jgJUN4q8JCJUKLtfQgyuLIn8OAC8scQXPARARN+/FZXp+23012u24baQziexItJkCEH2fW5HnbxhdpixIIhnx01Zu5IibOqVvtsOexHW/RVsEP2OFoO2xIvqleQVHmhVj/VeS+Ku5nUDpZDhPC0ArUULO21Vet/UbcKpOUwCfLl225Z/UijGsO4+qnv+Kqq7BfVIrWe17vKJrRKmAxnTjteGemOFJVICFKhRWQLbiB9tUGM4ThB0qZ8xpb0TQA76eM/MPuA8RKpPje2QWnwHcL3el5udtLtdDMxKEEbA96zfRBzlYgh3LSESM+FRA+s8IO2QKWZjeWT88gvvBrq+w3Ala5EX7oThu33/MlWKbog03qNP4AgSeEVIu/xcbWl3Ki6q6o3NHaO2Ju+2AqHRO3WK8Qs1Ng0ky8K2A6WEGr2I0Fir2OHdRChnRec6uNoOayfhKjPwjBjDKeF58aXrUgfu+F0j2qWQ0YfclgO4zXE0bptOSzmHm/Z/a3HpUDuD1hZnDw5LIe+uoHdcpijPkmQk4r99kSA/GX7hc9dGnomOJflbtedhUZYrVAYqfTVWVJBMRh9pKZWUmSL0KuWzK2hKVaANxg2F0u8XoWItbWzMGwC3tiO24Ir4Z5sAW5U3MWw72fd67nwdDcV9ZyJXoeQU1+UfuXFDhoRicfxIVLiPFdi1YL0ZWQq/v3H814kfbvy3N0ubXwn5htjedYlfNM/ew/Sj9Q/AX73X+VdRK4+siMPQva6ngiaB9c+Dft3IWR2kUQMJosc2ojHcFrpfTyoeGgFJ6FmJo0DmYzB8e40AL+wHHJYDqOK9C2HEtmQ7qhheTr+t2AgUShsshzGjKYWYJ8sh5t1JbtZGeX6dAOLYzf06bzyOccu8Q/bg/zFnZJPup6EAaU/ji/6amOpOJW7VewKbKA9hHaVqu9c8AbRM0ROEC7i1sNCgRn4gKAKpIrRKKgg7lTuVLGISNtgMAEqBcYTSBEDsSuxoaJSQVsLuVU73WEQwXo3qBd7AmGBShEnQlfRPWjCfy+d6BQaBDk+BCoqUAmCDEIUFVXt1xRaxWi3WHz1AzWGvSPxuy/OQh/2bip080239O8LIBcUuXBd7lyXB24P27XgZEatFbUUoO5dRBlhYd7K9dZGWAaDxA5K+izUEE60XagJD3azHKq+Prq3SqwarCnXk4BztBxOS7xCQW/ZkKu45dBWgdyj1/nKctie+7TCQo2oImN0pz0/lUmo0S/lmEQS5K858unN0lVGweFeKl+pfu34pGImYjBUtfrx+Ouy1DeV8w+LQCtTCtRUhQUGwSaGXSopoNgqShGiyGZCEwK607VlFewnH1zU4tPc2OkFSVwoPBV3FN5DXTVC72yySqvyIomik2OrFqNtJfPnYqshopJEGStrpUh77K2BD4A3GtwSSbuA/N5aAGOZFhpBjrEl4OLH6e6Z/gmRDyzLhwgeti7GtxXl+hjzgI0IdgKrfp5vfnXfo40fpE7HAE6WQ5Wj5bDGUgyVrkuN+HlfvcBSUMywLQqW2HLYwiAOlsMnJZuecWGL/7taif1cAO5dqHm2HPZcyTajo3EzkC8shxzP0eaAi5eNzPlhUmcSJHx2bEQPEvKLa4y/w7JT0opJBfZvpW7/suB8uaOqop78QrKpiJmb7BYXZ7t4ugVMSDH67pwWEdFOzO1ardPOZSVsWfvFqY9NYaZh5ShRUpW2Lwf49DF2eRMFisXX14qvtKX4LKeKq9KMpCGzdxg+YHyH2QXghd5vfA8xZqxCYFuLwAtELhBcAPmA4Iql3LmWh/37P9vyX9/pA9xy3H562CLYKj4OkjN87vtZOwoH6cgQasYbQnr1JxKWw1PshVF30HBZRkFYrYfn4rxENJm0UKRPlkNBHNnj2at5cjJVvILU1yM2Q8l+rvtGn/Ol5TDeG1jgA+M2hWZgCDTWyBXyxShC4h+SIFfhJ/L7P7enZYQSUIH1suP2b+sYreDrcpWRUi3H5MBR6XzlzJBXcfxAXRcnWLe9KSoH8am2x4uvbVUF4NWg+lEbbX2tf659X/HSSAjVHYKrLweLY7XZO5vNUXiF4gcMPwD8iNTuadCbF0gE2raUndPyjmp3nIuhokZuJbAUSBvbKXGEfCJIXy/g7pZP7ZMuOERKz3xE/sJyqHv07GbLoWpXgH3PY/Qhd4O9LVgeDxBvo1+5W6/WPlsOx/NTa1sOFcqwHJZZ5JmbkOwC07PlUF5ZDs3XDckOyJuH5667jVbCZDls/09Hy2EiRZo/thzt7zuKYLmbX5fFL7rf5dev9CF5+vqwUhxegZi5lxiGcucQwQmgLCJFWzJ4FLzhq9CwGWqp0wykQWQXwQbRe5TYG0R/Ts/Jwn5yR5EPMdypvIPyAcN3KP8mJt+hbcOgfGDRd8B+Anpl0TvWcofIXv/jX/fyn/9NOStwoxNM9Tgv2asfWZcC2W2IHOY3I4ldLNhqDzzvQk3zWE+OGivlF5ZDBWzzJZMHyyE+Ww7Fd1tX1ch5xPD1/96baxKODpZDErUIFmMfJejH85jR9JavHSyHQLh5wmreXjeLTEJNgT521LX45kMMy6HJk0STFWQS5J8KAXQjJOL1deexx8OD+vMkVeJpNUFcwMaRTwgee00x2lKqoLxXsEjkGRZj0U0hdxRViBYAqhJVZJ+BkeqhGSKxfOzDY6tbD5LFa1R7RJL61lPVgQcgV4CbgBvBW/ijf2DVd+pyheABq5vsVqnrg0UqBGQp3j7YK3BagccDKAWyAdirE+SHzxxy8WAHU0GJ3poVhVY77jfvQkbbRTCtJujOmaiedAgm3ntUHFZJWFgO8cJy+LzE0ax7sjvxfmU5bCERfLIc7m45xM1dPAfLYQ+tkGPLtVWLbW9OO8Yz5h73seXwuGsd3XKIlG+SIP8/SLG3hMSDC8rdUM+C9d2DA+bj0fNBRuaRPBkdJxeMpy13h0GMoYwKFpSq4D+th0xCCDZ5e3vH9e6rIlQegNwiJ/HUeosCFgrWMQYpTvEiuwA7jBU0Tz5XqVQxz7zEQ8gHRYzW9kxpRdG7lWXzz1TI3cTKAn77jVIfwOMeJ/wgw/MJ8uMGfIs9zlsFz6u/4r3C1oLCR8SGEQrDJotXmqclqJ5jsL/aMB+Hkv3Zcng8wf7SctjCLvhiy2FUk7YoqNUPExyTjJhWkwvaCE6zHPp4jy/xIrZVIB8Vgs+WQ4G5UDO3VVQh+94th4XA3m6ecap3JVv+l5bDRBLkH6/6RNq0Xz/lWrF/8/FGCcVSnm7iLUdwVIife0DsjXrBPPHB3oeU+HFwJHPP1slS9kjeeUDlHYIikMWrRHfVmKgRpkrxIXbFAyoGwmBEPa9ENUqt7DtppqdoywKaQR97PAeOPSo+s+clU/WAhd4BEIFsO/i2An+zsfpiq+Bfzi6YVAPfTsOhMis0babv7zkWPlsOD5+fxmPMWyMC+HF/Le6FboPZZTlYDlkKyl7dctiFmhgRmpRsQkevr/chg9BCqHmc9XjT5bGC/Luqu2fLYcuGjNxLfrUZsSf7JJIg/4SGpr/xgrgUWD4qHn9dQd1iWZN6ehifK85hESZfVKXyC7HmUAJ98bzMIKoGFdJtP9N2Kb9eawxc624vpXxfAuVN//CAHKJ6JBTduTqW6SYAVU90a1sCp2Oo7BX2l2/HP7jXQx7jc0jnEGqmER3j1JrAi7nFZ8thzOabQYovAmeJf09jT1FkQTpxayjZ6NKvVoOd/PhPOY9tiC8sh17sz8/JCbJbDreIO/tqkSEm0n1auCvTCaVbDsMB6q4dwBbFEq0A1OEzbJkYmlfxH3uoZFqSEolE4ssDZSKRSCSSIBOJRCIJMpFIJJIgE4lEIgkykUgkkiATiUQiCTKRSCSSIBOJRCIJMpFIJJIgE4lEIgkykUgkkiATiUQikQSZSCQSSZCJRCKRBJlIJBJJkIlEIpEEmUgkEkmQiUQikQSZSCQSSZCJRCKRBJlIJBJJkIlEIpEEmUgkEokkyEQikUiCTCQSiSTIRCKRSIJMJBKJJMhEIpFIgkwkEokkyEQikUiCTCQSiSTIRCKRSIJMJBKJJMhEIpFIJEEmEolEEmQikUgkQSYSiUQSZCKRSPzZ+B+GrlwhibMxxQAAAABJRU5ErkJggg==&quot;</span>;<br><br>function Sakura(x<span class="hljs-punctuation">,</span> y<span class="hljs-punctuation">,</span> s<span class="hljs-punctuation">,</span> r<span class="hljs-punctuation">,</span> fn) <span class="hljs-punctuation">&#123;</span><br>    this.x = x;<br>    this.y = y;<br>    this.s = s;<br>    this.r = r;<br>    this.fn = fn;<br><span class="hljs-punctuation">&#125;</span><br>Sakura.prototype.draw = function (cxt) <span class="hljs-punctuation">&#123;</span><br>    cxt.save();<br>    var xc = <span class="hljs-number">40</span> * this.s / <span class="hljs-number">4</span>;<br>    cxt.translate(this.x<span class="hljs-punctuation">,</span> this.y);<br>    cxt.rotate(this.r);<br>    cxt.drawImage(img<span class="hljs-punctuation">,</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-number">40</span> * this.s<span class="hljs-punctuation">,</span> <span class="hljs-number">40</span> * this.s)<br>    cxt.restore();<br><span class="hljs-punctuation">&#125;</span><br>Sakura.prototype.update = function () <span class="hljs-punctuation">&#123;</span><br>    this.x = this.fn.x(this.x<span class="hljs-punctuation">,</span> this.y);<br>    this.y = this.fn.y(this.y<span class="hljs-punctuation">,</span> this.y);<br>    this.r = this.fn.r(this.r);<br>    if (this.x &gt; window.innerWidth || this.x &lt; <span class="hljs-number">0</span> || this.y &gt; window.innerHeight || this.y &lt; <span class="hljs-number">0</span>) <span class="hljs-punctuation">&#123;</span><br>        this.r = getRandom(&#x27;fnr&#x27;);<br>        if (Math.random() &gt; <span class="hljs-number">0.4</span>) <span class="hljs-punctuation">&#123;</span><br>            this.x = getRandom(&#x27;x&#x27;);<br>            this.y = <span class="hljs-number">0</span>;<br>            this.s = getRandom(&#x27;s&#x27;);<br>            this.r = getRandom(&#x27;r&#x27;);<br>        <span class="hljs-punctuation">&#125;</span> else <span class="hljs-punctuation">&#123;</span><br>            this.x = window.innerWidth;<br>            this.y = getRandom(&#x27;y&#x27;);<br>            this.s = getRandom(&#x27;s&#x27;);<br>            this.r = getRandom(&#x27;r&#x27;);<br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br>SakuraList = function () <span class="hljs-punctuation">&#123;</span><br>    this.list = <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span>;<br><span class="hljs-punctuation">&#125;</span><br>SakuraList.prototype.push = function (sakura) <span class="hljs-punctuation">&#123;</span><br>    this.list.push(sakura);<br><span class="hljs-punctuation">&#125;</span><br>SakuraList.prototype.update = function () <span class="hljs-punctuation">&#123;</span><br>    for (var i = <span class="hljs-number">0</span><span class="hljs-punctuation">,</span> len = this.list.length; i &lt; len; i++) <span class="hljs-punctuation">&#123;</span><br>        this.list<span class="hljs-punctuation">[</span>i<span class="hljs-punctuation">]</span>.update();<br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br>SakuraList.prototype.draw = function (cxt) <span class="hljs-punctuation">&#123;</span><br>    for (var i = <span class="hljs-number">0</span><span class="hljs-punctuation">,</span> len = this.list.length; i &lt; len; i++) <span class="hljs-punctuation">&#123;</span><br>        this.list<span class="hljs-punctuation">[</span>i<span class="hljs-punctuation">]</span>.draw(cxt);<br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br>SakuraList.prototype.get = function (i) <span class="hljs-punctuation">&#123;</span><br>    return this.list<span class="hljs-punctuation">[</span>i<span class="hljs-punctuation">]</span>;<br><span class="hljs-punctuation">&#125;</span><br>SakuraList.prototype.size = function () <span class="hljs-punctuation">&#123;</span><br>    return this.list.length;<br><span class="hljs-punctuation">&#125;</span><br><br>function getRandom(option) <span class="hljs-punctuation">&#123;</span><br>    var ret<span class="hljs-punctuation">,</span> random;<br>    switch (option) <span class="hljs-punctuation">&#123;</span><br>        case &#x27;x&#x27;<span class="hljs-punctuation">:</span><br>            ret = Math.random() * window.innerWidth;<br>            break;<br>        case &#x27;y&#x27;<span class="hljs-punctuation">:</span><br>            ret = Math.random() * window.innerHeight;<br>            break;<br>        case &#x27;s&#x27;<span class="hljs-punctuation">:</span><br>            ret = Math.random();<br>            break;<br>        case &#x27;r&#x27;<span class="hljs-punctuation">:</span><br>            ret = Math.random() * <span class="hljs-number">6</span>;<br>            break;<br>        case &#x27;fnx&#x27;<span class="hljs-punctuation">:</span><br>            random = <span class="hljs-number">-0.5</span> + Math.random() * <span class="hljs-number">1</span>;<br>            ret = function (x<span class="hljs-punctuation">,</span> y) <span class="hljs-punctuation">&#123;</span><br>                return x + <span class="hljs-number">0.5</span> * random - <span class="hljs-number">1.7</span>;<br>            <span class="hljs-punctuation">&#125;</span>;<br>            break;<br>        case &#x27;fny&#x27;<span class="hljs-punctuation">:</span><br>            random = <span class="hljs-number">1.5</span> + Math.random() * <span class="hljs-number">0.7</span><br>            ret = function (x<span class="hljs-punctuation">,</span> y) <span class="hljs-punctuation">&#123;</span><br>                return y + random;<br>            <span class="hljs-punctuation">&#125;</span>;<br>            break;<br>        case &#x27;fnr&#x27;<span class="hljs-punctuation">:</span><br>            random = Math.random() * <span class="hljs-number">0.03</span>;<br>            ret = function (r) <span class="hljs-punctuation">&#123;</span><br>                return r + random;<br>            <span class="hljs-punctuation">&#125;</span>;<br>            break;<br>    <span class="hljs-punctuation">&#125;</span><br>    return ret;<br><span class="hljs-punctuation">&#125;</span><br><br>function startSakura() <span class="hljs-punctuation">&#123;</span><br>    requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame || window.oRequestAnimationFrame;<br>    var canvas = document.createElement(&#x27;canvas&#x27;)<span class="hljs-punctuation">,</span><br>        cxt;<br>    staticx = <span class="hljs-literal"><span class="hljs-keyword">true</span></span>;<br>    canvas.height = window.innerHeight;<br>    canvas.width = window.innerWidth;<br>    canvas.setAttribute(&#x27;style&#x27;<span class="hljs-punctuation">,</span> &#x27;position<span class="hljs-punctuation">:</span> fixed;left<span class="hljs-punctuation">:</span> <span class="hljs-number">0</span>;top<span class="hljs-punctuation">:</span> <span class="hljs-number">0</span>;pointer-events<span class="hljs-punctuation">:</span> none;&#x27;);<br>    canvas.setAttribute(&#x27;id&#x27;<span class="hljs-punctuation">,</span> &#x27;canvas_sakura&#x27;);<br>    document.getElementsByTagName(&#x27;body&#x27;)<span class="hljs-punctuation">[</span><span class="hljs-number">0</span><span class="hljs-punctuation">]</span>.appendChild(canvas);<br>    cxt = canvas.getContext(&#x27;<span class="hljs-number">2</span>d&#x27;);<br>    var sakuraList = new SakuraList();<br>    for (var i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">50</span>; i++) <span class="hljs-punctuation">&#123;</span><br>        var sakura<span class="hljs-punctuation">,</span> randomX<span class="hljs-punctuation">,</span> randomY<span class="hljs-punctuation">,</span> randomS<span class="hljs-punctuation">,</span> randomR<span class="hljs-punctuation">,</span> randomFnx<span class="hljs-punctuation">,</span> randomFny;<br>        randomX = getRandom(&#x27;x&#x27;);<br>        randomY = getRandom(&#x27;y&#x27;);<br>        randomR = getRandom(&#x27;r&#x27;);<br>        randomS = getRandom(&#x27;s&#x27;);<br>        randomFnx = getRandom(&#x27;fnx&#x27;);<br>        randomFny = getRandom(&#x27;fny&#x27;);<br>        randomFnR = getRandom(&#x27;fnr&#x27;);<br>        sakura = new Sakura(randomX<span class="hljs-punctuation">,</span> randomY<span class="hljs-punctuation">,</span> randomS<span class="hljs-punctuation">,</span> randomR<span class="hljs-punctuation">,</span> <span class="hljs-punctuation">&#123;</span><br>            x<span class="hljs-punctuation">:</span> randomFnx<span class="hljs-punctuation">,</span><br>            y<span class="hljs-punctuation">:</span> randomFny<span class="hljs-punctuation">,</span><br>            r<span class="hljs-punctuation">:</span> randomFnR<br>        <span class="hljs-punctuation">&#125;</span>);<br>        sakura.draw(cxt);<br>        sakuraList.push(sakura);<br>    <span class="hljs-punctuation">&#125;</span><br>    stop = requestAnimationFrame(function () <span class="hljs-punctuation">&#123;</span><br>        cxt.clearRect(<span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span> canvas.width<span class="hljs-punctuation">,</span> canvas.height);<br>        sakuraList.update();<br>        sakuraList.draw(cxt);<br>        stop = requestAnimationFrame(arguments.callee);<br>    <span class="hljs-punctuation">&#125;</span>)<br><span class="hljs-punctuation">&#125;</span><br>window.onresize = function () <span class="hljs-punctuation">&#123;</span><br>    var canvasSnow = document.getElementById(&#x27;canvas_snow&#x27;);<br><span class="hljs-punctuation">&#125;</span><br>img.onload = function () <span class="hljs-punctuation">&#123;</span><br>    startSakura();<br><span class="hljs-punctuation">&#125;</span><br><br>function stopp() <span class="hljs-punctuation">&#123;</span><br>    if (staticx) <span class="hljs-punctuation">&#123;</span><br>        var child = document.getElementById(<span class="hljs-string">&quot;canvas_sakura&quot;</span>);<br>        child.parentNode.removeChild(child);<br>        window.cancelAnimationFrame(stop);<br>        staticx = <span class="hljs-literal"><span class="hljs-keyword">false</span></span>;<br>    <span class="hljs-punctuation">&#125;</span> else <span class="hljs-punctuation">&#123;</span><br>        startSakura();<br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>然后在主题配置文件_config.fluid.yml 中引入 sakura.js</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json">custom_js<span class="hljs-punctuation">:</span><br>  - /js/custom.js<br>  - /js/sakura.js<br></code></pre></td></tr></table></figure><h2 id="添加雪花落下效果"><a href="#添加雪花落下效果" class="headerlink" title="添加雪花落下效果"></a>添加雪花落下效果</h2><p>在 themes&#x2F;source&#x2F;js&#x2F;中创建 snowflake.min.js, 添加如下 js 代码</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Minified by jsDelivr using Terser v5.3.5.</span><br><span class="hljs-comment"> * Original file: /gh/EmoryHuang/BlogBeautify@1.1/snowflake.js</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files</span><br><span class="hljs-comment"> */</span><br>function snowFall(t)<span class="hljs-punctuation">&#123;</span>t=t||<span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span>this.maxFlake=t.maxFlake||<span class="hljs-number">200</span><span class="hljs-punctuation">,</span>this.flakeSize=t.flakeSize||<span class="hljs-number">10</span><span class="hljs-punctuation">,</span>this.fallSpeed=t.fallSpeed||<span class="hljs-number">1</span><span class="hljs-punctuation">&#125;</span>function snowCanvas()<span class="hljs-punctuation">&#123;</span>var t=document.createElement(<span class="hljs-string">&quot;canvas&quot;</span>);t.id=<span class="hljs-string">&quot;snowfall&quot;</span><span class="hljs-punctuation">,</span>t.width=window.innerWidth<span class="hljs-punctuation">,</span>t.height=document.body.clientHeight<span class="hljs-punctuation">,</span>t.setAttribute(<span class="hljs-string">&quot;style&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-string">&quot;position:absolute; top: 0; left: 0; z-index: 1; pointer-events: none;&quot;</span>)<span class="hljs-punctuation">,</span>document.getElementsByTagName(<span class="hljs-string">&quot;body&quot;</span>)<span class="hljs-punctuation">[</span><span class="hljs-number">0</span><span class="hljs-punctuation">]</span>.appendChild(t)<span class="hljs-punctuation">,</span>this.canvas=t<span class="hljs-punctuation">,</span>this.ctx=t.getContext(<span class="hljs-string">&quot;2d&quot;</span>)<span class="hljs-punctuation">,</span>window.onresize=function()<span class="hljs-punctuation">&#123;</span>t.width=window.innerWidth<span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">&#125;</span>function flakeMove(t<span class="hljs-punctuation">,</span>e<span class="hljs-punctuation">,</span>i<span class="hljs-punctuation">,</span>a)<span class="hljs-punctuation">&#123;</span>this.x=Math.floor(Math.random()*t)<span class="hljs-punctuation">,</span>this.y=Math.floor(Math.random()*e)<span class="hljs-punctuation">,</span>this.size=Math.random()*i+<span class="hljs-number">2</span><span class="hljs-punctuation">,</span>this.maxSize=i<span class="hljs-punctuation">,</span>this.speed=<span class="hljs-number">1</span>*Math.random()+a<span class="hljs-punctuation">,</span>this.fallSpeed=a<span class="hljs-punctuation">,</span>this.velY=this.speed<span class="hljs-punctuation">,</span>this.velX=<span class="hljs-number">0</span><span class="hljs-punctuation">,</span>this.stepSize=Math.random()/<span class="hljs-number">30</span><span class="hljs-punctuation">,</span>this.step=<span class="hljs-number">0</span><span class="hljs-punctuation">&#125;</span>function createFlakes()<span class="hljs-punctuation">&#123;</span>for(var t=this.maxFlake<span class="hljs-punctuation">,</span>e=this.flakes=<span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>i=this.canvas<span class="hljs-punctuation">,</span>a=<span class="hljs-number">0</span>;a&lt;t;a++)e.push(new flakeMove(i.width<span class="hljs-punctuation">,</span>i.height<span class="hljs-punctuation">,</span>this.flakeSize<span class="hljs-punctuation">,</span>this.fallSpeed))<span class="hljs-punctuation">&#125;</span>function drawSnow()<span class="hljs-punctuation">&#123;</span>var t=this.maxFlake<span class="hljs-punctuation">,</span>e=this.flakes;ctx=this.ctx<span class="hljs-punctuation">,</span>canvas=this.canvas<span class="hljs-punctuation">,</span>that=this<span class="hljs-punctuation">,</span>ctx.clearRect(<span class="hljs-number">0</span><span class="hljs-punctuation">,</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span>canvas.width<span class="hljs-punctuation">,</span>canvas.height);for(var i=<span class="hljs-number">0</span>;i&lt;t;i++)e<span class="hljs-punctuation">[</span>i<span class="hljs-punctuation">]</span>.update()<span class="hljs-punctuation">,</span>e<span class="hljs-punctuation">[</span>i<span class="hljs-punctuation">]</span>.render(ctx);this.loop=requestAnimationFrame((function()<span class="hljs-punctuation">&#123;</span>drawSnow.apply(that)<span class="hljs-punctuation">&#125;</span>))<span class="hljs-punctuation">&#125;</span>requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(t)<span class="hljs-punctuation">&#123;</span>setTimeout(t<span class="hljs-punctuation">,</span><span class="hljs-number">1e3</span>/<span class="hljs-number">60</span>)<span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span>cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame||window.oCancelAnimationFrame<span class="hljs-punctuation">,</span>snowFall.prototype.start=function()<span class="hljs-punctuation">&#123;</span>snowCanvas.apply(this)<span class="hljs-punctuation">,</span>createFlakes.apply(this)<span class="hljs-punctuation">,</span>drawSnow.apply(this)<span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span>flakeMove.prototype.update=function()<span class="hljs-punctuation">&#123;</span>this.x<span class="hljs-punctuation">,</span>this.y;this.velX*=<span class="hljs-number">.98</span><span class="hljs-punctuation">,</span>this.velY&lt;=this.speed&amp;&amp;(this.velY=this.speed)<span class="hljs-punctuation">,</span>this.velX+=Math.cos(this.step+=<span class="hljs-number">.05</span>)*this.stepSize<span class="hljs-punctuation">,</span>this.y+=this.velY<span class="hljs-punctuation">,</span>this.x+=this.velX<span class="hljs-punctuation">,</span>(this.x&gt;=canvas.width||this.x&lt;=<span class="hljs-number">0</span>||this.y&gt;=canvas.height||this.y&lt;=<span class="hljs-number">0</span>)&amp;&amp;this.reset(canvas.width<span class="hljs-punctuation">,</span>canvas.height)<span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span>flakeMove.prototype.reset=function(t<span class="hljs-punctuation">,</span>e)<span class="hljs-punctuation">&#123;</span>this.x=Math.floor(Math.random()*t)<span class="hljs-punctuation">,</span>this.y=<span class="hljs-number">0</span><span class="hljs-punctuation">,</span>this.size=Math.random()*this.maxSize+<span class="hljs-number">2</span><span class="hljs-punctuation">,</span>this.speed=<span class="hljs-number">1</span>*Math.random()+this.fallSpeed<span class="hljs-punctuation">,</span>this.velY=this.speed<span class="hljs-punctuation">,</span>this.velX=<span class="hljs-number">0</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span>flakeMove.prototype.render=function(t)<span class="hljs-punctuation">&#123;</span>var e=t.createRadialGradient(this.x<span class="hljs-punctuation">,</span>this.y<span class="hljs-punctuation">,</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span>this.x<span class="hljs-punctuation">,</span>this.y<span class="hljs-punctuation">,</span>this.size);e.addColorStop(<span class="hljs-number">0</span><span class="hljs-punctuation">,</span><span class="hljs-string">&quot;rgba(255, 255, 255, 0.9)&quot;</span>)<span class="hljs-punctuation">,</span>e.addColorStop(<span class="hljs-number">.5</span><span class="hljs-punctuation">,</span><span class="hljs-string">&quot;rgba(255, 255, 255, 0.5)&quot;</span>)<span class="hljs-punctuation">,</span>e.addColorStop(<span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-string">&quot;rgba(255, 255, 255, 0)&quot;</span>)<span class="hljs-punctuation">,</span>t.save()<span class="hljs-punctuation">,</span>t.fillStyle=e<span class="hljs-punctuation">,</span>t.beginPath()<span class="hljs-punctuation">,</span>t.arc(this.x<span class="hljs-punctuation">,</span>this.y<span class="hljs-punctuation">,</span>this.size<span class="hljs-punctuation">,</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><span class="hljs-number">2</span>*Math.PI)<span class="hljs-punctuation">,</span>t.fill()<span class="hljs-punctuation">,</span>t.restore()<span class="hljs-punctuation">&#125;</span>;var snow=new snowFall(<span class="hljs-punctuation">&#123;</span>maxFlake<span class="hljs-punctuation">:</span><span class="hljs-number">60</span><span class="hljs-punctuation">&#125;</span>);snow.start();<br><span class="hljs-comment">//# sourceMappingURL=/sm/9fe248e0e9f02f5f27c7ae7f473afa837c4aa47610059815224ea1320759f881.map</span><br></code></pre></td></tr></table></figure><p>然后在主题配置文件_config.fluid.yml 中引入 sakura.js</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json">custom_js<span class="hljs-punctuation">:</span><br>  - /js/custom.js<br>  # - /js/sakura.js # 樱花飘落效果<br>  - /js/snowflake.min.js # 雪花飘落效果<br></code></pre></td></tr></table></figure><p>参考:</p><ul><li><a href="https://emoryhuang.cn/blog/1729600336.html">https://emoryhuang.cn/blog/1729600336.html</a></li><li><a href="https://cloud.tencent.com/developer/article/1943699">https://cloud.tencent.com/developer/article/1943699</a></li></ul><h2 id="控制台添加字符画"><a href="#控制台添加字符画" class="headerlink" title="控制台添加字符画"></a>控制台添加字符画</h2><p>在 custom.js 中写入</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs json">Function.prototype.getMultiLine = function () <span class="hljs-punctuation">&#123;</span><br>    var lines = new String(this);<br>    lines = lines.substring(lines.indexOf(<span class="hljs-string">&quot;/*&quot;</span>) + <span class="hljs-number">3</span><span class="hljs-punctuation">,</span> lines.lastIndexOf(<span class="hljs-string">&quot;*/&quot;</span>));<br>    return lines;<br><span class="hljs-punctuation">&#125;</span><br>var string = function () <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    ____        U  ___ u    _   _    ____       U  ___ u    _   _     _  __       U  ___ u    _   _    __   __     _</span><br><span class="hljs-comment">    U |  _&quot;\ u      \/&quot;_ \/ U |&quot;|u| |  |  _&quot;\       \/&quot;_ \/ U |&quot;|u| |   |&quot;|/ /        \/&quot;_ \/ U |&quot;|u| |   \ \ / / U  /&quot;\  u</span><br><span class="hljs-comment">     \| |_) |/      | | | |  \| |\| | /| | | |      | | | |  \| |\| |   | &#x27; /         | | | |  \| |\| |    \ V /   \/ _ \/</span><br><span class="hljs-comment">      |  _ &lt;    .-,_| |_| |   | |_| | U| |_| |\ .-,_| |_| |   | |_| | U/| . \\u   .-,_| |_| |   | |_| |   U_|&quot;|_u  / ___ \</span><br><span class="hljs-comment">      |_| \_\    \_)-\___/   &lt;&lt;\___/   |____/ u  \_)-\___/   &lt;&lt;\___/    |_|\_\     \_)-\___/   &lt;&lt;\___/      |_|   /_/   \_\</span><br><span class="hljs-comment">      //   \\_        \\    (__) )(     |||_          \\    (__) )(   ,-,&gt;&gt; \\,-.       \\    (__) )(   .-,//|(_   \\    &gt;&gt;</span><br><span class="hljs-comment">     (__)  (__)      (__)       (__)   (__)_)        (__)       (__)   \.)   (_/       (__)       (__)   \_) (__) (__)  (__)</span><br><span class="hljs-comment">    */</span><br><span class="hljs-punctuation">&#125;</span><br>window.console.log(string.getMultiLine());<br></code></pre></td></tr></table></figure><p>实现效果:<br><img src="/assets/c4d81641feac4d1bae51050833628bf8.png"><br>参考:</p><ul><li>字符画生成 <a href="http://patorjk.com/software/taag/">http://patorjk.com/software/taag/</a></li><li>字符画的写入 <a href="https://blog.51cto.com/u_15127657/4125297">https://blog.51cto.com/u_15127657&#x2F;4125297</a></li></ul><h2 id="在评论区中配置其他的表情包"><a href="#在评论区中配置其他的表情包" class="headerlink" title="在评论区中配置其他的表情包"></a>在评论区中配置其他的表情包</h2><p>采用的cdn是<a href="https://valinecdn.bili33.top/Tieba-New">https://valinecdn.bili33.top/Tieba-New</a><br>要想显示图片就得完整的拼接好图片的路径</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">emojiCDN:</span> https:<span class="hljs-comment">//valinecdn.bili33.top/</span><br><span class="hljs-symbol">emojiMaps:</span><br>  Tieba-New2: Tieba-New/image_emoticon.png<br></code></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">emojiCDN: https:<span class="hljs-regexp">//</span>valinecdn.bili33.top<br>emojiMaps:<br>  Tieba-New2: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon.png<br></code></pre></td></tr></table></figure><p><img src="https://valinecdn.bili33.top/Tieba-New/image_emoticon.png"></p><p>以上两种都可以, 都可以将表情包路径正常拼接出来</p><p>完整代码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-attr">valine</span>:<br>  <span class="hljs-attr">appId</span>: <span class="hljs-title class_">Haq24NRgHl4QheEi7</span>oVqtAsM-gzGzoHsz<br>  <span class="hljs-attr">appKey</span>: kGbxzGaSiqqlFPxg24Tk3dVN<br>  <span class="hljs-attr">path</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">pathname</span><br>  <span class="hljs-attr">placeholder</span>: <span class="hljs-string">&#x27;来都来了, 不留下点啥吗?&#x27;</span><br>  <span class="hljs-attr">avatar</span>: <span class="hljs-string">&#x27;retro&#x27;</span><br>  <span class="hljs-attr">meta</span>: [<span class="hljs-string">&#x27;nick&#x27;</span>, <span class="hljs-string">&#x27;mail&#x27;</span>, <span class="hljs-string">&#x27;link&#x27;</span>]<br>  <span class="hljs-attr">requiredFields</span>: [<span class="hljs-string">&#x27;nick&#x27;</span>, <span class="hljs-string">&#x27;mail&#x27;</span>]<br>  <span class="hljs-attr">pageSize</span>: <span class="hljs-number">10</span><br>  <span class="hljs-attr">lang</span>: <span class="hljs-string">&#x27;zh-CN&#x27;</span><br>  <span class="hljs-attr">highlight</span>: <span class="hljs-literal">false</span><br>  <span class="hljs-attr">recordIP</span>: <span class="hljs-literal">true</span><br>  <span class="hljs-attr">serverURLs</span>: <span class="hljs-string">&#x27;&#x27;</span><br>  <span class="hljs-attr">emojiCDN</span>: <span class="hljs-attr">https</span>:<span class="hljs-comment">//valinecdn.bili33.top</span><br>  <span class="hljs-attr">emojiMaps</span>:<br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New2</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New3</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon10.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New4</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon100.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New5</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon101.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New6</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon102.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New7</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon103.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New8</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon104.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New9</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon105.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New10</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon106.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New11</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon107.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New12</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon108.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New13</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon109.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New14</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon11.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New15</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon110.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New16</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon111.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New17</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon112.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New18</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon113.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New19</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon114.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New20</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon115.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New21</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon116.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New22</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon117.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New23</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon118.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New24</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon119.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New25</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon12.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New26</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon120.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New27</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon121.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New28</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon122.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New29</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon123.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New30</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon124.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New31</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon13.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New32</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon14.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New33</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon15.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New34</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon16.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New35</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon17.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New36</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon18.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New37</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon19.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New38</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon2.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New39</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon20.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New40</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon21.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New41</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon22.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New42</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon23.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New43</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon24.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New44</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon25.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New45</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon26.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New46</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon27.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New47</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon28.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New48</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon29.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New49</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon3.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New50</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon30.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New51</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon31.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New52</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon32.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New53</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon33.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New54</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon34.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New55</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon35.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New56</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon36.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New57</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon37.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New58</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon38.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New59</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon39.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New60</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon4.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New61</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon40.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New62</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon41.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New63</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon42.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New64</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon43.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New65</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon44.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New66</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon45.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New67</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon46.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New68</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon47.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New69</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon48.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New70</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon49.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New71</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon5.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New72</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon50.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New73</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon6.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New74</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon66.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New75</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon67.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New76</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon68.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New77</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon69.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New78</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon7.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New79</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon70.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New80</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon71.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New81</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon72.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New82</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon73.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New83</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon74.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New84</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon75.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New85</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon76.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New86</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon77.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New87</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon78.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New88</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon79.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New89</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon8.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New90</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon80.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New91</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon81.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New92</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon82.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New93</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon83.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New94</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon84.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New95</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon85.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New96</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon86.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New97</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon87.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New98</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon88.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New99</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon89.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New100</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon9.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New101</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon90.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New102</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon91.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New103</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon92.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New104</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon93.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New105</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon94.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New106</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon95.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New107</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon96.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New108</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon97.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New109</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon98.<span class="hljs-property">png</span><br>    <span class="hljs-title class_">Tieba</span>-<span class="hljs-title class_">New110</span>: <span class="hljs-regexp">/Tieba-New/im</span>age_emoticon99.<span class="hljs-property">png</span><br>  <span class="hljs-attr">enableQQ</span>: <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>参考: </p><ul><li>百度贴吧表情包<br> <a href="https://github.com/GamerNoTitle/Valine-Magic/blob/master/Classification/Tieba/README.md">https://github.com/GamerNoTitle/Valine-Magic/blob/master/Classification/Tieba/README.md</a></li><li>valine自定义表情 <a href="https://valine.js.org/emoji.html">https://valine.js.org/emoji.html</a></li></ul><p><img src="/assets/2023-05-08-18-31-41.png"></p><h2 id="hexo添加网站运行时间"><a href="#hexo添加网站运行时间" class="headerlink" title="hexo添加网站运行时间"></a>hexo添加网站运行时间</h2><p>懒得弄了, 还没试过</p><p>参考: </p><ul><li><a href="https://lznote.com/hexo/webTime.html">https://lznote.com/hexo/webTime.html</a></li></ul><h2 id="手机顶部细节"><a href="#手机顶部细节" class="headerlink" title="手机顶部细节"></a>手机顶部细节</h2><p><img src="/assets/2023-05-21-20-02-12.png"></p><p>如图所示, 在手机顶部浏览器展示的是暗蓝色, 这并不是我们想要的浅蓝色</p><p><img src="/assets/2023-05-21-20-03-42.png"></p><p>查了下<a href="https://developer.chrome.com/blog/support-for-theme-color-in-chrome-39-for-android/">theme-color</a></p><p>需要在html代码中添加meta标签</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;theme-color&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;#db5945&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure><p>于是打开themes&#x2F;fluid&#x2F;layout&#x2F;_partials&#x2F;head.ejs查看</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;theme-color&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;&lt;%= theme.color.navbar_bg_color %&gt;&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure><p>其中是使用到了这个标签, 并且是从yml中动态取值<br>接着上_config.fluid.yml全局搜索一下<code>navbar_bg_color</code><br>修改值为<code>#96c0d3cc</code></p><p>修改完之后就手机端可能不会立即生效, 需要清除一下缓存<br>此时顶部的颜色已经变成了浅蓝色了<br><img src="/assets/2023-05-22-21-40-02.png"></p>]]></content>
    
    
    <categories>
      
      <category>hexo</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Hexo部署到github</title>
    <link href="/hexo/Hexo%E9%83%A8%E7%BD%B2%E5%88%B0github/"/>
    <url>/hexo/Hexo%E9%83%A8%E7%BD%B2%E5%88%B0github/</url>
    
    <content type="html"><![CDATA[<h2 id="创建-github-仓库"><a href="#创建-github-仓库" class="headerlink" title="创建 github 仓库"></a>创建 github 仓库</h2><p>创建一个 github 仓库<br><a href="https://github.com/roudoukou/roudoukou.github.io">https://github.com/roudoukou/roudoukou.github.io</a><br>仓库命名结尾一定要以 github 用户名.github.io 这种格式创建</p><h2 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件"></a>安装插件</h2><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gauss">E:\<span class="hljs-built_in">Code</span>\Blog\hexo-blog&gt;npm install hexo-deployer-git --<span class="hljs-keyword">save</span><br></code></pre></td></tr></table></figure><h2 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h2><p>修改_config.yml 末尾<br>type 修改成 git<br>repo 修改成 github 仓库地址<br>branch 填写仓库的分支</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-meta"># Deployment</span><br><span class="hljs-meta">## Docs: https:<span class="hljs-comment">//hexo.io/docs/one-command-deployment</span></span><br><span class="hljs-symbol">deploy:</span><br><span class="hljs-symbol">  type:</span> git<br><span class="hljs-symbol">  repo:</span> https:<span class="hljs-comment">//github.com/roudoukou/roudoukou.github.io.git</span><br><span class="hljs-symbol">  branch:</span> master<br></code></pre></td></tr></table></figure><p>配置修改好之后, 部署</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm">E:\<span class="hljs-meta">Code</span>\Blog\hexo-blog&gt;hexo deploy<br></code></pre></td></tr></table></figure><p>部署完成之后, 在浏览器访问即可<br><img src="/assets/571365a3695145729f3ee2b36b996e20.png"></p>]]></content>
    
    
    <categories>
      
      <category>hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo本地使用</title>
    <link href="/hexo/Hexo%E6%9C%AC%E5%9C%B0%E4%BD%BF%E7%94%A8/"/>
    <url>/hexo/Hexo%E6%9C%AC%E5%9C%B0%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="下载-Node-js"><a href="#下载-Node-js" class="headerlink" title="下载 Node.js"></a>下载 Node.js</h2><p><a href="https://nodejs.org/en/">https://nodejs.org/en/</a><br><img src="/assets/ea0ec98f273f4e4eaa79bcb508d4ceb3.png"></p><h2 id="安装-cnmp-可选"><a href="#安装-cnmp-可选" class="headerlink" title="安装 cnmp(可选)"></a>安装 cnmp(可选)</h2><blockquote><p>争议 cnpm 应该是指的国内的 npm 镜像源，npm 是使用的国外的镜像源</p></blockquote><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">npm install -g cnpm --registry=https:<span class="hljs-regexp">//</span>registry.npm.taobao.org<br></code></pre></td></tr></table></figure><p>如果安装了 cnpm, 以下的命令都用 cnpm</p><h2 id="Hexo-安装"><a href="#Hexo-安装" class="headerlink" title="Hexo-安装"></a>Hexo-安装</h2><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">E:</span>\Code\Blog&gt;npm install -g hexo-<span class="hljs-keyword">cli</span><br></code></pre></td></tr></table></figure><p>hexo -v 查看是否安装成功<br><img src="/assets/f8739a11c040405082c1dd69035c8487.png"></p><h2 id="Hexo-根目录的创建"><a href="#Hexo-根目录的创建" class="headerlink" title="Hexo-根目录的创建"></a>Hexo-根目录的创建</h2><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">E:\Code\<span class="hljs-keyword">Blog&gt;mkdir </span>hexo-<span class="hljs-keyword">blog</span><br><span class="hljs-keyword"></span><br>E:\Code\<span class="hljs-keyword">Blog&gt;cd </span>hexo-<span class="hljs-keyword">blog</span><br><span class="hljs-keyword"></span><br>E:\Code\<span class="hljs-keyword">Blog\hexo-blog&gt;</span><br><span class="hljs-keyword"></span><br></code></pre></td></tr></table></figure><h2 id="Hexo-初始化"><a href="#Hexo-初始化" class="headerlink" title="Hexo-初始化"></a>Hexo-初始化</h2><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm">E:\<span class="hljs-meta">Code</span>\Blog\hexo-blog&gt;hexo init<br></code></pre></td></tr></table></figure><h2 id="Hexo-启动"><a href="#Hexo-启动" class="headerlink" title="Hexo-启动"></a>Hexo-启动</h2><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs armasm">E:\<span class="hljs-meta">Code</span>\Blog\hexo-blog&gt;hexo server<br><br>或者简写成<br>E:\<span class="hljs-meta">Code</span>\Blog\hexo-blog&gt;hexo s<br></code></pre></td></tr></table></figure><p><img src="/assets/0643a92449ed4b73a596935ffa44bbc6.png"><br><img src="/assets/a4546c7c773d4efebd54733dbbf9434f.png"><br>此时 Hexo 就成功启动了</p><h2 id="Hexo-创建第一篇文章"><a href="#Hexo-创建第一篇文章" class="headerlink" title="Hexo-创建第一篇文章"></a>Hexo-创建第一篇文章</h2><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livescript">E:<span class="hljs-string">\Code\Blog\hexo-blog&gt;hexo</span> <span class="hljs-keyword">new</span> <span class="hljs-string">&quot;我的第一篇博客&quot;</span><br></code></pre></td></tr></table></figure><p>随便编辑一下 “我的第一篇博客.md”, 然后保存</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">title:</span> <span class="hljs-string">我的第一篇博客</span><br><span class="hljs-attr">date:</span> <span class="hljs-number">2023-02-07 17:13:39</span><br><span class="hljs-attr">tags:</span><br><span class="hljs-meta">---</span><br><span class="hljs-meta"></span><br><span class="hljs-comment">## 我的第一篇博客</span><br><br><span class="hljs-string">这是刚刚用Hexo创建出来的</span><br></code></pre></td></tr></table></figure><p><img src="/assets/74588867538d4e338cbc671b22cd8a4d.png"></p><h2 id="Hexo-清理"><a href="#Hexo-清理" class="headerlink" title="Hexo-清理"></a>Hexo-清理</h2><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs excel"><span class="hljs-symbol">E:</span>\Code\B<span class="hljs-built_in">log</span>\hexo-blog&gt;hexo <span class="hljs-built_in">clean</span><br></code></pre></td></tr></table></figure><h2 id="Hexo-生成"><a href="#Hexo-生成" class="headerlink" title="Hexo-生成"></a>Hexo-生成</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs verilog">E:\Code\Blog\hexo-blog&gt;hexo <span class="hljs-keyword">generate</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo</title>
    <link href="/uncategorized/Hexo/"/>
    <url>/uncategorized/Hexo/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Dubbo</title>
    <link href="/Java/Dubbo/"/>
    <url>/Java/Dubbo/</url>
    
    <content type="html"><![CDATA[<h2 id="安装-zookeeper"><a href="#安装-zookeeper" class="headerlink" title="安装 zookeeper"></a>安装 zookeeper</h2><p>在 windows 环境安装 zookeeper, 为了省事(其实我就是偷懒, 视频中安装的地方就是 windows)<br><img src="/assets/3837e47068b448198d428ab6be678feb.png"><br>在根目录下创建 data 目录,<br>打开 conf 拷贝<code>zoo_sample.cfg</code>一份, 修改名称为<code>zoo.cfg</code><br>打开 cmd, 进入 bin 目录, <code>zkServer.cmd</code>启动服务<br>打开 cmd, 进入 bin 目录, <code>zkCli.cmd</code>启动客户端</p><h2 id="安装-dubbo-admin"><a href="#安装-dubbo-admin" class="headerlink" title="安装 dubbo-admin"></a>安装 dubbo-admin</h2><p>dubbo 本身并不是一个服务软件。它其实就是一个 jar 包能够帮你的 java 程序连接到 zookeeper，并利用 zookeeper 消费、提供服务。所以你不用在 Linux 上启动什么 dubbo 服务。<br>但是为了让用户更好的管理监控众多的 dubbo 服务，官方提供了一个可视化的监控程序，不过这个监控即使不装也不影响使用。<br>github 地址:<br><a href="https://github.com/apache/dubbo-admin">https://github.com/apache/dubbo-admin</a></p><h3 id="通过源码打包运行"><a href="#通过源码打包运行" class="headerlink" title="通过源码打包运行"></a>通过源码打包运行</h3><ol><li>下载代码: git clone <a href="https://github.com/apache/dubbo-admin.git">https://github.com/apache/dubbo-admin.git</a></li><li>在 dubbo-admin-server&#x2F;src&#x2F;main&#x2F;resources&#x2F;application.properties 中指定注册中心地址</li><li>构建<ul><li>mvn clean package -Dmaven.test.skip&#x3D;true</li></ul></li><li>启动<ul><li>mvn –projects dubbo-admin-server spring-boot:run 或者</li><li>cd dubbo-admin-distribution&#x2F;target; java -jar dubbo-admin-${project.version}.jar</li></ul></li><li>访问 <a href="http://localhost:38080/">http://localhost:38080</a></li></ol><p>检查 zookeeper 的主机地址是否正确<br><img src="/assets/f91805e5f2324f1cbadd6433b268d39a.png"><br>使用 maven 进行打包<br><img src="/assets/f985cc41ec564fdfbf61bf884397f9e3.png"><br>运行打包好的 jar 项目<br><img src="/assets/06a62a1f943f495f8c2ddd5aed469d3e.png"><br>可见端口是 7001,<br><img src="/assets/5583d4ba430a429588d3ff592e051fa2.png"><br>访问<a href="http://localhost:7001/">http://localhost:7001/</a><br>账号 root, 密码 root<img src="/assets/dc43b8a17cd848338f4e6de12e73066d.png"></p><h2 id="服务消费者配置-amp-测试"><a href="#服务消费者配置-amp-测试" class="headerlink" title="服务消费者配置&amp;测试"></a>服务消费者配置&amp;测试</h2><table><thead><tr><th>模块</th><th>功能</th></tr></thead><tbody><tr><td>订单服务 web 模块</td><td>创建订单等</td></tr><tr><td>用户服务 service 模块</td><td>查询用户地址等</td></tr></tbody></table><p>测试预期结果：<br>订单服务 web 模块在 A 服务器，用户服务模块在 B 服务器，A 可以远程调用 B 的功能。</p><h2 id="监控中心-Simple-Monitor-安装配置"><a href="#监控中心-Simple-Monitor-安装配置" class="headerlink" title="监控中心-Simple Monitor 安装配置"></a>监控中心-Simple Monitor 安装配置</h2><p>对 dubbo-monitor-simple 使用 maven 进行打包<code>mvn package</code><br><img src="/assets/f1a58ce3afbf449a828a58fc8a2573aa.png"><br>检查配置文件端口是否正确<br><img src="/assets/a5fcbd84104945449e4e5e825e583d23.png"><br>E:\Code\Dubbo\课件\software\dubbo-monitor-simple-2.0.0\assembly.bin<br>在 bin 目录下双击 start.bat 启动 dubbo<br><img src="/assets/9edf5872531d489b995c091d9869bc41.png"><br><img src="/assets/1132f2e558e441b8aba8401cea1f0a83.png"><br>启动好了之后访问<a href="http://localhost:8080/">http://localhost:8080/</a><br><img src="/assets/6b2fdbd5e649408da3821da87a3d374c.png"><br><strong>配置监控中心</strong><br><a href="https://cn.dubbo.apache.org/zh/docsv2.7/user/references/xml/dubbo-monitor/">https://cn.dubbo.apache.org/zh/docsv2.7/user/references/xml/dubbo-monitor/</a><br>consumer.xml 中配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 配置监控中心 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:monitor</span> <span class="hljs-attr">protocol</span>=<span class="hljs-string">&quot;registry&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dubbo:monitor</span>&gt;</span><br><span class="hljs-comment">&lt;!--&lt;dubbo:monitor address=&quot;127.0.0.1:7070&quot;&gt;&lt;/dubbo:monitor&gt;--&gt;</span><br></code></pre></td></tr></table></figure><p>provider.xml 中配置</p><h2 id="Dubbo-与-SpringBoot-整合"><a href="#Dubbo-与-SpringBoot-整合" class="headerlink" title="Dubbo 与 SpringBoot 整合"></a>Dubbo 与 SpringBoot 整合</h2><h2 id="配置-Dubbo-properties-amp-属性加载顺序"><a href="#配置-Dubbo-properties-amp-属性加载顺序" class="headerlink" title="配置-Dubbo.properties&amp;属性加载顺序"></a>配置-Dubbo.properties&amp;属性加载顺序</h2><p><img src="/assets/068c93ca8bfa483c9963b04c282528a8.png"><br>BootUserServiceProviderApplicaion<br>VM options 运行参数 <code>-Ddubbo.protocol.port=20880</code><br>applicaion.yaml 配置 (相当于 XML)</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">dubbo:</span><br><span class="hljs-symbol">  application:</span><br><span class="hljs-symbol">    name:</span> user-service-provider<br><span class="hljs-symbol">  registry:</span><br><span class="hljs-symbol">    address:</span> zookeeper:<span class="hljs-comment">//127.0.0.1:2181</span><br><span class="hljs-symbol">  protocol:</span><br><span class="hljs-symbol">    name:</span> dubbo<br><span class="hljs-symbol">    port:</span> <span class="hljs-number">20881</span><br><span class="hljs-symbol">  monitor:</span><br><span class="hljs-symbol">    protocol:</span> registry<br></code></pre></td></tr></table></figure><p>dubbo.properties 配置</p><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs elm"><span class="hljs-title">dubbo</span>.protocol.<span class="hljs-keyword">port</span>=20882<br><br></code></pre></td></tr></table></figure><h2 id="配置-启动检查"><a href="#配置-启动检查" class="headerlink" title="配置-启动检查"></a>配置-启动检查</h2><p><a href="https://cn.dubbo.apache.org/zh/docs/advanced/preflight-check/">https://cn.dubbo.apache.org/zh/docs/advanced/preflight-check/</a><br>关闭某个服务的启动时检查(没有提供者时报错)</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript">&lt;dubbo:<span class="hljs-keyword">reference</span> <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;UserService&quot;</span> interface=<span class="hljs-string">&quot;com.atguigu.gmall.service.UserService&quot;</span> /&gt;<br><br></code></pre></td></tr></table></figure><p>关闭所有服务的启动时检查(没有提供者时报错)</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:consumer</span> <span class="hljs-attr">check</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dubbo:consumer</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="配置-超时-amp-配置覆盖关系"><a href="#配置-超时-amp-配置覆盖关系" class="headerlink" title="配置-超时&amp;配置覆盖关系"></a>配置-超时&amp;配置覆盖关系</h2><p><a href="https://cn.dubbo.apache.org/zh/docs/references/configuration/xml/">https://cn.dubbo.apache.org/zh/docs/references/configuration/xml/</a><br><img src="/assets/2250f8254d5740ef8761983390c1d924.png"><br>优先级:</p><ul><li>方法级优先，接口级次之，全局配置再次之。</li><li>如果级别一样，则消费方优先，提供方次之。</li></ul><p>provider.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 声明需要暴露的服务接口 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:service</span> <span class="hljs-attr">interface</span>=<span class="hljs-string">&quot;com.atguigu.gmall.service.UserService&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;UserServiceImpl&quot;</span></span><br><span class="hljs-tag">               <span class="hljs-attr">timeout</span>=<span class="hljs-string">&quot;4000&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dubbo:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;getUserAddressList&quot;</span> <span class="hljs-attr">timeout</span>=<span class="hljs-string">&quot;2000&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dubbo:method</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dubbo:service</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:provider</span> <span class="hljs-attr">timeout</span>=<span class="hljs-string">&quot;6000&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dubbo:provider</span>&gt;</span><br></code></pre></td></tr></table></figure><p>consumer.xml</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;dubbo:reference<br>        <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;UserService&quot;</span><br>        interface=<span class="hljs-string">&quot;com.atguigu.gmall.service.UserService&quot;</span><br>        <span class="hljs-built_in">timeout</span>=<span class="hljs-string">&quot;3000&quot;</span>&gt;<br>    &lt;dubbo:method name=<span class="hljs-string">&quot;getUserAddressList&quot;</span> <span class="hljs-built_in">timeout</span>=<span class="hljs-string">&quot;1000&quot;</span>&gt;&lt;/dubbo:method&gt;<br>&lt;/dubbo:reference&gt;<br><br>&lt;dubbo:consumer check=<span class="hljs-string">&quot;false&quot;</span> <span class="hljs-built_in">timeout</span>=<span class="hljs-string">&quot;5000&quot;</span>&gt;&lt;/dubbo:consumer&gt;<br></code></pre></td></tr></table></figure><h2 id="配置-重试次数"><a href="#配置-重试次数" class="headerlink" title="配置-重试次数"></a>配置-重试次数</h2><p>retries-“”: 重试次数, 不包含第一次调用, 0 代表不重试<br>幂等(设置重试次数)[查询, 删除, 修改] 非幂等(不能设置重试次数)[新增]</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- retries-&quot;&quot;: 重试次数, 不包含第一次调用, 0代表不重试 --&gt;</span><br><span class="hljs-comment">&lt;!-- 幂等(设置重试次数)[查询, 删除, 修改] 非幂等(不能设置重试次数)[新增] --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:reference</span></span><br><span class="hljs-tag">        <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;UserService&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">interface</span>=<span class="hljs-string">&quot;com.atguigu.gmall.service.UserService&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">timeout</span>=<span class="hljs-string">&quot;5000&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">retries</span>=<span class="hljs-string">&quot;3&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--&lt;dubbo:method name=&quot;getUserAddressList&quot; timeout=&quot;1000&quot;&gt;&lt;/dubbo:method&gt;--&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dubbo:reference</span>&gt;</span><br></code></pre></td></tr></table></figure><p>重试三次, 如果有三个提供者, 将会每个都重试一遍<br><img src="/assets/0a53420e3600420aa31936f5cda9c2f5.png"></p><h2 id="配置-多版本"><a href="#配置-多版本" class="headerlink" title="配置-多版本"></a>配置-多版本</h2><p>provider.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:service</span> <span class="hljs-attr">interface</span>=<span class="hljs-string">&quot;com.atguigu.gmall.service.UserService&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;UserServiceImpl01&quot;</span></span><br><span class="hljs-tag">               <span class="hljs-attr">timeout</span>=<span class="hljs-string">&quot;1000&quot;</span> <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;1.0.0&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dubbo:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;getUserAddressList&quot;</span> <span class="hljs-attr">timeout</span>=<span class="hljs-string">&quot;1000&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dubbo:method</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dubbo:service</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:service</span> <span class="hljs-attr">interface</span>=<span class="hljs-string">&quot;com.atguigu.gmall.service.UserService&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;UserServiceImpl02&quot;</span></span><br><span class="hljs-tag">               <span class="hljs-attr">timeout</span>=<span class="hljs-string">&quot;1000&quot;</span> <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;2.0.0&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dubbo:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;getUserAddressList&quot;</span> <span class="hljs-attr">timeout</span>=<span class="hljs-string">&quot;1000&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dubbo:method</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dubbo:service</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- 和本地bean一样实现服务 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;UserServiceImpl01&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.atguigu.gmall.service.impl.UserServiceImpl&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;UserServiceImpl02&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.atguigu.gmall.service.impl.UserServiceImpl2&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><p>consumer.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:reference</span></span><br><span class="hljs-tag">        <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;UserService&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">interface</span>=<span class="hljs-string">&quot;com.atguigu.gmall.service.UserService&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">timeout</span>=<span class="hljs-string">&quot;5000&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">retries</span>=<span class="hljs-string">&quot;3&quot;</span> <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;*&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--&lt;dubbo:method name=&quot;getUserAddressList&quot; timeout=&quot;1000&quot;&gt;&lt;/dubbo:method&gt;--&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dubbo:reference</span>&gt;</span><br></code></pre></td></tr></table></figure><p>消费者指定需要使用的 version<br>version 可以填 1.0.0&#x2F;2.0.0&#x2F;* *表示随机的新老版本<br>不同运行结果如下:<br><img src="/assets/15d498befb4a4095b155526e54f6c9c5.png"></p><h2 id="配置-本地存根"><a href="#配置-本地存根" class="headerlink" title="配置-本地存根"></a>配置-本地存根</h2><p>UserServiceStub.java</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceStub</span> <span class="hljs-title">implements</span> <span class="hljs-title">UserService</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> UserService userService;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 传入的是userService远程的代理对象</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> userService</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> UserServiceStub(UserService userService) &#123;<br>        <span class="hljs-keyword">this</span>.userService = userService;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> List&lt;UserAddress&gt; getUserAddressList(String userId) &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;UserServiceStub...&quot;</span>);<br>        <span class="hljs-keyword">if</span> (!StringUtils.isEmpty(userId)) &#123;<br>            <span class="hljs-keyword">return</span> userService.getUserAddressList(userId);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>consumer.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dubbo:reference</span></span><br><span class="hljs-tag">        <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;UserService&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">interface</span>=<span class="hljs-string">&quot;com.atguigu.gmall.service.UserService&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">timeout</span>=<span class="hljs-string">&quot;5000&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">retries</span>=<span class="hljs-string">&quot;3&quot;</span> <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;*&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">stub</span>=<span class="hljs-string">&quot;com.atguigu.gmall.service.UserServiceStub&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--&lt;dubbo:method name=&quot;getUserAddressList&quot; timeout=&quot;1000&quot;&gt;&lt;/dubbo:method&gt;--&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dubbo:reference</span>&gt;</span><br></code></pre></td></tr></table></figure><p>给 stub 设置包名</p><h2 id="配置-SpringBoot-整合的三种方式"><a href="#配置-SpringBoot-整合的三种方式" class="headerlink" title="配置-SpringBoot 整合的三种方式"></a>配置-SpringBoot 整合的三种方式</h2><ol><li>导入 dubbo-starter, 在 application.properties 配置属性, 使用@Service[暴露服务], 使用@Reference[引用服务]</li><li>保留 dubbo.xml 配置文件</li></ol><p>导入 dubbo-starter, 使用@ImportResource 导入 dubbo 的配置文件即可</p><ol start="3"><li>使用注解 API 的方式</li></ol><p>将每一个组件手动创建到容器中, 让 dubbo 来扫描其他的组件</p><p><strong>xml 的方式</strong><br>provider.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:dubbo</span>=<span class="hljs-string">&quot;http://dubbo.apache.org/schema/dubbo&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans-4.3.xsd        http://dubbo.apache.org/schema/dubbo        http://dubbo.apache.org/schema/dubbo/dubbo.xsd&quot;</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- 提供方应用信息，用于计算依赖关系 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dubbo:application</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;boot-user-service-provider&quot;</span> /&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- 使用multicast广播注册中心暴露服务地址 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dubbo:registry</span> <span class="hljs-attr">address</span>=<span class="hljs-string">&quot;zookeeper://127.0.0.1:2181&quot;</span> /&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- 用dubbo协议在20880端口暴露服务 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dubbo:protocol</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dubbo&quot;</span> <span class="hljs-attr">port</span>=<span class="hljs-string">&quot;20882&quot;</span> /&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- 和本地bean一样实现服务 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;UserServiceImpl&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.atguigu.gmall.service.impl.UserServiceImpl&quot;</span>/&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- 声明需要暴露的服务接口 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dubbo:service</span> <span class="hljs-attr">interface</span>=<span class="hljs-string">&quot;com.atguigu.gmall.service.UserService&quot;</span></span><br><span class="hljs-tag">                   <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;UserServiceImpl&quot;</span></span><br><span class="hljs-tag">                   <span class="hljs-attr">timeout</span>=<span class="hljs-string">&quot;1000&quot;</span> <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;1.0.0&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dubbo:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;getUserAddressList&quot;</span> <span class="hljs-attr">timeout</span>=<span class="hljs-string">&quot;1000&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dubbo:method</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dubbo:service</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dubbo:provider</span> <span class="hljs-attr">timeout</span>=<span class="hljs-string">&quot;1000&quot;</span> <span class="hljs-attr">token</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dubbo:provider</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- 连接监控中心 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dubbo:monitor</span> <span class="hljs-attr">protocol</span>=<span class="hljs-string">&quot;registry&quot;</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dubbo:monitor</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p>这个 xml 文件中注入了 bean, UserService 就不需要@Service 这个注解暴露服务<br>UserService 中<br>@Service 是 com.alibaba.dubbo.config.annotation.Service;包下的</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">import</span> com.alibaba.dubbo.config.annotation.Service;<br><br><span class="hljs-comment">//@Service   // 暴露服务</span><br>@Component<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServiceImpl</span> <span class="hljs-keyword"><span class="hljs-keyword">implements</span> <span class="hljs-type">UserService</span></span> </span>&#123;<br><br>    @Override<br>    <span class="hljs-keyword">public</span> List&lt;UserAddress&gt; getUserAddressList(<span class="hljs-keyword">String</span> userId) &#123;<br>        UserAddress address1 = <span class="hljs-keyword">new</span> <span class="hljs-type">UserAddress</span>(<span class="hljs-number">1</span>, <span class="hljs-string">&quot;北京市昌平区宏福科技园综合楼3层&quot;</span>, <span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-string">&quot;李老师&quot;</span>, <span class="hljs-string">&quot;010-56253825&quot;</span>, <span class="hljs-string">&quot;Y&quot;</span>);<br>        UserAddress address2 = <span class="hljs-keyword">new</span> <span class="hljs-type">UserAddress</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;深圳市宝安区西部硅谷大厦B座3层（深圳分校）&quot;</span>, <span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-string">&quot;王老师&quot;</span>, <span class="hljs-string">&quot;010-56253825&quot;</span>, <span class="hljs-string">&quot;N&quot;</span>);<br><br>        <span class="hljs-keyword">return</span> Arrays.asList(address1,address2);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>Application</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-comment">//@EnableDubbo // 开启基于注解的dubbo功能</span><br><span class="hljs-variable">@ImportResource</span>(locations = <span class="hljs-string">&quot;classpath:provider.xml&quot;</span>)<br><span class="hljs-variable">@SpringBootApplication</span><br>public class BootUserServiceProviderApplication &#123;<br><br>    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">static</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">main</span>(String[] args) &#123;<br>        <span class="hljs-selector-tag">SpringApplication</span><span class="hljs-selector-class">.run</span>(BootUserServiceProviderApplication.class, args);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>注解的方式</strong><br>MyDubboConfig</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.gmall.config;<br><br><span class="hljs-keyword">import</span> com.alibaba.dubbo.config.*;<br><span class="hljs-keyword">import</span> com.atguigu.gmall.service.UserService;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDubboConfig</span> &#123;<br><br>    <span class="hljs-comment">//    &lt;dubbo:application name=&quot;boot-user-service-provider&quot; /&gt;</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> ApplicationConfig <span class="hljs-title function_">applicationConfig</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">ApplicationConfig</span> <span class="hljs-variable">applicationConfig</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApplicationConfig</span>();<br>        applicationConfig.setName(<span class="hljs-string">&quot;boot-user-service-provider&quot;</span>);<br>        <span class="hljs-keyword">return</span> applicationConfig;<br>    &#125;<br><br>    <span class="hljs-comment">//    &lt;dubbo:registry address=&quot;zookeeper://127.0.0.1:2181&quot; /&gt;</span><br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> RegistryConfig <span class="hljs-title function_">registryConfig</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">RegistryConfig</span> <span class="hljs-variable">registryConfig</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegistryConfig</span>();<br>        registryConfig.setAddress(<span class="hljs-string">&quot;zookeeper://127.0.0.1:2181&quot;</span>);<br>        <span class="hljs-keyword">return</span> registryConfig;<br>    &#125;<br><br>    <span class="hljs-comment">//    &lt;dubbo:protocol name=&quot;dubbo&quot; port=&quot;20882&quot; /&gt;</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> ProtocolConfig <span class="hljs-title function_">protocolConfig</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">ProtocolConfig</span> <span class="hljs-variable">protocolConfig</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProtocolConfig</span>();<br>        protocolConfig.setName(<span class="hljs-string">&quot;dubbo&quot;</span>);<br>        protocolConfig.setPort(<span class="hljs-number">20882</span>);<br>        <span class="hljs-keyword">return</span> protocolConfig;<br>    &#125;<br><br>    <span class="hljs-comment">//    &lt;dubbo:service interface=&quot;com.atguigu.gmall.service.UserService&quot;</span><br>    <span class="hljs-comment">//                   ref=&quot;UserServiceImpl&quot;</span><br>    <span class="hljs-comment">//                   timeout=&quot;1000&quot; version=&quot;1.0.0&quot;&gt;</span><br>    <span class="hljs-comment">//        &lt;dubbo:method name=&quot;getUserAddressList&quot; timeout=&quot;1000&quot;&gt;&lt;/dubbo:method&gt;</span><br>    <span class="hljs-comment">//    &lt;/dubbo:service&gt;</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> ServiceConfig&lt;UserService&gt; <span class="hljs-title function_">userServiceServiceConfig</span><span class="hljs-params">(UserService userService)</span> &#123;<br>        ServiceConfig&lt;UserService&gt; userServiceServiceConfig = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceConfig</span>&lt;&gt;();<br>        userServiceServiceConfig.setInterface(UserService.class);<br>        userServiceServiceConfig.setRef(userService);<br>        userServiceServiceConfig.setVersion(<span class="hljs-string">&quot;1.0.0&quot;</span>);<br><br>        <span class="hljs-comment">// 配置每一个method的信息</span><br>        <span class="hljs-type">MethodConfig</span> <span class="hljs-variable">methodConfig</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MethodConfig</span>();<br>        methodConfig.setName(<span class="hljs-string">&quot;getUserAddressList&quot;</span>);<br>        methodConfig.setTimeout(<span class="hljs-number">1000</span>);<br><br>        <span class="hljs-comment">// 将method的设置关联到service配置中</span><br>        List&lt;MethodConfig&gt; methodConfigList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        methodConfigList.add(methodConfig);<br>        userServiceServiceConfig.setMethods(methodConfigList);<br>        <span class="hljs-keyword">return</span> userServiceServiceConfig;<br>    &#125;<br><br>    <span class="hljs-comment">//    &lt;dubbo:provider timeout=&quot;1000&quot;&gt;&lt;/dubbo:provider&gt;</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> ProviderConfig <span class="hljs-title function_">providerConfig</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">ProviderConfig</span> <span class="hljs-variable">providerConfig</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProviderConfig</span>();<br>        providerConfig.setTimeout(<span class="hljs-number">1000</span>);<br>        <span class="hljs-keyword">return</span> providerConfig;<br>    &#125;<br><br>    <span class="hljs-comment">//    &lt;dubbo:monitor protocol=&quot;registry&quot; &gt;&lt;/dubbo:monitor&gt;</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> MonitorConfig <span class="hljs-title function_">monitorConfig</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">MonitorConfig</span> <span class="hljs-variable">monitorConfig</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MonitorConfig</span>();<br>        monitorConfig.setProtocol(<span class="hljs-string">&quot;registry&quot;</span>);<br>        <span class="hljs-keyword">return</span> monitorConfig;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>UserService 需要暴露服务</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span>   <span class="hljs-comment">// 暴露服务</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> List&lt;UserAddress&gt; <span class="hljs-title function_">getUserAddressList</span><span class="hljs-params">(String userId)</span> &#123;<br>        <span class="hljs-type">UserAddress</span> <span class="hljs-variable">address1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserAddress</span>(<span class="hljs-number">1</span>, <span class="hljs-string">&quot;北京市昌平区宏福科技园综合楼3层&quot;</span>, <span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-string">&quot;李老师&quot;</span>, <span class="hljs-string">&quot;010-56253825&quot;</span>, <span class="hljs-string">&quot;Y&quot;</span>);<br>        <span class="hljs-type">UserAddress</span> <span class="hljs-variable">address2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserAddress</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;深圳市宝安区西部硅谷大厦B座3层（深圳分校）&quot;</span>, <span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-string">&quot;王老师&quot;</span>, <span class="hljs-string">&quot;010-56253825&quot;</span>, <span class="hljs-string">&quot;N&quot;</span>);<br><br>        <span class="hljs-keyword">return</span> Arrays.asList(address1,address2);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>Application</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-comment">//@EnableDubbo // 开启基于注解的dubbo功能</span><br><span class="hljs-comment">//@ImportResource(locations = &quot;classpath:provider.xml&quot;)</span><br><span class="hljs-variable">@EnableDubbo</span>(scanBasePackages = <span class="hljs-string">&quot;com.atguigu.gmall&quot;</span>)<br><span class="hljs-variable">@SpringBootApplication</span><br>public class BootUserServiceProviderApplication &#123;<br><br>    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">static</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">main</span>(String[] args) &#123;<br>        <span class="hljs-selector-tag">SpringApplication</span><span class="hljs-selector-class">.run</span>(BootUserServiceProviderApplication.class, args);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="高可用-ZooKeeper-宕机与-Dubbo-直连"><a href="#高可用-ZooKeeper-宕机与-Dubbo-直连" class="headerlink" title="高可用-ZooKeeper 宕机与 Dubbo 直连"></a>高可用-ZooKeeper 宕机与 Dubbo 直连</h2><p><img src="/assets/fb64664e41484f53a93606dbae97fe5d.png"><br>注册中心挂了, 仍然能消耗暴露的服务<br>健壮性</p><ul><li>监控中心宕掉不影响使用，只是丢失部分采样数据</li><li>数据库宕掉后，注册中心仍能通过缓存提供服务列表查询，但不能注册新服务</li><li>注册中心对等集群，任意一台宕掉后，将自动切换到另一台</li><li><strong>注册中心全部宕掉后，服务提供者和服务消费者仍能通过本地缓存通讯</strong></li><li>服务提供者无状态，任意一台宕掉后，不影响使用</li><li>服务提供者全部宕掉后，服务消费者应用将无法使用，并无限次重连等待服务提供者恢复</li></ul><p><img src="/assets/5cddf156c30248d2a8c3f0ef63b6d1cc.png"></p><p>dubbo 直连</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@Reference(url = <span class="hljs-string">&quot;127.0.0.1:20882&quot;</span>)</span> <span class="hljs-comment">// dubbo直连</span><br></code></pre></td></tr></table></figure><h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p><img src="/assets/b0dce0dd23ba460595e1f860237ed3ab.png"></p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>Dubbo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ZooKeeper</title>
    <link href="/Java/ZooKeeper/"/>
    <url>/Java/ZooKeeper/</url>
    
    <content type="html"><![CDATA[<h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><p><a href="https://zookeeper.apache.org/">https://zookeeper.apache.org/</a><br><img src="/assets/59ad79dedfb84da28b52e40bb077d1a9.png"><br><a href="https://archive.apache.org/dist/zookeeper/">https://archive.apache.org/dist/zookeeper/</a><br>我们选择比较稳定的版本 3.5.7<br><img src="/assets/bdf0d942613d4463948fbf84788071dc.png"></p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>上传到 linux 上<br><img src="/assets/fad88d9516864905bafb0e1be56a0523.png"><br>解压缩<br><code>[xiamu@hadoop202 software]$ tar -zxvf apache-zookeeper-3.5.7-bin.tar.gz -C /opt/module/</code><br>修改名称<br><code>[xiamu@hadoop202 module]$ mv apache-zookeeper-3.5.7-bin/ zookeeper-3.5.7/</code><br>配置修改<br><code>[xiamu@hadoop202 module]$ cd zookeeper-3.5.7/</code><br><code>[xiamu@hadoop202 zookeeper-3.5.7]$ mkdir zkData</code><br><code>[xiamu@hadoop202 zookeeper-3.5.7]$ cd conf/</code><br><code>[xiamu@hadoop202 zookeeper-3.5.7]$ mv zoo_sample.cfg zoo.cfg</code><br><code>[xiamu@hadoop202 conf]$ vim zoo.cfg</code><br>修改 dataDir 的路径为刚刚创建的 zkData 的路径</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">dataDir=/opt/module/zookeeper-3.5.7/zkData<br><br></code></pre></td></tr></table></figure><h2 id="本地启动和停止"><a href="#本地启动和停止" class="headerlink" title="本地启动和停止"></a>本地启动和停止</h2><p><code>[xiamu@hadoop202 zookeeper-3.5.7]$ bin/zkServer.sh start</code>启动 zookeeper</p><p><code>[xiamu@hadoop202 zookeeper-3.5.7]$ jps </code>查看进程是否启动<br>4720 Jps<br>4686 QuorumPeerMain</p><p><code>[xiamu@hadoop202 zookeeper-3.5.7]$ bin/zkServer.sh status</code>查看状态<br>ZooKeeper JMX enabled by default<br>Using config: &#x2F;opt&#x2F;module&#x2F;zookeeper-3.5.7&#x2F;bin&#x2F;..&#x2F;conf&#x2F;zoo.cfg<br>Client port found: 2181. Client address: localhost.<br>Mode: standalone</p><p><code>[xiamu@hadoop202 zookeeper-3.5.7]$ bin/zkCli.sh </code>启动客户端<br><code>[zk: localhost:2181(CONNECTED) 0] quit</code>退出客户端</p><p><code>[xiamu@hadoop202 zookeeper-3.5.7]$ bin/zkServer.sh stop</code>停止 ZooKeeper<br>ZooKeeper JMX enabled by default<br>Using config: &#x2F;opt&#x2F;module&#x2F;zookeeper-3.5.7&#x2F;bin&#x2F;..&#x2F;conf&#x2F;zoo.cfg<br>Stopping zookeeper … STOPPED</p><h2 id="集群安装"><a href="#集群安装" class="headerlink" title="集群安装"></a>集群安装</h2><p>在创建好的 zkData 目录下创建一个文件 myid<br><code>[xiamu@hadoop202 zkData]$ vim myid</code><br>2<br><code>[xiamu@hadoop203 zkData]$ vim myid</code><br>3<br><code>[xiamu@hadoop204 zkData]$ vim myid</code><br>4<br>在 hadoop202(102)中设置 2<br>在 hadoop203(103)中设置 3<br>在 hadoop204(104)中设置 4<br>分发脚本命令<code>[xiamu@hadoop202 module]$ xsync zookeeper-3.5.7/</code></p><p>配置<code>[xiamu@hadoop202 conf]$ vim zoo.cfg </code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#######################cluster##########################</span><br>server.2=hadoop202:2888:3888server.3=hadoop203:2888:3888<br>server.4=hadoop204:2888:3888<br><br></code></pre></td></tr></table></figure><p>配置完成之后分发<br><code>[xiamu@hadoop202 conf]$ xsync zoo.cfg</code></p><h2 id="集群启动"><a href="#集群启动" class="headerlink" title="集群启动"></a>集群启动</h2><p><code>[xiamu@hadoop202 zookeeper-3.5.7]$ bin/zkServer.sh start</code><br><code>[xiamu@hadoop202 zookeeper-3.5.7]$ bin/zkServer.sh status</code><br><img src="/assets/0c2aceb4b3dc41d6b9b68d0203e319b3.png"><br>需要对每一个集群开启 zookeeper<br><code>[xiamu@hadoop203 zookeeper-3.5.7]$ bin/zkServer.sh start</code><br><code>[xiamu@hadoop203 zookeeper-3.5.7]$ bin/zkServer.sh status</code><br>Mode: leader<br><code>[xiamu@hadoop204 zookeeper-3.5.7]$ bin/zkServer.sh start</code><br><code>[xiamu@hadoop204 zookeeper-3.5.7]$ bin/zkServer.sh status</code><br>Mode: follower</p><h2 id="第一次选举机制"><a href="#第一次选举机制" class="headerlink" title="第一次选举机制"></a>第一次选举机制</h2><p><img src="/assets/80959ddc42034b3c81f2dc4a8fb245e0.png"></p><h2 id="非第一次选举机制"><a href="#非第一次选举机制" class="headerlink" title="非第一次选举机制"></a>非第一次选举机制</h2><p><img src="/assets/d27b7448dc7b44dea6f5a78a4929ac44.png"></p><h2 id="编写启动停止脚本"><a href="#编写启动停止脚本" class="headerlink" title="编写启动停止脚本"></a>编写启动停止脚本</h2><p>在&#x2F;home&#x2F;xiamu&#x2F;bin 目录下创建 zk.sh 脚本<code>[xiamu@hadoop202 bin]$ vim zk.sh</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-keyword">case</span> <span class="hljs-variable">$1</span> <span class="hljs-keyword">in</span><br><span class="hljs-string">&quot;start&quot;</span>)&#123;<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> hadoop202 hadoop203 hadoop204<br>        <span class="hljs-keyword">do</span><br>                <span class="hljs-built_in">echo</span> ---------- ZooKeeper <span class="hljs-variable">$i</span> 启动 ----------<br>                ssh <span class="hljs-variable">$i</span> <span class="hljs-string">&quot;/opt/module/zookeeper-3.5.7/bin/zkServer.sh start&quot;</span><br>        <span class="hljs-keyword">done</span><br>&#125;<br>;;<br><span class="hljs-string">&quot;stop&quot;</span>)&#123;<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> hadoop202 hadoop203 hadoop204<br>        <span class="hljs-keyword">do</span><br>                <span class="hljs-built_in">echo</span> ---------- ZooKeeper <span class="hljs-variable">$i</span> 停止 ----------<br>                ssh <span class="hljs-variable">$i</span> <span class="hljs-string">&quot;/opt/module/zookeeper-3.5.7/bin/zkServer.sh stop&quot;</span><br>        <span class="hljs-keyword">done</span><br>&#125;<br>;;<br><span class="hljs-string">&quot;status&quot;</span>)&#123;<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> hadoop202 hadoop203 hadoop204<br>        <span class="hljs-keyword">do</span><br>                <span class="hljs-built_in">echo</span> ---------- ZooKeeper <span class="hljs-variable">$i</span> 状态 ----------<br>                ssh <span class="hljs-variable">$i</span> <span class="hljs-string">&quot;/opt/module/zookeeper-3.5.7/bin/zkServer.sh status&quot;</span><br>        <span class="hljs-keyword">done</span><br>&#125;<br>;;<br><span class="hljs-keyword">esac</span><br><br></code></pre></td></tr></table></figure><p>给予可执行权限<code>[xiamu@hadoop202 bin]$ chmod 777 zk.sh</code><br>分发脚本<code>[xiamu@hadoop202 bin]$ xsync zk.sh </code><br>使用脚本启动&#x2F;查看状态&#x2F;关闭 ZooKeeper<br><code>[xiamu@hadoop202 bin]$ zk.sh start</code><br><code>[xiamu@hadoop202 bin]$ zk.sh status</code><br><code>[xiamu@hadoop202 bin]$ zk.sh stop</code></p><h2 id="命令行-节点信息"><a href="#命令行-节点信息" class="headerlink" title="命令行-节点信息"></a>命令行-节点信息</h2><p>命令行语法</p><table><thead><tr><th>命令基本语法</th><th>功能描述</th></tr></thead><tbody><tr><td>help</td><td>显示所有操作命令</td></tr><tr><td>ls path</td><td>使用 ls 命令来查看当前 znode 的子节点[可监听]</td></tr></tbody></table><p>-w 监听子节点变化<br>-s 附加次级信息 |</p><p>| create | 普通创建<br>-s 含有序列</p><p>-e 临时（重启或者超时消失） |<br>| — | — |<br>| get path | 获得节点的值[可监听]<br>-w 监听节点内容变化<br>-s 附加次级信息 |<br>| set | 设置节点的具体值 |<br>| stat | 查看节点状态 |<br>| delete | 删除节点 |<br>| deleteall | 递归删除节点 |</p><p><code>[xiamu@hadoop202 zookeeper-3.5.7]$ bin/zkCli.sh</code>客户端直接连接<br>[zk: localhost:2181(CONNECTED) 0]<br>此时 zk 后面的主机名是 localhost, 可以使用-server 参数修改<br><code>[xiamu@hadoop202 zookeeper-3.5.7]$ bin/zkCli.sh -server hadoop202:2181</code><br><code>[zk: hadoop202:2181(CONNECTED) 0] ls /</code> 查看当前 znode 中所包含的内容<br><code>[zk: hadoop202:2181(CONNECTED) 1] help</code> 显示所有操作命令<br><code>[zk: hadoop202:2181(CONNECTED) 4] ls -s /</code> 查看当前节点详细数据</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">[zookeeper]cZxid = 0x0<br>ctime = Thu Jan 01 08:00:00 CST 1970<br>mZxid = 0x0<br>mtime = Thu Jan 01 08:00:00 CST 1970<br>pZxid = 0x0<br>cversion = -1<br>dataVersion = 0<br>aclVersion = 0<br>ephemeralOwner = 0x0<br>dataLength = 0<br>numChildren = 1<br></code></pre></td></tr></table></figure><p>（1）czxid：创建节点的事务 zxid<br>每次修改 ZooKeeper 状态都会产生一个 ZooKeeper 事务 ID。事务 ID 是 ZooKeeper 中所有修改总的次序。每次修改都有唯一的 zxid，如果 zxid1 小于 zxid2，那么 zxid1 在 zxid2 之前发生。<br>（2）ctime：znode 被创建的毫秒数（从 1970 年开始）<br>（3）mzxid：znode 最后更新的事务 zxid<br>（4）mtime：znode 最后修改的毫秒数（从 1970 年开始）<br>（5）pZxid：znode 最后更新的子节点 zxid<br>（6）cversion：znode 子节点变化号，znode 子节点修改次数<br>（7）dataversion：znode 数据变化号<br>（8）aclVersion：znode 访问控制列表的变化号<br>（9）ephemeralOwner：如果是临时节点，这个是 znode 拥有者的 session id。如果不是临时节点则是 0。<br>（10）dataLength：znode 的数据长度<br>（11）numChildren：znode 子节点数量</p><h2 id="命令行-节点类型-持久-x2F-短暂-x2F-有序号-x2F-无序号"><a href="#命令行-节点类型-持久-x2F-短暂-x2F-有序号-x2F-无序号" class="headerlink" title="命令行-节点类型(持久&#x2F;短暂&#x2F;有序号&#x2F;无序号)"></a>命令行-节点类型(持久&#x2F;短暂&#x2F;有序号&#x2F;无序号)</h2><h3 id="创建永久节点"><a href="#创建永久节点" class="headerlink" title="创建永久节点"></a>创建永久节点</h3><p>创建普通节点(默认创建的是不带序号的永久节点)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">[zk: hadoop202:2181(CONNECTED) 0] <span class="hljs-built_in">ls</span> /<br>[zookeeper]<br>[zk: hadoop202:2181(CONNECTED) 1] create /sanguo <span class="hljs-string">&quot;diaochan&quot;</span><br>Created /sanguo<br>[zk: hadoop202:2181(CONNECTED) 2] <span class="hljs-built_in">ls</span> /<br>[sanguo, zookeeper]<br>[zk: hadoop202:2181(CONNECTED) 3]<br><br>[zk: hadoop202:2181(CONNECTED) 5] create /sanguo/shuguo <span class="hljs-string">&quot;liubei&quot;</span><br>Created /sanguo/shuguo<br>[zk: hadoop202:2181(CONNECTED) 7] <span class="hljs-built_in">ls</span> /sanguo<br>[shuguo]<br><br></code></pre></td></tr></table></figure><p>获取节点中的值</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">[zk: hadoop202:2181(CONNECTED) 8] get -s /sanguo<br>diaochan<br>cZxid = 0x30000000a<br>ctime = Wed Feb 01 20:12:01 CST 2023<br>mZxid = 0x30000000a<br>mtime = Wed Feb 01 20:12:01 CST 2023<br>pZxid = 0x30000000b<br>cversion = 1<br>dataVersion = 0<br>aclVersion = 0<br>ephemeralOwner = 0x0<br>dataLength = 8<br>numChildren = 1<br><br>[zk: hadoop202:2181(CONNECTED) 9] get -s /sanguo/shuguo<br>liubei<br>cZxid = 0x30000000b<br>ctime = Wed Feb 01 20:14:02 CST 2023<br>mZxid = 0x30000000b<br>mtime = Wed Feb 01 20:14:02 CST 2023<br>pZxid = 0x30000000b<br>cversion = 0<br>dataVersion = 0<br>aclVersion = 0<br>ephemeralOwner = 0x0<br>dataLength = 6<br>numChildren = 0<br><br></code></pre></td></tr></table></figure><p>创建带序号的节点</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br>[zk: hadoop202:2181(CONNECTED) 12] create -s /sanguo/weiguo/zhangliao <span class="hljs-string">&quot;zhangliao&quot;</span><br>Created /sanguo/weiguo/zhangliao0000000000<br>[zk: hadoop202:2181(CONNECTED) 13] <span class="hljs-built_in">ls</span> /<br>[sanguo, zookeeper]<br>[zk: hadoop202:2181(CONNECTED) 14] <span class="hljs-built_in">ls</span> /sanguo/weiguo<br>[zhangliao0000000000]<br>[zk: hadoop202:2181(CONNECTED) 15]<br><br><br></code></pre></td></tr></table></figure><p>带序号的永久节点第二次创建会自动加上序号, 而不带序号的永久节点再次创建会报错</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">[zk: hadoop202:2181(CONNECTED) 15] create -s /sanguo/weiguo/zhangliao <span class="hljs-string">&quot;zhangliao&quot;</span><br>Created /sanguo/weiguo/zhangliao0000000001<br><br>[zk: hadoop202:2181(CONNECTED) 10] create /sanguo/weiguo <span class="hljs-string">&quot;caocao&quot;</span><br>Created /sanguo/weiguo<br>[zk: hadoop202:2181(CONNECTED) 16] create /sanguo/weiguo <span class="hljs-string">&quot;caocao&quot;</span><br>Node already exists: /sanguo/weiguo<br><br></code></pre></td></tr></table></figure><p>使用<code>quit</code>退出客户端, 再次连接, 发现之前创建的节点仍然存在</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">[zk: hadoop202:2181(CONNECTED) 17] quit<br>[xiamu@hadoop202 zookeeper-3.5.7]$ bin/zkCli.sh -server hadoop202:2181<br><br>[zk: hadoop202:2181(CONNECTED) 0] <span class="hljs-built_in">ls</span> /sanguo<br>[shuguo, weiguo]<br>[zk: hadoop202:2181(CONNECTED) 1] <span class="hljs-built_in">ls</span> /sanguo/weiguo<br>[zhangliao0000000000, zhangliao0000000001]<br><br></code></pre></td></tr></table></figure><h3 id="创建临时节点"><a href="#创建临时节点" class="headerlink" title="创建临时节点"></a>创建临时节点</h3><p>创建临时节点只需要加上参数-e 即可</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">[zk: hadoop202:2181(CONNECTED) 2] create -e /sanguo/wuguo <span class="hljs-string">&quot;zhouyu&quot;</span><br>Created /sanguo/wuguo<br><br>查看吴国, 吴国创建成功<br>[zk: hadoop202:2181(CONNECTED) 3] <span class="hljs-built_in">ls</span> /sanguo<br>[shuguo, weiguo, wuguo]<br><br></code></pre></td></tr></table></figure><p>创建一个带序号的临时节点<br>只需要加上参数-s 即可</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">[zk: hadoop202:2181(CONNECTED) 4] create -e -s /sanguo/wuguo <span class="hljs-string">&quot;zhouyu&quot;</span><br>Created /sanguo/wuguo0000000003<br><br>查看刚刚创建的节点<br>[zk: hadoop202:2181(CONNECTED) 5] <span class="hljs-built_in">ls</span> /sanguo<br>[shuguo, weiguo, wuguo, wuguo0000000003]<br><br></code></pre></td></tr></table></figure><p>断开<code>quit</code>连接之后, 吴国(wuguo)就没有了, 因为吴国创建的时候有-e, -e 表示是临时节点, 临时节点断开连接之后就删除了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">[zk: hadoop202:2181(CONNECTED) 6] quit<br>[xiamu@hadoop202 zookeeper-3.5.7]$ bin/zkCli.sh -server hadoop202:2181<br><br>[zk: hadoop202:2181(CONNECTED) 0] <span class="hljs-built_in">ls</span> /sanguo<br>[shuguo, weiguo]<br><br></code></pre></td></tr></table></figure><p>**总结: **<br>-s 表示带序号<br>-e 表示临时节点</p><h3 id="修改节点的值"><a href="#修改节点的值" class="headerlink" title="修改节点的值"></a>修改节点的值</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">[zk: hadoop202:2181(CONNECTED) 2] get -s /sanguo/weiguo<br>caocao<br>cZxid = 0x30000000c<br>ctime = Wed Feb 01 20:15:52 CST 2023<br>mZxid = 0x30000000c<br>mtime = Wed Feb 01 20:15:52 CST 2023<br>pZxid = 0x30000000e<br>cversion = 2<br>dataVersion = 0<br>aclVersion = 0<br>ephemeralOwner = 0x0<br>dataLength = 6<br>numChildren = 2<br>[zk: hadoop202:2181(CONNECTED) 4] <span class="hljs-built_in">set</span> /sanguo/weiguo <span class="hljs-string">&quot;simayi&quot;</span><br>[zk: hadoop202:2181(CONNECTED) 5] get -s /sanguo/weiguo<br>simayi<br>cZxid = 0x30000000c<br>ctime = Wed Feb 01 20:15:52 CST 2023<br>mZxid = 0x300000016<br>mtime = Wed Feb 01 20:29:31 CST 2023<br>pZxid = 0x30000000e<br>cversion = 2<br>dataVersion = 1<br>aclVersion = 0<br>ephemeralOwner = 0x0<br>dataLength = 6<br>numChildren = 2<br><br><br>[zk: hadoop202:2181(CONNECTED) 8] get /sanguo/weiguo<br>simayi<br><br></code></pre></td></tr></table></figure><h2 id="监听器及节点删除"><a href="#监听器及节点删除" class="headerlink" title="监听器及节点删除"></a>监听器及节点删除</h2><h3 id="监听节点的值"><a href="#监听节点的值" class="headerlink" title="监听节点的值"></a>监听节点的值</h3><p>在 hadoop204 中, <code>get -s /sanguo</code>查看 sanguo 的值, 并且使用<code>get -w /sanguo</code>监控 sanguo</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">[zk: hadoop204(CONNECTED) 0] get -s /sanguo<br>diaochan<br>cZxid = 0x30000000a<br>ctime = Wed Feb 01 20:12:01 CST 2023<br>mZxid = 0x30000000a<br>mtime = Wed Feb 01 20:12:01 CST 2023<br>pZxid = 0x300000014<br>cversion = 6<br>dataVersion = 0<br>aclVersion = 0<br>ephemeralOwner = 0x0<br>dataLength = 8<br>numChildren = 2<br>[zk: hadoop204(CONNECTED) 1] get -w /sanguo<br>diaochan<br><br><br></code></pre></td></tr></table></figure><p>在 hadoop203 中修改 sanguo 的值, 在 hadoop204 的选项卡会出现一个感叹号<br>只有 hadoop203 第一次修改的时候 hadoop204 会出现一个感叹号,<br>hadoop203 修改多次, hadoop204 只会出现一个感叹号, 因为 hadoop204 只监听一次<br>如果想再次监听, 需要再次在 hadoop204 注册</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">[zk: hadoop203(CONNECTED) 3] <span class="hljs-built_in">set</span> /sanguo <span class="hljs-string">&quot;xisi&quot;</span><br>[zk: hadoop203(CONNECTED) 4] <span class="hljs-built_in">set</span> /sanguo <span class="hljs-string">&quot;yangfeiyan&quot;</span><br><br></code></pre></td></tr></table></figure><p><img src="/assets/c737cd296ac241159bb7e3be23383961.png"></p><h3 id="监听节点的路径变化"><a href="#监听节点的路径变化" class="headerlink" title="监听节点的路径变化"></a>监听节点的路径变化</h3><p>在 hadoop204 中使用<code>ls -w /sanguo</code>监听 sanguo 的路径变化<br>在 hadoop203 中添加一个节点, hadoop204 中出现叹号, 同样也是注册一次生效一次, 创建多个节点也就只会出现一个叹号, 除非再次开启监听<br><img src="/assets/f904a30f856e461cae6a1292605d22da.png"></p><h3 id="删除节点"><a href="#删除节点" class="headerlink" title="删除节点"></a>删除节点</h3><p>删除节点和递归删除节点</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">[zk: hadoop204(CONNECTED) 7] <span class="hljs-built_in">ls</span> /<br>[sanguo, zookeeper]<br>[zk: hadoop204(CONNECTED) 8] <span class="hljs-built_in">ls</span> /sanguo<br>[jin, jin1, shuguo, weiguo]<br>[zk: hadoop204(CONNECTED) 9] delete /sanguo/jin<br>[zk: hadoop204(CONNECTED) 10] <span class="hljs-built_in">ls</span> /sanguo<br>[jin1, shuguo, weiguo]<br>[zk: hadoop204(CONNECTED) 12] delete /sanguo<br>Node not empty: /sanguo<br>[zk: hadoop204(CONNECTED) 13] deleteall /sanguo<br>[zk: hadoop204(CONNECTED) 14] <span class="hljs-built_in">ls</span> /sanguo<br>Node does not exist: /sanguo<br>[zk: hadoop204(CONNECTED) 15] <span class="hljs-built_in">ls</span> /<br>[zookeeper]<br><br></code></pre></td></tr></table></figure><h3 id="查看节点状态"><a href="#查看节点状态" class="headerlink" title="查看节点状态"></a>查看节点状态</h3><p>查看节点状态, 但是不查看值</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">[zk: hadoop204(CONNECTED) 21] <span class="hljs-built_in">stat</span> /sanguo<br>cZxid = 0x30000002d<br>ctime = Wed Feb 01 21:07:20 CST 2023<br>mZxid = 0x30000002d<br>mtime = Wed Feb 01 21:07:20 CST 2023<br>pZxid = 0x30000002d<br>cversion = 0<br>dataVersion = 0<br>aclVersion = 0<br>ephemeralOwner = 0x0<br>dataLength = 9<br>numChildren = 0<br><br></code></pre></td></tr></table></figure><h2 id="客户端-创建节点"><a href="#客户端-创建节点" class="headerlink" title="客户端-创建节点"></a>客户端-创建节点</h2><p>创建 maven 项目<code>zookeeper</code><br>在 pom.xml 导入依赖</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;dependencies&gt;<br>    &lt;dependency&gt;<br>        &lt;groupId&gt;junit&lt;/groupId&gt;<br>        &lt;artifactId&gt;junit&lt;/artifactId&gt;<br>        &lt;version&gt;RELEASE&lt;/version&gt;<br>    &lt;/dependency&gt;<br><br>    &lt;dependency&gt;<br>        &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;<br>        &lt;artifactId&gt;log4j-core&lt;/artifactId&gt;<br>        &lt;version&gt;2.8.2&lt;/version&gt;<br>    &lt;/dependency&gt;<br><br>    &lt;dependency&gt;<br>        &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt;<br>        &lt;artifactId&gt;zookeeper&lt;/artifactId&gt;<br>        &lt;version&gt;3.5.7&lt;/version&gt;<br>    &lt;/dependency&gt;<br>&lt;/dependencies&gt;<br></code></pre></td></tr></table></figure><p>在 resource 添加 log4j.properties 配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">log4j.rootLogger=INFO, stdout<br>log4j.appender.stdout=org.apache.log4j.ConsoleAppender<br>log4j.appender.stdout.layout=org.apache.log4j.PatternLayout<br>log4j.appender.stdout.layout.ConversionPattern=%d %p [%c] - %m%n<br>log4j.appender.logfile=org.apache.log4j.FileAppender<br>log4j.appender.logfile.File=target/spring.log<br>log4j.appender.logfile.layout=org.apache.log4j.PatternLayout<br>log4j.appender.logfile.layout.ConversionPattern=%d %p [%c] - %m%n<br></code></pre></td></tr></table></figure><p>创建包名<code>com.atguigu.zk</code><br>创建类名称<code>zkClient</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">public class zkClient &#123;<br><br>    // 注意, 逗号左右不能有空格<br>    private String connectString = <span class="hljs-string">&quot;hadoop202:2181,hadoop203:2181,hadoop204:2181&quot;</span>;<br>    private int sessionTimeout = 2000;<br>    private ZooKeeper zooKeeper;<br><br>    // 连接zookeeper<br>    @Before<br>    public void init() throws IOException &#123;<br>        zooKeeper = new ZooKeeper(connectString, sessionTimeout, new <span class="hljs-function"><span class="hljs-title">Watcher</span></span>() &#123;<br>            @Override<br>            public void process(WatchedEvent watchedEvent) &#123;<br><br>            &#125;<br>        &#125;);<br>    &#125;<br><br>    @Test<br>    public void create() throws InterruptedException, KeeperException &#123;<br>        // 创建一个节点<br>        String nodeCreated = zooKeeper.create(<span class="hljs-string">&quot;/atguigu&quot;</span>, <span class="hljs-string">&quot;ss.avi&quot;</span>.getBytes(),<br>                ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="客户端-监听节点的变化"><a href="#客户端-监听节点的变化" class="headerlink" title="客户端-监听节点的变化"></a>客户端-监听节点的变化</h2><p>getChildren 中第二个参数为 true 会调用 init 中 new Watch(){…}</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">  @Before<br>  public void init() throws IOException &#123;<br>      zooKeeper = new ZooKeeper(connectString, sessionTimeout, new <span class="hljs-function"><span class="hljs-title">Watcher</span></span>() &#123;<br>          @Override<br>          public void process(WatchedEvent watchedEvent) &#123;<br>              List&lt;String&gt; children = null;<br>              try &#123;<br>                  children = zooKeeper.getChildren(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-literal">true</span>);<br>              &#125; catch (KeeperException e) &#123;<br>                  e.printStackTrace();<br>              &#125; catch (InterruptedException e) &#123;<br>                  e.printStackTrace();<br>              &#125;<br>              System.out.println(<span class="hljs-string">&quot;------------------&quot;</span>);<br>              <span class="hljs-keyword">for</span> (String child : children) &#123;<br>                  System.out.println(child);<br>              &#125;<br>              System.out.println(<span class="hljs-string">&quot;------------------&quot;</span>);<br>          &#125;<br>      &#125;);<br>  &#125;<br><br><br>@Test<br>  public void getChildren() throws InterruptedException, KeeperException &#123;<br>      List&lt;String&gt; children = zooKeeper.getChildren(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-literal">true</span>);<br><br>      Thread.<span class="hljs-built_in">sleep</span>(Long.MAX_VALUE);<br>  &#125;<br></code></pre></td></tr></table></figure><p>监听的同时, 在 linux 中添加&#x2F;删除节点, idea 能监听得到<br><img src="/assets/d734a11578e544bfa6d3ceb53eb9f41c.png"><br><img src="/assets/89a999958d1f4d708d7b7b6c460f29d2.png"></p><h2 id="客户端-判断节点是否存在"><a href="#客户端-判断节点是否存在" class="headerlink" title="客户端-判断节点是否存在"></a>客户端-判断节点是否存在</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">// 判断Znode是否存在<br>@Test<br>public void exist() throws InterruptedException, KeeperException &#123;<br>    Stat <span class="hljs-built_in">stat</span> = zooKeeper.exists(<span class="hljs-string">&quot;/atguigu&quot;</span>, <span class="hljs-literal">false</span>);<br>    System.out.println(<span class="hljs-built_in">stat</span> == null ? <span class="hljs-string">&quot;not exist&quot;</span> : <span class="hljs-string">&quot;exist&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="写数据原理"><a href="#写数据原理" class="headerlink" title="写数据原理"></a>写数据原理</h2><p>ack 表示应答<br>write 表示写操作<br><img src="/assets/b33c38c6217a4824b52d5b9ad3fa4529.png"><br><img src="/assets/b1456158521d4de58808d45f0801164e.png"></p><h2 id="服务器动态上下线"><a href="#服务器动态上下线" class="headerlink" title="服务器动态上下线"></a>服务器动态上下线</h2><p><img src="/assets/e3234a451d1c49d5ab882e24e821f73d.png"></p><p>操作上线<br><img src="/assets/a85d91052ff946b0b97fa9924e004268.png"><br>操作下线<br><img src="/assets/e0f654dfd5b542af84f388905d4b2da1.png"></p><p>DistributeServer 代码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs bash">package com.atguigu.case1;<br><br>import org.apache.zookeeper.*;<br><br>import java.io.IOException;<br><br>public class DistributeServer &#123;<br>    private String connectString = <span class="hljs-string">&quot;hadoop202:2181,hadoop203:2181,hadoop204:2181&quot;</span>;<br>    private int sessionTimeout = 2000;<br>    private ZooKeeper zooKeeper;<br><br>    public static void main(String[] args) throws IOException, InterruptedException, KeeperException &#123;<br>        DistributeServer server = new DistributeServer();<br>        // 获取zk连接<br>        server.getConnect();<br><br>        // 注册服务器到zk集群<br>        server.register(args[0]);<br><br>        // 启动业务逻辑(睡觉)<br>        server.bussiness();<br>    &#125;<br><br>    private void bussiness() throws InterruptedException &#123;<br>        Thread.<span class="hljs-built_in">sleep</span>(Long.MAX_VALUE);<br>    &#125;<br><br>    private void register(String hostname) throws InterruptedException, KeeperException &#123;<br>        String create = zooKeeper.create(<span class="hljs-string">&quot;/servers/&quot;</span> + hostname, hostname.getBytes(),<br>                ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL_SEQUENTIAL);<br><br>        System.out.println(hostname + <span class="hljs-string">&quot; is online&quot;</span>);<br>    &#125;<br><br>    private void getConnect() throws IOException &#123;<br>        zooKeeper = new ZooKeeper(connectString, sessionTimeout, new <span class="hljs-function"><span class="hljs-title">Watcher</span></span>() &#123;<br>            @Override<br>            public void process(WatchedEvent event) &#123;<br><br>            &#125;<br>        &#125;);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>DistributeClient 代码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs bash">package com.atguigu.case1;<br><br>import org.apache.zookeeper.KeeperException;<br>import org.apache.zookeeper.WatchedEvent;<br>import org.apache.zookeeper.Watcher;<br>import org.apache.zookeeper.ZooKeeper;<br><br>import java.io.IOException;<br>import java.util.ArrayList;<br>import java.util.List;<br><br>public class DistributeClient &#123;<br>    private String connectString = <span class="hljs-string">&quot;hadoop202:2181,hadoop203:2181,hadoop204:2181&quot;</span>;<br>    private int sessionTimeout = 2000;<br>    private ZooKeeper zooKeeper;<br><br><br>    public static void main(String[] args) throws InterruptedException, IOException, KeeperException &#123;<br>        DistributeClient client = new DistributeClient();<br><br>        // 获取zk连接<br>        client.getConnect();<br><br>        // 监听/servers下面子节点的增加和删除<br>        client.getServerList();<br><br>        // 业务逻辑(睡觉)<br>        client.bussiness();<br>    &#125;<br><br>    private void bussiness() throws InterruptedException &#123;<br>        Thread.<span class="hljs-built_in">sleep</span>(Long.MAX_VALUE);<br>    &#125;<br><br>    private void getServerList() throws InterruptedException, KeeperException &#123;<br>        List&lt;String&gt; children = zooKeeper.getChildren(<span class="hljs-string">&quot;/servers&quot;</span>, <span class="hljs-literal">true</span>);<br>        ArrayList&lt;String&gt; servers = new ArrayList&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (String child : children) &#123;<br>            byte[] data = zooKeeper.getData(<span class="hljs-string">&quot;/servers/&quot;</span> + child, <span class="hljs-literal">false</span>, null);<br>            servers.add(new String(data));<br>        &#125;<br><br>        System.out.println(servers);<br>    &#125;<br><br>    private void getConnect() throws IOException &#123;<br>        zooKeeper = new ZooKeeper(connectString, sessionTimeout, new <span class="hljs-function"><span class="hljs-title">Watcher</span></span>() &#123;<br>            @Override<br>            public void process(WatchedEvent event) &#123;<br>                try &#123;<br>                    getServerList();<br>                &#125; catch (Exception e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>        &#125;);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><img src="/assets/b6c4fab9a99f41b3b5216d6164f2fb91.png"><br>tips:<br>运行 main 的时候需要传入参数, 在 idea 中传入参数的方式如下<br>在 Program arguments 中填写传入的参数<br><img src="/assets/ca1a045f76c4434da6fb01583a0eed92.png"></p><h2 id="分布式锁"><a href="#分布式锁" class="headerlink" title="分布式锁"></a>分布式锁</h2><p>什么叫做分布式锁呢？<br>比如说”进程 1”在使用该资源的时候，会先去获得锁，”进程 1”获得锁以后会对该资源保持独占，这样其他进程就无法访问该资源，”进程 1”用完该资源以后就将锁释放掉，让其他进程来获得锁，那么通过这个锁机制，我们就能保证了分布式系统中多个进程能够有序的访问该临界资源。那么我们把这个分布式环境下的这个锁叫作分布式锁。<br><img src="/assets/7efd51ef4ab74574b95f0e4b7cca5d8d.png"><br>DistributedLock 代码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><code class="hljs bash">package com.atguigu.case2;<br><br>import org.apache.zookeeper.*;<br>import org.apache.zookeeper.data.Stat;<br><br>import java.io.IOException;<br>import java.util.Collections;<br>import java.util.List;<br>import java.util.concurrent.CountDownLatch;<br><br>public class DistributedLock &#123;<br><br>    private final String connectString = <span class="hljs-string">&quot;hadoop202:2181,hadoop203:2181,hadoop204:2181&quot;</span>;<br>    private final int sessionTimeout = 2000;<br>    private final ZooKeeper zooKeeper;<br><br>    private CountDownLatch countDownLatch = new CountDownLatch(1);<br>    private CountDownLatch waitLatch = new CountDownLatch(1);<br>    private String currentMode;<br>    private String waitPath;<br><br>    public DistributedLock() throws IOException, InterruptedException, KeeperException &#123;<br>        // 获取连接<br>        zooKeeper = new ZooKeeper(connectString, sessionTimeout, new <span class="hljs-function"><span class="hljs-title">Watcher</span></span>() &#123;<br>            @Override<br>            public void process(WatchedEvent watchedEvent) &#123;<br>                // connectLatch 如果连接上zk 可以释放<br>                <span class="hljs-keyword">if</span> (watchedEvent.getState() == Event.KeeperState.SyncConnected) &#123;<br>                    countDownLatch.countDown();<br>                &#125;<br><br>                // waitLatch 需要释放<br>                <span class="hljs-keyword">if</span> (watchedEvent.getType() == Event.EventType.NodeDeleted<br>                        &amp;&amp; watchedEvent.getPath().equals(waitPath)) &#123;<br>                    waitLatch.countDown();<br>                &#125;<br>            &#125;<br>        &#125;);<br><br>        // 等待zk正常连接后, 往下走程序<br>        countDownLatch.await();<br><br>        // 判断根节点/locks是否存在<br>        Stat <span class="hljs-built_in">stat</span> = zooKeeper.exists(<span class="hljs-string">&quot;/locks&quot;</span>, <span class="hljs-literal">false</span>);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">stat</span> == null) &#123;<br>            // 创建一下根节点<br>            zooKeeper.create(<span class="hljs-string">&quot;/locks&quot;</span>, <span class="hljs-string">&quot;locks&quot;</span>.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);<br>        &#125;<br>    &#125;<br><br>    // 对zk加锁<br>    public void <span class="hljs-function"><span class="hljs-title">zkLock</span></span>() &#123;<br>        // 创建对应的临时带序号节点<br>        try &#123;<br>            currentMode = zooKeeper.create(<span class="hljs-string">&quot;/locks/&quot;</span> + <span class="hljs-string">&quot;seq-&quot;</span>, null, ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL_SEQUENTIAL);<br><br>            // 判断创建的节点是否是最小序号节点, 如果是获取到锁, 如果不是, 监听序号前一个节点<br>            List&lt;String&gt; children = zooKeeper.getChildren(<span class="hljs-string">&quot;/locks&quot;</span>, <span class="hljs-literal">false</span>);<br><br>            // 如果children 只有一个值, 那就直接获取锁, 如果有多个节点, 需要判断, 谁最小<br>            <span class="hljs-keyword">if</span> (children.size() == 1) &#123;<br>                <span class="hljs-built_in">return</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                Collections.<span class="hljs-built_in">sort</span>(children);<br><br>                // 获取节点名称 seq-00000000<br>                String thisNode = currentMode.substring(<span class="hljs-string">&quot;/locks/&quot;</span>.length());<br>                // 通过seq-00000000获取该节点在children结合的位置<br>                int index = children.indexOf(thisNode);<br><br>                // 判断<br>                <span class="hljs-keyword">if</span> (index == -1) &#123;<br>                    System.out.println(<span class="hljs-string">&quot;数据异常&quot;</span>);<br>                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (index == 0) &#123;<br>                    // 就一个节点, 可以获取锁了<br>                    <span class="hljs-built_in">return</span>;<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    // 需要监听他前一个节点变化<br>                    waitPath = <span class="hljs-string">&quot;/locks/&quot;</span> + children.get(index - 1);<br>                    zooKeeper.getData(waitPath, <span class="hljs-literal">true</span>, null);<br><br>                    // 等待监听<br>                    waitLatch.await();<br><br>                    <span class="hljs-built_in">return</span>;<br>                &#125;<br>            &#125;<br><br>        &#125; catch (KeeperException e) &#123;<br>            e.printStackTrace();<br>        &#125; catch (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br><br>    // 解锁<br>    public void <span class="hljs-function"><span class="hljs-title">unZkLock</span></span>() &#123;<br>        // 删除节点<br>        try &#123;<br>            zooKeeper.delete(currentMode, -1);<br>        &#125; catch (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125; catch (KeeperException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>DistributedLockTest 代码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs bash">package com.atguigu.case2;<br><br>import org.apache.zookeeper.KeeperException;<br><br>import java.io.IOException;<br><br>public class DistributedLockTest &#123;<br>    public static void main(String[] args) throws IOException, InterruptedException, KeeperException &#123;<br>        final DistributedLock lock1 = new DistributedLock();<br>        final DistributedLock lock2 = new DistributedLock();<br><br>        new Thread(new <span class="hljs-function"><span class="hljs-title">Runnable</span></span>() &#123;<br>            @Override<br>            public void <span class="hljs-function"><span class="hljs-title">run</span></span>() &#123;<br>                try &#123;<br>                    lock1.zkLock();<br>                    System.out.println(<span class="hljs-string">&quot;线程1启动 获取到锁&quot;</span>);<br>                    Thread.<span class="hljs-built_in">sleep</span>(5 * 1000);<br><br>                    lock1.unZkLock();<br>                    System.out.println(<span class="hljs-string">&quot;线程1 释放锁&quot;</span>);<br>                &#125; catch (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>        &#125;).start();<br><br>        new Thread(new <span class="hljs-function"><span class="hljs-title">Runnable</span></span>() &#123;<br>            @Override<br>            public void <span class="hljs-function"><span class="hljs-title">run</span></span>() &#123;<br>                try &#123;<br>                    lock2.zkLock();<br>                    System.out.println(<span class="hljs-string">&quot;线程2启动 获取到锁&quot;</span>);<br>                    Thread.<span class="hljs-built_in">sleep</span>(5 * 1000);<br><br>                    lock2.unZkLock();<br>                    System.out.println(<span class="hljs-string">&quot;线程2 释放锁&quot;</span>);<br>                &#125; catch (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>        &#125;).start();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>运行结果如下:<br>线程 2 先获取锁, 当锁释放掉之后, 才会给其他线程上锁<br><img src="/assets/6afaed600bdf40dfb25726bfc105c8d1.png"></p><h2 id="Curator-框架实现分布式锁案例"><a href="#Curator-框架实现分布式锁案例" class="headerlink" title="Curator 框架实现分布式锁案例"></a>Curator 框架实现分布式锁案例</h2><p>pom.xml 导入依赖</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;dependency&gt;<br>    &lt;groupId&gt;org.apache.curator&lt;/groupId&gt;<br>    &lt;artifactId&gt;curator-framework&lt;/artifactId&gt;<br>    &lt;version&gt;4.3.0&lt;/version&gt;<br>&lt;/dependency&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;org.apache.curator&lt;/groupId&gt;<br>    &lt;artifactId&gt;curator-recipes&lt;/artifactId&gt;<br>    &lt;version&gt;4.3.0&lt;/version&gt;<br>&lt;/dependency&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;org.apache.curator&lt;/groupId&gt;<br>    &lt;artifactId&gt;curator-client&lt;/artifactId&gt;<br>    &lt;version&gt;4.3.0&lt;/version&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure><p>CuratorLockTest 代码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><code class="hljs bash">package com.atguigu.case3;<br><br>import org.apache.curator.framework.CuratorFramework;<br>import org.apache.curator.framework.CuratorFrameworkFactory;<br>import org.apache.curator.framework.recipes.locks.InterProcessMutex;<br>import org.apache.curator.retry.ExponentialBackoffRetry;<br><br>public class CuratorLockTest &#123;<br>    public static void main(String[] args) &#123;<br>        // 创建分布式锁1<br>        InterProcessMutex lock1 = new InterProcessMutex(getCuratorFramework(), <span class="hljs-string">&quot;/locks&quot;</span>);<br><br>        // 创建分布式锁2<br>        InterProcessMutex lock2 = new InterProcessMutex(getCuratorFramework(), <span class="hljs-string">&quot;/locks&quot;</span>);<br><br>        new Thread(new <span class="hljs-function"><span class="hljs-title">Runnable</span></span>() &#123;<br>            @Override<br>            public void <span class="hljs-function"><span class="hljs-title">run</span></span>() &#123;<br>                try &#123;<br>                    lock1.acquire();<br>                    System.out.println(<span class="hljs-string">&quot;线程1 获取到锁&quot;</span>);<br><br>                    lock1.acquire();<br>                    System.out.println(<span class="hljs-string">&quot;线程1 再次获取到锁&quot;</span>);<br><br>                    Thread.<span class="hljs-built_in">sleep</span>(5 * 1000);<br><br>                    lock1.release();<br>                    System.out.println(<span class="hljs-string">&quot;线程1 释放锁&quot;</span>);<br><br>                    lock1.release();<br>                    System.out.println(<span class="hljs-string">&quot;线程1 再次释放锁&quot;</span>);<br><br>                &#125; catch (Exception e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>        &#125;).start();<br><br>        new Thread(new <span class="hljs-function"><span class="hljs-title">Runnable</span></span>() &#123;<br>            @Override<br>            public void <span class="hljs-function"><span class="hljs-title">run</span></span>() &#123;<br>                try &#123;<br>                    lock2.acquire();<br>                    System.out.println(<span class="hljs-string">&quot;线程2 获取到锁&quot;</span>);<br><br>                    lock2.acquire();<br>                    System.out.println(<span class="hljs-string">&quot;线程2 再次获取到锁&quot;</span>);<br><br>                    Thread.<span class="hljs-built_in">sleep</span>(5 * 1000);<br><br>                    lock2.release();<br>                    System.out.println(<span class="hljs-string">&quot;线程2 释放锁&quot;</span>);<br><br>                    lock2.release();<br>                    System.out.println(<span class="hljs-string">&quot;线程2 再次释放锁&quot;</span>);<br><br>                &#125; catch (Exception e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>        &#125;).start();<br>    &#125;<br><br>    private static CuratorFramework <span class="hljs-function"><span class="hljs-title">getCuratorFramework</span></span>() &#123;<br><br>        ExponentialBackoffRetry policy = new ExponentialBackoffRetry(3000, 3);<br><br>        CuratorFramework client = CuratorFrameworkFactory.builder()<br>                .connectString(<span class="hljs-string">&quot;hadoop202:2181,hadoop203:2181,hadoop204:2181&quot;</span>)<br>                .connectionTimeoutMs(2000)<br>                .sessionTimeoutMs(2000)<br>                .retryPolicy(policy)<br>                .build();<br><br>        // 启动客户端<br>        client.start();<br><br>        System.out.println(<span class="hljs-string">&quot;zookeeper 启动成功&quot;</span>);<br><br>        <span class="hljs-built_in">return</span> client;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>说明同一个线程中锁是可以多次获取的<br><img src="/assets/34b0397a3a7f45aba67da0bd9c0b8155.png"></p><h2 id="企业面试真题（面试重点）"><a href="#企业面试真题（面试重点）" class="headerlink" title="企业面试真题（面试重点）"></a>企业面试真题（面试重点）</h2><h3 id="选举机制"><a href="#选举机制" class="headerlink" title="选举机制"></a>选举机制</h3><p>半数机制，超过半数的投票通过，即通过。<br>（1） 第一次启动选举规则：<br>投票过半数时，服务器 id 大的胜出<br>（2） 第二次启动选举规则：<br>①EPOCH 大的直接胜出<br>②EPOCH 相同，事务 id 大的胜出<br>③ 事务 id 相同，服务器 id 大的胜出</p><h3 id="生产集群安装多少-zk-合适？"><a href="#生产集群安装多少-zk-合适？" class="headerlink" title="生产集群安装多少 zk 合适？"></a>生产集群安装多少 zk 合适？</h3><p>安装奇数台。生产经验：<br>l 10 台服务器：3 台 zk；<br>l 20 台服务器：5 台 zk；<br>l 100 台服务器：11 台 zk；<br>l 200 台服务器：11 台 zk<br>服务器台数多：好处，提高可靠性；坏处：提高通信延时</p><h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><p>ls、get、create、delete</p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>ZooKeeper</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Yarn</title>
    <link href="/Hadoop/Yarn/"/>
    <url>/Hadoop/Yarn/</url>
    
    <content type="html"><![CDATA[<p>指定向 hive 对象提交任务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[xiamu@hadoop202 hadoop-3.1.3]$ hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-3.1.3.jar wordcount -D mapreduce.job.queuename=hive /input /output5<br><br></code></pre></td></tr></table></figure><p>也可以在打包之前的驱动指定向其他队列提交作业</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">public class WcDrvier &#123;<br><br>    public static void main(String[] args) throws IOException, ClassNotFoundException, InterruptedException &#123;<br><br>        Configuration conf = new Configuration();<br><br>        conf.set(<span class="hljs-string">&quot;mapreduce.job.queuename&quot;</span>,<span class="hljs-string">&quot;hive&quot;</span>);<br><br>        //1. 获取一个Job实例<br>        Job job = Job.getInstance(conf);<br><br>        。。。 。。。<br><br>        //6. 提交Job<br>        boolean b = job.waitForCompletion(<span class="hljs-literal">true</span>);<br>        System.<span class="hljs-built_in">exit</span>(b ? 0 : 1);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hadoop</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hadoop</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MapReduce</title>
    <link href="/Hadoop/MapReduce/"/>
    <url>/Hadoop/MapReduce/</url>
    
    <content type="html"><![CDATA[<h2 id="编写-WordCount"><a href="#编写-WordCount" class="headerlink" title="编写 WordCount"></a>编写 WordCount</h2><p>WordCountMapper 代码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">/**<br> * KEYIN, map阶段输入的key的类型: LongWritable<br> * VALUEIN, map阶段输入value类型: Text<br> * KEYOUT, map阶段输出的Key类型: Text<br> * VALUEOUT, map阶段输出的value类型: IntWritable<br> */<br>public class WordCountMapper extends Mapper&lt;LongWritable, Text, Text, IntWritable&gt; &#123;<br><br>    private Text outK = new Text();<br>    private IntWritable outV = new IntWritable(1);<br><br>    @Override<br>    protected void map(LongWritable key, Text value, Mapper&lt;LongWritable, Text, Text, IntWritable&gt;.Context context) throws IOException, InterruptedException &#123;<br>        // 1.获取一行<br>        String line = key.toString();<br><br>        // 2.切割<br>        String[] words = line.split(<span class="hljs-string">&quot; &quot;</span>);<br><br>        // 3.循环写出<br>        <span class="hljs-keyword">for</span> (String word : words) &#123;<br>            outK.<span class="hljs-built_in">set</span>(word);<br>            context.write(outK, outV);<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>WordCountDriver</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">public class WordCountDriver &#123;<br>    public static void main(String[] args) throws IOException, InterruptedException, ClassNotFoundException &#123;<br>        // 1.获取job<br>        Configuration conf = new Configuration();<br>        Job job = Job.getInstance(conf);<br><br>        // 2.设置jar包路径<br>        job.setJarByClass(WordCountDriver.class);<br><br>        // 3.关联mapper和reducer<br>        job.setMapperClass(WordCountMapper.class);<br>        job.setReducerClass(WordCountReducer.class);<br><br>        // 4.设置map输出的kv类型<br>        job.setMapOutputKeyClass(Text.class);<br>        job.setOutputValueClass(IntWritable.class);<br><br>        // 5.设置最终输出的kv类型<br>        job.setOutputKeyClass(Text.class);<br>        job.setOutputValueClass(IntWritable.class);<br><br>        // 6.设置输入路径和输出路径<br>        FileInputFormat.addInputPath(job, new Path(<span class="hljs-string">&quot;E:\\hadoop\\input&quot;</span>));<br>        FileOutputFormat.setOutputPath(job, new Path(<span class="hljs-string">&quot;E:\\hadoop\\output666&quot;</span>));<br><br>        // 7.提交job<br>        boolean result = job.waitForCompletion(<span class="hljs-literal">true</span>);<br><br>        System.<span class="hljs-built_in">exit</span>(result ? 0 : 1);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>WordCountMapper</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">/**<br> * KEYIN, reduce阶段输入的key的类型: LongWritable<br> * VALUEIN, reduce阶段输入value类型: Text<br> * KEYOUT, reduce阶段输出的Key类型: Text<br> * VALUEOUT, reduce阶段输出的value类型: IntWritable<br> */<br>public class WordCountReducer extends Reducer&lt;Text, IntWritable, Text, IntWritable&gt; &#123;<br><br>    private IntWritable outV = new IntWritable();<br><br>    @Override<br>    protected void reduce(Text key, Iterable&lt;IntWritable&gt; values, Reducer&lt;Text, IntWritable, Text, IntWritable&gt;.Context context) throws IOException, InterruptedException &#123;<br><br>        int <span class="hljs-built_in">sum</span> = 0;<br>        // 累加<br>        <span class="hljs-keyword">for</span> (IntWritable value : values) &#123;<br>            <span class="hljs-built_in">sum</span> += value.get();<br>        &#125;<br><br>        outV.<span class="hljs-built_in">set</span>(<span class="hljs-built_in">sum</span>);<br><br>        // 写出<br>        context.write(key, outV);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>将代码打包上传到 hadoop, 然后进行测试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[xiamu@hadoop202 hadoop-3.1.3]$ hadoop jar wc.jar com.atguigu.mapreduce.wordcount2.WordCountDriver /input /output<br><br></code></pre></td></tr></table></figure><h2 id="Partition-分区"><a href="#Partition-分区" class="headerlink" title="Partition 分区"></a>Partition 分区</h2><p>分区总结<br>(1) 如果 ReduceTask 的数量&gt;getPartition 的结果数, 则会多产生几个空的输出文件 part-r-000xx;<br>(2) 如果 1&lt;ReduceTask 的数量&lt;getPartition 的结果数, 则有一部分分区数据无处安放, 会 Exception<br>(3) 如果 ReduceTask 的数量&#x3D;1, 则不管 MapTask 端输出多少个分区文件, 最终结果都交给这一个 ReduceTask, 最终也就只会产生一个结果文件 part-r-00000;<br>(4) 分区号必须从零开始, 逐一累加</p><p>例如: 假设自定义分区数为 5, 则<br>(1) job.setNumReduceTasks(1); 会正常运行, 只不过会产生一个输出文件<br>(2) job.setNumReduceTasks(2); 会报错<br>(3) job.setNumReduceTasks(6);</p><h2 id="MapTask-工作机制"><a href="#MapTask-工作机制" class="headerlink" title="MapTask 工作机制"></a>MapTask 工作机制</h2><p>Read 阶段, Map 阶段, Collect 阶段, 溢写阶段, Merge 阶段<br><img src="/assets/df754bbe23d647b594d88de77bc3b099.png"></p><h2 id="ReduceTask-工作机制"><a href="#ReduceTask-工作机制" class="headerlink" title="ReduceTask 工作机制"></a>ReduceTask 工作机制</h2><p>copy 阶段, sort 阶段, reduce 阶段<br><img src="/assets/911c25fd73cc46eeaa0aa7ac445edc17.png"></p>]]></content>
    
    
    <categories>
      
      <category>Hadoop</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hadoop</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Snipaste</title>
    <link href="/%E8%BD%AF%E4%BB%B6/Snipaste/"/>
    <url>/%E8%BD%AF%E4%BB%B6/Snipaste/</url>
    
    <content type="html"><![CDATA[<p>下载<a href="https://www.snipaste.com/">Snipaste</a>解压, 然后双击 Snipaste.exe<br><img src="/assets/89548b8d488344ca8f8c3ede99657234.png"></p><p>按<code>F1</code>开始截图<br>按<code>F3</code>(贴图)把截图粘贴到浮动窗口<br>也可以把剪切板中的图片或者文件粘贴到浮动窗口<br>缩放 (<code>鼠标滚动</code>或者<code>+</code>&#x2F;<code>-</code>)<br>旋转(<code>1</code>&#x2F;<code>2</code>)<br>翻转(<code>3</code>&#x2F;<code>4</code>)<br>设置透明度(<code>Ctrl</code> + <code>鼠标滚动</code> 或者 <code>Ctrl</code>+<code>+</code>&#x2F;<code>-</code> )<br>图片编辑(<code>Space</code>)<br>缩略图模式(<code>Shift</code>+<code>鼠标双击</code>)<br>隐藏(<code>鼠标双击</code>)</p><p>回放截图记录<br>按<code>,</code>或<code>.</code></p><p>放大镜<code>Alt</code><br>在放大镜模式下按<code>C</code>取色</p><p>调整画笔宽度<br><code>鼠标滚轮</code><br><code>1``2</code></p><p><code>-</code></p><p>高级技巧<br>按住 Shift 拖动贴图, 可以对齐</p>]]></content>
    
    
    <categories>
      
      <category>软件</category>
      
    </categories>
    
    
    <tags>
      
      <tag>软件</tag>
      
      <tag>小工具</tag>
      
      <tag>Snipaste</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>node-sass</title>
    <link href="/uncategorized/node-sass/"/>
    <url>/uncategorized/node-sass/</url>
    
    <content type="html"><![CDATA[<p>使用 npm i 安装报错,</p><ul><li>gyp err xxx</li><li>gyp verb check python checking for Python executable “python2” in the PATH</li></ul><p>参考地址: <a href="https://github.com/lenve/VBlog/issues/79">https://github.com/lenve/VBlog/issues/79</a><br><img src="/assets/d1386c5042804332a9ca682a6c866d05.png"></p><p>只需要删除 package.json 中的<br>“node-sass”: “^4.14.1”,<br>“sass-loader”: “^6.0.6”,<br><img src="/assets/aac7af8860a84b66a9fcc46252d0640e.png"></p><p>如果页面出现有 can not resolve sass-loader, 把对应的 scss 删除掉<br><img src="/assets/aaba839cdc694ec09dad29ec0c56934c.png"><br><img src="/assets/1f73b304c12240f58045bd93926425c9.png"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>HDFS</title>
    <link href="/Hadoop/HDFS/"/>
    <url>/Hadoop/HDFS/</url>
    
    <content type="html"><![CDATA[<h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>HDFS(Hadoop Distributed File System), 它是一个文件系统, 用于存储文件, 通过目录树来定位文件;<br>其次, 它是分布式, 由很多服务器联合起来实现其功能, 集群中的服务器有各自的角色.<br>HDFS 的使用场景, 适合一次写入, 多次读书的场景. 一个文件经过创建, 写入和关闭之后就不需要改变.<br>思考:<br>NameNode 在生产环境中一般是 128G 的内存, 能存多少文件? 一个文件块占用 150 个字节, 128G 的内存能存储 9 亿个文件块<br>计算过程:<br>128G &#x3D; 128 _ 1024M &#x3D; 128 _ 1024 _ 1024KB &#x3D; 128 _ 1024 _ 1024 _ 1024Byte &#x3D; 237 Byte&#x3D; 137438953472Byte<br>一个文件块大小是 150Byte<br>那么能够存储的文件数量是<img src="/assets/45e5cf5fe538432f93150df2653c1abc.png"> &#x3D; 916259689.813 ≈ 9 亿<br>tip: Byte 是字节, bit 是位<br><img src="/assets/60df08894ec84d4fa3ec9235087839a1.png"></p><h2 id="组成架构"><a href="#组成架构" class="headerlink" title="组成架构"></a>组成架构</h2><p><img src="/assets/d7557f260dd24e73b90fe2cbe8f83595.png"><br><img src="/assets/cfe9f404f95e4899ae96370eeeda2ed8.png"><br>在 hdfs 创建文件夹:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[xiamu@hadoop202 bin]$ hadoop fs -<span class="hljs-built_in">mkdir</span> /aaa<br><br></code></pre></td></tr></table></figure><p><img src="/assets/9514d501f27f45318897d42b00a616cd.png"></p><h2 id="文件块大小"><a href="#文件块大小" class="headerlink" title="文件块大小"></a>文件块大小</h2><p>HDFS 中的文件在物理上是分块存储(Block), 块的大小可以通过配置参数(dfs.blocksize)来规定, 默认大小在 Hadoop2.x&#x2F;3.x 版本中是 128M, 1.x 版本中是 64M</p><p>总结: HDFS 块的大小设置主要取决于磁盘传输速率</p><h2 id="HDFS-的-Shell-操作-开发重点"><a href="#HDFS-的-Shell-操作-开发重点" class="headerlink" title="HDFS 的 Shell 操作(开发重点)"></a>HDFS 的 Shell 操作(开发重点)</h2><p>hadoop fs 具体命令 OR hdfs dfs 具体命令<br>两个是完全相同的</p><h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><p>启动 Hadoop 集群<br><code>[xiamu@hadoop202 bin]$ myhadoop.sh start</code><br>-help: 查看命令如何使用<br><code>[xiamu@hadoop202 bin]$ hadoop fs -help rm</code><br>创建文件夹<br><code>[xiamu@hadoop202 bin]$ hadoop fs -mkdir /sanguo</code></p><h3 id="上传"><a href="#上传" class="headerlink" title="上传"></a>上传</h3><ol><li>moveFromLocal 的使用:</li></ol><p>新建文件, 上传文件(剪切文件)<br><code>[xiamu@hadoop202 hadoop-3.1.3]$ vim shuguo.txt</code><br><code>[xiamu@hadoop202 hadoop-3.1.3]$ hadoop fs -moveFromLocal ./shuguo.txt /sanguo</code></p><ol start="2"><li>copyFromLocal 的使用</li></ol><p>新建文件, 拷贝文件(本地的文件仍然存在)<br><code>[xiamu@hadoop202 hadoop-3.1.3]$ vim weiguo.txt</code><br><code>[xiamu@hadoop202 hadoop-3.1.3]$ hadoop fs -copyFromLocal weiguo.txt /sanguo</code></p><ol start="3"><li>put 约同于 copyFromLocal, 生产环境更习惯用 put</li></ol><p><code>[xiamu@hadoop202 hadoop-3.1.3]$ vim wuguo.txt</code><br><code>[xiamu@hadoop202 hadoop-3.1.3]$ hadoop fs -put wuguo.txt /sanguo</code></p><ol start="4"><li>appendToFile 追加一个文件到已经存在的文件末尾</li></ol><p><code>[xiamu@hadoop202 hadoop-3.1.3]$ vim liubei.txt</code><br><code>[xiamu@hadoop202 hadoop-3.1.3]$ hadoop fs -appendToFile liubei.txt /sanguo/shuguo.txt</code></p><p>HDFS 的特性, 只能追加内容, 不能修改原有的内容</p><h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><ol><li>copyToLocal, 从 HDFS 拷贝到本地</li></ol><p><code>[xiamu@hadoop202 hadoop-3.1.3]$ hadoop fs -copyToLocal /sanguo/shuguo.txt ./</code></p><ol start="2"><li>等同于 copyToLocal，生产环境更习惯用 get</li></ol><p><code>[xiamu@hadoop202 hadoop-3.1.3]$ hadoop fs -get /sanguo/shuguo.txt ./shuguo2.txt</code></p><h3 id="HDFS-直接操作"><a href="#HDFS-直接操作" class="headerlink" title="HDFS 直接操作"></a><strong>HDFS 直接操作</strong></h3><ol><li>-ls: 显示目录信息</li></ol><p><code>[xiamu@hadoop202 hadoop-3.1.3]$ hadoop fs -ls /sanguo</code></p><ol start="2"><li>-cat: 显示文件内容</li></ol><p><code>[xiamu@hadoop202 hadoop-3.1.3]$ hadoop fs -cat /sanguo/shuguo.txt</code></p><ol start="3"><li>-chgrp、-chmod、-chown：Linux 文件系统中的用法一样，修改文件所属权限</li></ol><p><code>[xiamu@hadoop202 hadoop-3.1.3]$ hadoop fs -chown xiamu:xiamu /sanguo/shuguo.txt</code></p><ol start="4"><li>-mkdir：创建路径</li></ol><p><code>[xiamu@hadoop202 hadoop-3.1.3]$ hadoop fs -mkdir /jinguo</code></p><ol start="5"><li>-cp：从 HDFS 的一个路径拷贝到 HDFS 的另一个路径</li></ol><p><code>[xiamu@hadoop202 ~]$ hadoop fs -cp /sanguo/shuguo.txt /jinguo</code></p><ol start="6"><li>-mv：在 HDFS 目录中移动文件</li></ol><p><code>[xiamu@hadoop202 ~]$ hadoop fs -mv /sanguo/weiguo.txt /jinguo</code><br><code>[xiamu@hadoop202 ~]$ hadoop fs -mv /sanguo/wuguo.txt /jinguo</code></p><ol start="7"><li>-tail：显示一个文件的末尾 1kb 的数据</li></ol><p><code>[xiamu@hadoop202 ~]$ hadoop fs -tail /jinguo/shuguo.txt</code></p><ol start="8"><li>-rm：删除文件或文件夹</li></ol><p><code>[xiamu@hadoop202 ~]$ hadoop fs -rm /sanguo/shuguo.txt</code></p><ol start="9"><li>-rm -r：递归删除目录及目录里面内容</li></ol><p><code>[xiamu@hadoop202 ~]$ hadoop fs -rm -r /sanguo</code></p><ol start="10"><li>-du 统计文件夹的大小信息</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">[xiamu@hadoop202 ~]$ hadoop fs -<span class="hljs-built_in">du</span> -s -h /jinguo<br>27  81  /jinguo<br>[xiamu@hadoop202 ~]$ hadoop fs -<span class="hljs-built_in">du</span> -h /jinguo<br>14  42  /jinguo/shuguo.txt<br>7   21  /jinguo/weiguo.txt<br>6   18  /jinguo/wuguo.txt<br><br></code></pre></td></tr></table></figure><p>说明：27 表示文件大小；81 表示 27*3 个副本；&#x2F;jinguo 表示查看的目录</p><ol start="11"><li>-setrep：设置 HDFS 中文件的副本数量</li></ol><p><img src="/assets/a7753434121541b6a7ad43ca7b385bd7.png"><br>这里设置的副本数只是记录在 NameNode 的元数据中，是否真的会有这么多副本，还得看 DataNode 的数量。因为目前只有 3 台设备，最多也就 3 个副本，只有节点数的增加到 10 台时，副本数才能达到 10。</p><h2 id="Windows-配置环境变量"><a href="#Windows-配置环境变量" class="headerlink" title="Windows 配置环境变量"></a>Windows 配置环境变量</h2><p><img src="/assets/9376ac0aa1aa4a1ea4301a400abcadac.png"><br><img src="/assets/cf128ed93f3b4471b1ae0ff9d9dcbfce.png"><br>配置完成之后双击 winutils.exe, 一闪而过说明配置环境变量成功<br><img src="/assets/1e4216c4554a42339bb5907f702fe7f5.png"></p><h2 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h2><p><strong>在 IDEA 中创建一个 Maven 工程 HdfsClientDemo，并导入相应的依赖坐标+日志添加</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;dependencies&gt;<br>    &lt;dependency&gt;<br>        &lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt;<br>        &lt;artifactId&gt;hadoop-client&lt;/artifactId&gt;<br>        &lt;version&gt;3.1.3&lt;/version&gt;<br>    &lt;/dependency&gt;<br>    &lt;dependency&gt;<br>        &lt;groupId&gt;junit&lt;/groupId&gt;<br>        &lt;artifactId&gt;junit&lt;/artifactId&gt;<br>        &lt;version&gt;4.12&lt;/version&gt;<br>    &lt;/dependency&gt;<br>    &lt;dependency&gt;<br>        &lt;groupId&gt;org.slf4j&lt;/groupId&gt;<br>        &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;<br>        &lt;version&gt;1.7.30&lt;/version&gt;<br>    &lt;/dependency&gt;<br>&lt;/dependencies&gt;<br></code></pre></td></tr></table></figure><p>在项目的 src&#x2F;main&#x2F;resources 目录下，新建一个文件，命名为“log4j.properties”，在文件中填入</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">log4j.rootLogger=INFO, stdout<br>log4j.appender.stdout=org.apache.log4j.ConsoleAppender<br>log4j.appender.stdout.layout=org.apache.log4j.PatternLayout<br>log4j.appender.stdout.layout.ConversionPattern=%d %p [%c] - %m%n<br>log4j.appender.logfile=org.apache.log4j.FileAppender<br>log4j.appender.logfile.File=target/spring.log<br>log4j.appender.logfile.layout=org.apache.log4j.PatternLayout<br>log4j.appender.logfile.layout.ConversionPattern=%d %p [%c] - %m%n<br></code></pre></td></tr></table></figure><p><strong>创建包名：com.atguigu.hdfs</strong><br><strong>创建 HdfsClient 类</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">public class HdfsClient &#123;<br><br>    @Test<br>    public void testMkdirs() throws IOException, URISyntaxException, InterruptedException &#123;<br><br>        // 1 获取文件系统<br>        Configuration configuration = new Configuration();<br><br>        // FileSystem fs = FileSystem.get(new URI(<span class="hljs-string">&quot;hdfs://hadoop102:8020&quot;</span>), configuration);<br>        FileSystem fs = FileSystem.get(new URI(<span class="hljs-string">&quot;hdfs://hadoop102:8020&quot;</span>), configuration,<span class="hljs-string">&quot;atguigu&quot;</span>);<br><br>        // 2 创建目录<br>        fs.mkdirs(new Path(<span class="hljs-string">&quot;/xiyou/huaguoshan/&quot;</span>));<br><br>        // 3 关闭资源<br>        fs.close();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="HDFS-API-创建文件夹"><a href="#HDFS-API-创建文件夹" class="headerlink" title="HDFS_API 创建文件夹"></a>HDFS_API 创建文件夹</h2><p>为了方便, 每一个测试类中都会存在获取文件系统, 关闭资源这两个操作, 所以我们可以使用切面抽取出来</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">private FileSystem fs;<br><br>@Before<br>public void init() throws URISyntaxException, IOException, InterruptedException &#123;<br>    // 连接的集群nn地址<br>    URI uri = new URI(<span class="hljs-string">&quot;hdfs://hadoop202:8020&quot;</span>);<br><br>    // 创建一个配置文件<br>    Configuration configuration = new Configuration();<br><br>    // 用户<br>    String user = <span class="hljs-string">&quot;xiamu&quot;</span>;<br><br>    // 获取到客户端对象<br>    fs = FileSystem.get(uri, configuration, user);<br>&#125;<br><br>@After<br>public void close() throws IOException &#123;<br><br>    // 关闭资源<br>    fs.close();<br>&#125;<br><br></code></pre></td></tr></table></figure><p>创建目录代码, 相比于之前的代码, 瞬间精简了很多</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">// 创建目录<br>@Test<br>public void testMkdirs() throws IOException, URISyntaxException, InterruptedException &#123;<br><br>    // 执行相关的操作命令<br>    fs.mkdirs(new Path(<span class="hljs-string">&quot;/xiyou/huaguoshan1&quot;</span>));<br><br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="HDFS-API-上传"><a href="#HDFS-API-上传" class="headerlink" title="HDFS_API 上传"></a>HDFS_API 上传</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">// 上传操作<br>@Test<br>public void testPut() throws IOException &#123;<br>    // 参数解读: 参数一delSrc: 表示删除原数据<br>    // 参数二overwrite: 是否允许覆盖<br>    // 参数三src: 原数据路径<br>    // 参数四dst: 目标数据路径<br>    fs.copyFromLocalFile(<br>            <span class="hljs-literal">true</span>,<br>            <span class="hljs-literal">true</span>,<br>            new Path(<span class="hljs-string">&quot;E:\\sunwukong.txt&quot;</span>),<br>            new Path(<span class="hljs-string">&quot;hdfs://hadoop202/xiyou/huaguoshan&quot;</span>)<br>    );<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="HDFS-API-参数的优先级"><a href="#HDFS-API-参数的优先级" class="headerlink" title="HDFS_API 参数的优先级"></a>HDFS_API 参数的优先级</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">/**<br> * 参数优先级<br> * hdfs-default.xml =&gt; hdfs-site.xml =&gt; 在项目资源目录下的配置文件 =&gt; 代码里面的配置<br> * @throws IOException<br> */<br>@Test<br>public void testPut() throws IOException &#123;<br>    // 参数解读: 参数一delSrc: 表示删除原数据<br>    // 参数二overwrite: 是否允许覆盖<br>    // 参数三src: 原数据路径<br>    // 参数四dst: 目标数据路径<br>    fs.copyFromLocalFile(<br>            <span class="hljs-literal">false</span>,<br>            <span class="hljs-literal">true</span>,<br>            new Path(<span class="hljs-string">&quot;E:\\sunwukong.txt&quot;</span>),<br>            new Path(<span class="hljs-string">&quot;hdfs://hadoop202/xiyou/huaguoshan&quot;</span>)<br>    );<br>&#125;<br></code></pre></td></tr></table></figure><p>在 resource 中创建 hdfs-site.xml, 然后上传文件, 发现副本数量是 1</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;<br>&lt;?xml-stylesheet <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;text/xsl&quot;</span> href=<span class="hljs-string">&quot;configuration.xsl&quot;</span>?&gt;<br><br>&lt;configuration&gt;<br>    &lt;property&gt;<br>        &lt;name&gt;dfs.replication&lt;/name&gt;<br>        &lt;value&gt;1&lt;/value&gt;<br>    &lt;/property&gt;<br>&lt;/configuration&gt;<br></code></pre></td></tr></table></figure><p>修改 init 函数, configuration 中设置 dfs.replication 的值, 然后再次运行代码, 此时的副本数量是 2, 这就说明了这次运行的 dfs.replication 的值会覆盖掉 resource 中的 hdfs-site.xml 里的 dfs.replication 中的值</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">@Before<br>public void init() throws URISyntaxException, IOException, InterruptedException &#123;<br>    // 连接的集群nn地址<br>    URI uri = new URI(<span class="hljs-string">&quot;hdfs://hadoop202:8020&quot;</span>);<br><br>    // 创建一个配置文件<br>    Configuration configuration = new Configuration();<br><br>    configuration.set(<span class="hljs-string">&quot;dfs.replication&quot;</span>, <span class="hljs-string">&quot;2&quot;</span>);<br><br>    // 用户<br>    String user = <span class="hljs-string">&quot;xiamu&quot;</span>;<br><br>    // 获取到客户端对象<br>    fs = FileSystem.get(uri, configuration, user);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="HDFS-API-文件下载"><a href="#HDFS-API-文件下载" class="headerlink" title="HDFS_API 文件下载"></a>HDFS_API 文件下载</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">// 文件下载<br>@Test<br>public void testGet() throws IOException &#123;<br>    // 参数解读:<br>    // 参数一delSrc: 下载完成之后, 是否删除掉hdfs中的原文件<br>    // 参数二src: HDFS中原文件的路径<br>    // 参数三dst: 客户端目标地址的路径<br>    // 参数四useRawLocalFileSystem: 是否开启本地文件的校验<br>    fs.copyToLocalFile(<br>            <span class="hljs-literal">true</span>,<br>            new Path(<span class="hljs-string">&quot;hdfs://hadoop202/xiyou/huaguoshan&quot;</span>),<br>            new Path(<span class="hljs-string">&quot;E:\\huaguosan&quot;</span>),<br>            <span class="hljs-literal">true</span><br>    );<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="HDFS-API-文件删除"><a href="#HDFS-API-文件删除" class="headerlink" title="HDFS_API 文件删除"></a>HDFS_API 文件删除</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">// 删除<br>@Test<br>public void testRm() throws IOException &#123;<br>    // 参数解读:<br>    // 参数一path: 表示要删除的路径<br>    // 参数二b: 表示是否递归删除<br><br>    // 删除文件<br>    // fs.delete(new Path(<span class="hljs-string">&quot;/jdk-8u212-linux-x64.tar.gz&quot;</span>), <span class="hljs-literal">false</span>);<br><br>    // 删除空目录<br>    // fs.delete(new Path(<span class="hljs-string">&quot;/xiyou&quot;</span>), <span class="hljs-literal">false</span>);<br><br>    // 删除非空目录<br>    fs.delete(new Path(<span class="hljs-string">&quot;/jinguo&quot;</span>), <span class="hljs-literal">true</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="HDFS-API-文件更名和移动"><a href="#HDFS-API-文件更名和移动" class="headerlink" title="HDFS_API 文件更名和移动"></a>HDFS_API 文件更名和移动</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">// 文件的更名和移动<br>@Test<br>public void testmv() throws IOException &#123;<br>    // 参数解读:<br>    // 参数一: 原文件路径<br>    // 参数二: 目标文件路径<br>    // 对文件名称的修改:<br>    // fs.rename(new Path(<span class="hljs-string">&quot;/input/word.txt&quot;</span>), new Path(<span class="hljs-string">&quot;/input/ss.txt&quot;</span>));<br><br>    // 文件的移动和更名<br>    // fs.rename(new Path(<span class="hljs-string">&quot;/input/ss.txt&quot;</span>), new Path(<span class="hljs-string">&quot;/cls.txt&quot;</span>));<br><br>    // 目录的更名<br>    fs.rename(new Path(<span class="hljs-string">&quot;/input&quot;</span>), new Path(<span class="hljs-string">&quot;/output&quot;</span>));<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="HDFS-API-文件详细查看"><a href="#HDFS-API-文件详细查看" class="headerlink" title="HDFS_API 文件详细查看"></a>HDFS_API 文件详细查看</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">// 获取文件详细信息<br>@Test<br>public void fileDetail() throws IOException &#123;<br>    // 参数1 f: 表示哪一个路径<br>    // 参数2 recursive: 表示递归<br><br>    // 获取所有文件信息, 返回一个迭代器<br>    RemoteIterator&lt;LocatedFileStatus&gt; listFiles = fs.listFiles(new Path(<span class="hljs-string">&quot;/&quot;</span>), <span class="hljs-literal">true</span>);<br>    // 遍历迭代器<br>    <span class="hljs-keyword">while</span> (listFiles.hasNext()) &#123;<br>        LocatedFileStatus fileStatus = listFiles.next();<br>        System.out.println(<span class="hljs-string">&quot;=======&quot;</span> + fileStatus.getPath() + <span class="hljs-string">&quot;=======&quot;</span>);<br>        System.out.println(fileStatus.getPermission());<br>        System.out.println(fileStatus.getOwner());<br>        System.out.println(fileStatus.getGroup());<br>        System.out.println(fileStatus.getLen());<br>        System.out.println(fileStatus.getModificationTime());<br>        System.out.println(fileStatus.getReplication());<br>        System.out.println(fileStatus.getBlockSize());<br>        System.out.println(fileStatus.getPath().getName());<br><br>        // 获取块信息<br>        BlockLocation[] blockLocations = fileStatus.getBlockLocations();<br>        System.out.println(Arrays.toString(blockLocations));<br>        /*<span class="hljs-keyword">for</span> (BlockLocation blockLocation : blockLocations) &#123;<br>            System.out.println(blockLocation);<br>        &#125;*/<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>查询结果如下<br><img src="/assets/6719b1c56a194f5983a40936dd4e27c6.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">=======hdfs://hadoop202:8020/hadoop-3.1.3.tar.gz=======<br>rw-r--r--<br>xiamu<br>supergroup<br>338075860<br>1673210373259<br>3<br>134217728<br>hadoop-3.1.3.tar.gz<br>[0,134217728,hadoop202,hadoop204,hadoop203, 134217728,134217728,hadoop202,hadoop204,hadoop203, 268435456,69640404,hadoop204,hadoop202,hadoop203]<br></code></pre></td></tr></table></figure><p>0,134217728 表示从 0 字节开始存放, 存放的大小是 134217728 字节<br>134217728,134217728 表示从 134217728 字节开始存放, 存放的大小是 134217728 字节<br>268435456,69640404 表示从 268435456 字节开始存放, 存放的大小是 69640404 字节</p><h2 id="HDFS-API-文件和文件夹判断"><a href="#HDFS-API-文件和文件夹判断" class="headerlink" title="HDFS_API 文件和文件夹判断"></a>HDFS_API 文件和文件夹判断</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">    // 判断是文件夹还是文件<br>    @Test<br>    public void testFile() throws IOException &#123;<br>        FileStatus[] listStatus = fs.listStatus(new Path(<span class="hljs-string">&quot;/&quot;</span>));<br>        <span class="hljs-keyword">for</span> (FileStatus status : listStatus) &#123;<br>            <span class="hljs-keyword">if</span> (status.isFile()) &#123;<br>                System.out.println(<span class="hljs-string">&quot;这是一个文件: &quot;</span> + status.getPath().getName());<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                System.out.println(<span class="hljs-string">&quot;这是一个目录: &quot;</span> + status.getPath().getName());<br>            &#125;<br>        &#125;<br>    &#125;<br><br><br>这是一个文件: cls.txt<br>这是一个文件: hadoop-3.1.3.tar.gz<br>这是一个目录: output<br>这是一个目录: tmp<br></code></pre></td></tr></table></figure><h2 id="网络拓扑-节点距离计算"><a href="#网络拓扑-节点距离计算" class="headerlink" title="网络拓扑-节点距离计算"></a>网络拓扑-节点距离计算</h2><pre><code class="hljs">在HDFS写数据的过程中，NameNode会选择距离待上传数据最近距离的DataNode接收数据。那么这个最近距离怎么计算呢？</code></pre><p>节点距离：两个节点到达最近的共同祖先的距离总和。<br><img src="/assets/223d4fe82aa643d4ab0fcef27cf8489c.png"><br>例如，假设有数据中心 d1 机架 r1 中的节点 n1。该节点可以表示为&#x2F;d1&#x2F;r1&#x2F;n1。利用这种标记，这里给出四种距离描述。<br>大家算一算每两个节点之间的距离。<br>⑤ 和 ⑨ 距离是 3<br>⑩ 和 ② 距离是 3<br>相差几根线, 距离就是几<br><img src="/assets/b77d8c70f4c849fb91796c5a6641f512.png"></p><h2 id="oiv-查看-Fsimage-文件"><a href="#oiv-查看-Fsimage-文件" class="headerlink" title="oiv 查看 Fsimage 文件"></a><strong>oiv 查看 Fsimage 文件</strong></h2><p><img src="/assets/b6c1a47e021846718901d0791de046ad.png"><br>（1）查看 oiv 和 oev 命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">[atguigu@hadoop102 current]$ hdfs<br>oiv            apply the offline fsimage viewer to an fsimage<br>oev            apply the offline edits viewer to an edits file<br></code></pre></td></tr></table></figure><p>（2）基本语法<br><code>hdfs oiv -p 文件类型 -i镜像文件 -o 转换后文件输出路径</code><br>（3）案例实操</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">[atguigu@hadoop102 current]$ <span class="hljs-built_in">pwd</span><br>/opt/module/hadoop-3.1.3/data/dfs/name/current<br><br>[atguigu@hadoop102 current]$ hdfs oiv -p XML -i fsimage_0000000000000000025 -o /opt/module/hadoop-3.1.3/fsimage.xml<br><br>[atguigu@hadoop102 current]$ <span class="hljs-built_in">cat</span> /opt/module/hadoop-3.1.3/fsimage.xml<br><br><span class="hljs-comment"># 上传完之后下载</span><br>[atguigu@hadoop102 hadoop-3.1.3]$ sz fsimage.xml<br><br></code></pre></td></tr></table></figure><p>将显示的 xml 文件内容拷贝到 Idea 中创建的 xml 文件中，并格式化。部分显示结果如下。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;inode&gt;<br>&lt;<span class="hljs-built_in">id</span>&gt;16386&lt;/id&gt;<br>&lt;<span class="hljs-built_in">type</span>&gt;DIRECTORY&lt;/type&gt;<br>&lt;name&gt;user&lt;/name&gt;<br>&lt;mtime&gt;1512722284477&lt;/mtime&gt;<br>&lt;permission&gt;atguigu:supergroup:rwxr-xr-x&lt;/permission&gt;<br>&lt;nsquota&gt;-1&lt;/nsquota&gt;<br>&lt;dsquota&gt;-1&lt;/dsquota&gt;<br>&lt;/inode&gt;<br>&lt;inode&gt;<br>&lt;<span class="hljs-built_in">id</span>&gt;16387&lt;/id&gt;<br>&lt;<span class="hljs-built_in">type</span>&gt;DIRECTORY&lt;/type&gt;<br>&lt;name&gt;atguigu&lt;/name&gt;<br>&lt;mtime&gt;1512790549080&lt;/mtime&gt;<br>&lt;permission&gt;atguigu:supergroup:rwxr-xr-x&lt;/permission&gt;<br>&lt;nsquota&gt;-1&lt;/nsquota&gt;<br>&lt;dsquota&gt;-1&lt;/dsquota&gt;<br>&lt;/inode&gt;<br>&lt;inode&gt;<br>&lt;<span class="hljs-built_in">id</span>&gt;16389&lt;/id&gt;<br>&lt;<span class="hljs-built_in">type</span>&gt;FILE&lt;/type&gt;<br>&lt;name&gt;wc.input&lt;/name&gt;<br>&lt;replication&gt;3&lt;/replication&gt;<br>&lt;mtime&gt;1512722322219&lt;/mtime&gt;<br>&lt;atime&gt;1512722321610&lt;/atime&gt;<br>&lt;perferredBlockSize&gt;134217728&lt;/perferredBlockSize&gt;<br>&lt;permission&gt;atguigu:supergroup:rw-r--r--&lt;/permission&gt;<br>&lt;blocks&gt;<br>&lt;block&gt;<br>&lt;<span class="hljs-built_in">id</span>&gt;1073741825&lt;/id&gt;<br>&lt;genstamp&gt;1001&lt;/genstamp&gt;<br>&lt;numBytes&gt;59&lt;/numBytes&gt;<br>&lt;/block&gt;<br>&lt;/blocks&gt;<br>&lt;/inode &gt;<br></code></pre></td></tr></table></figure><p>思考：可以看出，Fsimage 中没有记录块所对应 DataNode，为什么？<br>在集群启动后，要求 DataNode 上报数据块信息，并间隔一段时间后再次上报。</p><h2 id="oev-查看-Edits-文件"><a href="#oev-查看-Edits-文件" class="headerlink" title="oev 查看 Edits 文件"></a>oev 查看 Edits 文件</h2><p>（1）基本语法<br><code>hdfs oev -p 文件类型 -i编辑日志 -o 转换后文件输出路径</code><br>（2）案例实操</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">[atguigu@hadoop102 current]$ hdfs oev -p XML -i edits_0000000000000000012-0000000000000000013 -o /opt/module/hadoop-3.1.3/edits.xml<br><br>[atguigu@hadoop102 current]$ <span class="hljs-built_in">cat</span> /opt/module/hadoop-3.1.3/edits.xml<br></code></pre></td></tr></table></figure><p>将显示的 xml 文件内容拷贝到 Idea 中创建的 xml 文件中，并格式化。显示结果如下。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;<br>&lt;EDITS&gt;<br>&lt;EDITS_VERSION&gt;-63&lt;/EDITS_VERSION&gt;<br>&lt;RECORD&gt;<br>&lt;OPCODE&gt;OP_START_LOG_SEGMENT&lt;/OPCODE&gt;<br>&lt;DATA&gt;<br>&lt;TXID&gt;129&lt;/TXID&gt;<br>&lt;/DATA&gt;<br>&lt;/RECORD&gt;<br>&lt;RECORD&gt;<br>&lt;OPCODE&gt;OP_ADD&lt;/OPCODE&gt;<br>&lt;DATA&gt;<br>&lt;TXID&gt;130&lt;/TXID&gt;<br>&lt;LENGTH&gt;0&lt;/LENGTH&gt;<br>&lt;INODEID&gt;16407&lt;/INODEID&gt;<br>&lt;PATH&gt;/hello7.txt&lt;/PATH&gt;<br>&lt;REPLICATION&gt;2&lt;/REPLICATION&gt;<br>&lt;MTIME&gt;1512943607866&lt;/MTIME&gt;<br>&lt;ATIME&gt;1512943607866&lt;/ATIME&gt;<br>&lt;BLOCKSIZE&gt;134217728&lt;/BLOCKSIZE&gt;<br>&lt;CLIENT_NAME&gt;DFSClient_NONMAPREDUCE_-1544295051_1&lt;/CLIENT_NAME&gt;<br>&lt;CLIENT_MACHINE&gt;192.168.10.102&lt;/CLIENT_MACHINE&gt;<br>&lt;OVERWRITE&gt;<span class="hljs-literal">true</span>&lt;/OVERWRITE&gt;<br>&lt;PERMISSION_STATUS&gt;<br>&lt;USERNAME&gt;atguigu&lt;/USERNAME&gt;<br>&lt;GROUPNAME&gt;supergroup&lt;/GROUPNAME&gt;<br>&lt;MODE&gt;420&lt;/MODE&gt;<br>&lt;/PERMISSION_STATUS&gt;<br>&lt;RPC_CLIENTID&gt;908eafd4-9aec-4288-96f1-e8011d181561&lt;/RPC_CLIENTID&gt;<br>&lt;RPC_CALLID&gt;0&lt;/RPC_CALLID&gt;<br>&lt;/DATA&gt;<br>&lt;/RECORD&gt;<br>&lt;RECORD&gt;<br>&lt;OPCODE&gt;OP_ALLOCATE_BLOCK_ID&lt;/OPCODE&gt;<br>&lt;DATA&gt;<br>&lt;TXID&gt;131&lt;/TXID&gt;<br>&lt;BLOCK_ID&gt;1073741839&lt;/BLOCK_ID&gt;<br>&lt;/DATA&gt;<br>&lt;/RECORD&gt;<br>&lt;RECORD&gt;<br>&lt;OPCODE&gt;OP_SET_GENSTAMP_V2&lt;/OPCODE&gt;<br>&lt;DATA&gt;<br>&lt;TXID&gt;132&lt;/TXID&gt;<br>&lt;GENSTAMPV2&gt;1016&lt;/GENSTAMPV2&gt;<br>&lt;/DATA&gt;<br>&lt;/RECORD&gt;<br>&lt;RECORD&gt;<br>&lt;OPCODE&gt;OP_ADD_BLOCK&lt;/OPCODE&gt;<br>&lt;DATA&gt;<br>&lt;TXID&gt;133&lt;/TXID&gt;<br>&lt;PATH&gt;/hello7.txt&lt;/PATH&gt;<br>&lt;BLOCK&gt;<br>&lt;BLOCK_ID&gt;1073741839&lt;/BLOCK_ID&gt;<br>&lt;NUM_BYTES&gt;0&lt;/NUM_BYTES&gt;<br>&lt;GENSTAMP&gt;1016&lt;/GENSTAMP&gt;<br>&lt;/BLOCK&gt;<br>&lt;RPC_CLIENTID&gt;&lt;/RPC_CLIENTID&gt;<br>&lt;RPC_CALLID&gt;-2&lt;/RPC_CALLID&gt;<br>&lt;/DATA&gt;<br>&lt;/RECORD&gt;<br>&lt;RECORD&gt;<br>&lt;OPCODE&gt;OP_CLOSE&lt;/OPCODE&gt;<br>&lt;DATA&gt;<br>&lt;TXID&gt;134&lt;/TXID&gt;<br>&lt;LENGTH&gt;0&lt;/LENGTH&gt;<br>&lt;INODEID&gt;0&lt;/INODEID&gt;<br>&lt;PATH&gt;/hello7.txt&lt;/PATH&gt;<br>&lt;REPLICATION&gt;2&lt;/REPLICATION&gt;<br>&lt;MTIME&gt;1512943608761&lt;/MTIME&gt;<br>&lt;ATIME&gt;1512943607866&lt;/ATIME&gt;<br>&lt;BLOCKSIZE&gt;134217728&lt;/BLOCKSIZE&gt;<br>&lt;CLIENT_NAME&gt;&lt;/CLIENT_NAME&gt;<br>&lt;CLIENT_MACHINE&gt;&lt;/CLIENT_MACHINE&gt;<br>&lt;OVERWRITE&gt;<span class="hljs-literal">false</span>&lt;/OVERWRITE&gt;<br>&lt;BLOCK&gt;<br>&lt;BLOCK_ID&gt;1073741839&lt;/BLOCK_ID&gt;<br>&lt;NUM_BYTES&gt;25&lt;/NUM_BYTES&gt;<br>&lt;GENSTAMP&gt;1016&lt;/GENSTAMP&gt;<br>&lt;/BLOCK&gt;<br>&lt;PERMISSION_STATUS&gt;<br>&lt;USERNAME&gt;atguigu&lt;/USERNAME&gt;<br>&lt;GROUPNAME&gt;supergroup&lt;/GROUPNAME&gt;<br>&lt;MODE&gt;420&lt;/MODE&gt;<br>&lt;/PERMISSION_STATUS&gt;<br>&lt;/DATA&gt;<br>&lt;/RECORD&gt;<br>&lt;/EDITS &gt;<br></code></pre></td></tr></table></figure><p>思考：NameNode 如何确定下次开机启动的时候合并哪些 Edits？<br>NameNode 启动的时候合并的是上次停机前正在写入的 Edits，即 edits_inprogress_xxx<br>根据 seen_txid 里面记录最新的 Fsimage(镜像文件)的值去合并 Edits(编辑日志)。</p><h2 id="CheckPoint-时间设置"><a href="#CheckPoint-时间设置" class="headerlink" title="CheckPoint 时间设置"></a><strong>CheckPoint 时间设置</strong></h2><p><strong>通常情况下，SecondaryNameNode 每隔一小时执行一次。</strong><br>[hdfs-default.xml]</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;property&gt;<br>&lt;name&gt;dfs.namenode.checkpoint.period&lt;/name&gt;<br>&lt;value&gt;3600s&lt;/value&gt;<br>&lt;/property&gt;<br></code></pre></td></tr></table></figure><p><strong>2）一分钟检查一次操作次数，当操作次数达到 1 百万时，SecondaryNameNode 执行一次。</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;property&gt;<br>&lt;name&gt;dfs.namenode.checkpoint.txns&lt;/name&gt;<br>&lt;value&gt;1000000&lt;/value&gt;<br>&lt;description&gt;操作动作次数&lt;/description&gt;<br>&lt;/property&gt;<br><br>&lt;property&gt;<br>&lt;name&gt;dfs.namenode.checkpoint.check.period&lt;/name&gt;<br>&lt;value&gt;60s&lt;/value&gt;<br>&lt;description&gt; 1分钟检查一次操作次数&lt;/description&gt;<br>&lt;/property&gt;<br></code></pre></td></tr></table></figure><h2 id="DataNode"><a href="#DataNode" class="headerlink" title="DataNode"></a>DataNode</h2><p><img src="/assets/88de50f6770b46b2b2dd26cd02b73d13.png"><br>（1）一个数据块在 DataNode 上以文件形式存储在磁盘上，包括两个文件，一个是数据本身，一个是元数据包括数据块的长度，块数据的校验和，以及时间戳。<br>（2）DataNode 启动后向 NameNode 注册，通过后，周期性（6 小时）的向 NameNode 上报所有的块信息。<br>DN 向 NN 汇报当前解读信息的时间间隔，默认 6 小时；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;property&gt;<br>&lt;name&gt;dfs.blockreport.intervalMsec&lt;/name&gt;<br>&lt;value&gt;21600000&lt;/value&gt;<br>&lt;description&gt;Determines block reporting interval <span class="hljs-keyword">in</span> milliseconds.&lt;/description&gt;<br>&lt;/property&gt;<br></code></pre></td></tr></table></figure><p>DN 扫描自己节点块信息列表的时间，默认 6 小时</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;property&gt;<br>&lt;name&gt;dfs.datanode.directoryscan.interval&lt;/name&gt;<br>&lt;value&gt;21600s&lt;/value&gt;<br>&lt;description&gt;Interval <span class="hljs-keyword">in</span> seconds <span class="hljs-keyword">for</span> Datanode to scan data directories and reconcile the difference between blocks <span class="hljs-keyword">in</span> memory and on the disk.<br>Support multiple time unit suffix(<span class="hljs-keyword">case</span> insensitive), as described<br><span class="hljs-keyword">in</span> dfs.heartbeat.interval.<br>&lt;/description&gt;<br>&lt;/property&gt;<br></code></pre></td></tr></table></figure><p>（3）心跳是每 3 秒一次，心跳返回结果带有 NameNode 给该 DataNode 的命令如复制块数据到另一台机器，或删除某个数据块。如果超过 10 分钟没有收到某个 DataNode 的心跳，则认为该节点不可用。<br>（4）集群运行中可以安全加入和退出一些机器。</p>]]></content>
    
    
    <categories>
      
      <category>Hadoop</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hadoop</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>入门</title>
    <link href="/Hadoop/%E5%85%A5%E9%97%A8/"/>
    <url>/Hadoop/%E5%85%A5%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p><img src="/assets/dae1eba33f33448c928311ce86365e54.png"><br><img src="/assets/b71d3e55a118475b8542183d4ba572f4.png"><br>大数据主要解决, 海量数据的采集, 存储和分析计算问题</p><h2 id="linux-的配置"><a href="#linux-的配置" class="headerlink" title="linux 的配置"></a>linux 的配置</h2><p>设置终端的字体大小<br>setfont sun12x22</p><p>一些基本的配置<br>最小安装需要安装一些工具包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum install net-tools wget zip unzip vim-enhanced net-tools -y<br></code></pre></td></tr></table></figure><p>安装用于上传, 下载文件的工具包<br>rz 上传, zs 下载</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum install lrzsz -y<br></code></pre></td></tr></table></figure><p>配置静态 ip<br>[root@hadoop200 ~]# vim &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-ens33</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">TYPE=<span class="hljs-string">&quot;Ethernet&quot;</span><br>PROXY_METHOD=<span class="hljs-string">&quot;none&quot;</span><br>BROWSER_ONLY=<span class="hljs-string">&quot;no&quot;</span><br>BOOTPROTO=<span class="hljs-string">&quot;static&quot;</span><br>DEFROUTE=<span class="hljs-string">&quot;yes&quot;</span><br>IPV4_FAILURE_FATAL=<span class="hljs-string">&quot;no&quot;</span><br>IPV6INIT=<span class="hljs-string">&quot;yes&quot;</span><br>IPV6_AUTOCONF=<span class="hljs-string">&quot;yes&quot;</span><br>IPV6_DEFROUTE=<span class="hljs-string">&quot;yes&quot;</span><br>IPV6_FAILURE_FATAL=<span class="hljs-string">&quot;no&quot;</span><br>IPV6_ADDR_GEN_MODE=<span class="hljs-string">&quot;stable-privacy&quot;</span><br>NAME=<span class="hljs-string">&quot;ens33&quot;</span><br>UUID=<span class="hljs-string">&quot;a3b13aa9-1510-453c-8dc7-fab53450f73b&quot;</span><br>DEVICE=<span class="hljs-string">&quot;ens33&quot;</span><br>ONBOOT=<span class="hljs-string">&quot;yes&quot;</span><br><br>IPADDR=192.168.1.200<br>GATEWAY=192.168.1.2<br>DNS1=192.168.1.2<br><br></code></pre></td></tr></table></figure><p>[root@hadoop200 ~]# vi &#x2F;etc&#x2F;hostname</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">hadoop200<br><br></code></pre></td></tr></table></figure><p>[root@hadoop200 ~]# vi &#x2F;etc&#x2F;host</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br>192.168.1.200 hadoop200<br>192.168.1.201 hadoop201<br>192.168.1.202 hadoop202<br>192.168.1.203 hadoop203<br>192.168.1.204 hadoop204<br>192.168.1.205 hadoop205<br>192.168.1.206 hadoop206<br>192.168.1.207 hadoop207<br>192.168.1.208 hadoop208<br><br></code></pre></td></tr></table></figure><p>windows 中设置 host<br>C:\Windows\System32\drivers\etc</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">192.168.1.200 hadoop200<br>192.168.1.201 hadoop201<br>192.168.1.202 hadoop202<br>192.168.1.203 hadoop203<br>192.168.1.204 hadoop204<br>192.168.1.205 hadoop205<br>192.168.1.206 hadoop206<br>192.168.1.207 hadoop207<br>192.168.1.208 hadoop208<br></code></pre></td></tr></table></figure><p>关闭防火墙</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@hadoop200 ~]<span class="hljs-comment"># systemctl stop firewalld</span><br>[root@hadoop200 ~]<span class="hljs-comment"># systemctl disable firewalld.service</span><br><br></code></pre></td></tr></table></figure><p>配置 atguigu 用户具有 root 权限，方便后期加 sudo 执行 root 权限的命令<br>[root@hadoop200 ~]# vim &#x2F;etc&#x2F;sudoers<br>修改&#x2F;etc&#x2F;sudoers 文件，在%wheel 这行下面添加一行，如下所示：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">root    ALL=(ALL)       ALL<br><span class="hljs-comment">## Allows members of the &#x27;sys&#x27; group to run networking, software,</span><br><span class="hljs-comment">## Allows people in group wheel to run all commands</span><br>%wheel  ALL=(ALL)       ALL<br>xiamu   ALL=(ALL)     NOPASSWD:ALL<br><br></code></pre></td></tr></table></figure><p>注意：atguigu 这一行不要直接放到 root 行下面，因为所有用户都属于 wheel 组，你先配置了 atguigu 具有免密功能，但是程序执行到%wheel 行时，该功能又被覆盖回需要密码。所以 atguigu 要放到%wheel 这行下面。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">[xiamu@hadoop200 opt]$ <span class="hljs-built_in">mkdir</span> module/<br>[xiamu@hadoop200 opt]$ <span class="hljs-built_in">mkdir</span> software/<br>[xiamu@hadoop200 opt]$ sudo <span class="hljs-built_in">chown</span> xiamu:xiamu module/ software/<br>[xiamu@hadoop200 opt]$ ll<br>总用量 0<br>drwxr-xr-x. 2 xiamu xiamu 6 12月 30 17:03 module<br>drwxr-xr-x. 2 xiamu xiamu 6 12月 30 17:04 software<br><br></code></pre></td></tr></table></figure><p>删除 java<br>如果有 java 请先删除<br>注意：如果你的虚拟机是最小化安装不需要执行这一步。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@hadoop100 ~]<span class="hljs-comment"># rpm -qa | grep -i java</span><br>[root@hadoop100 ~]<span class="hljs-comment"># rpm -qa | grep -i java | xargs -n1 rpm -e --nodeps</span><br></code></pre></td></tr></table></figure><p>重启之后的检查 hostname, ip, 以及能否 ping 通外网</p><h2 id="安装-jdk"><a href="#安装-jdk" class="headerlink" title="安装 jdk"></a>安装 jdk</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">[xiamu@hadoop202 software]$ tar -zxvf jdk-8u212-linux-x64.tar.gz -C /opt/module/<br>[xiamu@hadoop202 software]$ <span class="hljs-built_in">cd</span> /opt/module/jdk1.8.0_212/<br><br><span class="hljs-comment"># 查看一个脚本, 这个脚本不需要改动, 这个脚本会循环遍历profile.d下的所有.sh文件</span><br>[xiamu@hadoop202 jdk1.8.0_212]$ vim /etc/profile<br>[xiamu@hadoop202 jdk1.8.0_212]$ <span class="hljs-built_in">cd</span> /etc/profile.d/<br><br>[xiamu@hadoop202 profile.d]$ sudo vim my_env.sh<br><span class="hljs-comment">#JAVA_HOME</span><br><span class="hljs-built_in">export</span> JAVA_HOME=/opt/module/jdk1.8.0_212<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$JAVA_HOME</span>/bin<br><br><span class="hljs-comment"># 重新遍历一把profile中的文件</span><br>[xiamu@hadoop202 profile.d]$ <span class="hljs-built_in">source</span> /etc/profile<br><br>[xiamu@hadoop202 hadoop-3.1.3]$ java -version<br>java version <span class="hljs-string">&quot;1.8.0_212&quot;</span><br><br></code></pre></td></tr></table></figure><h2 id="安装-Hadoop"><a href="#安装-Hadoop" class="headerlink" title="安装 Hadoop"></a>安装 Hadoop</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">[xiamu@hadoop202 software]$ tar -zxvf hadoop-3.1.3.tar.gz -C /opt/module/<br><br>[xiamu@hadoop202 hadoop-3.1.3]$ sudo vim /etc/profile.d/my_env.sh<br><span class="hljs-comment">#HADOOP_HOME</span><br><span class="hljs-built_in">export</span> HADOOP_HOME=/opt/module/hadoop-3.1.3<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$HADOOP_HOME</span>/bin<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$HADOOP_HOME</span>/sbin<br><br>[xiamu@hadoop202 hadoop-3.1.3]$ <span class="hljs-built_in">source</span> /etc/profile<br><br></code></pre></td></tr></table></figure><p>hadoop 目录<br><img src="/assets/307bc31882934d3d8243239b3eba7c42.png"><br>bin: 常用的命令 hdfs, yarn, mapred<br>常用的文件夹 bin, etc, sbin</p><h2 id="本地运行模式"><a href="#本地运行模式" class="headerlink" title="本地运行模式"></a>本地运行模式</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br>[xiamu@hadoop202 hadoop-3.1.3]$ <span class="hljs-built_in">mkdir</span> wcinput<br>[xiamu@hadoop202 hadoop-3.1.3]$ <span class="hljs-built_in">cd</span> wcinput<br>[xiamu@hadoop202 wcinput]$ vim word.txt<br>ss ss<br>cls cls<br>banzhang<br>bobo<br>yangge<br><br><br><span class="hljs-comment"># 统计单词数量</span><br>[xiamu@hadoop202 hadoop-3.1.3]$ bin/hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-3.1.3.jar wordcount wcinput/ ./wcoutput<br>[xiamu@hadoop202 hadoop-3.1.3]$ <span class="hljs-built_in">cd</span> wcoutput/<br>[xiamu@hadoop202 wcoutput]$ ll<br>总用量 4<br>-rw-r--r--. 1 xiamu xiamu 38 12月 31 01:07 part-r-00000<br>-rw-r--r--. 1 xiamu xiamu  0 12月 31 01:07 _SUCCESS<br>[xiamu@hadoop202 wcoutput]$ <span class="hljs-built_in">cat</span> part-r-00000<br>banzhang1<br>bobo1<br>cls2<br>ss2<br>yangge1<br><br><span class="hljs-comment"># 再次运行就会报错, 原因是因为输出的目录已经存在了</span><br>[xiamu@hadoop202 hadoop-3.1.3]$ bin/hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-3.1.3.jar wordcount wcinput/ ./wcoutput<br>org.apache.hadoop.mapred.FileAlreadyExistsException: Output directory file:/opt/module/hadoop-3.1.3/wcoutput already exists<br><br></code></pre></td></tr></table></figure><h2 id="scp-拷贝命令"><a href="#scp-拷贝命令" class="headerlink" title="scp 拷贝命令"></a>scp 拷贝命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 把hadoop202中的jdk1.8.0_212目录下的文件拷贝到hadoop203中去了</span><br>[xiamu@hadoop202 module]$ scp -r jdk1.8.0_212/ xiamu@hadoop203:/opt/module/<br><br><span class="hljs-comment"># 把hadoop202中的hadoop-3.1.3目录下的文件拷贝到hadoop203中来了</span><br>[xiamu@hadoop203 module]$ scp -r xiamu@hadoop202:/opt/module/hadoop-3.1.3 ./<br><br><span class="hljs-comment"># 甚至可以把hadoop202中的目录拷贝到hadoop204中去</span><br>[xiamu@hadoop203 module]$ scp -r xiamu@hadoop202:/opt/module/* xiamu@hadoop204:/opt/module/<br><br></code></pre></td></tr></table></figure><h2 id="rsync-命令"><a href="#rsync-命令" class="headerlink" title="rsync 命令"></a>rsync 命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 同步命令, 修改某一个文件, 执行该命令就会把修改的文件该同步过去</span><br><span class="hljs-comment"># 前提是服务器上需要安装rsync</span><br>[xiamu@hadoop202 module]$ sudo yum install rsync<br>[xiamu@hadoop202 module]$ rsync -av hadoop-3.1.3/ xiamu@hadoop203:/opt/module/hadoop-3.1.3/<br><br><br></code></pre></td></tr></table></figure><h2 id="xsync-集群分发脚本"><a href="#xsync-集群分发脚本" class="headerlink" title="xsync 集群分发脚本"></a>xsync 集群分发脚本</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs bash">[xiamu@hadoop202 ~]$ <span class="hljs-built_in">cd</span> /home/xiamu/<br>[xiamu@hadoop202 ~]$ <span class="hljs-built_in">mkdir</span> bin<br>[xiamu@hadoop202 ~]$ <span class="hljs-built_in">cd</span> bin/<br>[xiamu@hadoop202 bin]$ vim xsync<br><br><br><span class="hljs-comment">#!/bin/bash</span><br><br><span class="hljs-comment">#1. 判断参数个数</span><br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$#</span> -lt 1 ]<br><span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> Not Enough Arguement!<br>    <span class="hljs-built_in">exit</span>;<br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment">#2. 遍历集群所有机器</span><br><span class="hljs-keyword">for</span> host <span class="hljs-keyword">in</span> hadoop202 hadoop203 hadoop204<br><span class="hljs-keyword">do</span><br>    <span class="hljs-built_in">echo</span> ====================  <span class="hljs-variable">$host</span>  ====================<br>    <span class="hljs-comment">#3. 遍历所有目录，挨个发送</span><br><br>    <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> <span class="hljs-variable">$@</span><br>    <span class="hljs-keyword">do</span><br>        <span class="hljs-comment">#4. 判断文件是否存在</span><br>        <span class="hljs-keyword">if</span> [ -e <span class="hljs-variable">$file</span> ]<br>            <span class="hljs-keyword">then</span><br>                <span class="hljs-comment">#5. 获取父目录</span><br>                pdir=$(<span class="hljs-built_in">cd</span> -P $(<span class="hljs-built_in">dirname</span> <span class="hljs-variable">$file</span>); <span class="hljs-built_in">pwd</span>)<br><br>                <span class="hljs-comment">#6. 获取当前文件的名称</span><br>                fname=$(<span class="hljs-built_in">basename</span> <span class="hljs-variable">$file</span>)<br>                ssh <span class="hljs-variable">$host</span> <span class="hljs-string">&quot;mkdir -p <span class="hljs-variable">$pdir</span>&quot;</span><br>                rsync -av <span class="hljs-variable">$pdir</span>/<span class="hljs-variable">$fname</span> <span class="hljs-variable">$host</span>:<span class="hljs-variable">$pdir</span><br>            <span class="hljs-keyword">else</span><br>                <span class="hljs-built_in">echo</span> <span class="hljs-variable">$file</span> does not exists!<br>        <span class="hljs-keyword">fi</span><br>    <span class="hljs-keyword">done</span><br><span class="hljs-keyword">done</span><br><br><br><br>修改脚本 xsync 具有执行权限<br>[xiamu@hadoop202 bin]$ <span class="hljs-built_in">chmod</span> 777 xsync<br>[xiamu@hadoop202 bin]$ xsync /home/xiamu/bin<br>[xiamu@hadoop202 bin]$ sudo <span class="hljs-built_in">cp</span> xsync /bin/<br>[xiamu@hadoop202 bin]$ sudo ./bin/xsync /etc/profile.d/my_env.sh<br>注意：如果用了sudo，那么xsync一定要给它的路径补全。<br>让环境变量生效<br>[xiamu@hadoop203 ~]$ <span class="hljs-built_in">source</span> /etc/profile<br>[xiamu@hadoop204 ~]$ <span class="hljs-built_in">source</span> /etc/profile<br><br></code></pre></td></tr></table></figure><h2 id="设置-ssh-免密登录"><a href="#设置-ssh-免密登录" class="headerlink" title="设置 ssh 免密登录"></a>设置 ssh 免密登录</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs bash">[xiamu@hadoop202 .ssh]$ <span class="hljs-built_in">pwd</span><br>/home/xiamu/.ssh<br><span class="hljs-comment"># 生成公钥和私钥</span><br><span class="hljs-comment"># 然后敲（三个回车），就会生成两个文件id_rsa（私钥）、id_rsa.pub（公钥）</span><br>[xiamu@hadoop202 ~]$ ssh-keygen -t rsa<br>[xiamu@hadoop202 ~]$ <span class="hljs-built_in">cd</span> .ssh/<br>[xiamu@hadoop202 .ssh]$ ll<br>总用量 12<br>-rw-------. 1 xiamu xiamu 1675 12月 31 04:20 id_rsa<br>-rw-r--r--. 1 xiamu xiamu  397 12月 31 04:20 id_rsa.pub<br>-rw-r--r--. 1 xiamu xiamu  726 12月 31 02:22 known_hosts<br><br>[xiamu@hadoop202 .ssh]$ <span class="hljs-built_in">cat</span> id_rsa<br>-----BEGIN RSA PRIVATE KEY-----<br>MIIEowIBAAKCAQEAs27rMM0gTqHTYpPExLsuhvzO2Z3hZPellncDj/pvqFClFCzy<br>...<br>-----END RSA PRIVATE KEY-----<br><br>[xiamu@hadoop202 .ssh]$ <span class="hljs-built_in">cat</span> id_rsa.pub<br>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCzbuswzSBOodNik8TEuy6G/M7ZneFk96WWdwOP+m+oUKUULPKxsadl++5yQLt+rlauC/jNF9S93TbJEasoBJHsxywTdwe4gmxT5Kx73kDTg41y9vn8gduZdxeOEe3bYvmsJKGpSyPw9ZIqz2mrvIjj1SHE9/CZHQzU9a4EnPePoltYHyP4wIzwauThuQcmFa2O3aZZEYxBdUZxLrFZviI02SQd4raHR7h5nMkGbsMWqjAq3Ky4p1i1Pji0P5Uj++L4A7aL2qiIKXcpW3JeUPx/xdvfPB+Q/llNUaMahIayacNVHbnBDGZdJC3e5qXplBzjcst/RB+KzF2nL8XZp0LX xiamu@hadoop202<br><br><span class="hljs-comment"># 将公钥拷贝到要免密登录的目标机器上</span><br>[xiamu@hadoop202 .ssh]$ ssh-copy-id hadoop202<br>[xiamu@hadoop202 .ssh]$ ssh-copy-id hadoop203<br>[xiamu@hadoop202 .ssh]$ ssh-copy-id hadoop204<br><br>[xiamu@hadoop202 .ssh]$ ll<br>总用量 16<br>-rw-------. 1 xiamu xiamu  397 12月 31 04:30 authorized_keys<br>-rw-------. 1 xiamu xiamu 1675 12月 31 04:20 id_rsa<br>-rw-r--r--. 1 xiamu xiamu  397 12月 31 04:20 id_rsa.pub<br>-rw-r--r--. 1 xiamu xiamu  726 12月 31 02:22 known_hosts<br><br>known_hosts 记录ssh访问过计算机的公钥（public key）<br>id_rsa 生成的私钥<br>id_rsa.pub 生成的公钥<br>authorized_keys 存放授权过的无密登录服务器公钥<br><br>注意：<br>还需要在hadoop103上采用xiamu账号配置一下无密登录到hadoop202、hadoop203、hadoop204服务器上。<br>还需要在hadoop104上采用xiamu账号配置一下无密登录到hadoop202、hadoop203、hadoop204服务器上。<br>还需要在hadoop102上采用root账号，配置一下无密登录到hadoop202、hadoop203、hadoop204；<br></code></pre></td></tr></table></figure><h2 id="集群配置"><a href="#集群配置" class="headerlink" title="集群配置"></a>集群配置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs bash">[xiamu@hadoop202 hadoop]$ vim core-site.xml<br>&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;<br>&lt;?xml-stylesheet <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;text/xsl&quot;</span> href=<span class="hljs-string">&quot;configuration.xsl&quot;</span>?&gt;<br><br>&lt;!-- Put site-specific property overrides <span class="hljs-keyword">in</span> this file. --&gt;<br><br>&lt;configuration&gt;<br>    &lt;!-- 指定NameNode的地址 --&gt;<br>    &lt;property&gt;<br>        &lt;name&gt;fs.defaultFS&lt;/name&gt;<br>        &lt;value&gt;hdfs://hadoop202:8020&lt;/value&gt;<br>    &lt;/property&gt;<br><br>    &lt;!-- 指定hadoop数据的存储目录 --&gt;<br>    &lt;property&gt;<br>        &lt;name&gt;hadoop.tmp.dir&lt;/name&gt;<br>        &lt;value&gt;/opt/module/hadoop-3.1.3/data&lt;/value&gt;<br>    &lt;/property&gt;<br>    &lt;!-- 配置HDFS网页登录使用的静态用户为xiamu --&gt;<br>    &lt;property&gt;<br>        &lt;name&gt;hadoop.http.staticuser.user&lt;/name&gt;<br>        &lt;value&gt;xiamu&lt;/value&gt;<br>    &lt;/property&gt;<br>&lt;/configuration&gt;<br><br>[xiamu@hadoop202 hadoop]$ vim hdfs-site.xml<br>&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;<br>&lt;?xml-stylesheet <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;text/xsl&quot;</span> href=<span class="hljs-string">&quot;configuration.xsl&quot;</span>?&gt;<br><br>&lt;!-- Put site-specific property overrides <span class="hljs-keyword">in</span> this file. --&gt;<br><br>&lt;configuration&gt;<br>    &lt;!-- nn web端访问地址--&gt;<br>    &lt;property&gt;<br>        &lt;name&gt;dfs.namenode.http-address&lt;/name&gt;<br>        &lt;value&gt;hadoop202:9870&lt;/value&gt;<br>    &lt;/property&gt;<br>    &lt;!-- 2nn web端访问地址--&gt;<br>    &lt;property&gt;<br>        &lt;name&gt;dfs.namenode.secondary.http-address&lt;/name&gt;<br>        &lt;value&gt;hadoop204:9868&lt;/value&gt;<br>    &lt;/property&gt;<br>&lt;/configuration&gt;<br><br>[xiamu@hadoop202 hadoop]$ vim yarn-site.xml<br>&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span>?&gt;<br>&lt;configuration&gt;<br><br>&lt;!-- 指定MR走shuffle --&gt;<br>    &lt;property&gt;<br>        &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;<br>        &lt;value&gt;mapreduce_shuffle&lt;/value&gt;<br>    &lt;/property&gt;<br><br>    &lt;!-- 指定ResourceManager的地址--&gt;<br>    &lt;property&gt;<br>        &lt;name&gt;yarn.resourcemanager.hostname&lt;/name&gt;<br>        &lt;value&gt;hadoop203&lt;/value&gt;<br>    &lt;/property&gt;<br><br>    &lt;!-- 环境变量的继承 --&gt;<br>    &lt;property&gt;<br>        &lt;name&gt;yarn.nodemanager.env-whitelist&lt;/name&gt;<br>        &lt;value&gt;JAVA_HOME,HADOOP_COMMON_HOME,HADOOP_HDFS_HOME,HADOOP_CONF_DIR,CLASSPATH_PREPEND_DISTCACHE,HADOOP_YARN_HOME,HADOOP_MAPRED_HOME&lt;/value&gt;<br>    &lt;/property&gt;<br><br>&lt;/configuration&gt;<br><br>[xiamu@hadoop202 hadoop]$ vim mapred-site.xml<br>&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span>?&gt;<br>&lt;?xml-stylesheet <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;text/xsl&quot;</span> href=<span class="hljs-string">&quot;configuration.xsl&quot;</span>?&gt;<br><br>&lt;!-- Put site-specific property overrides <span class="hljs-keyword">in</span> this file. --&gt;<br><br>&lt;configuration&gt;<br>    &lt;!-- 指定MapReduce程序运行在Yarn上 --&gt;<br>    &lt;property&gt;<br>        &lt;name&gt;mapreduce.framework.name&lt;/name&gt;<br>        &lt;value&gt;yarn&lt;/value&gt;<br>    &lt;/property&gt;<br>&lt;/configuration&gt;<br><br></code></pre></td></tr></table></figure><h2 id="群起集群"><a href="#群起集群" class="headerlink" title="群起集群"></a>群起集群</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs bash">[xiamu@hadoop202 hadoop]$ <span class="hljs-built_in">pwd</span><br>/opt/module/hadoop-3.1.3/etc/hadoop<br>[xiamu@hadoop202 hadoop]$ vim workers<br><br>hadoop202<br>hadoop203<br>hadoop204<br><br><span class="hljs-comment"># 注意, 上面配置三个主机名不要有任何多余的空格和空行</span><br><br><span class="hljs-comment"># 如果集群是第一次启动，需要在hadoop202节点格式化NameNode</span><br><span class="hljs-comment"># （注意：格式化NameNode，会产生新的集群id，导致NameNode和DataNode的集群id不一致，</span><br><span class="hljs-comment"># 集群找不到已往数据。如果集群在运行过程中报错，需要重新格式化NameNode的话，</span><br><span class="hljs-comment"># 一定要先停止namenode和datanode进程，并且要删除所有机器的data和logs目录，然后再进行格式化。）</span><br><br><span class="hljs-comment"># 第一次启动需要初始化</span><br>[xiamu@hadoop202 hadoop-3.1.3]$ hdfs namenode -format<br><span class="hljs-comment"># 启动HDFS</span><br>[xiamu@hadoop202 hadoop-3.1.3]$ sbin/start-dfs.sh<br><br><br><span class="hljs-comment"># 在配置了ResourceManager的节点（hadoop103）启动YARN</span><br>[xiamu@hadoop203 hadoop-3.1.3]$ sbin/start-yarn.sh<br><br><span class="hljs-comment"># 查看历史服务器</span><br>[xiamu@hadoop202 hadoop-3.1.3]$ jps<br>1876 DataNode<br>2199 NodeManager<br>2296 Jps<br>1757 NameNode<br>[xiamu@hadoop203 hadoop-3.1.3]$ jps<br>1714 ResourceManager<br>2163 Jps<br>1828 NodeManager<br>1531 DataNode<br>[xiamu@hadoop204 ~]$ jps<br>1520 DataNode<br>1605 SecondaryNameNode<br>1749 NodeManager<br>1850 Jps<br><br></code></pre></td></tr></table></figure><p><a href="http://hadoop202:9870/dfshealth.html#tab-overview">http://hadoop202:9870</a><br>Web 端查看 HDFS 的 NameNode<br><img src="/assets/03ac461e4ed247c3b7f8ab60a11a2013.png"><br>Web 端查看 YARN 的 ResourceManager<br><a href="http://hadoop203:8088/cluster">http://hadoop203:8088/cluster</a><br><img src="/assets/1e7deb04ed5e45e7ae163b39a8cd70f7.png"></p><h2 id="集群基本测试-上传文件"><a href="#集群基本测试-上传文件" class="headerlink" title="集群基本测试(上传文件)"></a><strong>集群基本测试(上传文件)</strong></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">[xiamu@hadoop202 hadoop-3.1.3]$ hadoop fs -<span class="hljs-built_in">mkdir</span> /wcinput<br><br><span class="hljs-comment"># 上传小文件</span><br>[xiamu@hadoop202 hadoop-3.1.3]$ hadoop fs -put wcinput/word.txt /wcinput<br><br></code></pre></td></tr></table></figure><p>执行完成之后页面多了一个目录, 目录中包含着 word.txt 文件<br><img src="/assets/472fea3e202e4c4a927886f4dd731e5e.png"><br><img src="/assets/2ead450e027d473db24dbfc4438a8730.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><span class="hljs-comment"># 上传一个大文件</span><br>[xiamu@hadoop202 hadoop-3.1.3]$ hadoop fs -put /opt/software/jdk-8u212-linux-x64.tar.gz /<br><br><br><span class="hljs-comment"># hdfs文件存储的位置在hadoop根目录中data目录下</span><br>[xiamu@hadoop202 subdir0]$ <span class="hljs-built_in">pwd</span><br>/opt/module/hadoop-3.1.3/data/dfs/data/current/BP-1090801922-192.168.1.202-1672543197610/current/finalized/subdir0/subdir0<br>[xiamu@hadoop202 subdir0]$ <span class="hljs-built_in">ls</span><br>blk_1073741825            blk_1073741826_1002.meta<br>blk_1073741825_1001.meta  blk_1073741827<br>blk_1073741826            blk_1073741827_1003.meta<br><br>[xiamu@hadoop202 subdir0]$ <span class="hljs-built_in">cat</span> blk_1073741826 &gt;&gt; tmp.tar.gz<br>[xiamu@hadoop202 subdir0]$ <span class="hljs-built_in">cat</span> blk_1073741827 &gt;&gt; tmp.tar.gz<br>[xiamu@hadoop202 subdir0]$ tar -zxvf tmp.tar.gz<br>[xiamu@hadoop202 subdir0]$ <span class="hljs-built_in">ls</span><br>blk_1073741825            blk_1073741826            blk_1073741827            jdk1.8.0_212<br>blk_1073741825_1001.meta  blk_1073741826_1002.meta  blk_1073741827_1003.meta  tmp.tar.gz<br><br><span class="hljs-comment"># 这就说明了blk_1073741826和blk_1073741827就是jdk</span><br><br><span class="hljs-comment"># 执行wordcount, 统计文件的词数</span><br>[xiamu@hadoop202 hadoop-3.1.3]$ hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-3.1.3.jar wordcount /wcinput /123<br><br></code></pre></td></tr></table></figure><p><img src="/assets/1cc14cd283d2404eab339d4b47229779.png"></p><h2 id="集群崩溃重启方案"><a href="#集群崩溃重启方案" class="headerlink" title="集群崩溃重启方案"></a>集群崩溃重启方案</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">删除所有集群hadoop根目录下的data, <span class="hljs-built_in">log</span>目录<br>停止dfs和yarn<br>[xiamu@hadoop202 hadoop-3.1.3]$ stop-dfs.sh<br>[xiamu@hadoop203 hadoop-3.1.3]$ stop-yarn.sh<br><br><span class="hljs-comment"># 格式化namenode</span><br>[xiamu@hadoop202 hadoop-3.1.3]$ hdfs namenode -format<br><br><span class="hljs-comment"># 启动HDFS</span><br>[xiamu@hadoop202 hadoop-3.1.3]$ start-dfs.sh<br><br><span class="hljs-comment"># 启动YARN</span><br>[xiamu@hadoop202 hadoop-3.1.3]$ start-yarn.sh<br></code></pre></td></tr></table></figure><h2 id="配置历史服务器"><a href="#配置历史服务器" class="headerlink" title="配置历史服务器"></a>配置历史服务器</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs bash">[xiamu@hadoop202 hadoop]$ vim mapred-site.xml<br>&lt;configuration&gt;<br>    &lt;!-- 指定MapReduce程序运行在Yarn上 --&gt;<br>    &lt;property&gt;<br>        &lt;name&gt;mapreduce.framework.name&lt;/name&gt;<br>        &lt;value&gt;yarn&lt;/value&gt;<br>    &lt;/property&gt;<br>    &lt;!-- 历史服务器端地址 --&gt;<br>    &lt;property&gt;<br>        &lt;name&gt;mapreduce.jobhistory.address&lt;/name&gt;<br>        &lt;value&gt;hadoop202:10020&lt;/value&gt;<br>    &lt;/property&gt;<br><br>    &lt;!-- 历史服务器web端地址 --&gt;<br>    &lt;property&gt;<br>        &lt;name&gt;mapreduce.jobhistory.webapp.address&lt;/name&gt;<br>        &lt;value&gt;hadoop202:19888&lt;/value&gt;<br>    &lt;/property&gt;<br>&lt;/configuration&gt;<br><br><br><span class="hljs-comment"># 分发配置</span><br>[xiamu@hadoop202 hadoop]$ xsync mapred-site.xml<br><br><span class="hljs-comment"># 启动历史服务器</span><br>[xiamu@hadoop202 hadoop]$ mapred --daemon start historyserver<br><span class="hljs-comment"># 查看历史服务器是否启动</span><br>[xiamu@hadoop202 hadoop]$ jps<br>4420 NodeManager<br>4117 DataNode<br>4661 Jps<br>4620 JobHistoryServer<br>3998 NameNode<br><br><span class="hljs-comment"># 重启YARN</span><br>[xiamu@hadoop203 hadoop]$ stop-yarn.sh<br>[xiamu@hadoop203 hadoop]$ start-yarn.sh<br><br><span class="hljs-comment"># 上传一个文件到hdfs</span><br>[xiamu@hadoop202 hadoop-3.1.3]$ hadoop fs -<span class="hljs-built_in">mkdir</span> /input<br>[xiamu@hadoop202 hadoop-3.1.3]$ hadoop fs -put ./wcinput/word.txt /input<br>[xiamu@hadoop202 hadoop-3.1.3]$ hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-3.1.3.jar wordcount /input /output<br><br></code></pre></td></tr></table></figure><h2 id="配置日志的聚集"><a href="#配置日志的聚集" class="headerlink" title="配置日志的聚集"></a>配置日志的聚集</h2><p>日志聚集概念：应用运行完成以后，将程序运行日志信息上传到 HDFS 系统上。<br>日志聚集功能好处：可以方便的查看到程序运行详情，方便开发调试。<br>注意：开启日志聚集功能，需要重新启动 NodeManager 、ResourceManager 和 HistoryServer。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">[xiamu@hadoop202 hadoop]$ vim yarn-site.xml<br>    &lt;!-- 开启日志聚集功能 --&gt;<br>    &lt;property&gt;<br>        &lt;name&gt;yarn.log-aggregation-enable&lt;/name&gt;<br>        &lt;value&gt;<span class="hljs-literal">true</span>&lt;/value&gt;<br>    &lt;/property&gt;<br>    &lt;!-- 设置日志聚集服务器地址 --&gt;<br>    &lt;property&gt;<br>        &lt;name&gt;yarn.log.server.url&lt;/name&gt;<br>        &lt;value&gt;http://hadoop202:19888/jobhistory/logs&lt;/value&gt;<br>    &lt;/property&gt;<br>    &lt;!-- 设置日志保留时间为7天 --&gt;<br>    &lt;property&gt;<br>        &lt;name&gt;yarn.log-aggregation.retain-seconds&lt;/name&gt;<br>        &lt;value&gt;604800&lt;/value&gt;<br>    &lt;/property&gt;<br><br><span class="hljs-comment"># 分发配置文件</span><br>[xiamu@hadoop202 hadoop]$ xsync yarn-site.xml<br><br><span class="hljs-comment"># 重启yarn</span><br>[xiamu@hadoop203 hadoop]$ stop-yarn.sh<br>[xiamu@hadoop202 hadoop]$ mapred --daemon stop historyserver<br>[xiamu@hadoop203 hadoop]$ start-yarn.sh<br>[xiamu@hadoop202 hadoop]$ mapred --daemon start historyserver<br><br><span class="hljs-comment"># 执行一个程序</span><br>[xiamu@hadoop202 hadoop-3.1.3]$ hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-3.1.3.jar wordcount /input /output2<br><br></code></pre></td></tr></table></figure><p>从<a href="http://hadoop203:8088/cluster">http://hadoop203:8088/cluster</a>访问, 查看当前正在执行的程序, 执行完成之后就可以点进去查看日志</p><h2 id="编写-Hadoop-集群常用脚本"><a href="#编写-Hadoop-集群常用脚本" class="headerlink" title="编写 Hadoop 集群常用脚本"></a>编写 Hadoop 集群常用脚本</h2><p>Hadoop 集群启停脚本（包含 HDFS，Yarn，Historyserver）：myhadoop.sh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs bash">[xiamu@hadoop202 ~]$ <span class="hljs-built_in">cd</span> /home/xiamu/bin/<br>[xiamu@hadoop202 bin]$ vim myhadoop.sh<br><br><span class="hljs-comment">#!/bin/bash</span><br><br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$#</span> -lt 1 ]<br><span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;No Args Input...&quot;</span><br>    <span class="hljs-built_in">exit</span> ;<br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">case</span> <span class="hljs-variable">$1</span> <span class="hljs-keyword">in</span><br><span class="hljs-string">&quot;start&quot;</span>)<br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot; =================== 启动 hadoop集群 ===================&quot;</span><br><br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot; --------------- 启动 hdfs ---------------&quot;</span><br>        ssh hadoop202 <span class="hljs-string">&quot;/opt/module/hadoop-3.1.3/sbin/start-dfs.sh&quot;</span><br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot; --------------- 启动 yarn ---------------&quot;</span><br>        ssh hadoop203 <span class="hljs-string">&quot;/opt/module/hadoop-3.1.3/sbin/start-yarn.sh&quot;</span><br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot; --------------- 启动 historyserver ---------------&quot;</span><br>        ssh hadoop202 <span class="hljs-string">&quot;/opt/module/hadoop-3.1.3/bin/mapred --daemon start historyserver&quot;</span><br>;;<br><span class="hljs-string">&quot;stop&quot;</span>)<br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot; =================== 关闭 hadoop集群 ===================&quot;</span><br><br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot; --------------- 关闭 historyserver ---------------&quot;</span><br>        ssh hadoop202 <span class="hljs-string">&quot;/opt/module/hadoop-3.1.3/bin/mapred --daemon stop historyserver&quot;</span><br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot; --------------- 关闭 yarn ---------------&quot;</span><br>        ssh hadoop203 <span class="hljs-string">&quot;/opt/module/hadoop-3.1.3/sbin/stop-yarn.sh&quot;</span><br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot; --------------- 关闭 hdfs ---------------&quot;</span><br>        ssh hadoop202 <span class="hljs-string">&quot;/opt/module/hadoop-3.1.3/sbin/stop-dfs.sh&quot;</span><br>;;<br>*)<br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Input Args Error...&quot;</span><br>;;<br><span class="hljs-keyword">esac</span><br><br><br>[xiamu@hadoop202 bin]$ <span class="hljs-built_in">chmod</span> 777 myhadoop.sh<br><br><span class="hljs-comment"># 关闭HDFS，Yarn，Historyserver</span><br>[xiamu@hadoop202 bin]$ myhadoop.sh stop<br><br><span class="hljs-comment"># 开启HDFS，Yarn，Historyserver</span><br>[xiamu@hadoop202 ~]$ myhadoop.sh start<br><br></code></pre></td></tr></table></figure><p>查看三台服务器 Java 进程脚本：jpsall</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">[xiamu@hadoop202 ~]$ <span class="hljs-built_in">cd</span> /home/xiamu/bin<br>[xiamu@hadoop202 bin]$ vim jpsall<br><br><span class="hljs-comment">#!/bin/bash</span><br><br><span class="hljs-keyword">for</span> host <span class="hljs-keyword">in</span> hadoop202 hadoop203 hadoop204<br><span class="hljs-keyword">do</span><br>        <span class="hljs-built_in">echo</span> =============== <span class="hljs-variable">$host</span> ===============<br>        ssh <span class="hljs-variable">$host</span> jps<br><span class="hljs-keyword">done</span><br><br>[xiamu@hadoop202 bin]$ <span class="hljs-built_in">chmod</span> 777 jpsall<br><span class="hljs-comment"># 执行方式</span><br>[xiamu@hadoop202 bin]$ jpsall<br><br><span class="hljs-comment"># 分发脚本</span><br>[xiamu@hadoop202 ~]$ xsync /home/xiamu/bin/<br><br></code></pre></td></tr></table></figure><h2 id="常用端口号"><a href="#常用端口号" class="headerlink" title="常用端口号"></a>常用端口号</h2><p>hadoop3.x<br>HDFS NameNode 内部通信端口: 8020&#x2F;9000&#x2F;9820<br>HDFS NameNode 对用户的查询端口: 9870<br>Yarn 查看任务运行情况的: 8088<br>历史服务器: 19888<br>hadoop2.x<br>HDFS NameNode 内部通信端口: 8020&#x2F;9000<br>HDFS NameNode 对用户的查询端口: 50070<br>Yarn 查看任务运行情况的: 8088<br>历史服务器: 19888</p><h2 id="常用的配置文件"><a href="#常用的配置文件" class="headerlink" title="常用的配置文件"></a>常用的配置文件</h2><p>3.x core-site.xml hdfs-site.xml yarn-site.xml mapred-site.xml workers<br>2.x core-site.xml hdfs-site.xml yarn-site.xml mapred-site.xml slaves</p><h2 id="集群的时间同步-可选"><a href="#集群的时间同步-可选" class="headerlink" title="集群的时间同步(可选)"></a>集群的时间同步(可选)</h2><p>一般来说, 集群连接了外网就可以不用配置<br>设置完成之后不知道为啥会 1 Jan 22:31:36 ntpdate[1532]: bind() fails: Permission denied</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br>[root@hadoop202 xiamu]<span class="hljs-comment"># yum install ntp</span><br>[root@hadoop202 xiamu]<span class="hljs-comment"># systemctl status ntpd</span><br>[root@hadoop202 xiamu]<span class="hljs-comment"># systemctl start ntpd</span><br>[root@hadoop202 xiamu]<span class="hljs-comment"># vim /etc/ntp.conf</span><br><br>1. 把<br><span class="hljs-comment">#restrict 192.168.1.0 mask 255.255.255.0 nomodify notrap</span><br>修改成<br>restrict 192.168.1.0 mask 255.255.255.0 nomodify notrap<br><br>192.168.1.0表示是192.168.1这个网段的<br><br>2.把<br>server 0.centos.pool.ntp.org iburst<br>server 1.centos.pool.ntp.org iburst<br>server 2.centos.pool.ntp.org iburst<br>server 3.centos.pool.ntp.org iburst<br>注释掉<br><span class="hljs-comment"># server 0.centos.pool.ntp.org iburst</span><br><span class="hljs-comment"># server 1.centos.pool.ntp.org iburst</span><br><span class="hljs-comment"># server 2.centos.pool.ntp.org iburst</span><br><span class="hljs-comment"># server 3.centos.pool.ntp.org iburst</span><br><br>3.文件末尾追加两句<br>erver 127.127.1.0<br>fudge 127.127.1.0 stratum 10<br><br><br><span class="hljs-comment"># 修改hadoop202中的 /etc/sysconfig/ntpd 文件</span><br><span class="hljs-comment"># 追加一行</span><br>[root@hadoop202 xiamu]<span class="hljs-comment"># vim /etc/sysconfig/ntpd</span><br>SYNC_HWCLOCK=<span class="hljs-built_in">yes</span><br><span class="hljs-comment"># 重启ntpd服务</span><br>[root@hadoop202 xiamu]<span class="hljs-comment"># systemctl restart ntpd</span><br><span class="hljs-comment"># 设置开机自启动</span><br>[root@hadoop202 xiamu]<span class="hljs-comment"># systemctl enable ntpd</span><br><br><br>hadoop203主机<br>[root@hadoop203 bin]<span class="hljs-comment"># systemctl stop ntpd</span><br>[root@hadoop203 bin]<span class="hljs-comment"># systemctl disable ntpd</span><br>[root@hadoop203 bin]<span class="hljs-comment"># crontab -e</span><br>*/1 * * * * /usr/sbin/ntpdate hadoop202<br><br><span class="hljs-comment"># 随便修改一个时间</span><br>[root@hadoop203 bin]<span class="hljs-comment"># date -s &quot;2021-9-11 11:11:11&quot;</span><br>2021年 09月 11日 星期六 11:11:11 CST<br><span class="hljs-comment"># 查看时间</span><br>[root@hadoop203 bin]<span class="hljs-comment"># date</span><br>2021年 09月 11日 星期六 11:11:17 CST<br><br></code></pre></td></tr></table></figure><h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">[xiamu@hadoop202 ~]$ hadoop fs -put /opt/software/jdk-8u212-linux-x64.tar.gz /<br></code></pre></td></tr></table></figure><p>块大小是 128M, 但是 jdk 的大小超过了块大小, 所有 jdk 有两个块<br><img src="/assets/a5d1bb2c05d84e5c9f10b3074c166466.png"><br><img src="/assets/bda162072887490a861bd268097004f1.png"></p>]]></content>
    
    
    <categories>
      
      <category>Hadoop</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hadoop</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Maven ClassNotFoundException MySql</title>
    <link href="/uncategorized/Maven%20ClassNotFoundException%20MySql/"/>
    <url>/uncategorized/Maven%20ClassNotFoundException%20MySql/</url>
    
    <content type="html"><![CDATA[<p>在 maven 导入 mysql-connector-java 的时候报错,<br>java.lang.ClassNotFoundException<br>检查如下代码, 打包成 war 包</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>war<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>8.0.30<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ElasticSearch</title>
    <link href="/Java/ElasticSearch/"/>
    <url>/Java/ElasticSearch/</url>
    
    <content type="html"><![CDATA[<h2 id="下载-ElasticSearch"><a href="#下载-ElasticSearch" class="headerlink" title="下载 ElasticSearch"></a>下载 ElasticSearch</h2><p><a href="https://www.elastic.co/cn/">https://www.elastic.co/cn/</a><img src="/assets/af1491db280349fe93017a805b7791d4.png"><br><img src="/assets/00c621a5421c4f73a941f2522b645d3b.png"><br><a href="https://www.elastic.co/cn/downloads/past-releases/elasticsearch-7-8-0">https://www.elastic.co/cn/downloads/past-releases/elasticsearch-7-8-0</a><br><img src="/assets/cf0529ac8ddc4fed9ca3c8814f66b190.png"><br>下载之后解压, 文件目录如下<br><img src="/assets/733f1e57d09046fe9760b6fdf08c8d01.png"><br>bin 可执行脚本目录<br> config 配置目录<br> jdk 内置 JDK 目录<br> lib 类库<br> logs 日志目录<br> modules 模块目录<br> plugins 插件目录</p><h2 id="启动-ElasticSearch"><a href="#启动-ElasticSearch" class="headerlink" title="启动 ElasticSearch"></a>启动 ElasticSearch</h2><p>要确保 java -version 和 echo %JAVA_HOME% 的版本一致<br><img src="/assets/03e0a7985ca94042b8e52d031de2cbb4.png"><br>打开 bin 目录, 双击 elasticsearch.bat 文件, 会弹出一个黑框, 注意, 你的笔记本电脑需要有 java 环境<br><img src="/assets/ac68e1470369481d948b56b91d69dc07.png"><br>双击之后关注两个位置<br><img src="/assets/3eb84651efd54bb289d45587eadb284d.png"><br>在浏览器中打开<a href="http://127.0.0.1:9200/">http://127.0.0.1:9200/</a><br>显示如下内容说明 elasticsearch 启动成功<br><img src="/assets/3743c9e9a8a346258bb637317a897223.png"></p><h2 id="数据格式"><a href="#数据格式" class="headerlink" title="数据格式"></a>数据格式</h2><p>Elasticsearch 是面向文档型数据库，一条数据在这里就是一个文档。为了方便大家理解， 我们将 Elasticsearch 里存储文档数据和关系型数据库 MySQL 存储数据的概念进行一个类比<br><img src="/assets/186b8b43ab2e4a50b534ea2d334f3093.png"><br>ES 里的 Index 可以看做一个库，而 Types 相当于表，Documents 则相当于表的行。 这里 Types 的概念已经被逐渐弱化，Elasticsearch 6.X 中，一个 index 下已经只能包含一个 type，Elasticsearch 7.X 中, Type 的概念已经被删除了。</p><h2 id="索引操作"><a href="#索引操作" class="headerlink" title="索引操作"></a>索引操作</h2><h3 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h3><p>打开 postman, 给<a href="http://localhost:9200/shopping">http://localhost:9200/shopping</a>发送 PUT 请求<br><img src="/assets/fc2fec79c53e40908fe134acc8ae53d9.png"></p><blockquote><p>幂等（idempotent、idempotence）是一个数学与计算机学概念，常见于抽象代数中。 在编程中一个幂等操作的特点是其任意多次执行所产生的影响均与一次执行的影响相同。 幂等函数，或幂等方法，是指可以使用相同参数重复执行，并能获得相同结果的函数。</p></blockquote><p>简单来说, 就是调用一次, 和调用多次得到的结果是一样的<br>PUT 是具有幂等性的, 创建好 shopping 之后, 再次发送请求, 就会提示, 已经创建好了<br><img src="/assets/552d68d5b13b4c389235616122b49367.png"><br>不能够发送 POST 请求, 因为 POST 请求不是幂等的, 两次的操作可能不一样<br><img src="/assets/5bbb0998828c427096046cdfb60e77dc.png"><br>允许使用的只有 GET, DELETE, HEAD, PUT</p><h3 id="查询索引"><a href="#查询索引" class="headerlink" title="查询索引"></a>查询索引</h3><p><strong>查询单个索引</strong>发送 get 请求<a href="http://localhost:9200/shopping">http://localhost:9200/shopping</a><br><img src="/assets/29e6b7c6f45447adba34c3b33439f799.png"><br><img src="/assets/16ad0745ca07461c938426af51c9593f.png"><br><strong>查询所有索引</strong>发送 get 请求<a href="http://localhost:9200/_cat/indices?v">http://localhost:9200/_cat&#x2F;indices?v</a><br><img src="/assets/f033ae3943284ea9b3ae9cfaa8cf2ca1.png"><br><img src="/assets/f2ec92e48c0c4578a68ee6dbd3dd1898.png"></p><h3 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h3><p>使用 delete 发送<a href="http://localhost:9200/shopping">http://localhost:9200/shopping</a>请求<br><img src="/assets/f11f1ee3788147bdb1bd651e768c7542.png"><br><img src="/assets/53e36c67fe1042768699ac8322019d87.png"><br>再次查询所有索引, 发现已经没有 shopping 索引了<br><img src="/assets/e7bea63145a447a79d30fb8683407dd8.png"></p><h2 id="添加数据"><a href="#添加数据" class="headerlink" title="添加数据"></a>添加数据</h2><p>创建文档并添加数据<br>使用 Post 发送请求<a href="http://127.0.0.1:9200/shopping/_doc">http://127.0.0.1:9200/shopping/_doc</a><br>在 Body 中携带 JSON 数据</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;小米手机&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;category&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;小米&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;images&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://www.gulixueyuan.com/xm.jpg&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;price&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3999.0</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p><img src="/assets/8c772ebbe151406c9bcc67b93967c993.png"><br>此处发送请求的方式必须为 POST，不能是 PUT，否则会发生错误<br><img src="/assets/f617e980d8b043379e5a21984f2641a3.png"><br>上面的数据创建后，由于没有指定数据唯一性标识（ID），默认情况下，ES 服务器会随机 生成一个。<br> 如果想要自定义唯一性标识，需要在创建时指定：<a href="http://127.0.0.1:9200/shopping/_doc/114514">http://127.0.0.1:9200/shopping/_doc&#x2F;114514</a><br>此处需要注意：如果增加数据时明确数据主键，那么请求方式也可以为 PUT<br><img src="/assets/6a6a52e4976741abb9b52ee00db032bb.png"></p><h2 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h2><p><strong>主键查询</strong><br>使用 GET 发送<a href="http://127.0.0.1:9200/shopping/_doc/114514">http://127.0.0.1:9200/shopping/_doc&#x2F;114514</a><br><img src="/assets/b50b7f7543b04cf18d06aba3b7f93ceb.png"><br><strong>查询所有数据</strong><br>使用 GET 发送<a href="http://127.0.0.1:9200/shopping/_search">http://127.0.0.1:9200/shopping/_search</a><br><img src="/assets/e345e3b753414dbcaafce44539025aa5.png"></p><h2 id="修改数据"><a href="#修改数据" class="headerlink" title="修改数据"></a>修改数据</h2><p><strong>全量修改</strong><br>使用 POST 发送<a href="http://127.0.0.1:9200/shopping/_doc/114514">http://127.0.0.1:9200/shopping/_doc&#x2F;114514</a><br>在 Body 携带 JSON</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;华为手机&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;category&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;华为&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;images&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://www.gulixueyuan.com/hw.jpg&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;price&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4999.0</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p><img src="/assets/434b1e2391b84bf8b0f655d52bf34a17.png"><br><strong>局部修改</strong><br>只修改当中的某一个属性<br>使用 PUT 发送<a href="http://127.0.0.1:9200/shopping/_doc/114514">http://127.0.0.1:9200/shopping/_doc&#x2F;114514</a><br>携带 JSON 参数</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;_doc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;price&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;5999.00&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p><img src="/assets/175439acc9cd4b469b4feaae5602b90b.png"></p><h2 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h2><p>使用 DELETE 发送<a href="http://127.0.0.1:9200/shopping/_doc/114514">http://127.0.0.1:9200/shopping/_doc&#x2F;114514</a><br><img src="/assets/bd57996beeeb424ea25ec8cdb512af5a.png"><br>再次发送 DELETE 请求, 则”result”: “not_found”,<br><img src="/assets/6c10ce32f5834e85a31177530e1caf16.png"></p><h2 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h2><p>第一种直接在地址栏中带参数<br>使用 GET 发送请求 <a href="http://127.0.0.1:9200/shopping/_search?q=category:">http://127.0.0.1:9200/shopping/_search?q&#x3D;category:</a>小米<br><img src="/assets/a14135d88b33472496a6da0ed6e7105a.png"><br>第二种: 在请求头中带参数, 避免的地址栏中包含中文会乱码的问题<br>使用 GET 发送请求<a href="http://127.0.0.1:9200/shopping/_search">http://127.0.0.1:9200/shopping/_search</a><br>请求头携带 JSON 格式</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;query&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;match&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;category&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;小米&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>同样能够查询出来 category 是小米的数据<br><img src="/assets/e1d6ee64cf064e20afee12fe9fbe4238.png"></p><p>全查询<br>使用 GET 发送<a href="http://127.0.0.1:9200/shopping/_search">http://127.0.0.1:9200/shopping/_search</a><br>请求头携带</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;query&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;match_all&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>最后查询的结果是把数据全部查询出来<br><img src="/assets/27b2b61a4b984ce5b0c954a683016338.png"></p><h2 id="分页查询和条件查询"><a href="#分页查询和条件查询" class="headerlink" title="分页查询和条件查询"></a>分页查询和条件查询</h2><p>使用 GET 发送<a href="http://127.0.0.1:9200/shopping/_search">http://127.0.0.1:9200/shopping/_search</a><br>请求头携带 JSON:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;query&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;match_all&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;from&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;size&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;_source&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;title&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;sort&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;price&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;desc&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br><br>from是起始位置<br>from = (页面 - <span class="hljs-number">1</span>) * 每页数据条数<br><br>_source是指定当前只查询的字段<br>sort是指定需要对某一个字段进行排序操作<br></code></pre></td></tr></table></figure><h2 id="多条件查询"><a href="#多条件查询" class="headerlink" title="多条件查询"></a>多条件查询</h2><p>使用 GET 发送<a href="http://127.0.0.1:9200/shopping/_search">http://127.0.0.1:9200/shopping/_search</a><br>请求头 JSON:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;query&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;bool&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;must&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;match&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;category&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;小米&quot;</span><br>          <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;match&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;price&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3999.0</span><br>          <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>must 表示: 匹配的条件, category 是小米, 并且 price 也要是 3999<br>must 可以替换成 should, 表示</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs ada">&#123;<br>    <span class="hljs-string">&quot;query&quot;</span> : &#123;<br><span class="hljs-string">&quot;bool&quot;</span> : &#123;<br><span class="hljs-string">&quot;should&quot;</span> : [<br>&#123;<br><span class="hljs-string">&quot;match&quot;</span> : &#123;<br><span class="hljs-string">&quot;category&quot;</span> : &quot;小米&quot;<br>&#125;<br>&#125;,<br>&#123;<br><span class="hljs-string">&quot;match&quot;</span> : &#123;<br><span class="hljs-string">&quot;category&quot;</span> : &quot;华为&quot;<br>&#125;<br>&#125;<br>]<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>加上范围, 查询大于 5000 价格的手机的</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs ada">&#123;<br>    <span class="hljs-string">&quot;query&quot;</span> : &#123;<br>        <span class="hljs-string">&quot;bool&quot;</span> : &#123;<br>            <span class="hljs-string">&quot;should&quot;</span> : [<br>                &#123;<br>                    <span class="hljs-string">&quot;match&quot;</span> : &#123;<br>                        <span class="hljs-string">&quot;category&quot;</span> : &quot;小米&quot;<br>                    &#125;<br>                &#125;,<br>                &#123;<br>                    <span class="hljs-string">&quot;match&quot;</span> : &#123;<br>                        <span class="hljs-string">&quot;category&quot;</span> : &quot;华为&quot;<br>                    &#125;<br>                &#125;<br>            ],<br>            <span class="hljs-string">&quot;filter&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;range&quot;</span> : &#123;<br>                    <span class="hljs-string">&quot;price&quot;</span> : &#123;<br>                        <span class="hljs-string">&quot;gt&quot;</span> : 5000<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="全文检索-amp-完全匹配-amp-高亮查询"><a href="#全文检索-amp-完全匹配-amp-高亮查询" class="headerlink" title="全文检索 &amp; 完全匹配 &amp; 高亮查询"></a>全文检索 &amp; 完全匹配 &amp; 高亮查询</h2><p><strong>全文检索</strong><br>使用 GET 发送<a href="http://127.0.0.1:9200/shopping/_search">http://127.0.0.1:9200/shopping/_search</a><br>Body 携带 JSON</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ada">&#123;<br>    <span class="hljs-string">&quot;query&quot;</span> : &#123;<br>        <span class="hljs-string">&quot;match&quot;</span> : &#123;<br>            <span class="hljs-string">&quot;category&quot;</span> : &quot;米&quot;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>category 中带有 “米” 的关键字都会被查询出来<br>如果 category: “华米”, category 中会查询出 “华为” , “小米”等等这种字段</p><p><strong>完全匹配</strong><br>如果不想使用这种全文检索, 那么可以采用完全匹配的规则进行查询<br>使用 GET 发送<a href="http://127.0.0.1:9200/shopping/_search">http://127.0.0.1:9200/shopping/_search</a><br>Body 携带 JSON</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ada">&#123;<br>    <span class="hljs-string">&quot;query&quot;</span> : &#123;<br>        <span class="hljs-string">&quot;match_phrase&quot;</span> : &#123;<br>            <span class="hljs-string">&quot;category&quot;</span> : &quot;华米&quot;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>这样匹配, 就不会同时出现”小米” “华为”了, 只会精准的匹配到”华米”</p><p><strong>高亮查询</strong><br>使用 GET 发送<a href="http://127.0.0.1:9200/shopping/_search">http://127.0.0.1:9200/shopping/_search</a><br>Body 携带 JSON</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs ada">&#123;<br>    <span class="hljs-string">&quot;query&quot;</span> : &#123;<br>        <span class="hljs-string">&quot;match_phrase&quot;</span> : &#123;<br>            <span class="hljs-string">&quot;category&quot;</span> : &quot;小米&quot;<br>        &#125;<br>    &#125;,<br>    <span class="hljs-string">&quot;highlight&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;fields&quot;</span> : &#123;<br>            <span class="hljs-string">&quot;category&quot;</span> : &#123;&#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br><br>返回的数据如下: 会在highlight中加上高亮的效果<br>&#123;<br>    <span class="hljs-string">&quot;_index&quot;</span>: <span class="hljs-string">&quot;shopping&quot;</span>,<br>    <span class="hljs-string">&quot;_type&quot;</span>: <span class="hljs-string">&quot;_doc&quot;</span>,<br>    <span class="hljs-string">&quot;_id&quot;</span>: <span class="hljs-string">&quot;1009&quot;</span>,<br>    <span class="hljs-string">&quot;_score&quot;</span>: <span class="hljs-number">0.5156582</span>,<br>    <span class="hljs-string">&quot;_source&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;小米手机&quot;</span>,<br>        <span class="hljs-string">&quot;category&quot;</span>: <span class="hljs-string">&quot;小米&quot;</span>,<br>        <span class="hljs-string">&quot;images&quot;</span>: <span class="hljs-string">&quot;http://www.gulixueyuan.com/hw.jpg&quot;</span>,<br>        <span class="hljs-string">&quot;price&quot;</span>: <span class="hljs-number">9999.00</span><br>    &#125;,<br>    <span class="hljs-string">&quot;highlight&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;category&quot;</span>: [<br>            <span class="hljs-string">&quot;&lt;em&gt;小&lt;/em&gt;&lt;em&gt;米&lt;/em&gt;&quot;</span><br>        ]<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="聚合查询"><a href="#聚合查询" class="headerlink" title="聚合查询"></a>聚合查询</h2><p>使用 GET 发送<a href="http://127.0.0.1:9200/shopping/_search">http://127.0.0.1:9200/shopping/_search</a><br>Body 携带 JSON</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs awk">&#123;<br>    <span class="hljs-string">&quot;aggs&quot;</span> : &#123; <span class="hljs-regexp">//</span> 聚合操作<br>        <span class="hljs-string">&quot;price_group&quot;</span> : &#123; <span class="hljs-regexp">//</span> 名称: 随意起名<br>            <span class="hljs-string">&quot;terms&quot;</span> : &#123; <span class="hljs-regexp">//</span> 分组<br>                <span class="hljs-string">&quot;field&quot;</span> : <span class="hljs-string">&quot;price&quot;</span> <span class="hljs-regexp">//</span> 分组字段<br>            &#125;<br>        &#125;<br>    &#125;,<br>    <span class="hljs-string">&quot;size&quot;</span> : <span class="hljs-number">0</span> <span class="hljs-regexp">//</span> 不查询原数据<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/assets/1bf32d55d4d24de0bb276a06c0f5ca16.png"><br>使用 GET 发送<a href="http://127.0.0.1:9200/shopping/_search">http://127.0.0.1:9200/shopping/_search</a><br>Body 携带 JSON</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs awk">&#123;<br>    <span class="hljs-string">&quot;aggs&quot;</span> : &#123; <span class="hljs-regexp">//</span> 聚合操作<br>        <span class="hljs-string">&quot;price_avg&quot;</span> : &#123; <span class="hljs-regexp">//</span> 名称: 随意起名<br>            <span class="hljs-string">&quot;avg&quot;</span> : &#123; <span class="hljs-regexp">//</span> 平均值<br>                <span class="hljs-string">&quot;field&quot;</span> : <span class="hljs-string">&quot;price&quot;</span> <span class="hljs-regexp">//</span> 分组字段<br>            &#125;<br>        &#125;<br>    &#125;,<br>    <span class="hljs-string">&quot;size&quot;</span> : <span class="hljs-number">0</span> <span class="hljs-regexp">//</span> 不查询原数据<br>&#125;<br></code></pre></td></tr></table></figure><p>查询结果如下:<br><img src="/assets/0b75a0779e4c4826b1187a46a8f162db.png"></p><h2 id="映射关系"><a href="#映射关系" class="headerlink" title="映射关系"></a>映射关系</h2><p>先使用 PUT 发送<a href="http://localhost:9200/user">http://localhost:9200/user</a><br>创建 user 索引<br>Body 携带 JSON</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs ada">&#123;<br>    <span class="hljs-string">&quot;properties&quot;</span> : &#123;<br>        <span class="hljs-string">&quot;name&quot;</span> : &#123;<br>            <span class="hljs-string">&quot;type&quot;</span> : &quot;<span class="hljs-type">text</span><span class="hljs-string">&quot;,</span><br><span class="hljs-string">            &quot;</span>index<span class="hljs-string">&quot; : true</span><br><span class="hljs-string">        &#125;,</span><br><span class="hljs-string">        &quot;</span>sex<span class="hljs-string">&quot; : &#123;</span><br><span class="hljs-string">            &quot;</span><span class="hljs-keyword">type</span><span class="hljs-string">&quot; : &quot;</span>keyword<span class="hljs-string">&quot;,</span><br><span class="hljs-string">            &quot;</span>index<span class="hljs-string">&quot; : true</span><br><span class="hljs-string">        &#125;,</span><br><span class="hljs-string">        &quot;</span>tel<span class="hljs-string">&quot; : &#123;</span><br><span class="hljs-string">            &quot;</span><span class="hljs-keyword">type</span><span class="hljs-string">&quot; : &quot;</span>keyword<span class="hljs-string">&quot;,</span><br><span class="hljs-string">            &quot;</span>index<span class="hljs-string">&quot; : false</span><br><span class="hljs-string">        &#125;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">&#125;</span><br></code></pre></td></tr></table></figure><p>使用 PUT 发送<a href="http://localhost:9200/user/_create/1001">http://localhost:9200/user/_create&#x2F;1001</a><br>添加一条数据<br>Body 携带 JSON</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;name&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;小米&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;sex&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;男的&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;tel&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1111&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>type：类型，Elasticsearch 中支持的数据类型非常丰富，说几个关键的：<br> String 类型，又分两种：<br> text：可分词<br> keyword：不可分词，数据会作为完整字段进行匹配<br> Numerical：数值类型，分两类<br>基本数据类型：long、integer、short、byte、double、float、half_float<br>浮点数的高精度类型：scaled_float<br> Date：日期类型<br> Array：数组类型<br> Object：对象<br> index：是否索引，默认为 true，也就是说你不进行任何配置，所有字段都会被索引。<br> true：字段会被索引，则可以用来进行搜索<br>false：字段不会被索引，不能用来搜索<br>使用 GET 发送<a href="http://localhost:9200/user/_search">http://localhost:9200/user/_search</a></p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ada">&#123;<br>    <span class="hljs-string">&quot;query&quot;</span> : &#123;<br>        <span class="hljs-string">&quot;match&quot;</span> : &#123;<br>            <span class="hljs-string">&quot;name&quot;</span> : &quot;小&quot;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/assets/00308191bd0b4f769b4602c6760a695e.png"></p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ada">&#123;<br>    <span class="hljs-string">&quot;query&quot;</span> : &#123;<br>        <span class="hljs-string">&quot;match&quot;</span> : &#123;<br>            <span class="hljs-string">&quot;sex&quot;</span> : &quot;男&quot;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/assets/644991d37e234273b5b46a3b13e5dfdd.png"></p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ada">&#123;<br>    <span class="hljs-string">&quot;query&quot;</span> : &#123;<br>        <span class="hljs-string">&quot;match&quot;</span> : &#123;<br>            <span class="hljs-string">&quot;tel&quot;</span> : &quot;1111&quot;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/assets/cb7a0484b7ae43a0b93ec26f5fde2ee2.png"></p><h2 id="在-Java-项目中使用-ElasticSearch"><a href="#在-Java-项目中使用-ElasticSearch" class="headerlink" title="在 Java 项目中使用 ElasticSearch"></a>在 Java 项目中使用 ElasticSearch</h2><h3 id="ERROR-StatusLogger-No-log4j2-configuration-file-found-Using-default-configuration-logging-only-errors-to-the-console-Set-system-property-‘org-apache-logging-log4j-simplelog-StatusLogger-level’-to-TRACE-to-show-Log4j2-internal-initialization-logging"><a href="#ERROR-StatusLogger-No-log4j2-configuration-file-found-Using-default-configuration-logging-only-errors-to-the-console-Set-system-property-‘org-apache-logging-log4j-simplelog-StatusLogger-level’-to-TRACE-to-show-Log4j2-internal-initialization-logging" class="headerlink" title="ERROR StatusLogger No log4j2 configuration file found. Using default configuration: logging only errors to the console. Set system property ‘org.apache.logging.log4j.simplelog.StatusLogger.level’ to TRACE to show Log4j2 internal initialization logging."></a>ERROR StatusLogger No log4j2 configuration file found. Using default configuration: logging only errors to the console. Set system property ‘org.apache.logging.log4j.simplelog.StatusLogger.level’ to TRACE to show Log4j2 internal initialization logging.</h3><p>在 resource 目录下创建 log4j2.xml 文件<br><img src="/assets/e658800c71114594b6472f22f13d1445.png"></p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Configuration</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">Appenders</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Console</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;STDOUT&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;SYSTEM_OUT&quot;</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">PatternLayout</span> <span class="hljs-attr">pattern</span>=<span class="hljs-string">&quot;%d %-5p [%t] %C</span></span></span><span class="hljs-template-variable">&#123;2&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string"> (%F:%L) - %m%n&quot;</span>/&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">Console</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">RollingFile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;RollingFile&quot;</span> <span class="hljs-attr">fileName</span>=<span class="hljs-string">&quot;logs/strutslog1.log&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">                     <span class="hljs-attr">filePattern</span>=<span class="hljs-string">&quot;logs/$$</span></span></span><span class="hljs-template-variable">&#123;date:yyyy-MM&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">/app-%d</span></span></span><span class="hljs-template-variable">&#123;MM-dd-yyyy&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">-%i.log.gz&quot;</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">PatternLayout</span>&gt;</span></span><br><span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">Pattern</span>&gt;</span>%d</span><span class="hljs-template-variable">&#123;MM-dd-yyyy&#125;</span><span class="language-xml"> %p %c</span><span class="hljs-template-variable">&#123;1.&#125;</span><span class="language-xml"> [%t] -%M-%L- %m%n<span class="hljs-tag">&lt;/<span class="hljs-name">Pattern</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">PatternLayout</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">Policies</span>&gt;</span></span><br><span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">TimeBasedTriggeringPolicy</span> /&gt;</span></span><br><span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">SizeBasedTriggeringPolicy</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;1 KB&quot;</span>/&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">Policies</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">DefaultRolloverStrategy</span> <span class="hljs-attr">fileIndex</span>=<span class="hljs-string">&quot;max&quot;</span> <span class="hljs-attr">max</span>=<span class="hljs-string">&quot;2&quot;</span>/&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">RollingFile</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Appenders</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">Loggers</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;com.opensymphony.xwork2&quot;</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;WAN&quot;</span>/&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;org.apache.struts2&quot;</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;WAN&quot;</span>/&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;warn&quot;</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">AppenderRef</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;STDOUT&quot;</span>/&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">Root</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Loggers</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">Configuration</span>&gt;</span></span><br></code></pre></td></tr></table></figure><h3 id="连接-ES"><a href="#连接-ES" class="headerlink" title="连接 ES"></a>连接 ES</h3><p>创建一个 maven 项目<br><img src="/assets/db8eb70409194668937a1c607f1f64cb.png"><br>导入如下依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.elasticsearch<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>elasticsearch<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>7.8.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- elasticsearch 的客户端 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.elasticsearch.client<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>elasticsearch-rest-high-level-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>7.8.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- elasticsearch 依赖 2.x 的 log4j --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>log4j-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.8.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>log4j-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.8.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-databind<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.9<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- junit 单元测试 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.12<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><p>测试类运行如下代码, 并没有报错, 说明代码没有错误</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.apache.http.HttpHost;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestClient;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestHighLevelClient;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ESTest_Client</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-comment">// 创建ES客户端</span><br>        <span class="hljs-type">RestHighLevelClient</span> <span class="hljs-variable">esClient</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestHighLevelClient</span>(<br>                RestClient.builder(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpHost</span>(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">9200</span>, <span class="hljs-string">&quot;http&quot;</span>))<br>        );<br>        <span class="hljs-comment">// 关闭ES客户端</span><br>        esClient.close();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="创建索引-1"><a href="#创建索引-1" class="headerlink" title="创建索引"></a>创建索引</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.apache.http.HttpHost;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RequestOptions;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestClient;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestHighLevelClient;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.indices.CreateIndexRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.indices.CreateIndexResponse;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ESTest_Index_Create</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">RestHighLevelClient</span> <span class="hljs-variable">esClient</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestHighLevelClient</span>(<br>                RestClient.builder(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpHost</span>(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">9200</span>, <span class="hljs-string">&quot;http&quot;</span>))<br>        );<br><br>        <span class="hljs-comment">// 创建索引</span><br>        <span class="hljs-type">CreateIndexRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CreateIndexRequest</span>(<span class="hljs-string">&quot;user&quot;</span>);<br>        <span class="hljs-type">CreateIndexResponse</span> <span class="hljs-variable">createIndexResponse</span> <span class="hljs-operator">=</span> esClient.indices().create(request, RequestOptions.DEFAULT);<br><br>        <span class="hljs-comment">// 响应状态</span><br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">acknowledged</span> <span class="hljs-operator">=</span> createIndexResponse.isAcknowledged();<br>        System.out.println(<span class="hljs-string">&quot;索引操作: &quot;</span> + acknowledged);<br><br>        esClient.close();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/assets/3de99b06707841779d6da1220a2b05a5.png"></p><h3 id="查询索引-1"><a href="#查询索引-1" class="headerlink" title="查询索引"></a>查询索引</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.apache.http.HttpHost;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.index.IndexRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RequestOptions;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestClient;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestHighLevelClient;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.indices.CreateIndexRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.indices.CreateIndexResponse;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.indices.GetIndexRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.indices.GetIndexResponse;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ESTest_Index_Search</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">RestHighLevelClient</span> <span class="hljs-variable">esClient</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestHighLevelClient</span>(<br>                RestClient.builder(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpHost</span>(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">9200</span>, <span class="hljs-string">&quot;http&quot;</span>))<br>        );<br><br>        <span class="hljs-comment">// 查询索引</span><br>        <span class="hljs-type">GetIndexRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GetIndexRequest</span>(<span class="hljs-string">&quot;user&quot;</span>);<br>        <span class="hljs-type">GetIndexResponse</span> <span class="hljs-variable">getIndexResponse</span> <span class="hljs-operator">=</span> esClient.indices().get(request, RequestOptions.DEFAULT);<br><br>        <span class="hljs-comment">// 响应状态</span><br>        System.out.println(getIndexResponse.getAliases());<br>        System.out.println(getIndexResponse.getMappings());<br>        System.out.println(getIndexResponse.getSettings());<br><br>        esClient.close();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>查询结果如下:</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><br>&#123;<span class="hljs-keyword">user</span>=[]&#125;<br>&#123;<span class="hljs-keyword">user</span>=org.elasticsearch.<span class="hljs-keyword">cluster</span>.metadata.MappingMetadata@<span class="hljs-number">87817</span>eaa&#125;<br>&#123;<span class="hljs-keyword">user</span>=&#123;&quot;index.creation_date&quot;:&quot;1672228548499&quot;,&quot;index.number_of_replicas&quot;:&quot;1&quot;,&quot;index.number_of_shards&quot;:&quot;1&quot;,&quot;index.provided_name&quot;:&quot;user&quot;,&quot;index.uuid&quot;:&quot;JtqLrkGnT2ONWQ0JqfWY2A&quot;,&quot;index.version.created&quot;:&quot;7080099&quot;&#125;&#125;<br><br><br></code></pre></td></tr></table></figure><h3 id="删除索引-1"><a href="#删除索引-1" class="headerlink" title="删除索引"></a>删除索引</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.apache.http.HttpHost;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.admin.indices.delete.DeleteIndexRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.index.IndexRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.support.master.AcknowledgedResponse;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RequestOptions;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestClient;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestHighLevelClient;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.indices.GetIndexRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.indices.GetIndexResponse;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ESTest_Index_Delete</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">RestHighLevelClient</span> <span class="hljs-variable">esClient</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestHighLevelClient</span>(<br>                RestClient.builder(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpHost</span>(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">9200</span>, <span class="hljs-string">&quot;http&quot;</span>))<br>        );<br><br>        <span class="hljs-comment">// 删除索引</span><br>        <span class="hljs-type">DeleteIndexRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DeleteIndexRequest</span>(<span class="hljs-string">&quot;user&quot;</span>);<br>        <span class="hljs-type">AcknowledgedResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> esClient.indices().delete(request, RequestOptions.DEFAULT);<br><br>        <span class="hljs-comment">// 响应状态</span><br>        System.out.println(response.isAcknowledged());<br><br>        esClient.close();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;<br><span class="hljs-keyword">import</span> org.apache.http.HttpHost;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">admin</span>.indices.<span class="hljs-keyword">delete</span>.DeleteIndexRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">index</span>.IndexRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">index</span>.IndexResponse;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.support.master.AcknowledgedResponse;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RequestOptions;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestClient;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestHighLevelClient;<br><span class="hljs-keyword">import</span> org.elasticsearch.common.xcontent.XContentType;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> ESTest_Index_Insert &#123;<br>    <span class="hljs-built_in">public</span> static <span class="hljs-type">void</span> main(String[] args) throws IOException &#123;<br>        RestHighLevelClient esClient = <span class="hljs-built_in">new</span> RestHighLevelClient(<br>                RestClient.builder(<span class="hljs-built_in">new</span> HttpHost(&quot;localhost&quot;, <span class="hljs-number">9200</span>, &quot;http&quot;))<br>        );<br><br>        // 添加数据<br>        IndexRequest request = <span class="hljs-built_in">new</span> IndexRequest();<br>        request.<span class="hljs-keyword">index</span>(&quot;user&quot;).id(&quot;1001&quot;);<br><br>        <span class="hljs-keyword">User</span> <span class="hljs-keyword">user</span> = <span class="hljs-built_in">new</span> <span class="hljs-keyword">User</span>();<br>        <span class="hljs-keyword">user</span>.setName(&quot;张三&quot;);<br>        <span class="hljs-keyword">user</span>.setAge(<span class="hljs-number">20</span>);<br>        <span class="hljs-keyword">user</span>.setSex(&quot;男&quot;);<br><br>        ObjectMapper mapper = <span class="hljs-built_in">new</span> ObjectMapper();<br>        String userJson = mapper.writeValueAsString(<span class="hljs-keyword">user</span>);<br>        request.source(userJson, XContentType.JSON);<br><br>        IndexResponse response = esClient.<span class="hljs-keyword">index</span>(request, RequestOptions.<span class="hljs-keyword">DEFAULT</span>);<br><br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(response.getResult());<br><br>        esClient.<span class="hljs-keyword">close</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="修改数据-1"><a href="#修改数据-1" class="headerlink" title="修改数据"></a>修改数据</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;<br><span class="hljs-keyword">import</span> org.apache.http.HttpHost;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">index</span>.IndexRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">index</span>.IndexResponse;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">update</span>.UpdateRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">update</span>.UpdateResponse;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RequestOptions;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestClient;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestHighLevelClient;<br><span class="hljs-keyword">import</span> org.elasticsearch.common.xcontent.XContentType;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> ESTest_Index_Update &#123;<br>    <span class="hljs-built_in">public</span> static <span class="hljs-type">void</span> main(String[] args) throws IOException &#123;<br>        RestHighLevelClient esClient = <span class="hljs-built_in">new</span> RestHighLevelClient(<br>                RestClient.builder(<span class="hljs-built_in">new</span> HttpHost(&quot;localhost&quot;, <span class="hljs-number">9200</span>, &quot;http&quot;))<br>        );<br><br>        // 修改数据<br>        UpdateRequest request = <span class="hljs-built_in">new</span> UpdateRequest();<br>        request.<span class="hljs-keyword">index</span>(&quot;user&quot;).id(&quot;1001&quot;);<br><br>        request.doc(XContentType.JSON, &quot;sex&quot;, &quot;女&quot;);<br><br>        UpdateResponse <span class="hljs-keyword">update</span> = esClient.<span class="hljs-keyword">update</span>(request, RequestOptions.<span class="hljs-keyword">DEFAULT</span>);<br><br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(<span class="hljs-keyword">update</span>.getResult());<br><br>        esClient.<span class="hljs-keyword">close</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="查询数据-1"><a href="#查询数据-1" class="headerlink" title="查询数据"></a>查询数据</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">import</span> org.apache.http.HttpHost;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">get</span>.GetRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">get</span>.GetResponse;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">update</span>.UpdateRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">update</span>.UpdateResponse;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RequestOptions;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestClient;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestHighLevelClient;<br><span class="hljs-keyword">import</span> org.elasticsearch.common.xcontent.XContentType;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> ESTest_Doc_Get &#123;<br>    <span class="hljs-built_in">public</span> static <span class="hljs-type">void</span> main(String[] args) throws IOException &#123;<br>        RestHighLevelClient esClient = <span class="hljs-built_in">new</span> RestHighLevelClient(<br>                RestClient.builder(<span class="hljs-built_in">new</span> HttpHost(&quot;localhost&quot;, <span class="hljs-number">9200</span>, &quot;http&quot;))<br>        );<br><br>        // 查询数据<br>        GetRequest request = <span class="hljs-built_in">new</span> GetRequest();<br>        request.<span class="hljs-keyword">index</span>(&quot;user&quot;).id(&quot;1001&quot;);<br>        GetResponse response = esClient.<span class="hljs-keyword">get</span>(request, RequestOptions.<span class="hljs-keyword">DEFAULT</span>);<br><br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(response.getSourceAsString());<br><br>        esClient.<span class="hljs-keyword">close</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="删除数据-1"><a href="#删除数据-1" class="headerlink" title="删除数据"></a>删除数据</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;<br><span class="hljs-keyword">import</span> org.apache.http.HttpHost;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">delete</span>.DeleteRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">delete</span>.DeleteResponse;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">index</span>.IndexRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">index</span>.IndexResponse;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RequestOptions;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestClient;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestHighLevelClient;<br><span class="hljs-keyword">import</span> org.elasticsearch.common.xcontent.XContentType;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> ESTest_Doc_Delete &#123;<br>    <span class="hljs-built_in">public</span> static <span class="hljs-type">void</span> main(String[] args) throws IOException &#123;<br>        RestHighLevelClient esClient = <span class="hljs-built_in">new</span> RestHighLevelClient(<br>                RestClient.builder(<span class="hljs-built_in">new</span> HttpHost(&quot;localhost&quot;, <span class="hljs-number">9200</span>, &quot;http&quot;))<br>        );<br><br>        // 删除数据<br>        DeleteRequest request = <span class="hljs-built_in">new</span> DeleteRequest();<br>        request.<span class="hljs-keyword">index</span>(&quot;user&quot;).id(&quot;1001&quot;);<br><br>        DeleteResponse response = esClient.<span class="hljs-keyword">delete</span>(request, RequestOptions.<span class="hljs-keyword">DEFAULT</span>);<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(response.toString());<br><br>        esClient.<span class="hljs-keyword">close</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="批量添加"><a href="#批量添加" class="headerlink" title="批量添加"></a>批量添加</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;<br><span class="hljs-keyword">import</span> org.apache.http.HttpHost;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.bulk.BulkRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.bulk.BulkResponse;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">index</span>.IndexRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">index</span>.IndexResponse;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RequestOptions;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestClient;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestHighLevelClient;<br><span class="hljs-keyword">import</span> org.elasticsearch.common.xcontent.XContentType;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> ESTest_Doc_Insert_Batch &#123;<br>    <span class="hljs-built_in">public</span> static <span class="hljs-type">void</span> main(String[] args) throws IOException &#123;<br>        RestHighLevelClient esClient = <span class="hljs-built_in">new</span> RestHighLevelClient(<br>                RestClient.builder(<span class="hljs-built_in">new</span> HttpHost(&quot;localhost&quot;, <span class="hljs-number">9200</span>, &quot;http&quot;))<br>        );<br><br>        // 批量添加数据<br>        BulkRequest request = <span class="hljs-built_in">new</span> BulkRequest();<br><br>        request.<span class="hljs-keyword">add</span>(<span class="hljs-built_in">new</span> IndexRequest().<span class="hljs-keyword">index</span>(&quot;user&quot;).id(&quot;1001&quot;).source(XContentType.JSON, &quot;name&quot;, &quot;zhangsan&quot;));<br>        request.<span class="hljs-keyword">add</span>(<span class="hljs-built_in">new</span> IndexRequest().<span class="hljs-keyword">index</span>(&quot;user&quot;).id(&quot;1002&quot;).source(XContentType.JSON, &quot;name&quot;, &quot;lisi&quot;));<br>        request.<span class="hljs-keyword">add</span>(<span class="hljs-built_in">new</span> IndexRequest().<span class="hljs-keyword">index</span>(&quot;user&quot;).id(&quot;1003&quot;).source(XContentType.JSON, &quot;name&quot;, &quot;wangwu&quot;));<br><br>        BulkResponse response = esClient.bulk(request, RequestOptions.<span class="hljs-keyword">DEFAULT</span>);<br><br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(response.getTook());<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(response.getItems());<br><br>        esClient.<span class="hljs-keyword">close</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="批量删除"><a href="#批量删除" class="headerlink" title="批量删除"></a>批量删除</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">import</span> org.apache.http.HttpHost;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.bulk.BulkRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.bulk.BulkResponse;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">delete</span>.DeleteRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">index</span>.IndexRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RequestOptions;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestClient;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestHighLevelClient;<br><span class="hljs-keyword">import</span> org.elasticsearch.common.xcontent.XContentType;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> ESTest_Doc_Delete_Batch &#123;<br>    <span class="hljs-built_in">public</span> static <span class="hljs-type">void</span> main(String[] args) throws IOException &#123;<br>        RestHighLevelClient esClient = <span class="hljs-built_in">new</span> RestHighLevelClient(<br>                RestClient.builder(<span class="hljs-built_in">new</span> HttpHost(&quot;localhost&quot;, <span class="hljs-number">9200</span>, &quot;http&quot;))<br>        );<br><br>        // 批量添加数据<br>        BulkRequest request = <span class="hljs-built_in">new</span> BulkRequest();<br><br>        request.<span class="hljs-keyword">add</span>(<span class="hljs-built_in">new</span> DeleteRequest().<span class="hljs-keyword">index</span>(&quot;user&quot;).id(&quot;1001&quot;));<br>        request.<span class="hljs-keyword">add</span>(<span class="hljs-built_in">new</span> DeleteRequest().<span class="hljs-keyword">index</span>(&quot;user&quot;).id(&quot;1002&quot;));<br>        request.<span class="hljs-keyword">add</span>(<span class="hljs-built_in">new</span> DeleteRequest().<span class="hljs-keyword">index</span>(&quot;user&quot;).id(&quot;1003&quot;));<br><br>        BulkResponse response = esClient.bulk(request, RequestOptions.<span class="hljs-keyword">DEFAULT</span>);<br><br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(response.getTook());<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(response.getItems());<br><br>        esClient.<span class="hljs-keyword">close</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="查询所有数据"><a href="#查询所有数据" class="headerlink" title="查询所有数据"></a>查询所有数据</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">import</span> org.apache.http.HttpHost;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">get</span>.GetRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">get</span>.GetResponse;<br> <span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">search</span>.SearchRequest;<br> <span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">search</span>.SearchResponse;<br> <span class="hljs-keyword">import</span> org.elasticsearch.client.RequestOptions;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestClient;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestHighLevelClient;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">index</span>.query.QueryBuilders;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.SearchHit;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.SearchHits;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.builder.SearchSourceBuilder;<br><br> <span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> ESTest_Doc_Query &#123;<br>    <span class="hljs-built_in">public</span> static <span class="hljs-type">void</span> main(String[] args) throws IOException &#123;<br>        RestHighLevelClient esClient = <span class="hljs-built_in">new</span> RestHighLevelClient(<br>                RestClient.builder(<span class="hljs-built_in">new</span> HttpHost(&quot;localhost&quot;, <span class="hljs-number">9200</span>, &quot;http&quot;))<br>        );<br><br>        // <span class="hljs-number">1.</span>查询索引中全部的数据<br>        SearchRequest request = <span class="hljs-built_in">new</span> SearchRequest();<br>        request.indices(&quot;user&quot;);<br><br>        request.source(<span class="hljs-built_in">new</span> SearchSourceBuilder().query(QueryBuilders.matchAllQuery()));<br><br>        SearchResponse response = esClient.<span class="hljs-keyword">search</span>(request, RequestOptions.<span class="hljs-keyword">DEFAULT</span>);<br><br>        SearchHits hits = response.getHits();<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(hits.getHits());<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(response.getTook());<br>        <span class="hljs-keyword">for</span> (SearchHit hit : hits) &#123;<br>            <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(hit.getSourceAsString());<br>        &#125;<br><br>        esClient.<span class="hljs-keyword">close</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="条件查询-1"><a href="#条件查询-1" class="headerlink" title="条件查询"></a>条件查询</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"> <span class="hljs-keyword">import</span> org.apache.http.HttpHost;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">get</span>.GetRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">get</span>.GetResponse;<br> <span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">search</span>.SearchRequest;<br> <span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">search</span>.SearchResponse;<br> <span class="hljs-keyword">import</span> org.elasticsearch.client.RequestOptions;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestClient;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestHighLevelClient;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">index</span>.query.QueryBuilders;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.SearchHit;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.SearchHits;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.builder.SearchSourceBuilder;<br><br> <span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> ESTest_Doc_Query &#123;<br>    <span class="hljs-built_in">public</span> static <span class="hljs-type">void</span> main(String[] args) throws IOException &#123;<br>        RestHighLevelClient esClient = <span class="hljs-built_in">new</span> RestHighLevelClient(<br>                RestClient.builder(<span class="hljs-built_in">new</span> HttpHost(&quot;localhost&quot;, <span class="hljs-number">9200</span>, &quot;http&quot;))<br>        );<br><br>        // <span class="hljs-number">2.</span>条件查询<br>        SearchRequest request = <span class="hljs-built_in">new</span> SearchRequest();<br>        request.indices(&quot;user&quot;);<br><br>        request.source(<span class="hljs-built_in">new</span> SearchSourceBuilder().query(QueryBuilders.termQuery(&quot;age&quot;, &quot;30&quot;)));<br><br>        SearchResponse response = esClient.<span class="hljs-keyword">search</span>(request, RequestOptions.<span class="hljs-keyword">DEFAULT</span>);<br><br>        SearchHits hits = response.getHits();<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(hits.getHits());<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(response.getTook());<br>        <span class="hljs-keyword">for</span> (SearchHit hit : hits) &#123;<br>            <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(hit.getSourceAsString());<br>        &#125;<br><br>        esClient.<span class="hljs-keyword">close</span>();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">import</span> org.apache.http.HttpHost;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">get</span>.GetRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">get</span>.GetResponse;<br> <span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">search</span>.SearchRequest;<br> <span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">search</span>.SearchResponse;<br> <span class="hljs-keyword">import</span> org.elasticsearch.client.RequestOptions;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestClient;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestHighLevelClient;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">index</span>.query.QueryBuilders;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.SearchHit;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.SearchHits;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.builder.SearchSourceBuilder;<br><br> <span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> ESTest_Doc_Query &#123;<br>    <span class="hljs-built_in">public</span> static <span class="hljs-type">void</span> main(String[] args) throws IOException &#123;<br>        RestHighLevelClient esClient = <span class="hljs-built_in">new</span> RestHighLevelClient(<br>                RestClient.builder(<span class="hljs-built_in">new</span> HttpHost(&quot;localhost&quot;, <span class="hljs-number">9200</span>, &quot;http&quot;))<br>        );<br><br>        // <span class="hljs-number">3.</span>分页查询<br>        SearchRequest request = <span class="hljs-built_in">new</span> SearchRequest();<br>        request.indices(&quot;user&quot;);<br><br>        SearchSourceBuilder builder = <span class="hljs-built_in">new</span> SearchSourceBuilder().query(QueryBuilders.matchAllQuery());<br>        builder.<span class="hljs-keyword">from</span>(<span class="hljs-number">0</span>);<br>        builder.size(<span class="hljs-number">2</span>);<br>        request.source(builder);<br><br>        SearchResponse response = esClient.<span class="hljs-keyword">search</span>(request, RequestOptions.<span class="hljs-keyword">DEFAULT</span>);<br><br>        SearchHits hits = response.getHits();<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(hits.getHits());<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(response.getTook());<br>        <span class="hljs-keyword">for</span> (SearchHit hit : hits) &#123;<br>            <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(hit.getSourceAsString());<br>        &#125;<br><br>        esClient.<span class="hljs-keyword">close</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="查询排序"><a href="#查询排序" class="headerlink" title="查询排序"></a>查询排序</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">import</span> org.apache.http.HttpHost;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">get</span>.GetRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">get</span>.GetResponse;<br> <span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">search</span>.SearchRequest;<br> <span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">search</span>.SearchResponse;<br> <span class="hljs-keyword">import</span> org.elasticsearch.client.RequestOptions;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestClient;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestHighLevelClient;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">index</span>.query.QueryBuilders;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.SearchHit;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.SearchHits;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.builder.SearchSourceBuilder;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.sort.SortOrder;<br><br> <span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> ESTest_Doc_Query &#123;<br>    <span class="hljs-built_in">public</span> static <span class="hljs-type">void</span> main(String[] args) throws IOException &#123;<br>        RestHighLevelClient esClient = <span class="hljs-built_in">new</span> RestHighLevelClient(<br>                RestClient.builder(<span class="hljs-built_in">new</span> HttpHost(&quot;localhost&quot;, <span class="hljs-number">9200</span>, &quot;http&quot;))<br>        );<br><br><br>        // <span class="hljs-number">4.</span>查询排序<br>        SearchRequest request = <span class="hljs-built_in">new</span> SearchRequest();<br>        request.indices(&quot;user&quot;);<br><br>        SearchSourceBuilder builder = <span class="hljs-built_in">new</span> SearchSourceBuilder().query(QueryBuilders.matchAllQuery());<br>        builder.sort(&quot;age&quot;, SortOrder.<span class="hljs-keyword">DESC</span>);<br>        request.source(builder);<br><br>        SearchResponse response = esClient.<span class="hljs-keyword">search</span>(request, RequestOptions.<span class="hljs-keyword">DEFAULT</span>);<br><br>        SearchHits hits = response.getHits();<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(hits.getHits());<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(response.getTook());<br>        <span class="hljs-keyword">for</span> (SearchHit hit : hits) &#123;<br>            <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(hit.getSourceAsString());<br>        &#125;<br><br>        esClient.<span class="hljs-keyword">close</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="过滤字段"><a href="#过滤字段" class="headerlink" title="过滤字段"></a>过滤字段</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">import</span> org.apache.http.HttpHost;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">get</span>.GetRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">get</span>.GetResponse;<br> <span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">search</span>.SearchRequest;<br> <span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">search</span>.SearchResponse;<br> <span class="hljs-keyword">import</span> org.elasticsearch.client.RequestOptions;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestClient;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestHighLevelClient;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">index</span>.query.QueryBuilders;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.SearchHit;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.SearchHits;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.builder.SearchSourceBuilder;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.sort.SortOrder;<br><br> <span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> ESTest_Doc_Query &#123;<br>    <span class="hljs-built_in">public</span> static <span class="hljs-type">void</span> main(String[] args) throws IOException &#123;<br>        RestHighLevelClient esClient = <span class="hljs-built_in">new</span> RestHighLevelClient(<br>                RestClient.builder(<span class="hljs-built_in">new</span> HttpHost(&quot;localhost&quot;, <span class="hljs-number">9200</span>, &quot;http&quot;))<br>        );<br><br>        // <span class="hljs-number">5.</span>过滤字段<br>        SearchRequest request = <span class="hljs-built_in">new</span> SearchRequest();<br>        request.indices(&quot;user&quot;);<br><br>        SearchSourceBuilder builder = <span class="hljs-built_in">new</span> SearchSourceBuilder().query(QueryBuilders.matchAllQuery());<br>        String[] includes = &#123;&#125;;<br>        String[] excludes = &#123;&quot;sex&quot;&#125;;<br>        <span class="hljs-comment">/*String[] includes = &#123;&quot;name&quot;&#125;;</span><br><span class="hljs-comment">        String[] excludes = &#123;&#125;;*/</span><br>        builder.fetchSource(includes, excludes);<br>        request.source(builder);<br><br>        SearchResponse response = esClient.<span class="hljs-keyword">search</span>(request, RequestOptions.<span class="hljs-keyword">DEFAULT</span>);<br><br>        SearchHits hits = response.getHits();<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(hits.getHits());<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(response.getTook());<br>        <span class="hljs-keyword">for</span> (SearchHit hit : hits) &#123;<br>            <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(hit.getSourceAsString());<br>        &#125;<br><br>        esClient.<span class="hljs-keyword">close</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="组合查询"><a href="#组合查询" class="headerlink" title="组合查询"></a>组合查询</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">import</span> org.apache.http.HttpHost;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">get</span>.GetRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">get</span>.GetResponse;<br> <span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">search</span>.SearchRequest;<br> <span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">search</span>.SearchResponse;<br> <span class="hljs-keyword">import</span> org.elasticsearch.client.RequestOptions;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestClient;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestHighLevelClient;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">index</span>.query.BoolQueryBuilder;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">index</span>.query.QueryBuilders;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.SearchHit;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.SearchHits;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.builder.SearchSourceBuilder;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.sort.SortOrder;<br><br> <span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> ESTest_Doc_Query &#123;<br>    <span class="hljs-built_in">public</span> static <span class="hljs-type">void</span> main(String[] args) throws IOException &#123;<br>        RestHighLevelClient esClient = <span class="hljs-built_in">new</span> RestHighLevelClient(<br>                RestClient.builder(<span class="hljs-built_in">new</span> HttpHost(&quot;localhost&quot;, <span class="hljs-number">9200</span>, &quot;http&quot;))<br>        );<br><br>        // <span class="hljs-number">6.</span>组合查询<br>        SearchRequest request = <span class="hljs-built_in">new</span> SearchRequest();<br>        request.indices(&quot;user&quot;);<br><br>        SearchSourceBuilder builder = <span class="hljs-built_in">new</span> SearchSourceBuilder().query(QueryBuilders.matchAllQuery());<br>        BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();<br>//        boolQueryBuilder.must(QueryBuilders.matchQuery(&quot;age&quot;, <span class="hljs-number">23</span>));<br>//        boolQueryBuilder.must(QueryBuilders.matchQuery(&quot;sex&quot;, &quot;男&quot;));<br>//        boolQueryBuilder.mustNot(QueryBuilders.matchQuery(&quot;sex&quot;, &quot;男&quot;));<br>        boolQueryBuilder.should(QueryBuilders.matchQuery(&quot;age&quot;, <span class="hljs-number">20</span>));<br>        boolQueryBuilder.should(QueryBuilders.matchQuery(&quot;age&quot;, <span class="hljs-number">23</span>));<br><br>        builder.query(boolQueryBuilder);<br><br>        request.source(builder);<br><br>        SearchResponse response = esClient.<span class="hljs-keyword">search</span>(request, RequestOptions.<span class="hljs-keyword">DEFAULT</span>);<br><br>        SearchHits hits = response.getHits();<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(hits.getHits());<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(response.getTook());<br>        <span class="hljs-keyword">for</span> (SearchHit hit : hits) &#123;<br>            <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(hit.getSourceAsString());<br>        &#125;<br><br>        esClient.<span class="hljs-keyword">close</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="范围查询"><a href="#范围查询" class="headerlink" title="范围查询"></a>范围查询</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">import</span> org.apache.http.HttpHost;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">get</span>.GetRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">get</span>.GetResponse;<br> <span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">search</span>.SearchRequest;<br> <span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">search</span>.SearchResponse;<br> <span class="hljs-keyword">import</span> org.elasticsearch.client.RequestOptions;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestClient;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestHighLevelClient;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">index</span>.query.BoolQueryBuilder;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">index</span>.query.QueryBuilders;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">index</span>.query.RangeQueryBuilder;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.SearchHit;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.SearchHits;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.builder.SearchSourceBuilder;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.sort.SortOrder;<br><br> <span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> ESTest_Doc_Query &#123;<br>    <span class="hljs-built_in">public</span> static <span class="hljs-type">void</span> main(String[] args) throws IOException &#123;<br>        RestHighLevelClient esClient = <span class="hljs-built_in">new</span> RestHighLevelClient(<br>                RestClient.builder(<span class="hljs-built_in">new</span> HttpHost(&quot;localhost&quot;, <span class="hljs-number">9200</span>, &quot;http&quot;))<br>        );<br><br>        // <span class="hljs-number">7.</span>范围查询<br>        SearchRequest request = <span class="hljs-built_in">new</span> SearchRequest();<br>        request.indices(&quot;user&quot;);<br><br>        SearchSourceBuilder builder = <span class="hljs-built_in">new</span> SearchSourceBuilder();<br>        RangeQueryBuilder rangeQuery = QueryBuilders.rangeQuery(&quot;age&quot;);<br><br>        rangeQuery.gte(<span class="hljs-number">20</span>);<br>        rangeQuery.lt(<span class="hljs-number">24</span>);<br><br>        builder.query(rangeQuery);<br><br>        request.source(builder);<br><br>        SearchResponse response = esClient.<span class="hljs-keyword">search</span>(request, RequestOptions.<span class="hljs-keyword">DEFAULT</span>);<br><br>        SearchHits hits = response.getHits();<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(hits.getHits());<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(response.getTook());<br>        <span class="hljs-keyword">for</span> (SearchHit hit : hits) &#123;<br>            <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(hit.getSourceAsString());<br>        &#125;<br><br>        esClient.<span class="hljs-keyword">close</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="高亮查询"><a href="#高亮查询" class="headerlink" title="高亮查询"></a>高亮查询</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"> <span class="hljs-keyword">import</span> org.apache.http.HttpHost;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">get</span>.GetRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">get</span>.GetResponse;<br> <span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">search</span>.SearchRequest;<br> <span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">search</span>.SearchResponse;<br> <span class="hljs-keyword">import</span> org.elasticsearch.client.RequestOptions;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestClient;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestHighLevelClient;<br> <span class="hljs-keyword">import</span> org.elasticsearch.common.unit.Fuzziness;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">index</span>.query.BoolQueryBuilder;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">index</span>.query.QueryBuilders;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">index</span>.query.RangeQueryBuilder;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">index</span>.query.TermQueryBuilder;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.SearchHit;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.SearchHits;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.builder.SearchSourceBuilder;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.<span class="hljs-keyword">fetch</span>.subphase.highlight.HighlightBuilder;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.sort.SortOrder;<br><br> <span class="hljs-keyword">import</span> javax.swing.text.Highlighter;<br> <span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> ESTest_Doc_Query &#123;<br>    <span class="hljs-built_in">public</span> static <span class="hljs-type">void</span> main(String[] args) throws IOException &#123;<br>        RestHighLevelClient esClient = <span class="hljs-built_in">new</span> RestHighLevelClient(<br>                RestClient.builder(<span class="hljs-built_in">new</span> HttpHost(&quot;localhost&quot;, <span class="hljs-number">9200</span>, &quot;http&quot;))<br>        );<br><br>        // <span class="hljs-number">9.</span>高亮查询<br>        SearchRequest request = <span class="hljs-built_in">new</span> SearchRequest();<br>        request.indices(&quot;user&quot;);<br><br>        SearchSourceBuilder builder = <span class="hljs-built_in">new</span> SearchSourceBuilder();<br>        TermQueryBuilder termQueryBuilder =<br>                QueryBuilders.termQuery(&quot;name&quot;, &quot;zhangsan&quot;);<br><br>        HighlightBuilder highlightBuilder = <span class="hljs-built_in">new</span> HighlightBuilder();<br>        highlightBuilder.preTags(&quot;&lt;font color=&#x27;red&#x27;&gt;&quot;);<br>        highlightBuilder.postTags(&quot;&lt;font&gt;&quot;);<br>        highlightBuilder.field(&quot;name&quot;);<br><br>        builder.highlighter(highlightBuilder);<br>        builder.query(termQueryBuilder);<br><br>        request.source(builder);<br><br>        SearchResponse response = esClient.<span class="hljs-keyword">search</span>(request, RequestOptions.<span class="hljs-keyword">DEFAULT</span>);<br><br>        SearchHits hits = response.getHits();<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(hits.getHits());<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(response.getTook());<br>        <span class="hljs-keyword">for</span> (SearchHit hit : hits) &#123;<br>            <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(hit.getSourceAsString());<br>        &#125;<br><br>        esClient.<span class="hljs-keyword">close</span>();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="聚合查询-1"><a href="#聚合查询-1" class="headerlink" title="聚合查询"></a>聚合查询</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">import</span> org.apache.http.HttpHost;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">get</span>.GetRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">get</span>.GetResponse;<br> <span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">search</span>.SearchRequest;<br> <span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">search</span>.SearchResponse;<br> <span class="hljs-keyword">import</span> org.elasticsearch.client.RequestOptions;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestClient;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestHighLevelClient;<br> <span class="hljs-keyword">import</span> org.elasticsearch.common.unit.Fuzziness;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">index</span>.query.BoolQueryBuilder;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">index</span>.query.QueryBuilders;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">index</span>.query.RangeQueryBuilder;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">index</span>.query.TermQueryBuilder;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.SearchHit;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.SearchHits;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.aggregations.AggregationBuilder;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.aggregations.AggregationBuilders;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.builder.SearchSourceBuilder;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.<span class="hljs-keyword">fetch</span>.subphase.highlight.HighlightBuilder;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.sort.SortOrder;<br><br> <span class="hljs-keyword">import</span> javax.swing.text.Highlighter;<br> <span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> ESTest_Doc_Query &#123;<br>    <span class="hljs-built_in">public</span> static <span class="hljs-type">void</span> main(String[] args) throws IOException &#123;<br>        RestHighLevelClient esClient = <span class="hljs-built_in">new</span> RestHighLevelClient(<br>                RestClient.builder(<span class="hljs-built_in">new</span> HttpHost(&quot;localhost&quot;, <span class="hljs-number">9200</span>, &quot;http&quot;))<br>        );<br><br>        // <span class="hljs-number">10.</span>聚合查询<br>        SearchRequest request = <span class="hljs-built_in">new</span> SearchRequest();<br>        request.indices(&quot;user&quot;);<br><br>        SearchSourceBuilder builder = <span class="hljs-built_in">new</span> SearchSourceBuilder();<br>        AggregationBuilder aggregationBuilder = AggregationBuilders.max(&quot;maxAge&quot;).field(&quot;age&quot;);<br>        builder.aggregation(aggregationBuilder);<br><br>        request.source(builder);<br><br>        SearchResponse response = esClient.<span class="hljs-keyword">search</span>(request, RequestOptions.<span class="hljs-keyword">DEFAULT</span>);<br><br>        SearchHits hits = response.getHits();<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(hits.getHits());<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(response.getTook());<br>        <span class="hljs-keyword">for</span> (SearchHit hit : hits) &#123;<br>            <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(hit.getSourceAsString());<br>        &#125;<br><br>        esClient.<span class="hljs-keyword">close</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="分组查询"><a href="#分组查询" class="headerlink" title="分组查询"></a>分组查询</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">import</span> org.apache.http.HttpHost;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">get</span>.GetRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">get</span>.GetResponse;<br> <span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">search</span>.SearchRequest;<br> <span class="hljs-keyword">import</span> org.elasticsearch.action.<span class="hljs-keyword">search</span>.SearchResponse;<br> <span class="hljs-keyword">import</span> org.elasticsearch.client.RequestOptions;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestClient;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestHighLevelClient;<br> <span class="hljs-keyword">import</span> org.elasticsearch.common.unit.Fuzziness;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">index</span>.query.BoolQueryBuilder;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">index</span>.query.QueryBuilders;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">index</span>.query.RangeQueryBuilder;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">index</span>.query.TermQueryBuilder;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.SearchHit;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.SearchHits;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.aggregations.AggregationBuilder;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.aggregations.AggregationBuilders;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.builder.SearchSourceBuilder;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.<span class="hljs-keyword">fetch</span>.subphase.highlight.HighlightBuilder;<br> <span class="hljs-keyword">import</span> org.elasticsearch.<span class="hljs-keyword">search</span>.sort.SortOrder;<br><br> <span class="hljs-keyword">import</span> javax.swing.text.Highlighter;<br> <span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> ESTest_Doc_Query &#123;<br>    <span class="hljs-built_in">public</span> static <span class="hljs-type">void</span> main(String[] args) throws IOException &#123;<br>        RestHighLevelClient esClient = <span class="hljs-built_in">new</span> RestHighLevelClient(<br>                RestClient.builder(<span class="hljs-built_in">new</span> HttpHost(&quot;localhost&quot;, <span class="hljs-number">9200</span>, &quot;http&quot;))<br>        );<br><br>        // <span class="hljs-number">11.</span>分组查询<br>        SearchRequest request = <span class="hljs-built_in">new</span> SearchRequest();<br>        request.indices(&quot;user&quot;);<br><br>        SearchSourceBuilder builder = <span class="hljs-built_in">new</span> SearchSourceBuilder();<br>        AggregationBuilder aggregationBuilder = AggregationBuilders.terms(&quot;ageGroup&quot;).field(&quot;age&quot;);<br>        builder.aggregation(aggregationBuilder);<br><br>        request.source(builder);<br><br>        SearchResponse response = esClient.<span class="hljs-keyword">search</span>(request, RequestOptions.<span class="hljs-keyword">DEFAULT</span>);<br><br>        SearchHits hits = response.getHits();<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(hits.getHits());<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(response.getTook());<br>        <span class="hljs-keyword">for</span> (SearchHit hit : hits) &#123;<br>            <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(hit.getSourceAsString());<br>        &#125;<br><br>        esClient.<span class="hljs-keyword">close</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="windows-搭建集群"><a href="#windows-搭建集群" class="headerlink" title="windows 搭建集群"></a>windows 搭建集群</h2><p><img src="/assets/490f8d7ce5cc45a883e0984c04f801ad.png"><br>node-1001&#x2F;config&#x2F;elasticsearch.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># ======================== Elasticsearch Configuration =========================</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> Elasticsearch comes with reasonable defaults for most settings.</span><br><span class="hljs-comment">#       Before you set out to tweak and tune the configuration, make sure you</span><br><span class="hljs-comment">#       understand what are you trying to accomplish and the consequences.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># The primary way of configuring a node is via this file. This template lists</span><br><span class="hljs-comment"># the most important settings you may want to configure for a production cluster.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Please consult the documentation for further information on configuration options:</span><br><span class="hljs-comment"># https://www.elastic.co/guide/en/elasticsearch/reference/index.html</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># ---------------------------------- Cluster -----------------------------------</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Use a descriptive name for your cluster:</span><br><span class="hljs-comment">#</span><br><span class="hljs-attr">cluster.name:</span> <span class="hljs-string">my-application</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># ------------------------------------ Node ------------------------------------</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Use a descriptive name for the node:</span><br><span class="hljs-comment">#</span><br><span class="hljs-attr">node.name:</span> <span class="hljs-string">node-1001</span><br><span class="hljs-attr">node.master:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">node.data:</span> <span class="hljs-literal">true</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Add custom attributes to the node:</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#node.attr.rack: r1</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># ----------------------------------- Paths ------------------------------------</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Path to directory where to store the data (separate multiple locations by comma):</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#path.data: /path/to/data</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Path to log files:</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#path.logs: /path/to/logs</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># ----------------------------------- Memory -----------------------------------</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Lock the memory on startup:</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#bootstrap.memory_lock: true</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Make sure that the heap size is set to about half the memory available</span><br><span class="hljs-comment"># on the system and that the owner of the process is allowed to use this</span><br><span class="hljs-comment"># limit.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Elasticsearch performs poorly when the system is swapping the memory.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># ---------------------------------- Network -----------------------------------</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Set the bind address to a specific IP (IPv4 or IPv6):</span><br><span class="hljs-comment">#</span><br><span class="hljs-attr">network.host:</span> <span class="hljs-string">localhost</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Set a custom port for HTTP:</span><br><span class="hljs-comment">#</span><br><span class="hljs-attr">http.port:</span> <span class="hljs-number">1001</span><br><span class="hljs-attr">transport.tcp.port:</span> <span class="hljs-number">9301</span><br><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># For more information, consult the network module documentation.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># --------------------------------- Discovery ----------------------------------</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Pass an initial list of hosts to perform discovery when this node is started:</span><br><span class="hljs-comment"># The default list of hosts is [&quot;127.0.0.1&quot;, &quot;[::1]&quot;]</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#discovery.seed_hosts: [&quot;host1&quot;, &quot;host2&quot;]</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Bootstrap the cluster using an initial set of master-eligible nodes:</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#cluster.initial_master_nodes: [&quot;node-1&quot;, &quot;node-2&quot;]</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># For more information, consult the discovery and cluster formation module documentation.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># ---------------------------------- Gateway -----------------------------------</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Block initial recovery after a full cluster restart until N nodes are started:</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#gateway.recover_after_nodes: 3</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># For more information, consult the gateway module documentation.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># ---------------------------------- Various -----------------------------------</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Require explicit names when deleting indices:</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#action.destructive_requires_name: true</span><br><span class="hljs-attr">http.cors.enabled:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">http.cors.allow-origin:</span> <span class="hljs-string">&quot;*&quot;</span><br><br><br></code></pre></td></tr></table></figure><p>node-1002&#x2F;config&#x2F;elasticsearch.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># ======================== Elasticsearch Configuration =========================</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> Elasticsearch comes with reasonable defaults for most settings.</span><br><span class="hljs-comment">#       Before you set out to tweak and tune the configuration, make sure you</span><br><span class="hljs-comment">#       understand what are you trying to accomplish and the consequences.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># The primary way of configuring a node is via this file. This template lists</span><br><span class="hljs-comment"># the most important settings you may want to configure for a production cluster.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Please consult the documentation for further information on configuration options:</span><br><span class="hljs-comment"># https://www.elastic.co/guide/en/elasticsearch/reference/index.html</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># ---------------------------------- Cluster -----------------------------------</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Use a descriptive name for your cluster:</span><br><span class="hljs-comment">#</span><br><span class="hljs-attr">cluster.name:</span> <span class="hljs-string">my-application</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># ------------------------------------ Node ------------------------------------</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Use a descriptive name for the node:</span><br><span class="hljs-comment">#</span><br><span class="hljs-attr">node.name:</span> <span class="hljs-string">node-1002</span><br><span class="hljs-attr">node.master:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">node.data:</span> <span class="hljs-literal">true</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Add custom attributes to the node:</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#node.attr.rack: r1</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># ----------------------------------- Paths ------------------------------------</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Path to directory where to store the data (separate multiple locations by comma):</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#path.data: /path/to/data</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Path to log files:</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#path.logs: /path/to/logs</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># ----------------------------------- Memory -----------------------------------</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Lock the memory on startup:</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#bootstrap.memory_lock: true</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Make sure that the heap size is set to about half the memory available</span><br><span class="hljs-comment"># on the system and that the owner of the process is allowed to use this</span><br><span class="hljs-comment"># limit.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Elasticsearch performs poorly when the system is swapping the memory.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># ---------------------------------- Network -----------------------------------</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Set the bind address to a specific IP (IPv4 or IPv6):</span><br><span class="hljs-comment">#</span><br><span class="hljs-attr">network.host:</span> <span class="hljs-string">localhost</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Set a custom port for HTTP:</span><br><span class="hljs-comment">#</span><br><span class="hljs-attr">http.port:</span> <span class="hljs-number">1002</span><br><span class="hljs-attr">transport.tcp.port:</span> <span class="hljs-number">9302</span><br><br><span class="hljs-attr">discovery.seed_hosts:</span> [<span class="hljs-string">&quot;localhost:9301&quot;</span>]<br><span class="hljs-attr">discovery.zen.fd.ping_timeout:</span> <span class="hljs-string">1m</span><br><span class="hljs-attr">discovery.zen.fd.ping_retries:</span> <span class="hljs-number">5</span><br><br><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># For more information, consult the network module documentation.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># --------------------------------- Discovery ----------------------------------</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Pass an initial list of hosts to perform discovery when this node is started:</span><br><span class="hljs-comment"># The default list of hosts is [&quot;127.0.0.1&quot;, &quot;[::1]&quot;]</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#discovery.seed_hosts: [&quot;host1&quot;, &quot;host2&quot;]</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Bootstrap the cluster using an initial set of master-eligible nodes:</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#cluster.initial_master_nodes: [&quot;node-1&quot;, &quot;node-2&quot;]</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># For more information, consult the discovery and cluster formation module documentation.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># ---------------------------------- Gateway -----------------------------------</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Block initial recovery after a full cluster restart until N nodes are started:</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#gateway.recover_after_nodes: 3</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># For more information, consult the gateway module documentation.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># ---------------------------------- Various -----------------------------------</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Require explicit names when deleting indices:</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#action.destructive_requires_name: true</span><br><span class="hljs-attr">http.cors.enabled:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">http.cors.allow-origin:</span> <span class="hljs-string">&quot;*&quot;</span><br><br><br></code></pre></td></tr></table></figure><p>node-1003&#x2F;config&#x2F;elasticsearch.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># ======================== Elasticsearch Configuration =========================</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> Elasticsearch comes with reasonable defaults for most settings.</span><br><span class="hljs-comment">#       Before you set out to tweak and tune the configuration, make sure you</span><br><span class="hljs-comment">#       understand what are you trying to accomplish and the consequences.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># The primary way of configuring a node is via this file. This template lists</span><br><span class="hljs-comment"># the most important settings you may want to configure for a production cluster.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Please consult the documentation for further information on configuration options:</span><br><span class="hljs-comment"># https://www.elastic.co/guide/en/elasticsearch/reference/index.html</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># ---------------------------------- Cluster -----------------------------------</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Use a descriptive name for your cluster:</span><br><span class="hljs-comment">#</span><br><span class="hljs-attr">cluster.name:</span> <span class="hljs-string">my-application</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># ------------------------------------ Node ------------------------------------</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Use a descriptive name for the node:</span><br><span class="hljs-comment">#</span><br><span class="hljs-attr">node.name:</span> <span class="hljs-string">node-1003</span><br><span class="hljs-attr">node.master:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">node.data:</span> <span class="hljs-literal">true</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Add custom attributes to the node:</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#node.attr.rack: r1</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># ----------------------------------- Paths ------------------------------------</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Path to directory where to store the data (separate multiple locations by comma):</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#path.data: /path/to/data</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Path to log files:</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#path.logs: /path/to/logs</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># ----------------------------------- Memory -----------------------------------</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Lock the memory on startup:</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#bootstrap.memory_lock: true</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Make sure that the heap size is set to about half the memory available</span><br><span class="hljs-comment"># on the system and that the owner of the process is allowed to use this</span><br><span class="hljs-comment"># limit.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Elasticsearch performs poorly when the system is swapping the memory.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># ---------------------------------- Network -----------------------------------</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Set the bind address to a specific IP (IPv4 or IPv6):</span><br><span class="hljs-comment">#</span><br><span class="hljs-attr">network.host:</span> <span class="hljs-string">localhost</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Set a custom port for HTTP:</span><br><span class="hljs-comment">#</span><br><span class="hljs-attr">http.port:</span> <span class="hljs-number">1003</span><br><span class="hljs-attr">transport.tcp.port:</span> <span class="hljs-number">9303</span><br><br><span class="hljs-attr">discovery.seed_hosts:</span> [<span class="hljs-string">&quot;localhost:9301&quot;</span>, <span class="hljs-string">&quot;localhost:9302&quot;</span>]<br><span class="hljs-attr">discovery.zen.fd.ping_timeout:</span> <span class="hljs-string">1m</span><br><span class="hljs-attr">discovery.zen.fd.ping_retries:</span> <span class="hljs-number">5</span><br><br><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># For more information, consult the network module documentation.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># --------------------------------- Discovery ----------------------------------</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Pass an initial list of hosts to perform discovery when this node is started:</span><br><span class="hljs-comment"># The default list of hosts is [&quot;127.0.0.1&quot;, &quot;[::1]&quot;]</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#discovery.seed_hosts: [&quot;host1&quot;, &quot;host2&quot;]</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Bootstrap the cluster using an initial set of master-eligible nodes:</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#cluster.initial_master_nodes: [&quot;node-1&quot;, &quot;node-2&quot;]</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># For more information, consult the discovery and cluster formation module documentation.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># ---------------------------------- Gateway -----------------------------------</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Block initial recovery after a full cluster restart until N nodes are started:</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#gateway.recover_after_nodes: 3</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># For more information, consult the gateway module documentation.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># ---------------------------------- Various -----------------------------------</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Require explicit names when deleting indices:</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#action.destructive_requires_name: true</span><br><span class="hljs-attr">http.cors.enabled:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">http.cors.allow-origin:</span> <span class="hljs-string">&quot;*&quot;</span><br><br><br></code></pre></td></tr></table></figure><h2 id="linux-单点部署"><a href="#linux-单点部署" class="headerlink" title="linux 单点部署"></a>linux 单点部署</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xiamu ~]<span class="hljs-comment"># cd /opt/es/</span><br>[root@xiamu es]<span class="hljs-comment"># ls</span><br>elasticsearch-7.8.0-linux-x86_64.tar.gz<br><span class="hljs-comment"># 上传es压缩包</span><br><br><span class="hljs-comment"># 解压es</span><br>[root@xiamu es]<span class="hljs-comment"># tar -zxvf elasticsearch-7.8.0-linux-x86_64.tar.gz</span><br><br><span class="hljs-comment"># 因为安全问题，Elasticsearch 不允许 root 用户直接运行，所以要创建新用户，在 root 用</span><br>户中创建新用户<br><span class="hljs-comment"># 新增 es 用户</span><br>[root@xiamu es]<span class="hljs-comment"># useradd es</span><br><span class="hljs-comment"># 为 es 用户设置密码</span><br>[root@xiamu es]<span class="hljs-comment"># passwd es</span><br><span class="hljs-comment"># 设置文件所有者</span><br>[root@xiamu es]<span class="hljs-comment"># chown -R es:es /opt/es/</span><br><br>userdel -r es <span class="hljs-comment">#如果错了，可以删除再加</span><br><br>修改/opt/module/es/config/elasticsearch.yml 文件<br><span class="hljs-comment"># 加入如下配置</span><br>cluster.name: elasticsearch<br>node.name: node-1<br>network.host: 0.0.0.0<br>http.port: 9200<br>cluster.initial_master_nodes: [<span class="hljs-string">&quot;node-1&quot;</span>]<br><br>[root@xiamu es]<span class="hljs-comment"># cd ./elasticsearch-7.8.0/</span><br>[root@xiamu elasticsearch-7.8.0]<span class="hljs-comment"># vim ./config/elasticsearch.yml</span><br><span class="hljs-comment"># 文件末尾加入如下配置</span><br>cluster.name: elasticsearch<br>node.name: node-1<br>network.host: 0.0.0.0<br>http.port: 9200<br>cluster.initial_master_nodes: [<span class="hljs-string">&quot;node-1&quot;</span>]<br><br>[root@xiamu elasticsearch-7.8.0]<span class="hljs-comment"># vim /etc/security/limits.conf</span><br><span class="hljs-comment"># 在文件末尾中增加下面内容</span><br><span class="hljs-comment"># 每个进程可以打开的文件数的限制</span><br>es soft nofile 65536<br>es hard nofile 65536<br><br>[root@xiamu elasticsearch-7.8.0]<span class="hljs-comment"># vim /etc/security/limits.d/20-nproc.conf</span><br><span class="hljs-comment"># 在文件末尾中增加下面内容</span><br><span class="hljs-comment"># 每个进程可以打开的文件数的限制</span><br>es soft nofile 65536<br>es hard nofile 65536<br><br><span class="hljs-comment"># 操作系统级别对每个用户创建的进程数的限制</span><br>* hard <span class="hljs-built_in">nproc</span> 4096<br><span class="hljs-comment"># 注：* 带表 Linux 所有用户名称</span><br><br>[root@xiamu elasticsearch-7.8.0]<span class="hljs-comment"># vim /etc/sysctl.conf</span><br><span class="hljs-comment"># 在文件中增加下面内容</span><br><span class="hljs-comment"># 一个进程可以拥有的 VMA(虚拟内存区域)的数量,默认值为 65536</span><br>vm.max_map_count=655360<br><br><span class="hljs-comment"># 重新加载</span><br>[root@xiamu elasticsearch-7.8.0]<span class="hljs-comment"># sysctl -p</span><br><br><span class="hljs-comment"># 切换用户</span><br>[root@xiamu ~]<span class="hljs-comment"># su es</span><br>[es@xiamu root]$ <span class="hljs-built_in">cd</span> /opt/es/elasticsearch-7.8.0<br><br><br></code></pre></td></tr></table></figure><h2 id="linux-集群部署"><a href="#linux-集群部署" class="headerlink" title="linux 集群部署"></a>linux 集群部署</h2><p>待更新…</p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>ElasticSearch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>VueElementUI</title>
    <link href="/Vue/VueElementUI/"/>
    <url>/Vue/VueElementUI/</url>
    
    <content type="html"><![CDATA[<h2 id="表单中存在输入框回车提交表单"><a href="#表单中存在输入框回车提交表单" class="headerlink" title="表单中存在输入框回车提交表单"></a>表单中存在输入框回车提交表单</h2><p>只需要在 el-form 中加上@keyup.enter.native&#x3D;”submit()”就行了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;el-form ref=&quot;form&quot; label-width=&quot;80px&quot; @keyup.enter.native=&quot;submit()&quot;&gt;<br>  &lt;el-form-item label=&quot;姓名&quot;&gt;&lt;/el-form-item&gt;<br>  &lt;el-form-item label=&quot;学号&quot;&gt;&lt;/el-form-item&gt;<br>  &lt;el-form-item label=&quot;性别&quot;&gt;&lt;/el-form-item&gt;<br>&lt;/el-form&gt;<br></code></pre></td></tr></table></figure><p>label-width&#x3D;”80px” 表单域标签的宽度，作为 Form 直接子元素的 form-item 会继承该值</p><h2 id="表单的自动填充"><a href="#表单的自动填充" class="headerlink" title="表单的自动填充"></a>表单的自动填充</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;!-- autocomplete 属性规定表单是否应该启用自动填充功能 --&gt;<br>&lt;el-input autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;<br></code></pre></td></tr></table></figure><h2 id=""><a href="#" class="headerlink" title=""></a><template scope="scope"></h2><p>通过 template 标签中的 scope 获取当前行的值, 并且也可以传递给函数调用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;el-table-column type=&quot;&quot; label=&quot;序号&quot; width=&quot;200&quot;&gt;<br>  &lt;template scope=&quot;scope&quot;&gt;<br>    &#123;&#123; (current - 1) * limit + scope.$index + 1 &#125;&#125;<br>  &lt;/template&gt;<br>&lt;/el-table-column&gt;<br>&lt;el-table-column label=&quot;操作&quot; align=&quot;center&quot; prop=&quot;id&quot;&gt;<br>  &lt;template scope=&quot;prop&quot;&gt;<br>    &lt;el-button<br>      type=&quot;primary&quot;<br>      icon=&quot;el-icon-edit&quot;<br>      size=&quot;mini&quot;<br>      @click=&quot;edit(prop.row.id)&quot;<br>    &gt;&lt;/el-button&gt;<br>    &lt;el-button<br>      type=&quot;danger&quot;<br>      icon=&quot;el-icon-delete&quot;<br>      size=&quot;mini&quot;<br>      @click=&quot;deleteById(prop.row.id)&quot;<br>    &gt;&lt;/el-button&gt;<br>  &lt;/template&gt;<br>&lt;/el-table-column&gt;<br></code></pre></td></tr></table></figure><h2 id="icon-的使用"><a href="#icon-的使用" class="headerlink" title="icon 的使用"></a>icon 的使用</h2><p>可以在组件中使用 class 属性, 或者直接在组件使用 icon 属性</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;el-button type=&quot;primary&quot; icon=&quot;el-icon-edit&quot; size=&quot;mini&quot;&gt;&lt;/el-button&gt;<br>&lt;el-button type=&quot;danger&quot; class=&quot;el-icon-delete&quot; size=&quot;mini&quot;&gt;&lt;/el-button&gt;<br></code></pre></td></tr></table></figure><p>效果图:<br><img src="/assets/3e7e74fe974646c5ac1dfb9e506a50d8.png"></p><h2 id="nextTick"><a href="#nextTick" class="headerlink" title="nextTick"></a>nextTick</h2><p>把回调推迟到页面的 DOM 渲染完成之后再执行</p><blockquote><p>Vue.nextTick( [callback, context] )<br>{Function} [callback] {Object} [context]<br>Defer the callback to be executed after the next DOM update cycle. Use it immediately after you’ve changed some data to wait for the DOM update.</p></blockquote><p>当前页面并没有显示 dialog<br><img src="/assets/f841cfeafa814baead38f07c7f7ee09b.png"><br>点击添加按钮, 显示 dialog, 但是用户名没有光标自定放在上面的效果<br><img src="/assets/8cfd6368b4f74c428e52c49d151761d2.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;el-dialog title=&quot;添加/修改&quot; :visible.sync=&quot;dialogFormVisible&quot;&gt;<br>  &lt;el-form label-width=&quot;80px&quot; @keyup.enter.native=&quot;saveOrUpdateUser&quot;&gt;<br>    &lt;el-form-item label=&quot;用户名&quot;&gt;<br>      &lt;el-input v-model=&quot;userObj.username&quot; ref=&quot;inputFirst&quot;&gt;&lt;/el-input&gt;<br>  &lt;/el-form&gt;<br>&lt;/el-dialog&gt;<br><br>addUser() &#123; this.userObj = &#123;&#125;; this.dialogFormVisible = true; //<br>当弹窗在页面渲染完成之后, 才会执行这里面的函数 this.$nextTick(() =&gt; &#123;<br>this.$refs.inputFirst.focus(); &#125;); &#125;,<br></code></pre></td></tr></table></figure><p><img src="/assets/a0a64a08b55742c0ae4e3259c20eb5f7.png"></p>]]></content>
    
    
    <categories>
      
      <category>Vue</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>计算机组成原理</title>
    <link href="/uncategorized/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/"/>
    <url>/uncategorized/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h2 id="画图题"><a href="#画图题" class="headerlink" title="画图题"></a>画图题</h2><ul><li>系统程序区是 ROM, 用户程序区是 RAM</li><li>ROM 是只读的</li><li>同时满足自扩展和位拓展的条件下, 需要<strong>选择位拓展</strong></li><li>ROM 是内存 RAM 是外存</li></ul><p>2 片 4K × 4 位 ROM<br>3 片 4K × 8 位 RAM<br><img src="/assets/9e126a6f5c8a4506a091526a03734df4.png"><br>数据线体现了位扩展</p><p>G1 是高电平, 高电平就是 1<br><img src="/assets/5e1551043af44f31ba0ac0f72f631514.png"></p><p><img src="/assets/1c8b7fe80b0b4ecca62273bb86c2b54f.png"><br><img src="/assets/d3f49d0f29b44b5abc315cba988e430d.png">是低电平有效<br><img src="/assets/7acd82e1754144789c8632db5e8b81c0.png">也是低电平有效</p><p><img src="/assets/96ffbb050ed147eda0a40b1dd69140e7.png"></p><h2 id="海明码"><a href="#海明码" class="headerlink" title="海明码"></a>海明码</h2><blockquote><p><img src="/assets/22e8c77b6eec4b0b80f079ef678a9ecb.png"></p></blockquote><p>配偶不用取反, 配奇需要取反</p><p><img src="/assets/d43f05384f41489f9ab963d566eb4cc9.png"></p><table><thead><tr><th>C1</th><th>1</th><th>3</th><th>5</th><th>7</th></tr></thead><tbody><tr><td>C2</td><td>2</td><td>3</td><td>5</td><td>6</td></tr><tr><td>C4</td><td>4</td><td>5</td><td>6</td><td>7</td></tr><tr><td>C8</td><td>8</td><td>9</td><td>10</td><td>11</td></tr></tbody></table><p>计算 k 的公式<br><img src="/assets/95650ebee9a14828b600feb312f15711.png"></p><h2 id="数据线和地址线"><a href="#数据线和地址线" class="headerlink" title="数据线和地址线"></a>数据线和地址线</h2><p>数据线是双向的<br>地址线是单向的<br>地址线 10 根, 数据线 4 根 &#x3D;&gt; 芯片容量 210×4&#x3D;4K 位<br>地址线 14 根, 数据线 1 根 &#x3D;&gt; 芯片容量 214×1&#x3D;16K 位<br>210 &#x3D; 1K<br>220 &#x3D; 1M</p><h2 id="考试范围"><a href="#考试范围" class="headerlink" title="考试范围"></a>考试范围</h2><p><img src="/assets/1fa1de9681b2424fa0e50831152812fa.png"></p><h2 id="练习题"><a href="#练习题" class="headerlink" title="练习题"></a>练习题</h2><p><img src="/assets/78cd263c9e474424aab1a1dcbf6db3c7.png"></p><p><img src="/assets/ab368e810f974cfe904e0cd2b32b691f.png"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Vue-CLI</title>
    <link href="/Vue/Vue-CLI/"/>
    <url>/Vue/Vue-CLI/</url>
    
    <content type="html"><![CDATA[<h2 id="创建脚手架"><a href="#创建脚手架" class="headerlink" title="创建脚手架"></a>创建脚手架</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1.</span> 如出现下载缓慢请配置 npm 淘宝镜像：<br>npm config <span class="hljs-keyword">set</span> registry https:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>registry.npm.taobao.org<br></code></pre></td></tr></table></figure><p>脚手架官网<a href="https://cli.vuejs.org/zh/">https://cli.vuejs.org/zh/</a><br>具体步骤:<br>第一步（仅第一次执行）：全局安装@vue&#x2F;cli。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">npm install <span class="hljs-operator">-</span>g <span class="hljs-variable">@vue</span><span class="hljs-operator">/</span>cli<br></code></pre></td></tr></table></figure><p>第二步：切换到你要创建项目的目录，然后使用命令创建项目</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">vue <span class="hljs-keyword">create</span> xxxx<br></code></pre></td></tr></table></figure><p>第三步：启动项目</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">npm run serve<br></code></pre></td></tr></table></figure><p><img src="/assets/3481e7309dc74c20b2f78f9c13f98510.png"><br>访问<a href="http://localhost:8080/">http://localhost:8080/</a>, 可以看见脚手架为我们默认创建一个 HelloWorld 组件<br><img src="/assets/bd415fdb8ca141fc9416ebf92ccda57d.png"></p><p>脚手架文件结构</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs javascript">├── node_modules<br>├── public<br>│   ├── favicon.<span class="hljs-property">ico</span>: 页签图标<br>│   └── index.<span class="hljs-property">html</span>: 主页面<br>├── src<br>│   ├── <span class="hljs-attr">assets</span>: 存放静态资源<br>│   │   └── logo.<span class="hljs-property">png</span><br>│   │── <span class="hljs-attr">component</span>: 存放组件<br>│   │   └── <span class="hljs-title class_">HelloWorld</span>.<span class="hljs-property">vue</span><br>│   │── <span class="hljs-title class_">App</span>.<span class="hljs-property">vue</span>: 汇总所有组件<br>│   │── main.<span class="hljs-property">js</span>: 入口文件<br>├── .<span class="hljs-property">gitignore</span>: git版本管制忽略的配置<br>├── babel.<span class="hljs-property">config</span>.<span class="hljs-property">js</span>: babel的配置文件<br>├── package.<span class="hljs-property">json</span>: 应用包配置文件<br>├── <span class="hljs-variable constant_">README</span>.<span class="hljs-property">md</span>: 应用描述文件<br>├── package-lock.<span class="hljs-property">json</span>：包版本控制文件<br></code></pre></td></tr></table></figure><h2 id="脚手架运行项目的报错"><a href="#脚手架运行项目的报错" class="headerlink" title="脚手架运行项目的报错"></a>脚手架运行项目的报错</h2><p>xxx should always be multi-word vue&#x2F;multi-word-component-names 报错<br>修改 vue.config.js 文件</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> &#123; defineConfig &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@vue/cli-service&quot;</span>);<br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title function_">defineConfig</span>(&#123;<br>  <span class="hljs-attr">transpileDependencies</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-attr">lintOnSave</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 关闭语法检查</span><br>&#125;);<br></code></pre></td></tr></table></figure><p>如果编写了代码, 左侧行数会出现一个红色小箭头, 这是 git 在记录<br><img src="/assets/6743596ad9d14a94b8be1b92dfaa9925.png"><br><img src="/assets/7e6ec43174be4f369821564775b7a3e6.png"><br>可以按 Ctrl+, 打开设置, 搜索 git:Enabled, 关闭 Git<br><img src="/assets/f5be5f33f68b4fad8dea0e5ae41865d0.png"></p><h2 id="部署自己的项目到脚手架"><a href="#部署自己的项目到脚手架" class="headerlink" title="部署自己的项目到脚手架"></a>部署自己的项目到脚手架</h2><p><img src="/assets/a7a83aad1f7944148a539b36e9c9ad5b.png"><br>School.vue</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div&gt;<br>       <br>    &lt;h2&gt;学校名称: &#123;&#123; name &#125;&#125;&lt;/h2&gt;<br>       <br>    &lt;h2&gt;学校地址: &#123;&#123; address &#125;&#125;&lt;/h2&gt;<br>        &lt;button @click=&quot;showName&quot;&gt;点我显示名称&lt;/button&gt;  <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>export default &#123;<br>  name: &quot;School&quot;,<br>  data() &#123;<br>    return &#123;<br>      name: &quot;尚硅谷&quot;,<br>      address: &quot;北京&quot;,<br>    &#125;;<br>  &#125;,<br>  methods: &#123;<br>    showName() &#123;<br>      alert(this.name);<br>    &#125;,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style&gt;&lt;/style&gt;<br></code></pre></td></tr></table></figure><p>Student.vue</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div&gt;<br>       <br>    &lt;h2&gt;学生姓名: &#123;&#123; name &#125;&#125;&lt;/h2&gt;<br>       <br>    &lt;h2&gt;学生年龄: &#123;&#123; age &#125;&#125;&lt;/h2&gt;<br>     <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>export default &#123;<br>  name: &quot;Student&quot;,<br>  data() &#123;<br>    return &#123;<br>      name: &quot;肉豆蔻&quot;,<br>      age: 18,<br>    &#125;;<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style&gt;&lt;/style&gt;<br></code></pre></td></tr></table></figure><p>App.vue</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div&gt;    &lt;School&gt;&lt;/School&gt;     &lt;Student&gt;&lt;/Student&gt;  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import Student from &quot;./components/Student.vue&quot;;<br>import School from &quot;./components/School.vue&quot;;<br><br>export default &#123;<br>  name: &quot;App&quot;,<br>  components: &#123;<br>    Student,<br>    School,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style&gt;&lt;/style&gt;<br></code></pre></td></tr></table></figure><p>main.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">/* </span><br><span class="hljs-comment">该文件是整个项目的入口文件</span><br><span class="hljs-comment">*/</span><br><span class="hljs-comment">//引入Vue</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-comment">//引入App组件, 它是所有组件的父组件</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./App.vue&quot;</span>;<br><br><span class="hljs-comment">//关闭Vue的生产提示</span><br><span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;<br><br><span class="hljs-comment">/* </span><br><span class="hljs-comment">关于不同版本的Vue：</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">1.vue.js与vue.runtime.xxx.js的区别：</span><br><span class="hljs-comment">(1).vue.js是完整版的Vue，包含：核心功能+模板解析器。</span><br><span class="hljs-comment">(2).vue.runtime.xxx.js是运行版的Vue，只包含：核心功能；没有模板解析器。</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">2.因为vue.runtime.xxx.js没有模板解析器，所以不能使用template配置项，需要使用</span><br><span class="hljs-comment">render函数接收到的createElement函数去指定具体内容。</span><br><span class="hljs-comment">*/</span><br><br><span class="hljs-comment">//创建vm</span><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br>  <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#app&quot;</span>,<br>  <span class="hljs-comment">//</span><br>  <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">h</span>) =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>),<br><br>  <span class="hljs-comment">// render(createElement) &#123;</span><br>  <span class="hljs-comment">//   return createElement(&#x27;h1&#x27;, &#x27;你好啊&#x27;)</span><br>  <span class="hljs-comment">// &#125;</span><br><br>  <span class="hljs-comment">// template: `</span><br>  <span class="hljs-comment">// &lt;h1&gt;你好啊&lt;/h1&gt;</span><br>  <span class="hljs-comment">// `,</span><br>  <span class="hljs-comment">// components: &#123;</span><br>  <span class="hljs-comment">//   app</span><br>  <span class="hljs-comment">// &#125;</span><br>&#125;);<br></code></pre></td></tr></table></figure><p>import Vue from ‘vue’中引入的是 vue 文件夹, 它是由 vue 文件夹中的 module 配置项来决定导入的是哪一个 vue.js<br>runtime.js 相比于 vue.js, 精简了模板解析器, 模板解析器也不会在 webpack 打包的时候被打包进去<br><img src="/assets/830508b1fe974a07b8a115506a3b98c5.png"></p><p>关于不同版本的 Vue</p><ol><li>vue.js 与 vue.runtime.xxx.js 的区别：<ol><li>vue.js 是完整版的 Vue，包含：核心功能 + 模板解析器。</li><li>vue.runtime.xxx.js 是运行版的 Vue，只包含：核心功能；没有模板解析器。</li></ol></li><li>因为 vue.runtime.xxx.js 没有模板解析器，所以不能使用 template 这个配置项，需要使用 render 函数接收到的 createElement 函数去指定具体内容。</li></ol><h2 id="render-函数"><a href="#render-函数" class="headerlink" title="render 函数"></a>render 函数</h2><p>使用 render 渲染函数就可以在 runtime.js 的环境中解析模板, template 在 runtime.js 的环境中没法解析模板, 因为 runtime 剔除了模板引擎</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// render: h =&gt; h(App),</span><br><br><span class="hljs-comment">// render(createElement) &#123;</span><br><span class="hljs-comment">//   return createElement(&#x27;h1&#x27;, &#x27;你好啊&#x27;)</span><br><span class="hljs-comment">// &#125;</span><br><br><span class="hljs-comment">// render: function(createElement) &#123;</span><br><span class="hljs-comment">//   return createElement(&#x27;h1&#x27;, &#x27;你好啊&#x27;)</span><br><span class="hljs-comment">// &#125;</span><br><br><span class="hljs-comment">// render:(createElement) =&gt; createElement(&#x27;h1&#x27;, &#x27;你好啊&#x27;)</span><br><br><span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> <span class="hljs-title function_">a</span>(<span class="hljs-string">&quot;h1&quot;</span>, <span class="hljs-string">&quot;你好啊&quot;</span>);<br></code></pre></td></tr></table></figure><h2 id="修改默认配置-vue-config-js-配置文件"><a href="#修改默认配置-vue-config-js-配置文件" class="headerlink" title="修改默认配置(vue.config.js 配置文件)"></a>修改默认配置(vue.config.js 配置文件)</h2><p>vue.config.js<br>在 pages 选项中配置的 entry 可以指明 main.js 作为程序的入口, 当然可以设置成其他的, 一般保持默认既可</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> &#123; defineConfig &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@vue/cli-service&quot;</span>);<br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title function_">defineConfig</span>(&#123;<br>  <span class="hljs-attr">pages</span>: &#123;<br>    <span class="hljs-attr">index</span>: &#123;<br>      <span class="hljs-comment">// 配置入口</span><br>      <span class="hljs-attr">entry</span>: <span class="hljs-string">&quot;src/main.js&quot;</span>,<br>    &#125;,<br>  &#125;,<br>  <span class="hljs-attr">transpileDependencies</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-attr">lintOnSave</span>: <span class="hljs-literal">false</span>,<br>&#125;);<br></code></pre></td></tr></table></figure><ol><li>使用 vue inspect &gt; output.js 可以查看到 Vue 脚手架的默认配置。</li><li>使用 vue.config.js 可以对脚手架进行个性化定制，详情见：<a href="https://cli.vuejs.org/zh">https://cli.vuejs.org/zh</a></li></ol><h2 id="ref-属性"><a href="#ref-属性" class="headerlink" title="ref 属性"></a>ref 属性</h2><ol><li>被用来给元素或子组件注册引用信息（id 的替代者）</li><li>应用在 html 标签上获取的是真实 DOM 元素，应用在组件标签上是组件实例对象（vc）</li><li>使用方式：<ol><li>打标识：<h1 ref="xxx">…..</h1> 或 <School ref="xxx"></School></li><li>获取：this.$refs.xxx</li></ol></li></ol><p>Student.vue</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;school&quot;&gt;<br>       <br>    &lt;h2&gt;学校名称：&#123;&#123; name &#125;&#125;&lt;/h2&gt;<br>       <br>    &lt;h2&gt;学校地址：&#123;&#123; address &#125;&#125;&lt;/h2&gt;<br>     <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>export default &#123;<br>  name: &quot;School&quot;,<br>  data() &#123;<br>    return &#123;<br>      name: &quot;尚硅谷&quot;,<br>      address: &quot;北京·昌平&quot;,<br>    &#125;;<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style&gt;<br>  .school&#123;<br>    background-color: gray;<br>  &#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure><p>App.vue</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div&gt;<br>       <br>    &lt;h1 v-text=&quot;msg&quot; ref=&quot;title&quot;&gt;&lt;/h1&gt;<br>        &lt;button ref=&quot;btn&quot; @click=&quot;showDOM&quot;&gt;点我输出上方的DOM元素&lt;/button&gt;    <br>    &lt;School ref=&quot;sch&quot; /&gt;  <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>//引入School组件<br>import School from &quot;./components/School&quot;;<br><br>export default &#123;<br>  name: &quot;App&quot;,<br>  components: &#123; School &#125;,<br>  data() &#123;<br>    return &#123;<br>      msg: &quot;欢迎学习Vue！&quot;,<br>    &#125;;<br>  &#125;,<br>  methods: &#123;<br>    showDOM() &#123;<br>      console.log(this.$refs.title); //真实DOM元素<br>      console.log(this.$refs.btn); //真实DOM元素<br>      console.log(this.$refs.sch); //School组件的实例对象（vc）<br>    &#125;,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><h2 id="props-配置"><a href="#props-配置" class="headerlink" title="props 配置"></a>props 配置</h2><ol><li>功能：让组件接收外部传过来的数据</li><li>传递数据：<code>&lt;Demo name=&quot;xxx&quot;/&gt;</code></li><li>接收数据：</li><li>第一种方式（只接收）：<code>props:[&#39;name&#39;]</code></li><li>第二种方式（限制类型）：<code>props:&#123;name:String&#125;</code></li><li>第三种方式（限制类型、限制必要性、指定默认值）：</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-attr">props</span>:&#123;<br><span class="hljs-attr">name</span>:&#123;<br><span class="hljs-attr">type</span>:<span class="hljs-title class_">String</span>, <span class="hljs-comment">//类型</span><br><span class="hljs-attr">required</span>:<span class="hljs-literal">true</span>, <span class="hljs-comment">//必要性</span><br><span class="hljs-attr">default</span>:<span class="hljs-string">&#x27;老王&#x27;</span> <span class="hljs-comment">//默认值</span><br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>备注：props 是只读的，Vue 底层会监测你对 props 的修改，如果进行了修改，就会发出警告，若业务需求确实需要修改，那么请复制 props 的内容到 data 中一份，然后去修改 data 中的数据。</p></blockquote><p>Student.vue</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div&gt;<br>       <br>    &lt;h1&gt;&#123;&#123; msg &#125;&#125;&lt;/h1&gt;<br>       <br>    &lt;h2&gt;学生姓名: &#123;&#123; name &#125;&#125;&lt;/h2&gt;<br>       <br>    &lt;h2&gt;学生性别: &#123;&#123; sex &#125;&#125;&lt;/h2&gt;<br>       <br>    &lt;h2&gt;学生年龄: &#123;&#123; MyAge + 1 &#125;&#125;&lt;/h2&gt;<br>        &lt;button @click=&quot;updateAge&quot;&gt;点我修改年龄&lt;/button&gt;  <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>export default &#123;<br>  name: &quot;Student&quot;,<br>  data() &#123;<br>    return &#123;<br>      msg: &quot;我是一个尚硅谷的学生&quot;,<br>      MyAge: this.age,<br>    &#125;;<br>  &#125;,<br>  methods: &#123;<br>    updateAge() &#123;<br>      this.MyAge++;<br>    &#125;,<br>  &#125;, //简单声明接收 // props: [&#x27;name&#x27;, &#x27;sex&#x27;, &#x27;age&#x27;] //接收的同时对数据进行类型限制 // props: &#123; //   name: String, //   sex: String, //   age: Number // &#125; //接收的同时对数据：进行类型限制+默认值的指定+必要性的限制<br>  props: &#123;<br>    name: &#123;<br>      type: String, //name的类型是字符串<br>      required: true, //name是必要的<br>    &#125;,<br>    sex: &#123;<br>      type: String,<br>      default: &quot;男&quot;, //默认值<br>    &#125;,<br>    age: &#123;<br>      type: Number,<br>      default: 20,<br>    &#125;,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><p>App.vue</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div&gt;    &lt;Student :age=&quot;18&quot; name=&quot;尚硅谷&quot; sex=&quot;男&quot; /&gt;  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import Student from &quot;./components/Student.vue&quot;;<br>export default &#123;<br>  name: &quot;App&quot;,<br>  components: &#123;<br>    Student,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style&gt;&lt;/style&gt;<br></code></pre></td></tr></table></figure><h2 id="mixin-混入"><a href="#mixin-混入" class="headerlink" title="mixin 混入"></a>mixin 混入</h2><ol><li>功能：可以把多个组件共用的配置提取成一个混入对象</li><li>使用方式：<br>第一步定义混合：</li></ol><figure class="highlight nim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs nim">&#123;<br>    data()<span class="hljs-meta">&#123;....&#125;</span>,<br>    methods:<span class="hljs-meta">&#123;....&#125;</span><br>    ....<br>&#125;<br></code></pre></td></tr></table></figure><p>第二步使用混入：<br>全局混入：<code>Vue.mixin(xxx)</code><br>局部混入：<code>mixins:[&#39;xxx&#39;]</code><br>School.vue</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div&gt;<br>       <br>    &lt;h2 @click=&quot;showName&quot;&gt;学校名称: &#123;&#123; name &#125;&#125;&lt;/h2&gt;<br>       <br>    &lt;h2&gt;学校地址: &#123;&#123; address &#125;&#125;&lt;/h2&gt;<br>     <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>// import &#123;mixin&#125; from &quot;../mixin&quot;<br>export default &#123;<br>  name: &quot;School&quot;,<br>  data() &#123;<br>    return &#123;<br>      name: &quot;尚硅谷&quot;,<br>      address: &quot;北京&quot;,<br>    &#125;;<br>  &#125;, // mixins: [mixin]<br>&#125;;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><p>Student.vue</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div&gt;<br>       <br>    &lt;h2 @click=&quot;showName&quot;&gt;学生姓名: &#123;&#123; name &#125;&#125;&lt;/h2&gt;<br>       <br>    &lt;h2&gt;学生性别: &#123;&#123; sex &#125;&#125;&lt;/h2&gt;<br>     <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>// import &#123;mixin&#125; from &quot;../mixin&quot;<br>export default &#123;<br>  name: &quot;Student&quot;,<br>  data() &#123;<br>    return &#123;<br>      name: &quot;张三&quot;,<br>      sex: &quot;男&quot;,<br>    &#125;;<br>  &#125;, // mixins: [mixin],<br>  mounted() &#123;<br>    // console.log(&quot;你好啊!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!&quot;);<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><p>App.vue</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div&gt;<br>        &lt;Student /&gt;    <br>    &lt;hr /&gt;<br>        &lt;School /&gt;  <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import Student from &quot;./components/Student.vue&quot;;<br>import School from &quot;./components/School.vue&quot;;<br><br>export default &#123;<br>  name: &quot;App&quot;,<br>  components: &#123;<br>    Student,<br>    School,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style&gt;&lt;/style&gt;<br></code></pre></td></tr></table></figure><p>mixin.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> mixin = &#123;<br>  <span class="hljs-attr">methods</span>: &#123;<br>    <span class="hljs-title function_">showName</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-title function_">alert</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);<br>    &#125;,<br>  &#125;,<br>  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-comment">// console.log(&#x27;你好啊！&#x27;)</span><br>  &#125;,<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> mixin2 = &#123;<br>  <span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> &#123;<br>      <span class="hljs-attr">x</span>: <span class="hljs-number">999</span>,<br>      <span class="hljs-attr">y</span>: <span class="hljs-number">666</span>,<br>    &#125;;<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure><p>main.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./App&quot;</span>;<br><br><span class="hljs-keyword">import</span> &#123; mixin, mixin2 &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./mixin&quot;</span>;<br><span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">mixin</span>(mixin);<br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">mixin</span>(mixin2);<br><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br>  <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#app&quot;</span>,<br>  <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">h</span>) =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>),<br>&#125;);<br></code></pre></td></tr></table></figure><h2 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h2><ol><li>功能：用于增强 Vue</li><li>本质：包含 install 方法的一个对象，install 的第一个参数是 Vue，第二个以后的参数是插件使用者传递的数据。</li><li>定义插件：</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javascript">对象.<span class="hljs-property">install</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">Vue, options</span>) &#123;<br>    <span class="hljs-comment">// 1. 添加全局过滤器</span><br>    <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">filter</span>(....)<br><br>    <span class="hljs-comment">// 2. 添加全局指令</span><br>    <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">directive</span>(....)<br><br>    <span class="hljs-comment">// 3. 配置全局混入(合)</span><br>    <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">mixin</span>(....)<br><br>    <span class="hljs-comment">// 4. 添加实例方法</span><br>    <span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$myMethod</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;...&#125;<br>    <span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$myProperty</span> = xxxx<br>&#125;<br></code></pre></td></tr></table></figure><ol start="4"><li>使用插件：<code>Vue.use()</code></li></ol><p>Student.vue</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div&gt;<br>       <br>    &lt;h2&gt;学生姓名: &#123;&#123; name &#125;&#125;&lt;/h2&gt;<br>       <br>    &lt;h2&gt;学生性别: &#123;&#123; sex &#125;&#125;&lt;/h2&gt;<br>            &lt;input type=&quot;text&quot; v-fbind:value=&quot;name&quot; /&gt;  <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>export default &#123;<br>  name: &quot;Student&quot;,<br>  data() &#123;<br>    return &#123;<br>      name: &quot;张三&quot;,<br>      sex: &quot;男&quot;,<br>    &#125;;<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><p>School.vue</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div&gt;<br>       <br>    &lt;h2 @click=&quot;test&quot;&gt;学校名称: &#123;&#123; name | mySlice &#125;&#125;&lt;/h2&gt;<br>       <br>    &lt;h2&gt;学校地址: &#123;&#123; address &#125;&#125;&lt;/h2&gt;<br>     <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>export default &#123;<br>  name: &quot;School&quot;,<br>  data() &#123;<br>    return &#123;<br>      name: &quot;尚硅谷atguigu&quot;,<br>      address: &quot;北京&quot;,<br>    &#125;;<br>  &#125;,<br>  methods: &#123;<br>    test() &#123;<br>      this.hello();<br>    &#125;,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><p>App.vue</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div&gt;<br>        &lt;Student /&gt;    <br>    &lt;hr /&gt;<br>        &lt;School /&gt;  <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import Student from &quot;./components/Student.vue&quot;;<br>import School from &quot;./components/School.vue&quot;;<br><br>export default &#123;<br>  name: &quot;App&quot;,<br>  components: &#123;<br>    Student,<br>    School,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style&gt;&lt;/style&gt;<br></code></pre></td></tr></table></figure><p>main.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./App.vue&quot;</span>;<br><span class="hljs-comment">// 引入插件</span><br><span class="hljs-keyword">import</span> plugins <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./plugins&quot;</span>;<br><br><span class="hljs-comment">// 应用(使用)插件</span><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(plugins, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);<br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;<br><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br>  <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#app&quot;</span>,<br>  <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">h</span>) =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>),<br>&#125;);<br></code></pre></td></tr></table></figure><p>plugins.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-title function_">install</span>(<span class="hljs-params">Vue, x, y, z</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(x, y, z); <span class="hljs-comment">// 全局过滤器</span><br>    <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-string">&quot;mySlice&quot;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) &#123;<br>      <span class="hljs-keyword">return</span> value.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">4</span>);<br>    &#125;); <span class="hljs-comment">//定义全局指令</span><br><br>    <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">directive</span>(<span class="hljs-string">&quot;fbind&quot;</span>, &#123;<br>      <span class="hljs-comment">//指令与元素成功绑定时（一上来）</span><br>      <span class="hljs-title function_">bind</span>(<span class="hljs-params">element, binding</span>) &#123;<br>        element.<span class="hljs-property">value</span> = binding.<span class="hljs-property">value</span>;<br>      &#125;, <span class="hljs-comment">//指令所在元素被插入页面时</span><br>      <span class="hljs-title function_">inserted</span>(<span class="hljs-params">element, binding</span>) &#123;<br>        element.<span class="hljs-title function_">focus</span>();<br>      &#125;, <span class="hljs-comment">//指令所在的模板被重新解析时</span><br>      <span class="hljs-title function_">update</span>(<span class="hljs-params">element, binding</span>) &#123;<br>        element.<span class="hljs-property">value</span> = binding.<span class="hljs-property">value</span>;<br>      &#125;,<br>    &#125;); <span class="hljs-comment">//定义混入</span><br><br>    <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">mixin</span>(&#123;<br>      <span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">return</span> &#123;<br>          <span class="hljs-attr">x</span>: <span class="hljs-number">100</span>,<br>          <span class="hljs-attr">y</span>: <span class="hljs-number">200</span>,<br>        &#125;;<br>      &#125;,<br>    &#125;); <span class="hljs-comment">//给Vue原型上添加一个方法（vm和vc就都能用了）</span><br><br>    <span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">hello</span> = <span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;你好啊&quot;</span>);<br>    &#125;;<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="scoped-样式"><a href="#scoped-样式" class="headerlink" title="scoped 样式"></a>scoped 样式</h2><ol><li>作用：让样式在局部生效，防止冲突。</li><li>写法：<code>&lt;style scoped&gt;</code></li></ol><p>School.vue</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;demo&quot;&gt;<br>       <br>    &lt;h2 class=&quot;title&quot;&gt;学校名称: &#123;&#123; name &#125;&#125;&lt;/h2&gt;<br>       <br>    &lt;h2&gt;学校地址: &#123;&#123; address &#125;&#125;&lt;/h2&gt;<br>     <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>export default &#123;<br>  name: &quot;School&quot;,<br>  data() &#123;<br>    return &#123;<br>      name: &quot;尚硅谷atguigu&quot;,<br>      address: &quot;北京&quot;,<br>    &#125;;<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>  .demo &#123;<br>    background-color: lightpink;<br>  &#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure><p>Student.vue</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;div class=&quot;demo&quot;&gt;<br>    &lt;h2 class=&quot;title&quot;&gt;学校名称: &#123;&#123; name &#125;&#125;&lt;/h2&gt;<br>    &lt;h2 class=&quot;qwe&quot;&gt;学校地址: &#123;&#123; address &#125;&#125;&lt;/h2&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>export default &#123;<br>  name: &quot;School&quot;,<br>  data() &#123;<br>    return &#123;<br>      name: &quot;尚硅谷atguigu&quot;,<br>      address: &quot;北京&quot;,<br>    &#125;;<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style lang=&quot;less&quot; scoped&gt;<br>.demo &#123;<br>  background-color: lightpink;<br>  .qwe &#123;<br>    font-size: 50px;<br>  &#125;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure><p>App.vue</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div&gt;<br>       <br>    &lt;h2 class=&quot;title&quot;&gt;标题&lt;/h2&gt;<br>        &lt;School /&gt;    <br>    &lt;hr /&gt;<br>        &lt;Student /&gt;  <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import Student from &quot;./components/Student.vue&quot;;<br>import School from &quot;./components/School.vue&quot;;<br><br>export default &#123;<br>  name: &quot;App&quot;,<br>  components: &#123;<br>    Student,<br>    School,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>  .title &#123;<br>    color: red;<br>  &#125;<br>&lt;/style&gt;<br><br>&lt;style&gt;&lt;/style&gt;<br></code></pre></td></tr></table></figure><p>main.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./App.vue&quot;</span>;<br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;<br><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br>  <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#app&quot;</span>,<br>  <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">h</span>) =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>),<br>&#125;);<br></code></pre></td></tr></table></figure><p>在组件中的 style 标签中定义了 scoped, 会在使用的 class 类上加上随机的 id, 在选择器中配合 id 来选择, 用来解决 css 选择器重名的问题<br><img src="/assets/9b3de84ac4e24f03b9a16352c262c48e.png"><br>但是在 App.vue 组件中, 一般不用这个, 主要是 App 组件中写了样式, 就说明是很多组件都在使用的, 就不需要用 scoped 的</p><h3 id="Module-not-found-Error-Can’t-resolve-‘less-loader’-in-‘E-Code-Vue-vue-test’"><a href="#Module-not-found-Error-Can’t-resolve-‘less-loader’-in-‘E-Code-Vue-vue-test’" class="headerlink" title="Module not found: Error: Can’t resolve ‘less-loader’ in ‘E:\Code\Vue\vue_test’"></a>Module not found: Error: Can’t resolve ‘less-loader’ in ‘E:\Code\Vue\vue_test’</h3><style lang="less">![](assets/9c0c649bd172454f8dedb406f0569869.png)PS E:\Code\Vue\vue_test> npm i less-loader只需要安装 less-loader 就行了webpack 4 应该安装 less-loader7 版本的PS E:\Code\Vue\vue_test> npm i less-loader@7webpack 5 可以安装 less-loader 最新版(11)<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs javascript">查看版本的最新版<br><span class="hljs-variable constant_">PS</span> <span class="hljs-attr">E</span>:\<span class="hljs-title class_">Code</span>\<span class="hljs-title class_">Vue</span>\vue_test&gt; npm view webpack versions<br>[<br>  <span class="hljs-string">&#x27;0.1.0&#x27;</span>,          <span class="hljs-string">&#x27;0.1.1&#x27;</span>,          <span class="hljs-string">&#x27;0.1.2&#x27;</span>,          <span class="hljs-string">&#x27;0.1.3&#x27;</span>,<br>  ...<br>  ...<br>  ...<br>  <span class="hljs-string">&#x27;5.73.0&#x27;</span>,         <span class="hljs-string">&#x27;5.74.0&#x27;</span>,         <span class="hljs-string">&#x27;5.75.0&#x27;</span><br>]<br><br><span class="hljs-variable constant_">PS</span> <span class="hljs-attr">E</span>:\<span class="hljs-title class_">Code</span>\<span class="hljs-title class_">Vue</span>\vue_test&gt; npm view less-loader versions<br>[<br>  <span class="hljs-string">&#x27;0.1.0&#x27;</span>,  <span class="hljs-string">&#x27;0.1.1&#x27;</span>,  <span class="hljs-string">&#x27;0.1.2&#x27;</span>,  <span class="hljs-string">&#x27;0.1.3&#x27;</span>,  <span class="hljs-string">&#x27;0.2.0&#x27;</span>,<br>  <span class="hljs-string">&#x27;0.2.1&#x27;</span>,  <span class="hljs-string">&#x27;0.2.2&#x27;</span>,  <span class="hljs-string">&#x27;0.5.0&#x27;</span>,  <span class="hljs-string">&#x27;0.5.1&#x27;</span>,  <span class="hljs-string">&#x27;0.6.0&#x27;</span>,<br>  <span class="hljs-string">&#x27;0.6.1&#x27;</span>,  <span class="hljs-string">&#x27;0.6.2&#x27;</span>,  <span class="hljs-string">&#x27;0.7.0&#x27;</span>,  <span class="hljs-string">&#x27;0.7.1&#x27;</span>,  <span class="hljs-string">&#x27;0.7.2&#x27;</span>,<br>  <span class="hljs-string">&#x27;0.7.3&#x27;</span>,  <span class="hljs-string">&#x27;0.7.4&#x27;</span>,  <span class="hljs-string">&#x27;0.7.5&#x27;</span>,  <span class="hljs-string">&#x27;0.7.6&#x27;</span>,  <span class="hljs-string">&#x27;0.7.7&#x27;</span>,<br>  <span class="hljs-string">&#x27;0.7.8&#x27;</span>,  <span class="hljs-string">&#x27;2.0.0&#x27;</span>,  <span class="hljs-string">&#x27;2.1.0&#x27;</span>,  <span class="hljs-string">&#x27;2.2.0&#x27;</span>,  <span class="hljs-string">&#x27;2.2.1&#x27;</span>,<br>  <span class="hljs-string">&#x27;2.2.2&#x27;</span>,  <span class="hljs-string">&#x27;2.2.3&#x27;</span>,  <span class="hljs-string">&#x27;3.0.0&#x27;</span>,  <span class="hljs-string">&#x27;4.0.0&#x27;</span>,  <span class="hljs-string">&#x27;4.0.1&#x27;</span>,<br>  <span class="hljs-string">&#x27;4.0.2&#x27;</span>,  <span class="hljs-string">&#x27;4.0.3&#x27;</span>,  <span class="hljs-string">&#x27;4.0.4&#x27;</span>,  <span class="hljs-string">&#x27;4.0.5&#x27;</span>,  <span class="hljs-string">&#x27;4.0.6&#x27;</span>,<br>  <span class="hljs-string">&#x27;4.1.0&#x27;</span>,  <span class="hljs-string">&#x27;5.0.0&#x27;</span>,  <span class="hljs-string">&#x27;6.0.0&#x27;</span>,  <span class="hljs-string">&#x27;6.1.0&#x27;</span>,  <span class="hljs-string">&#x27;6.1.1&#x27;</span>,<br>  <span class="hljs-string">&#x27;6.1.2&#x27;</span>,  <span class="hljs-string">&#x27;6.1.3&#x27;</span>,  <span class="hljs-string">&#x27;6.2.0&#x27;</span>,  <span class="hljs-string">&#x27;7.0.0&#x27;</span>,  <span class="hljs-string">&#x27;7.0.1&#x27;</span>,<br>  <span class="hljs-string">&#x27;7.0.2&#x27;</span>,  <span class="hljs-string">&#x27;7.1.0&#x27;</span>,  <span class="hljs-string">&#x27;7.2.0&#x27;</span>,  <span class="hljs-string">&#x27;7.2.1&#x27;</span>,  <span class="hljs-string">&#x27;7.3.0&#x27;</span>,<br>  <span class="hljs-string">&#x27;8.0.0&#x27;</span>,  <span class="hljs-string">&#x27;8.1.0&#x27;</span>,  <span class="hljs-string">&#x27;8.1.1&#x27;</span>,  <span class="hljs-string">&#x27;9.0.0&#x27;</span>,  <span class="hljs-string">&#x27;9.1.0&#x27;</span>,<br>  <span class="hljs-string">&#x27;10.0.0&#x27;</span>, <span class="hljs-string">&#x27;10.0.1&#x27;</span>, <span class="hljs-string">&#x27;10.1.0&#x27;</span>, <span class="hljs-string">&#x27;10.2.0&#x27;</span>, <span class="hljs-string">&#x27;11.0.0&#x27;</span>,<br>  <span class="hljs-string">&#x27;11.1.0&#x27;</span><br>]<br></code></pre></td></tr></table></figure>安装 nanoid 库 npm i nanoidprops 传进来的对象, 最好不要去做修改![](assets/e9d6b2577f3e416fb4a1ec935490d9eb.png)## WebStore1.  存储内容大小一般支持 5MB 左右（不同浏览器可能还不一样）2.  浏览器端通过 Window.sessionStorage 和 Window.localStorage 属性来实现本地存储机制。3.  相关 API：4.  `xxxxxStorage.setItem('key', 'value');`    该方法接受一个键和值作为参数，会把键值对添加到存储中，如果键名存在，则更新其对应的值。5.  `xxxxxStorage.getItem('person');`    该方法接受一个键名作为参数，返回键名对应的值。6.  `xxxxxStorage.removeItem('key');`    该方法接受一个键名作为参数，并把该键名从存储中删除。7.  `xxxxxStorage.clear()`    该方法会清空存储中的所有数据。8.  备注：9.  SessionStorage 存储的内容会随着浏览器窗口关闭而消失。10. LocalStorage 存储的内容，需要手动清除才会消失。11. `xxxxxStorage.getItem(xxx)`如果 xxx 对应的 value 获取不到，那么 getItem 的返回值是 null。12. `JSON.parse(null)`的结果依然是 null。localStore.html<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>localStore<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>localStore<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;saveData()&quot;</span>&gt;</span>点我保存一个数据<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;readData()&quot;</span>&gt;</span>点我读取一个数据<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;deleteData()&quot;</span>&gt;</span>点我删除一个数据<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;deleteAllData()&quot;</span>&gt;</span>点我清空所有数据<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> person = &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;张三&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">18</span> &#125;;</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">function</span> <span class="hljs-title function_">saveData</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">        <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&quot;msg1&quot;</span>, <span class="hljs-string">&quot;Hello&quot;</span>);</span><br><span class="language-javascript">        <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&quot;msg2&quot;</span>, <span class="hljs-number">123</span>);</span><br><span class="language-javascript">        <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&quot;msg3&quot;</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(person));</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">      <span class="hljs-keyword">function</span> <span class="hljs-title function_">readData</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&quot;msg1&quot;</span>));</span><br><span class="language-javascript">        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&quot;msg2&quot;</span>));</span><br><span class="language-javascript">        <span class="hljs-keyword">const</span> result = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&quot;msg3&quot;</span>);</span><br><span class="language-javascript">        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(result));</span><br><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&quot;msg4&quot;</span>));</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">      <span class="hljs-keyword">function</span> <span class="hljs-title function_">deleteData</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">        <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">removeItem</span>(<span class="hljs-string">&quot;msg1&quot;</span>);</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">      <span class="hljs-keyword">function</span> <span class="hljs-title function_">deleteAllData</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">        <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">clear</span>();</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>sessionStore.html<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>sessionStore<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>sessionStore<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;saveData()&quot;</span>&gt;</span>点我保存一个数据<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;readData()&quot;</span>&gt;</span>点我读取一个数据<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;deleteData()&quot;</span>&gt;</span>点我删除一个数据<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;deleteAllData()&quot;</span>&gt;</span>点我清空所有数据<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> person = &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;张三&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">18</span> &#125;;</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">function</span> <span class="hljs-title function_">saveData</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">        sessionStorage.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&quot;msg1&quot;</span>, <span class="hljs-string">&quot;Hello&quot;</span>);</span><br><span class="language-javascript">        sessionStorage.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&quot;msg2&quot;</span>, <span class="hljs-number">123</span>);</span><br><span class="language-javascript">        sessionStorage.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&quot;msg3&quot;</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(person));</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">      <span class="hljs-keyword">function</span> <span class="hljs-title function_">readData</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(sessionStorage.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&quot;msg1&quot;</span>));</span><br><span class="language-javascript">        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(sessionStorage.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&quot;msg2&quot;</span>));</span><br><span class="language-javascript">        <span class="hljs-keyword">const</span> result = sessionStorage.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&quot;msg3&quot;</span>);</span><br><span class="language-javascript">        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(result));</span><br><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(sessionStorage.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&quot;msg4&quot;</span>));</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">      <span class="hljs-keyword">function</span> <span class="hljs-title function_">deleteData</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">        sessionStorage.<span class="hljs-title function_">removeItem</span>(<span class="hljs-string">&quot;msg1&quot;</span>);</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">      <span class="hljs-keyword">function</span> <span class="hljs-title function_">deleteAllData</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">        sessionStorage.<span class="hljs-title function_">clear</span>();</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>## TodoList\_案例1.  组件化编码流程：    (1).拆分静态组件：组件要按照功能点拆分，命名不要与 html 元素冲突。    (2).实现动态组件：考虑好数据的存放位置，数据是一个组件在用，还是一些组件在用：    1).一个组件在用：放在组件自身即可。    2). 一些组件在用：放在他们共同的父组件上（状态提升）。    (3).实现交互：从绑定事件开始。2.  props 适用于：    (1).父组件 ==> 子组件 通信    (2).子组件 ==> 父组件 通信（要求父先给子一个函数）3.  使用 v-model 时要切记：v-model 绑定的值不能是 props 传过来的值，因为 props 是不可以修改的！4.  props 传过来的若是对象类型的值，修改对象中的属性时 Vue 不会报错，但不推荐这样做。MyHeader.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;todo-header&quot;&gt;<br>       <br>    &lt;input<br>      type=&quot;text&quot;<br>      v-model=&quot;todoName&quot;<br>      @keyup.enter=&quot;add&quot;<br>      placeholder=&quot;请输入你的任务名称，按回车键确认&quot;<br>    /&gt;<br>     <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import &#123; nanoid &#125; from &quot;nanoid&quot;;<br>export default &#123;<br>  name: &quot;MyHeader&quot;,<br>  props: [&quot;addTodoObj&quot;],<br>  data() &#123;<br>    return &#123;<br>      todoName: &quot;&quot;,<br>    &#125;;<br>  &#125;,<br>  methods: &#123;<br>    add() &#123;<br>      if (!this.todoName) &#123;<br>        alert(&quot;请输入点什么吧&quot;);<br>        return;<br>      &#125;<br>      const todoObj = &#123; id: nanoid(), title: this.todoName, done: false &#125;; // console.log(todoObj);<br>      this.addTodoObj(todoObj);<br>      this.todoName = &quot;&quot;;<br>    &#125;,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>/*header*/<br>.todo-header input &#123;<br>  width: 560px;<br>  height: 28px;<br>  font-size: 14px;<br>  border: 1px solid #ccc;<br>  border-radius: 4px;<br>  padding: 4px 7px;<br>&#125;<br><br><br>.todo-header input:focus &#123;<br>  outline: none;<br>  border-color: rgba(82, 168, 236, 0.8);<br>  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075),<br>    0 0 8px rgba(82, 168, 236, 0.6);<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>MyList.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;ul class=&quot;todo-main&quot;&gt;<br>       <br>    &lt;MyItem<br>      v-for=&quot;todoObj in todos&quot;<br>      :key=&quot;todoObj.id&quot;<br>      :todoObj=&quot;todoObj&quot;<br>      :checkTodo=&quot;checkTodo&quot;<br>      :deleteTodoObj=&quot;deleteTodoObj&quot;<br>    /&gt;<br>     <br>  &lt;/ul&gt;<br>&lt;/template&gt;<br><br>&lt;script scoped&gt;<br>import MyItem from &quot;./MyItem.vue&quot;;<br>export default &#123;<br>  name: &quot;MyList&quot;,<br>  components: &#123;<br>    MyItem,<br>  &#125;,<br>  props: [&quot;todos&quot;, &quot;checkTodo&quot;, &quot;deleteTodoObj&quot;],<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style&gt;<br>/*main*/<br>.todo-main &#123;<br>  margin-left: 0px;<br>  border: 1px solid #ddd;<br>  border-radius: 2px;<br>  padding: 0px;<br>&#125;<br><br><br>.todo-empty &#123;<br>  height: 40px;<br>  line-height: 40px;<br>  border: 1px solid #ddd;<br>  border-radius: 2px;<br>  padding-left: 5px;<br>  margin-top: 10px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>MyItem.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;li&gt;<br>       <br>    &lt;label&gt;<br>           <br>      &lt;input<br>        type=&quot;checkbox&quot;<br>        :checked=&quot;todoObj.done&quot;<br>        @change=&quot;handleCheck(todoObj.id)&quot;<br>      /&gt;<br>            &lt;span&gt;&#123;&#123; todoObj.title &#125;&#125;&lt;/span&gt;    <br>    &lt;/label&gt;<br>       <br>    &lt;!-- 如下代码也能实现功能，但是不太推荐，因为有点违反原则，因为修改了props --&gt;<br>       <br>    &lt;!-- &lt;input type=&quot;checkbox&quot; v-model=&quot;todoObj.done&quot;/&gt; --&gt;<br>       <br>    &lt;button class=&quot;btn btn-danger&quot; @click=&quot;handleDelete(todoObj.id)&quot;&gt;<br>      删除<br>    &lt;/button&gt;<br>     <br>  &lt;/li&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>export default &#123;<br>  name: &quot;MyItem&quot;,<br>  props: [&quot;todoObj&quot;, &quot;checkTodo&quot;, &quot;deleteTodoObj&quot;],<br>  data() &#123;<br>    return &#123;&#125;;<br>  &#125;,<br>  methods: &#123;<br>    handleCheck(id) &#123;<br>      this.checkTodo(id);<br>    &#125;,<br>    handleDelete(id) &#123;<br>      this.deleteTodoObj(id);<br>    &#125;,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>/*item*/<br>li &#123;<br>  list-style: none;<br>  height: 36px;<br>  line-height: 36px;<br>  padding: 0 5px;<br>  border-bottom: 1px solid #ddd;<br>&#125;<br><br><br>li label &#123;<br>  float: left;<br>  cursor: pointer;<br>&#125;<br><br><br>li label li input &#123;<br>  vertical-align: middle;<br>  margin-right: 6px;<br>  position: relative;<br>  top: -1px;<br>&#125;<br><br><br>li button &#123;<br>  float: right;<br>  display: none;<br>  margin-top: 3px;<br>&#125;<br><br><br>li:before &#123;<br>  content: initial;<br>&#125;<br><br><br>li:last-child &#123;<br>  border-bottom: none;<br>&#125;<br><br><br>li:hover &#123;<br>    background-color: #ccc;<br>&#125;<br><br><br>li:hover button &#123;<br>    display: block;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>MyFoot.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;todo-footer&quot; v-show=&quot;total&quot;&gt;<br>       <br>    &lt;label&gt;<br>           <br>      &lt;!-- &lt;input type=&quot;checkbox&quot; :checked=&quot;isAll&quot; @change=&quot;checkAll&quot; /&gt; --&gt;<br>            &lt;input type=&quot;checkbox&quot; v-model=&quot;isAll&quot; /&gt;    <br>    &lt;/label&gt;<br>       <br>    &lt;span&gt;<br>            &lt;span&gt;已完成&#123;&#123; calcTodoTotal &#125;&#125;&lt;/span&gt; / 全部&#123;&#123; total &#125;&#125;    <br>    &lt;/span&gt;<br>       <br>    &lt;button class=&quot;btn btn-danger&quot; @click=&quot;clearAll&quot;&gt;清除已完成任务&lt;/button&gt;  <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>export default &#123;<br>  name: &quot;MyFooter&quot;,<br>  props: [&quot;todos&quot;, &quot;checkAllTodo&quot;, &quot;clearAllTodo&quot;],<br>  computed: &#123;<br>    // isAll() &#123;<br>    //   return this.total === this.calcTodoTotal &amp;&amp; this.total &gt; 0;<br>    // &#125;,<br>    total() &#123;<br>      return this.todos.length;<br>    &#125;,<br>    calcTodoTotal() &#123;<br>      /*       let i = 0<br>      this.todos.forEach((todo) =&gt; &#123;<br>        if (todo.done === true) i++<br>      &#125;);<br>      return i */<br>      /*       return this.todos.reduce((pre, current) =&gt; &#123;<br>        // console.log(current.done);<br>        return pre + (current.done ? 1 : 0)<br>      &#125;, 0) */<br>      return this.todos.reduce((pre, todo) =&gt; pre + (todo.done ? 1 : 0), 0);<br>    &#125;,<br>    isAll: &#123;<br>      get() &#123;<br>        return this.total === this.calcTodoTotal &amp;&amp; this.total &gt; 0;<br>      &#125;,<br>      set(value) &#123;<br>        this.checkAllTodo(value);<br>      &#125;,<br>    &#125;,<br>  &#125;,<br>  methods: &#123;<br>    checkAll(e) &#123;<br>      // console.log(e.target.checked);<br>      this.checkAllTodo(e.target.checked);<br>    &#125;,<br>    clearAll() &#123;<br>      this.clearAllTodo();<br>    &#125;,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>/*footer*/<br>.todo-footer &#123;<br>  height: 40px;<br>  line-height: 40px;<br>  padding-left: 6px;<br>  margin-top: 5px;<br>&#125;<br><br><br>.todo-footer label &#123;<br>  display: inline-block;<br>  margin-right: 20px;<br>  cursor: pointer;<br>&#125;<br><br><br>.todo-footer label input &#123;<br>  position: relative;<br>  top: -1px;<br>  vertical-align: middle;<br>  margin-right: 5px;<br>&#125;<br><br><br>.todo-footer button &#123;<br>  float: right;<br>  margin-top: 5px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>App.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div id=&quot;root&quot;&gt;<br>       <br>    &lt;div class=&quot;todo-container&quot;&gt;<br>           <br>      &lt;div class=&quot;todo-wrap&quot;&gt;<br>                &lt;MyHeader :addTodoObj=&quot;addTodoObj&quot; /&gt;        <br>        &lt;MyList<br>          :todos=&quot;todos&quot;<br>          :checkTodo=&quot;checkTodo&quot;<br>          :deleteTodoObj=&quot;deleteTodoObj&quot;<br>        /&gt;<br>               <br>        &lt;MyFooter<br>          :todos=&quot;todos&quot;<br>          :checkAllTodo=&quot;checkAllTodo&quot;<br>          :clearAllTodo=&quot;clearAllTodo&quot;<br>        /&gt;<br>             <br>      &lt;/div&gt;<br>         <br>    &lt;/div&gt;<br>     <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import MyHeader from &quot;./components/MyHeader.vue&quot;;<br>import MyList from &quot;./components/MyList.vue&quot;;<br>import MyFooter from &quot;./components/MyFooter.vue&quot;;<br><br>export default &#123;<br>  name: &quot;App&quot;,<br>  components: &#123;<br>    MyHeader,<br>    MyList,<br>    MyFooter,<br>  &#125;,<br>  data() &#123;<br>    return &#123;<br>      todos: JSON.parse(localStorage.getItem(&quot;todos&quot;)) || [],<br>    &#125;;<br>  &#125;,<br>  methods: &#123;<br>    addTodoObj(todoObj) &#123;<br>      this.todos.unshift(todoObj);<br>    &#125;,<br>    checkTodo(id) &#123;<br>      this.todos.forEach((todoObj) =&gt; &#123;<br>        if (todoObj.id === id) &#123;<br>          todoObj.done = !todoObj.done; // console.log(todoObj.done);<br>        &#125;<br>      &#125;);<br>    &#125;,<br>    deleteTodoObj(id) &#123;<br>      if (confirm(&quot;是否确定删除&quot;)) &#123;<br>        this.todos = this.todos.filter((todo) =&gt; &#123;<br>          return todo.id !== id;<br>        &#125;);<br>      &#125;<br>    &#125;,<br>    checkAllTodo(value) &#123;<br>      this.todos.forEach((todo) =&gt; &#123;<br>        todo.done = value;<br>      &#125;);<br>    &#125;,<br>    clearAllTodo() &#123;<br>      this.todos = this.todos.filter((todo) =&gt; &#123;<br>        return !todo.done;<br>      &#125;);<br>    &#125;,<br>  &#125;,<br>  watch: &#123;<br>    todos: &#123;<br>      deep: true,<br>      handler(value) &#123;<br>        localStorage.setItem(&quot;todos&quot;, JSON.stringify(value));<br>      &#125;,<br>    &#125;,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style&gt;<br>/*base*/<br>body &#123;<br>  background: #fff;<br>&#125;<br><br><br>.btn &#123;<br>  display: inline-block;<br>  padding: 4px 12px;<br>  margin-bottom: 0;<br>  font-size: 14px;<br>  line-height: 20px;<br>  text-align: center;<br>  vertical-align: middle;<br>  cursor: pointer;<br>  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.2),<br>    0 1px 2px rgba(0, 0, 0, 0.05);<br>  border-radius: 4px;<br>&#125;<br><br><br>.btn-danger &#123;<br>  color: #fff;<br>  background-color: #da4f49;<br>  border: 1px solid #bd362f;<br>&#125;<br><br><br>.btn-danger:hover &#123;<br>  color: #fff;<br>  background-color: #bd362f;<br>&#125;<br><br><br>.btn:focus &#123;<br>  outline: none;<br>&#125;<br><br><br>.todo-container &#123;<br>  width: 600px;<br>  margin: 0 auto;<br>&#125;<br>.todo-container .todo-wrap &#123;<br>  padding: 10px;<br>  border: 1px solid #ddd;<br>  border-radius: 5px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>main.js<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./App.vue&quot;</span>;<br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;<br><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br>  <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#app&quot;</span>,<br>  <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">h</span>) =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>),<br>&#125;);<br></code></pre></td></tr></table></figure>## 组件的自定义事件1.  一种组件间通信的方式，适用于：**子组件 ===> 父组件**2.  使用场景：A 是父组件，B 是子组件，B 想给 A 传数据，那么就要在 A 中给 B 绑定自定义事件（事件的回调在 A 中）。3.  绑定自定义事件：4.  第一种方式，在父组件中：`<Demo @atguigu="test"/>`   或 `<Demo v-on:atguigu="test"/>`5.  第二种方式，在父组件中：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;<span class="hljs-title class_">Demo</span> ref=<span class="hljs-string">&quot;demo&quot;</span>/&gt;<br>......<br><span class="hljs-title function_">mounted</span>(<span class="hljs-params"></span>)&#123;<br>   <span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">xxx</span>.$on(<span class="hljs-string">&#x27;atguigu&#x27;</span>,<span class="hljs-variable language_">this</span>.<span class="hljs-property">test</span>)<br>&#125;<br></code></pre></td></tr></table></figure>3.  若想让自定义事件只能触发一次，可以使用`once`修饰符，或`$once`方法。4.  触发自定义事件：`this.$emit('atguigu',数据)`5.  解绑自定义事件`this.$off('atguigu')`6.  组件上也可以绑定原生 DOM 事件，需要使用`native`修饰符。7.  注意：通过`this.$refs.xxx.$on('atguigu',回调)`绑定自定义事件时，回调要么配置在 methods 中，要么用箭头函数，否则 this 指向会出问题！School.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;school&quot;&gt;<br>       <br>    &lt;h2&gt;学校名称: &#123;&#123; name &#125;&#125;&lt;/h2&gt;<br>       <br>    &lt;h2&gt;学校地址: &#123;&#123; address &#125;&#125;&lt;/h2&gt;<br>        &lt;button @click=&quot;sendSchoolName&quot;&gt;点我把学校名称发送给App&lt;/button&gt;  <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>export default &#123;<br>  name: &quot;School&quot;,<br>  props: [&quot;getSchoolName&quot;],<br>  data() &#123;<br>    return &#123;<br>      name: &quot;尚硅谷&quot;,<br>      address: &quot;北京&quot;,<br>    &#125;;<br>  &#125;,<br>  methods: &#123;<br>    sendSchoolName() &#123;<br>      this.getSchoolName(this.name);<br>    &#125;,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style lang=&quot;less&quot; scoped&gt;<br>  .school &#123;<br>    background-color: lightpink;<br>    padding: 5px;<br>    margin-top: 30px;<br>  &#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>Student.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;student&quot;&gt;<br>       <br>    &lt;h2&gt;学生姓名: &#123;&#123; name &#125;&#125;&lt;/h2&gt;<br>       <br>    &lt;h2&gt;学生性别: &#123;&#123; sex &#125;&#125;&lt;/h2&gt;<br>       <br>    &lt;h2&gt;当前求和为: &#123;&#123; number &#125;&#125;&lt;/h2&gt;<br>        &lt;button @click=&quot;add&quot;&gt;点我number++&lt;/button&gt;    <br>    &lt;button @click=&quot;sendStudentName&quot;&gt;点我把学生名称发送给App&lt;/button&gt;    <br>    &lt;button @click=&quot;unbind&quot;&gt;解绑atguigu事件&lt;/button&gt;    <br>    &lt;button @click=&quot;death&quot;&gt;销毁当前Student组件的实例对象&lt;/button&gt;  <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>export default &#123;<br>  name: &quot;Student&quot;,<br>  data() &#123;<br>    return &#123;<br>      name: &quot;张三&quot;,<br>      sex: &quot;男&quot;,<br>      number: 0,<br>    &#125;;<br>  &#125;,<br>  methods: &#123;<br>    add() &#123;<br>      console.log(&quot;add回调被调用了&quot;);<br>      this.number++;<br>    &#125;,<br>    sendStudentName() &#123;<br>      this.$emit(&quot;atguigu&quot;, this.name, 666, 777, 888, 999); // this.$emit(&#x27;demo&#x27;) // this.$emit(&#x27;click&#x27;)<br>    &#125;,<br>    unbind() &#123;<br>      // this.$off(&#x27;atguigu&#x27;) // 解绑一个自定义事件<br>      // this.$off([&#x27;atguigu&#x27;, &#x27;demo&#x27;]) // 解绑多个自定义事件<br>      this.$off(); // 解绑所有的自定义事件<br>    &#125;,<br>    death() &#123;<br>      this.$destroy(); // 销毁了当前Student组件的实例对象, 销毁后所有Student实例的自定义事件全部不奏效 // 现在绑定的时间都会不奏效, 之前的原生的事件也不会奏效<br>    &#125;,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>.student &#123;<br>  background-color: lightblue;<br>  padding: 5px;<br>  margin-top: 30px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>App.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;app&quot;&gt;<br>       <br>    &lt;h2&gt;&#123;&#123; msg &#125;&#125;, 学生姓名是: &#123;&#123; studentName &#125;&#125;&lt;/h2&gt;<br>       <br>    &lt;!-- 通过父组件给子组件传递函数类型的props实现: 子给父传递数据 --&gt;<br>        &lt;School :getSchoolName=&quot;getSchoolName&quot; /&gt;    <br>    &lt;hr /&gt;<br>       <br>    &lt;!-- 由于v-on在student组件标签上, <br>    所以是给Student这个组件实例对象VC绑定了一个事件, <br>    事件名字叫atguigu, 如果以后有人触发了atguigu事件, <br>    demo函数就会被调用 --&gt;<br>       <br>    &lt;!-- 通过父组件给子组件绑定一个自定义事件实现: 子给父传递数据(第一种写法, 使用@或v-on) --&gt;<br>       <br>    &lt;!-- &lt;Student v-on:atguigu=&quot;getStudentName&quot; @demo=&quot;m1&quot; /&gt; --&gt;<br><br>       <br>    &lt;!-- 通过父组件给子组件绑定一个自定义事件实现: 子给父传递数据(第二种写法, 使用ref) --&gt;<br>        &lt;Student ref=&quot;student&quot; @click.native=&quot;show&quot; /&gt;  <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import Student from &quot;./components/Student.vue&quot;;<br>import School from &quot;./components/School.vue&quot;;<br><br>export default &#123;<br>  name: &quot;App&quot;,<br>  data() &#123;<br>    return &#123;<br>      msg: &quot;你好啊!&quot;,<br>      studentName: &quot;&quot;,<br>    &#125;;<br>  &#125;,<br>  components: &#123;<br>    Student,<br>    School,<br>  &#125;,<br>  methods: &#123;<br>    show() &#123;<br>      alert(123);<br>    &#125;,<br>    getSchoolName(name) &#123;<br>      console.log(&quot;App收到了School的name&quot;, name);<br>    &#125;,<br>    getStudentName(name, ...params) &#123;<br>      console.log(&quot;getStudentName被调用了&quot;, name, params);<br>      this.studentName = name;<br>    &#125;,<br>    m1() &#123;<br>      console.log(&quot;demo事件被触发了！&quot;);<br>    &#125;,<br>  &#125;,<br>  mounted() &#123;<br>    this.$refs.student.$on(&quot;atguigu&quot;, (name, params) =&gt; &#123;<br>      console.log(&quot;getStudentName被调用了&quot;, name, params);<br>      console.log(this);<br>      this.studentName = name;<br>    &#125;); // 绑定自定义事件 // this.$refs.student.$on(&quot;atguigu&quot;, this.getStudentName); // 绑定自定义事件 // this.$refs.student.$once(&quot;atguigu&quot;, this.getStudentName); // 绑定自定义事件(一次性) // 延迟三秒触发自定义事件 // setTimeout(() =&gt; &#123; //   this.$refs.student.$on(&quot;atguigu&quot;, this.getStudentName); // &#125;, 3000);<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>.app &#123;<br>  background-color: gray;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>main.js<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./App.vue&quot;</span>;<br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;<br><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br>  <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#app&quot;</span>,<br>  <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">h</span>) =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>), <span class="hljs-comment">// mounted() &#123; //     setTimeout(() =&gt; &#123; //         this.$destroy() //     &#125;, 3000) // &#125;,</span><br>&#125;);<br></code></pre></td></tr></table></figure>### TodoList\_自定义事件MyHeader.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;todo-header&quot;&gt;<br>       <br>    &lt;input<br>      type=&quot;text&quot;<br>      v-model=&quot;todoName&quot;<br>      @keyup.enter=&quot;add&quot;<br>      placeholder=&quot;请输入你的任务名称，按回车键确认&quot;<br>    /&gt;<br>     <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import &#123; nanoid &#125; from &quot;nanoid&quot;;<br>export default &#123;<br>  name: &quot;MyHeader&quot;, // props: [&quot;addTodoObj&quot;],<br>  data() &#123;<br>    return &#123;<br>      todoName: &quot;&quot;,<br>    &#125;;<br>  &#125;,<br>  methods: &#123;<br>    add() &#123;<br>      if (!this.todoName) &#123;<br>        alert(&quot;请输入点什么吧&quot;);<br>        return;<br>      &#125;<br>      const todoObj = &#123; id: nanoid(), title: this.todoName, done: false &#125;; // console.log(todoObj); // this.addTodoObj(todoObj);<br>      this.$emit(&quot;addTodoObj&quot;, todoObj);<br>      this.todoName = &quot;&quot;;<br>    &#125;,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>/*header*/<br>.todo-header input &#123;<br>  width: 560px;<br>  height: 28px;<br>  font-size: 14px;<br>  border: 1px solid #ccc;<br>  border-radius: 4px;<br>  padding: 4px 7px;<br>&#125;<br><br><br>.todo-header input:focus &#123;<br>  outline: none;<br>  border-color: rgba(82, 168, 236, 0.8);<br>  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075),<br>    0 0 8px rgba(82, 168, 236, 0.6);<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>MyList.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;ul class=&quot;todo-main&quot;&gt;<br>       <br>    &lt;MyItem<br>      v-for=&quot;todoObj in todos&quot;<br>      :key=&quot;todoObj.id&quot;<br>      :todoObj=&quot;todoObj&quot;<br>      :checkTodo=&quot;checkTodo&quot;<br>      :deleteTodoObj=&quot;deleteTodoObj&quot;<br>    /&gt;<br>     <br>  &lt;/ul&gt;<br>&lt;/template&gt;<br><br>&lt;script scoped&gt;<br>import MyItem from &quot;./MyItem.vue&quot;;<br>export default &#123;<br>  name: &quot;MyList&quot;,<br>  components: &#123;<br>    MyItem,<br>  &#125;,<br>  props: [&quot;todos&quot;, &quot;checkTodo&quot;, &quot;deleteTodoObj&quot;],<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style&gt;<br>/*main*/<br>.todo-main &#123;<br>  margin-left: 0px;<br>  border: 1px solid #ddd;<br>  border-radius: 2px;<br>  padding: 0px;<br>&#125;<br><br><br>.todo-empty &#123;<br>  height: 40px;<br>  line-height: 40px;<br>  border: 1px solid #ddd;<br>  border-radius: 2px;<br>  padding-left: 5px;<br>  margin-top: 10px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>MyItem.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;li&gt;<br>       <br>    &lt;label&gt;<br>           <br>      &lt;input<br>        type=&quot;checkbox&quot;<br>        :checked=&quot;todoObj.done&quot;<br>        @change=&quot;handleCheck(todoObj.id)&quot;<br>      /&gt;<br>            &lt;span&gt;&#123;&#123; todoObj.title &#125;&#125;&lt;/span&gt;    <br>    &lt;/label&gt;<br>       <br>    &lt;!-- 如下代码也能实现功能，但是不太推荐，因为有点违反原则，因为修改了props --&gt;<br>       <br>    &lt;!-- &lt;input type=&quot;checkbox&quot; v-model=&quot;todoObj.done&quot;/&gt; --&gt;<br>       <br>    &lt;button class=&quot;btn btn-danger&quot; @click=&quot;handleDelete(todoObj.id)&quot;&gt;<br>      删除<br>    &lt;/button&gt;<br>     <br>  &lt;/li&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>export default &#123;<br>  name: &quot;MyItem&quot;,<br>  props: [&quot;todoObj&quot;, &quot;checkTodo&quot;, &quot;deleteTodoObj&quot;],<br>  data() &#123;<br>    return &#123;&#125;;<br>  &#125;,<br>  methods: &#123;<br>    handleCheck(id) &#123;<br>      this.checkTodo(id);<br>    &#125;,<br>    handleDelete(id) &#123;<br>      this.deleteTodoObj(id);<br>    &#125;,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>/*item*/<br>li &#123;<br>  list-style: none;<br>  height: 36px;<br>  line-height: 36px;<br>  padding: 0 5px;<br>  border-bottom: 1px solid #ddd;<br>&#125;<br><br><br>li label &#123;<br>  float: left;<br>  cursor: pointer;<br>&#125;<br><br><br>li label li input &#123;<br>  vertical-align: middle;<br>  margin-right: 6px;<br>  position: relative;<br>  top: -1px;<br>&#125;<br><br><br>li button &#123;<br>  float: right;<br>  display: none;<br>  margin-top: 3px;<br>&#125;<br><br><br>li:before &#123;<br>  content: initial;<br>&#125;<br><br><br>li:last-child &#123;<br>  border-bottom: none;<br>&#125;<br><br><br>li:hover &#123;<br>    background-color: #ccc;<br>&#125;<br><br><br>li:hover button &#123;<br>    display: block;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>MyFoot.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;todo-footer&quot; v-show=&quot;total&quot;&gt;<br>       <br>    &lt;label&gt;<br>           <br>      &lt;!-- &lt;input type=&quot;checkbox&quot; :checked=&quot;isAll&quot; @change=&quot;checkAll&quot; /&gt; --&gt;<br>            &lt;input type=&quot;checkbox&quot; v-model=&quot;isAll&quot; /&gt;    <br>    &lt;/label&gt;<br>       <br>    &lt;span&gt;<br>            &lt;span&gt;已完成&#123;&#123; calcTodoTotal &#125;&#125;&lt;/span&gt; / 全部&#123;&#123; total &#125;&#125;    <br>    &lt;/span&gt;<br>       <br>    &lt;button class=&quot;btn btn-danger&quot; @click=&quot;clearAll&quot;&gt;清除已完成任务&lt;/button&gt;  <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>export default &#123;<br>  name: &quot;MyFooter&quot;,<br>  props: [&quot;todos&quot;],<br>  computed: &#123;<br>    // isAll() &#123;<br>    //   return this.total === this.calcTodoTotal &amp;&amp; this.total &gt; 0;<br>    // &#125;,<br>    total() &#123;<br>      return this.todos.length;<br>    &#125;,<br>    calcTodoTotal() &#123;<br>      /*       let i = 0<br>      this.todos.forEach((todo) =&gt; &#123;<br>        if (todo.done === true) i++<br>      &#125;);<br>      return i */<br>      /*       return this.todos.reduce((pre, current) =&gt; &#123;<br>        // console.log(current.done);<br>        return pre + (current.done ? 1 : 0)<br>      &#125;, 0) */<br>      return this.todos.reduce((pre, todo) =&gt; pre + (todo.done ? 1 : 0), 0);<br>    &#125;,<br>    isAll: &#123;<br>      get() &#123;<br>        return this.total === this.calcTodoTotal &amp;&amp; this.total &gt; 0;<br>      &#125;,<br>      set(value) &#123;<br>        // this.checkAllTodo(value)<br>        this.$emit(&quot;checkAllTodo&quot;, value);<br>      &#125;,<br>    &#125;,<br>  &#125;,<br>  methods: &#123;<br>    checkAll(e) &#123;<br>      // console.log(e.target.checked);<br>      this.checkAllTodo(e.target.checked);<br>    &#125;,<br>    clearAll() &#123;<br>      // this.clearAllTodo()<br>      this.$emit(&quot;clearAllTodo&quot;);<br>    &#125;,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>/*footer*/<br>.todo-footer &#123;<br>  height: 40px;<br>  line-height: 40px;<br>  padding-left: 6px;<br>  margin-top: 5px;<br>&#125;<br><br><br>.todo-footer label &#123;<br>  display: inline-block;<br>  margin-right: 20px;<br>  cursor: pointer;<br>&#125;<br><br><br>.todo-footer label input &#123;<br>  position: relative;<br>  top: -1px;<br>  vertical-align: middle;<br>  margin-right: 5px;<br>&#125;<br><br><br>.todo-footer button &#123;<br>  float: right;<br>  margin-top: 5px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>App.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div id=&quot;root&quot;&gt;<br>       <br>    &lt;div class=&quot;todo-container&quot;&gt;<br>           <br>      &lt;div class=&quot;todo-wrap&quot;&gt;<br>                &lt;MyHeader @addTodoObj=&quot;addTodoObj&quot; /&gt;        <br>        &lt;MyList<br>          :todos=&quot;todos&quot;<br>          :checkTodo=&quot;checkTodo&quot;<br>          :deleteTodoObj=&quot;deleteTodoObj&quot;<br>        /&gt;<br>               <br>        &lt;MyFooter<br>          :todos=&quot;todos&quot;<br>          @checkAllTodo=&quot;checkAllTodo&quot;<br>          @clearAllTodo=&quot;clearAllTodo&quot;<br>        /&gt;<br>             <br>      &lt;/div&gt;<br>         <br>    &lt;/div&gt;<br>     <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import MyHeader from &quot;./components/MyHeader.vue&quot;;<br>import MyList from &quot;./components/MyList.vue&quot;;<br>import MyFooter from &quot;./components/MyFooter.vue&quot;;<br><br>export default &#123;<br>  name: &quot;App&quot;,<br>  components: &#123;<br>    MyHeader,<br>    MyList,<br>    MyFooter,<br>  &#125;,<br>  data() &#123;<br>    return &#123;<br>      todos: JSON.parse(localStorage.getItem(&quot;todos&quot;)) || [],<br>    &#125;;<br>  &#125;,<br>  methods: &#123;<br>    addTodoObj(todoObj) &#123;<br>      this.todos.unshift(todoObj);<br>    &#125;,<br>    checkTodo(id) &#123;<br>      this.todos.forEach((todoObj) =&gt; &#123;<br>        if (todoObj.id === id) &#123;<br>          todoObj.done = !todoObj.done; // console.log(todoObj.done);<br>        &#125;<br>      &#125;);<br>    &#125;,<br>    deleteTodoObj(id) &#123;<br>      if (confirm(&quot;是否确定删除&quot;)) &#123;<br>        this.todos = this.todos.filter((todo) =&gt; &#123;<br>          return todo.id !== id;<br>        &#125;);<br>      &#125;<br>    &#125;,<br>    checkAllTodo(value) &#123;<br>      this.todos.forEach((todo) =&gt; &#123;<br>        todo.done = value;<br>      &#125;);<br>    &#125;,<br>    clearAllTodo() &#123;<br>      this.todos = this.todos.filter((todo) =&gt; &#123;<br>        return !todo.done;<br>      &#125;);<br>    &#125;,<br>  &#125;,<br>  watch: &#123;<br>    todos: &#123;<br>      deep: true,<br>      handler(value) &#123;<br>        localStorage.setItem(&quot;todos&quot;, JSON.stringify(value));<br>      &#125;,<br>    &#125;,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style&gt;<br>/*base*/<br>body &#123;<br>  background: #fff;<br>&#125;<br><br><br>.btn &#123;<br>  display: inline-block;<br>  padding: 4px 12px;<br>  margin-bottom: 0;<br>  font-size: 14px;<br>  line-height: 20px;<br>  text-align: center;<br>  vertical-align: middle;<br>  cursor: pointer;<br>  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.2),<br>    0 1px 2px rgba(0, 0, 0, 0.05);<br>  border-radius: 4px;<br>&#125;<br><br><br>.btn-danger &#123;<br>  color: #fff;<br>  background-color: #da4f49;<br>  border: 1px solid #bd362f;<br>&#125;<br><br><br>.btn-danger:hover &#123;<br>  color: #fff;<br>  background-color: #bd362f;<br>&#125;<br><br><br>.btn:focus &#123;<br>  outline: none;<br>&#125;<br><br><br>.todo-container &#123;<br>  width: 600px;<br>  margin: 0 auto;<br>&#125;<br>.todo-container .todo-wrap &#123;<br>  padding: 10px;<br>  border: 1px solid #ddd;<br>  border-radius: 5px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>main.js<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./App.vue&quot;</span>;<br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;<br><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br>  <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#app&quot;</span>,<br>  <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">h</span>) =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>),<br>&#125;);<br></code></pre></td></tr></table></figure>## 全局事件总线1.  一种组件间通信的方式，适用于任意组件间通信。2.  安装全局事件总线：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br>......<br><span class="hljs-title function_">beforeCreate</span>(<span class="hljs-params"></span>) &#123;<br><span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$bus</span> = <span class="hljs-variable language_">this</span> <span class="hljs-comment">//安装全局事件总线，$bus就是当前应用的vm</span><br>&#125;,<br>    ......<br>&#125;)<br></code></pre></td></tr></table></figure>3.  使用事件总线：1.  接收数据：A 组件想接收数据，则在 A 组件中给$bus 绑定自定义事件，事件的回调留在 A 组件自身。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title function_">methods</span>(<span class="hljs-params"></span>)&#123;<br>  <span class="hljs-title function_">demo</span>(<span class="hljs-params">data</span>)&#123;......&#125;<br>&#125;<br>......<br><span class="hljs-title function_">mounted</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">$bus</span>.$on(<span class="hljs-string">&#x27;xxxx&#x27;</span>,<span class="hljs-variable language_">this</span>.<span class="hljs-property">demo</span>)<br>&#125;<br></code></pre></td></tr></table></figure>2.  提供数据：`this.$bus.$emit('xxxx',数据)`3.  最好在 beforeDestroy 钩子中，用$off 去解绑当前组件所用到的事件。全局事件总线: 任意组件间通信![](assets/bca006de336c499bbf6a05376c038189.png)School.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;school&quot;&gt;<br>       <br>    &lt;h2&gt;学校名称: &#123;&#123; name &#125;&#125;&lt;/h2&gt;<br>       <br>    &lt;h2&gt;学校地址: &#123;&#123; address &#125;&#125;&lt;/h2&gt;<br>     <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>export default &#123;<br>  name: &quot;School&quot;,<br>  data() &#123;<br>    return &#123;<br>      name: &quot;尚硅谷&quot;,<br>      address: &quot;北京&quot;,<br>    &#125;;<br>  &#125;,<br>  mounted() &#123;<br>    // console.log(&#x27;School&#x27;, this.x);<br>    this.$bus.$on(&quot;hello&quot;, (data) =&gt; &#123;<br>      console.log(&quot;我是School组件，收到了数据&quot;, data);<br>    &#125;);<br>  &#125;,<br>  beforeDestroy() &#123;<br>    this.$bus.$off(&quot;bus&quot;);<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style lang=&quot;less&quot; scoped&gt;<br>.school &#123;<br>  background-color: lightpink;<br>  padding: 5px;<br>  margin-top: 30px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>Student.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;student&quot;&gt;<br>       <br>    &lt;h2&gt;学生姓名: &#123;&#123; name &#125;&#125;&lt;/h2&gt;<br>       <br>    &lt;h2&gt;学生性别: &#123;&#123; sex &#125;&#125;&lt;/h2&gt;<br>        &lt;button @click=&quot;sendStudentName&quot;&gt;把学生名给School组件&lt;/button&gt;  <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>export default &#123;<br>  name: &quot;Student&quot;,<br>  data() &#123;<br>    return &#123;<br>      name: &quot;张三&quot;,<br>      sex: &quot;男&quot;,<br>    &#125;;<br>  &#125;,<br>  methods: &#123;<br>    sendStudentName() &#123;<br>      // console.log(&quot;Student&quot;, this.x);<br>      this.$bus.$emit(&quot;hello&quot;, this.name);<br>    &#125;,<br>  &#125;, // mounted() &#123; //   console.log(&quot;Student&quot;, this.x); //   this.x.$on(&#x27;hello&#x27;, (data) =&gt; &#123; //     console.log(&#x27;我是School组件, 收到了数据&#x27;, data); //   &#125;) // &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>.student &#123;<br>  background-color: lightblue;<br>  padding: 5px;<br>  margin-top: 30px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>App.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;app&quot;&gt;<br>       <br>    &lt;h2&gt;&#123;&#123; msg &#125;&#125;&lt;/h2&gt;<br>        &lt;School /&gt;    <br>    &lt;hr /&gt;<br>        &lt;Student /&gt;  <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import Student from &quot;./components/Student.vue&quot;;<br>import School from &quot;./components/School.vue&quot;;<br><br>export default &#123;<br>  name: &quot;App&quot;,<br>  components: &#123;<br>    Student,<br>    School,<br>  &#125;,<br>  data() &#123;<br>    return &#123;<br>      msg: &quot;你好啊!&quot;,<br>    &#125;;<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>.app &#123;<br>  background-color: gray;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>main.js<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./App.vue&quot;</span>;<br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;<br><br><span class="hljs-comment">/* window.x = &#123;a: 1, b: 2&#125; */</span><br><br><span class="hljs-comment">/* Vue.prototype.x = &#123; a: 1, b: 2 &#125;</span><br><span class="hljs-comment">console.log(Vue.prototype); */</span><br><br><span class="hljs-comment">/* const Demo = Vue.extend(&#123;</span><br><span class="hljs-comment">    a: 1,</span><br><span class="hljs-comment">    b: 2</span><br><span class="hljs-comment">&#125;)</span><br><span class="hljs-comment">const d = new Demo()</span><br><span class="hljs-comment">Vue.prototype.x = d */</span><br><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br>  <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#app&quot;</span>,<br>  <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">h</span>) =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>),<br>  <span class="hljs-title function_">beforeCreate</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$bus</span> = <span class="hljs-variable language_">this</span>;<br>  &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure>### TodoList\_事件总线MyHeader.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;todo-header&quot;&gt;<br>       <br>    &lt;input<br>      type=&quot;text&quot;<br>      v-model=&quot;todoName&quot;<br>      @keyup.enter=&quot;add&quot;<br>      placeholder=&quot;请输入你的任务名称，按回车键确认&quot;<br>    /&gt;<br>     <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import &#123; nanoid &#125; from &quot;nanoid&quot;;<br>export default &#123;<br>  name: &quot;MyHeader&quot;, // props: [&quot;addTodoObj&quot;],<br>  data() &#123;<br>    return &#123;<br>      todoName: &quot;&quot;,<br>    &#125;;<br>  &#125;,<br>  methods: &#123;<br>    add() &#123;<br>      if (!this.todoName) &#123;<br>        alert(&quot;请输入点什么吧&quot;);<br>        return;<br>      &#125;<br>      const todoObj = &#123; id: nanoid(), title: this.todoName, done: false &#125;; // console.log(todoObj); // this.addTodoObj(todoObj);<br>      this.$emit(&quot;addTodoObj&quot;, todoObj);<br>      this.todoName = &quot;&quot;;<br>    &#125;,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>/*header*/<br>.todo-header input &#123;<br>  width: 560px;<br>  height: 28px;<br>  font-size: 14px;<br>  border: 1px solid #ccc;<br>  border-radius: 4px;<br>  padding: 4px 7px;<br>&#125;<br><br><br>.todo-header input:focus &#123;<br>  outline: none;<br>  border-color: rgba(82, 168, 236, 0.8);<br>  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075),<br>    0 0 8px rgba(82, 168, 236, 0.6);<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>MyList.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;ul class=&quot;todo-main&quot;&gt;<br>       <br>    &lt;MyItem v-for=&quot;todoObj in todos&quot; :key=&quot;todoObj.id&quot; :todoObj=&quot;todoObj&quot; /&gt;<br>     <br>  &lt;/ul&gt;<br>&lt;/template&gt;<br><br>&lt;script scoped&gt;<br>import MyItem from &quot;./MyItem.vue&quot;;<br>export default &#123;<br>  name: &quot;MyList&quot;,<br>  components: &#123;<br>    MyItem,<br>  &#125;,<br>  props: [&quot;todos&quot;],<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style&gt;<br>/*main*/<br>.todo-main &#123;<br>  margin-left: 0px;<br>  border: 1px solid #ddd;<br>  border-radius: 2px;<br>  padding: 0px;<br>&#125;<br><br><br>.todo-empty &#123;<br>  height: 40px;<br>  line-height: 40px;<br>  border: 1px solid #ddd;<br>  border-radius: 2px;<br>  padding-left: 5px;<br>  margin-top: 10px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>MyItem.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;li&gt;<br>       <br>    &lt;label&gt;<br>           <br>      &lt;input<br>        type=&quot;checkbox&quot;<br>        :checked=&quot;todoObj.done&quot;<br>        @change=&quot;handleCheck(todoObj.id)&quot;<br>      /&gt;<br>            &lt;span&gt;&#123;&#123; todoObj.title &#125;&#125;&lt;/span&gt;    <br>    &lt;/label&gt;<br>       <br>    &lt;!-- 如下代码也能实现功能，但是不太推荐，因为有点违反原则，因为修改了props --&gt;<br>       <br>    &lt;!-- &lt;input type=&quot;checkbox&quot; v-model=&quot;todoObj.done&quot;/&gt; --&gt;<br>       <br>    &lt;button class=&quot;btn btn-danger&quot; @click=&quot;handleDelete(todoObj.id)&quot;&gt;<br>            删除    <br>    &lt;/button&gt;<br>     <br>  &lt;/li&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>export default &#123;<br>  name: &quot;MyItem&quot;,<br>  props: [&quot;todoObj&quot;],<br>  data() &#123;<br>    return &#123;&#125;;<br>  &#125;,<br>  methods: &#123;<br>    handleCheck(id) &#123;<br>      // this.checkTodo(id);<br>      this.$bus.$emit(&quot;checkTodo&quot;, id);<br>    &#125;,<br>    handleDelete(id) &#123;<br>      // this.deleteTodoObj(id);<br><br>      this.$bus.$emit(&quot;deleteTodoObj&quot;, id);<br>    &#125;,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>/*item*/<br>li &#123;<br>  list-style: none;<br>  height: 36px;<br>  line-height: 36px;<br>  padding: 0 5px;<br>  border-bottom: 1px solid #ddd;<br>&#125;<br><br><br>li label &#123;<br>  float: left;<br>  cursor: pointer;<br>&#125;<br><br><br>li label li input &#123;<br>  vertical-align: middle;<br>  margin-right: 6px;<br>  position: relative;<br>  top: -1px;<br>&#125;<br><br><br>li button &#123;<br>  float: right;<br>  display: none;<br>  margin-top: 3px;<br>&#125;<br><br><br>li:before &#123;<br>  content: initial;<br>&#125;<br><br><br>li:last-child &#123;<br>  border-bottom: none;<br>&#125;<br><br><br>li:hover &#123;<br>  background-color: #ccc;<br>&#125;<br><br><br>li:hover button &#123;<br>  display: block;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>MyFoot.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;todo-footer&quot; v-show=&quot;total&quot;&gt;<br>       <br>    &lt;label&gt;<br>           <br>      &lt;!-- &lt;input type=&quot;checkbox&quot; :checked=&quot;isAll&quot; @change=&quot;checkAll&quot; /&gt; --&gt;<br>            &lt;input type=&quot;checkbox&quot; v-model=&quot;isAll&quot; /&gt;    <br>    &lt;/label&gt;<br>       <br>    &lt;span&gt;<br>            &lt;span&gt;已完成&#123;&#123; calcTodoTotal &#125;&#125;&lt;/span&gt; / 全部&#123;&#123; total &#125;&#125;    <br>    &lt;/span&gt;<br>       <br>    &lt;button class=&quot;btn btn-danger&quot; @click=&quot;clearAll&quot;&gt;清除已完成任务&lt;/button&gt;  <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>export default &#123;<br>  name: &quot;MyFooter&quot;,<br>  props: [&quot;todos&quot;],<br>  computed: &#123;<br>    // isAll() &#123;<br>    //   return this.total === this.calcTodoTotal &amp;&amp; this.total &gt; 0;<br>    // &#125;,<br>    total() &#123;<br>      return this.todos.length;<br>    &#125;,<br>    calcTodoTotal() &#123;<br>      /*       let i = 0<br>      this.todos.forEach((todo) =&gt; &#123;<br>        if (todo.done === true) i++<br>      &#125;);<br>      return i */<br>      /*       return this.todos.reduce((pre, current) =&gt; &#123;<br>        // console.log(current.done);<br>        return pre + (current.done ? 1 : 0)<br>      &#125;, 0) */<br>      return this.todos.reduce((pre, todo) =&gt; pre + (todo.done ? 1 : 0), 0);<br>    &#125;,<br>    isAll: &#123;<br>      get() &#123;<br>        return this.total === this.calcTodoTotal &amp;&amp; this.total &gt; 0;<br>      &#125;,<br>      set(value) &#123;<br>        // this.checkAllTodo(value)<br>        this.$emit(&quot;checkAllTodo&quot;, value);<br>      &#125;,<br>    &#125;,<br>  &#125;,<br>  methods: &#123;<br>    checkAll(e) &#123;<br>      // console.log(e.target.checked);<br>      this.checkAllTodo(e.target.checked);<br>    &#125;,<br>    clearAll() &#123;<br>      // this.clearAllTodo()<br>      this.$emit(&quot;clearAllTodo&quot;);<br>    &#125;,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>/*footer*/<br>.todo-footer &#123;<br>  height: 40px;<br>  line-height: 40px;<br>  padding-left: 6px;<br>  margin-top: 5px;<br>&#125;<br><br><br>.todo-footer label &#123;<br>  display: inline-block;<br>  margin-right: 20px;<br>  cursor: pointer;<br>&#125;<br><br><br>.todo-footer label input &#123;<br>  position: relative;<br>  top: -1px;<br>  vertical-align: middle;<br>  margin-right: 5px;<br>&#125;<br><br><br>.todo-footer button &#123;<br>  float: right;<br>  margin-top: 5px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>App.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div id=&quot;root&quot;&gt;<br>       <br>    &lt;div class=&quot;todo-container&quot;&gt;<br>           <br>      &lt;div class=&quot;todo-wrap&quot;&gt;<br>                &lt;MyHeader @addTodoObj=&quot;addTodoObj&quot; /&gt;        <br>        &lt;MyList :todos=&quot;todos&quot; /&gt;        <br>        &lt;MyFooter<br>          :todos=&quot;todos&quot;<br>          @checkAllTodo=&quot;checkAllTodo&quot;<br>          @clearAllTodo=&quot;clearAllTodo&quot;<br>        /&gt;<br>             <br>      &lt;/div&gt;<br>         <br>    &lt;/div&gt;<br>     <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import MyHeader from &quot;./components/MyHeader.vue&quot;;<br>import MyList from &quot;./components/MyList.vue&quot;;<br>import MyFooter from &quot;./components/MyFooter.vue&quot;;<br><br>export default &#123;<br>  name: &quot;App&quot;,<br>  components: &#123;<br>    MyHeader,<br>    MyList,<br>    MyFooter,<br>  &#125;,<br>  data() &#123;<br>    return &#123;<br>      todos: JSON.parse(localStorage.getItem(&quot;todos&quot;)) || [],<br>    &#125;;<br>  &#125;,<br>  methods: &#123;<br>    addTodoObj(todoObj) &#123;<br>      this.todos.unshift(todoObj);<br>    &#125;,<br>    checkTodo(id) &#123;<br>      this.todos.forEach((todoObj) =&gt; &#123;<br>        if (todoObj.id === id) &#123;<br>          todoObj.done = !todoObj.done; // console.log(todoObj.done);<br>        &#125;<br>      &#125;);<br>    &#125;,<br>    deleteTodoObj(id) &#123;<br>      if (confirm(&quot;是否确定删除&quot;)) &#123;<br>        this.todos = this.todos.filter((todo) =&gt; &#123;<br>          return todo.id !== id;<br>        &#125;);<br>      &#125;<br>    &#125;,<br>    checkAllTodo(value) &#123;<br>      this.todos.forEach((todo) =&gt; &#123;<br>        todo.done = value;<br>      &#125;);<br>    &#125;,<br>    clearAllTodo() &#123;<br>      this.todos = this.todos.filter((todo) =&gt; &#123;<br>        return !todo.done;<br>      &#125;);<br>    &#125;,<br>  &#125;,<br>  watch: &#123;<br>    todos: &#123;<br>      deep: true,<br>      handler(value) &#123;<br>        localStorage.setItem(&quot;todos&quot;, JSON.stringify(value));<br>      &#125;,<br>    &#125;,<br>  &#125;,<br>  mounted() &#123;<br>    this.$bus.$on(&quot;checkTodo&quot;, this.checkTodo);<br>    this.$bus.$on(&quot;deleteTodoObj&quot;, this.deleteTodoObj);<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style&gt;<br>/*base*/<br>body &#123;<br>  background: #fff;<br>&#125;<br><br><br>.btn &#123;<br>  display: inline-block;<br>  padding: 4px 12px;<br>  margin-bottom: 0;<br>  font-size: 14px;<br>  line-height: 20px;<br>  text-align: center;<br>  vertical-align: middle;<br>  cursor: pointer;<br>  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.2),<br>    0 1px 2px rgba(0, 0, 0, 0.05);<br>  border-radius: 4px;<br>&#125;<br><br><br>.btn-danger &#123;<br>  color: #fff;<br>  background-color: #da4f49;<br>  border: 1px solid #bd362f;<br>&#125;<br><br><br>.btn-danger:hover &#123;<br>  color: #fff;<br>  background-color: #bd362f;<br>&#125;<br><br><br>.btn:focus &#123;<br>  outline: none;<br>&#125;<br><br><br>.todo-container &#123;<br>  width: 600px;<br>  margin: 0 auto;<br>&#125;<br>.todo-container .todo-wrap &#123;<br>  padding: 10px;<br>  border: 1px solid #ddd;<br>  border-radius: 5px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>main.js<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./App.vue&quot;</span>;<br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;<br><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br>  <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#app&quot;</span>,<br>  <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">h</span>) =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>),<br>  <span class="hljs-title function_">beforeCreate</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$bus</span> = <span class="hljs-variable language_">this</span>;<br>  &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure>## 消息的订阅与发布1.  一种组件间通信的方式，适用于任意组件间通信。2.  使用步骤：3.  安装 pubsub：`npm i pubsub-js`4.  引入: `import pubsub from 'pubsub-js'`5.  接收数据：A 组件想接收数据，则在 A 组件中订阅消息，订阅的回调留在 A 组件自身。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title function_">methods</span>(<span class="hljs-params"></span>)&#123;<br>  <span class="hljs-title function_">demo</span>(<span class="hljs-params">data</span>)&#123;......&#125;<br>&#125;<br>......<br><span class="hljs-title function_">mounted</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">pid</span> = pubsub.<span class="hljs-title function_">subscribe</span>(<span class="hljs-string">&#x27;xxx&#x27;</span>,<span class="hljs-variable language_">this</span>.<span class="hljs-property">demo</span>) <span class="hljs-comment">//订阅消息</span><br>&#125;<br></code></pre></td></tr></table></figure>4.  提供数据：`pubsub.publish('xxx',数据)`5.  最好在 beforeDestroy 钩子中，用`PubSub.unsubscribe(pid)`去取消订阅。报纸订阅与发布 1.订阅报纸: 住址 2.邮递员送报纸: 报纸报纸订阅与发布 1.订阅消息: 消息名 2.发布消息: 消息内容![](assets/d47a46ac7346421d96aeb34075c2d848.png)安装 pubsub 库PS E:\Code\Vue\vue_test> npm i pubsub-jsadded 1 package in 3sSchool.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;school&quot;&gt;<br>       <br>    &lt;h2&gt;学校名称: &#123;&#123; name &#125;&#125;&lt;/h2&gt;<br>       <br>    &lt;h2&gt;学校地址: &#123;&#123; address &#125;&#125;&lt;/h2&gt;<br>     <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import pubsub from &quot;pubsub-js&quot;;<br>export default &#123;<br>  name: &quot;School&quot;,<br>  data() &#123;<br>    return &#123;<br>      name: &quot;尚硅谷&quot;,<br>      address: &quot;北京&quot;,<br>    &#125;;<br>  &#125;,<br>  mounted() &#123;<br>    pubsub.subscribe(&quot;hello&quot;, function (msgName, data) &#123;<br>      console.log(&quot;有人发布了hello消息, hello下次的回调执行了&quot;, msgName, data);<br>    &#125;);<br>  &#125;,<br>  beforeDestroy() &#123;&#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style lang=&quot;less&quot; scoped&gt;<br>.school &#123;<br>  background-color: lightpink;<br>  padding: 5px;<br>  margin-top: 30px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>Student.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;student&quot;&gt;<br>       <br>    &lt;h2&gt;学生姓名: &#123;&#123; name &#125;&#125;&lt;/h2&gt;<br>       <br>    &lt;h2&gt;学生性别: &#123;&#123; sex &#125;&#125;&lt;/h2&gt;<br>        &lt;button @click=&quot;sendStudentName&quot;&gt;把学生名给School组件&lt;/button&gt;  <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import pubsub from &quot;pubsub-js&quot;;<br>export default &#123;<br>  name: &quot;Student&quot;,<br>  data() &#123;<br>    return &#123;<br>      name: &quot;张三&quot;,<br>      sex: &quot;男&quot;,<br>    &#125;;<br>  &#125;,<br>  methods: &#123;<br>    sendStudentName() &#123;<br>      pubsub.publish(&quot;hello&quot;, 666);<br>    &#125;,<br>  &#125;,<br>  mounted() &#123;&#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>.student &#123;<br>  background-color: lightblue;<br>  padding: 5px;<br>  margin-top: 30px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>App.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;app&quot;&gt;<br>       <br>    &lt;h2&gt;&#123;&#123; msg &#125;&#125;&lt;/h2&gt;<br>        &lt;School /&gt;     &lt;Student /&gt;  <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import Student from &quot;./components/Student.vue&quot;;<br>import School from &quot;./components/School.vue&quot;;<br><br>export default &#123;<br>  name: &quot;App&quot;,<br>  components: &#123;<br>    Student,<br>    School,<br>  &#125;,<br>  data() &#123;<br>    return &#123;<br>      msg: &quot;你好啊!&quot;,<br>    &#125;;<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>.app &#123;<br>  background-color: gray;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>main.js<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./App.vue&quot;</span>;<br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;<br><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br>  <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#app&quot;</span>,<br>  <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">h</span>) =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>),<br>&#125;);<br></code></pre></td></tr></table></figure>### TodoList_pubsubMyHeader.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;todo-header&quot;&gt;<br>       <br>    &lt;input<br>      type=&quot;text&quot;<br>      v-model=&quot;todoName&quot;<br>      @keyup.enter=&quot;add&quot;<br>      placeholder=&quot;请输入你的任务名称，按回车键确认&quot;<br>    /&gt;<br>     <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import &#123; nanoid &#125; from &quot;nanoid&quot;;<br>export default &#123;<br>  name: &quot;MyHeader&quot;, // props: [&quot;addTodoObj&quot;],<br>  data() &#123;<br>    return &#123;<br>      todoName: &quot;&quot;,<br>    &#125;;<br>  &#125;,<br>  methods: &#123;<br>    add() &#123;<br>      if (!this.todoName) &#123;<br>        alert(&quot;请输入点什么吧&quot;);<br>        return;<br>      &#125;<br>      const todoObj = &#123; id: nanoid(), title: this.todoName, done: false &#125;; // console.log(todoObj); // this.addTodoObj(todoObj);<br>      this.$emit(&quot;addTodoObj&quot;, todoObj);<br>      this.todoName = &quot;&quot;;<br>    &#125;,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>/*header*/<br>.todo-header input &#123;<br>  width: 560px;<br>  height: 28px;<br>  font-size: 14px;<br>  border: 1px solid #ccc;<br>  border-radius: 4px;<br>  padding: 4px 7px;<br>&#125;<br><br><br>.todo-header input:focus &#123;<br>  outline: none;<br>  border-color: rgba(82, 168, 236, 0.8);<br>  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075),<br>    0 0 8px rgba(82, 168, 236, 0.6);<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>MyList.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;ul class=&quot;todo-main&quot;&gt;<br>       <br>    &lt;MyItem v-for=&quot;todoObj in todos&quot; :key=&quot;todoObj.id&quot; :todoObj=&quot;todoObj&quot; /&gt;<br>     <br>  &lt;/ul&gt;<br>&lt;/template&gt;<br><br>&lt;script scoped&gt;<br>import MyItem from &quot;./MyItem.vue&quot;;<br>export default &#123;<br>  name: &quot;MyList&quot;,<br>  components: &#123;<br>    MyItem,<br>  &#125;,<br>  props: [&quot;todos&quot;],<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style&gt;<br>/*main*/<br>.todo-main &#123;<br>  margin-left: 0px;<br>  border: 1px solid #ddd;<br>  border-radius: 2px;<br>  padding: 0px;<br>&#125;<br><br><br>.todo-empty &#123;<br>  height: 40px;<br>  line-height: 40px;<br>  border: 1px solid #ddd;<br>  border-radius: 2px;<br>  padding-left: 5px;<br>  margin-top: 10px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>MyItem.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;li&gt;<br>       <br>    &lt;label&gt;<br>           <br>      &lt;input<br>        type=&quot;checkbox&quot;<br>        :checked=&quot;todoObj.done&quot;<br>        @change=&quot;handleCheck(todoObj.id)&quot;<br>      /&gt;<br>            &lt;span&gt;&#123;&#123; todoObj.title &#125;&#125;&lt;/span&gt;    <br>    &lt;/label&gt;<br>       <br>    &lt;!-- 如下代码也能实现功能，但是不太推荐，因为有点违反原则，因为修改了props --&gt;<br>       <br>    &lt;!-- &lt;input type=&quot;checkbox&quot; v-model=&quot;todoObj.done&quot;/&gt; --&gt;<br>       <br>    &lt;button class=&quot;btn btn-danger&quot; @click=&quot;handleDelete(todoObj.id)&quot;&gt;<br>            删除    <br>    &lt;/button&gt;<br>     <br>  &lt;/li&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import pubsub from &quot;pubsub-js&quot;;<br>export default &#123;<br>  name: &quot;MyItem&quot;,<br>  props: [&quot;todoObj&quot;],<br>  data() &#123;<br>    return &#123;&#125;;<br>  &#125;,<br>  methods: &#123;<br>    handleCheck(id) &#123;<br>      // this.checkTodo(id);<br>      this.$bus.$emit(&quot;checkTodo&quot;, id);<br>    &#125;,<br>    handleDelete(id) &#123;<br>      // this.deleteTodoObj(id);<br>      // this.$bus.$emit(&quot;deleteTodoObj&quot;, id);<br>      pubsub.publish(&quot;deleteTodoObj&quot;, id);<br>    &#125;,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>/*item*/<br>li &#123;<br>  list-style: none;<br>  height: 36px;<br>  line-height: 36px;<br>  padding: 0 5px;<br>  border-bottom: 1px solid #ddd;<br>&#125;<br><br><br>li label &#123;<br>  float: left;<br>  cursor: pointer;<br>&#125;<br><br><br>li label li input &#123;<br>  vertical-align: middle;<br>  margin-right: 6px;<br>  position: relative;<br>  top: -1px;<br>&#125;<br><br><br>li button &#123;<br>  float: right;<br>  display: none;<br>  margin-top: 3px;<br>&#125;<br><br><br>li:before &#123;<br>  content: initial;<br>&#125;<br><br><br>li:last-child &#123;<br>  border-bottom: none;<br>&#125;<br><br><br>li:hover &#123;<br>  background-color: #ccc;<br>&#125;<br><br><br>li:hover button &#123;<br>  display: block;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>MyFooter.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;todo-footer&quot; v-show=&quot;total&quot;&gt;<br>       <br>    &lt;label&gt;<br>           <br>      &lt;!-- &lt;input type=&quot;checkbox&quot; :checked=&quot;isAll&quot; @change=&quot;checkAll&quot; /&gt; --&gt;<br>            &lt;input type=&quot;checkbox&quot; v-model=&quot;isAll&quot; /&gt;    <br>    &lt;/label&gt;<br>       <br>    &lt;span&gt;<br>            &lt;span&gt;已完成&#123;&#123; calcTodoTotal &#125;&#125;&lt;/span&gt; / 全部&#123;&#123; total &#125;&#125;    <br>    &lt;/span&gt;<br>       <br>    &lt;button class=&quot;btn btn-danger&quot; @click=&quot;clearAll&quot;&gt;清除已完成任务&lt;/button&gt;  <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>export default &#123;<br>  name: &quot;MyFooter&quot;,<br>  props: [&quot;todos&quot;],<br>  computed: &#123;<br>    // isAll() &#123;<br>    //   return this.total === this.calcTodoTotal &amp;&amp; this.total &gt; 0;<br>    // &#125;,<br>    total() &#123;<br>      return this.todos.length;<br>    &#125;,<br>    calcTodoTotal() &#123;<br>      /*       let i = 0<br>      this.todos.forEach((todo) =&gt; &#123;<br>        if (todo.done === true) i++<br>      &#125;);<br>      return i */<br>      /*       return this.todos.reduce((pre, current) =&gt; &#123;<br>        // console.log(current.done);<br>        return pre + (current.done ? 1 : 0)<br>      &#125;, 0) */<br>      return this.todos.reduce((pre, todo) =&gt; pre + (todo.done ? 1 : 0), 0);<br>    &#125;,<br>    isAll: &#123;<br>      get() &#123;<br>        return this.total === this.calcTodoTotal &amp;&amp; this.total &gt; 0;<br>      &#125;,<br>      set(value) &#123;<br>        // this.checkAllTodo(value)<br>        this.$emit(&quot;checkAllTodo&quot;, value);<br>      &#125;,<br>    &#125;,<br>  &#125;,<br>  methods: &#123;<br>    checkAll(e) &#123;<br>      // console.log(e.target.checked);<br>      this.checkAllTodo(e.target.checked);<br>    &#125;,<br>    clearAll() &#123;<br>      // this.clearAllTodo()<br>      this.$emit(&quot;clearAllTodo&quot;);<br>    &#125;,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>/*footer*/<br>.todo-footer &#123;<br>  height: 40px;<br>  line-height: 40px;<br>  padding-left: 6px;<br>  margin-top: 5px;<br>&#125;<br><br><br>.todo-footer label &#123;<br>  display: inline-block;<br>  margin-right: 20px;<br>  cursor: pointer;<br>&#125;<br><br><br>.todo-footer label input &#123;<br>  position: relative;<br>  top: -1px;<br>  vertical-align: middle;<br>  margin-right: 5px;<br>&#125;<br><br><br>.todo-footer button &#123;<br>  float: right;<br>  margin-top: 5px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>App.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div id=&quot;root&quot;&gt;<br>       <br>    &lt;div class=&quot;todo-container&quot;&gt;<br>           <br>      &lt;div class=&quot;todo-wrap&quot;&gt;<br>                &lt;MyHeader @addTodoObj=&quot;addTodoObj&quot; /&gt;        <br>        &lt;MyList :todos=&quot;todos&quot; /&gt;        <br>        &lt;MyFooter<br>          :todos=&quot;todos&quot;<br>          @checkAllTodo=&quot;checkAllTodo&quot;<br>          @clearAllTodo=&quot;clearAllTodo&quot;<br>        /&gt;<br>             <br>      &lt;/div&gt;<br>         <br>    &lt;/div&gt;<br>     <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import pubsub from &quot;pubsub-js&quot;;<br>import MyHeader from &quot;./components/MyHeader.vue&quot;;<br>import MyList from &quot;./components/MyList.vue&quot;;<br>import MyFooter from &quot;./components/MyFooter.vue&quot;;<br><br>export default &#123;<br>  name: &quot;App&quot;,<br>  components: &#123;<br>    MyHeader,<br>    MyList,<br>    MyFooter,<br>  &#125;,<br>  data() &#123;<br>    return &#123;<br>      todos: JSON.parse(localStorage.getItem(&quot;todos&quot;)) || [],<br>    &#125;;<br>  &#125;,<br>  methods: &#123;<br>    addTodoObj(todoObj) &#123;<br>      this.todos.unshift(todoObj);<br>    &#125;,<br>    checkTodo(id) &#123;<br>      this.todos.forEach((todoObj) =&gt; &#123;<br>        if (todoObj.id === id) &#123;<br>          todoObj.done = !todoObj.done; // console.log(todoObj.done);<br>        &#125;<br>      &#125;);<br>    &#125;, // 下划线只是用来占位的, _表示订阅名<br>    deleteTodoObj(_, id) &#123;<br>      if (confirm(&quot;是否确定删除&quot;)) &#123;<br>        this.todos = this.todos.filter((todo) =&gt; &#123;<br>          return todo.id !== id;<br>        &#125;);<br>      &#125;<br>    &#125;,<br>    checkAllTodo(value) &#123;<br>      this.todos.forEach((todo) =&gt; &#123;<br>        todo.done = value;<br>      &#125;);<br>    &#125;,<br>    clearAllTodo() &#123;<br>      this.todos = this.todos.filter((todo) =&gt; &#123;<br>        return !todo.done;<br>      &#125;);<br>    &#125;,<br>  &#125;,<br>  watch: &#123;<br>    todos: &#123;<br>      deep: true,<br>      handler(value) &#123;<br>        localStorage.setItem(&quot;todos&quot;, JSON.stringify(value));<br>      &#125;,<br>    &#125;,<br>  &#125;,<br>  mounted() &#123;<br>    this.$bus.$on(&quot;checkTodo&quot;, this.checkTodo); // this.$bus.$on(&#x27;deleteTodoObj&#x27;, this.deleteTodoObj)<br>    this.pubId = pubsub.subscribe(&quot;deleteTodoObj&quot;, this.deleteTodoObj);<br>  &#125;,<br>  beforeDestroy() &#123;<br>    pubsub.unsubscribe(this.pubId);<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style&gt;<br>/*base*/<br>body &#123;<br>  background: #fff;<br>&#125;<br><br><br>.btn &#123;<br>  display: inline-block;<br>  padding: 4px 12px;<br>  margin-bottom: 0;<br>  font-size: 14px;<br>  line-height: 20px;<br>  text-align: center;<br>  vertical-align: middle;<br>  cursor: pointer;<br>  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.2),<br>    0 1px 2px rgba(0, 0, 0, 0.05);<br>  border-radius: 4px;<br>&#125;<br><br><br>.btn-danger &#123;<br>  color: #fff;<br>  background-color: #da4f49;<br>  border: 1px solid #bd362f;<br>&#125;<br><br><br>.btn-danger:hover &#123;<br>  color: #fff;<br>  background-color: #bd362f;<br>&#125;<br><br><br>.btn:focus &#123;<br>  outline: none;<br>&#125;<br><br><br>.todo-container &#123;<br>  width: 600px;<br>  margin: 0 auto;<br>&#125;<br>.todo-container .todo-wrap &#123;<br>  padding: 10px;<br>  border: 1px solid #ddd;<br>  border-radius: 5px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>main.js<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./App.vue&quot;</span>;<br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;<br><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br>  <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#app&quot;</span>,<br>  <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">h</span>) =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>),<br>  <span class="hljs-title function_">beforeCreate</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$bus</span> = <span class="hljs-variable language_">this</span>;<br>  &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure>## TodoList_nextTick1. 语法：`this.$nextTick(回调函数)`2. 作用：在下一次 DOM 更新结束后执行其指定的回调。3. 什么时候用：当改变数据后，要基于更新后的新 DOM 进行某些操作时，要在 nextTick 所指定的回调函数中执行。MyHeader.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;todo-header&quot;&gt;<br>       <br>    &lt;input<br>      type=&quot;text&quot;<br>      v-model=&quot;todoName&quot;<br>      @keyup.enter=&quot;add&quot;<br>      placeholder=&quot;请输入你的任务名称，按回车键确认&quot;<br>    /&gt;<br>     <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import &#123; nanoid &#125; from &quot;nanoid&quot;;<br>export default &#123;<br>  name: &quot;MyHeader&quot;, // props: [&quot;addTodoObj&quot;],<br>  data() &#123;<br>    return &#123;<br>      todoName: &quot;&quot;,<br>    &#125;;<br>  &#125;,<br>  methods: &#123;<br>    add() &#123;<br>      if (!this.todoName) &#123;<br>        alert(&quot;请输入点什么吧&quot;);<br>        return;<br>      &#125;<br>      const todoObj = &#123; id: nanoid(), title: this.todoName, done: false &#125;; // console.log(todoObj); // this.addTodoObj(todoObj);<br>      this.$emit(&quot;addTodoObj&quot;, todoObj);<br>      this.todoName = &quot;&quot;;<br>    &#125;,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>/*header*/<br>.todo-header input &#123;<br>  width: 560px;<br>  height: 28px;<br>  font-size: 14px;<br>  border: 1px solid #ccc;<br>  border-radius: 4px;<br>  padding: 4px 7px;<br>&#125;<br><br><br>.todo-header input:focus &#123;<br>  outline: none;<br>  border-color: rgba(82, 168, 236, 0.8);<br>  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075),<br>    0 0 8px rgba(82, 168, 236, 0.6);<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>MyList.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;ul class=&quot;todo-main&quot;&gt;<br>       <br>    &lt;MyItem v-for=&quot;todoObj in todos&quot; :key=&quot;todoObj.id&quot; :todoObj=&quot;todoObj&quot; /&gt;<br>     <br>  &lt;/ul&gt;<br>&lt;/template&gt;<br><br>&lt;script scoped&gt;<br>import MyItem from &quot;./MyItem.vue&quot;;<br>export default &#123;<br>  name: &quot;MyList&quot;,<br>  components: &#123;<br>    MyItem,<br>  &#125;,<br>  props: [&quot;todos&quot;],<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style&gt;<br>/*main*/<br>.todo-main &#123;<br>  margin-left: 0px;<br>  border: 1px solid #ddd;<br>  border-radius: 2px;<br>  padding: 0px;<br>&#125;<br><br><br>.todo-empty &#123;<br>  height: 40px;<br>  line-height: 40px;<br>  border: 1px solid #ddd;<br>  border-radius: 2px;<br>  padding-left: 5px;<br>  margin-top: 10px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>MyItem.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;li&gt;<br>       <br>    &lt;label&gt;<br>           <br>      &lt;input<br>        type=&quot;checkbox&quot;<br>        :checked=&quot;todoObj.done&quot;<br>        @change=&quot;handleCheck(todoObj.id)&quot;<br>      /&gt;<br>            &lt;span v-show=&quot;!todoObj.isEdit&quot;&gt;&#123;&#123; todoObj.title &#125;&#125;&lt;/span&gt;      <br>      &lt;input<br>        v-show=&quot;todoObj.isEdit&quot;<br>        type=&quot;text&quot;<br>        :value=&quot;todoObj.title&quot;<br>        @blur=&quot;handleBlur(todoObj, $event)&quot;<br>        ref=&quot;inputTitle&quot;<br>      /&gt;<br>         <br>    &lt;/label&gt;<br>       <br>    &lt;!-- 如下代码也能实现功能，但是不太推荐，因为有点违反原则，因为修改了props --&gt;<br>       <br>    &lt;!-- &lt;input type=&quot;checkbox&quot; v-model=&quot;todoObj.done&quot;/&gt; --&gt;<br>       <br>    &lt;button class=&quot;btn btn-danger&quot; @click=&quot;handleDelete(todoObj.id)&quot;&gt;<br>            删除    <br>    &lt;/button&gt;<br>       <br>    &lt;button<br>      class=&quot;btn btn-edit&quot;<br>      @click=&quot;handleEdit(todoObj)&quot;<br>      v-show=&quot;!todoObj.isEdit&quot;<br>    &gt;<br>            编辑    <br>    &lt;/button&gt;<br>     <br>  &lt;/li&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import pubsub from &quot;pubsub-js&quot;;<br>export default &#123;<br>  name: &quot;MyItem&quot;,<br>  props: [&quot;todoObj&quot;],<br>  data() &#123;<br>    return &#123;&#125;;<br>  &#125;,<br>  methods: &#123;<br>    handleCheck(id) &#123;<br>      // this.checkTodo(id);<br>      this.$bus.$emit(&quot;checkTodo&quot;, id);<br>    &#125;,<br>    handleDelete(id) &#123;<br>      // this.deleteTodoObj(id);<br>      // this.$bus.$emit(&quot;deleteTodoObj&quot;, id);<br>      pubsub.publish(&quot;deleteTodoObj&quot;, id);<br>    &#125;, //编辑<br>    handleEdit(todoObj) &#123;<br>      if (todoObj.hasOwnProperty(&quot;isEdit&quot;)) &#123;<br>        todoObj.isEdit = true;<br>      &#125; else &#123;<br>        this.$set(todoObj, &quot;isEdit&quot;, true);<br>      &#125; /* setTimeout(() =&gt; &#123; // 设置定时器<br>        this.$refs.inputTitle.focus();<br>      &#125;, 200); */ /* setTimeout(() =&gt; &#123; // 不正规写法(定时器里面不写时间)<br>        this.$refs.inputTitle.focus();<br>      &#125;); */<br><br>      this.$nextTick(function () &#123;<br>        this.$refs.inputTitle.focus();<br>      &#125;);<br>    &#125;, //失去焦点回调（真正执行修改逻辑）<br>    handleBlur(todoObj, e) &#123;<br>      todoObj.isEdit = false;<br>      if (!e.target.value.trim()) &#123;<br>        return alert(&quot;输入不能为空&quot;);<br>      &#125; // console.log(e.target.value);<br><br>      this.todoObj.title = e.target.value;<br>    &#125;,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>/*item*/<br>li &#123;<br>  list-style: none;<br>  height: 36px;<br>  line-height: 36px;<br>  padding: 0 5px;<br>  border-bottom: 1px solid #ddd;<br>&#125;<br><br><br>li label &#123;<br>  float: left;<br>  cursor: pointer;<br>&#125;<br><br><br>li label li input &#123;<br>  vertical-align: middle;<br>  margin-right: 6px;<br>  position: relative;<br>  top: -1px;<br>&#125;<br><br><br>li button &#123;<br>  float: right;<br>  display: none;<br>  margin-top: 3px;<br>&#125;<br><br><br>li:before &#123;<br>  content: initial;<br>&#125;<br><br><br>li:last-child &#123;<br>  border-bottom: none;<br>&#125;<br><br><br>li:hover &#123;<br>  background-color: #ccc;<br>&#125;<br><br><br>li:hover button &#123;<br>  display: block;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>MyFooter.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;todo-footer&quot; v-show=&quot;total&quot;&gt;<br>       <br>    &lt;label&gt;<br>           <br>      &lt;!-- &lt;input type=&quot;checkbox&quot; :checked=&quot;isAll&quot; @change=&quot;checkAll&quot; /&gt; --&gt;<br>            &lt;input type=&quot;checkbox&quot; v-model=&quot;isAll&quot; /&gt;    <br>    &lt;/label&gt;<br>       <br>    &lt;span&gt;<br>            &lt;span&gt;已完成&#123;&#123; calcTodoTotal &#125;&#125;&lt;/span&gt; / 全部&#123;&#123; total &#125;&#125;    <br>    &lt;/span&gt;<br>       <br>    &lt;button class=&quot;btn btn-danger&quot; @click=&quot;clearAll&quot;&gt;清除已完成任务&lt;/button&gt;  <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>export default &#123;<br>  name: &quot;MyFooter&quot;,<br>  props: [&quot;todos&quot;],<br>  computed: &#123;<br>    // isAll() &#123;<br>    //   return this.total === this.calcTodoTotal &amp;&amp; this.total &gt; 0;<br>    // &#125;,<br>    total() &#123;<br>      return this.todos.length;<br>    &#125;,<br>    calcTodoTotal() &#123;<br>      /*       let i = 0<br>      this.todos.forEach((todo) =&gt; &#123;<br>        if (todo.done === true) i++<br>      &#125;);<br>      return i */<br>      /*       return this.todos.reduce((pre, current) =&gt; &#123;<br>        // console.log(current.done);<br>        return pre + (current.done ? 1 : 0)<br>      &#125;, 0) */<br>      return this.todos.reduce((pre, todo) =&gt; pre + (todo.done ? 1 : 0), 0);<br>    &#125;,<br>    isAll: &#123;<br>      get() &#123;<br>        return this.total === this.calcTodoTotal &amp;&amp; this.total &gt; 0;<br>      &#125;,<br>      set(value) &#123;<br>        // this.checkAllTodo(value)<br>        this.$emit(&quot;checkAllTodo&quot;, value);<br>      &#125;,<br>    &#125;,<br>  &#125;,<br>  methods: &#123;<br>    checkAll(e) &#123;<br>      // console.log(e.target.checked);<br>      this.checkAllTodo(e.target.checked);<br>    &#125;,<br>    clearAll() &#123;<br>      // this.clearAllTodo()<br>      this.$emit(&quot;clearAllTodo&quot;);<br>    &#125;,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>/*footer*/<br>.todo-footer &#123;<br>  height: 40px;<br>  line-height: 40px;<br>  padding-left: 6px;<br>  margin-top: 5px;<br>&#125;<br><br><br>.todo-footer label &#123;<br>  display: inline-block;<br>  margin-right: 20px;<br>  cursor: pointer;<br>&#125;<br><br><br>.todo-footer label input &#123;<br>  position: relative;<br>  top: -1px;<br>  vertical-align: middle;<br>  margin-right: 5px;<br>&#125;<br><br><br>.todo-footer button &#123;<br>  float: right;<br>  margin-top: 5px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>App.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div id=&quot;root&quot;&gt;<br>       <br>    &lt;div class=&quot;todo-container&quot;&gt;<br>           <br>      &lt;div class=&quot;todo-wrap&quot;&gt;<br>                &lt;MyHeader @addTodoObj=&quot;addTodoObj&quot; /&gt;        <br>        &lt;MyList :todos=&quot;todos&quot; /&gt;        <br>        &lt;MyFooter<br>          :todos=&quot;todos&quot;<br>          @checkAllTodo=&quot;checkAllTodo&quot;<br>          @clearAllTodo=&quot;clearAllTodo&quot;<br>        /&gt;<br>             <br>      &lt;/div&gt;<br>         <br>    &lt;/div&gt;<br>     <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import pubsub from &quot;pubsub-js&quot;;<br>import MyHeader from &quot;./components/MyHeader.vue&quot;;<br>import MyList from &quot;./components/MyList.vue&quot;;<br>import MyFooter from &quot;./components/MyFooter.vue&quot;;<br><br>export default &#123;<br>  name: &quot;App&quot;,<br>  components: &#123;<br>    MyHeader,<br>    MyList,<br>    MyFooter,<br>  &#125;,<br>  data() &#123;<br>    return &#123;<br>      todos: JSON.parse(localStorage.getItem(&quot;todos&quot;)) || [],<br>    &#125;;<br>  &#125;,<br>  methods: &#123;<br>    addTodoObj(todoObj) &#123;<br>      this.todos.unshift(todoObj);<br>    &#125;,<br>    checkTodo(id) &#123;<br>      this.todos.forEach((todoObj) =&gt; &#123;<br>        if (todoObj.id === id) &#123;<br>          todoObj.done = !todoObj.done; // console.log(todoObj.done);<br>        &#125;<br>      &#125;);<br>    &#125;, // 下划线只是用来占位的, _表示订阅名<br>    deleteTodoObj(_, id) &#123;<br>      if (confirm(&quot;是否确定删除&quot;)) &#123;<br>        this.todos = this.todos.filter((todo) =&gt; &#123;<br>          return todo.id !== id;<br>        &#125;);<br>      &#125;<br>    &#125;,<br>    checkAllTodo(value) &#123;<br>      this.todos.forEach((todo) =&gt; &#123;<br>        todo.done = value;<br>      &#125;);<br>    &#125;,<br>    clearAllTodo() &#123;<br>      this.todos = this.todos.filter((todo) =&gt; &#123;<br>        return !todo.done;<br>      &#125;);<br>    &#125;,<br>  &#125;,<br>  watch: &#123;<br>    todos: &#123;<br>      deep: true,<br>      handler(value) &#123;<br>        localStorage.setItem(&quot;todos&quot;, JSON.stringify(value));<br>      &#125;,<br>    &#125;,<br>  &#125;,<br>  mounted() &#123;<br>    this.$bus.$on(&quot;checkTodo&quot;, this.checkTodo); // this.$bus.$on(&#x27;deleteTodoObj&#x27;, this.deleteTodoObj)<br>    this.pubId = pubsub.subscribe(&quot;deleteTodoObj&quot;, this.deleteTodoObj);<br>  &#125;,<br>  beforeDestroy() &#123;<br>    pubsub.unsubscribe(this.pubId);<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style&gt;<br>/*base*/<br>body &#123;<br>  background: #fff;<br>&#125;<br><br><br>.btn &#123;<br>  display: inline-block;<br>  padding: 4px 12px;<br>  margin-bottom: 0;<br>  font-size: 14px;<br>  line-height: 20px;<br>  text-align: center;<br>  vertical-align: middle;<br>  cursor: pointer;<br>  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.2),<br>    0 1px 2px rgba(0, 0, 0, 0.05);<br>  border-radius: 4px;<br>&#125;<br><br><br>.btn-danger &#123;<br>  color: #fff;<br>  background-color: #da4f49;<br>  border: 1px solid #bd362f;<br>&#125;<br><br><br>.btn-edit &#123;<br>  color: #fff;<br>  background-color: skyblue;<br>  border: 1px solid rgb(103, 159, 180);<br>  margin-right: 5px;<br>&#125;<br><br><br>.btn-danger:hover &#123;<br>  color: #fff;<br>  background-color: #bd362f;<br>&#125;<br><br><br>.btn:focus &#123;<br>  outline: none;<br>&#125;<br><br><br>.todo-container &#123;<br>  width: 600px;<br>  margin: 0 auto;<br>&#125;<br>.todo-container .todo-wrap &#123;<br>  padding: 10px;<br>  border: 1px solid #ddd;<br>  border-radius: 5px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>main.js<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./App.vue&quot;</span>;<br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;<br><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br>  <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#app&quot;</span>,<br>  <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">h</span>) =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>),<br>  <span class="hljs-title function_">beforeCreate</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$bus</span> = <span class="hljs-variable language_">this</span>;<br>  &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure>## 动画1.  作用：在插入、更新或移除 DOM 元素时，在合适的时候给元素添加样式类名。2.  图示：![](assets/1de78c69cfcb4fc0916e65adfd2e7160.png)3.  写法：4.  准备好样式：      - 元素进入的样式：         1. v-enter：进入的起点         2. v-enter-active：进入过程中         3. v-enter-to：进入的终点      - 元素离开的样式：         1. v-leave：离开的起点         2. v-leave-active：离开过程中         3. v-leave-to：离开的终点1.  使用`<transition>`包裹要过度的元素，并配置 name 属性：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;transition name=&quot;hello&quot;&gt;<br>&lt;h1 v-show=&quot;isShow&quot;&gt;你好啊！&lt;/h1&gt;<br>&lt;/transition&gt;<br></code></pre></td></tr></table></figure>2.  备注：若有多个元素需要过度，则需要使用：`<transition-group>`，且每个元素都要指定`key`值。集成第三方动画$ npm install animate.css --savemain.js<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./App.vue&quot;</span>;<br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;<br><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br>  <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#app&quot;</span>,<br>  <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">h</span>) =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>),<br>  <span class="hljs-title function_">beforeCreate</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$bus</span> = <span class="hljs-variable language_">this</span>;<br>  &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure>App.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div id=&quot;root&quot;&gt;<br>       <br>    &lt;div class=&quot;todo-container&quot;&gt;<br>           <br>      &lt;div class=&quot;todo-wrap&quot;&gt;<br>                &lt;MyHeader @addTodoObj=&quot;addTodoObj&quot; /&gt;        <br>        &lt;MyList :todos=&quot;todos&quot; /&gt;        <br>        &lt;MyFooter<br>          :todos=&quot;todos&quot;<br>          @checkAllTodo=&quot;checkAllTodo&quot;<br>          @clearAllTodo=&quot;clearAllTodo&quot;<br>        /&gt;<br>             <br>      &lt;/div&gt;<br>         <br>    &lt;/div&gt;<br>     <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import pubsub from &quot;pubsub-js&quot;;<br>import MyHeader from &quot;./components/MyHeader.vue&quot;;<br>import MyList from &quot;./components/MyList.vue&quot;;<br>import MyFooter from &quot;./components/MyFooter.vue&quot;;<br><br>export default &#123;<br>  name: &quot;App&quot;,<br>  components: &#123;<br>    MyHeader,<br>    MyList,<br>    MyFooter,<br>  &#125;,<br>  data() &#123;<br>    return &#123;<br>      todos: JSON.parse(localStorage.getItem(&quot;todos&quot;)) || [],<br>    &#125;;<br>  &#125;,<br>  methods: &#123;<br>    addTodoObj(todoObj) &#123;<br>      this.todos.unshift(todoObj);<br>    &#125;,<br>    checkTodo(id) &#123;<br>      this.todos.forEach((todoObj) =&gt; &#123;<br>        if (todoObj.id === id) &#123;<br>          todoObj.done = !todoObj.done; // console.log(todoObj.done);<br>        &#125;<br>      &#125;);<br>    &#125;, // 下划线只是用来占位的, _表示订阅名<br>    deleteTodoObj(_, id) &#123;<br>      if (confirm(&quot;是否确定删除&quot;)) &#123;<br>        this.todos = this.todos.filter((todo) =&gt; &#123;<br>          return todo.id !== id;<br>        &#125;);<br>      &#125;<br>    &#125;,<br>    checkAllTodo(value) &#123;<br>      this.todos.forEach((todo) =&gt; &#123;<br>        todo.done = value;<br>      &#125;);<br>    &#125;,<br>    clearAllTodo() &#123;<br>      this.todos = this.todos.filter((todo) =&gt; &#123;<br>        return !todo.done;<br>      &#125;);<br>    &#125;,<br>  &#125;,<br>  watch: &#123;<br>    todos: &#123;<br>      deep: true,<br>      handler(value) &#123;<br>        localStorage.setItem(&quot;todos&quot;, JSON.stringify(value));<br>      &#125;,<br>    &#125;,<br>  &#125;,<br>  mounted() &#123;<br>    this.$bus.$on(&quot;checkTodo&quot;, this.checkTodo); // this.$bus.$on(&#x27;deleteTodoObj&#x27;, this.deleteTodoObj)<br>    this.pubId = pubsub.subscribe(&quot;deleteTodoObj&quot;, this.deleteTodoObj);<br>  &#125;,<br>  beforeDestroy() &#123;<br>    pubsub.unsubscribe(this.pubId);<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style&gt;<br>/*base*/<br>body &#123;<br>  background: #fff;<br>&#125;<br><br><br>.btn &#123;<br>  display: inline-block;<br>  padding: 4px 12px;<br>  margin-bottom: 0;<br>  font-size: 14px;<br>  line-height: 20px;<br>  text-align: center;<br>  vertical-align: middle;<br>  cursor: pointer;<br>  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.2),<br>    0 1px 2px rgba(0, 0, 0, 0.05);<br>  border-radius: 4px;<br>&#125;<br><br><br>.btn-danger &#123;<br>  color: #fff;<br>  background-color: #da4f49;<br>  border: 1px solid #bd362f;<br>&#125;<br><br><br>.btn-edit &#123;<br>  color: #fff;<br>  background-color: skyblue;<br>  border: 1px solid rgb(103, 159, 180);<br>  margin-right: 5px;<br>&#125;<br><br><br>.btn-danger:hover &#123;<br>  color: #fff;<br>  background-color: #bd362f;<br>&#125;<br><br><br>.btn:focus &#123;<br>  outline: none;<br>&#125;<br><br><br>.todo-container &#123;<br>  width: 600px;<br>  margin: 0 auto;<br>&#125;<br>.todo-container .todo-wrap &#123;<br>  padding: 10px;<br>  border: 1px solid #ddd;<br>  border-radius: 5px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>MyHeader.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;todo-header&quot;&gt;<br>       <br>    &lt;input<br>      type=&quot;text&quot;<br>      v-model=&quot;todoName&quot;<br>      @keyup.enter=&quot;add&quot;<br>      placeholder=&quot;请输入你的任务名称，按回车键确认&quot;<br>    /&gt;<br>     <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import &#123; nanoid &#125; from &quot;nanoid&quot;;<br>export default &#123;<br>  name: &quot;MyHeader&quot;, // props: [&quot;addTodoObj&quot;],<br>  data() &#123;<br>    return &#123;<br>      todoName: &quot;&quot;,<br>    &#125;;<br>  &#125;,<br>  methods: &#123;<br>    add() &#123;<br>      if (!this.todoName) &#123;<br>        alert(&quot;请输入点什么吧&quot;);<br>        return;<br>      &#125;<br>      const todoObj = &#123; id: nanoid(), title: this.todoName, done: false &#125;; // console.log(todoObj); // this.addTodoObj(todoObj);<br>      this.$emit(&quot;addTodoObj&quot;, todoObj);<br>      this.todoName = &quot;&quot;;<br>    &#125;,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>/*header*/<br>.todo-header input &#123;<br>  width: 560px;<br>  height: 28px;<br>  font-size: 14px;<br>  border: 1px solid #ccc;<br>  border-radius: 4px;<br>  padding: 4px 7px;<br>&#125;<br><br><br>.todo-header input:focus &#123;<br>  outline: none;<br>  border-color: rgba(82, 168, 236, 0.8);<br>  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075),<br>    0 0 8px rgba(82, 168, 236, 0.6);<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>MyList.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;ul class=&quot;todo-main&quot;&gt;<br>       <br>    &lt;!-- &lt;transition-group <br>    appear<br>    name=&quot;todo&quot;<br>    &gt; --&gt;<br>       <br>    &lt;transition-group<br>      appear<br>      name=&quot;animate__animated animate__bounce&quot;<br>      enter-active-class=&quot;animate__headShake&quot;<br>      leave-active-class=&quot;animate__bounceOut&quot;<br>    &gt;<br>           <br>      &lt;MyItem v-for=&quot;todoObj in todos&quot; :key=&quot;todoObj.id&quot; :todoObj=&quot;todoObj&quot; /&gt;  <br>       <br>    &lt;/transition-group&gt;<br>     <br>  &lt;/ul&gt;<br>&lt;/template&gt;<br><br>&lt;script scoped&gt;<br>import &quot;animate.css&quot;;<br>import MyItem from &quot;./MyItem.vue&quot;;<br>export default &#123;<br>  name: &quot;MyList&quot;,<br>  components: &#123;<br>    MyItem,<br>  &#125;,<br>  props: [&quot;todos&quot;],<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style&gt;<br>/*main*/<br>.todo-main &#123;<br>  margin-left: 0px;<br>  border: 1px solid #ddd;<br>  border-radius: 2px;<br>  padding: 0px;<br>&#125;<br><br><br>.todo-empty &#123;<br>  height: 40px;<br>  line-height: 40px;<br>  border: 1px solid #ddd;<br>  border-radius: 2px;<br>  padding-left: 5px;<br>  margin-top: 10px;<br>&#125;<br><br><br>.todo-enter-active &#123;<br>  animation: atguigu 0.5s linear;<br>&#125;<br><br><br>.todo-leave-active &#123;<br>  animation: atguigu 0.5s linear reverse;<br>&#125;<br><br><br>@keyframes atguigu &#123;<br>  from &#123;<br>    transform: translateX(100%);<br>  &#125;<br>  to &#123;<br>    transform: translateX(0);<br>  &#125;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>MyItem.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;li&gt;<br>       <br>    &lt;label&gt;<br>           <br>      &lt;input<br>        type=&quot;checkbox&quot;<br>        :checked=&quot;todoObj.done&quot;<br>        @change=&quot;handleCheck(todoObj.id)&quot;<br>      /&gt;<br>            &lt;span v-show=&quot;!todoObj.isEdit&quot;&gt;&#123;&#123; todoObj.title &#125;&#125;&lt;/span&gt;      <br>      &lt;input<br>        v-show=&quot;todoObj.isEdit&quot;<br>        type=&quot;text&quot;<br>        :value=&quot;todoObj.title&quot;<br>        @blur=&quot;handleBlur(todoObj, $event)&quot;<br>        ref=&quot;inputTitle&quot;<br>      /&gt;<br>         <br>    &lt;/label&gt;<br>       <br>    &lt;!-- 如下代码也能实现功能，但是不太推荐，因为有点违反原则，因为修改了props --&gt;<br>       <br>    &lt;!-- &lt;input type=&quot;checkbox&quot; v-model=&quot;todoObj.done&quot;/&gt; --&gt;<br>       <br>    &lt;button class=&quot;btn btn-danger&quot; @click=&quot;handleDelete(todoObj.id)&quot;&gt;<br>            删除    <br>    &lt;/button&gt;<br>       <br>    &lt;button<br>      class=&quot;btn btn-edit&quot;<br>      @click=&quot;handleEdit(todoObj)&quot;<br>      v-show=&quot;!todoObj.isEdit&quot;<br>    &gt;<br>            编辑    <br>    &lt;/button&gt;<br>     <br>  &lt;/li&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import pubsub from &quot;pubsub-js&quot;;<br>export default &#123;<br>  name: &quot;MyItem&quot;,<br>  props: [&quot;todoObj&quot;],<br>  data() &#123;<br>    return &#123;&#125;;<br>  &#125;,<br>  methods: &#123;<br>    handleCheck(id) &#123;<br>      // this.checkTodo(id);<br>      this.$bus.$emit(&quot;checkTodo&quot;, id);<br>    &#125;,<br>    handleDelete(id) &#123;<br>      // this.deleteTodoObj(id);<br>      // this.$bus.$emit(&quot;deleteTodoObj&quot;, id);<br>      pubsub.publish(&quot;deleteTodoObj&quot;, id);<br>    &#125;, //编辑<br>    handleEdit(todoObj) &#123;<br>      if (todoObj.hasOwnProperty(&quot;isEdit&quot;)) &#123;<br>        todoObj.isEdit = true;<br>      &#125; else &#123;<br>        this.$set(todoObj, &quot;isEdit&quot;, true);<br>      &#125; /* setTimeout(() =&gt; &#123; // 设置定时器<br>        this.$refs.inputTitle.focus();<br>      &#125;, 200); */ /* setTimeout(() =&gt; &#123; // 不正规写法(定时器里面不写时间)<br>        this.$refs.inputTitle.focus();<br>      &#125;); */<br><br>      this.$nextTick(function () &#123;<br>        this.$refs.inputTitle.focus();<br>      &#125;);<br>    &#125;, //失去焦点回调（真正执行修改逻辑）<br>    handleBlur(todoObj, e) &#123;<br>      todoObj.isEdit = false;<br>      if (!e.target.value.trim()) &#123;<br>        return alert(&quot;输入不能为空&quot;);<br>      &#125; // console.log(e.target.value);<br><br>      this.todoObj.title = e.target.value;<br>    &#125;,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>/*item*/<br>li &#123;<br>  list-style: none;<br>  height: 36px;<br>  line-height: 36px;<br>  padding: 0 5px;<br>  border-bottom: 1px solid #ddd;<br>&#125;<br><br><br>li label &#123;<br>  float: left;<br>  cursor: pointer;<br>&#125;<br><br><br>li label li input &#123;<br>  vertical-align: middle;<br>  margin-right: 6px;<br>  position: relative;<br>  top: -1px;<br>&#125;<br><br><br>li button &#123;<br>  float: right;<br>  display: none;<br>  margin-top: 3px;<br>&#125;<br><br><br>li:before &#123;<br>  content: initial;<br>&#125;<br><br><br>li:last-child &#123;<br>  border-bottom: none;<br>&#125;<br><br><br>li:hover &#123;<br>  background-color: #ccc;<br>&#125;<br><br><br>li:hover button &#123;<br>  display: block;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>MyFooter.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;todo-footer&quot; v-show=&quot;total&quot;&gt;<br>       <br>    &lt;label&gt;<br>           <br>      &lt;!-- &lt;input type=&quot;checkbox&quot; :checked=&quot;isAll&quot; @change=&quot;checkAll&quot; /&gt; --&gt;<br>            &lt;input type=&quot;checkbox&quot; v-model=&quot;isAll&quot; /&gt;    <br>    &lt;/label&gt;<br>       <br>    &lt;span&gt;<br>            &lt;span&gt;已完成&#123;&#123; calcTodoTotal &#125;&#125;&lt;/span&gt; / 全部&#123;&#123; total &#125;&#125;    <br>    &lt;/span&gt;<br>       <br>    &lt;button class=&quot;btn btn-danger&quot; @click=&quot;clearAll&quot;&gt;清除已完成任务&lt;/button&gt;  <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>export default &#123;<br>  name: &quot;MyFooter&quot;,<br>  props: [&quot;todos&quot;],<br>  computed: &#123;<br>    // isAll() &#123;<br>    //   return this.total === this.calcTodoTotal &amp;&amp; this.total &gt; 0;<br>    // &#125;,<br>    total() &#123;<br>      return this.todos.length;<br>    &#125;,<br>    calcTodoTotal() &#123;<br>      /*       let i = 0<br>      this.todos.forEach((todo) =&gt; &#123;<br>        if (todo.done === true) i++<br>      &#125;);<br>      return i */<br>      /*       return this.todos.reduce((pre, current) =&gt; &#123;<br>        // console.log(current.done);<br>        return pre + (current.done ? 1 : 0)<br>      &#125;, 0) */<br>      return this.todos.reduce((pre, todo) =&gt; pre + (todo.done ? 1 : 0), 0);<br>    &#125;,<br>    isAll: &#123;<br>      get() &#123;<br>        return this.total === this.calcTodoTotal &amp;&amp; this.total &gt; 0;<br>      &#125;,<br>      set(value) &#123;<br>        // this.checkAllTodo(value)<br>        this.$emit(&quot;checkAllTodo&quot;, value);<br>      &#125;,<br>    &#125;,<br>  &#125;,<br>  methods: &#123;<br>    checkAll(e) &#123;<br>      // console.log(e.target.checked);<br>      this.checkAllTodo(e.target.checked);<br>    &#125;,<br>    clearAll() &#123;<br>      // this.clearAllTodo()<br>      this.$emit(&quot;clearAllTodo&quot;);<br>    &#125;,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>/*footer*/<br>.todo-footer &#123;<br>  height: 40px;<br>  line-height: 40px;<br>  padding-left: 6px;<br>  margin-top: 5px;<br>&#125;<br><br><br>.todo-footer label &#123;<br>  display: inline-block;<br>  margin-right: 20px;<br>  cursor: pointer;<br>&#125;<br><br><br>.todo-footer label input &#123;<br>  position: relative;<br>  top: -1px;<br>  vertical-align: middle;<br>  margin-right: 5px;<br>&#125;<br><br><br>.todo-footer button &#123;<br>  float: right;<br>  margin-top: 5px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>## 代理服务器PS E:\Code\Vue\vue_test> npm i axios![](assets/f40efcd6791d4dc48f30d42b90f4351b.png)左边的 8080 是前端, 前端想跟 5000 后端要数据, 会产生跨域问题, 但是 8080 前端跟 8080 服务器是可以正常使用 AJAX 请求的, 8080 服务器跟 5000 服务器之间通信不会使用 AJAX 技术, 所以不存在所谓的跨域问题\尽管 changeOrigin 设置 false 属性, F12 开发工具查看的 Referer 还是显示着 8080 端口的这是因为浏览器只是将第一层请求显示给你（因为第一层请求是请求的本地服务器，域名、端口号和前端页面的域名、端口号都是一致的），第一层请求也就是发给代理服务器的请求，而修改 Host 的工作是代理服务器做的，浏览器当然不会显示 Host 已经被修改的状态！![](assets/a6ac6a7ec6e4435292f796593cf4fbdc.png)但是服务器中记录本地的端口来源于 8080 端口, 而不是 5000, 说明 changeOrigin 设置 false 已经生效了![](assets/53297f934cb244efbff9228f222fb335.png)安装 vue-resourceE:\Code\Vue\vue_test> npm i vue-resource### 方法一    在vue.config.js中添加如下配置：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-attr">devServer</span>: &#123;<br>  <span class="hljs-attr">proxy</span>: <span class="hljs-string">&quot;http://localhost:5000&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>说明：1. 优点：配置简单，请求资源时直接发给前端（8080）即可。2. 缺点：不能配置多个代理，不能灵活的控制请求是否走代理。3. 工作方式：若按照上述配置代理，当请求了前端不存在的资源时，那么该请求会转发给服务器 （优先匹配前端资源）### 方法二    编写vue.config.js配置具体代理规则：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">devServer</span>: &#123;<br>    <span class="hljs-attr">proxy</span>: &#123;<br>      <span class="hljs-string">&quot;/api1&quot;</span>: &#123;<br>        <span class="hljs-comment">// 匹配所有以 &#x27;/api1&#x27;开头的请求路径</span><br>        <span class="hljs-attr">target</span>: <span class="hljs-string">&quot;http://localhost:5000&quot;</span>, <span class="hljs-comment">// 代理目标的基础路径</span><br>        <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>,<br>        <span class="hljs-attr">pathRewrite</span>: &#123; <span class="hljs-string">&quot;^/api1&quot;</span>: <span class="hljs-string">&quot;&quot;</span> &#125;,<br>      &#125;,<br>      <span class="hljs-string">&quot;/api2&quot;</span>: &#123;<br>        <span class="hljs-comment">// 匹配所有以 &#x27;/api2&#x27;开头的请求路径</span><br>        <span class="hljs-attr">target</span>: <span class="hljs-string">&quot;http://localhost:5001&quot;</span>, <span class="hljs-comment">// 代理目标的基础路径</span><br>        <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>,<br>        <span class="hljs-attr">pathRewrite</span>: &#123; <span class="hljs-string">&quot;^/api2&quot;</span>: <span class="hljs-string">&quot;&quot;</span> &#125;,<br>      &#125;,<br>    &#125;,<br>  &#125;,<br>&#125;;<br><span class="hljs-comment">/*</span><br><span class="hljs-comment">   changeOrigin设置为true时，服务器收到的请求头中的host为：localhost:5000</span><br><span class="hljs-comment">   changeOrigin设置为false时，服务器收到的请求头中的host为：localhost:8080</span><br><span class="hljs-comment">   changeOrigin默认值为true</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure>说明：1. 优点：可以配置多个代理，且可以灵活的控制请求是否走代理。2. 缺点：配置略微繁琐，请求资源时必须加前缀。### 代码main.js<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./App.vue&quot;</span>;<br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;<br><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br>  <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#app&quot;</span>,<br>  <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">h</span>) =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>),<br>  <span class="hljs-title function_">beforeCreate</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$bus</span> = <span class="hljs-variable language_">this</span>;<br>  &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure>App.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div&gt;<br>        &lt;button @click=&quot;getStudents&quot;&gt;获取学生信息&lt;/button&gt;    <br>    &lt;button @click=&quot;getCars&quot;&gt;获取汽车信息&lt;/button&gt;  <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import axios from &quot;axios&quot;;<br>export default &#123;<br>  name: &quot;App&quot;,<br>  methods: &#123;<br>    getStudents() &#123;<br>      axios.get(&quot;http://localhost:8080/atguigu/students&quot;).then(<br>        (response) =&gt; &#123;<br>          console.log(response.data);<br>        &#125;,<br>        (error) =&gt; &#123;<br>          console.log(error.message);<br>        &#125;<br>      );<br>    &#125;,<br>    getCars() &#123;<br>      axios.get(&quot;http://localhost:8080/demo/cars&quot;).then(<br>        (response) =&gt; &#123;<br>          console.log(response.data);<br>        &#125;,<br>        (error) =&gt; &#123;<br>          console.log(error.message);<br>        &#125;<br>      );<br>    &#125;,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>## github 搜索案例### axios 实现test.html<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-comment">//编写一个javascript对象 ES6</span></span><br><span class="language-javascript">  <span class="hljs-keyword">var</span> user = &#123;</span><br><span class="language-javascript">    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;小武&quot;</span>,</span><br><span class="language-javascript">    <span class="hljs-attr">age</span>: <span class="hljs-number">18</span>,</span><br><span class="language-javascript">    <span class="hljs-attr">sex</span>: <span class="hljs-string">&quot;男&quot;</span>,</span><br><span class="language-javascript">  &#125;; <span class="hljs-comment">//将JS对象转换为JSON对象</span></span><br><span class="language-javascript">  <span class="hljs-keyword">var</span> json = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(user);</span><br><span class="language-javascript">  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(json);</span><br><span class="language-javascript">  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user);</span><br><span class="language-javascript">  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;==================&quot;</span>); <span class="hljs-comment">//将JSON对象转换为JS对象 // var obj = JSON.parse(json);</span></span><br><span class="language-javascript">  <span class="hljs-keyword">var</span> obj = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(json);</span><br><span class="language-javascript">  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj);</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure>main.js<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./App.vue&quot;</span>;<br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;<br><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br>  <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#app&quot;</span>,<br>  <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">h</span>) =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>),<br>  <span class="hljs-title function_">beforeCreate</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$bus</span> = <span class="hljs-variable language_">this</span>;<br>  &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure>App.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;container&quot;&gt;    &lt;Search /&gt;     &lt;List /&gt;  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import Search from &quot;./components/Search&quot;;<br>import List from &quot;./components/List&quot;;<br>export default &#123;<br>  name: &quot;App&quot;,<br>  components: &#123;<br>    Search,<br>    List,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>Search.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;section class=&quot;jumbotron&quot;&gt;<br>       <br>    &lt;h3 class=&quot;jumbotron-heading&quot;&gt;Search Github Users&lt;/h3&gt;<br>       <br>    &lt;div&gt;<br>           <br>      &lt;input<br>        type=&quot;text&quot;<br>        placeholder=&quot;enter the name you search&quot;<br>        v-model=&quot;keyWord&quot;<br>      /&gt;<br>                    &lt;button @click=&quot;searchUsers&quot;&gt;Search&lt;/button&gt;    <br>    &lt;/div&gt;<br>     <br>  &lt;/section&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import pubsub from &quot;pubsub-js&quot;;<br>import axios from &quot;axios&quot;;<br>export default &#123;<br>  name: &quot;Search&quot;,<br>  data() &#123;<br>    return &#123;<br>      keyWord: &quot;&quot;,<br>    &#125;;<br>  &#125;,<br>  methods: &#123;<br>    searchUsers() &#123;<br>      pubsub.publish(&quot;updateListData&quot;, &#123;<br>        isFirst: false,<br>        isLoading: true,<br>        errMsg: &quot;&quot;,<br>        users: [],<br>      &#125;); /*       this.$bus.$emit(&quot;updateListData&quot;, &#123;<br>        isFirst: false,<br>        isLoading: true,<br>        errMsg: &quot;&quot;,<br>        users: [],<br>      &#125;); */<br>      axios.get(`https://api.github.com/search/users?q=$&#123;this.keyWord&#125;`).then(<br>        (response) =&gt; &#123;<br>          console.log(<br>            &quot;请求成功了&quot;,<br>            response.data.items<br>          ); /* this.$bus.$emit(&quot;updateListData&quot;, &#123;<br>            isLoading: false,<br>            errMsg: &quot;&quot;,<br>            users: response.data.items,<br>          &#125;); */<br>          pubsub.publish(&quot;updateListData&quot;, &#123;<br>            isLoading: false,<br>            errMsg: &quot;&quot;,<br>            users: response.data.items,<br>          &#125;);<br>        &#125;,<br>        (error) =&gt; &#123;<br>          console.log(<br>            &quot;请求失败了&quot;,<br>            error.message<br>          ); /* this.$bus.$emit(&quot;updateListData&quot;, &#123;<br>            isLoading: false,<br>            errMsg: error.message,<br>            users: [],<br>          &#125;); */<br>          pubsub.publish(&quot;updateListData&quot;, &#123;<br>            isLoading: false,<br>            errMsg: error.message,<br>            users: [],<br>          &#125;);<br>        &#125;<br>      );<br>    &#125;,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style&gt;&lt;/style&gt;<br></code></pre></td></tr></table></figure>List.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;section class=&quot;jumbotron&quot;&gt;<br>       <br>    &lt;h3 class=&quot;jumbotron-heading&quot;&gt;Search Github Users&lt;/h3&gt;<br>       <br>    &lt;div&gt;<br>           <br>      &lt;input<br>        type=&quot;text&quot;<br>        placeholder=&quot;enter the name you search&quot;<br>        v-model=&quot;keyWord&quot;<br>      /&gt;<br>                    &lt;button @click=&quot;searchUsers&quot;&gt;Search&lt;/button&gt;    <br>    &lt;/div&gt;<br>     <br>  &lt;/section&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import pubsub from &quot;pubsub-js&quot;;<br>import axios from &quot;axios&quot;;<br>export default &#123;<br>  name: &quot;Search&quot;,<br>  data() &#123;<br>    return &#123;<br>      keyWord: &quot;&quot;,<br>    &#125;;<br>  &#125;,<br>  methods: &#123;<br>    searchUsers() &#123;<br>      pubsub.publish(&quot;updateListData&quot;, &#123;<br>        isFirst: false,<br>        isLoading: true,<br>        errMsg: &quot;&quot;,<br>        users: [],<br>      &#125;); /*       this.$bus.$emit(&quot;updateListData&quot;, &#123;<br>        isFirst: false,<br>        isLoading: true,<br>        errMsg: &quot;&quot;,<br>        users: [],<br>      &#125;); */<br>      axios.get(`https://api.github.com/search/users?q=$&#123;this.keyWord&#125;`).then(<br>        (response) =&gt; &#123;<br>          console.log(<br>            &quot;请求成功了&quot;,<br>            response.data.items<br>          ); /* this.$bus.$emit(&quot;updateListData&quot;, &#123;<br>            isLoading: false,<br>            errMsg: &quot;&quot;,<br>            users: response.data.items,<br>          &#125;); */<br>          pubsub.publish(&quot;updateListData&quot;, &#123;<br>            isLoading: false,<br>            errMsg: &quot;&quot;,<br>            users: response.data.items,<br>          &#125;);<br>        &#125;,<br>        (error) =&gt; &#123;<br>          console.log(<br>            &quot;请求失败了&quot;,<br>            error.message<br>          ); /* this.$bus.$emit(&quot;updateListData&quot;, &#123;<br>            isLoading: false,<br>            errMsg: error.message,<br>            users: [],<br>          &#125;); */<br>          pubsub.publish(&quot;updateListData&quot;, &#123;<br>            isLoading: false,<br>            errMsg: error.message,<br>            users: [],<br>          &#125;);<br>        &#125;<br>      );<br>    &#125;,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style&gt;&lt;/style&gt;<br></code></pre></td></tr></table></figure>### vue-resource 实现test.html<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-comment">//编写一个javascript对象 ES6</span></span><br><span class="language-javascript">  <span class="hljs-keyword">var</span> user = &#123;</span><br><span class="language-javascript">    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;小武&quot;</span>,</span><br><span class="language-javascript">    <span class="hljs-attr">age</span>: <span class="hljs-number">18</span>,</span><br><span class="language-javascript">    <span class="hljs-attr">sex</span>: <span class="hljs-string">&quot;男&quot;</span>,</span><br><span class="language-javascript">  &#125;; <span class="hljs-comment">//将JS对象转换为JSON对象</span></span><br><span class="language-javascript">  <span class="hljs-keyword">var</span> json = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(user);</span><br><span class="language-javascript">  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(json);</span><br><span class="language-javascript">  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user);</span><br><span class="language-javascript">  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;==================&quot;</span>); <span class="hljs-comment">//将JSON对象转换为JS对象 // var obj = JSON.parse(json);</span></span><br><span class="language-javascript">  <span class="hljs-keyword">var</span> obj = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(json);</span><br><span class="language-javascript">  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj);</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure>main.js<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./App.vue&quot;</span>;<br><span class="hljs-comment">// 引入插件</span><br><span class="hljs-keyword">import</span> vueResource <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue-resource&quot;</span>;<br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-comment">// 使用插件</span><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(vueResource);<br><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br>  <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#app&quot;</span>,<br>  <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">h</span>) =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>),<br>  <span class="hljs-title function_">beforeCreate</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$bus</span> = <span class="hljs-variable language_">this</span>;<br>  &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure>App.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;container&quot;&gt;    &lt;Search /&gt;     &lt;List /&gt;  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import Search from &quot;./components/Search&quot;;<br>import List from &quot;./components/List&quot;;<br>export default &#123;<br>  name: &quot;App&quot;,<br>  components: &#123;<br>    Search,<br>    List,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>Search.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;section class=&quot;jumbotron&quot;&gt;<br>       <br>    &lt;h3 class=&quot;jumbotron-heading&quot;&gt;Search Github Users&lt;/h3&gt;<br>       <br>    &lt;div&gt;<br>           <br>      &lt;input<br>        type=&quot;text&quot;<br>        placeholder=&quot;enter the name you search&quot;<br>        v-model=&quot;keyWord&quot;<br>      /&gt;<br>                    &lt;button @click=&quot;searchUsers&quot;&gt;Search&lt;/button&gt;    <br>    &lt;/div&gt;<br>     <br>  &lt;/section&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import pubsub from &quot;pubsub-js&quot;;<br>export default &#123;<br>  name: &quot;Search&quot;,<br>  data() &#123;<br>    return &#123;<br>      keyWord: &quot;&quot;,<br>    &#125;;<br>  &#125;,<br>  methods: &#123;<br>    searchUsers() &#123;<br>      console.log(this);<br>      pubsub.publish(&quot;updateListData&quot;, &#123;<br>        isFirst: false,<br>        isLoading: true,<br>        errMsg: &quot;&quot;,<br>        users: [],<br>      &#125;); /*       this.$bus.$emit(&quot;updateListData&quot;, &#123;<br>        isFirst: false,<br>        isLoading: true,<br>        errMsg: &quot;&quot;,<br>        users: [],<br>      &#125;); */<br>      this.$http<br>        .get(`https://api.github.com/search/users?q=$&#123;this.keyWord&#125;`)<br>        .then(<br>          (response) =&gt; &#123;<br>            console.log(<br>              &quot;请求成功了&quot;,<br>              response.data.items<br>            ); /* this.$bus.$emit(&quot;updateListData&quot;, &#123;<br>            isLoading: false,<br>            errMsg: &quot;&quot;,<br>            users: response.data.items,<br>          &#125;); */<br>            pubsub.publish(&quot;updateListData&quot;, &#123;<br>              isLoading: false,<br>              errMsg: &quot;&quot;,<br>              users: response.data.items,<br>            &#125;);<br>          &#125;,<br>          (error) =&gt; &#123;<br>            console.log(<br>              &quot;请求失败了&quot;,<br>              error.message<br>            ); /* this.$bus.$emit(&quot;updateListData&quot;, &#123;<br>            isLoading: false,<br>            errMsg: error.message,<br>            users: [],<br>          &#125;); */<br>            pubsub.publish(&quot;updateListData&quot;, &#123;<br>              isLoading: false,<br>              errMsg: error.message,<br>              users: [],<br>            &#125;);<br>          &#125;<br>        );<br>    &#125;,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style&gt;&lt;/style&gt;<br></code></pre></td></tr></table></figure>List.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;row&quot;&gt;<br>       <br>    &lt;!-- 展示用户列表 --&gt;<br>       <br>    &lt;div<br>      v-show=&quot;info.users.length&quot;<br>      class=&quot;card&quot;<br>      v-for=&quot;user in info.users&quot;<br>      :key=&quot;user.login&quot;<br>    &gt;<br>           <br>      &lt;a :href=&quot;user.html_url&quot; target=&quot;_blank&quot;&gt;<br>                &lt;img :src=&quot;user.avatar_url&quot; style=&quot;width: 100px&quot; /&gt;      <br>      &lt;/a&gt;<br>           <br>      &lt;p class=&quot;card-text&quot;&gt;&#123;&#123; user.login &#125;&#125;&lt;/p&gt;<br>         <br>    &lt;/div&gt;<br>       <br>    &lt;!-- 展示欢迎词 --&gt;<br>       <br>    &lt;h1 v-show=&quot;info.isFirst&quot;&gt;欢迎使用!&lt;/h1&gt;<br>       <br>    &lt;!-- 展示加载中 --&gt;<br>       <br>    &lt;h1 v-show=&quot;info.isLoading&quot;&gt;加载中...&lt;/h1&gt;<br>       <br>    &lt;!-- 展示错误信息 --&gt;<br>       <br>    &lt;h1 v-show=&quot;info.errMsg&quot;&gt;&#123;&#123; info.errMsg &#125;&#125;&lt;/h1&gt;<br>     <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import pubsub from &quot;pubsub-js&quot;;<br>export default &#123;<br>  name: &quot;List&quot;,<br>  data() &#123;<br>    return &#123;<br>      info: &#123;<br>        isFirst: true,<br>        isLoading: false,<br>        errMsg: &quot;&quot;,<br>        users: [],<br>      &#125;,<br>    &#125;;<br>  &#125;,<br>  mounted() &#123;<br>    pubsub.subscribe(&quot;updateListData&quot;, (_, dataObj) =&gt; &#123;<br>      console.log(&quot;List收到了数据&quot;, dataObj);<br>      this.info = &#123; ...this.info, ...dataObj &#125;;<br>    &#125;); /* this.$bus.$on(&quot;updateListData&quot;, (dataObj) =&gt; &#123;<br>      // console.log(&quot;List收到了数据&quot;, users);<br>      this.info = &#123; ...this.info, ...dataObj &#125;;<br>    &#125;); */<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>.album &#123;<br>  min-height: 50rem; /* Can be removed; just added for demo purposes */<br>  padding-top: 3rem;<br>  padding-bottom: 3rem;<br>  background-color: #f7f7f7;<br>&#125;<br><br><br>.card &#123;<br>  float: left;<br>  width: 33.333%;<br>  padding: 0.75rem;<br>  margin-bottom: 2rem;<br>  border: 1px solid #efefef;<br>  text-align: center;<br>&#125;<br><br><br>.card &gt; img &#123;<br>  margin-bottom: 0.75rem;<br>  border-radius: 100px;<br>&#125;<br><br><br>.card-text &#123;<br>  font-size: 85%;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>## 插槽1.  作用：让父组件可以向子组件指定位置插入 html 结构，也是一种组件间通信的方式，适用于 **父组件 ===> 子组件** 。2.  分类：默认插槽、具名插槽、作用域插槽3.  使用方式：4.  默认插槽：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs vue">父组件中：<br>&lt;Category&gt;<br>           &lt;div&gt;html结构1&lt;/div&gt;<br>        &lt;/Category&gt;<br>子组件中：<br>&lt;template&gt;<br>  &lt;div&gt;<br>    &lt;!-- 定义插槽 --&gt;<br>    &lt;slot&gt;插槽默认内容...&lt;/slot&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure>2.  具名插槽：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs vue">父组件中：<br>&lt;Category&gt;<br>            &lt;template slot=&quot;center&quot;&gt;<br>              &lt;div&gt;html结构1&lt;/div&gt;<br>            &lt;/template&gt;<br><br>            &lt;template v-slot:footer&gt;<br>               &lt;div&gt;html结构2&lt;/div&gt;<br>            &lt;/template&gt;<br>        &lt;/Category&gt;<br>子组件中：<br>&lt;template&gt;<br>  &lt;div&gt;<br>    &lt;!-- 定义插槽 --&gt;<br>    &lt;slot name=&quot;center&quot;&gt;插槽默认内容...&lt;/slot&gt;<br>    &lt;slot name=&quot;footer&quot;&gt;插槽默认内容...&lt;/slot&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure>3.  作用域插槽：1.  理解：数据在组件的自身，但根据数据生成的结构需要组件的使用者来决定。（games 数据在 Category 组件中，但使用数据所遍历出来的结构由 App 组件决定）1.  具体编码：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs vue">父组件中：<br>&lt;Category&gt;<br>&lt;template scope=&quot;scopeData&quot;&gt;<br>&lt;!-- 生成的是ul列表 --&gt;<br>&lt;ul&gt;<br>&lt;li v-for=&quot;g in scopeData.games&quot; :key=&quot;g&quot;&gt;&#123;&#123;g&#125;&#125;&lt;/li&gt;<br>&lt;/ul&gt;<br>&lt;/template&gt;<br>&lt;/Category&gt;<br><br>&lt;Category&gt;<br>&lt;template slot-scope=&quot;scopeData&quot;&gt;<br>&lt;!-- 生成的是h4标题 --&gt;<br>&lt;h4 v-for=&quot;g in scopeData.games&quot; :key=&quot;g&quot;&gt;&#123;&#123;g&#125;&#125;&lt;/h4&gt;<br>&lt;/template&gt;<br>&lt;/Category&gt;<br>子组件中：<br>&lt;template&gt;<br>  &lt;div&gt;<br>    &lt;slot :games=&quot;games&quot;&gt;&lt;/slot&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>export default &#123;<br>  name: &quot;Category&quot;,<br>  props: [&quot;title&quot;],<br>  //数据在子组件自身<br>  data() &#123;<br>    return &#123;<br>      games: [&quot;红色警戒&quot;, &quot;穿越火线&quot;, &quot;劲舞团&quot;, &quot;超级玛丽&quot;],<br>    &#125;;<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>### 代码:#### 默认插槽Category.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;category&quot;&gt;<br>       <br>    &lt;h3&gt;&#123;&#123; title &#125;&#125;分类&lt;/h3&gt;<br>       <br>    &lt;!-- 定义一个插槽(挖个坑, 等着组件的使用者进行填充) --&gt;<br>        &lt;slot&gt;我是一个默认值, 当使用者没有传递具体结构时, 我会出现&lt;/slot&gt;  <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>export default &#123;<br>  name: &quot;Category&quot;,<br>  props: [&quot;title&quot;],<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>.category &#123;<br>  background-color: skyblue;<br>  width: 200px;<br>  height: 300px;<br>&#125;<br>h3 &#123;<br>  text-align: center;<br>  background-color: orange;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>App.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;container&quot;&gt;<br>       <br>    &lt;Category title=&quot;美食&quot;&gt;<br>            &lt;img src=&quot;./美食.jpg&quot; alt=&quot;&quot; /&gt;    <br>    &lt;/Category&gt;<br>       <br>    &lt;Category title=&quot;游戏&quot;&gt;<br>           <br>      &lt;ul&gt;<br>               <br>        &lt;li v-for=&quot;(g, index) in games&quot; :key=&quot;index&quot;&gt;&#123;&#123; g &#125;&#125;&lt;/li&gt;<br>             <br>      &lt;/ul&gt;<br>         <br>    &lt;/Category&gt;<br>       <br>    &lt;Category title=&quot;电影&quot;&gt;<br>           <br>      &lt;video<br>        controls<br>        src=&quot;http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4&quot;<br>      &gt;&lt;/video&gt;<br>         <br>    &lt;/Category&gt;<br>     <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import Category from &quot;./components/Category&quot;;<br>export default &#123;<br>  name: &quot;App&quot;,<br>  components: &#123;<br>    Category,<br>  &#125;,<br>  data() &#123;<br>    return &#123;<br>      foods: [&quot;火锅&quot;, &quot;烧烤&quot;, &quot;小龙虾&quot;, &quot;牛排&quot;],<br>      games: [&quot;红色警戒&quot;, &quot;穿越火线&quot;, &quot;劲舞团&quot;, &quot;超级玛丽&quot;],<br>      films: [&quot;《教父》&quot;, &quot;《拆弹专家》&quot;, &quot;《你好，李焕英》&quot;, &quot;《尚硅谷》&quot;],<br>    &#125;;<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>.container &#123;<br>  display: flex;<br>  justify-content: space-around;<br>&#125;<br><br><br>img &#123;<br>  width: 100%;<br>&#125;<br>video &#123;<br>  width: 100%;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>main.js<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./App.vue&quot;</span>;<br><span class="hljs-comment">// 引入插件</span><br><span class="hljs-keyword">import</span> vueResource <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue-resource&quot;</span>;<br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-comment">// 使用插件</span><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(vueResource);<br><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br>  <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#app&quot;</span>,<br>  <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">h</span>) =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>),<br>  <span class="hljs-title function_">beforeCreate</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$bus</span> = <span class="hljs-variable language_">this</span>;<br>  &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure>#### 具名插槽Category.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;category&quot;&gt;<br>       <br>    &lt;h3&gt;&#123;&#123; title &#125;&#125;分类&lt;/h3&gt;<br>       <br>    &lt;!-- 定义一个插槽(挖个坑, 等着组件的使用者进行填充) --&gt;<br>       <br>    &lt;slot name=&quot;center&quot;<br>      &gt;我是一个默认值, 当使用者没有传递具体结构时, 我会出现1&lt;/slot<br>    &gt;<br>       <br>    &lt;slot name=&quot;footer&quot;<br>      &gt;我是一个默认值, 当使用者没有传递具体结构时, 我会出现2&lt;/slot<br>    &gt;<br>     <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>export default &#123;<br>  name: &quot;Category&quot;,<br>  props: [&quot;title&quot;],<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>.category &#123;<br>  background-color: skyblue;<br>  width: 200px;<br>  height: 300px;<br>&#125;<br>h3 &#123;<br>  text-align: center;<br>  background-color: orange;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>App.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;container&quot;&gt;<br>       <br>    &lt;Category title=&quot;美食&quot;&gt;<br>            &lt;img slot=&quot;center&quot; src=&quot;./美食.jpg&quot; alt=&quot;&quot; /&gt;      <br>      &lt;a slot=&quot;footer&quot; href=&quot;http://www.baidu.com&quot; target=&quot;_blank&quot;&gt;更多美食&lt;/a&gt;<br>         <br>    &lt;/Category&gt;<br>       <br>    &lt;Category title=&quot;游戏&quot;&gt;<br>           <br>      &lt;ul slot=&quot;center&quot;&gt;<br>               <br>        &lt;li v-for=&quot;(g, index) in games&quot; :key=&quot;index&quot;&gt;&#123;&#123; g &#125;&#125;&lt;/li&gt;<br>             <br>      &lt;/ul&gt;<br>           <br>      &lt;div slot=&quot;footer&quot; class=&quot;foot&quot;&gt;<br>                &lt;a href=&quot;http://www.baidu.com&quot; target=&quot;_blank&quot;&gt;单机游戏&lt;/a&gt;    <br>            &lt;a href=&quot;http://www.baidu.com&quot; target=&quot;_blank&quot;&gt;网络游戏&lt;/a&gt;      <br>      &lt;/div&gt;<br>         <br>    &lt;/Category&gt;<br>       <br>    &lt;Category title=&quot;电影&quot;&gt;<br>           <br>      &lt;video<br>        slot=&quot;center&quot;<br>        controls<br>        src=&quot;http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4&quot;<br>      &gt;&lt;/video&gt;<br>           <br>      &lt;!-- &lt;template slot=&quot;footer&quot;&gt; --&gt;<br>           <br>      &lt;!-- 注意v-slot:footer只能放在template上 --&gt;<br>           <br>      &lt;template v-slot:footer&gt;<br>               <br>        &lt;div class=&quot;foot&quot;&gt;<br>                    &lt;a href=&quot;http://www.baidu.com&quot; target=&quot;_blank&quot;&gt;经典&lt;/a&gt;    <br>                &lt;a href=&quot;http://www.baidu.com&quot; target=&quot;_blank&quot;&gt;热门&lt;/a&gt;        <br>            &lt;a href=&quot;http://www.baidu.com&quot; target=&quot;_blank&quot;&gt;推荐&lt;/a&gt;        <br>        &lt;/div&gt;<br>               <br>        &lt;h4&gt;欢迎前来观影&lt;/h4&gt;<br>             <br>      &lt;/template&gt;<br>         <br>    &lt;/Category&gt;<br>     <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import Category from &quot;./components/Category&quot;;<br>export default &#123;<br>  name: &quot;App&quot;,<br>  components: &#123;<br>    Category,<br>  &#125;,<br>  data() &#123;<br>    return &#123;<br>      foods: [&quot;火锅&quot;, &quot;烧烤&quot;, &quot;小龙虾&quot;, &quot;牛排&quot;],<br>      games: [&quot;红色警戒&quot;, &quot;穿越火线&quot;, &quot;劲舞团&quot;, &quot;超级玛丽&quot;],<br>      films: [&quot;《教父》&quot;, &quot;《拆弹专家》&quot;, &quot;《你好，李焕英》&quot;, &quot;《尚硅谷》&quot;],<br>    &#125;;<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>.container,<br>.foot &#123;<br>  display: flex;<br>  justify-content: space-around;<br>&#125;<br><br><br>img &#123;<br>  width: 100%;<br>&#125;<br>video &#123;<br>  width: 100%;<br>&#125;<br>h4 &#123;<br>  text-align: center;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>main.js<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./App.vue&quot;</span>;<br><span class="hljs-comment">// 引入插件</span><br><span class="hljs-keyword">import</span> vueResource <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue-resource&quot;</span>;<br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-comment">// 使用插件</span><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(vueResource);<br><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br>  <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#app&quot;</span>,<br>  <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">h</span>) =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>),<br>  <span class="hljs-title function_">beforeCreate</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$bus</span> = <span class="hljs-variable language_">this</span>;<br>  &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure>#### 作用域插槽Category.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;category&quot;&gt;<br>       <br>    &lt;h3&gt;&#123;&#123; title &#125;&#125;分类&lt;/h3&gt;<br>       <br>    &lt;!-- 定义一个插槽(挖个坑, 等着组件的使用者进行填充) --&gt;<br>       <br>    &lt;slot :games=&quot;games&quot;<br>      &gt;我是一个默认值, 当使用者没有传递具体结构时, 我会出现1&lt;/slot<br>    &gt;<br>     <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>export default &#123;<br>  name: &quot;Category&quot;,<br>  props: [&quot;title&quot;],<br>  data() &#123;<br>    return &#123;<br>      games: [&quot;红色警戒&quot;, &quot;穿越火线&quot;, &quot;劲舞团&quot;, &quot;超级玛丽&quot;],<br>    &#125;;<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>.category &#123;<br>  background-color: skyblue;<br>  width: 200px;<br>  height: 300px;<br>&#125;<br>h3 &#123;<br>  text-align: center;<br>  background-color: orange;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>App.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;container&quot;&gt;<br>       <br>    &lt;!-- 数据不在这个当前vue文件中, 而在别的组件中, 但是想要决定组件中的结构, 就要使用作用域插槽 --&gt;<br>       <br>    &lt;Category title=&quot;游戏&quot;&gt;<br>           <br>      &lt;template scope=&quot;atguigu&quot;&gt;<br>               <br>        &lt;ul&gt;<br>                   <br>          &lt;li v-for=&quot;(g, index) in atguigu.games&quot; :key=&quot;index&quot;&gt;&#123;&#123; g &#125;&#125;&lt;/li&gt;<br>                 <br>        &lt;/ul&gt;<br>             <br>      &lt;/template&gt;<br>         <br>    &lt;/Category&gt;<br><br>       <br>    &lt;Category title=&quot;游戏&quot;&gt;<br>           <br>      &lt;template scope=&quot;&#123;games&#125;&quot;&gt;<br>               <br>        &lt;ol&gt;<br>                   <br>          &lt;li style=&quot;color:red&quot; v-for=&quot;(g, index) in games&quot; :key=&quot;index&quot;&gt;<br>            &#123;&#123; g &#125;&#125;<br>          &lt;/li&gt;<br>                 <br>        &lt;/ol&gt;<br>             <br>      &lt;/template&gt;<br>         <br>    &lt;/Category&gt;<br><br>       <br>    &lt;Category title=&quot;游戏&quot;&gt;<br>           <br>      &lt;template slot-scope=&quot;&#123; games &#125;&quot;&gt;<br>               <br>        &lt;h4 v-for=&quot;(g, index) in games&quot; :key=&quot;index&quot;&gt;&#123;&#123; g &#125;&#125;&lt;/h4&gt;<br>             <br>      &lt;/template&gt;<br>         <br>    &lt;/Category&gt;<br>     <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import Category from &quot;./components/Category&quot;;<br>export default &#123;<br>  name: &quot;App&quot;,<br>  components: &#123;<br>    Category,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>.container,<br>.foot &#123;<br>  display: flex;<br>  justify-content: space-around;<br>&#125;<br><br><br>img &#123;<br>  width: 100%;<br>&#125;<br>video &#123;<br>  width: 100%;<br>&#125;<br>h4 &#123;<br>  text-align: center;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>main.js<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./App.vue&quot;</span>;<br><span class="hljs-comment">// 引入插件</span><br><span class="hljs-keyword">import</span> vueResource <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue-resource&quot;</span>;<br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-comment">// 使用插件</span><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(vueResource);<br><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br>  <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#app&quot;</span>,<br>  <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">h</span>) =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>),<br>  <span class="hljs-title function_">beforeCreate</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$bus</span> = <span class="hljs-variable language_">this</span>;<br>  &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure>## Vuex多组件共享数据--全局事件总线实现![](https://cdn.xiamu.icu//FuMy4PDGENZU1TiC98Pdisx31xaq.png)多组件共享数据--vuex 实现![](https://cdn.xiamu.icu//FhetOor1f-3xp5dvNrzcRnlKttJq.png)安装 vuexPS E:\Code\Vue\vue_test> npm i vuex@3**注意 vue2 中, 要用 vuex 的 3 版本****vue3 中, 要用 vuex 的 4 版本**### 1.概念        在Vue中实现集中式状态（数据）管理的一个Vue插件，对vue应用中多个组件的共享状态进行集中式的管理（读/写），也是一种组件间通信的方式，且适用于任意组件间通信。### 2.何时使用？        多个组件需要共享数据时### 3.搭建 vuex 环境1.  创建文件：`src/store/index.js`<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//引入Vue核心库</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-comment">//引入Vuex</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vuex</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vuex&quot;</span>;<br><span class="hljs-comment">//应用Vuex插件</span><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">Vuex</span>);<br><br><span class="hljs-comment">//准备actions对象——响应组件中用户的动作</span><br><span class="hljs-keyword">const</span> actions = &#123;&#125;;<br><span class="hljs-comment">//准备mutations对象——修改state中的数据</span><br><span class="hljs-keyword">const</span> mutations = &#123;&#125;;<br><span class="hljs-comment">//准备state对象——保存具体的数据</span><br><span class="hljs-keyword">const</span> state = &#123;&#125;;<br><br><span class="hljs-comment">//创建并暴露store</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vuex</span>.<span class="hljs-title class_">Store</span>(&#123;<br>  actions,<br>  mutations,<br>  state,<br>&#125;);<br></code></pre></td></tr></table></figure>2.  在`main.js`中创建 vm 时传入`store`配置项<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript">......<br><span class="hljs-comment">//引入store</span><br><span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./store&#x27;</span><br>......<br><br><span class="hljs-comment">//创建vm</span><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br><span class="hljs-attr">el</span>:<span class="hljs-string">&#x27;#app&#x27;</span>,<br><span class="hljs-attr">render</span>: <span class="hljs-function"><span class="hljs-params">h</span> =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>),<br>store<br>&#125;)<br></code></pre></td></tr></table></figure>### 4.基本使用1.  初始化数据、配置`actions`、配置`mutations`，操作文件`store.js`<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//引入Vue核心库</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-comment">//引入Vuex</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vuex</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vuex&quot;</span>;<br><span class="hljs-comment">//引用Vuex</span><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">Vuex</span>);<br><br><span class="hljs-keyword">const</span> actions = &#123;<br>  <span class="hljs-comment">//响应组件中加的动作</span><br>  <span class="hljs-title function_">jia</span>(<span class="hljs-params">context, value</span>) &#123;<br>    <span class="hljs-comment">// console.log(&#x27;actions中的jia被调用了&#x27;,miniStore,value)</span><br>    context.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&quot;JIA&quot;</span>, value);<br>  &#125;,<br>&#125;;<br><br><span class="hljs-keyword">const</span> mutations = &#123;<br>  <span class="hljs-comment">//执行加</span><br>  <span class="hljs-title function_">JIA</span>(<span class="hljs-params">state, value</span>) &#123;<br>    <span class="hljs-comment">// console.log(&#x27;mutations中的JIA被调用了&#x27;,state,value)</span><br>    state.<span class="hljs-property">sum</span> += value;<br>  &#125;,<br>&#125;;<br><br><span class="hljs-comment">//初始化数据</span><br><span class="hljs-keyword">const</span> state = &#123;<br>  <span class="hljs-attr">sum</span>: <span class="hljs-number">0</span>,<br>&#125;;<br><br><span class="hljs-comment">//创建并暴露store</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vuex</span>.<span class="hljs-title class_">Store</span>(&#123;<br>  actions,<br>  mutations,<br>  state,<br>&#125;);<br></code></pre></td></tr></table></figure>2.  组件中读取 vuex 中的数据：`$store.state.sum`3.  组件中修改 vuex 中的数据：`$store.dispatch('action中的方法名',数据)` 或 `$store.commit('mutations中的方法名',数据)`    > 备注：若没有网络请求或其他业务逻辑，组件中也可以越过 actions，即不写`dispatch`，直接编写`commit`### 5.getters 的使用1.  概念：当 state 中的数据需要经过加工后再使用时，可以使用 getters 加工。2.  在`store.js`中追加`getters`配置<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs javascript">......<br><br><span class="hljs-keyword">const</span> getters = &#123;<br><span class="hljs-title function_">bigSum</span>(<span class="hljs-params">state</span>)&#123;<br><span class="hljs-keyword">return</span> state.<span class="hljs-property">sum</span> * <span class="hljs-number">10</span><br>&#125;<br>&#125;<br><br><span class="hljs-comment">//创建并暴露store</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vuex</span>.<span class="hljs-title class_">Store</span>(&#123;<br>......<br>getters<br>&#125;)<br></code></pre></td></tr></table></figure>3.  组件中读取数据：`$store.getters.bigSum`### 6.四个 map 方法的使用1.  **mapState 方法：**用于帮助我们映射`state`中的数据为计算属性<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-attr">computed</span>: &#123;<br>    <span class="hljs-comment">//借助mapState生成计算属性：sum、school、subject（对象写法）</span><br>     ...<span class="hljs-title function_">mapState</span>(&#123;<span class="hljs-attr">sum</span>:<span class="hljs-string">&#x27;sum&#x27;</span>,<span class="hljs-attr">school</span>:<span class="hljs-string">&#x27;school&#x27;</span>,<span class="hljs-attr">subject</span>:<span class="hljs-string">&#x27;subject&#x27;</span>&#125;),<br><br>    <span class="hljs-comment">//借助mapState生成计算属性：sum、school、subject（数组写法）</span><br>    ...<span class="hljs-title function_">mapState</span>([<span class="hljs-string">&#x27;sum&#x27;</span>,<span class="hljs-string">&#x27;school&#x27;</span>,<span class="hljs-string">&#x27;subject&#x27;</span>]),<br>&#125;,<br></code></pre></td></tr></table></figure>2.  **mapGetters 方法：**用于帮助我们映射`getters`中的数据为计算属性<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-attr">computed</span>: &#123;<br>    <span class="hljs-comment">//借助mapGetters生成计算属性：bigSum（对象写法）</span><br>    ...<span class="hljs-title function_">mapGetters</span>(&#123;<span class="hljs-attr">bigSum</span>:<span class="hljs-string">&#x27;bigSum&#x27;</span>&#125;),<br><br>    <span class="hljs-comment">//借助mapGetters生成计算属性：bigSum（数组写法）</span><br>    ...<span class="hljs-title function_">mapGetters</span>([<span class="hljs-string">&#x27;bigSum&#x27;</span>])<br>&#125;,<br></code></pre></td></tr></table></figure>3.  **mapActions 方法：**用于帮助我们生成与`actions`对话的方法，即：包含`$store.dispatch(xxx)`的函数<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-attr">methods</span>:&#123;<br>    <span class="hljs-comment">//靠mapActions生成：incrementOdd、incrementWait（对象形式）</span><br>    ...<span class="hljs-title function_">mapActions</span>(&#123;<span class="hljs-attr">incrementOdd</span>:<span class="hljs-string">&#x27;jiaOdd&#x27;</span>,<span class="hljs-attr">incrementWait</span>:<span class="hljs-string">&#x27;jiaWait&#x27;</span>&#125;)<br><br>    <span class="hljs-comment">//靠mapActions生成：incrementOdd、incrementWait（数组形式）</span><br>    ...<span class="hljs-title function_">mapActions</span>([<span class="hljs-string">&#x27;jiaOdd&#x27;</span>,<span class="hljs-string">&#x27;jiaWait&#x27;</span>])<br>&#125;<br></code></pre></td></tr></table></figure>4.  **mapMutations 方法：**用于帮助我们生成与`mutations`对话的方法，即：包含`$store.commit(xxx)`的函数<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-attr">methods</span>:&#123;<br>    <span class="hljs-comment">//靠mapActions生成：increment、decrement（对象形式）</span><br>    ...<span class="hljs-title function_">mapMutations</span>(&#123;<span class="hljs-attr">increment</span>:<span class="hljs-string">&#x27;JIA&#x27;</span>,<span class="hljs-attr">decrement</span>:<span class="hljs-string">&#x27;JIAN&#x27;</span>&#125;),<br><br>    <span class="hljs-comment">//靠mapMutations生成：JIA、JIAN（对象形式）</span><br>    ...<span class="hljs-title function_">mapMutations</span>([<span class="hljs-string">&#x27;JIA&#x27;</span>,<span class="hljs-string">&#x27;JIAN&#x27;</span>]),<br>&#125;<br></code></pre></td></tr></table></figure>> 备注：mapActions 与 mapMutations 使用时，若需要传递参数需要：在模板中绑定事件时传递好参数，否则参数是事件对象。### 7.模块化+命名空间1.  目的：让代码更好维护，让多种数据分类更加明确。2.  修改`store.js`<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> countAbout = &#123;<br>  <span class="hljs-attr">namespaced</span>:<span class="hljs-literal">true</span>,<span class="hljs-comment">//开启命名空间</span><br>  <span class="hljs-attr">state</span>:&#123;<span class="hljs-attr">x</span>:<span class="hljs-number">1</span>&#125;,<br>  <span class="hljs-attr">mutations</span>: &#123; ... &#125;,<br>  <span class="hljs-attr">actions</span>: &#123; ... &#125;,<br>  <span class="hljs-attr">getters</span>: &#123;<br>    <span class="hljs-title function_">bigSum</span>(<span class="hljs-params">state</span>)&#123;<br>       <span class="hljs-keyword">return</span> state.<span class="hljs-property">sum</span> * <span class="hljs-number">10</span><br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> personAbout = &#123;<br>  <span class="hljs-attr">namespaced</span>:<span class="hljs-literal">true</span>,<span class="hljs-comment">//开启命名空间</span><br>  <span class="hljs-attr">state</span>:&#123; ... &#125;,<br>  <span class="hljs-attr">mutations</span>: &#123; ... &#125;,<br>  <span class="hljs-attr">actions</span>: &#123; ... &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> store = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vuex</span>.<span class="hljs-title class_">Store</span>(&#123;<br>  <span class="hljs-attr">modules</span>: &#123;<br>    countAbout,<br>    personAbout<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>3.  开启命名空间后，组件中读取 state 数据：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//方式一：自己直接读取</span><br><span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-property">state</span>.<span class="hljs-property">personAbout</span>.<span class="hljs-property">list</span><br><span class="hljs-comment">//方式二：借助mapState读取：</span><br>...<span class="hljs-title function_">mapState</span>(<span class="hljs-string">&#x27;countAbout&#x27;</span>,[<span class="hljs-string">&#x27;sum&#x27;</span>,<span class="hljs-string">&#x27;school&#x27;</span>,<span class="hljs-string">&#x27;subject&#x27;</span>]),<br></code></pre></td></tr></table></figure>4.  开启命名空间后，组件中读取 getters 数据：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//方式一：自己直接读取</span><br><span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-property">getters</span>[<span class="hljs-string">&#x27;personAbout/firstPersonName&#x27;</span>]<br><span class="hljs-comment">//方式二：借助mapGetters读取：</span><br>...<span class="hljs-title function_">mapGetters</span>(<span class="hljs-string">&#x27;countAbout&#x27;</span>,[<span class="hljs-string">&#x27;bigSum&#x27;</span>])<br></code></pre></td></tr></table></figure>5.  开启命名空间后，组件中调用 dispatch<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//方式一：自己直接dispatch</span><br><span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-title function_">dispatch</span>(<span class="hljs-string">&#x27;personAbout/addPersonWang&#x27;</span>,person)<br><span class="hljs-comment">//方式二：借助mapActions：</span><br>...<span class="hljs-title function_">mapActions</span>(<span class="hljs-string">&#x27;countAbout&#x27;</span>,&#123;<span class="hljs-attr">incrementOdd</span>:<span class="hljs-string">&#x27;jiaOdd&#x27;</span>,<span class="hljs-attr">incrementWait</span>:<span class="hljs-string">&#x27;jiaWait&#x27;</span>&#125;)<br></code></pre></td></tr></table></figure>6.  开启命名空间后，组件中调用 commit<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//方式一：自己直接commit</span><br><span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&#x27;personAbout/ADD_PERSON&#x27;</span>,person)<br><span class="hljs-comment">//方式二：借助mapMutations：</span><br>...<span class="hljs-title function_">mapMutations</span>(<span class="hljs-string">&#x27;countAbout&#x27;</span>,&#123;<span class="hljs-attr">increment</span>:<span class="hljs-string">&#x27;JIA&#x27;</span>,<span class="hljs-attr">decrement</span>:<span class="hljs-string">&#x27;JIAN&#x27;</span>&#125;),<br></code></pre></td></tr></table></figure>### 求和案例\_纯 vue 版main.js<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./App.vue&quot;</span>;<br><span class="hljs-comment">// 引入插件</span><br><span class="hljs-keyword">import</span> vueResource <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue-resource&quot;</span>;<br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-comment">// 使用插件</span><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(vueResource);<br><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br>  <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#app&quot;</span>,<br>  <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">h</span>) =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>),<br>  <span class="hljs-title function_">beforeCreate</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$bus</span> = <span class="hljs-variable language_">this</span>;<br>  &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure>App.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;container&quot;&gt;    &lt;Count /&gt;  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import Count from &quot;./components/Count&quot;;<br>export default &#123;<br>  name: &quot;App&quot;,<br>  components: &#123;<br>    Count,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>Count.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;category&quot;&gt;<br>       <br>    &lt;h2&gt;当前求和为:&#123;&#123; sum &#125;&#125;&lt;/h2&gt;<br>       <br>    &lt;select v-model.number=&quot;n&quot;&gt;<br>           <br>      &lt;option value=&quot;1&quot;&gt;1&lt;/option&gt;<br>           <br>      &lt;option value=&quot;2&quot;&gt;2&lt;/option&gt;<br>           <br>      &lt;option value=&quot;3&quot;&gt;3&lt;/option&gt;<br>         <br>    &lt;/select&gt;<br>        &lt;button @click=&quot;increament&quot;&gt;+&lt;/button&gt;    <br>    &lt;button @click=&quot;decreament&quot;&gt;-&lt;/button&gt;    <br>    &lt;button @click=&quot;increamentOdd&quot;&gt;当前求和为奇数再加&lt;/button&gt;    <br>    &lt;button @click=&quot;increamentWait&quot;&gt;等一等再加&lt;/button&gt;  <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>export default &#123;<br>  name: &quot;Count&quot;,<br>  data() &#123;<br>    return &#123;<br>      n: 1,<br>      sum: 0,<br>    &#125;;<br>  &#125;,<br>  methods: &#123;<br>    increament() &#123;<br>      this.sum = this.sum + this.n;<br>    &#125;,<br>    decreament() &#123;<br>      this.sum = this.sum - this.n;<br>    &#125;,<br>    increamentOdd() &#123;<br>      if (this.sum % 2) &#123;<br>        this.sum = this.sum + this.n;<br>      &#125;<br>    &#125;,<br>    increamentWait() &#123;<br>      setTimeout(() =&gt; &#123;<br>        this.sum = this.sum + this.n;<br>      &#125;, 500);<br>    &#125;,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>button &#123;<br>  margin-left: 5px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>### 求和案例\_vuex 版main.js<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 引入Vue</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-comment">// 引入App</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./App.vue&quot;</span>;<br><span class="hljs-comment">// 引入插件</span><br><span class="hljs-keyword">import</span> vueResource <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue-resource&quot;</span>;<br><br><span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./store&quot;</span>;<br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-comment">// 使用插件</span><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(vueResource);<br><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br>  <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#app&quot;</span>,<br>  <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">h</span>) =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>),<br>  <span class="hljs-attr">store</span>: store,<br>  <span class="hljs-title function_">beforeCreate</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$bus</span> = <span class="hljs-variable language_">this</span>;<br>  &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure>App.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;container&quot;&gt;    &lt;Count /&gt;  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import Count from &quot;./components/Count&quot;;<br>export default &#123;<br>  name: &quot;App&quot;,<br>  components: &#123;<br>    Count,<br>  &#125;,<br>  mounted() &#123;<br>    console.log(&quot;App&quot;, this);<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>store/index.js<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 该文件用于创建Vuex中最为核心的store</span><br><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vuex</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vuex&quot;</span>;<br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">Vuex</span>);<br><br><span class="hljs-comment">// 准备actions--用于响应组件中的动作</span><br><span class="hljs-keyword">const</span> actions = &#123;<br>  <span class="hljs-comment">// jia:function(context, value) &#123;</span><br>  <span class="hljs-comment">//     console.log(&quot;actions中的jia被调用了&quot;, context, value);</span><br>  <span class="hljs-comment">//     context.commit(&quot;JIA&quot;, value)</span><br>  <span class="hljs-comment">// &#125;,</span><br>  <span class="hljs-comment">// jian:function(context, value) &#123;</span><br>  <span class="hljs-comment">//     console.log(&quot;actions中的jian被调用了&quot;, context, value);</span><br>  <span class="hljs-comment">//     context.commit(&quot;JIAN&quot;, value)</span><br>  <span class="hljs-comment">// &#125;,</span><br>  <span class="hljs-attr">jiaOdd</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">context, value</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;actions中的jiaOdd被调用了&quot;</span>, context, value);<br>    <span class="hljs-keyword">if</span> (context.<span class="hljs-property">state</span>.<span class="hljs-property">sum</span> % <span class="hljs-number">2</span>) &#123;<br>      context.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&quot;JIA&quot;</span>, value);<br>    &#125;<br>  &#125;,<br>  <span class="hljs-attr">jiaWait</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">context, value</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;actions中的jiaWait被调用了&quot;</span>, context, value);<br>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      context.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&quot;JIA&quot;</span>, value);<br>    &#125;, <span class="hljs-number">500</span>);<br>  &#125;,<br>&#125;;<br><br><span class="hljs-comment">// 准备actmutations--用于操作数据</span><br><span class="hljs-keyword">const</span> mutations = &#123;<br>  <span class="hljs-attr">JIA</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">state, value</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;mutations中的JIA被调用了&quot;</span>, state, value);<br>    state.<span class="hljs-property">sum</span> = state.<span class="hljs-property">sum</span> + value;<br>  &#125;,<br>  <span class="hljs-attr">JIAN</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">state, value</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;mutations中的JIAN被调用了&quot;</span>, state, value);<br>    state.<span class="hljs-property">sum</span> = state.<span class="hljs-property">sum</span> - value;<br>  &#125;,<br>&#125;;<br><br><span class="hljs-comment">// 准备state--用于存储数据</span><br><span class="hljs-keyword">const</span> state = &#123;<br>  <span class="hljs-attr">sum</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// 当前的和</span><br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vuex</span>.<span class="hljs-title class_">Store</span>(&#123;<br>  actions,<br>  mutations,<br>  state,<br>&#125;);<br></code></pre></td></tr></table></figure>components/Count.js<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 该文件用于创建Vuex中最为核心的store</span><br><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vuex</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vuex&quot;</span>;<br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">Vuex</span>);<br><br><span class="hljs-comment">// 准备actions--用于响应组件中的动作</span><br><span class="hljs-keyword">const</span> actions = &#123;<br>  <span class="hljs-comment">// jia:function(context, value) &#123;</span><br>  <span class="hljs-comment">//     console.log(&quot;actions中的jia被调用了&quot;, context, value);</span><br>  <span class="hljs-comment">//     context.commit(&quot;JIA&quot;, value)</span><br>  <span class="hljs-comment">// &#125;,</span><br>  <span class="hljs-comment">// jian:function(context, value) &#123;</span><br>  <span class="hljs-comment">//     console.log(&quot;actions中的jian被调用了&quot;, context, value);</span><br>  <span class="hljs-comment">//     context.commit(&quot;JIAN&quot;, value)</span><br>  <span class="hljs-comment">// &#125;,</span><br>  <span class="hljs-attr">jiaOdd</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">context, value</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;actions中的jiaOdd被调用了&quot;</span>, context, value);<br>    <span class="hljs-keyword">if</span> (context.<span class="hljs-property">state</span>.<span class="hljs-property">sum</span> % <span class="hljs-number">2</span>) &#123;<br>      context.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&quot;JIA&quot;</span>, value);<br>    &#125;<br>  &#125;,<br>  <span class="hljs-attr">jiaWait</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">context, value</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;actions中的jiaWait被调用了&quot;</span>, context, value);<br>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      context.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&quot;JIA&quot;</span>, value);<br>    &#125;, <span class="hljs-number">500</span>);<br>  &#125;,<br>&#125;;<br><br><span class="hljs-comment">// 准备actmutations--用于操作数据</span><br><span class="hljs-keyword">const</span> mutations = &#123;<br>  <span class="hljs-attr">JIA</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">state, value</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;mutations中的JIA被调用了&quot;</span>, state, value);<br>    state.<span class="hljs-property">sum</span> = state.<span class="hljs-property">sum</span> + value;<br>  &#125;,<br>  <span class="hljs-attr">JIAN</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">state, value</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;mutations中的JIAN被调用了&quot;</span>, state, value);<br>    state.<span class="hljs-property">sum</span> = state.<span class="hljs-property">sum</span> - value;<br>  &#125;,<br>&#125;;<br><br><span class="hljs-comment">// 准备state--用于存储数据</span><br><span class="hljs-keyword">const</span> state = &#123;<br>  <span class="hljs-attr">sum</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// 当前的和</span><br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vuex</span>.<span class="hljs-title class_">Store</span>(&#123;<br>  actions,<br>  mutations,<br>  state,<br>&#125;);<br></code></pre></td></tr></table></figure>### 求和案例\_gettersmain.js<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 引入Vue</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-comment">// 引入App</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./App.vue&quot;</span>;<br><span class="hljs-comment">// 引入插件</span><br><span class="hljs-keyword">import</span> vueResource <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue-resource&quot;</span>;<br><br><span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./store&quot;</span>;<br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-comment">// 使用插件</span><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(vueResource);<br><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br>  <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#app&quot;</span>,<br>  <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">h</span>) =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>),<br>  <span class="hljs-attr">store</span>: store,<br>  <span class="hljs-title function_">beforeCreate</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$bus</span> = <span class="hljs-variable language_">this</span>;<br>  &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure>App.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;container&quot;&gt;    &lt;Count /&gt;  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import Count from &quot;./components/Count&quot;;<br>export default &#123;<br>  name: &quot;App&quot;,<br>  components: &#123;<br>    Count,<br>  &#125;,<br>  mounted() &#123;<br>    console.log(&quot;App&quot;, this);<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>store/index.js<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 该文件用于创建Vuex中最为核心的store</span><br><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vuex</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vuex&quot;</span>;<br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">Vuex</span>);<br><br><span class="hljs-comment">// 准备actions--用于响应组件中的动作</span><br><span class="hljs-keyword">const</span> actions = &#123;<br>  <span class="hljs-comment">// jia:function(context, value) &#123;</span><br>  <span class="hljs-comment">//     console.log(&quot;actions中的jia被调用了&quot;, context, value);</span><br>  <span class="hljs-comment">//     context.commit(&quot;JIA&quot;, value)</span><br>  <span class="hljs-comment">// &#125;,</span><br>  <span class="hljs-comment">// jian:function(context, value) &#123;</span><br>  <span class="hljs-comment">//     console.log(&quot;actions中的jian被调用了&quot;, context, value);</span><br>  <span class="hljs-comment">//     context.commit(&quot;JIAN&quot;, value)</span><br>  <span class="hljs-comment">// &#125;,</span><br>  <span class="hljs-attr">jiaOdd</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">context, value</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;actions中的jiaOdd被调用了&quot;</span>, context, value);<br>    <span class="hljs-keyword">if</span> (context.<span class="hljs-property">state</span>.<span class="hljs-property">sum</span> % <span class="hljs-number">2</span>) &#123;<br>      context.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&quot;JIA&quot;</span>, value);<br>    &#125;<br>  &#125;,<br>  <span class="hljs-attr">jiaWait</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">context, value</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;actions中的jiaWait被调用了&quot;</span>, context, value);<br>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      context.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&quot;JIA&quot;</span>, value);<br>    &#125;, <span class="hljs-number">500</span>);<br>  &#125;,<br>&#125;;<br><br><span class="hljs-comment">// 准备actmutations--用于操作数据</span><br><span class="hljs-keyword">const</span> mutations = &#123;<br>  <span class="hljs-attr">JIA</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">state, value</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;mutations中的JIA被调用了&quot;</span>, state, value);<br>    state.<span class="hljs-property">sum</span> = state.<span class="hljs-property">sum</span> + value;<br>  &#125;,<br>  <span class="hljs-attr">JIAN</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">state, value</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;mutations中的JIAN被调用了&quot;</span>, state, value);<br>    state.<span class="hljs-property">sum</span> = state.<span class="hljs-property">sum</span> - value;<br>  &#125;,<br>&#125;;<br><br><span class="hljs-comment">// 准备state--用于存储数据</span><br><span class="hljs-keyword">const</span> state = &#123;<br>  <span class="hljs-attr">sum</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// 当前的和</span><br>&#125;;<br><br><span class="hljs-comment">// 准备getters--用于将state中的数据进行加工</span><br><span class="hljs-keyword">const</span> getters = &#123;<br>  <span class="hljs-title function_">bigSum</span>(<span class="hljs-params">state</span>) &#123;<br>    <span class="hljs-keyword">return</span> state.<span class="hljs-property">sum</span> * <span class="hljs-number">10</span>;<br>  &#125;,<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vuex</span>.<span class="hljs-title class_">Store</span>(&#123;<br>  actions,<br>  mutations,<br>  state,<br>  getters,<br>&#125;);<br></code></pre></td></tr></table></figure>components/Count.js<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;category&quot;&gt;<br>       <br>    &lt;h2&gt;当前求和为:&#123;&#123; $store.state.sum &#125;&#125;&lt;/h2&gt;<br>       <br>    &lt;h2&gt;当前求和的10倍为:&#123;&#123; $store.getters.bigSum &#125;&#125;&lt;/h2&gt;<br>       <br>    &lt;select v-model.number=&quot;n&quot;&gt;<br>           <br>      &lt;option value=&quot;1&quot;&gt;1&lt;/option&gt;<br>           <br>      &lt;option value=&quot;2&quot;&gt;2&lt;/option&gt;<br>           <br>      &lt;option value=&quot;3&quot;&gt;3&lt;/option&gt;<br>         <br>    &lt;/select&gt;<br>        &lt;button @click=&quot;increament&quot;&gt;+&lt;/button&gt;    <br>    &lt;button @click=&quot;decreament&quot;&gt;-&lt;/button&gt;    <br>    &lt;button @click=&quot;increamentOdd&quot;&gt;当前求和为奇数再加&lt;/button&gt;    <br>    &lt;button @click=&quot;increamentWait&quot;&gt;等一等再加&lt;/button&gt;  <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>export default &#123;<br>  name: &quot;Count&quot;,<br>  data() &#123;<br>    return &#123;<br>      n: 1,<br>    &#125;;<br>  &#125;,<br>  methods: &#123;<br>    increament() &#123;<br>      this.$store.commit(&quot;JIA&quot;, this.n);<br>    &#125;,<br>    decreament() &#123;<br>      this.$store.commit(&quot;JIAN&quot;, this.n);<br>    &#125;,<br>    increamentOdd() &#123;<br>      this.$store.dispatch(&quot;jiaOdd&quot;, this.n);<br>    &#125;,<br>    increamentWait() &#123;<br>      this.$store.dispatch(&quot;jiaWait&quot;, this.n);<br>    &#125;,<br>  &#125;,<br>  mounted() &#123;<br>    console.log(&quot;Count&quot;, this);<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>button &#123;<br>  margin-left: 5px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>### 求和案例\_mapState 与 mapGettersmain.js<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 引入Vue</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-comment">// 引入App</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./App.vue&quot;</span>;<br><span class="hljs-comment">// 引入插件</span><br><span class="hljs-keyword">import</span> vueResource <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue-resource&quot;</span>;<br><br><span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./store&quot;</span>;<br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-comment">// 使用插件</span><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(vueResource);<br><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br>  <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#app&quot;</span>,<br>  <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">h</span>) =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>),<br>  <span class="hljs-attr">store</span>: store,<br>  <span class="hljs-title function_">beforeCreate</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$bus</span> = <span class="hljs-variable language_">this</span>;<br>  &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure>App.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;container&quot;&gt;    &lt;Count /&gt;  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import Count from &quot;./components/Count&quot;;<br>export default &#123;<br>  name: &quot;App&quot;,<br>  components: &#123;<br>    Count,<br>  &#125;,<br>  mounted() &#123;<br>    // console.log(&#x27;App&#x27;, this)<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>store/index.js<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 该文件用于创建Vuex中最为核心的store</span><br><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vuex</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vuex&quot;</span>;<br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">Vuex</span>);<br><br><span class="hljs-comment">// 准备actions--用于响应组件中的动作</span><br><span class="hljs-keyword">const</span> actions = &#123;<br>  <span class="hljs-comment">// jia:function(context, value) &#123;</span><br>  <span class="hljs-comment">//     console.log(&quot;actions中的jia被调用了&quot;, context, value);</span><br>  <span class="hljs-comment">//     context.commit(&quot;JIA&quot;, value)</span><br>  <span class="hljs-comment">// &#125;,</span><br>  <span class="hljs-comment">// jian:function(context, value) &#123;</span><br>  <span class="hljs-comment">//     console.log(&quot;actions中的jian被调用了&quot;, context, value);</span><br>  <span class="hljs-comment">//     context.commit(&quot;JIAN&quot;, value)</span><br>  <span class="hljs-comment">// &#125;,</span><br>  <span class="hljs-attr">jiaOdd</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">context, value</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;actions中的jiaOdd被调用了&quot;</span>, context, value);<br>    <span class="hljs-keyword">if</span> (context.<span class="hljs-property">state</span>.<span class="hljs-property">sum</span> % <span class="hljs-number">2</span>) &#123;<br>      context.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&quot;JIA&quot;</span>, value);<br>    &#125;<br>  &#125;,<br>  <span class="hljs-attr">jiaWait</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">context, value</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;actions中的jiaWait被调用了&quot;</span>, context, value);<br>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      context.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&quot;JIA&quot;</span>, value);<br>    &#125;, <span class="hljs-number">500</span>);<br>  &#125;,<br>&#125;;<br><br><span class="hljs-comment">// 准备actmutations--用于操作数据</span><br><span class="hljs-keyword">const</span> mutations = &#123;<br>  <span class="hljs-attr">JIA</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">state, value</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;mutations中的JIA被调用了&quot;</span>, state, value);<br>    state.<span class="hljs-property">sum</span> = state.<span class="hljs-property">sum</span> + value;<br>  &#125;,<br>  <span class="hljs-attr">JIAN</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">state, value</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;mutations中的JIAN被调用了&quot;</span>, state, value);<br>    state.<span class="hljs-property">sum</span> = state.<span class="hljs-property">sum</span> - value;<br>  &#125;,<br>&#125;;<br><br><span class="hljs-comment">// 准备state--用于存储数据</span><br><span class="hljs-keyword">const</span> state = &#123;<br>  <span class="hljs-attr">sum</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// 当前的和</span><br>  <span class="hljs-attr">school</span>: <span class="hljs-string">&quot;尚硅谷&quot;</span>,<br>  <span class="hljs-attr">subject</span>: <span class="hljs-string">&quot;前端&quot;</span>,<br>&#125;;<br><br><span class="hljs-comment">// 准备getters--用于将state中的数据进行加工</span><br><span class="hljs-keyword">const</span> getters = &#123;<br>  <span class="hljs-title function_">bigSum</span>(<span class="hljs-params">state</span>) &#123;<br>    <span class="hljs-keyword">return</span> state.<span class="hljs-property">sum</span> * <span class="hljs-number">10</span>;<br>  &#125;,<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vuex</span>.<span class="hljs-title class_">Store</span>(&#123;<br>  actions,<br>  mutations,<br>  state,<br>  getters,<br>&#125;);<br></code></pre></td></tr></table></figure>components/Count.js<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;category&quot;&gt;<br>       <br>    &lt;h2&gt;当前求和为:&#123;&#123; sum &#125;&#125;&lt;/h2&gt;<br>       <br>    &lt;h2&gt;当前求和的10倍为:&#123;&#123; bigSum &#125;&#125;&lt;/h2&gt;<br>       <br>    &lt;h2&gt;我在&#123;&#123; school &#125;&#125;, 学习&#123;&#123; subject &#125;&#125;&lt;/h2&gt;<br>       <br>    &lt;select v-model.number=&quot;n&quot;&gt;<br>           <br>      &lt;option value=&quot;1&quot;&gt;1&lt;/option&gt;<br>           <br>      &lt;option value=&quot;2&quot;&gt;2&lt;/option&gt;<br>           <br>      &lt;option value=&quot;3&quot;&gt;3&lt;/option&gt;<br>         <br>    &lt;/select&gt;<br>        &lt;button @click=&quot;increament&quot;&gt;+&lt;/button&gt;    <br>    &lt;button @click=&quot;decreament&quot;&gt;-&lt;/button&gt;    <br>    &lt;button @click=&quot;increamentOdd&quot;&gt;当前求和为奇数再加&lt;/button&gt;    <br>    &lt;button @click=&quot;increamentWait&quot;&gt;等一等再加&lt;/button&gt;  <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import &#123; mapState, mapGetters &#125; from &quot;vuex&quot;;<br>export default &#123;<br>  name: &quot;Count&quot;,<br>  data() &#123;<br>    return &#123;<br>      n: 1, //用户选择的数字<br>    &#125;;<br>  &#125;,<br>  computed: &#123;<br>    //靠程序员自己亲自去写计算属性<br>    /* sum() &#123;<br>      return this.$store.state.sum;<br>    &#125;,<br>    school() &#123;<br>      return this.$store.state.school;<br>    &#125;,<br>    subject() &#123;<br>      return this.$store.state.subject;<br>    &#125;, */<br><br>    //借助mapState生成计算属性，从state中读取数据。（对象写法）<br>    // ...mapState(&#123;sum: &#x27;sum&#x27;, school: &#x27;school&#x27;, subject: &#x27;subject&#x27;&#125;),<br><br>    //借助mapState生成计算属性，从state中读取数据。（数组写法）<br>    ...mapState([<br>      &quot;sum&quot;,<br>      &quot;school&quot;,<br>      &quot;subject&quot;,<br>    ]) /* ***************************************************** */ /* bigSum() &#123;<br>      return this.$store.getters.bigSum;<br>    &#125;, */, //借助mapGetters生成计算属性，从getters中读取数据。（对象写法） // ...mapGetters(&#123;&#x27;bigSum&#x27;: &#x27;bigSum&#x27;&#125;), //借助mapGetters生成计算属性，从getters中读取数据。（数组写法）<br><br>    ...mapGetters([&quot;bigSum&quot;]),<br>  &#125;,<br>  methods: &#123;<br>    increament() &#123;<br>      this.$store.commit(&quot;JIA&quot;, this.n);<br>    &#125;,<br>    decreament() &#123;<br>      this.$store.commit(&quot;JIAN&quot;, this.n);<br>    &#125;,<br>    increamentOdd() &#123;<br>      this.$store.dispatch(&quot;jiaOdd&quot;, this.n);<br>    &#125;,<br>    increamentWait() &#123;<br>      this.$store.dispatch(&quot;jiaWait&quot;, this.n);<br>    &#125;,<br>  &#125;,<br>  mounted() &#123;<br>    const x = mapState(&#123; sum: &quot;sum&quot;, school: &quot;school&quot;, subject: &quot;subject&quot; &#125;);<br>    console.log(x); // console.log(&quot;Count&quot;, this);<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>button &#123;<br>  margin-left: 5px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>### 求和案例\_mapMutations 与 mapActionsmain.js<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 引入Vue</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-comment">// 引入App</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./App.vue&quot;</span>;<br><span class="hljs-comment">// 引入插件</span><br><span class="hljs-keyword">import</span> vueResource <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue-resource&quot;</span>;<br><br><span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./store&quot;</span>;<br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-comment">// 使用插件</span><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(vueResource);<br><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br>  <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#app&quot;</span>,<br>  <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">h</span>) =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>),<br>  <span class="hljs-attr">store</span>: store,<br>  <span class="hljs-title function_">beforeCreate</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$bus</span> = <span class="hljs-variable language_">this</span>;<br>  &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure>App.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;container&quot;&gt;    &lt;Count /&gt;  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import Count from &quot;./components/Count&quot;;<br>export default &#123;<br>  name: &quot;App&quot;,<br>  components: &#123;<br>    Count,<br>  &#125;,<br>  mounted() &#123;<br>    // console.log(&#x27;App&#x27;, this)<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>store/index.js<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 该文件用于创建Vuex中最为核心的store</span><br><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vuex</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vuex&quot;</span>;<br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">Vuex</span>);<br><br><span class="hljs-comment">// 准备actions--用于响应组件中的动作</span><br><span class="hljs-keyword">const</span> actions = &#123;<br>  <span class="hljs-comment">// jia:function(context, value) &#123;</span><br>  <span class="hljs-comment">//     console.log(&quot;actions中的jia被调用了&quot;, context, value);</span><br>  <span class="hljs-comment">//     context.commit(&quot;JIA&quot;, value)</span><br>  <span class="hljs-comment">// &#125;,</span><br>  <span class="hljs-comment">// jian:function(context, value) &#123;</span><br>  <span class="hljs-comment">//     console.log(&quot;actions中的jian被调用了&quot;, context, value);</span><br>  <span class="hljs-comment">//     context.commit(&quot;JIAN&quot;, value)</span><br>  <span class="hljs-comment">// &#125;,</span><br>  <span class="hljs-attr">jiaOdd</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">context, value</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;actions中的jiaOdd被调用了&quot;</span>, context, value);<br>    <span class="hljs-keyword">if</span> (context.<span class="hljs-property">state</span>.<span class="hljs-property">sum</span> % <span class="hljs-number">2</span>) &#123;<br>      context.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&quot;JIA&quot;</span>, value);<br>    &#125;<br>  &#125;,<br>  <span class="hljs-attr">jiaWait</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">context, value</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;actions中的jiaWait被调用了&quot;</span>, context, value);<br>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      context.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&quot;JIA&quot;</span>, value);<br>    &#125;, <span class="hljs-number">500</span>);<br>  &#125;,<br>&#125;;<br><br><span class="hljs-comment">// 准备actmutations--用于操作数据</span><br><span class="hljs-keyword">const</span> mutations = &#123;<br>  <span class="hljs-attr">JIA</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">state, value</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;mutations中的JIA被调用了&quot;</span>, state, value);<br>    state.<span class="hljs-property">sum</span> = state.<span class="hljs-property">sum</span> + value;<br>  &#125;,<br>  <span class="hljs-attr">JIAN</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">state, value</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;mutations中的JIAN被调用了&quot;</span>, state, value);<br>    state.<span class="hljs-property">sum</span> = state.<span class="hljs-property">sum</span> - value;<br>  &#125;,<br>&#125;;<br><br><span class="hljs-comment">// 准备state--用于存储数据</span><br><span class="hljs-keyword">const</span> state = &#123;<br>  <span class="hljs-attr">sum</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// 当前的和</span><br>  <span class="hljs-attr">school</span>: <span class="hljs-string">&quot;尚硅谷&quot;</span>,<br>  <span class="hljs-attr">subject</span>: <span class="hljs-string">&quot;前端&quot;</span>,<br>&#125;;<br><br><span class="hljs-comment">// 准备getters--用于将state中的数据进行加工</span><br><span class="hljs-keyword">const</span> getters = &#123;<br>  <span class="hljs-title function_">bigSum</span>(<span class="hljs-params">state</span>) &#123;<br>    <span class="hljs-keyword">return</span> state.<span class="hljs-property">sum</span> * <span class="hljs-number">10</span>;<br>  &#125;,<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vuex</span>.<span class="hljs-title class_">Store</span>(&#123;<br>  actions,<br>  mutations,<br>  state,<br>  getters,<br>&#125;);<br></code></pre></td></tr></table></figure>components/Count.js<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;category&quot;&gt;<br>       <br>    &lt;h2&gt;当前求和为:&#123;&#123; sum &#125;&#125;&lt;/h2&gt;<br>       <br>    &lt;h2&gt;当前求和的10倍为:&#123;&#123; bigSum &#125;&#125;&lt;/h2&gt;<br>       <br>    &lt;h2&gt;我在&#123;&#123; school &#125;&#125;, 学习&#123;&#123; subject &#125;&#125;&lt;/h2&gt;<br>       <br>    &lt;select v-model.number=&quot;n&quot;&gt;<br>           <br>      &lt;option value=&quot;1&quot;&gt;1&lt;/option&gt;<br>           <br>      &lt;option value=&quot;2&quot;&gt;2&lt;/option&gt;<br>           <br>      &lt;option value=&quot;3&quot;&gt;3&lt;/option&gt;<br>         <br>    &lt;/select&gt;<br>        &lt;button @click=&quot;increament(n)&quot;&gt;+&lt;/button&gt;    <br>    &lt;button @click=&quot;decreament(n)&quot;&gt;-&lt;/button&gt;    <br>    &lt;button @click=&quot;increamentOdd(n)&quot;&gt;当前求和为奇数再加&lt;/button&gt;    <br>    &lt;button @click=&quot;increamentWait(n)&quot;&gt;等一等再加&lt;/button&gt;  <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import &#123; mapState, mapGetters, mapMutations, mapActions &#125; from &quot;vuex&quot;;<br>export default &#123;<br>  name: &quot;Count&quot;,<br>  data() &#123;<br>    return &#123;<br>      n: 1, //用户选择的数字<br>    &#125;;<br>  &#125;,<br>  computed: &#123;<br>    //借助mapState生成计算属性，从state中读取数据。（对象写法）<br>    // ...mapState(&#123;sum: &#x27;sum&#x27;, school: &#x27;school&#x27;, subject: &#x27;subject&#x27;&#125;),<br><br>    //借助mapState生成计算属性，从state中读取数据。（数组写法）<br>    ...mapState([<br>      &quot;sum&quot;,<br>      &quot;school&quot;,<br>      &quot;subject&quot;,<br>    ]) /* ***************************************************** */, //借助mapGetters生成计算属性，从getters中读取数据。（对象写法） // ...mapGetters(&#123;&#x27;bigSum&#x27;: &#x27;bigSum&#x27;&#125;), //借助mapGetters生成计算属性，从getters中读取数据。（数组写法）<br><br>    ...mapGetters([&quot;bigSum&quot;]),<br>  &#125;,<br>  methods: &#123;<br>    //程序员亲自写方法<br>    /* increament() &#123;<br>      this.$store.commit(&quot;JIA&quot;, this.n);<br>    &#125;,<br>    decreament() &#123;<br>      this.$store.commit(&quot;JIAN&quot;, this.n);<br>    &#125;, */<br><br>    // 不推荐的写法<br>    /* increament() &#123;<br>      this.JIAJIA(this.n);<br>    &#125;,<br>    decreament() &#123;<br>      this.JIANJIAN(this.n);<br>    &#125;,<br>    ...mapMutations(&#123; JIAJIA: &quot;JIA&quot;, JIANJIAN: &quot;JIAN&quot; &#125;), */<br><br>    // 调用的时候需要传参, 不传参, 默认给的参数将会是鼠标点击事件<br>    //借助mapMutations生成对应的方法，方法中会调用commit去联系mutations(对象写法)<br>    ...mapMutations(&#123;<br>      increament: &quot;JIA&quot;,<br>      decreament: &quot;JIAN&quot;,<br>    &#125;) /* **************************************************************** */ /* increamentOdd() &#123; //借助mapMutations生成对应的方法，方法中会调用commit去联系mutations(数组写法) // ...mapMutations([&#x27;JIA&#x27;, &quot;JIAN&quot;]), //程序员亲自写方法<br>      this.$store.dispatch(&quot;jiaOdd&quot;, this.n);<br>    &#125;,<br>    increamentWait() &#123;<br>      this.$store.dispatch(&quot;jiaWait&quot;, this.n);<br>    &#125;, */, //借助mapActions生成对应的方法，方法中会调用dispatch去联系actions(对象写法)<br><br>    ...mapActions(&#123; increamentOdd: &quot;jiaOdd&quot;, increamentWait: &quot;jiaWait&quot; &#125;), //借助mapActions生成对应的方法，方法中会调用dispatch去联系actions(数组写法) // ...mapActions([&#x27;jiaOdd&#x27;, &#x27;jiaWait&#x27;]),<br>  &#125;,<br>  mounted() &#123;<br>    const x = mapState(&#123; sum: &quot;sum&quot;, school: &quot;school&quot;, subject: &quot;subject&quot; &#125;); // console.log(x);<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>button &#123;<br>  margin-left: 5px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>### 求和案例\_多组件共享数据main.js<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 引入Vue</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-comment">// 引入App</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./App.vue&quot;</span>;<br><span class="hljs-comment">// 引入插件</span><br><span class="hljs-keyword">import</span> vueResource <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue-resource&quot;</span>;<br><br><span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./store&quot;</span>;<br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-comment">// 使用插件</span><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(vueResource);<br><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br>  <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#app&quot;</span>,<br>  <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">h</span>) =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>),<br>  <span class="hljs-attr">store</span>: store,<br>  <span class="hljs-title function_">beforeCreate</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$bus</span> = <span class="hljs-variable language_">this</span>;<br>  &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure>App.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;container&quot;&gt;<br>        &lt;Count /&gt;    <br>    &lt;hr /&gt;<br>        &lt;Person /&gt;  <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import Count from &quot;./components/Count&quot;;<br>import Person from &quot;./components/Person&quot;;<br>export default &#123;<br>  name: &quot;App&quot;,<br>  components: &#123;<br>    Count,<br>    Person,<br>  &#125;,<br>  mounted() &#123;<br>    // console.log(&#x27;App&#x27;, this)<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>store/index.js<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 该文件用于创建Vuex中最为核心的store</span><br><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vuex</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vuex&quot;</span>;<br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">Vuex</span>);<br><br><span class="hljs-comment">// 准备actions--用于响应组件中的动作</span><br><span class="hljs-keyword">const</span> actions = &#123;<br>  <span class="hljs-comment">// jia:function(context, value) &#123;</span><br>  <span class="hljs-comment">//     console.log(&quot;actions中的jia被调用了&quot;, context, value);</span><br>  <span class="hljs-comment">//     context.commit(&quot;JIA&quot;, value)</span><br>  <span class="hljs-comment">// &#125;,</span><br>  <span class="hljs-comment">// jian:function(context, value) &#123;</span><br>  <span class="hljs-comment">//     console.log(&quot;actions中的jian被调用了&quot;, context, value);</span><br>  <span class="hljs-comment">//     context.commit(&quot;JIAN&quot;, value)</span><br>  <span class="hljs-comment">// &#125;,</span><br>  <span class="hljs-attr">jiaOdd</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">context, value</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;actions中的jiaOdd被调用了&quot;</span>, context, value);<br>    <span class="hljs-keyword">if</span> (context.<span class="hljs-property">state</span>.<span class="hljs-property">sum</span> % <span class="hljs-number">2</span>) &#123;<br>      context.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&quot;JIA&quot;</span>, value);<br>    &#125;<br>  &#125;,<br>  <span class="hljs-attr">jiaWait</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">context, value</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;actions中的jiaWait被调用了&quot;</span>, context, value);<br>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      context.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&quot;JIA&quot;</span>, value);<br>    &#125;, <span class="hljs-number">500</span>);<br>  &#125;,<br>&#125;;<br><br><span class="hljs-comment">// 准备actmutations--用于操作数据</span><br><span class="hljs-keyword">const</span> mutations = &#123;<br>  <span class="hljs-attr">JIA</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">state, value</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;mutations中的JIA被调用了&quot;</span>, state, value);<br>    state.<span class="hljs-property">sum</span> = state.<span class="hljs-property">sum</span> + value;<br>  &#125;,<br>  <span class="hljs-attr">JIAN</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">state, value</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;mutations中的JIAN被调用了&quot;</span>, state, value);<br>    state.<span class="hljs-property">sum</span> = state.<span class="hljs-property">sum</span> - value;<br>  &#125;,<br>  <span class="hljs-attr">ADD_PERSON</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">state, value</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;mutations中的ADD_PERSON被调用了&quot;</span>, state, value);<br>    state.<span class="hljs-property">personList</span>.<span class="hljs-title function_">unshift</span>(value);<br>  &#125;,<br>&#125;;<br><br><span class="hljs-comment">// 准备state--用于存储数据</span><br><span class="hljs-keyword">const</span> state = &#123;<br>  <span class="hljs-attr">sum</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// 当前的和</span><br>  <span class="hljs-attr">school</span>: <span class="hljs-string">&quot;尚硅谷&quot;</span>,<br>  <span class="hljs-attr">subject</span>: <span class="hljs-string">&quot;前端&quot;</span>,<br>  <span class="hljs-attr">personList</span>: [&#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;001&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;张三&quot;</span> &#125;],<br>&#125;;<br><br><span class="hljs-comment">// 准备getters--用于将state中的数据进行加工</span><br><span class="hljs-keyword">const</span> getters = &#123;<br>  <span class="hljs-title function_">bigSum</span>(<span class="hljs-params">state</span>) &#123;<br>    <span class="hljs-keyword">return</span> state.<span class="hljs-property">sum</span> * <span class="hljs-number">10</span>;<br>  &#125;,<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vuex</span>.<span class="hljs-title class_">Store</span>(&#123;<br>  actions,<br>  mutations,<br>  state,<br>  getters,<br>&#125;);<br></code></pre></td></tr></table></figure>components/Count.js<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;category&quot;&gt;<br>       <br>    &lt;h2&gt;当前求和为:&#123;&#123; sum &#125;&#125;&lt;/h2&gt;<br>       <br>    &lt;h2&gt;当前求和的10倍为:&#123;&#123; bigSum &#125;&#125;&lt;/h2&gt;<br>       <br>    &lt;h2&gt;我在&#123;&#123; school &#125;&#125;, 学习&#123;&#123; subject &#125;&#125;&lt;/h2&gt;<br>       <br>    &lt;h2 style=&quot;color:red&quot;&gt;Person组件的总人数是: &#123;&#123; personList.length &#125;&#125;&lt;/h2&gt;<br>       <br>    &lt;select v-model.number=&quot;n&quot;&gt;<br>           <br>      &lt;option value=&quot;1&quot;&gt;1&lt;/option&gt;<br>           <br>      &lt;option value=&quot;2&quot;&gt;2&lt;/option&gt;<br>           <br>      &lt;option value=&quot;3&quot;&gt;3&lt;/option&gt;<br>         <br>    &lt;/select&gt;<br>        &lt;button @click=&quot;increament(n)&quot;&gt;+&lt;/button&gt;    <br>    &lt;button @click=&quot;decreament(n)&quot;&gt;-&lt;/button&gt;    <br>    &lt;button @click=&quot;increamentOdd(n)&quot;&gt;当前求和为奇数再加&lt;/button&gt;    <br>    &lt;button @click=&quot;increamentWait(n)&quot;&gt;等一等再加&lt;/button&gt;  <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import &#123; mapState, mapGetters, mapMutations, mapActions &#125; from &quot;vuex&quot;;<br>export default &#123;<br>  name: &quot;Count&quot;,<br>  data() &#123;<br>    return &#123;<br>      n: 1, //用户选择的数字<br>    &#125;;<br>  &#125;,<br>  computed: &#123;<br>    //借助mapState生成计算属性，从state中读取数据。（对象写法）<br>    // ...mapState(&#123;sum: &#x27;sum&#x27;, school: &#x27;school&#x27;, subject: &#x27;subject&#x27;&#125;),<br><br>    //借助mapState生成计算属性，从state中读取数据。（数组写法）<br>    ...mapState([<br>      &quot;sum&quot;,<br>      &quot;school&quot;,<br>      &quot;subject&quot;,<br>      &quot;personList&quot;,<br>    ]) /* ***************************************************** */, //借助mapGetters生成计算属性，从getters中读取数据。（对象写法） // ...mapGetters(&#123;&#x27;bigSum&#x27;: &#x27;bigSum&#x27;&#125;), //借助mapGetters生成计算属性，从getters中读取数据。（数组写法）<br><br>    ...mapGetters([&quot;bigSum&quot;]),<br>  &#125;,<br>  methods: &#123;<br>    //借助mapMutations生成对应的方法，方法中会调用commit去联系mutations(对象写法)<br>    ...mapMutations(&#123; increament: &quot;JIA&quot;, decreament: &quot;JIAN&quot; &#125;), //借助mapMutations生成对应的方法，方法中会调用commit去联系mutations(数组写法) // ...mapMutations([&#x27;JIA&#x27;, &quot;JIAN&quot;]), //借助mapActions生成对应的方法，方法中会调用dispatch去联系actions(对象写法)<br><br>    ...mapActions(&#123; increamentOdd: &quot;jiaOdd&quot;, increamentWait: &quot;jiaWait&quot; &#125;), //借助mapActions生成对应的方法，方法中会调用dispatch去联系actions(数组写法) // ...mapActions([&#x27;jiaOdd&#x27;, &#x27;jiaWait&#x27;]),<br>  &#125;,<br>  mounted() &#123;<br>    const x = mapState(&#123; sum: &quot;sum&quot;, school: &quot;school&quot;, subject: &quot;subject&quot; &#125;); // console.log(x);<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>button &#123;<br>  margin-left: 5px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>components/Person.js<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div&gt;<br>       <br>    &lt;h2&gt;人员列表&lt;/h2&gt;<br>       <br>    &lt;h2 style=&quot;color: red&quot;&gt;Count组件的求和为: &#123;&#123; sum &#125;&#125;&lt;/h2&gt;<br>        &lt;input type=&quot;text&quot; placeholder=&quot;请输入名字&quot; v-model=&quot;name&quot; /&gt;    <br>    &lt;button @click=&quot;add&quot;&gt;添加&lt;/button&gt;    <br>    &lt;ul&gt;<br>           <br>      &lt;li v-for=&quot;p in personList&quot; :key=&quot;p.id&quot;&gt;&#123;&#123; p.name &#125;&#125;&lt;/li&gt;<br>         <br>    &lt;/ul&gt;<br>     <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import &#123; nanoid &#125; from &quot;nanoid&quot;;<br>export default &#123;<br>  name: &quot;Person&quot;,<br>  data() &#123;<br>    return &#123;<br>      name: &quot;&quot;,<br>    &#125;;<br>  &#125;,<br>  computed: &#123;<br>    personList() &#123;<br>      return this.$store.state.personList;<br>    &#125;,<br>    sum() &#123;<br>      return this.$store.state.sum;<br>    &#125;,<br>  &#125;,<br>  methods: &#123;<br>    add() &#123;<br>      const personObj = &#123; id: nanoid(), name: this.name &#125;; // console.log(personObj);<br>      this.$store.commit(&quot;ADD_PERSON&quot;, personObj);<br>      this.name = &quot;&quot;;<br>    &#125;,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>### 求和案例\_vuex 模块化编码main.js<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 引入Vue</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-comment">// 引入App</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./App.vue&quot;</span>;<br><span class="hljs-comment">// 引入插件</span><br><span class="hljs-keyword">import</span> vueResource <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue-resource&quot;</span>;<br><br><span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./store&quot;</span>;<br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-comment">// 使用插件</span><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(vueResource);<br><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;<br>  <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#app&quot;</span>,<br>  <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">h</span>) =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>),<br>  <span class="hljs-attr">store</span>: store,<br>  <span class="hljs-title function_">beforeCreate</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$bus</span> = <span class="hljs-variable language_">this</span>;<br>  &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure>App.vue<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;container&quot;&gt;<br>        &lt;Count /&gt;    <br>    &lt;hr /&gt;<br>        &lt;Person /&gt;  <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import Count from &quot;./components/Count&quot;;<br>import Person from &quot;./components/Person&quot;;<br>export default &#123;<br>  name: &quot;App&quot;,<br>  components: &#123;<br>    Count,<br>    Person,<br>  &#125;,<br>  mounted() &#123;<br>    // console.log(&#x27;App&#x27;, this)<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>store/index.js<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 该文件用于创建Vuex中最为核心的store</span><br><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vuex</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vuex&quot;</span>;<br><span class="hljs-keyword">import</span> countOptions <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./count&quot;</span>;<br><span class="hljs-keyword">import</span> personOptions <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./person&quot;</span>;<br><br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">Vuex</span>);<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vuex</span>.<span class="hljs-title class_">Store</span>(&#123;<br>  <span class="hljs-attr">modules</span>: &#123;<br>    <span class="hljs-attr">countAbout</span>: countOptions,<br>    <span class="hljs-attr">personAbout</span>: personOptions,<br>  &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure>store/count.js<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//求和相关的配置</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-attr">namespaced</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-attr">actions</span>: &#123;<br>    <span class="hljs-attr">jiaOdd</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">context, value</span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;actions中的jiaOdd被调用了&quot;</span>, context, value);<br>      <span class="hljs-keyword">if</span> (context.<span class="hljs-property">state</span>.<span class="hljs-property">sum</span> % <span class="hljs-number">2</span>) &#123;<br>        context.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&quot;JIA&quot;</span>, value);<br>      &#125;<br>    &#125;,<br>    <span class="hljs-attr">jiaWait</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">context, value</span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;actions中的jiaWait被调用了&quot;</span>, context, value);<br>      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>        context.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&quot;JIA&quot;</span>, value);<br>      &#125;, <span class="hljs-number">500</span>);<br>    &#125;,<br>  &#125;,<br>  <span class="hljs-attr">mutations</span>: &#123;<br>    <span class="hljs-attr">JIA</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">state, value</span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;mutations中的JIA被调用了&quot;</span>, state, value);<br>      state.<span class="hljs-property">sum</span> = state.<span class="hljs-property">sum</span> + value;<br>    &#125;,<br>    <span class="hljs-attr">JIAN</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">state, value</span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;mutations中的JIAN被调用了&quot;</span>, state, value);<br>      state.<span class="hljs-property">sum</span> = state.<span class="hljs-property">sum</span> - value;<br>    &#125;,<br>  &#125;,<br>  <span class="hljs-attr">state</span>: &#123;<br>    <span class="hljs-attr">sum</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// 当前的和</span><br>    <span class="hljs-attr">school</span>: <span class="hljs-string">&quot;尚硅谷&quot;</span>,<br>    <span class="hljs-attr">subject</span>: <span class="hljs-string">&quot;前端&quot;</span>,<br>  &#125;,<br>  <span class="hljs-attr">getters</span>: &#123;<br>    <span class="hljs-title function_">bigSum</span>(<span class="hljs-params">state</span>) &#123;<br>      <span class="hljs-keyword">return</span> state.<span class="hljs-property">sum</span> * <span class="hljs-number">10</span>;<br>    &#125;,<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure>store/person.js<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//人员管理相关的配置</span><br><span class="hljs-keyword">import</span> &#123; nanoid &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;nanoid&quot;</span>;<br><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;axios&quot;</span>;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-attr">namespaced</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-attr">actions</span>: &#123;<br>    <span class="hljs-title function_">addPersonWang</span>(<span class="hljs-params">context, value</span>) &#123;<br>      <span class="hljs-keyword">if</span> (value.<span class="hljs-property">name</span>.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&quot;王&quot;</span>) === <span class="hljs-number">0</span>) &#123;<br>        context.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&quot;ADD_PERSON&quot;</span>, value);<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;请添加一个姓王的人&quot;</span>);<br>      &#125;<br>    &#125;,<br>    <span class="hljs-title function_">addPersonServer</span>(<span class="hljs-params">context</span>) &#123;<br>      axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;https://api.uixsj.cn/hitokoto/get?type=social&quot;</span>).<span class="hljs-title function_">then</span>(<br>        <span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> &#123;<br>          context.<span class="hljs-title function_">commit</span>(<span class="hljs-string">&quot;ADD_PERSON&quot;</span>, &#123; <span class="hljs-attr">id</span>: <span class="hljs-title function_">nanoid</span>(), <span class="hljs-attr">name</span>: response.<span class="hljs-property">data</span> &#125;);<br>        &#125;,<br>        <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>          <span class="hljs-title function_">alert</span>(error.<span class="hljs-property">message</span>);<br>        &#125;<br>      );<br>    &#125;,<br>  &#125;,<br>  <span class="hljs-attr">mutations</span>: &#123;<br>    <span class="hljs-attr">ADD_PERSON</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">state, value</span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;mutations中的ADD_PERSON被调用了&quot;</span>, state, value);<br>      state.<span class="hljs-property">personList</span>.<span class="hljs-title function_">unshift</span>(value);<br>    &#125;,<br>  &#125;,<br>  <span class="hljs-attr">state</span>: &#123;<br>    <span class="hljs-attr">personList</span>: [&#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;001&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;张三&quot;</span> &#125;],<br>  &#125;,<br>  <span class="hljs-attr">getters</span>: &#123;<br>    <span class="hljs-title function_">firstPersonName</span>(<span class="hljs-params">state</span>) &#123;<br>      <span class="hljs-keyword">return</span> state.<span class="hljs-property">personList</span>[<span class="hljs-number">0</span>].<span class="hljs-property">name</span>;<br>    &#125;,<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure>components/Count.js<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>   <br>  &lt;div class=&quot;category&quot;&gt;<br>       <br>    &lt;h2&gt;当前求和为:&#123;&#123; sum &#125;&#125;&lt;/h2&gt;<br>       <br>    &lt;!-- &lt;h2&gt;当前求和的10倍为:&#123;&#123; bigSum &#125;&#125;&lt;/h2&gt; --&gt;<br>       <br>    &lt;h2&gt;我在&#123;&#123; school &#125;&#125;, 学习&#123;&#123; subject &#125;&#125;&lt;/h2&gt;<br>       <br>    &lt;h2 style=&quot;color:red&quot;&gt;Person组件的总人数是: &#123;&#123; personList.length &#125;&#125;&lt;/h2&gt;<br>       <br>    &lt;select v-model.number=&quot;n&quot;&gt;<br>           <br>      &lt;option value=&quot;1&quot;&gt;1&lt;/option&gt;<br>           <br>      &lt;option value=&quot;2&quot;&gt;2&lt;/option&gt;<br>           <br>      &lt;option value=&quot;3&quot;&gt;3&lt;/option&gt;<br>         <br>    &lt;/select&gt;<br>        &lt;button @click=&quot;increament(n)&quot;&gt;+&lt;/button&gt;    <br>    &lt;button @click=&quot;decreament(n)&quot;&gt;-&lt;/button&gt;    <br>    &lt;button @click=&quot;increamentOdd(n)&quot;&gt;当前求和为奇数再加&lt;/button&gt;    <br>    &lt;button @click=&quot;increamentWait(n)&quot;&gt;等一等再加&lt;/button&gt;  <br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import &#123; mapState, mapGetters, mapMutations, mapActions &#125; from &quot;vuex&quot;;<br>export default &#123;<br>  name: &quot;Count&quot;,<br>  data() &#123;<br>    return &#123;<br>      n: 1, //用户选择的数字<br>    &#125;;<br>  &#125;,<br>  computed: &#123;<br>    //借助mapState生成计算属性，从state中读取数据。（对象写法）<br>    // ...mapState(&#123;sum: &#x27;sum&#x27;, school: &#x27;school&#x27;, subject: &#x27;subject&#x27;&#125;),<br><br>    //借助mapState生成计算属性，从state中读取数据。（数组写法）<br>    ...mapState(&quot;countAbout&quot;, [&quot;sum&quot;, &quot;school&quot;, &quot;subject&quot;]),<br>    ...mapState(&quot;personAbout&quot;, [<br>      &quot;personList&quot;,<br>    ]) /* ***************************************************** */, //借助mapGetters生成计算属性，从getters中读取数据。（对象写法） // ...mapGetters(&#123;&#x27;bigSum&#x27;: &#x27;bigSum&#x27;&#125;), //借助mapGetters生成计算属性，从getters中读取数据。（数组写法） // ...mapGetters([&quot;bigSum&quot;]),<br>  &#125;,<br>  methods: &#123;<br>    //借助mapMutations生成对应的方法，方法中会调用commit去联系mutations(对象写法)<br>    ...mapMutations(&quot;countAbout&quot;, &#123; increament: &quot;JIA&quot;, decreament: &quot;JIAN&quot; &#125;), //借助mapMutations生成对应的方法，方法中会调用commit去联系mutations(数组写法) // ...mapMutations([&#x27;JIA&#x27;, &quot;JIAN&quot;]), //借助mapActions生成对应的方法，方法中会调用dispatch去联系actions(对象写法)<br><br>    ...mapActions(&quot;countAbout&quot;, &#123;<br>      increamentOdd: &quot;jiaOdd&quot;,<br>      increamentWait: &quot;jiaWait&quot;,<br>    &#125;), //借助mapActions生成对应的方法，方法中会调用dispatch去联系actions(数组写法) // ...mapActions([&#x27;jiaOdd&#x27;, &#x27;jiaWait&#x27;]),<br>  &#125;,<br>  mounted() &#123;<br>    // const x = mapState(&#123; sum: &quot;sum&quot;, school: &quot;school&quot;, subject: &quot;subject&quot; &#125;);<br>    console.log(this.$store);<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>button &#123;<br>  margin-left: 5px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>components/Person.js## 路由![](https://cdn.xiamu.icu//FiqIKtuzebXqZRSTvkn-aJAU8tMO.png)![](https://cdn.xiamu.icu//Fpge1Ng9VZ77iS201NfdfyUhxb-f.png)![](https://cdn.xiamu.icu//Fuv9vrT_ZH-JO_YVhWdP-thig-af.png)引入 vue-routervue 的一个插件库, 专门用来实现 SPA 应用2022 年 2 月 7 日以后, vue-router 的默认版本, 为 4 版本vue-router4 只能用在 vue3 中使用vue-router3 才, 能用在 vue2 中此时练习的环境是 vue2, 所以我们安装 vue-router3 版本E:\Code\Vue\vue_test> npm i vue-router@31. 理解： 一个路由（route）就是一组映射关系（key - value），多个路由需要路由器（router）进行管理。2. 前端路由：key 是路径，value 是组件。### 1.基本使用1.  安装 vue-router，命令：`npm i vue-router`2.  应用插件：`Vue.use(VueRouter)`3.  编写 router 配置项:<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//引入VueRouter</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">VueRouter</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue-router&quot;</span>;<br><span class="hljs-comment">//引入Luyou 组件</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">About</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../components/About&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Home</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../components/Home&quot;</span>;<br><br><span class="hljs-comment">//创建router实例对象，去管理一组一组的路由规则</span><br><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VueRouter</span>(&#123;<br>  <span class="hljs-attr">routes</span>: [<br>    &#123;<br>      <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/about&quot;</span>,<br>      <span class="hljs-attr">component</span>: <span class="hljs-title class_">About</span>,<br>    &#125;,<br>    &#123;<br>      <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/home&quot;</span>,<br>      <span class="hljs-attr">component</span>: <span class="hljs-title class_">Home</span>,<br>    &#125;,<br>  ],<br>&#125;);<br><br><span class="hljs-comment">//暴露router</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router;<br></code></pre></td></tr></table></figure>4.  实现切换（active-class 可配置高亮样式）<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;router-link active-class=&quot;active&quot; to=&quot;/about&quot;&gt;About&lt;/router-link&gt;<br></code></pre></td></tr></table></figure>5.  指定展示位置<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;router-view&gt;&lt;/router-view&gt;<br></code></pre></td></tr></table></figure>### 2.几个注意点1. 路由组件通常存放在`pages`文件夹，一般组件通常存放在`components`文件夹。2. 通过切换，“隐藏”了的路由组件，默认是被销毁掉的，需要的时候再去挂载。3. 每个组件都有自己的`$route`属性，里面存储着自己的路由信息。4. 整个应用只有一个 router，可以通过组件的`$router`属性获取到。### 3.多级路由（多级路由）1.  配置路由规则，使用 children 配置项：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-attr">routes</span>: [<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/about&quot;</span>,<br>    <span class="hljs-attr">component</span>: <span class="hljs-title class_">About</span>,<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/home&quot;</span>,<br>    <span class="hljs-attr">component</span>: <span class="hljs-title class_">Home</span>,<br>    <span class="hljs-attr">children</span>: [<br>      <span class="hljs-comment">//通过children配置子级路由</span><br>      &#123;<br>        <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;news&quot;</span>, <span class="hljs-comment">//此处一定不要写：/news</span><br>        <span class="hljs-attr">component</span>: <span class="hljs-title class_">News</span>,<br>      &#125;,<br>      &#123;<br>        <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;message&quot;</span>, <span class="hljs-comment">//此处一定不要写：/message</span><br>        <span class="hljs-attr">component</span>: <span class="hljs-title class_">Message</span>,<br>      &#125;,<br>    ],<br>  &#125;,<br>];<br></code></pre></td></tr></table></figure>2.  跳转（要写完整路径）：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;router-link to=&quot;/home/news&quot;&gt;News&lt;/router-link&gt;<br></code></pre></td></tr></table></figure>### 4.路由的 query 参数1.  传递参数<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;!-- 跳转并携带query参数，to的字符串写法 --&gt;<br>&lt;router-link :to=&quot;/home/message/detail?id=666&amp;title=你好&quot;&gt;跳转&lt;/router-link&gt;<br><br>&lt;!-- 跳转并携带query参数，to的对象写法 --&gt;<br>&lt;router-link<br>  :to=&quot;&#123;<br>    path: &#x27;/home/message/detail&#x27;,<br>    query: &#123;<br>      id: 666,<br>      title: &#x27;你好&#x27;,<br>    &#125;,<br>  &#125;&quot;<br>&gt;跳转&lt;/router-link&gt;<br></code></pre></td></tr></table></figure>2.  接收参数：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript">$route.<span class="hljs-property">query</span>.<span class="hljs-property">id</span>;<br>$route.<span class="hljs-property">query</span>.<span class="hljs-property">title</span>;<br></code></pre></td></tr></table></figure>### 5.命名路由1.  作用：可以简化路由的跳转。2.  如何使用3.  给路由命名：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&#123;<br><span class="hljs-attr">path</span>:<span class="hljs-string">&#x27;/demo&#x27;</span>,<br><span class="hljs-attr">component</span>:<span class="hljs-title class_">Demo</span>,<br><span class="hljs-attr">children</span>:[<br>&#123;<br><span class="hljs-attr">path</span>:<span class="hljs-string">&#x27;test&#x27;</span>,<br><span class="hljs-attr">component</span>:<span class="hljs-title class_">Test</span>,<br><span class="hljs-attr">children</span>:[<br>&#123;<br>                      <span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;hello&#x27;</span> <span class="hljs-comment">//给路由命名</span><br><span class="hljs-attr">path</span>:<span class="hljs-string">&#x27;welcome&#x27;</span>,<br><span class="hljs-attr">component</span>:<span class="hljs-title class_">Hello</span>,<br>&#125;<br>]<br>&#125;<br>]<br>&#125;<br></code></pre></td></tr></table></figure>2.  简化跳转：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;!--简化前，需要写完整的路径 --&gt;<br>&lt;router-link to=&quot;/demo/test/welcome&quot;&gt;跳转&lt;/router-link&gt;<br><br>&lt;!--简化后，直接通过名字跳转 --&gt;<br>&lt;router-link :to=&quot;&#123; name: &#x27;hello&#x27; &#125;&quot;&gt;跳转&lt;/router-link&gt;<br><br>&lt;!--简化写法配合传递参数 --&gt;<br>&lt;router-link<br>  :to=&quot;&#123;<br>    name: &#x27;hello&#x27;,<br>    query: &#123;<br>      id: 666,<br>      title: &#x27;你好&#x27;,<br>    &#125;,<br>  &#125;&quot;<br>&gt;跳转&lt;/router-link&gt;<br></code></pre></td></tr></table></figure>### 6.路由的 params 参数1.  配置路由，声明接收 params 参数<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&#123;<br><span class="hljs-attr">path</span>:<span class="hljs-string">&#x27;/home&#x27;</span>,<br><span class="hljs-attr">component</span>:<span class="hljs-title class_">Home</span>,<br><span class="hljs-attr">children</span>:[<br>&#123;<br><span class="hljs-attr">path</span>:<span class="hljs-string">&#x27;news&#x27;</span>,<br><span class="hljs-attr">component</span>:<span class="hljs-title class_">News</span><br>&#125;,<br>&#123;<br><span class="hljs-attr">component</span>:<span class="hljs-title class_">Message</span>,<br><span class="hljs-attr">children</span>:[<br>&#123;<br><span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;xiangqing&#x27;</span>,<br><span class="hljs-attr">path</span>:<span class="hljs-string">&#x27;detail/:id/:title&#x27;</span>, <span class="hljs-comment">//使用占位符声明接收params参数</span><br><span class="hljs-attr">component</span>:<span class="hljs-title class_">Detail</span><br>&#125;<br>]<br>&#125;<br>]<br>&#125;<br></code></pre></td></tr></table></figure>2.  传递参数<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;!-- 跳转并携带params参数，to的字符串写法 --&gt;<br>&lt;router-link :to=&quot;/home/message/detail/666/你好&quot;&gt;跳转&lt;/router-link&gt;<br><br>&lt;!-- 跳转并携带params参数，to的对象写法 --&gt;<br>&lt;router-link<br>  :to=&quot;&#123;<br>    name: &#x27;xiangqing&#x27;,<br>    params: &#123;<br>      id: 666,<br>      title: &#x27;你好&#x27;,<br>    &#125;,<br>  &#125;&quot;<br>&gt;跳转&lt;/router-link&gt;<br></code></pre></td></tr></table></figure>3.  接收参数：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript">$route.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>;<br>$route.<span class="hljs-property">params</span>.<span class="hljs-property">title</span>;<br></code></pre></td></tr></table></figure>### 7.路由的 props 配置    作用：让路由组件更方便的收到参数<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&#123;<br><span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;xiangqing&#x27;</span>,<br><span class="hljs-attr">path</span>:<span class="hljs-string">&#x27;detail/:id&#x27;</span>,<br><span class="hljs-attr">component</span>:<span class="hljs-title class_">Detail</span>,<br><br><span class="hljs-comment">//第一种写法：props值为对象，该对象中所有的key-value的组合最终都会通过props传给Detail组件</span><br><span class="hljs-comment">// props:&#123;a:900&#125;</span><br><br><span class="hljs-comment">//第二种写法：props值为布尔值，布尔值为true，则把路由收到的所有params参数通过props传给Detail组件</span><br><span class="hljs-comment">// props:true</span><br><br><span class="hljs-comment">//第三种写法：props值为函数，该函数返回的对象中每一组key-value都会通过props传给Detail组件</span><br><span class="hljs-title function_">props</span>(<span class="hljs-params">route</span>)&#123;<br><span class="hljs-keyword">return</span> &#123;<br><span class="hljs-attr">id</span>:route.<span class="hljs-property">query</span>.<span class="hljs-property">id</span>,<br><span class="hljs-attr">title</span>:route.<span class="hljs-property">query</span>.<span class="hljs-property">title</span><br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure>### 8.`<router-link>`的 replace 属性1. 作用：控制路由跳转时操作浏览器历史记录的模式2. 浏览器的历史记录有两种写入方式：分别为`push`和`replace`，`push`是追加历史记录，`replace`是替换当前记录。路由跳转时候默认为`push`3. 如何开启`replace`模式：`<router-link replace .......>News</router-link>`### 9.编程式路由导航1.  作用：不借助`<router-link>`实现路由跳转，让路由跳转更加灵活2.  具体编码：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//$router的两个API</span><br><span class="hljs-variable language_">this</span>.<span class="hljs-property">$router</span>.<span class="hljs-title function_">push</span>(&#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;xiangqing&quot;</span>,<br>  <span class="hljs-attr">params</span>: &#123;<br>    <span class="hljs-attr">id</span>: xxx,<br>    <span class="hljs-attr">title</span>: xxx,<br>  &#125;,<br>&#125;);<br><br><span class="hljs-variable language_">this</span>.<span class="hljs-property">$router</span>.<span class="hljs-title function_">replace</span>(&#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;xiangqing&quot;</span>,<br>  <span class="hljs-attr">params</span>: &#123;<br>    <span class="hljs-attr">id</span>: xxx,<br>    <span class="hljs-attr">title</span>: xxx,<br>  &#125;,<br>&#125;);<br><span class="hljs-variable language_">this</span>.<span class="hljs-property">$router</span>.<span class="hljs-title function_">forward</span>(); <span class="hljs-comment">//前进</span><br><span class="hljs-variable language_">this</span>.<span class="hljs-property">$router</span>.<span class="hljs-title function_">back</span>(); <span class="hljs-comment">//后退</span><br><span class="hljs-variable language_">this</span>.<span class="hljs-property">$router</span>.<span class="hljs-title function_">go</span>(); <span class="hljs-comment">//可前进也可后退</span><br></code></pre></td></tr></table></figure>### 10.缓存路由组件1.  作用：让不展示的路由组件保持挂载，不被销毁。2.  具体编码：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;keep-alive include=&quot;News&quot;&gt; <br>    &lt;router-view&gt;&lt;/router-view&gt;<br>&lt;/keep-alive&gt;<br></code></pre></td></tr></table></figure>### 11.两个新的生命周期钩子1. 作用：路由组件所独有的两个钩子，用于捕获路由组件的激活状态。2. 具体名字：   1. `activated`路由组件被激活时触发。   2. `deactivated`路由组件失活时触发。### 12.路由守卫1.  作用：对路由进行权限控制2.  分类：全局守卫、独享守卫、组件内守卫3.  全局守卫:<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//全局前置守卫：初始化时执行、每次路由切换前执行</span><br>router.<span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">(<span class="hljs-params">to, <span class="hljs-keyword">from</span>, next</span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;beforeEach&quot;</span>, to, <span class="hljs-keyword">from</span>);<br>  <span class="hljs-keyword">if</span> (to.<span class="hljs-property">meta</span>.<span class="hljs-property">isAuth</span>) &#123;<br>    <span class="hljs-comment">//判断当前路由是否需要进行权限控制</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&quot;school&quot;</span>) === <span class="hljs-string">&quot;atguigu&quot;</span>) &#123;<br>      <span class="hljs-comment">//权限控制的具体规则</span><br>      <span class="hljs-title function_">next</span>(); <span class="hljs-comment">//放行</span><br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;暂无权限查看&quot;</span>);<br>      <span class="hljs-comment">// next(&#123;name:&#x27;guanyu&#x27;&#125;)</span><br>    &#125;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-title function_">next</span>(); <span class="hljs-comment">//放行</span><br>  &#125;<br>&#125;);<br><br><span class="hljs-comment">//全局后置守卫：初始化时执行、每次路由切换后执行</span><br>router.<span class="hljs-title function_">afterEach</span>(<span class="hljs-function">(<span class="hljs-params">to, <span class="hljs-keyword">from</span></span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;afterEach&quot;</span>, to, <span class="hljs-keyword">from</span>);<br>  <span class="hljs-keyword">if</span> (to.<span class="hljs-property">meta</span>.<span class="hljs-property">title</span>) &#123;<br>    <span class="hljs-variable language_">document</span>.<span class="hljs-property">title</span> = to.<span class="hljs-property">meta</span>.<span class="hljs-property">title</span>; <span class="hljs-comment">//修改网页的title</span><br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable language_">document</span>.<span class="hljs-property">title</span> = <span class="hljs-string">&quot;vue_test&quot;</span>;<br>  &#125;<br>&#125;);<br></code></pre></td></tr></table></figure>4.  独享守卫:<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title function_">beforeEnter</span>(<span class="hljs-params">to,<span class="hljs-keyword">from</span>,next</span>)&#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;beforeEnter&#x27;</span>,to,<span class="hljs-keyword">from</span>)<br><span class="hljs-keyword">if</span>(to.<span class="hljs-property">meta</span>.<span class="hljs-property">isAuth</span>)&#123; <span class="hljs-comment">//判断当前路由是否需要进行权限控制</span><br><span class="hljs-keyword">if</span>(<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&#x27;school&#x27;</span>) === <span class="hljs-string">&#x27;atguigu&#x27;</span>)&#123;<br><span class="hljs-title function_">next</span>()<br>&#125;<span class="hljs-keyword">else</span>&#123;<br><span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;暂无权限查看&#x27;</span>)<br><span class="hljs-comment">// next(&#123;name:&#x27;guanyu&#x27;&#125;)</span><br>&#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br><span class="hljs-title function_">next</span>()<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure>5.  组件内守卫：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//进入守卫：通过路由规则，进入该组件时被调用</span><br>beforeRouteEnter (to, <span class="hljs-keyword">from</span>, next) &#123;<br>&#125;,<br><span class="hljs-comment">//离开守卫：通过路由规则，离开该组件时被调用</span><br>beforeRouteLeave (to, <span class="hljs-keyword">from</span>, next) &#123;<br>&#125;<br></code></pre></td></tr></table></figure>### 13.路由器的两种工作模式部署项目npm run buildnpm initnpm i express1.  对于一个 url 来说，什么是 hash 值？—— #及其后面的内容就是 hash 值。2.  hash 值不会包含在 HTTP 请求中，即：hash 值不会带给服务器。3.  hash 模式：4.  地址中永远带着#号，不美观 。5.  若以后将地址通过第三方手机 app 分享，若 app 校验严格，则地址会被标记为不合法。6.  兼容性较好。7.  history 模式：8.  地址干净，美观 。9.  兼容性和 hash 模式相比略差。10. 应用部署上线时需要后端人员支持，解决刷新页面服务端 404 的问题。## 使用 element-ui安装 element-uinpm i element-ui按需引入npm install babel-plugin-component -D]]></content>
    
    
    <categories>
      
      <category>Vue</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Vue</title>
    <link href="/Vue/Vue/"/>
    <url>/Vue/Vue/</url>
    
    <content type="html"><![CDATA[<h2 id="Vue-的安装"><a href="#Vue-的安装" class="headerlink" title="Vue 的安装"></a>Vue 的安装</h2><p>在 vue 的官网中下载 vue.js</p><p><img src="/assets/322cc2863e0649dc916f757b52e4d3d4.png"><br>vue.js 一般使用在开发环境中, vue.min.js 一般使用在生产环境中</p><p>然后创建一个.html 文件, 在页面上运行</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>初始Vue<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>在页面上打开 F12, 发现有两条提示<br><img src="/assets/106e9e85779f4ddf85bd696bb2a887f4.png"><br>第一个提示, 需要我们下载一个 Vue 的拓展来开发<br><a href="https://devtools.vuejs.org/guide/installation.html">https://devtools.vuejs.org/guide/installation.html</a>下载地址<br><img src="/assets/490e86a8651846b3b4ebe30b98a313d7.png"><br>下载完成之后会在右上角显示<br><img src="/assets/ad98b0e6d3cd457283b6dd9823d7c1f5.png"><br>第二个提示, 则是我们需要在生产环境中使用 vue.min.js<br>这代码编写的过程中, 我们可以关闭这个提示<br><img src="/assets/18c915ca39ed4cc8938af83e80c7cca9.png"><br>Vue.config.productionTip&#x3D;false</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p>再回过头看控制台, 警告就消失了<br><img src="/assets/9de53484d7d94440999af06e1f7f91e1.png"></p><h2 id="初识-Vue"><a href="#初识-Vue" class="headerlink" title="初识 Vue"></a>初识 Vue</h2><p>容器跟组件只能一对一</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crystal"><span class="hljs-template-variable">&#123;&#123;&#125;&#125;</span><br></code></pre></td></tr></table></figure><p>叫插值语法, 插值表达式</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>初始Vue<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br>  <span class="hljs-comment">&lt;!-- </span><br><span class="hljs-comment">初识Vue：</span><br><span class="hljs-comment">1.想让Vue工作，就必须创建一个Vue实例，且要传入一个配置对象；</span><br><span class="hljs-comment">2.root容器里的代码依然符合html规范，只不过混入了一些特殊的Vue语法；</span><br><span class="hljs-comment">3.root容器里的代码被称为【Vue模板】；</span><br><span class="hljs-comment">4.Vue实例和容器是一一对应的；</span><br><span class="hljs-comment">5.真实开发中只有一个Vue实例，并且会配合着组件一起使用；</span><br><span class="hljs-comment">6.&#123;&#123;xxx&#125;&#125;中的xxx要写js表达式，且xxx可以自动读取到data中的所有属性；</span><br><span class="hljs-comment">7.一旦data中的数据发生改变，那么页面中用到该数据的地方也会自动更新；</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">注意区分：js表达式 和 js代码(语句)</span><br><span class="hljs-comment">1.表达式：一个表达式会产生一个值，可以放在任何一个需要值的地方：</span><br><span class="hljs-comment">(1). a</span><br><span class="hljs-comment">(2). a+b</span><br><span class="hljs-comment">(3). demo(1)</span><br><span class="hljs-comment">(4). x === y ? &#x27;a&#x27; : &#x27;b&#x27;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">2.js代码(语句)</span><br><span class="hljs-comment">(1). if()&#123;&#125;</span><br><span class="hljs-comment">(2). for()&#123;&#125;</span><br><span class="hljs-comment">--&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello, &#123;&#123;name&#125;&#125;, &#123;&#123;address&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>; <span class="hljs-comment">// 阻止 vue 在启动时生成生产提示</span></span><br><span class="language-javascript">      <span class="hljs-comment">// 创建Vue实例</span></span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> x = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>, <span class="hljs-comment">// el用于指定当前实例为哪个容器服务, 值通过为css选择器字符串</span></span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-comment">// data中用于存储数据, 数据el所指定的容器去试用, 值我们暂时写写成一个对象</span></span><br><span class="language-javascript">          <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;尚硅谷&quot;</span>,</span><br><span class="language-javascript">          <span class="hljs-attr">address</span>: <span class="hljs-string">&quot;北京&quot;</span>,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>v-bind 可以简写 :</p><h2 id="模板语法"><a href="#模板语法" class="headerlink" title="模板语法"></a>模板语法</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- </span><br><span class="hljs-comment">Vue模板语法有2大类：</span><br><span class="hljs-comment">1.插值语法：</span><br><span class="hljs-comment">功能：用于解析标签体内容。</span><br><span class="hljs-comment">写法：&#123;&#123;xxx&#125;&#125;，xxx是js表达式，且可以直接读取到data中的所有属性。</span><br><span class="hljs-comment">2.指令语法：</span><br><span class="hljs-comment">功能：用于解析标签（包括：标签属性、标签体内容、绑定事件.....）。</span><br><span class="hljs-comment">举例：v-bind:href=&quot;xxx&quot; 或  简写为 :href=&quot;xxx&quot;，xxx同样要写js表达式，</span><br><span class="hljs-comment"> 且可以直接读取到data中的所有属性。</span><br><span class="hljs-comment">备注：Vue中有很多的指令，且形式都是：v-????，此处我们只是拿v-bind举个例子。</span><br><span class="hljs-comment"> --&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">v-bind:href</span>=<span class="hljs-string">&quot;school.url&quot;</span> <span class="hljs-attr">x</span>=<span class="hljs-string">&quot;hello&quot;</span>&gt;</span>去尚硅谷<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">:href</span>=<span class="hljs-string">&quot;school.url.toUpperCase()&quot;</span> <span class="hljs-attr">x</span>=<span class="hljs-string">&quot;hello&quot;</span>&gt;</span>去尚硅谷<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">    <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>,</span><br><span class="language-javascript">    <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">      <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;jack&quot;</span>,</span><br><span class="language-javascript">      <span class="hljs-attr">school</span>: &#123;</span><br><span class="language-javascript">        <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;尚硅谷&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;http://www.atguigu.com&quot;</span>,</span><br><span class="language-javascript">      &#125;,</span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">  &#125;);</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="数据绑定"><a href="#数据绑定" class="headerlink" title="数据绑定"></a>数据绑定</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- </span><br><span class="hljs-comment">            Vue中有2种数据绑定的方式：</span><br><span class="hljs-comment">                    1.单向绑定(v-bind)：数据只能从data流向页面。</span><br><span class="hljs-comment">                    2.双向绑定(v-model)：数据不仅能从data流向页面，还可以从页面流向data。</span><br><span class="hljs-comment">                        备注：</span><br><span class="hljs-comment">                                1.双向绑定一般都应用在表单类元素上（如：input、select等）</span><br><span class="hljs-comment">                                2.v-model:value 可以简写为 v-model，因为v-model默认收集的就是value值。</span><br><span class="hljs-comment">         --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>  <span class="hljs-comment">&lt;!-- 单向数据绑定: &lt;input type=&quot;text&quot; v-bind:value=&quot;name&quot;&gt;&lt;br&gt;</span><br><span class="hljs-comment">        双向数据绑定: &lt;input type=&quot;text&quot; v-model:value=&quot;name&quot;&gt; --&gt;</span><br><br>  单向数据绑定: <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">:value</span>=<span class="hljs-string">&quot;name&quot;</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>  双向数据绑定: <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;name&quot;</span> /&gt;</span><br><br>  <span class="hljs-comment">&lt;!-- 如下代码是错误的, 因为v-model只能应用在表单类(输入类元素上) --&gt;</span><br>  <span class="hljs-comment">&lt;!-- &lt;h2 v-model:x=&quot;name&quot;&gt;你好啊&lt;/h2&gt; --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">    <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>,</span><br><span class="language-javascript">    <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">      <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;尚硅谷&quot;</span>,</span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">  &#125;);</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="/assets/f4221b1ddb9942c29ebeda6a0c3162d4.png"></p><h2 id="el-与-data-的两种写法"><a href="#el-与-data-的两种写法" class="headerlink" title="el 与 data 的两种写法"></a>el 与 data 的两种写法</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- </span><br><span class="hljs-comment">data与el的2种写法</span><br><span class="hljs-comment">1.el有2种写法</span><br><span class="hljs-comment">(1).new Vue时候配置el属性。</span><br><span class="hljs-comment">(2).先创建Vue实例，随后再通过vm.$mount(&#x27;#root&#x27;)指定el的值。</span><br><span class="hljs-comment">2.data有2种写法</span><br><span class="hljs-comment">(1).对象式</span><br><span class="hljs-comment">(2).函数式</span><br><span class="hljs-comment">如何选择：目前哪种写法都可以，以后学习到组件时，data必须使用函数式，否则会报错。</span><br><span class="hljs-comment">3.一个重要的原则：</span><br><span class="hljs-comment">由Vue管理的函数，一定不要写箭头函数，一旦写了箭头函数，this就不再是Vue实例了。</span><br><span class="hljs-comment">--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>你好, &#123;&#123;name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-comment">// el的两种写法</span></span><br><span class="language-javascript">  <span class="hljs-keyword">const</span> v = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">    <span class="hljs-comment">// el: &#x27;#root&#x27;, // 第一种写法</span></span><br><span class="language-javascript">    <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">      <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;尚硅谷&quot;</span>,</span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">  &#125;);</span><br><span class="language-javascript">  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(v);</span><br><span class="language-javascript">  v.$mount(<span class="hljs-string">&quot;#root&quot;</span>); <span class="hljs-comment">// 第二种写法</span></span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-comment">// data的两种写法</span></span><br><span class="language-javascript">  <span class="hljs-comment">//data的第一种写法: 对象式</span></span><br><span class="language-javascript">  <span class="hljs-comment">/*         new Vue(&#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">                    el: &#x27;#root&#x27;,</span></span><br><span class="hljs-comment"><span class="language-javascript">                    data: &#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">                        name: &#x27;尚硅谷&#x27;</span></span><br><span class="hljs-comment"><span class="language-javascript">                    &#125;,</span></span><br><span class="hljs-comment"><span class="language-javascript">                &#125;) */</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-comment">//data的第二种写法: 函数式</span></span><br><span class="language-javascript">  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">    <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>,</span><br><span class="language-javascript">    <span class="hljs-attr">data</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-keyword">return</span> &#123;</span><br><span class="language-javascript">        <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;尚硅谷&quot;</span>,</span><br><span class="language-javascript">      &#125;;</span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">  &#125;);</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="理解-MVVM"><a href="#理解-MVVM" class="headerlink" title="理解 MVVM"></a>理解 MVVM</h2><h3 id="编写代码片段"><a href="#编写代码片段" class="headerlink" title="编写代码片段"></a>编写代码片段</h3><p><img src="/assets/cdb27b8271644788be53e2556eca893b.png"><br><img src="/assets/e0478a2aa19e485fb268a65a8353ddbb.png"><br>复制如下代码保存</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;Print to console&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;scope&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;html, javascript, typescript&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;prefix&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;v1&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;body&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>      <span class="hljs-string">&quot;new Vue(&#123;&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-string">&quot;    el: &#x27;#root&#x27;,&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-string">&quot;    data: &#123;&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-string">&quot;        $1&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-string">&quot;    &#125;&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-string">&quot;&#125;)&quot;</span><br>    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;description&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;生成一个Vue实例&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>在页面中只需要输入 v1, 就可以快速创建一个 Vue 实例, 非常的方便<br><img src="/assets/9e8feb4f6aba4781a8daa6d6014ec9a5.png"><br><img src="/assets/94d5e64dd3d944fd84bdb4ecc2a670c1.png"></p><h3 id="MVVM-模型"><a href="#MVVM-模型" class="headerlink" title="MVVM 模型"></a>MVVM 模型</h3><ol><li>M：模型(Model) ：对应 data 中的数据</li><li>V：视图(View) ：模板</li><li>VM：视图模型(ViewModel) ： Vue 实例对象</li></ol><p><img src="/assets/32e0362ba38e4bf38e67fc2abfe0ba45.png"><br>MVVM 模型就是把一些乱七八糟的数据和一堆乱七八糟的 DOM 结构在中间使用 VM 连接<br><img src="/assets/6a4a6c8989d14a4cbadae288ba67fa78.png"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- </span><br><span class="hljs-comment">            MVVM模型</span><br><span class="hljs-comment">                        1. M：模型(Model) ：data中的数据</span><br><span class="hljs-comment">                        2. V：视图(View) ：模板代码</span><br><span class="hljs-comment">                        3. VM：视图模型(ViewModel)：Vue实例</span><br><span class="hljs-comment">            观察发现：</span><br><span class="hljs-comment">                        1.data中所有的属性，最后都出现在了vm身上。</span><br><span class="hljs-comment">                        2.vm身上所有的属性 及 Vue原型上所有属性，在Vue模板中都可以直接使用。</span><br><span class="hljs-comment">        --&gt;</span><br></code></pre></td></tr></table></figure><h2 id="回顾-Object-defineProperty-方法"><a href="#回顾-Object-defineProperty-方法" class="headerlink" title="回顾 Object.defineProperty 方法"></a>回顾 Object.defineProperty 方法</h2><h3 id="enumerable"><a href="#enumerable" class="headerlink" title="enumerable"></a>enumerable</h3><p>此时这种写法是可以遍历 person 的属性的<br><img src="/assets/59d482a22c8840dca97a06359085a055.png"><br><img src="/assets/65b5fc4cab294dd389ed6a090a3c43ea.png"><br><img src="/assets/dd0df57e651249af9d731576ec359eab.png"><br>从上可以观察到 Object.defineProperty 定义的属性, 默认是不能被遍历的<br>只有设置了 enumerable: true 才能被遍历</p><h3 id="writable"><a href="#writable" class="headerlink" title="writable"></a>writable</h3><p><img src="/assets/8183f7e3d8cc4283afdb41e946cce701.png"><br><img src="/assets/50f9764837a74d2fb9ddbfee53ff935f.png"><br><img src="/assets/8abf4864aea2457c8bc191777dbd0abd.png"><br>从上面可以观察到 Object.defineProperty 定义的属性, 默认是不能修改的<br>只有设置了  writable: true, 才能被修改</p><p><img src="/assets/9ef0fb6948c54e578c48991dbf7c54aa.png"><br><img src="/assets/d8f71e066503470c83b8dc2304157bb2.png"><br><img src="/assets/1f6f12b1d5e34423951cd3dede8761ac.png"><br>从上面可以观察到 Object.defineProperty 定义的属性, 默认是不能删除的<br>只有设置了  configurable: true 才能被删除</p><h2 id="数据代理"><a href="#数据代理" class="headerlink" title="数据代理"></a>数据代理</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- </span><br><span class="hljs-comment">1.Vue中的数据代理：</span><br><span class="hljs-comment">通过vm对象来代理data对象中属性的操作（读/写）</span><br><span class="hljs-comment">2.Vue中数据代理的好处：</span><br><span class="hljs-comment">更加方便的操作data中的数据</span><br><span class="hljs-comment">3.基本原理：</span><br><span class="hljs-comment">通过Object.defineProperty()把data对象中所有属性添加到vm上。</span><br><span class="hljs-comment">为每一个添加到vm上的属性，都指定一个getter/setter。</span><br><span class="hljs-comment">在getter/setter内部去操作（读/写）data中对应的属性。</span><br><span class="hljs-comment">--&gt;</span><br><br><span class="hljs-comment">&lt;!-- 数据代理: 通过一个对象代理对另一个对象中属性的操作 (读/写) --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-keyword">let</span> obj = &#123; <span class="hljs-attr">x</span>: <span class="hljs-number">100</span> &#125;;</span><br><span class="language-javascript">  <span class="hljs-keyword">let</span> obj2 = &#123; <span class="hljs-attr">y</span>: <span class="hljs-number">200</span> &#125;;</span><br><span class="language-javascript">  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(obj2, <span class="hljs-string">&quot;x&quot;</span>, &#123;</span><br><span class="language-javascript">    <span class="hljs-title function_">get</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-keyword">return</span> obj.<span class="hljs-property">x</span>;</span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">    <span class="hljs-title function_">set</span>(<span class="hljs-params">value</span>) &#123;</span><br><span class="language-javascript">      obj.<span class="hljs-property">x</span> = value;</span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">  &#125;);</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="/assets/f698074765464f9e8a2dc5b17354ac58.png"><br>修改了 obj2.x 的值, obj.x 值也随之发生了变化</p><p><img src="/assets/81de5fbe172042b89c39c9e6e8383e8b.png"></p><p>vm 中使用了 Object.defineProperty 代理了_data 的属性<br>_data.name 中有 data 的值<br><img src="/assets/8bcf13225a5748fab64727eb76c44ffa.png"></p><h2 id="事件处理"><a href="#事件处理" class="headerlink" title="事件处理"></a>事件处理</h2><p>事件的基本使用</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- </span><br><span class="hljs-comment">                事件的基本使用：</span><br><span class="hljs-comment">                            1.使用v-on:xxx 或 @xxx 绑定事件，其中xxx是事件名；</span><br><span class="hljs-comment">                            2.事件的回调需要配置在methods对象中，最终会在vm上；</span><br><span class="hljs-comment">                            3.methods中配置的函数，不要用箭头函数！否则this就不是vm了；</span><br><span class="hljs-comment">                            4.methods中配置的函数，都是被Vue所管理的函数，this的指向是vm 或 组件实例对象；</span><br><span class="hljs-comment">                            5.@click=&quot;demo&quot; 和 @click=&quot;demo($event)&quot; 效果一致，但后者可以传参；</span><br><span class="hljs-comment">    --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>欢迎来到&#123;&#123;name&#125;&#125;学习<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">v-on:click</span>=<span class="hljs-string">&quot;showInfo1&quot;</span>&gt;</span>点我提示信息<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;showInfo2(66, $event)&quot;</span>&gt;</span>点我提示信息<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-keyword">const</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">    <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>,</span><br><span class="language-javascript">    <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">      <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;尚硅谷&quot;</span>,</span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">    <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">      <span class="hljs-title function_">showInfo1</span>(<span class="hljs-params">event</span>) &#123;</span><br><span class="language-javascript">        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(event.<span class="hljs-property">target</span>.<span class="hljs-property">innerText</span>);</span><br><span class="language-javascript">        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>); <span class="hljs-comment">// 此处的this是vm对象</span></span><br><span class="language-javascript">        <span class="hljs-comment">// alert(&#x27;同学您好!&#x27;);</span></span><br><span class="language-javascript">      &#125;,</span><br><span class="language-javascript">      <span class="hljs-title function_">showInfo2</span>(<span class="hljs-params">number, a</span>) &#123;</span><br><span class="language-javascript">        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a);</span><br><span class="language-javascript">        <span class="hljs-comment">// console.log(event.target.innerText);</span></span><br><span class="language-javascript">        <span class="hljs-comment">// console.log(this); // 此处的this是vm对象</span></span><br><span class="language-javascript">        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(number);</span><br><span class="language-javascript">        <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;同学您好!!&quot;</span>);</span><br><span class="language-javascript">      &#125;,</span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">  &#125;);</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p>事件修饰符</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>事件修饰符<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css">              * &#123;</span><br><span class="language-css">                  <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">20px</span>;</span><br><span class="language-css">              &#125;</span><br><span class="language-css"></span><br><span class="language-css"></span><br><span class="language-css">              <span class="hljs-selector-class">.demo1</span> &#123;</span><br><span class="language-css">                  <span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>;</span><br><span class="language-css">                  <span class="hljs-attribute">background-color</span>: skyblue;</span><br><span class="language-css">              &#125;</span><br><span class="language-css"></span><br><span class="language-css"></span><br><span class="language-css">              <span class="hljs-selector-class">.box1</span> &#123;</span><br><span class="language-css">                  <span class="hljs-attribute">padding</span>: <span class="hljs-number">5px</span>;</span><br><span class="language-css">                  <span class="hljs-attribute">background-color</span>: skyblue;</span><br><span class="language-css">              &#125;</span><br><span class="language-css"></span><br><span class="language-css"></span><br><span class="language-css">              <span class="hljs-selector-class">.box2</span> &#123;</span><br><span class="language-css">                  <span class="hljs-attribute">padding</span>: <span class="hljs-number">5px</span>;</span><br><span class="language-css">                  <span class="hljs-attribute">background-color</span>: orange;</span><br><span class="language-css">              &#125;</span><br><span class="language-css"></span><br><span class="language-css"></span><br><span class="language-css">              <span class="hljs-selector-class">.list</span> &#123;</span><br><span class="language-css">                  <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;</span><br><span class="language-css">                  <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;</span><br><span class="language-css">                  <span class="hljs-attribute">background-color</span>: peru;</span><br><span class="language-css">                  <span class="hljs-attribute">overflow</span>: auto;</span><br><span class="language-css">              &#125;</span><br><span class="language-css"></span><br><span class="language-css"></span><br><span class="language-css">              <span class="hljs-selector-tag">li</span> &#123;</span><br><span class="language-css">                  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;</span><br><span class="language-css">              &#125;</span><br><span class="language-css">         </span><br><span class="language-css">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>       <br>    <span class="hljs-comment">&lt;!-- </span><br><span class="hljs-comment">                Vue中的事件修饰符：</span><br><span class="hljs-comment">                        1.prevent：阻止默认事件（常用）；</span><br><span class="hljs-comment">                        2.stop：阻止事件冒泡（常用）；</span><br><span class="hljs-comment">                        3.once：事件只触发一次（常用）；</span><br><span class="hljs-comment">                        4.capture：使用事件的捕获模式；</span><br><span class="hljs-comment">                        5.self：只有event.target是当前操作的元素时才触发事件；</span><br><span class="hljs-comment">                        6.passive：事件的默认行为立即执行，无需等待事件回调执行完毕；</span><br><span class="hljs-comment">        --&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>             <br>      <span class="hljs-comment">&lt;!-- 阻止默认事件（常用）； --&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>欢迎来到&#123;&#123;name&#125;&#125;学习<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://www.atguigu.com&quot;</span> @<span class="hljs-attr">click.prevent</span>=<span class="hljs-string">&quot;showInfo&quot;</span></span><br><span class="hljs-tag">        &gt;</span>点我提示信息&lt;/a<br>      &gt;<br><br>             <br>      <span class="hljs-comment">&lt;!-- 阻止事件冒泡（常用）； --&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;demo1&quot;</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;showInfo&quot;</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click.stop</span>=<span class="hljs-string">&quot;showInfo&quot;</span>&gt;</span>点我提示信息<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>        <br>           <br>        <span class="hljs-comment">&lt;!-- 修饰符可以连续写 --&gt;</span><br>                   <br>        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://www.atguigu.com&quot;</span> @<span class="hljs-attr">click.prevent.stop</span>=<span class="hljs-string">&quot;showInfo&quot;</span></span><br><span class="hljs-tag">          &gt;</span>点我提示信息&lt;/a<br>        &gt;<br>               <br>      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>             <br>      <span class="hljs-comment">&lt;!-- 触发过一次之后就不会再触发了 --&gt;</span><br>             <br>      <span class="hljs-comment">&lt;!-- 事件只触发一次（常用）； --&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click.once</span>=<span class="hljs-string">&quot;showInfo&quot;</span>&gt;</span>点我提示信息<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><br>             <br>      <span class="hljs-comment">&lt;!-- 使用事件的捕获模式； --&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;box1&quot;</span> @<span class="hljs-attr">click.capture</span>=<span class="hljs-string">&quot;showMsg(1)&quot;</span>&gt;</span><br>                    div1            <br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;box2&quot;</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;showMsg(2)&quot;</span>&gt;</span><br>                          div2            <br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>               <br>      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>             <br>      <span class="hljs-comment">&lt;!-- 只有event.target是当前操作的元素时才触发事件； --&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;demo1&quot;</span> @<span class="hljs-attr">click.self</span>=<span class="hljs-string">&quot;showInfo&quot;</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;showInfo&quot;</span>&gt;</span>点我提示信息<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>        <br>      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>             <br>      <span class="hljs-comment">&lt;!-- 事件的默认行为立即执行，无需等待事件回调执行完毕； --&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> @<span class="hljs-attr">wheel.passive</span>=<span class="hljs-string">&quot;demo&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;list&quot;</span>&gt;</span><br>                   <br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                   <br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                   <br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                   <br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>4<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>               <br>      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>             <br>      <span class="hljs-comment">&lt;!-- scroll用这个事件之后就可以不用添加passive修饰符 --&gt;</span><br>             <br>      <span class="hljs-comment">&lt;!-- wheel事件会在函数调用完之后, 滚动条才会发生变化 --&gt;</span><br>             <br>      <span class="hljs-comment">&lt;!-- 给wheel加上passive之后, 即使函数还没执行完, 滚动条依旧会滚动 --&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> @<span class="hljs-attr">scroll</span>=<span class="hljs-string">&quot;demo&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;list&quot;</span>&gt;</span><br>                   <br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                   <br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                   <br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                   <br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>4<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>               <br>      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><br>         <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;尚硅谷&quot;</span>,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-title function_">showInfo</span>(<span class="hljs-params">event</span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-comment">// event.preventDefault();</span></span><br><span class="language-javascript">            <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;同学你好! &quot;</span>);</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">          <span class="hljs-title function_">showMsg</span>(<span class="hljs-params">msg</span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(msg);</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">          <span class="hljs-title function_">demo</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100000</span>; i++) &#123;</span><br><span class="language-javascript">              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;#&quot;</span>);</span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="键盘事件"><a href="#键盘事件" class="headerlink" title="键盘事件"></a>键盘事件</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>键盘事件<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">1.Vue中常用的按键别名：</span><br><span class="hljs-comment">回车 =&gt; enter</span><br><span class="hljs-comment">删除 =&gt; delete (捕获“删除”和“退格”键)</span><br><span class="hljs-comment">退出 =&gt; esc</span><br><span class="hljs-comment">空格 =&gt; space</span><br><span class="hljs-comment">换行 =&gt; tab (特殊，必须配合keydown去使用)</span><br><span class="hljs-comment">上 =&gt; up</span><br><span class="hljs-comment">下 =&gt; down</span><br><span class="hljs-comment">左 =&gt; left</span><br><span class="hljs-comment">右 =&gt; right</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">2.Vue未提供别名的按键，可以使用按键原始的key值去绑定，但注意要转为kebab-case（短横线命名）</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">3.系统修饰键（用法特殊）：ctrl、alt、shift、meta</span><br><span class="hljs-comment">(1).配合keyup使用：按下修饰键的同时，再按下其他键，随后释放其他键，事件才被触发。</span><br><span class="hljs-comment">(2).配合keydown使用：正常触发事件。</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">4.也可以使用keyCode去指定具体的按键（不推荐）</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">5.Vue.config.keyCodes.自定义键名 = 键码，可以去定制按键别名</span><br><span class="hljs-comment">--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>欢迎来到&#123;&#123;name&#125;&#125;学习<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- &lt;input type=&quot;text&quot; placeholder=&quot;按下回车提示输入&quot; @keyup.caps-lock=&quot;showInfo&quot;&gt; --&gt;</span><br>        <span class="hljs-comment">&lt;!-- &lt;input type=&quot;text&quot; placeholder=&quot;按下回车提示输入&quot; @keydown.tab=&quot;showInfo&quot;&gt; --&gt;</span><br>        <span class="hljs-comment">&lt;!-- &lt;input type=&quot;text&quot; placeholder=&quot;按下回车提示输入&quot; @keydown.ctrl=&quot;showInfo&quot;&gt; --&gt;</span><br>        <span class="hljs-comment">&lt;!-- &lt;input type=&quot;text&quot; placeholder=&quot;按下回车提示输入&quot; @keydown.huiche=&quot;showInfo&quot;&gt; --&gt;</span><br><br>        <span class="hljs-comment">&lt;!-- 只允许按下CtrlY的时候触发事件 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;按下回车提示输入&quot;</span> @<span class="hljs-attr">keydown.ctrl.y</span>=<span class="hljs-string">&quot;showInfo&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span> <span class="hljs-comment">// 阻止 vue 在启动时生成生产提示</span></span><br><span class="language-javascript">        <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">keyCodes</span>.<span class="hljs-property">huiche</span> = <span class="hljs-number">13</span>  <span class="hljs-comment">// 定义了一个别名按键</span></span><br><span class="language-javascript">        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">            <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#root&#x27;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">                <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;尚硅谷&#x27;</span></span><br><span class="language-javascript">            &#125;,</span><br><span class="language-javascript">            <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">                <span class="hljs-title function_">showInfo</span>(<span class="hljs-params">e</span>) &#123;</span><br><span class="language-javascript">                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e.<span class="hljs-property">key</span>, e.<span class="hljs-property">keyCode</span>);</span><br><span class="language-javascript">                    <span class="hljs-comment">// console.log(e.target.value);</span></span><br><span class="language-javascript">                &#125;</span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">        &#125;)</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="计算属性"><a href="#计算属性" class="headerlink" title="计算属性"></a>计算属性</h2><p>姓名案例_插值语法实现</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>姓名案例_插值语法实现<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>              姓: <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;firstName&quot;</span> /&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>              名: <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;lastName&quot;</span> /&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>              全名: <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>&#123;&#123;firstName&#125;&#125;-&#123;&#123;lastName&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>         全名:<br>      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>&#123;&#123;firstName.slice(0, 3)&#125;&#125;-&#123;&#123;lastName&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>    <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>; <span class="hljs-comment">// 阻止 vue 在启动时生成生产提示</span></span><br><span class="language-javascript">      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">firstName</span>: <span class="hljs-string">&quot;张&quot;</span>,</span><br><span class="language-javascript">          <span class="hljs-attr">lastName</span>: <span class="hljs-string">&quot;三&quot;</span>,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;&#125;,</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>姓名案例_methods 实现</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>姓名案例_methods实现<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>              姓: <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;firstName&quot;</span> /&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>              名: <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;lastName&quot;</span> /&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>              全名: <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>&#123;&#123;fullName()&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>        <br>      <span class="hljs-comment">&lt;!-- 插值语法调用方法需要加() --&gt;</span><br>             <br>      <span class="hljs-comment">&lt;!-- 绑定事件的方法可加括号, 也可不加括号 --&gt;</span><br>         <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>; <span class="hljs-comment">// 阻止 vue 在启动时生成生产提示</span></span><br><span class="language-javascript">      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">firstName</span>: <span class="hljs-string">&quot;张&quot;</span>,</span><br><span class="language-javascript">          <span class="hljs-attr">lastName</span>: <span class="hljs-string">&quot;三&quot;</span>,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-title function_">fullName</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-comment">// alert(1)</span></span><br><span class="language-javascript">            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">firstName</span> + <span class="hljs-string">&quot;-&quot;</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastName</span>;</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>姓名案例_计算属性</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>姓名案例_计算属性<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>       <br>    <span class="hljs-comment">&lt;!-- </span><br><span class="hljs-comment">            计算属性：</span><br><span class="hljs-comment">                    1.定义：要用的属性不存在，要通过已有属性计算得来。</span><br><span class="hljs-comment">                    2.原理：底层借助了Objcet.defineproperty方法提供的getter和setter。</span><br><span class="hljs-comment">                    3.get函数什么时候执行？</span><br><span class="hljs-comment">                                (1).初次读取时会执行一次。</span><br><span class="hljs-comment">                                (2).当依赖的数据发生改变时会被再次调用。</span><br><span class="hljs-comment">                    4.优势：与methods实现相比，内部有缓存机制（复用），效率更高，调试方便。</span><br><span class="hljs-comment">                    5.备注：</span><br><span class="hljs-comment">                            1.计算属性最终会出现在vm上，直接读取使用即可。</span><br><span class="hljs-comment">                            2.如果计算属性要被修改，那必须写set函数去响应修改，且set中要引起计算时依赖的数据发生改变。</span><br><span class="hljs-comment">    --&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>              姓: <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;firstName&quot;</span> /&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>              名: <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;lastName&quot;</span> /&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>              全名: <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>&#123;&#123;fullName&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>              全名: <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>&#123;&#123;fullName&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>              全名: <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>&#123;&#123;fullName&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>              全名: <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>&#123;&#123;fullName&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>        <br>      <span class="hljs-comment">&lt;!-- fullName里面的get函数只会被调用一次, 因为这里面有缓存机制 --&gt;</span><br>             <br>      <span class="hljs-comment">&lt;!-- 如果在methods中定义的函数中存在get函数, 且调用的是methods里面函数的get, 会被调用多次 --&gt;</span><br>         <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>; <span class="hljs-comment">// 阻止 vue 在启动时生成生产提示</span></span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">firstName</span>: <span class="hljs-string">&quot;张&quot;</span>,</span><br><span class="language-javascript">          <span class="hljs-attr">lastName</span>: <span class="hljs-string">&quot;三&quot;</span>,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;&#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">computed</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-comment">// 计算属性, 以后计算出来的属性, 不在_data</span></span><br><span class="language-javascript">          <span class="hljs-attr">fullName</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-comment">// get 有什么作用? 当有人读取fullName时, get就会被调用, 且返回值就作为fullName的值</span></span><br><span class="language-javascript">            <span class="hljs-comment">// get 什么时候被调用?</span></span><br><span class="language-javascript">            <span class="hljs-comment">// 1. 初次读取fullName时</span></span><br><span class="language-javascript">            <span class="hljs-comment">// 2. 所依赖的数据发生变化时</span></span><br><span class="language-javascript">            <span class="hljs-title function_">get</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;get被调用了&quot;</span>); <span class="hljs-comment">// console.log(this); // 此处的this是vm</span></span><br><span class="language-javascript">              <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">firstName</span> + <span class="hljs-string">&quot;-&quot;</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastName</span>;</span><br><span class="language-javascript">            &#125;, <span class="hljs-comment">// set什么时候被调用? // 当fullName被修改时</span></span><br><span class="language-javascript">            <span class="hljs-title function_">set</span>(<span class="hljs-params">value</span>) &#123;</span><br><span class="language-javascript">              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;set&quot;</span>, value);</span><br><span class="language-javascript">              <span class="hljs-keyword">const</span> arr = value.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;-&quot;</span>);</span><br><span class="language-javascript">              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr[<span class="hljs-number">0</span>]);</span><br><span class="language-javascript">              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr[<span class="hljs-number">1</span>]);</span><br><span class="language-javascript">              <span class="hljs-variable language_">this</span>.<span class="hljs-property">firstName</span> = arr[<span class="hljs-number">0</span>];</span><br><span class="language-javascript">              <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastName</span> = arr[<span class="hljs-number">1</span>];</span><br><span class="language-javascript">            &#125;,</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>姓名案例_计算属性简写</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>姓名案例_计算属性简写<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>              姓: <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;firstName&quot;</span> /&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>              名: <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;lastName&quot;</span> /&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>              全名: <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>&#123;&#123;fullName&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>         <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>; <span class="hljs-comment">// 阻止 vue 在启动时生成生产提示</span></span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">firstName</span>: <span class="hljs-string">&quot;张&quot;</span>,</span><br><span class="language-javascript">          <span class="hljs-attr">lastName</span>: <span class="hljs-string">&quot;三&quot;</span>,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;&#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">computed</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-comment">// 完整写法</span></span><br><span class="language-javascript">          <span class="hljs-comment">/*                 fullName: &#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">                                    get() &#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">                                        console.log(&#x27;get被调用了&#x27;);</span></span><br><span class="hljs-comment"><span class="language-javascript">                                        return this.firstName + &#x27;-&#x27; + this.lastName</span></span><br><span class="hljs-comment"><span class="language-javascript">                                    &#125;,</span></span><br><span class="hljs-comment"><span class="language-javascript">                                    set(value) &#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">                                        console.log(&#x27;set&#x27;, value);</span></span><br><span class="hljs-comment"><span class="language-javascript">                                        const arr = value.split(&#x27;-&#x27;);</span></span><br><span class="hljs-comment"><span class="language-javascript">                                        console.log(arr[0]);</span></span><br><span class="hljs-comment"><span class="language-javascript">                                        console.log(arr[1]);</span></span><br><span class="hljs-comment"><span class="language-javascript">                                        this.firstName = arr[0];</span></span><br><span class="hljs-comment"><span class="language-javascript">                                        this.lastName = arr[1];</span></span><br><span class="hljs-comment"><span class="language-javascript">                                    &#125;</span></span><br><span class="hljs-comment"><span class="language-javascript">                                &#125; */</span></span><br><span class="language-javascript">          <span class="hljs-comment">// 简写写法</span></span><br><span class="language-javascript">          <span class="hljs-comment">// 只考虑读取, 不考虑修改的时候才能使用简写的方式</span></span><br><span class="language-javascript">          <span class="hljs-title function_">fullName</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;get被调用了&quot;</span>);</span><br><span class="language-javascript">            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">firstName</span> + <span class="hljs-string">&quot;-&quot;</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastName</span>;</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="监视属性"><a href="#监视属性" class="headerlink" title="监视属性"></a>监视属性</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>天气案例<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>今天天气很&#123;&#123;info&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>             <br>      <span class="hljs-comment">&lt;!-- 绑定事件的时候: @xxx=&quot;yyy&quot; yyy可以写一些简单的语句 --&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;isHot = !isHot&quot;</span>&gt;</span>切换天气<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>        <br>      <span class="hljs-comment">&lt;!-- &lt;button @click=&quot;changeWeather&quot;&gt;切换天气&lt;/button&gt; --&gt;</span><br>         <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">isHot</span>: <span class="hljs-literal">true</span>,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-title function_">changeWeather</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">this</span>.<span class="hljs-property">isHot</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">isHot</span>;</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">computed</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-title function_">info</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">isHot</span> ? <span class="hljs-string">&quot;炎热&quot;</span> : <span class="hljs-string">&quot;凉爽&quot;</span>;</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>天气案例_监视属性<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>       <br>    <span class="hljs-comment">&lt;!-- </span><br><span class="hljs-comment">                监视属性watch：</span><br><span class="hljs-comment">                    1.当被监视的属性变化时, 回调函数自动调用, 进行相关操作</span><br><span class="hljs-comment">                    2.监视的属性必须存在，才能进行监视！！</span><br><span class="hljs-comment">                    3.监视的两种写法：</span><br><span class="hljs-comment">                            (1).new Vue时传入watch配置</span><br><span class="hljs-comment">                            (2).通过vm.$watch监视</span><br><span class="hljs-comment">    --&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>今天天气很&#123;&#123;info&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>             <br>      <span class="hljs-comment">&lt;!-- 绑定事件的时候: @xxx=&quot;yyy&quot; yyy可以写一些简单的语句 --&gt;</span><br>             <br>      <span class="hljs-comment">&lt;!-- &lt;button @click=&quot;isHot = !isHot&quot;&gt;切换天气&lt;/button&gt; --&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;changeWeather&quot;</span>&gt;</span>切换天气<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>    <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">isHot</span>: <span class="hljs-literal">true</span>,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-title function_">changeWeather</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">this</span>.<span class="hljs-property">isHot</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">isHot</span>;</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">computed</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-title function_">info</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">isHot</span> ? <span class="hljs-string">&quot;炎热&quot;</span> : <span class="hljs-string">&quot;凉爽&quot;</span>;</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">        &#125; <span class="hljs-comment">/*             watch: &#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">                            isHot: &#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">                                immediate:true, // 初始化时让handler调用一次</span></span><br><span class="hljs-comment"><span class="language-javascript">                                // handler 什么时候调用? isHot发生改变时</span></span><br><span class="hljs-comment"><span class="language-javascript">                                handler(newValue, oldValue) &#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">                                    console.log(&#x27;isHot被修改了&#x27;, newValue, oldValue);</span></span><br><span class="hljs-comment"><span class="language-javascript">                                &#125;</span></span><br><span class="hljs-comment"><span class="language-javascript">                            &#125;</span></span><br><span class="hljs-comment"><span class="language-javascript">                        &#125; */</span>,</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      vm.$watch(<span class="hljs-string">&quot;isHot&quot;</span>, &#123;</span><br><span class="language-javascript">        <span class="hljs-attr">immediate</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 初始化时让handler调用一次 // handler 什么时候调用? isHot发生改变时</span></span><br><span class="language-javascript">        <span class="hljs-title function_">handler</span>(<span class="hljs-params">newValue, oldValue</span>) &#123;</span><br><span class="language-javascript">          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;isHot被修改了&quot;</span>, newValue, oldValue);</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>天气案例_深度监视<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>       <br>    <span class="hljs-comment">&lt;!-- </span><br><span class="hljs-comment">            深度监视：</span><br><span class="hljs-comment">                    (1).Vue中的watch默认不监测对象内部值的改变（一层）。</span><br><span class="hljs-comment">                    (2).配置deep:true可以监测对象内部值改变（多层）。</span><br><span class="hljs-comment">            备注：</span><br><span class="hljs-comment">                    (1).Vue自身可以监测对象内部值的改变，但Vue提供的watch默认不可以！</span><br><span class="hljs-comment">                    (2).使用watch时根据数据的具体结构，决定是否采用深度监视。</span><br><span class="hljs-comment">        --&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>今天天气很&#123;&#123;info&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;changeWeather&quot;</span>&gt;</span>切换天气<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>        <br>      <span class="hljs-tag">&lt;<span class="hljs-name">hr</span> /&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>a的值是: &#123;&#123;numbers.a&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;numbers.a++&quot;</span>&gt;</span>点我a++<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>        <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>b的值是: &#123;&#123;numbers.b&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;numbers.b++&quot;</span>&gt;</span>点我b++<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;numbers = &#123;a:666,b:999&#125;&quot;</span>&gt;</span>点我替换numbers<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>    <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">isHot</span>: <span class="hljs-literal">true</span>,</span><br><span class="language-javascript">          <span class="hljs-attr">numbers</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">b</span>: <span class="hljs-number">1</span>,</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-title function_">changeWeather</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">this</span>.<span class="hljs-property">isHot</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">isHot</span>;</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">computed</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-title function_">info</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">isHot</span> ? <span class="hljs-string">&quot;炎热&quot;</span> : <span class="hljs-string">&quot;凉爽&quot;</span>;</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">watch</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">isHot</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-comment">// immediate: true, // 初始化时让handler调用一次</span></span><br><span class="language-javascript">            <span class="hljs-comment">// handler 什么时候调用? isHot发生改变时</span></span><br><span class="language-javascript">            <span class="hljs-title function_">handler</span>(<span class="hljs-params">newValue, oldValue</span>) &#123;</span><br><span class="language-javascript">              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;isHot被修改了&quot;</span>, newValue, oldValue);</span><br><span class="language-javascript">            &#125;,</span><br><span class="language-javascript">          &#125;, <span class="hljs-comment">// 监视多级结构中某个属性的变化 // 监视多级结构中所有属性的变化</span></span><br><span class="language-javascript">          <span class="hljs-comment">/*                 &#x27;numbers.a&#x27;: &#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">                    handler(newValue, oldValue) &#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">                        console.log(&#x27;numbers被修改了&#x27;, newValue, oldValue);</span></span><br><span class="hljs-comment"><span class="language-javascript">                    &#125;</span></span><br><span class="hljs-comment"><span class="language-javascript">                &#125;, */</span></span><br><span class="language-javascript">          <span class="hljs-attr">numbers</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">deep</span>: <span class="hljs-literal">true</span>,</span><br><span class="language-javascript">            <span class="hljs-title function_">handler</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;numbers被修改了&quot;</span>);</span><br><span class="language-javascript">            &#125;,</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>天气案例_监视属性_简写<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>今天天气很&#123;&#123;info&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;changeWeather&quot;</span>&gt;</span>切换天气<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>    <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">isHot</span>: <span class="hljs-literal">true</span>,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-title function_">changeWeather</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">this</span>.<span class="hljs-property">isHot</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">isHot</span>;</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">computed</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-title function_">info</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">isHot</span> ? <span class="hljs-string">&quot;炎热&quot;</span> : <span class="hljs-string">&quot;凉爽&quot;</span>;</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">watch</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-comment">// 正常写法</span></span><br><span class="language-javascript">          <span class="hljs-comment">/*                 isHot: &#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">                                    // immediate: true, // 初始化时让handler调用一次</span></span><br><span class="hljs-comment"><span class="language-javascript">                                    // handler 什么时候调用? isHot发生改变时</span></span><br><span class="hljs-comment"><span class="language-javascript">                                    // deep: true,</span></span><br><span class="hljs-comment"><span class="language-javascript">                                    handler(newValue, oldValue) &#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">                                        console.log(&#x27;isHot被修改了&#x27;, newValue, oldValue);</span></span><br><span class="hljs-comment"><span class="language-javascript">                                    &#125;</span></span><br><span class="hljs-comment"><span class="language-javascript">                                &#125;, */</span></span><br><span class="language-javascript">          <span class="hljs-comment">// 简写</span></span><br><span class="language-javascript">          <span class="hljs-comment">// 没有deep, immediate的时候就可以简写</span></span><br><span class="language-javascript">          <span class="hljs-comment">// isHot(newValue, oldValue) &#123;</span></span><br><span class="language-javascript">          <span class="hljs-comment">//     console.log(&#x27;isHot被修改了&#x27;, newValue, oldValue);</span></span><br><span class="language-javascript">          <span class="hljs-comment">// &#125;</span></span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">      &#125;); <span class="hljs-comment">// 正常的写法 // vm.$watch(&#x27;isHot&#x27;, &#123; //     // immediate: true, // 初始化时让handler调用一次 //     // handler 什么时候调用? isHot发生改变时 //     // deep: true, //     handler(newValue, oldValue) &#123; //         console.log(&#x27;isHot被修改了&#x27;, newValue, oldValue); //     &#125; // &#125;) // 简写方式</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">      vm.$watch(<span class="hljs-string">&quot;isHot&quot;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">newValue, oldValue</span>) &#123;</span><br><span class="language-javascript">        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;isHot被修改了&quot;</span>, newValue, oldValue);</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>两个重要的小原则： 1.所被 Vue 管理的函数，最好写成普通函数，这样 this 的指向才是 vm 或 组件实例对象。 2.所有不被 Vue 所管理的函数（定时器的回调函数、ajax 的回调函数等、Promise 的回调函数），最好写成箭头函数，这样 this 的指向才是 vm 或 组件实例对象。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>姓名案例_watch实现<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>       <br>    <span class="hljs-comment">&lt;!-- </span><br><span class="hljs-comment">            computed和watch之间的区别：</span><br><span class="hljs-comment">                    1.computed能完成的功能，watch都可以完成。</span><br><span class="hljs-comment">                    2.watch能完成的功能，computed不一定能完成，例如：watch可以进行异步操作。</span><br><span class="hljs-comment">            两个重要的小原则：</span><br><span class="hljs-comment">                        1.所被Vue管理的函数，最好写成普通函数，这样this的指向才是vm 或 组件实例对象。</span><br><span class="hljs-comment">                        2.所有不被Vue所管理的函数（定时器的回调函数、ajax的回调函数等、Promise的回调函数），最好写成箭头函数，</span><br><span class="hljs-comment">                            这样this的指向才是vm 或 组件实例对象。</span><br><span class="hljs-comment">    --&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>              姓: <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;firstName&quot;</span> /&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>              名: <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;lastName&quot;</span> /&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>              全名: <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>&#123;&#123;fullName&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>         <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>; <span class="hljs-comment">// 阻止 vue 在启动时生成生产提示</span></span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">firstName</span>: <span class="hljs-string">&quot;张&quot;</span>,</span><br><span class="language-javascript">          <span class="hljs-attr">lastName</span>: <span class="hljs-string">&quot;三&quot;</span>,</span><br><span class="language-javascript">          <span class="hljs-attr">fullName</span>: <span class="hljs-string">&quot;张-三&quot;</span>,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;&#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">watch</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-title function_">firstName</span>(<span class="hljs-params">val</span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;</span><br><span class="language-javascript">              <span class="hljs-variable language_">this</span>.<span class="hljs-property">fullName</span> = val + <span class="hljs-string">&quot;-&quot;</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastName</span>;</span><br><span class="language-javascript">            &#125;, <span class="hljs-number">1000</span>);</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">          <span class="hljs-title function_">lastName</span>(<span class="hljs-params">val</span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">this</span>.<span class="hljs-property">fullName</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">firstName</span> + <span class="hljs-string">&quot;-&quot;</span> + val;</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="绑定样式"><a href="#绑定样式" class="headerlink" title="绑定样式"></a>绑定样式</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>绑定样式<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css">              <span class="hljs-selector-class">.basic</span> &#123;</span><br><span class="language-css">                  <span class="hljs-attribute">width</span>: <span class="hljs-number">400px</span>;</span><br><span class="language-css">                  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;</span><br><span class="language-css">                  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid black;</span><br><span class="language-css">              &#125;</span><br><span class="language-css"></span><br><span class="language-css"></span><br><span class="language-css">              <span class="hljs-selector-class">.happy</span> &#123;</span><br><span class="language-css">                  <span class="hljs-attribute">border</span>: <span class="hljs-number">4px</span> solid red;</span><br><span class="language-css">                  ;</span><br><span class="language-css">                  <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.644</span>);</span><br><span class="language-css">                  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">30deg</span>, yellow, pink, orange, yellow);</span><br><span class="language-css">              &#125;</span><br><span class="language-css"></span><br><span class="language-css"></span><br><span class="language-css">              <span class="hljs-selector-class">.sad</span> &#123;</span><br><span class="language-css">                  <span class="hljs-attribute">border</span>: <span class="hljs-number">4px</span> dashed <span class="hljs-built_in">rgb</span>(<span class="hljs-number">2</span>, <span class="hljs-number">197</span>, <span class="hljs-number">2</span>);</span><br><span class="language-css">                  <span class="hljs-attribute">background-color</span>: gray;</span><br><span class="language-css">              &#125;</span><br><span class="language-css"></span><br><span class="language-css"></span><br><span class="language-css">              <span class="hljs-selector-class">.normal</span> &#123;</span><br><span class="language-css">                  <span class="hljs-attribute">background-color</span>: skyblue;</span><br><span class="language-css">              &#125;</span><br><span class="language-css"></span><br><span class="language-css"></span><br><span class="language-css">              <span class="hljs-selector-class">.atguigu1</span> &#123;</span><br><span class="language-css">                  <span class="hljs-attribute">background-color</span>: yellowgreen;</span><br><span class="language-css">              &#125;</span><br><span class="language-css"></span><br><span class="language-css"></span><br><span class="language-css">              <span class="hljs-selector-class">.atguigu2</span> &#123;</span><br><span class="language-css">                  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">30px</span>;</span><br><span class="language-css">                  <span class="hljs-attribute">text-shadow</span>: <span class="hljs-number">2px</span> <span class="hljs-number">2px</span> <span class="hljs-number">10px</span> red;</span><br><span class="language-css">              &#125;</span><br><span class="language-css"></span><br><span class="language-css"></span><br><span class="language-css">              <span class="hljs-selector-class">.atguigu3</span> &#123;</span><br><span class="language-css">                  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">20px</span>;</span><br><span class="language-css">              &#125;</span><br><span class="language-css">         </span><br><span class="language-css">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>               <br>    <span class="hljs-comment">&lt;!-- </span><br><span class="hljs-comment">            绑定样式：</span><br><span class="hljs-comment">                    1. class样式</span><br><span class="hljs-comment">                                写法:class=&quot;xxx&quot; xxx可以是字符串、对象、数组。</span><br><span class="hljs-comment">                                        字符串写法适用于：类名不确定，要动态获取。</span><br><span class="hljs-comment">                                        对象写法适用于：要绑定多个样式，个数不确定，名字也不确定。</span><br><span class="hljs-comment">                                        数组写法适用于：要绑定多个样式，个数确定，名字也确定，但不确定用不用。</span><br><span class="hljs-comment">                    2. style样式</span><br><span class="hljs-comment">                                :style=&quot;&#123;fontSize: xxx&#125;&quot;其中xxx是动态值。</span><br><span class="hljs-comment">                                :style=&quot;[a,b]&quot;其中a、b是样式对象。</span><br><span class="hljs-comment">        --&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>             <br>      <span class="hljs-comment">&lt;!-- 绑定class样式 -- 字符串写法, 适用于: 样式的类名不确定, 需要动态指定 --&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;basic&quot;</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">&quot;mood&quot;</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;changeMood&quot;</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br><br>             <br>      <span class="hljs-comment">&lt;!-- 绑定class样式 -- 数组写法, 适用于: 要绑定的样式个数不确定, 名字也不确定 --&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;basic&quot;</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">&quot;classArr&quot;</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br><br>             <br>      <span class="hljs-comment">&lt;!-- 绑定class样式 -- 对象写法, 适用于: 要绑定的样式个数确定, 名字也确定, 但要动态决定用不用 --&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;basic&quot;</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">&quot;classObj&quot;</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;basic&quot;</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">&quot;&#123;atguigu1: true, atguigu2: true&#125;&quot;</span>&gt;</span><br>        &#123;&#123;name&#125;&#125;<br>      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;basic&quot;</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">&quot;&#123;fontSize: fsize+&#x27;px&#x27;&#125;&quot;</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br><br>             <br>      <span class="hljs-comment">&lt;!-- 绑定style样式 -- 对象写法 --&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;basic&quot;</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">&quot;styleObj&quot;</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br><br>             <br>      <span class="hljs-comment">&lt;!-- 绑定style样式 -- 数组写法 --&gt;</span><br>             <br>      <span class="hljs-comment">&lt;!-- 数据写法很少 --&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;basic&quot;</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">&quot;[styleObj, styleObj2]&quot;</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;basic&quot;</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">&quot;styleArr&quot;</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>         <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;</span><br><span class="language-javascript">      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;尚硅谷&quot;</span>,</span><br><span class="language-javascript">          <span class="hljs-attr">mood</span>: <span class="hljs-string">&quot;normal&quot;</span>,</span><br><span class="language-javascript">          <span class="hljs-attr">classArr</span>: [<span class="hljs-string">&quot;atguigu1&quot;</span>, <span class="hljs-string">&quot;atguigu2&quot;</span>, <span class="hljs-string">&quot;atguigu3&quot;</span>],</span><br><span class="language-javascript">          <span class="hljs-attr">classObj</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">atguigu1</span>: <span class="hljs-literal">true</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">atguigu2</span>: <span class="hljs-literal">true</span>,</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">          <span class="hljs-attr">fsize</span>: <span class="hljs-number">40</span>,</span><br><span class="language-javascript">          <span class="hljs-attr">styleObj</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">fontSize</span>: <span class="hljs-string">&quot;40px&quot;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">color</span>: <span class="hljs-string">&quot;red&quot;</span>,</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">          <span class="hljs-attr">styleObj2</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">&quot;orange&quot;</span>,</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">          <span class="hljs-attr">styleArr</span>: [</span><br><span class="language-javascript">            &#123;</span><br><span class="language-javascript">              <span class="hljs-attr">fontSize</span>: <span class="hljs-string">&quot;40px&quot;</span>,</span><br><span class="language-javascript">              <span class="hljs-attr">color</span>: <span class="hljs-string">&quot;blue&quot;</span>,</span><br><span class="language-javascript">            &#125;,</span><br><span class="language-javascript">            &#123;</span><br><span class="language-javascript">              <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">&quot;gray&quot;</span>,</span><br><span class="language-javascript">            &#125;,</span><br><span class="language-javascript">          ],</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-title function_">changeMood</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-comment">/*    console.log(parseInt(Math.random()*3));</span></span><br><span class="hljs-comment"><span class="language-javascript">                       let rand = parseInt(Math.random()*3)</span></span><br><span class="hljs-comment"><span class="language-javascript">                       if (rand == 0) &#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">                           this.mood = &#x27;happy&#x27;</span></span><br><span class="hljs-comment"><span class="language-javascript">                       &#125;</span></span><br><span class="hljs-comment"><span class="language-javascript">                       if (rand == 1) &#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">                           this.mood = &#x27;sad&#x27;</span></span><br><span class="hljs-comment"><span class="language-javascript">                       &#125;</span></span><br><span class="hljs-comment"><span class="language-javascript">                       if (rand == 2) &#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">                           this.mood = &#x27;normal&#x27;</span></span><br><span class="hljs-comment"><span class="language-javascript">                       &#125; */</span></span><br><span class="language-javascript">            <span class="hljs-keyword">const</span> arr = [<span class="hljs-string">&quot;happy&quot;</span>, <span class="hljs-string">&quot;sad&quot;</span>, <span class="hljs-string">&quot;normal&quot;</span>];</span><br><span class="language-javascript">            <span class="hljs-keyword">const</span> index = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">3</span>);</span><br><span class="language-javascript">            <span class="hljs-variable language_">this</span>.<span class="hljs-property">mood</span> = arr[index];</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="条件渲染"><a href="#条件渲染" class="headerlink" title="条件渲染"></a>条件渲染</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>条件渲染<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>           <br>    <span class="hljs-comment">&lt;!-- </span><br><span class="hljs-comment">                条件渲染：</span><br><span class="hljs-comment">                            1.v-if</span><br><span class="hljs-comment">                                        写法：</span><br><span class="hljs-comment">                                                (1).v-if=&quot;表达式&quot; </span><br><span class="hljs-comment">                                                (2).v-else-if=&quot;表达式&quot;</span><br><span class="hljs-comment">                                                (3).v-else=&quot;表达式&quot;</span><br><span class="hljs-comment">                                        适用于：切换频率较低的场景。</span><br><span class="hljs-comment">                                        特点：不展示的DOM元素直接被移除。</span><br><span class="hljs-comment">                                        注意：v-if可以和:v-else-if、v-else一起使用，但要求结构不能被“打断”。</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">                            2.v-show</span><br><span class="hljs-comment">                                        写法：v-show=&quot;表达式&quot;</span><br><span class="hljs-comment">                                        适用于：切换频率较高的场景。</span><br><span class="hljs-comment">                                        特点：不展示的DOM元素未被移除，仅仅是使用样式隐藏掉</span><br><span class="hljs-comment">                                </span><br><span class="hljs-comment">                            3.备注：使用v-if的时，元素可能无法获取到，而使用v-show一定可以获取到。</span><br><span class="hljs-comment">         --&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>当前的n值是:&#123;&#123;n&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;n++&quot;</span>&gt;</span>点我n+1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>        <br>      <span class="hljs-comment">&lt;!-- 使用v-show做条件渲染 --&gt;</span><br>             <br>      <span class="hljs-comment">&lt;!-- &lt;h2 v-show=&quot;true&quot;&gt;欢迎来到&#123;&#123;name&#125;&#125;&lt;/h2&gt; --&gt;</span><br>             <br>      <span class="hljs-comment">&lt;!-- &lt;h2 v-show=&quot;a&quot;&gt;欢迎来到&#123;&#123;name&#125;&#125;&lt;/h2&gt; --&gt;</span><br>             <br>      <span class="hljs-comment">&lt;!-- &lt;h2 v-show=&quot;1 === 3&quot;&gt;欢迎来到&#123;&#123;name&#125;&#125;&lt;/h2&gt; --&gt;</span><br><br>             <br>      <span class="hljs-comment">&lt;!-- 使用v-show做条件渲染  --&gt;</span><br>             <br>      <span class="hljs-comment">&lt;!-- &lt;h2 v-if=&quot;1 === 1&quot;&gt;欢迎来到&#123;&#123;name&#125;&#125;&lt;/h2&gt; --&gt;</span><br>             <br>      <span class="hljs-comment">&lt;!-- &lt;h2 v-if=&quot;false&quot;&gt;欢迎来到&#123;&#123;name&#125;&#125;&lt;/h2&gt; --&gt;</span><br><br>             <br>      <span class="hljs-comment">&lt;!-- v-else和v-else-if --&gt;</span><br>             <br>      <span class="hljs-comment">&lt;!-- 中间的div不允许被打断 --&gt;</span><br>             <br>      <span class="hljs-comment">&lt;!-- &lt;div v-if=&quot;n === 1&quot;&gt;Angular&lt;/div&gt; --&gt;</span><br>             <br>      <span class="hljs-comment">&lt;!-- &lt;div v-else-if=&quot;n === 2&quot;&gt;React&lt;/div&gt; --&gt;</span><br>             <br>      <span class="hljs-comment">&lt;!-- &lt;div v-else-if=&quot;n === 3&quot;&gt;Vue&lt;/div&gt; --&gt;</span><br>             <br>      <span class="hljs-comment">&lt;!-- &lt;div v-else&gt;哈哈&lt;/div&gt; --&gt;</span><br><br>             <br>      <span class="hljs-comment">&lt;!-- v-if和template的配合使用 --&gt;</span><br>             <br>      <span class="hljs-comment">&lt;!-- template标签内部只能跟v-if一起配合使用, 不能跟v-show --&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;n === 1&quot;</span>&gt;</span><br>                   <br>        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>你好<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>                   <br>        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>尚硅谷<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>                   <br>        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>北京<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>               <br>      <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br>         <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;</span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;尚硅谷&quot;</span>,</span><br><span class="language-javascript">          <span class="hljs-attr">a</span>: <span class="hljs-literal">false</span>,</span><br><span class="language-javascript">          <span class="hljs-attr">n</span>: <span class="hljs-number">0</span>,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;&#125;,</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="列表渲染"><a href="#列表渲染" class="headerlink" title="列表渲染"></a>列表渲染</h2><p>基本列表</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>基本列表<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>           <br>    <span class="hljs-comment">&lt;!-- </span><br><span class="hljs-comment">                v-for指令:</span><br><span class="hljs-comment">                        1.用于展示列表数据</span><br><span class="hljs-comment">                        2.语法：v-for=&quot;(item, index) in xxx&quot; :key=&quot;yyy&quot;</span><br><span class="hljs-comment">                        3.可遍历：数组、对象、字符串（用的很少）、指定次数（用的很少）</span><br><span class="hljs-comment">        --&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>             <br>      <span class="hljs-comment">&lt;!-- 遍历数组 --&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>人员列表(遍历数组)<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>                   <br>        <span class="hljs-comment">&lt;!-- 两个参数也可以不加小括号(), 但是最好养成一个好的习惯 --&gt;</span><br>                   <br>        <span class="hljs-comment">&lt;!-- &lt;li v-for=&quot;person,index in persons&quot; :key=&quot;index&quot;&gt;&lt;/li&gt; --&gt;</span><br>                   <br>        <span class="hljs-comment">&lt;!-- 也可以使用of来遍历, 接近 JavaScript 迭代器的语法 --&gt;</span><br>                   <br>        <span class="hljs-comment">&lt;!-- &lt;li v-for=&quot;(person,index) of persons&quot; :key=&quot;index&quot;&gt;&lt;/li&gt; --&gt;</span><br>                   <br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(person,index) in persons&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;index&quot;</span>&gt;</span><br>                          &#123;&#123;index&#125;&#125; - &#123;&#123;person.name&#125;&#125; - &#123;&#123;person.id&#125;&#125;          <br>           <br>        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>               <br>      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><br>             <br>      <span class="hljs-comment">&lt;!-- 遍历对象 --&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>汽车信息(遍历对象)<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>                   <br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(value,key) in car&quot;</span> <span class="hljs-attr">::key</span>=<span class="hljs-string">&quot;key&quot;</span>&gt;</span><br>                          &#123;&#123;key&#125;&#125; -- &#123;&#123;value&#125;&#125;            <br>        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>               <br>      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>                     <br>      <span class="hljs-comment">&lt;!-- 遍历字符串 --&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>遍历字符串(用得少)<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>                   <br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(char,index) in str&quot;</span> <span class="hljs-attr">::key</span>=<span class="hljs-string">&quot;index&quot;</span>&gt;</span><br>                          &#123;&#123;index&#125;&#125; -- &#123;&#123;char&#125;&#125;            <br>        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>               <br>      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>                     <br>      <span class="hljs-comment">&lt;!-- 遍历指定次数 --&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>遍历指定次数(用得少)<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>                   <br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(number,index) in 5&quot;</span> <span class="hljs-attr">::key</span>=<span class="hljs-string">&quot;index&quot;</span>&gt;</span><br>                          &#123;&#123;number&#125;&#125; -- &#123;&#123;index&#125;&#125;            <br>        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>               <br>      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>         <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;</span><br><span class="language-javascript">      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">persons</span>: [</span><br><span class="language-javascript">            &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;001&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;张三&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">18</span> &#125;,</span><br><span class="language-javascript">            &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;002&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;李四&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">19</span> &#125;,</span><br><span class="language-javascript">            &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;003&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;王五&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">20</span> &#125;,</span><br><span class="language-javascript">          ],</span><br><span class="language-javascript">          <span class="hljs-attr">car</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;奥迪A8&quot;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">price</span>: <span class="hljs-string">&quot;70万&quot;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">color</span>: <span class="hljs-string">&quot;黑色&quot;</span>,</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">          <span class="hljs-attr">str</span>: <span class="hljs-string">&quot;hello&quot;</span>,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;&#125;,</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>key 的原理<br>开发中如何选择 key?: 1.最好使用每条数据的唯一标识作为 key, 比如 id、手机号、身份证号、学号等唯一值。 2.如果不存在对数据的逆序添加、逆序删除等破坏顺序操作，仅用于渲染列表用于展示，使用 index 作为 key 是没有问题的。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>key的原理<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>           <br>    <span class="hljs-comment">&lt;!-- </span><br><span class="hljs-comment">                面试题：react、vue中的key有什么作用？（key的内部原理）</span><br><span class="hljs-comment">                        </span><br><span class="hljs-comment">                        1. 虚拟DOM中key的作用：</span><br><span class="hljs-comment">                                        key是虚拟DOM对象的标识，当数据发生变化时，Vue会根据【新数据】生成【新的虚拟DOM】, </span><br><span class="hljs-comment">                                        随后Vue进行【新虚拟DOM】与【旧虚拟DOM】的差异比较，比较规则如下：</span><br><span class="hljs-comment">                                        </span><br><span class="hljs-comment">                        2.对比规则：</span><br><span class="hljs-comment">                                    (1).旧虚拟DOM中找到了与新虚拟DOM相同的key：</span><br><span class="hljs-comment">                                                ①.若虚拟DOM中内容没变, 直接使用之前的真实DOM！</span><br><span class="hljs-comment">                                                ②.若虚拟DOM中内容变了, 则生成新的真实DOM，随后替换掉页面中之前的真实DOM。</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">                                    (2).旧虚拟DOM中未找到与新虚拟DOM相同的key</span><br><span class="hljs-comment">                                                创建新的真实DOM，随后渲染到到页面。</span><br><span class="hljs-comment">                                                </span><br><span class="hljs-comment">                        3. 用index作为key可能会引发的问题：</span><br><span class="hljs-comment">                                            1. 若对数据进行：逆序添加、逆序删除等破坏顺序操作:</span><br><span class="hljs-comment">                                                            会产生没有必要的真实DOM更新 ==&gt; 界面效果没问题, 但效率低。</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">                                            2. 如果结构中还包含输入类的DOM：</span><br><span class="hljs-comment">                                                            会产生错误DOM更新 ==&gt; 界面有问题。</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">                        4. 开发中如何选择key?:</span><br><span class="hljs-comment">                                            1.最好使用每条数据的唯一标识作为key, 比如id、手机号、身份证号、学号等唯一值。</span><br><span class="hljs-comment">                                            2.如果不存在对数据的逆序添加、逆序删除等破坏顺序操作，仅用于渲染列表用于展示，</span><br><span class="hljs-comment">                                                使用index作为key是没有问题的。</span><br><span class="hljs-comment">        --&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>             <br>      <span class="hljs-comment">&lt;!-- 遍历数组 --&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>人员列表(遍历数组)<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;add&quot;</span>&gt;</span>添加一个老刘<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>        <br>      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>                   <br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(person,index) in persons&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;person.id&quot;</span>&gt;</span><br>                          &#123;&#123;person.name&#125;&#125; - &#123;&#123;person.id&#125;&#125;<br>          <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> /&gt;</span>            <br>        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>               <br>      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>         <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;</span><br><span class="language-javascript">      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">persons</span>: [</span><br><span class="language-javascript">            &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;001&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;张三&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">18</span> &#125;,</span><br><span class="language-javascript">            &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;002&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;李四&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">19</span> &#125;,</span><br><span class="language-javascript">            &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;003&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;王五&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">20</span> &#125;,</span><br><span class="language-javascript">          ],</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-title function_">add</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">this</span>.<span class="hljs-property">persons</span>.<span class="hljs-title function_">unshift</span>(&#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;004&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;老刘&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">40</span> &#125;);</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="/assets/3c1e3828a16f4b3ebfe7e61ca3f9c459.png"><br><img src="/assets/a1e9bd30efdd470398f6df52bcf0b86f.png"></p><h2 id="监视数据的原理"><a href="#监视数据的原理" class="headerlink" title="监视数据的原理"></a>监视数据的原理</h2><p>监测数据的原理就是监测 set 被调用监测的, 一旦 set 被调用, 就会被监测到</p><p><img src="/assets/a4fb2b15aad0473eb58d58d843a3de80.png"><br><img src="/assets/2ff9f91a5c774dbe9c552b121c80c6fd.png"><br>因为 vm.student &#x3D;&#x3D;&#x3D; vm._data.student , 所以上面的代码可以简写<br><img src="/assets/e3cdeb965593461dad08908b07664294.png"><br><img src="/assets/a6bfddf52dad41878febfba572341582.png"><br>注意, 这种方式只能给 vm 中的某一个对象追加属性, 不能给 data 追加一个属性<br><img src="/assets/2f4269eaa38643eda985159dd4029007.png"></p><p><img src="/assets/e7634324b2f942f79596845bdc0a4359.png"></p><p><img src="/assets/fbddbdca60c8468f847d0e005b54ed71.png"><br>只用着了这七个方法, vue 会发现修改了数组<br>下面这种方法, 修改数组, vue 也会发现, 然后渲染页面<br><img src="/assets/c19be895d40148bfbd961571e5234911.png"></p><p>数组里面不能够使用 getset 来监视, 尽管修改了数组索引的值, 但是页面并没有发生改变<br><img src="/assets/3c5a2752e07b4958ad741d0650db9830.png"><br>使用了 push 的方式修改了数组, 但是页面发生了变化<br><img src="/assets/111d4735f12447b3b2e743639632dc4e.png"><br>使用了这七个方法中的修改了数组, 都是响应式的, 页面都会有反应的</p><h2 id="列表渲染-1"><a href="#列表渲染-1" class="headerlink" title="列表渲染"></a>列表渲染</h2><p>基本列表</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>基本列表<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>           <br>    <span class="hljs-comment">&lt;!-- </span><br><span class="hljs-comment">                v-for指令:</span><br><span class="hljs-comment">                        1.用于展示列表数据</span><br><span class="hljs-comment">                        2.语法：v-for=&quot;(item, index) in xxx&quot; :key=&quot;yyy&quot;</span><br><span class="hljs-comment">                        3.可遍历：数组、对象、字符串（用的很少）、指定次数（用的很少）</span><br><span class="hljs-comment">        --&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>             <br>      <span class="hljs-comment">&lt;!-- 遍历数组 --&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>人员列表(遍历数组)<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>                   <br>        <span class="hljs-comment">&lt;!-- 两个参数也可以不加小括号(), 但是最好养成一个好的习惯 --&gt;</span><br>                   <br>        <span class="hljs-comment">&lt;!-- &lt;li v-for=&quot;person,index in persons&quot; :key=&quot;index&quot;&gt;&lt;/li&gt; --&gt;</span><br>                   <br>        <span class="hljs-comment">&lt;!-- 也可以使用of来遍历, 接近 JavaScript 迭代器的语法 --&gt;</span><br>                   <br>        <span class="hljs-comment">&lt;!-- &lt;li v-for=&quot;(person,index) of persons&quot; :key=&quot;index&quot;&gt;&lt;/li&gt; --&gt;</span><br>                   <br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(person,index) in persons&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;index&quot;</span>&gt;</span><br>                          &#123;&#123;index&#125;&#125; - &#123;&#123;person.name&#125;&#125; - &#123;&#123;person.id&#125;&#125;          <br>           <br>        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>               <br>      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><br>             <br>      <span class="hljs-comment">&lt;!-- 遍历对象 --&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>汽车信息(遍历对象)<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>                   <br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(value,key) in car&quot;</span> <span class="hljs-attr">::key</span>=<span class="hljs-string">&quot;key&quot;</span>&gt;</span><br>                          &#123;&#123;key&#125;&#125; -- &#123;&#123;value&#125;&#125;            <br>        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>               <br>      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>                     <br>      <span class="hljs-comment">&lt;!-- 遍历字符串 --&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>遍历字符串(用得少)<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>                   <br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(char,index) in str&quot;</span> <span class="hljs-attr">::key</span>=<span class="hljs-string">&quot;index&quot;</span>&gt;</span><br>                          &#123;&#123;index&#125;&#125; -- &#123;&#123;char&#125;&#125;            <br>        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>               <br>      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>                     <br>      <span class="hljs-comment">&lt;!-- 遍历指定次数 --&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>遍历指定次数(用得少)<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>                   <br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(number,index) in 5&quot;</span> <span class="hljs-attr">::key</span>=<span class="hljs-string">&quot;index&quot;</span>&gt;</span><br>                          &#123;&#123;number&#125;&#125; -- &#123;&#123;index&#125;&#125;            <br>        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>               <br>      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>         <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;</span><br><span class="language-javascript">      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">persons</span>: [</span><br><span class="language-javascript">            &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;001&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;张三&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">18</span> &#125;,</span><br><span class="language-javascript">            &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;002&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;李四&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">19</span> &#125;,</span><br><span class="language-javascript">            &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;003&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;王五&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">20</span> &#125;,</span><br><span class="language-javascript">          ],</span><br><span class="language-javascript">          <span class="hljs-attr">car</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;奥迪A8&quot;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">price</span>: <span class="hljs-string">&quot;70万&quot;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">color</span>: <span class="hljs-string">&quot;黑色&quot;</span>,</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">          <span class="hljs-attr">str</span>: <span class="hljs-string">&quot;hello&quot;</span>,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;&#125;,</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>key 的原理</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>key的原理<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>           <br>    <span class="hljs-comment">&lt;!-- </span><br><span class="hljs-comment">                面试题：react、vue中的key有什么作用？（key的内部原理）</span><br><span class="hljs-comment">                        </span><br><span class="hljs-comment">                        1. 虚拟DOM中key的作用：</span><br><span class="hljs-comment">                                        key是虚拟DOM对象的标识，当数据发生变化时，Vue会根据【新数据】生成【新的虚拟DOM】, </span><br><span class="hljs-comment">                                        随后Vue进行【新虚拟DOM】与【旧虚拟DOM】的差异比较，比较规则如下：</span><br><span class="hljs-comment">                                        </span><br><span class="hljs-comment">                        2.对比规则：</span><br><span class="hljs-comment">                                    (1).旧虚拟DOM中找到了与新虚拟DOM相同的key：</span><br><span class="hljs-comment">                                                ①.若虚拟DOM中内容没变, 直接使用之前的真实DOM！</span><br><span class="hljs-comment">                                                ②.若虚拟DOM中内容变了, 则生成新的真实DOM，随后替换掉页面中之前的真实DOM。</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">                                    (2).旧虚拟DOM中未找到与新虚拟DOM相同的key</span><br><span class="hljs-comment">                                                创建新的真实DOM，随后渲染到到页面。</span><br><span class="hljs-comment">                                                </span><br><span class="hljs-comment">                        3. 用index作为key可能会引发的问题：</span><br><span class="hljs-comment">                                            1. 若对数据进行：逆序添加、逆序删除等破坏顺序操作:</span><br><span class="hljs-comment">                                                            会产生没有必要的真实DOM更新 ==&gt; 界面效果没问题, 但效率低。</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">                                            2. 如果结构中还包含输入类的DOM：</span><br><span class="hljs-comment">                                                            会产生错误DOM更新 ==&gt; 界面有问题。</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">                        4. 开发中如何选择key?:</span><br><span class="hljs-comment">                                            1.最好使用每条数据的唯一标识作为key, 比如id、手机号、身份证号、学号等唯一值。</span><br><span class="hljs-comment">                                            2.如果不存在对数据的逆序添加、逆序删除等破坏顺序操作，仅用于渲染列表用于展示，</span><br><span class="hljs-comment">                                                使用index作为key是没有问题的。</span><br><span class="hljs-comment">        --&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>             <br>      <span class="hljs-comment">&lt;!-- 遍历数组 --&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>人员列表(遍历数组)<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;add&quot;</span>&gt;</span>添加一个老刘<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>        <br>      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>                   <br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(person,index) in persons&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;person.id&quot;</span>&gt;</span><br>                          &#123;&#123;person.name&#125;&#125; - &#123;&#123;person.id&#125;&#125;<br>          <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> /&gt;</span>            <br>        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>               <br>      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>         <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;</span><br><span class="language-javascript">      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">persons</span>: [</span><br><span class="language-javascript">            &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;001&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;张三&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">18</span> &#125;,</span><br><span class="language-javascript">            &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;002&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;李四&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">19</span> &#125;,</span><br><span class="language-javascript">            &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;003&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;王五&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">20</span> &#125;,</span><br><span class="language-javascript">          ],</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-title function_">add</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">this</span>.<span class="hljs-property">persons</span>.<span class="hljs-title function_">unshift</span>(&#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;004&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;老刘&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">40</span> &#125;);</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>列表过滤</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>列表过滤<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>人员列表<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;请输入名字&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;keyWord&quot;</span> /&gt;</span>  <br>           <br>      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>                   <br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(person,index) in filPersons&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;index&quot;</span>&gt;</span><br>                          &#123;&#123;person.name&#125;&#125; - &#123;&#123;person.id&#125;&#125; - &#123;&#123;person.sex&#125;&#125;      <br>               <br>        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>               <br>      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>         <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>; <span class="hljs-comment">/* const vm = new Vue(&#123; // 用watch实现</span></span><br><span class="hljs-comment"><span class="language-javascript">            el: &#x27;#root&#x27;,</span></span><br><span class="hljs-comment"><span class="language-javascript">            data: &#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">                keyWord: &#x27;&#x27;,</span></span><br><span class="hljs-comment"><span class="language-javascript">                persons: [</span></span><br><span class="hljs-comment"><span class="language-javascript">                    &#123; id: &#x27;001&#x27;, name: &#x27;马冬梅&#x27;, age: 18, sex: &#x27;女&#x27; &#125;,</span></span><br><span class="hljs-comment"><span class="language-javascript">                    &#123; id: &#x27;002&#x27;, name: &#x27;周冬雨&#x27;, age: 19, sex: &#x27;女&#x27; &#125;,</span></span><br><span class="hljs-comment"><span class="language-javascript">                    &#123; id: &#x27;003&#x27;, name: &#x27;周杰伦&#x27;, age: 20, sex: &#x27;男&#x27; &#125;,</span></span><br><span class="hljs-comment"><span class="language-javascript">                    &#123; id: &#x27;004&#x27;, name: &#x27;温兆伦&#x27;, age: 20, sex: &#x27;男&#x27; &#125;</span></span><br><span class="hljs-comment"><span class="language-javascript">                ],</span></span><br><span class="hljs-comment"><span class="language-javascript">                filPersons: []</span></span><br><span class="hljs-comment"><span class="language-javascript">            &#125;,</span></span><br><span class="hljs-comment"><span class="language-javascript">            methods: &#123;</span></span><br><span class="hljs-comment"><span class="language-javascript"></span></span><br><span class="hljs-comment"><span class="language-javascript"></span></span><br><span class="hljs-comment"><span class="language-javascript">            &#125;,</span></span><br><span class="hljs-comment"><span class="language-javascript">            watch: &#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">                keyWord: &#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">                    immediate: true,</span></span><br><span class="hljs-comment"><span class="language-javascript">                    handler(val) &#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">                        this.filPersons = this.persons.filter((p) =&gt; &#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">                            return p.name.indexOf(val) !== -1</span></span><br><span class="hljs-comment"><span class="language-javascript">                        &#125;)</span></span><br><span class="hljs-comment"><span class="language-javascript">                    &#125;</span></span><br><span class="hljs-comment"><span class="language-javascript">                &#125;</span></span><br><span class="hljs-comment"><span class="language-javascript"></span></span><br><span class="hljs-comment"><span class="language-javascript"></span></span><br><span class="hljs-comment"><span class="language-javascript">            &#125; </span></span><br><span class="hljs-comment"><span class="language-javascript">        &#125;)*/</span> <span class="hljs-comment">// 用computed实现</span></span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">keyWord</span>: <span class="hljs-string">&quot;&quot;</span>,</span><br><span class="language-javascript">          <span class="hljs-attr">persons</span>: [</span><br><span class="language-javascript">            &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;001&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;马冬梅&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">18</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">&quot;女&quot;</span> &#125;,</span><br><span class="language-javascript">            &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;002&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;周冬雨&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">19</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">&quot;女&quot;</span> &#125;,</span><br><span class="language-javascript">            &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;003&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;周杰伦&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">&quot;男&quot;</span> &#125;,</span><br><span class="language-javascript">            &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;004&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;温兆伦&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">&quot;男&quot;</span> &#125;,</span><br><span class="language-javascript">          ],</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">computed</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-title function_">filPersons</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">persons</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">p</span>) =&gt;</span> &#123;</span><br><span class="language-javascript">              <span class="hljs-keyword">return</span> p.<span class="hljs-property">name</span>.<span class="hljs-title function_">indexOf</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">keyWord</span>) !== -<span class="hljs-number">1</span>;</span><br><span class="language-javascript">            &#125;);</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>列表排序</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>列表排序<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>人员列表<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;请输入名字&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;keyWord&quot;</span> /&gt;</span>  <br>            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;sortType = 2&quot;</span>&gt;</span>年龄升序<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>        <br>      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;sortType = 1&quot;</span>&gt;</span>年龄降序<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>        <br>      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;sortType = 0&quot;</span>&gt;</span>原顺序<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>        <br>      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>                   <br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(person,index) in filPersons&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;person.id&quot;</span>&gt;</span><br>                          &#123;&#123;person.name&#125;&#125; - &#123;&#123;person.age&#125;&#125; - &#123;&#123;person.sex&#125;&#125;    <br>                      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> /&gt;</span>            <br>        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>               <br>      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>         <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;</span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">keyWord</span>: <span class="hljs-string">&quot;&quot;</span>,</span><br><span class="language-javascript">          <span class="hljs-attr">persons</span>: [</span><br><span class="language-javascript">            &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;001&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;马冬梅&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">33</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">&quot;女&quot;</span> &#125;,</span><br><span class="language-javascript">            &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;002&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;周冬雨&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">&quot;女&quot;</span> &#125;,</span><br><span class="language-javascript">            &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;003&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;周杰伦&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">18</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">&quot;男&quot;</span> &#125;,</span><br><span class="language-javascript">            &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;004&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;温兆伦&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">&quot;男&quot;</span> &#125;,</span><br><span class="language-javascript">          ],</span><br><span class="language-javascript">          <span class="hljs-attr">sortType</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// 0原顺序  1 降序  2 升序</span></span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">computed</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-title function_">filPersons</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-keyword">const</span> arr = <span class="hljs-variable language_">this</span>.<span class="hljs-property">persons</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">p</span>) =&gt;</span> &#123;</span><br><span class="language-javascript">              <span class="hljs-keyword">return</span> p.<span class="hljs-property">name</span>.<span class="hljs-title function_">indexOf</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">keyWord</span>) !== -<span class="hljs-number">1</span>;</span><br><span class="language-javascript">            &#125;);</span><br><span class="language-javascript"></span><br><span class="language-javascript">            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">sortType</span>) &#123;</span><br><span class="language-javascript">              arr.<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">p1, p2</span>) =&gt;</span> &#123;</span><br><span class="language-javascript">                <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">sortType</span> == <span class="hljs-number">1</span> ? p2.<span class="hljs-property">age</span> - p1.<span class="hljs-property">age</span> : p1.<span class="hljs-property">age</span> - p2.<span class="hljs-property">age</span>;</span><br><span class="language-javascript">              &#125;);</span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">            <span class="hljs-keyword">return</span> arr;</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>更新时的一个问题</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>列表排序<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>人员列表<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;updateMei&quot;</span>&gt;</span>点我修改马冬梅<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>        <br>      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>                   <br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(person,index) in persons&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;person.id&quot;</span>&gt;</span><br>                          &#123;&#123;person.name&#125;&#125; - &#123;&#123;person.age&#125;&#125; - &#123;&#123;person.sex&#125;&#125;    <br>                 <br>        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>               <br>      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>         <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;</span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">persons</span>: [</span><br><span class="language-javascript">            &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;001&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;马冬梅&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">33</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">&quot;女&quot;</span> &#125;,</span><br><span class="language-javascript">            &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;002&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;周冬雨&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">&quot;女&quot;</span> &#125;,</span><br><span class="language-javascript">            &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;003&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;周杰伦&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">18</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">&quot;男&quot;</span> &#125;,</span><br><span class="language-javascript">            &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;004&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;温兆伦&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">&quot;男&quot;</span> &#125;,</span><br><span class="language-javascript">          ],</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-title function_">updateMei</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-comment">// this.persons[0].name = &#x27;马老师&#x27;    // 奏效</span></span><br><span class="language-javascript">            <span class="hljs-comment">// this.persons[0].age = 50          // 奏效</span></span><br><span class="language-javascript">            <span class="hljs-comment">// this.persons[0].sex = &#x27;男&#x27;        // 奏效</span></span><br><span class="language-javascript">            <span class="hljs-variable language_">this</span>.<span class="hljs-property">persons</span>[<span class="hljs-number">0</span>] = &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;001&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;马老师&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">50</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">&quot;男&quot;</span> &#125;;</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>Vue 检测数据改变的原理</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Vue检测数据改变的原理<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>学校名称: &#123;&#123;name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>学校地址: &#123;&#123;address&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>         <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;</span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;尚硅谷&quot;</span>,</span><br><span class="language-javascript">          <span class="hljs-attr">address</span>: <span class="hljs-string">&quot;北京&quot;</span>,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;&#125;,</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>模拟一个数据检测</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>模拟一个数据检测<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">let</span> data = &#123;</span><br><span class="language-javascript">        <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;尚硅谷&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">address</span>: <span class="hljs-string">&quot;北京&quot;</span>,</span><br><span class="language-javascript">      &#125;; <span class="hljs-comment">// let tmp = &#x27;尚硅谷&#x27; // setInterval(() =&gt; &#123; //     if (data.name !== tmp) &#123; //         tmp = data.name //         console.log(&#x27;name被改了&#x27;); //     &#125; // &#125;) // Object.defineProperty(data, &#x27;name&#x27;, &#123; //     get() &#123; //         return data.name //     &#125;, //     set(val) &#123; //         data.name = val //     &#125; // &#125;) // 创建一个监视的实例对象, 用于监视data中属性的变化</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> obs = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Observer</span>(data);</span><br><span class="language-javascript">      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obs); <span class="hljs-comment">// 准备一个vm实例对象</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">let</span> vm = &#123;&#125;;</span><br><span class="language-javascript">      vm.<span class="hljs-property">_data</span> = data = obs; <span class="hljs-comment">// 创建一个监视实例对象</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">function</span> <span class="hljs-title function_">Observer</span>(<span class="hljs-params">obj</span>) &#123;</span><br><span class="language-javascript">        <span class="hljs-comment">// 汇总对象中的所有属性形成一个数组</span></span><br><span class="language-javascript">        <span class="hljs-keyword">const</span> keys = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(obj);</span><br><span class="language-javascript">        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(keys);</span><br><span class="language-javascript">        keys.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">k</span>) =&gt;</span> &#123;</span><br><span class="language-javascript">          <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-variable language_">this</span>, k, &#123;</span><br><span class="language-javascript">            <span class="hljs-title function_">get</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">              <span class="hljs-keyword">return</span> obj[k];</span><br><span class="language-javascript">            &#125;,</span><br><span class="language-javascript">            <span class="hljs-title function_">set</span>(<span class="hljs-params">val</span>) &#123;</span><br><span class="language-javascript">              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(</span><br><span class="language-javascript">                <span class="hljs-string">`<span class="hljs-subst">$&#123;k&#125;</span>被改了被改了, 我要去解析模板, 生成虚拟DOM.....我要开始忙了`</span></span><br><span class="language-javascript">              );</span><br><span class="language-javascript">              obj[k] = val;</span><br><span class="language-javascript">            &#125;,</span><br><span class="language-javascript">          &#125;);</span><br><span class="language-javascript">        &#125;);</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>Vue.set 的使用</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Vue检测数据改变的原理<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>学校名称: &#123;&#123;school.name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>学校地址: &#123;&#123;school.address&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>校长: &#123;&#123;school.leader&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">hr</span> /&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;addSex&quot;</span>&gt;</span>点我添加一个性别: 性别为男<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>      <br>       <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>姓名: &#123;&#123;student.name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>年龄: &#123;&#123;student.age.rAge&#125;&#125;, &#123;&#123;student.age.sAge&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;student.sex&quot;</span>&gt;</span>性别: &#123;&#123;student.sex&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>         <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;</span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">school</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;尚硅谷&quot;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">address</span>: <span class="hljs-string">&quot;北京&quot;</span>,</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">          <span class="hljs-attr">student</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;tom&quot;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">age</span>: &#123;</span><br><span class="language-javascript">              <span class="hljs-attr">rAge</span>: <span class="hljs-number">40</span>,</span><br><span class="language-javascript">              <span class="hljs-attr">sAge</span>: <span class="hljs-number">29</span>,</span><br><span class="language-javascript">            &#125;,</span><br><span class="language-javascript">            <span class="hljs-attr">friends</span>: [</span><br><span class="language-javascript">              &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;jerry&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">35</span> &#125;,</span><br><span class="language-javascript">              &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;tony&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">36</span> &#125;,</span><br><span class="language-javascript">            ],</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-title function_">addSex</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">this</span>.$set(<span class="hljs-variable language_">this</span>.<span class="hljs-property">student</span>, <span class="hljs-string">&quot;sex&quot;</span>, <span class="hljs-string">&quot;男&quot;</span>);</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>Vue 检测数据改变的原理_数组</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Vue检测数据改变的原理_数组<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>学校名称: &#123;&#123;school.name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>学校地址: &#123;&#123;school.address&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>校长: &#123;&#123;school.leader&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">hr</span> /&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;addSex&quot;</span>&gt;</span>点我添加一个性别: 性别为男<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>      <br>       <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>姓名: &#123;&#123;student.name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>年龄: &#123;&#123;student.age.rAge&#125;&#125;, &#123;&#123;student.age.sAge&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;student.sex&quot;</span>&gt;</span>性别: &#123;&#123;student.sex&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>爱好<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>               <br>      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>                   <br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(h,index) in student.hobby&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;index&quot;</span>&gt;</span><br>                          &#123;&#123;h&#125;&#125;            <br>        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>               <br>      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>         <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;</span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">school</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;尚硅谷&quot;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">address</span>: <span class="hljs-string">&quot;北京&quot;</span>,</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">          <span class="hljs-attr">student</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;tom&quot;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">age</span>: &#123;</span><br><span class="language-javascript">              <span class="hljs-attr">rAge</span>: <span class="hljs-number">40</span>,</span><br><span class="language-javascript">              <span class="hljs-attr">sAge</span>: <span class="hljs-number">29</span>,</span><br><span class="language-javascript">            &#125;,</span><br><span class="language-javascript">            <span class="hljs-attr">hobby</span>: [<span class="hljs-string">&quot;抽烟&quot;</span>, <span class="hljs-string">&quot;喝酒&quot;</span>, <span class="hljs-string">&quot;烫头&quot;</span>],</span><br><span class="language-javascript">            <span class="hljs-attr">friends</span>: [</span><br><span class="language-javascript">              &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;jerry&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">35</span> &#125;,</span><br><span class="language-javascript">              &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;tony&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">36</span> &#125;,</span><br><span class="language-javascript">            ],</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-title function_">addSex</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">this</span>.$set(<span class="hljs-variable language_">this</span>.<span class="hljs-property">student</span>, <span class="hljs-string">&quot;sex&quot;</span>, <span class="hljs-string">&quot;男&quot;</span>);</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>总结 Vue 数据监测</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>总结Vue数据监测<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>           <br>    <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">            Vue监视数据的原理：</span><br><span class="hljs-comment">                1. vue会监视data中所有层次的数据。</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">                2. 如何监测对象中的数据？</span><br><span class="hljs-comment">                                通过setter实现监视，且要在new Vue时就传入要监测的数据。</span><br><span class="hljs-comment">                                    (1).对象中后追加的属性，Vue默认不做响应式处理</span><br><span class="hljs-comment">                                    (2).如需给后添加的属性做响应式，请使用如下API：</span><br><span class="hljs-comment">                                                    Vue.set(target，propertyName/index，value) 或 </span><br><span class="hljs-comment">                                                    vm.$set(target，propertyName/index，value)</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">                3. 如何监测数组中的数据？</span><br><span class="hljs-comment">                                    通过包裹数组更新元素的方法实现，本质就是做了两件事：</span><br><span class="hljs-comment">                                        (1).调用原生对应的方法对数组进行更新。</span><br><span class="hljs-comment">                                        (2).重新解析模板，进而更新页面。</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">                4.在Vue修改数组中的某个元素一定要用如下方法：</span><br><span class="hljs-comment">                            1.使用这些API:push()、pop()、shift()、unshift()、splice()、sort()、reverse()</span><br><span class="hljs-comment">                            2.Vue.set() 或 vm.$set()</span><br><span class="hljs-comment">                </span><br><span class="hljs-comment">                特别注意：Vue.set() 和 vm.$set() 不能给vm 或 vm的根数据对象 添加属性！！！</span><br><span class="hljs-comment">        --&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>学生信息<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><br>              <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;student.age++&quot;</span>&gt;</span>年龄+1岁<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><br>              <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;addSex&quot;</span>&gt;</span>添加性别属性，默认值：男<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><br>              <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;updateSex&quot;</span>&gt;</span>修改性别<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><br>              <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;addFriends&quot;</span>&gt;</span>在列表首位添加一个朋友<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;updateFriends&quot;</span>&gt;</span>修改第一个朋友的名字为：张三<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><br>              <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;addHobby&quot;</span>&gt;</span>添加一个爱好<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><br>              <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;updateHobby&quot;</span>&gt;</span>修改第一个爱好为：开车<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><br>              <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;deleteHobby&quot;</span>&gt;</span>过滤掉爱好中的抽烟<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>姓名: &#123;&#123;student.name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>年龄: &#123;&#123;student.age&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;student.sex&quot;</span>&gt;</span>性别: &#123;&#123;student.sex&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>爱好<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>                   <br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(h,index) in student.hobby&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;index&quot;</span>&gt;</span><br>                          &#123;&#123;h&#125;&#125;            <br>        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>               <br>      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>朋友们<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>                   <br>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(f,index) in student.friends&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;index&quot;</span>&gt;</span><br>                          &#123;&#123;f.name&#125;&#125; -- &#123;&#123;f.age&#125;&#125;            <br>        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>               <br>      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>         <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;</span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">student</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;tom&quot;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">age</span>: <span class="hljs-number">18</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">hobby</span>: [<span class="hljs-string">&quot;抽烟&quot;</span>, <span class="hljs-string">&quot;喝酒&quot;</span>, <span class="hljs-string">&quot;烫头&quot;</span>],</span><br><span class="language-javascript">            <span class="hljs-attr">friends</span>: [</span><br><span class="language-javascript">              &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;jerry&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">35</span> &#125;,</span><br><span class="language-javascript">              &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;tony&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">36</span> &#125;,</span><br><span class="language-javascript">            ],</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-title function_">addSex</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">this</span>.$set(<span class="hljs-variable language_">this</span>.<span class="hljs-property">student</span>, <span class="hljs-string">&quot;sex&quot;</span>, <span class="hljs-string">&quot;男&quot;</span>);</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">          <span class="hljs-title function_">updateSex</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">this</span>.<span class="hljs-property">student</span>.<span class="hljs-property">sex</span> = <span class="hljs-string">&quot;未知&quot;</span>;</span><br><span class="language-javascript">            <span class="hljs-comment">/*                     if (this.student.sex === &#x27;男&#x27;) &#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">                        this.$set(this.student, &#x27;sex&#x27;, &#x27;女&#x27;)</span></span><br><span class="hljs-comment"><span class="language-javascript">                    &#125; else &#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">                        this.$set(this.student, &#x27;sex&#x27;, &#x27;男&#x27;)</span></span><br><span class="hljs-comment"><span class="language-javascript">                    &#125; */</span></span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">          <span class="hljs-title function_">addFriends</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-comment">// vm.student.friends.unshift(&#123;name: &#x27;肉豆蔻&#x27;, age: 18&#125;)</span></span><br><span class="language-javascript">            <span class="hljs-variable language_">this</span>.<span class="hljs-property">student</span>.<span class="hljs-property">friends</span>.<span class="hljs-title function_">unshift</span>(&#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;肉豆蔻&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">18</span> &#125;);</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">          <span class="hljs-title function_">updateFriends</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-comment">// vm.student.friends[0].name = &#x27;张三&#x27;</span></span><br><span class="language-javascript">            <span class="hljs-variable language_">this</span>.<span class="hljs-property">student</span>.<span class="hljs-property">friends</span>[<span class="hljs-number">0</span>].<span class="hljs-property">name</span> = <span class="hljs-string">&quot;张三&quot;</span>;</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">          <span class="hljs-title function_">addHobby</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-comment">// vm.student.hobby.push(&#x27;学习&#x27;)</span></span><br><span class="language-javascript">            <span class="hljs-variable language_">this</span>.<span class="hljs-property">student</span>.<span class="hljs-property">hobby</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">&quot;学习&quot;</span>);</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">          <span class="hljs-title function_">updateHobby</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-comment">// vm.$set(vm.student.hobby, 0, &#x27;开车&#x27;)</span></span><br><span class="language-javascript">            <span class="hljs-variable language_">this</span>.<span class="hljs-property">student</span>.<span class="hljs-property">hobby</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&quot;开车&quot;</span>); <span class="hljs-comment">// this.$set(this.student.hobby, 0, &#x27;开车&#x27;)</span></span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">          <span class="hljs-title function_">deleteHobby</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-comment">// vm.student.hobby.filter(h =&gt; h.indexOf(&#x27;抽烟&#x27;))</span></span><br><span class="language-javascript">            <span class="hljs-comment">// filter是浅拷贝</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">            <span class="hljs-comment">// this.student.hobby = this.student.hobby.filter(h =&gt; h.indexOf(&#x27;抽烟&#x27;))</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">            <span class="hljs-variable language_">this</span>.<span class="hljs-property">student</span>.<span class="hljs-property">hobby</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">student</span>.<span class="hljs-property">hobby</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">h</span>) =&gt;</span> &#123;</span><br><span class="language-javascript">              <span class="hljs-keyword">return</span> h !== <span class="hljs-string">&quot;抽烟&quot;</span>;</span><br><span class="language-javascript">            &#125;);</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">      &#125;); <span class="hljs-comment">/*</span></span><br><span class="hljs-comment"><span class="language-javascript">        filter是浅拷贝</span></span><br><span class="hljs-comment"><span class="language-javascript">        </span></span><br><span class="hljs-comment"><span class="language-javascript">        const words = [&#x27;spray&#x27;, &#x27;limit&#x27;, &#x27;elite&#x27;, &#x27;exuberant&#x27;, &#x27;destruction&#x27;, &#x27;present&#x27;];</span></span><br><span class="hljs-comment"><span class="language-javascript"></span></span><br><span class="hljs-comment"><span class="language-javascript"></span></span><br><span class="hljs-comment"><span class="language-javascript">        const result = words.filter(word =&gt; word.length &gt; 6);</span></span><br><span class="hljs-comment"><span class="language-javascript"></span></span><br><span class="hljs-comment"><span class="language-javascript"></span></span><br><span class="hljs-comment"><span class="language-javascript">        console.log(result);</span></span><br><span class="hljs-comment"><span class="language-javascript">        */</span></span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="收集表单数据"><a href="#收集表单数据" class="headerlink" title="收集表单数据"></a>收集表单数据</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>收集表单数据<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>           <br>    <span class="hljs-comment">&lt;!-- </span><br><span class="hljs-comment">            收集表单数据：</span><br><span class="hljs-comment">                    若：&lt;input type=&quot;text&quot;/&gt;，则v-model收集的是value值，用户输入的就是value值。</span><br><span class="hljs-comment">                    若：&lt;input type=&quot;radio&quot;/&gt;，则v-model收集的是value值，且要给标签配置value值。</span><br><span class="hljs-comment">                    若：&lt;input type=&quot;checkbox&quot;/&gt;</span><br><span class="hljs-comment">                            1.没有配置input的value属性，那么收集的就是checked（勾选 or 未勾选，是布尔值）</span><br><span class="hljs-comment">                            2.配置input的value属性:</span><br><span class="hljs-comment">                                    (1)v-model的初始值是非数组，那么收集的就是checked（勾选 or 未勾选，是布尔值）</span><br><span class="hljs-comment">                                    (2)v-model的初始值是数组，那么收集的的就是value组成的数组</span><br><span class="hljs-comment">                    备注：v-model的三个修饰符：</span><br><span class="hljs-comment">                                    lazy：失去焦点再收集数据</span><br><span class="hljs-comment">                                    number：输入字符串转为有效的数字</span><br><span class="hljs-comment">                                    trim：输入首尾空格过滤</span><br><span class="hljs-comment">        --&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">form</span> @<span class="hljs-attr">submit.prevent</span>=<span class="hljs-string">&quot;demo&quot;</span>&gt;</span><br>                    账号:<br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span><br><span class="hljs-tag">          <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span></span><br><span class="hljs-tag">          <span class="hljs-attr">v-model.trim</span>=<span class="hljs-string">&quot;userInfo.account&quot;</span></span><br><span class="hljs-tag">          <span class="hljs-attr">autofocus</span></span><br><span class="hljs-tag">        /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>                    密码:<br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;userInfo.password&quot;</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>                    年龄:<br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;number&quot;</span> <span class="hljs-attr">v-model.number</span>=<span class="hljs-string">&quot;userInfo.age&quot;</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>                    性别:             男<span class="hljs-tag">&lt;<span class="hljs-name">input</span></span><br><span class="hljs-tag">          <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span></span><br><span class="hljs-tag">          <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;sex&quot;</span></span><br><span class="hljs-tag">          <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;male&quot;</span></span><br><span class="hljs-tag">          <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;userInfo.sex&quot;</span></span><br><span class="hljs-tag">        /&gt;</span><br>                    女<span class="hljs-tag">&lt;<span class="hljs-name">input</span></span><br><span class="hljs-tag">          <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span></span><br><span class="hljs-tag">          <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;sex&quot;</span></span><br><span class="hljs-tag">          <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;female&quot;</span></span><br><span class="hljs-tag">          <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;userInfo.sex&quot;</span></span><br><span class="hljs-tag">        /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>                    爱好:             抽烟<span class="hljs-tag">&lt;<span class="hljs-name">input</span></span><br><span class="hljs-tag">          <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span></span><br><span class="hljs-tag">          <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;hobby&quot;</span></span><br><span class="hljs-tag">          <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;抽烟&quot;</span></span><br><span class="hljs-tag">          <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;userInfo.hobby&quot;</span></span><br><span class="hljs-tag">        /&gt;</span><br>                    喝酒<span class="hljs-tag">&lt;<span class="hljs-name">input</span></span><br><span class="hljs-tag">          <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span></span><br><span class="hljs-tag">          <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;hobby&quot;</span></span><br><span class="hljs-tag">          <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;喝酒&quot;</span></span><br><span class="hljs-tag">          <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;userInfo.hobby&quot;</span></span><br><span class="hljs-tag">        /&gt;</span><br>                    烫头<span class="hljs-tag">&lt;<span class="hljs-name">input</span></span><br><span class="hljs-tag">          <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span></span><br><span class="hljs-tag">          <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;hobby&quot;</span></span><br><span class="hljs-tag">          <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;烫头&quot;</span></span><br><span class="hljs-tag">          <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;userInfo.hobby&quot;</span></span><br><span class="hljs-tag">        /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>                    所属校区            <br>        <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;userInfo.city&quot;</span>&gt;</span><br>                         <br>          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span>请选择校区<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br>                         <br>          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;beijing&quot;</span>&gt;</span>北京<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br>                         <br>          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;shanghai&quot;</span>&gt;</span>上海<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br>                         <br>          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;shenzhen&quot;</span>&gt;</span>深圳<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br>                         <br>          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;wuhan&quot;</span>&gt;</span>武汉<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br>                     <br>        <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>                    其他信息:            <br>        <span class="hljs-tag">&lt;<span class="hljs-name">textarea</span> <span class="hljs-attr">v-model.lazy</span>=<span class="hljs-string">&quot;userInfo.other&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">textarea</span>&gt;</span>            <br>        <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;userInfo.agree&quot;</span> /&gt;</span>          <br>          阅读并接受<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://www.atguigu.com&quot;</span>&gt;</span>《用户协议》<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>          <br>          <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>提交<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>        <br>      <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br>         <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;</span><br><span class="language-javascript">      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">userInfo</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">account</span>: <span class="hljs-string">&quot;&quot;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">password</span>: <span class="hljs-string">&quot;&quot;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">age</span>: <span class="hljs-number">18</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">sex</span>: <span class="hljs-string">&quot;female&quot;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">hobby</span>: [],</span><br><span class="language-javascript">            <span class="hljs-attr">city</span>: <span class="hljs-string">&quot;beijing&quot;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">other</span>: <span class="hljs-string">&quot;&quot;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">agree</span>: <span class="hljs-string">&quot;&quot;</span>,</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-title function_">demo</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">userInfo</span>));</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h2><p>在<a href="https://www.bootcdn.cn/">https://www.bootcdn.cn/</a>网站中找到 dayjs.min.js 并且引入</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><br><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>过滤器<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/dayjs.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">            过滤器：</span><br><span class="hljs-comment">                定义：对要显示的数据进行特定格式化后再显示（适用于一些简单逻辑的处理）。</span><br><span class="hljs-comment">                语法：</span><br><span class="hljs-comment">                        1.注册过滤器：Vue.filter(name,callback) 或 new Vue&#123;filters:&#123;&#125;&#125;</span><br><span class="hljs-comment">                        2.使用过滤器：&#123;&#123; xxx | 过滤器名&#125;&#125;  或  v-bind:属性 = &quot;xxx | 过滤器名&quot;</span><br><span class="hljs-comment">                备注：</span><br><span class="hljs-comment">                        1.过滤器也可以接收额外参数、多个过滤器也可以串联</span><br><span class="hljs-comment">                        2.并没有改变原本的数据, 是产生新的对应的数据</span><br><span class="hljs-comment">        --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>显示格式化后的时间<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>       <span class="hljs-comment">&lt;!-- 计算属性实现 --&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>现在是: &#123;&#123;fmtTime&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br>       <span class="hljs-comment">&lt;!-- methods实现 --&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>现在是: &#123;&#123;getFmtTime()&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br>       <span class="hljs-comment">&lt;!-- 过滤器实现 --&gt;</span><br>       <span class="hljs-comment">&lt;!-- |是管道符 --&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>现在是: &#123;&#123;time | timeFormater&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br>       <span class="hljs-comment">&lt;!-- 过滤器传参 --&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>现在是: &#123;&#123;time | timeFormater(&#x27;YYYY_MM_DD&#x27;)&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br>       <span class="hljs-comment">&lt;!-- 多个过滤器的串联 --&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>现在是: &#123;&#123;time | timeFormater(&#x27;YYYY_MM_DD&#x27;) | mySlice&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br>       <span class="hljs-comment">&lt;!-- 属性中也可以使用管道符过滤 --&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">:x</span>=<span class="hljs-string">&quot;msg | mySlice&quot;</span>&gt;</span>尚硅谷<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br>       <span class="hljs-comment">&lt;!-- 注意 , 过滤器只能使用在插值语法中和v-bind中 --&gt;</span><br>       <span class="hljs-comment">&lt;!-- 不能使用在v-model中 --&gt;</span><br>       <span class="hljs-comment">&lt;!-- &lt;input type=&quot;text&quot; v-model=&quot;msg | mySilce&quot;&gt; --&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root2&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>&#123;&#123;name | mySlice&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span></span><br><span class="language-javascript">        <span class="hljs-comment">// 全局过滤器</span></span><br><span class="language-javascript">        <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-string">&#x27;mySlice&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">value</span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-keyword">return</span> value.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">4</span>);</span><br><span class="language-javascript">        &#125;)</span><br><span class="language-javascript"></span><br><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-keyword">const</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">            <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#root&#x27;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">                <span class="hljs-comment">// time: 1621561377603 // 时间戳</span></span><br><span class="language-javascript">                <span class="hljs-attr">time</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(), <span class="hljs-comment">// 时间戳</span></span><br><span class="language-javascript">                <span class="hljs-attr">msg</span>: <span class="hljs-string">&#x27;你好,尚硅谷&#x27;</span></span><br><span class="language-javascript">            &#125;,</span><br><span class="language-javascript">            <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">                <span class="hljs-title function_">getFmtTime</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">                    <span class="hljs-keyword">return</span> <span class="hljs-title function_">dayjs</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">time</span>).<span class="hljs-title function_">format</span>(<span class="hljs-string">&#x27;YYYY-MM-DD HH:mm:ss&#x27;</span>);</span><br><span class="language-javascript">                &#125;</span><br><span class="language-javascript">            &#125;,</span><br><span class="language-javascript">            <span class="hljs-attr">computed</span>: &#123;</span><br><span class="language-javascript">                <span class="hljs-title function_">fmtTime</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">                    <span class="hljs-keyword">return</span> <span class="hljs-title function_">dayjs</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">time</span>).<span class="hljs-title function_">format</span>(<span class="hljs-string">&#x27;YYYY-MM-DD HH:mm:ss&#x27;</span>);</span><br><span class="language-javascript">                &#125;</span><br><span class="language-javascript">            &#125;,</span><br><span class="language-javascript">            <span class="hljs-comment">// 局部过滤器</span></span><br><span class="language-javascript">            <span class="hljs-attr">filters</span>: &#123;</span><br><span class="language-javascript">                <span class="hljs-title function_">timeFormater</span>(<span class="hljs-params">value, str=<span class="hljs-string">&#x27;YYYY-MM-DD HH:mm:ss&#x27;</span></span>) &#123;</span><br><span class="language-javascript">                    <span class="hljs-keyword">return</span> <span class="hljs-title function_">dayjs</span>(value).<span class="hljs-title function_">format</span>(str);</span><br><span class="language-javascript">                &#125;,</span><br><span class="language-javascript">                <span class="hljs-comment">// mySlice(value) &#123;</span></span><br><span class="language-javascript">                <span class="hljs-comment">//     return value.slice(0, 4);</span></span><br><span class="language-javascript">                <span class="hljs-comment">// &#125;</span></span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">        &#125;)</span><br><span class="language-javascript"></span><br><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">            <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#root2&#x27;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">                <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;hello, atguigu&#x27;</span></span><br><span class="language-javascript">            &#125;,</span><br><span class="language-javascript">            <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">               </span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">        &#125;)</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="内置指令"><a href="#内置指令" class="headerlink" title="内置指令"></a>内置指令</h2><p>v-text</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>v-text指令<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>       <br>    <span class="hljs-comment">&lt;!-- </span><br><span class="hljs-comment">                我们学过的指令：</span><br><span class="hljs-comment">                        v-bind  : 单向绑定解析表达式, 可简写为 :xxx</span><br><span class="hljs-comment">                        v-model : 双向数据绑定</span><br><span class="hljs-comment">                        v-for   : 遍历数组/对象/字符串</span><br><span class="hljs-comment">                        v-on    : 绑定事件监听, 可简写为@</span><br><span class="hljs-comment">                        v-if        : 条件渲染（动态控制节点是否存存在）</span><br><span class="hljs-comment">                        v-else  : 条件渲染（动态控制节点是否存存在）</span><br><span class="hljs-comment">                        v-show  : 条件渲染 (动态控制节点是否展示)</span><br><span class="hljs-comment">                v-text指令：</span><br><span class="hljs-comment">                        1.作用：向其所在的节点中渲染文本内容。</span><br><span class="hljs-comment">                        2.与插值语法的区别：v-text会替换掉节点中的内容，&#123;&#123;xx&#125;&#125;则不会。</span><br><span class="hljs-comment">    --&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>你好, &#123;&#123;name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-text</span>=<span class="hljs-string">&quot;name&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-text</span>=<span class="hljs-string">&quot;str&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>         <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;</span><br><span class="language-javascript">      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;尚硅谷&quot;</span>,</span><br><span class="language-javascript">          <span class="hljs-attr">str</span>: <span class="hljs-string">&quot;&lt;h2&gt;你好啊!&lt;/h2&gt;&quot;</span>,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;&#125;,</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>v-html<br>v-html 有安全性问题！！！！<br>(1).在网站上动态渲染任意 HTML 是非常危险的，容易导致 XSS 攻击。<br>(2).一定要在可信的内容上使用 v-html，永不要用在用户提交的内容上！</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>v-html指令<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>           <br>    <span class="hljs-comment">&lt;!-- </span><br><span class="hljs-comment">                v-html指令：</span><br><span class="hljs-comment">                        1.作用：向指定节点中渲染包含html结构的内容。</span><br><span class="hljs-comment">                        2.与插值语法的区别：</span><br><span class="hljs-comment">                                    (1).v-html会替换掉节点中所有的内容，&#123;&#123;xx&#125;&#125;则不会。</span><br><span class="hljs-comment">                                    (2).v-html可以识别html结构。</span><br><span class="hljs-comment">                        3.严重注意：v-html有安全性问题！！！！</span><br><span class="hljs-comment">                                    (1).在网站上动态渲染任意HTML是非常危险的，容易导致XSS攻击。</span><br><span class="hljs-comment">                                    (2).一定要在可信的内容上使用v-html，永不要用在用户提交的内容上！</span><br><span class="hljs-comment">        --&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>你好, &#123;&#123;name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-html</span>=<span class="hljs-string">&quot;str&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-html</span>=<span class="hljs-string">&quot;str2&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>         <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;</span><br><span class="language-javascript">      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;尚硅谷&quot;</span>,</span><br><span class="language-javascript">          <span class="hljs-attr">str</span>: <span class="hljs-string">&quot;&lt;h2&gt;你好啊!&lt;/h2&gt;&quot;</span>,</span><br><span class="language-javascript">          <span class="hljs-attr">str2</span>: <span class="hljs-string">&#x27;&lt;a href=javascript:location.href=&quot;http://www.baidu.com?&quot;+document.cookie&gt;点我有好看的&lt;/a&gt;&#x27;</span>,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;&#125;,</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="/assets/18d5ebb091574d31b57b07f641bd02d4.png"><br><img src="/assets/9d5ac7abd3104f3e8eba1f39940d7559.png"><br>v-cloak</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>v-cloak指令<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css">              <span class="hljs-selector-attr">[v-cloak]</span> &#123;</span><br><span class="language-css">                  <span class="hljs-attribute">display</span>: none;</span><br><span class="language-css">              &#125;</span><br><span class="language-css">         </span><br><span class="language-css">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>           <br>    <span class="hljs-comment">&lt;!-- </span><br><span class="hljs-comment">                v-html指令：</span><br><span class="hljs-comment">                        1.作用：向指定节点中渲染包含html结构的内容。</span><br><span class="hljs-comment">                        2.与插值语法的区别：</span><br><span class="hljs-comment">                                    (1).v-html会替换掉节点中所有的内容，&#123;&#123;xx&#125;&#125;则不会。</span><br><span class="hljs-comment">                                    (2).v-html可以识别html结构。</span><br><span class="hljs-comment">                        3.严重注意：v-html有安全性问题！！！！</span><br><span class="hljs-comment">                                    (1).在网站上动态渲染任意HTML是非常危险的，容易导致XSS攻击。</span><br><span class="hljs-comment">                                    (2).一定要在可信的内容上使用v-html，永不要用在用户提交的内容上！</span><br><span class="hljs-comment">        --&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">v-cloak</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>         <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>       <br>    <span class="hljs-comment">&lt;!-- 引入在线的vue.js然后F12Network设置网速为慢 --&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;</span><br><span class="language-javascript">      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;尚硅谷&quot;</span>,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;&#125;,</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>v-once</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>v-once指令<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">            v-once指令：</span><br><span class="hljs-comment">                        1.v-once所在节点在初次动态渲染后，就视为静态内容了。</span><br><span class="hljs-comment">                        2.以后数据的改变不会引起v-once所在结构的更新，可以用于优化性能。</span><br><span class="hljs-comment">        --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">v-once</span>&gt;</span>初始的时候n = &#123;&#123;n&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>当前的n = &#123;&#123;n&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;n++&quot;</span>&gt;</span>点我n+1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span></span><br><span class="language-javascript">        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">            <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#root&#x27;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">                <span class="hljs-attr">n</span>: <span class="hljs-number">1</span></span><br><span class="language-javascript">            &#125;,</span><br><span class="language-javascript">            <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">               </span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">        &#125;)</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>v-pre</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>v-pre_指令<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">            v-pre指令：</span><br><span class="hljs-comment">                    1.跳过其所在节点的编译过程。</span><br><span class="hljs-comment">                    2.可利用它跳过：没有使用指令语法、没有使用插值语法的节点，会加快编译。</span><br><span class="hljs-comment">        --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">v-pre</span>&gt;</span>Vue其实很简单<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>当前的n = &#123;&#123;n&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;n++&quot;</span>&gt;</span>点我n+1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span></span><br><span class="language-javascript">        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">            <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#root&#x27;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">                <span class="hljs-attr">n</span>: <span class="hljs-number">1</span></span><br><span class="language-javascript">            &#125;,</span><br><span class="language-javascript">            <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">               </span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">        &#125;)</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="自定义指令"><a href="#自定义指令" class="headerlink" title="自定义指令"></a>自定义指令</h2><p>自定义指令</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>自定义指令<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>       <br>    <span class="hljs-comment">&lt;!-- </span><br><span class="hljs-comment">                需求1：定义一个v-big指令，和v-text功能类似，但会把绑定的数值放大10倍。</span><br><span class="hljs-comment">                需求2：定义一个v-fbind指令，和v-bind功能类似，但可以让其所绑定的input元素默认获取焦点。</span><br><span class="hljs-comment">                自定义指令总结：</span><br><span class="hljs-comment">                        一、定义语法：</span><br><span class="hljs-comment">                                    (1).局部指令：</span><br><span class="hljs-comment">                                                new Vue(&#123;                                                           new Vue(&#123;</span><br><span class="hljs-comment">                                                    directives:&#123;指令名:配置对象&#125;   或           directives&#123;指令名:回调函数&#125;</span><br><span class="hljs-comment">                                                &#125;)                                                                      &#125;)</span><br><span class="hljs-comment">                                    (2).全局指令：</span><br><span class="hljs-comment">                                                    Vue.directive(指令名,配置对象) 或   Vue.directive(指令名,回调函数)</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">                        二、配置对象中常用的3个回调：</span><br><span class="hljs-comment">                                    (1).bind：指令与元素成功绑定时调用。</span><br><span class="hljs-comment">                                    (2).inserted：指令所在元素被插入页面时调用。</span><br><span class="hljs-comment">                                    (3).update：指令所在模板结构被重新解析时调用。</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">                        三、备注：</span><br><span class="hljs-comment">                                    1.指令定义时不加v-，但使用时要加v-；</span><br><span class="hljs-comment">                                    2.指令名如果是多个单词，要使用kebab-case命名方式，不要用camelCase命名。</span><br><span class="hljs-comment">        --&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>当前的n值是: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">v-text</span>=<span class="hljs-string">&quot;n&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>放大10倍后的值是: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">v-big</span>=<span class="hljs-string">&quot;n&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>放大10倍后的值是: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">v-big-number</span>=<span class="hljs-string">&quot;n&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;n++&quot;</span>&gt;</span>点我n+1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>        <br>      <span class="hljs-tag">&lt;<span class="hljs-name">hr</span> /&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">v-fbind:value</span>=<span class="hljs-string">&quot;n&quot;</span> /&gt;</span>    <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root2&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">v-fbind:value</span>=<span class="hljs-string">&quot;x&quot;</span> /&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>; <span class="hljs-comment">// 定义全局指令</span></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">directive</span>(<span class="hljs-string">&quot;fbind&quot;</span>, &#123;</span><br><span class="language-javascript">        <span class="hljs-title function_">bind</span>(<span class="hljs-params">element, binding</span>) &#123;</span><br><span class="language-javascript">          <span class="hljs-comment">// console.log(&#x27;bind&#x27;);</span></span><br><span class="language-javascript">          element.<span class="hljs-property">value</span> = binding.<span class="hljs-property">value</span>;</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-title function_">inserted</span>(<span class="hljs-params">element, binding</span>) &#123;</span><br><span class="language-javascript">          <span class="hljs-comment">// console.log(&#x27;inserted&#x27;);</span></span><br><span class="language-javascript">          element.<span class="hljs-title function_">focus</span>();</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-title function_">update</span>(<span class="hljs-params">element, binding</span>) &#123;</span><br><span class="language-javascript">          <span class="hljs-comment">// console.log(&#x27;update&#x27;);</span></span><br><span class="language-javascript">          element.<span class="hljs-property">value</span> = binding.<span class="hljs-property">value</span>;</span><br><span class="language-javascript">          element.<span class="hljs-title function_">focus</span>();</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">      &#125;); <span class="hljs-comment">/* Vue.directive(&#x27;big&#x27;, function (element, binding) &#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">            console.log(&#x27;big&#x27;, this); // 注意此处的this是window</span></span><br><span class="hljs-comment"><span class="language-javascript">            element.innerText = binding.value * 10</span></span><br><span class="hljs-comment"><span class="language-javascript">            // console.log(element, binding);</span></span><br><span class="hljs-comment"><span class="language-javascript">            // console.log(&#x27;big&#x27;);</span></span><br><span class="hljs-comment"><span class="language-javascript">        &#125;) */</span></span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">n</span>: <span class="hljs-number">1</span>,</span><br><span class="language-javascript">          <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;尚硅谷&quot;</span>,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;&#125;, <span class="hljs-comment">// big函数何时会被调用？1.指令与元素成功绑定时（一上来）。2.指令所在的模板被重新解析时。</span></span><br><span class="language-javascript">        <span class="hljs-attr">directives</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-title function_">big</span>(<span class="hljs-params">element, binding</span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;big&quot;</span>, <span class="hljs-variable language_">this</span>); <span class="hljs-comment">// 注意此处的this是window</span></span><br><span class="language-javascript">            element.<span class="hljs-property">innerText</span> = binding.<span class="hljs-property">value</span> * <span class="hljs-number">10</span>; <span class="hljs-comment">// console.log(element, binding); // console.log(&#x27;big&#x27;);</span></span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">          <span class="hljs-string">&quot;big-number&quot;</span>(element, binding) &#123;</span><br><span class="language-javascript">            element.<span class="hljs-property">innerText</span> = binding.<span class="hljs-property">value</span> * <span class="hljs-number">10</span>; <span class="hljs-comment">// console.log(element, binding); // console.log(&#x27;big&#x27;);</span></span><br><span class="language-javascript">          &#125;, <span class="hljs-comment">// fbind(element, binding) &#123; //     element.value = binding.value //     element.focus() // &#125; // fbind: &#123; //     bind(element, binding) &#123; //         // console.log(&#x27;bind&#x27;); //         element.value = binding.value //     &#125;, //     inserted(element, binding) &#123; //         // console.log(&#x27;inserted&#x27;); //         element.focus() //     &#125;, //     update(element, binding) &#123; //         // console.log(&#x27;update&#x27;); //         element.value = binding.value //         element.focus() //     &#125; // &#125;</span></span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root2&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">x</span>: <span class="hljs-number">1</span>,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;&#125;,</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>回顾一个 DOM 操作</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>回顾一个DOM操作<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css">              <span class="hljs-selector-class">.demo</span> &#123;</span><br><span class="language-css">                  <span class="hljs-attribute">background-color</span>: orange;</span><br><span class="language-css">              &#125;</span><br><span class="language-css">         </span><br><span class="language-css">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;btn&quot;</span>&gt;</span>点我创建一个输入框<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> btn = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;btn&quot;</span>);</span><br><span class="language-javascript">      btn.<span class="hljs-property">onclick</span> = <span class="hljs-function">() =&gt;</span> &#123;</span><br><span class="language-javascript">        <span class="hljs-keyword">const</span> input = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;input&quot;</span>);</span><br><span class="language-javascript"></span><br><span class="language-javascript">        input.<span class="hljs-property">className</span> = <span class="hljs-string">&quot;demo&quot;</span>;</span><br><span class="language-javascript">        input.<span class="hljs-property">value</span> = <span class="hljs-number">99</span>;</span><br><span class="language-javascript">        input.<span class="hljs-property">onclick</span> = <span class="hljs-function">() =&gt;</span> &#123;</span><br><span class="language-javascript">          <span class="hljs-title function_">alert</span>(<span class="hljs-number">1</span>);</span><br><span class="language-javascript">        &#125;;</span><br><span class="language-javascript">        <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(input);</span><br><span class="language-javascript"></span><br><span class="language-javascript">        input.<span class="hljs-title function_">focus</span>();</span><br><span class="language-javascript"></span><br><span class="language-javascript">        input.<span class="hljs-property">parentElement</span>.<span class="hljs-property">style</span>.<span class="hljs-property">backgroundColor</span> = <span class="hljs-string">&quot;skyblue&quot;</span>;</span><br><span class="language-javascript">        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(input.<span class="hljs-property">parentElement</span>);</span><br><span class="language-javascript">      &#125;;</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="引出生命周期"><a href="#引出生命周期" class="headerlink" title="引出生命周期"></a>引出生命周期</h2><p><img src="/assets/4684cf41eadf47a284945f0d3e7d788a.png"><br>引出生命周期</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>引出生命周期<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>       <br>    <span class="hljs-comment">&lt;!-- </span><br><span class="hljs-comment">                生命周期：</span><br><span class="hljs-comment">                        1.又名：生命周期回调函数、生命周期函数、生命周期钩子。</span><br><span class="hljs-comment">                        2.是什么：Vue在关键时刻帮我们调用的一些特殊名称的函数。</span><br><span class="hljs-comment">                        3.生命周期函数的名字不可更改，但函数的具体内容是程序员根据需求编写的。</span><br><span class="hljs-comment">                        4.生命周期函数中的this指向是vm 或 组件实例对象。</span><br><span class="hljs-comment">    --&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">&quot;&#123;opacity: opacity&#125;&quot;</span>&gt;</span>欢迎学习Vue<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>         <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;</span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">opacity</span>: <span class="hljs-number">1</span>,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;&#125;, <span class="hljs-comment">// Vue完成模板的解析并把初始的真实的DOM元素放入页面后 (挂载完毕) 调用mounted</span></span><br><span class="language-javascript">        <span class="hljs-title function_">mounted</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">          <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> &#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">this</span>.<span class="hljs-property">opacity</span> -= <span class="hljs-number">0.01</span>;</span><br><span class="language-javascript">            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">opacity</span> &lt;= <span class="hljs-number">0</span>) &#123;</span><br><span class="language-javascript">              <span class="hljs-variable language_">this</span>.<span class="hljs-property">opacity</span> = <span class="hljs-number">1</span>;</span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">          &#125;, <span class="hljs-number">16</span>);</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">      &#125;); <span class="hljs-comment">/* setInterval(() =&gt; &#123; // 通过外部的定时器实现(不推荐)</span></span><br><span class="hljs-comment"><span class="language-javascript">            vm.opacity -= 0.01</span></span><br><span class="hljs-comment"><span class="language-javascript">            if (vm.opacity &lt;= 0) &#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">                vm.opacity = 1</span></span><br><span class="hljs-comment"><span class="language-javascript">            &#125;</span></span><br><span class="hljs-comment"><span class="language-javascript">        &#125;, 16); */</span></span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>分析生命周期</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>分析生命周期<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span> <span class="hljs-attr">:x</span>=<span class="hljs-string">&quot;n&quot;</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>当前的n值是: &#123;&#123;n&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;add&quot;</span>&gt;</span>点我n+1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>        <br>      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;bye&quot;</span>&gt;</span>点我销毁<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>    <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;</span><br><span class="language-javascript">      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>, <span class="hljs-comment">// 使用了template配置项, 就不能有两个根节点 // template: &#x27;&lt;h2&gt;当前的n值是: &#123;&#123;n&#125;&#125;&lt;/h2&gt;&lt;button @click=&quot;add&quot;&gt;点我n+1&lt;/button&gt;&#x27;, // 应该只能有一个根节点 // template: &#x27;&lt;div&gt;&lt;h2&gt;当前的n值是: &#123;&#123;n&#125;&#125;&lt;/h2&gt;&lt;button @click=&quot;add&quot;&gt;点我n+1&lt;/button&gt;&lt;/div&gt;&#x27;, // ES6语法, 可以换行, 上面的写法不能换行 // 用了template模板之后, div#root中的x属性会被template模板覆盖掉 // 没有使用template模板, div#root中的x属性不会被替换掉 // template: ` // &lt;div&gt; //     &lt;h2&gt;当前的n值是: &#123;&#123;n&#125;&#125;&lt;/h2&gt; //     &lt;button @click=&quot;add&quot;&gt;点我n+1&lt;/button&gt; // &lt;/div&gt;`,</span></span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">n</span>: <span class="hljs-number">1</span>,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-title function_">add</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;add&quot;</span>);</span><br><span class="language-javascript">            <span class="hljs-variable language_">this</span>.<span class="hljs-property">n</span>++;</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">          <span class="hljs-title function_">bye</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-comment">// https://v2.cn.vuejs.org/v2/api/#vm-destroy</span></span><br><span class="language-javascript">            <span class="hljs-comment">// vm.$destroy()</span></span><br><span class="language-javascript">            <span class="hljs-comment">// 完全销毁一个实例。清理它与其它实例的连接，解绑它的全部指令及事件监听器。</span></span><br><span class="language-javascript">            <span class="hljs-comment">// https://www.bilibili.com/video/BV1Zy4y1K7SH?t=590.0</span></span><br><span class="language-javascript">            <span class="hljs-comment">// 在v2.7版本以后会释放掉事件监听器</span></span><br><span class="language-javascript">            <span class="hljs-comment">// 在v2.6.12版本不会释放掉事件监听器</span></span><br><span class="language-javascript">            <span class="hljs-comment">// 视频中(v2.6.12版本)描述只会释放掉自定义事件监听器, 但是现在如果引入的vue版本是2.7的, 都会被释放掉</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;bye&quot;</span>);</span><br><span class="language-javascript">            <span class="hljs-variable language_">this</span>.$destroy();</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">watch</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-title function_">n</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;n变了&quot;</span>);</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">        &#125;, <span class="hljs-comment">// 此时无法通过vm访问到data中的数据, methods中的方法</span></span><br><span class="language-javascript">        <span class="hljs-title function_">beforeCreate</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;beforeCreate&quot;</span>); <span class="hljs-comment">// console.log(this); // debugger</span></span><br><span class="language-javascript">        &#125;, <span class="hljs-comment">// 此时, 可以通过vm访问到data中的数据, methods中配置的方法</span></span><br><span class="language-javascript">        <span class="hljs-title function_">created</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;created&quot;</span>); <span class="hljs-comment">// console.log(this); // debugger</span></span><br><span class="language-javascript">        &#125;, <span class="hljs-comment">// 未执行beforeMount()之前 // 此阶段Vue开始解析模板, 生成虚拟DOM(内存中), 页面还不能显示解析好的内容 // 执行beforeMount() // 此时页面呈现的是未经Vue编译的DOM结构 // 所有对DOM的操作, 最终都不奏效</span></span><br><span class="language-javascript">        <span class="hljs-title function_">beforeMount</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;beforeMount&quot;</span>); <span class="hljs-comment">// console.log(this); // document.querySelector(&#x27;h2&#x27;).innerText = &#x27;哈哈&#x27; // debugger</span></span><br><span class="language-javascript">        &#125;, <span class="hljs-comment">// 此时: // 1.页面中呈现的是经过Vue编译的DOM // 2.对DOM的操作均有效(尽可能避免) // 至此初始化过程结束, 一般在此进行: 开启定时器, // 发送网络请求, 订阅消息, 绑定自定义事件等初始化操作</span></span><br><span class="language-javascript">        <span class="hljs-title function_">mounted</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;mounted&quot;</span>); <span class="hljs-comment">// console.log(this); // document.querySelector(&#x27;h2&#x27;).innerText = &#x27;哈哈&#x27; // debugger</span></span><br><span class="language-javascript">        &#125;, <span class="hljs-comment">// 此时数据是新的, 但页面是旧的 // 即: 页面尚未和数据保持同步</span></span><br><span class="language-javascript">        <span class="hljs-title function_">beforeUpdate</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;beforeUpdate&quot;</span>); <span class="hljs-comment">// console.log(this.n); // debugger;</span></span><br><span class="language-javascript">        &#125;, <span class="hljs-comment">// Virtual DOM re-render and patch // 根据新数据, 生成新的虚拟DOM, 随后与旧的虚拟DOM进行比较 // 最终完成页面更新, 即: 完成了Model =&gt; View的更新 // 此时: 数据是新的, 页面也是新的 // 即: 页面和数据保持同步</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-title function_">updated</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;updated&quot;</span>); <span class="hljs-comment">// console.log(this.n); // debugger</span></span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-title function_">beforeDestroy</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;beforeDestroy&quot;</span>);</span><br><span class="language-javascript">          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">add</span>();</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-title function_">destroyed</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;destroyed&quot;</span>);</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>总结生命周期</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>总结生命周期<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- </span><br><span class="hljs-comment">常用的生命周期钩子：</span><br><span class="hljs-comment">1.mounted: 发送ajax请求、启动定时器、绑定自定义事件、订阅消息等【初始化操作】。</span><br><span class="hljs-comment">2.beforeDestroy: 清除定时器、解绑自定义事件、取消订阅消息等【收尾工作】。</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">关于销毁Vue实例</span><br><span class="hljs-comment">1.销毁后借助Vue开发者工具看不到任何信息。</span><br><span class="hljs-comment">2.销毁后自定义事件会失效，但原生DOM事件依然有效。</span><br><span class="hljs-comment">3.一般不会在beforeDestroy操作数据，因为即便操作数据，也不会再触发更新流程了。</span><br><span class="hljs-comment">--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">&quot;&#123;opacity: opacity&#125;&quot;</span>&gt;</span>欢迎学习Vue<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;stop&quot;</span>&gt;</span>点我停止变化<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;</span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">opacity</span>: <span class="hljs-number">1</span>,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-title function_">stop</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">this</span>.$destroy();</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-title function_">mounted</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">          <span class="hljs-variable language_">this</span>.<span class="hljs-property">timer</span> = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> &#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;setInterval&quot;</span>);</span><br><span class="language-javascript">            <span class="hljs-variable language_">this</span>.<span class="hljs-property">opacity</span> -= <span class="hljs-number">0.01</span>;</span><br><span class="language-javascript">            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">opacity</span> &lt;= <span class="hljs-number">0</span>) &#123;</span><br><span class="language-javascript">              <span class="hljs-variable language_">this</span>.<span class="hljs-property">opacity</span> = <span class="hljs-number">1</span>;</span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">          &#125;, <span class="hljs-number">16</span>);</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-title function_">beforeDestroy</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;vm即将驾鹤西游了&quot;</span>);</span><br><span class="language-javascript">          <span class="hljs-built_in">clearInterval</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">timer</span>);</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="组件的概念"><a href="#组件的概念" class="headerlink" title="组件的概念"></a>组件的概念</h2><p><img src="/assets/c29f98f361eb4264a0643d48ae1dd019.png"><br><img src="/assets/fa409644591943528112a638c6788ca4.png"><br><img src="/assets/afbd9d76f3cf4659a60e2eb750e53bb7.png"><br>组件的定义: 实现应用中局部功能代码和资源的集合</p><h2 id="非单文件组件"><a href="#非单文件组件" class="headerlink" title="非单文件组件"></a>非单文件组件</h2><blockquote><p>组件就是一块砖, 哪里需要哪里搬</p></blockquote><p>非单文件组件:<br>一个文件中包含有 n 个组件<br>单文件组件的嵌套组件:<br>一个文件中只包含有 1 个组件<br>基本使用</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>基本使用<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>       <br>    <span class="hljs-comment">&lt;!-- </span><br><span class="hljs-comment">            Vue中使用组件的三大步骤：</span><br><span class="hljs-comment">                    一、定义组件(创建组件)</span><br><span class="hljs-comment">                    二、注册组件</span><br><span class="hljs-comment">                    三、使用组件(写组件标签)</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">            一、如何定义一个组件？</span><br><span class="hljs-comment">                        使用Vue.extend(options)创建，其中options和new Vue(options)时传入的那个options几乎一样，但也有点区别；</span><br><span class="hljs-comment">                        区别如下：</span><br><span class="hljs-comment">                                1.el不要写，为什么？ ——— 最终所有的组件都要经过一个vm的管理，由vm中的el决定服务哪个容器。</span><br><span class="hljs-comment">                                2.data必须写成函数，为什么？ ———— 避免组件被复用时，数据存在引用关系。</span><br><span class="hljs-comment">                        备注：使用template可以配置组件结构。</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">            二、如何注册组件？</span><br><span class="hljs-comment">                            1.局部注册：靠new Vue的时候传入components选项</span><br><span class="hljs-comment">                            2.全局注册：靠Vue.component(&#x27;组件名&#x27;,组件)</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">            三、编写组件标签：</span><br><span class="hljs-comment">                            &lt;school&gt;&lt;/school&gt;</span><br><span class="hljs-comment">        --&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">hello</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">hello</span>&gt;</span>        <br>      <span class="hljs-tag">&lt;<span class="hljs-name">hr</span> /&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;&#123;msg&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">hr</span> /&gt;</span><br>             <br>      <span class="hljs-comment">&lt;!-- 第三步：编写组件标签 --&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">student</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">student</span>&gt;</span>        <br>      <span class="hljs-tag">&lt;<span class="hljs-name">hr</span> /&gt;</span><br>             <br>      <span class="hljs-comment">&lt;!-- 第三步：编写组件标签 --&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">school</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">school</span>&gt;</span>    <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root2&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">hello</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">hello</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>; <span class="hljs-comment">// 第一步：创建student组件</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> student = <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">extend</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-comment">// el: &#x27;#root&#x27;,</span></span><br><span class="language-javascript">        <span class="hljs-attr">template</span>: <span class="hljs-string">`</span></span><br><span class="hljs-string"><span class="language-javascript">            &lt;div&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">                &lt;h2&gt;学生姓名: &#123;&#123;studentName&#125;&#125;&lt;/h2&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">                &lt;h2&gt;学生年龄: &#123;&#123;age&#125;&#125;&lt;/h2&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">            &lt;/div&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">            `</span>,</span><br><span class="language-javascript">        <span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">          <span class="hljs-keyword">return</span> &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">studentName</span>: <span class="hljs-string">&quot;张三&quot;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">age</span>: <span class="hljs-number">18</span>,</span><br><span class="language-javascript">          &#125;;</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">      &#125;); <span class="hljs-comment">// 第一步：创建school组件</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> school = <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">extend</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">template</span>: <span class="hljs-string">`</span></span><br><span class="hljs-string"><span class="language-javascript">            &lt;div&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">                &lt;h2&gt;学校名称: &#123;&#123;schoolName&#125;&#125;&lt;/h2&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">                &lt;h2&gt;学校地址: &#123;&#123;address&#125;&#125;&lt;/h2&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">                &lt;button @click=&quot;showName&quot;&gt;点我提示学校名&lt;/button&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">            &lt;/div&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">            `</span>, <span class="hljs-comment">// el:&#x27;#root&#x27;, //组件定义时，一定不要写el配置项，因为最终所有的组件都要被一个vm管理，由vm决定服务于哪个容器。</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">        <span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">          <span class="hljs-keyword">return</span> &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">schoolName</span>: <span class="hljs-string">&quot;尚硅谷&quot;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">address</span>: <span class="hljs-string">&quot;北京昌平&quot;</span>,</span><br><span class="language-javascript">          &#125;;</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-title function_">showName</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-title function_">alert</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">schoolName</span>);</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">      &#125;); <span class="hljs-comment">//第一步：创建hello组件</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> hello = <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">extend</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">template</span>: <span class="hljs-string">`</span></span><br><span class="hljs-string"><span class="language-javascript">            &lt;div&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">                &lt;h2&gt;你好啊! &#123;&#123;name&#125;&#125;&lt;/h2&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">            &lt;/div&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">            `</span>,</span><br><span class="language-javascript">        <span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">          <span class="hljs-keyword">return</span> &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Tom&quot;</span>,</span><br><span class="language-javascript">          &#125;;</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">      &#125;); <span class="hljs-comment">//第二步：全局注册组件</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">component</span>(<span class="hljs-string">&quot;hello&quot;</span>, hello); <span class="hljs-comment">//创建vm</span></span><br><span class="language-javascript">      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;你好啊！&quot;</span>,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;&#125;, <span class="hljs-comment">//第二步：注册组件（局部注册）</span></span><br><span class="language-javascript">        <span class="hljs-attr">components</span>: &#123;</span><br><span class="language-javascript">          school,</span><br><span class="language-javascript">          student,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root2&quot;</span>,</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>几个注意点</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>几个注意点<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>           <br>    <span class="hljs-comment">&lt;!-- </span><br><span class="hljs-comment">            几个注意点：</span><br><span class="hljs-comment">                    1.关于组件名:</span><br><span class="hljs-comment">                                一个单词组成：</span><br><span class="hljs-comment">                                            第一种写法(首字母小写)：school</span><br><span class="hljs-comment">                                            第二种写法(首字母大写)：School</span><br><span class="hljs-comment">                                多个单词组成：</span><br><span class="hljs-comment">                                            第一种写法(kebab-case命名)：my-school</span><br><span class="hljs-comment">                                            第二种写法(CamelCase命名)：MySchool (需要Vue脚手架支持)</span><br><span class="hljs-comment">                                备注：</span><br><span class="hljs-comment">                                        (1).组件名尽可能回避HTML中已有的元素名称，例如：h2、H2都不行。</span><br><span class="hljs-comment">                                        (2).可以使用name配置项指定组件在开发者工具中呈现的名字。</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">                    2.关于组件标签:</span><br><span class="hljs-comment">                                第一种写法：&lt;school&gt;&lt;/school&gt;</span><br><span class="hljs-comment">                                第二种写法：&lt;school/&gt;</span><br><span class="hljs-comment">                                备注：不用使用脚手架时，&lt;school/&gt;会导致后续组件不能渲染。</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">                    3.一个简写方式：</span><br><span class="hljs-comment">                                const school = Vue.extend(options) 可简写为：const school = options</span><br><span class="hljs-comment">        --&gt;</span><br>       <br>    <span class="hljs-comment">&lt;!-- 准备好一个容器 --&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><br>             <br>      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;&#123;msg&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">school</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">school</span>&gt;</span>    <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>; <span class="hljs-comment">// 定义组件</span></span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> s = <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">extend</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">template</span>: <span class="hljs-string">`</span></span><br><span class="hljs-string"><span class="language-javascript">            &lt;div&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">                &lt;h2&gt;学校名称: &#123;&#123;name&#125;&#125;&lt;/h2&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">                &lt;h2&gt;学校地址: &#123;&#123;address&#125;&#125;&lt;/h2&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">            &lt;/div&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">            `</span>,</span><br><span class="language-javascript">        <span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">          <span class="hljs-keyword">return</span> &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;尚硅谷&quot;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">address</span>: <span class="hljs-string">&quot;北京&quot;</span>,</span><br><span class="language-javascript">          &#125;;</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript">      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;欢迎学习Vue!&quot;</span>,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;&#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">components</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">school</span>: s,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>组件的嵌套</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>组件的嵌套<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span>   <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml"></span></span><br><span class="language-xml"><span class="language-handlebars">      Vue.config.productionTip = false; //定义student组件</span></span><br><span class="language-xml"><span class="language-handlebars"></span></span><br><span class="language-xml"><span class="language-handlebars">      const student = Vue.extend(&#123;</span></span><br><span class="language-xml"><span class="language-handlebars">        template: `</span></span><br><span class="language-xml"><span class="language-handlebars">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars">                <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>学生姓名: </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">name</span>&#125;&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars">                <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>学生年龄: </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">age</span>&#125;&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars">            `,</span></span><br><span class="language-xml"><span class="language-handlebars">        name: &quot;student&quot;,</span></span><br><span class="language-xml"><span class="language-handlebars">        data() &#123;</span></span><br><span class="language-xml"><span class="language-handlebars">          return &#123;</span></span><br><span class="language-xml"><span class="language-handlebars">            name: &quot;肉豆蔻&quot;,</span></span><br><span class="language-xml"><span class="language-handlebars">            age: 18,</span></span><br><span class="language-xml"><span class="language-handlebars">          &#125;;</span></span><br><span class="language-xml"><span class="language-handlebars">        &#125;,</span></span><br><span class="language-xml"><span class="language-handlebars">      &#125;); //定义school组件</span></span><br><span class="language-xml"><span class="language-handlebars"></span></span><br><span class="language-xml"><span class="language-handlebars">      const school = Vue.extend(&#123;</span></span><br><span class="language-xml"><span class="language-handlebars">        template: `</span></span><br><span class="language-xml"><span class="language-handlebars">                <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars">                    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>学校名称: </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">name</span>&#125;&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars">                    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>学校地址: </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">address</span>&#125;&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars">                    <span class="hljs-tag">&lt;<span class="hljs-name">student</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">student</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars">                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars">            `,</span></span><br><span class="language-xml"><span class="language-handlebars">        name: &quot;school&quot;,</span></span><br><span class="language-xml"><span class="language-handlebars">        data() &#123;</span></span><br><span class="language-xml"><span class="language-handlebars">          return &#123;</span></span><br><span class="language-xml"><span class="language-handlebars">            name: &quot;尚硅谷&quot;,</span></span><br><span class="language-xml"><span class="language-handlebars">            address: &quot;北京&quot;,</span></span><br><span class="language-xml"><span class="language-handlebars">          &#125;;</span></span><br><span class="language-xml"><span class="language-handlebars">        &#125;, //注册组件（局部）</span></span><br><span class="language-xml"><span class="language-handlebars">        components: &#123;</span></span><br><span class="language-xml"><span class="language-handlebars">          student: student,</span></span><br><span class="language-xml"><span class="language-handlebars">        &#125;,</span></span><br><span class="language-xml"><span class="language-handlebars">      &#125;); //定义hello组件</span></span><br><span class="language-xml"><span class="language-handlebars">      const hello = Vue.extend(&#123;</span></span><br><span class="language-xml"><span class="language-handlebars">        template: `</span></span><br><span class="language-xml"><span class="language-handlebars">            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">msg</span>&#125;&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars">            `,</span></span><br><span class="language-xml"><span class="language-handlebars">        data() &#123;</span></span><br><span class="language-xml"><span class="language-handlebars">          return &#123;</span></span><br><span class="language-xml"><span class="language-handlebars">            msg: &quot;欢迎来到尚硅谷学习！&quot;,</span></span><br><span class="language-xml"><span class="language-handlebars">          &#125;;</span></span><br><span class="language-xml"><span class="language-handlebars">        &#125;,</span></span><br><span class="language-xml"><span class="language-handlebars">      &#125;); //定义app组件</span></span><br><span class="language-xml"><span class="language-handlebars">      const app = Vue.extend(&#123;</span></span><br><span class="language-xml"><span class="language-handlebars">        template: `</span></span><br><span class="language-xml"><span class="language-handlebars">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars">                <span class="hljs-tag">&lt;<span class="hljs-name">hello</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">hello</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars">                <span class="hljs-tag">&lt;<span class="hljs-name">school</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">school</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars">            `,</span></span><br><span class="language-xml"><span class="language-handlebars">        components: &#123;</span></span><br><span class="language-xml"><span class="language-handlebars">          school,</span></span><br><span class="language-xml"><span class="language-handlebars">          hello,</span></span><br><span class="language-xml"><span class="language-handlebars">        &#125;,</span></span><br><span class="language-xml"><span class="language-handlebars">      &#125;); //创建vm</span></span><br><span class="language-xml"><span class="language-handlebars"></span></span><br><span class="language-xml"><span class="language-handlebars">      new Vue(&#123;</span></span><br><span class="language-xml"><span class="language-handlebars">        template: `</span></span><br><span class="language-xml"><span class="language-handlebars">                <span class="hljs-tag">&lt;<span class="hljs-name">app</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">app</span>&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars">            `,</span></span><br><span class="language-xml"><span class="language-handlebars">        el: &quot;#root&quot;,</span></span><br><span class="language-xml"><span class="language-handlebars">        data: &#123;&#125;,</span></span><br><span class="language-xml"><span class="language-handlebars">        methods: &#123;&#125;, //注册组件（局部）</span></span><br><span class="language-xml"><span class="language-handlebars">        components: &#123;</span></span><br><span class="language-xml"><span class="language-handlebars">          app,</span></span><br><span class="language-xml"><span class="language-handlebars">        &#125;,</span></span><br><span class="language-xml"><span class="language-handlebars">      &#125;);</span></span><br><span class="language-xml"><span class="language-handlebars">    </span></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>VueComponent</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>VueComponent<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>       <br>    <span class="hljs-comment">&lt;!-- </span><br><span class="hljs-comment">            关于VueComponent：</span><br><span class="hljs-comment">                        1.school组件本质是一个名为VueComponent的构造函数，且不是程序员定义的，是Vue.extend生成的。</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">                        2.我们只需要写&lt;school/&gt;或&lt;school&gt;&lt;/school&gt;，Vue解析时会帮我们创建school组件的实例对象，</span><br><span class="hljs-comment">                            即Vue帮我们执行的：new VueComponent(options)。</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">                        3.特别注意：每次调用Vue.extend，返回的都是一个全新的VueComponent！！！！</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">                        4.关于this指向：</span><br><span class="hljs-comment">                                (1).组件配置中：</span><br><span class="hljs-comment">                                            data函数、methods中的函数、watch中的函数、computed中的函数 它们的this均是【VueComponent实例对象】。</span><br><span class="hljs-comment">                                (2).new Vue(options)配置中：</span><br><span class="hljs-comment">                                            data函数、methods中的函数、watch中的函数、computed中的函数 它们的this均是【Vue实例对象】。</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">                        5.VueComponent的实例对象，以后简称vc（也可称之为：组件实例对象）。</span><br><span class="hljs-comment">                            Vue的实例对象，以后简称vm。</span><br><span class="hljs-comment">        --&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">school</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">school</span>&gt;</span>         <span class="hljs-tag">&lt;<span class="hljs-name">hello</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">hello</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>; <span class="hljs-comment">//定义school组件</span></span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> school = <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">extend</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">template</span>: <span class="hljs-string">`</span></span><br><span class="hljs-string"><span class="language-javascript">            &lt;div&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">                &lt;h2&gt;学校名称：&#123;&#123;name&#125;&#125;&lt;/h2&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">                &lt;h2&gt;学校地址：&#123;&#123;address&#125;&#125;&lt;/h2&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">                &lt;button @click=&quot;showName&quot;&gt;点我提示学校名&lt;/button&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">            &lt;/div&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">            `</span>,</span><br><span class="language-javascript">        <span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">          <span class="hljs-keyword">return</span> &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;尚硅谷&quot;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">address</span>: <span class="hljs-string">&quot;北京&quot;</span>,</span><br><span class="language-javascript">          &#125;;</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-title function_">showName</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;showName&quot;</span>, <span class="hljs-variable language_">this</span>); <span class="hljs-comment">// alert(this.name)</span></span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> test = <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">extend</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">template</span>: <span class="hljs-string">`&lt;span&gt;atguigu&lt;/span&gt;`</span>,</span><br><span class="language-javascript">      &#125;); <span class="hljs-comment">//定义hello组件</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> hello = <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">extend</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">template</span>: <span class="hljs-string">`</span></span><br><span class="hljs-string"><span class="language-javascript">                &lt;div&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">                    &lt;h2&gt;&#123;&#123;msg&#125;&#125;&lt;/h2&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">                    &lt;test&gt;&lt;/test&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">                &lt;/div&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">            `</span>,</span><br><span class="language-javascript">        <span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">          <span class="hljs-keyword">return</span> &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;你好啊!&quot;</span>,</span><br><span class="language-javascript">          &#125;;</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">components</span>: &#123;</span><br><span class="language-javascript">          test,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">      &#125;); <span class="hljs-comment">// 证明是两个VueComponent, 而不是用的一个VueComponent // console.log(&#x27;@&#x27;, school === hello); // school.a = 99 // console.log(&#x27;@&#x27;, school.a); // console.log(&#x27;@&#x27;, hello.a); // 每次调用的VueComponent都是现定义的, 然后再返回的 // Vue.extend = function (extendOptions) &#123; //      ... //     var Sub = function VueComponent(options) &#123; //         this._init(options); //     &#125;; //      ... //     return Sub // &#125;; // console.log(&#x27;@&#x27;, school); // console.log(&#x27;#&#x27;, hello); // 创建vm</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;&#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;&#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">components</span>: &#123;</span><br><span class="language-javascript">          school,</span><br><span class="language-javascript">          hello,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>一个重要的内置关系</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>一个重要的内置关系<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>           <br>    <span class="hljs-comment">&lt;!-- </span><br><span class="hljs-comment">                1.一个重要的内置关系：VueComponent.prototype.__proto__ === Vue.prototype</span><br><span class="hljs-comment">                2.为什么要有这个关系：让组件实例对象（vc）可以访问到 Vue原型上的属性、方法。</span><br><span class="hljs-comment">        --&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">school</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">school</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>       <br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">productionTip</span> = <span class="hljs-literal">false</span>;</span><br><span class="language-javascript">      <span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">x</span> = <span class="hljs-number">99</span>; <span class="hljs-comment">//定义school组件</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> school = <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">extend</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">template</span>: <span class="hljs-string">`</span></span><br><span class="hljs-string"><span class="language-javascript">                &lt;div&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">                    &lt;h2&gt;学校名称: &#123;&#123;name&#125;&#125;&lt;/h2&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">                    &lt;h2&gt;学校地址: &#123;&#123;address&#125;&#125;&lt;/h2&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">                    &lt;button @click=&quot;showX&quot;&gt;点我输出x&lt;/button&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">                &lt;/div&gt;</span></span><br><span class="hljs-string"><span class="language-javascript">            `</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;school&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">          <span class="hljs-keyword">return</span> &#123;</span><br><span class="language-javascript">            <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;尚硅谷&quot;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">address</span>: <span class="hljs-string">&quot;北京&quot;</span>,</span><br><span class="language-javascript">          &#125;;</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-title function_">showX</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">x</span>);</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">      &#125;); <span class="hljs-comment">// 创建一个vm</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> vm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">el</span>: <span class="hljs-string">&quot;#root&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">msg</span>: <span class="hljs-string">&quot;你好&quot;</span>,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">methods</span>: &#123;&#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">components</span>: &#123;</span><br><span class="language-javascript">          school,</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">      &#125;);</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(</span><br><span class="language-javascript">        school.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span></span><br><span class="language-javascript">      ); <span class="hljs-comment">/* // 定义一个构造函数</span></span><br><span class="hljs-comment"><span class="language-javascript">        function Demo() &#123;</span></span><br><span class="hljs-comment"><span class="language-javascript">            this.a = 1</span></span><br><span class="hljs-comment"><span class="language-javascript">            this.b = 2</span></span><br><span class="hljs-comment"><span class="language-javascript">        &#125;</span></span><br><span class="hljs-comment"><span class="language-javascript">        // 创建一个Demo的实例对象</span></span><br><span class="hljs-comment"><span class="language-javascript">        const d = new Demo()</span></span><br><span class="hljs-comment"><span class="language-javascript"></span></span><br><span class="hljs-comment"><span class="language-javascript"></span></span><br><span class="hljs-comment"><span class="language-javascript">        // 显示原型属性</span></span><br><span class="hljs-comment"><span class="language-javascript">        console.log(Demo.prototype);</span></span><br><span class="hljs-comment"><span class="language-javascript">        // 隐式原型属性</span></span><br><span class="hljs-comment"><span class="language-javascript">        console.log(d.__proto__);</span></span><br><span class="hljs-comment"><span class="language-javascript"></span></span><br><span class="hljs-comment"><span class="language-javascript"></span></span><br><span class="hljs-comment"><span class="language-javascript">        console.log(Demo.prototype === d.__proto__);</span></span><br><span class="hljs-comment"><span class="language-javascript"></span></span><br><span class="hljs-comment"><span class="language-javascript"></span></span><br><span class="hljs-comment"><span class="language-javascript">        // 程序员通过显示原型属性操作原型对象, 追加一个x属性, 值为99</span></span><br><span class="hljs-comment"><span class="language-javascript">        Demo.prototype.x = 99</span></span><br><span class="hljs-comment"><span class="language-javascript"></span></span><br><span class="hljs-comment"><span class="language-javascript"></span></span><br><span class="hljs-comment"><span class="language-javascript">        console.log(&#x27;@&#x27;, d); */</span></span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>实例的隐式原型对象永运指向缔造者的原型对象<br><img src="/assets/17fc2e79ed2744c0983b5152d12258d6.png"></p><h2 id=""><a href="#" class="headerlink" title=""></a></h2>]]></content>
    
    
    <categories>
      
      <category>Vue</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>注册表的一些操作</title>
    <link href="/uncategorized/%E6%B3%A8%E5%86%8C%E8%A1%A8%E7%9A%84%E4%B8%80%E4%BA%9B%E6%93%8D%E4%BD%9C/"/>
    <url>/uncategorized/%E6%B3%A8%E5%86%8C%E8%A1%A8%E7%9A%84%E4%B8%80%E4%BA%9B%E6%93%8D%E4%BD%9C/</url>
    
    <content type="html"><![CDATA[<h2 id="修改-win10-注册表自动更新"><a href="#修改-win10-注册表自动更新" class="headerlink" title="修改 win10 注册表自动更新"></a>修改 win10 注册表自动更新</h2><p>win+r 输入 regedit<br>位置: <strong>计算机\HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\wuauserv</strong><br><img src="/assets/b9673932fb16423898aaebae599fee19.png"><br><img src="/assets/d913f0f991aa46a3a3eef6e20d12a4a1.png"></p><h1 id="Typora-无限试用"><a href="#Typora-无限试用" class="headerlink" title="Typora 无限试用"></a>Typora 无限试用</h1><p><a href="https://www.jianshu.com/p/bb0ddf5fbd5d">https://www.jianshu.com/p/bb0ddf5fbd5d</a></p><h2 id="Win10-搜索框中热门搜索怎么关闭-Win10-关闭热门搜索"><a href="#Win10-搜索框中热门搜索怎么关闭-Win10-关闭热门搜索" class="headerlink" title="Win10 搜索框中热门搜索怎么关闭|Win10 关闭热门搜索"></a>Win10 搜索框中热门搜索怎么关闭|Win10 关闭热门搜索</h2><p><a href="https://www.baiyunxitong.com/bangzhu/7714.html">https://www.baiyunxitong.com/bangzhu/7714.html</a></p><h2 id="去他妈的-windows-子系统"><a href="#去他妈的-windows-子系统" class="headerlink" title="去他妈的 windows 子系统"></a>去他妈的 windows 子系统</h2><p>某天早晨开电脑, 发现他妈的资源管理器多了一个 linux 的小图标, 还他妈移除不了<br><img src="/assets/2dec6f9fbb964d21864828a77983240f.png"><br>打开控制面板, 程序和功能, 启用或关闭 Windows 功能, 适用于 Linux 的 Windows 子系统 的勾给去掉, 然后重启电脑<br><img src="/assets/63f1e9bdfc164315b980b619d6fa915d.png"><br>资源管理器就没了 linux 图标了<br><img src="/assets/b0167536357e41d3baa1ff8a3b4a0288.png"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>SSM</title>
    <link href="/Java/SSM/"/>
    <url>/Java/SSM/</url>
    
    <content type="html"><![CDATA[<h2 id="整合-Swagger2"><a href="#整合-Swagger2" class="headerlink" title="整合 Swagger2"></a>整合 Swagger2</h2><p>集成 knife4j</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.xiaoymin<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>knife4j-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>添加 knife4j 配置类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.system.config;<br><br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><span class="hljs-keyword">import</span> springfox.documentation.builders.ApiInfoBuilder;<br><span class="hljs-keyword">import</span> springfox.documentation.builders.ParameterBuilder;<br><span class="hljs-keyword">import</span> springfox.documentation.builders.PathSelectors;<br><span class="hljs-keyword">import</span> springfox.documentation.builders.RequestHandlerSelectors;<br><span class="hljs-keyword">import</span> springfox.documentation.schema.ModelRef;<br><span class="hljs-keyword">import</span> springfox.documentation.service.ApiInfo;<br><span class="hljs-keyword">import</span> springfox.documentation.service.Contact;<br><span class="hljs-keyword">import</span> springfox.documentation.service.Parameter;<br><span class="hljs-keyword">import</span> springfox.documentation.spi.DocumentationType;<br><span class="hljs-keyword">import</span> springfox.documentation.spring.web.plugins.Docket;<br><span class="hljs-keyword">import</span> springfox.documentation.swagger2.annotations.EnableSwagger2WebMvc;<br><br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * knife4j配置信息</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@EnableSwagger2WebMvc</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Knife4jConfig</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Docket <span class="hljs-title function_">adminApiConfig</span><span class="hljs-params">()</span>&#123;<br>        List&lt;Parameter&gt; pars = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-type">ParameterBuilder</span> <span class="hljs-variable">tokenPar</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ParameterBuilder</span>();<br>        tokenPar.name(<span class="hljs-string">&quot;token&quot;</span>)<br>                .description(<span class="hljs-string">&quot;用户token&quot;</span>)<br>                .defaultValue(<span class="hljs-string">&quot;&quot;</span>)<br>                .modelRef(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ModelRef</span>(<span class="hljs-string">&quot;string&quot;</span>))<br>                .parameterType(<span class="hljs-string">&quot;header&quot;</span>)<br>                .required(<span class="hljs-literal">false</span>)<br>                .build();<br>        pars.add(tokenPar.build());<br>        <span class="hljs-comment">//添加head参数end</span><br><br>        <span class="hljs-type">Docket</span> <span class="hljs-variable">adminApi</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Docket</span>(DocumentationType.SWAGGER_2)<br>                .groupName(<span class="hljs-string">&quot;adminApi&quot;</span>)<br>                .apiInfo(adminApiInfo())<br>                .select()<br>                <span class="hljs-comment">//只显示admin路径下的页面</span><br>                .apis(RequestHandlerSelectors.basePackage(<span class="hljs-string">&quot;com.atguigu&quot;</span>))<br>                .paths(PathSelectors.regex(<span class="hljs-string">&quot;/admin/.*&quot;</span>)) <span class="hljs-comment">// 显示以admin开头的接口</span><br>                .build()<br>                .globalOperationParameters(pars);<br>        <span class="hljs-keyword">return</span> adminApi;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> ApiInfo <span class="hljs-title function_">adminApiInfo</span><span class="hljs-params">()</span>&#123;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApiInfoBuilder</span>()<br>                .title(<span class="hljs-string">&quot;后台管理系统-API文档&quot;</span>)<br>                .description(<span class="hljs-string">&quot;本文档描述了后台管理系统微服务接口定义&quot;</span>)<br>                .version(<span class="hljs-string">&quot;1.0&quot;</span>)<br>                .contact(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Contact</span>(<span class="hljs-string">&quot;atguigu&quot;</span>, <span class="hljs-string">&quot;http://atguigu.com&quot;</span>, <span class="hljs-string">&quot;atguigu@qq.com&quot;</span>))<br>                .build();<br>    &#125;<br><br><br>&#125;<br></code></pre></td></tr></table></figure><p>Controller 层添加注解</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.system.controller;<br><br><span class="hljs-keyword">import</span> com.atguigu.system.service.SysRoleService;<br><span class="hljs-keyword">import</span> com.atguigu.common.result.Result;<br><span class="hljs-keyword">import</span> com.atguigu.model.system.SysRole;<br><span class="hljs-keyword">import</span> io.swagger.annotations.Api;<br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@Api(tags = &quot;角色管理&quot;)</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/admin/system/sysRole&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SysRoleController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> SysRoleService sysRoleService;<br><br>    <span class="hljs-meta">@ApiOperation(value = &quot;获取全部角色列表&quot;)</span><br>    <span class="hljs-meta">@GetMapping(&quot;findAll&quot;)</span><br>    <span class="hljs-keyword">public</span> Result&lt;List&lt;SysRole&gt;&gt; <span class="hljs-title function_">findAll</span><span class="hljs-params">()</span> &#123;<br>        List&lt;SysRole&gt; roleList = sysRoleService.list();<br>        <span class="hljs-keyword">return</span> Result.ok(roleList);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>测试<br><a href="http://localhost:8800/doc.html">http://localhost:8800/doc.html</a></p><h2 id="定义统一返回结果对象"><a href="#定义统一返回结果对象" class="headerlink" title="定义统一返回结果对象"></a>定义统一返回结果对象</h2><p>定义接口, 通过封装 Result, 统一将接口的返回值都转换为 json 格式</p><p>Result 类:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.common.result;<br><br><br><span class="hljs-keyword">import</span> lombok.Data;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 全局统一返回结果类</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Result</span>&lt;T&gt; &#123;<br><br>    <span class="hljs-comment">//返回码</span><br>    <span class="hljs-keyword">private</span> Integer code;<br><br>    <span class="hljs-comment">//返回消息</span><br>    <span class="hljs-keyword">private</span> String message;<br><br>    <span class="hljs-comment">//返回数据</span><br>    <span class="hljs-keyword">private</span> T data;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Result</span><span class="hljs-params">()</span>&#123;&#125;<br><br>    <span class="hljs-comment">// 返回数据</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="hljs-title function_">build</span><span class="hljs-params">(T data)</span> &#123;<br>        Result&lt;T&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>&lt;T&gt;();<br>        <span class="hljs-keyword">if</span> (data != <span class="hljs-literal">null</span>)<br>            result.setData(data);<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="hljs-title function_">build</span><span class="hljs-params">(T body, Integer code, String message)</span> &#123;<br>        Result&lt;T&gt; result = build(body);<br>        result.setCode(code);<br>        result.setMessage(message);<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="hljs-title function_">build</span><span class="hljs-params">(T body, ResultCodeEnum resultCodeEnum)</span> &#123;<br>        Result&lt;T&gt; result = build(body);<br>        result.setCode(resultCodeEnum.getCode());<br>        result.setMessage(resultCodeEnum.getMessage());<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span>&lt;T&gt; Result&lt;T&gt; <span class="hljs-title function_">ok</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> Result.ok(<span class="hljs-literal">null</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 操作成功</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> data  baseCategory1List</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> &lt;T&gt;</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span>&lt;T&gt; Result&lt;T&gt; <span class="hljs-title function_">ok</span><span class="hljs-params">(T data)</span>&#123;<br>        Result&lt;T&gt; result = build(data);<br>        <span class="hljs-keyword">return</span> build(data, ResultCodeEnum.SUCCESS);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span>&lt;T&gt; Result&lt;T&gt; <span class="hljs-title function_">fail</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-literal">null</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 操作失败</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> data</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> &lt;T&gt;</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span>&lt;T&gt; Result&lt;T&gt; <span class="hljs-title function_">fail</span><span class="hljs-params">(T data)</span>&#123;<br>        Result&lt;T&gt; result = build(data);<br>        <span class="hljs-keyword">return</span> build(data, ResultCodeEnum.FAIL);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result&lt;T&gt; <span class="hljs-title function_">message</span><span class="hljs-params">(String msg)</span>&#123;<br>        <span class="hljs-built_in">this</span>.setMessage(msg);<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Result&lt;T&gt; <span class="hljs-title function_">code</span><span class="hljs-params">(Integer code)</span>&#123;<br>        <span class="hljs-built_in">this</span>.setCode(code);<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ResultCodeEnum 状态码枚举类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 统一返回结果状态信息类</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Getter</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">ResultCodeEnum</span> &#123;<br><br>    SUCCESS(<span class="hljs-number">200</span>,<span class="hljs-string">&quot;成功&quot;</span>),<br>    FAIL(<span class="hljs-number">201</span>, <span class="hljs-string">&quot;失败&quot;</span>),<br>    SERVICE_ERROR(<span class="hljs-number">2012</span>, <span class="hljs-string">&quot;服务异常&quot;</span>),<br>    DATA_ERROR(<span class="hljs-number">204</span>, <span class="hljs-string">&quot;数据异常&quot;</span>),<br>    ILLEGAL_REQUEST(<span class="hljs-number">205</span>, <span class="hljs-string">&quot;非法请求&quot;</span>),<br>    REPEAT_SUBMIT(<span class="hljs-number">206</span>, <span class="hljs-string">&quot;重复提交&quot;</span>),<br>    ARGUMENT_VALID_ERROR(<span class="hljs-number">210</span>, <span class="hljs-string">&quot;参数校验异常&quot;</span>),<br><br>    LOGIN_AUTH(<span class="hljs-number">208</span>, <span class="hljs-string">&quot;未登陆&quot;</span>),<br>    PERMISSION(<span class="hljs-number">209</span>, <span class="hljs-string">&quot;没有权限&quot;</span>),<br>    ACCOUNT_ERROR(<span class="hljs-number">214</span>, <span class="hljs-string">&quot;账号不正确&quot;</span>),<br>    PASSWORD_ERROR(<span class="hljs-number">215</span>, <span class="hljs-string">&quot;密码不正确&quot;</span>),<br>    LOGIN_MOBLE_ERROR( <span class="hljs-number">216</span>, <span class="hljs-string">&quot;账号不正确&quot;</span>),<br>    ACCOUNT_STOP( <span class="hljs-number">217</span>, <span class="hljs-string">&quot;账号已停用&quot;</span>),<br>    NODE_ERROR( <span class="hljs-number">218</span>, <span class="hljs-string">&quot;该节点下有子节点，不可以删除&quot;</span>)<br>    ;<br><br>    <span class="hljs-keyword">private</span> Integer code;<br><br>    <span class="hljs-keyword">private</span> String message;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">ResultCodeEnum</span><span class="hljs-params">(Integer code, String message)</span> &#123;<br>        <span class="hljs-built_in">this</span>.code = code;<br>        <span class="hljs-built_in">this</span>.message = message;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>修改 Controller, 让所有的接口返回的类型都是 json 格式</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Api(&quot;角色管理&quot;)</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/admin/system/sysRole&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SysRoleController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> SysRoleService sysRoleService;<br><br>    <span class="hljs-meta">@ApiOperation(&quot;查询所有角色列表&quot;)</span><br>    <span class="hljs-meta">@GetMapping(&quot;/findAll&quot;)</span><br>    <span class="hljs-keyword">public</span> Result&lt;List&lt;SysRole&gt;&gt; <span class="hljs-title function_">findAll</span><span class="hljs-params">()</span> &#123;<br>        List&lt;SysRole&gt; list = sysRoleService.list(<span class="hljs-literal">null</span>);<br>        <span class="hljs-keyword">return</span> Result.ok(list);<br>    &#125;<br><span class="hljs-comment">/*    public List&lt;SysRole&gt; findAll() &#123;</span><br><span class="hljs-comment">        List&lt;SysRole&gt; list = sysRoleService.list(null);</span><br><span class="hljs-comment">        log.info(&quot;list = &#123;&#125;&quot;, list);</span><br><span class="hljs-comment">        return list;</span><br><span class="hljs-comment">    &#125;*/</span><br><br>    <span class="hljs-meta">@ApiOperation(&quot;通过id删除角色&quot;)</span><br>    <span class="hljs-meta">@DeleteMapping(&quot;/remove/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">deleteById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> String id)</span> &#123;<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> sysRoleService.removeById(id);<br>        <span class="hljs-comment">/*log.info(&quot;result = &#123;&#125;&quot;, result);*/</span><br>        <span class="hljs-keyword">return</span> Result.ok(result);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>测试地址:<br><a href="http://localhost:8800/doc.html">http://localhost:8800/doc.html</a></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;code&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">200</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;成功&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br><span class="hljs-punctuation">&#125;</span><br><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;code&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">200</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;成功&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br><span class="hljs-punctuation">&#125;</span><br><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;code&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">200</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;成功&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1586337616301735937&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;createTime&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2022-10-29T12:42:15.000+00:00&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;updateTime&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2022-10-30T03:13:38.000+00:00&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;param&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;roleName&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;角色管理员&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;roleCode&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;role&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;description&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;角色管理员&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1586341642619711490&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;createTime&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2022-10-29T12:58:15.000+00:00&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;updateTime&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2022-10-30T03:13:38.000+00:00&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;param&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;roleName&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;角色管理员&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;roleCode&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;role&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;description&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;角色管理员&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1586341642619711491&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;createTime&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2022-10-29T13:08:04.000+00:00&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;updateTime&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2022-10-30T03:13:42.000+00:00&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;param&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;roleName&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;角色管理员&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;roleCode&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;role&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;description&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;角色管理员&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1586341642619711492&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;createTime&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2022-10-30T02:56:41.000+00:00&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;updateTime&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2022-10-30T02:56:41.000+00:00&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;isDeleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;param&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;roleName&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;角色测试员&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;roleCode&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;test&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;description&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;闲着吃干饭的&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>编写 CRUD</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.system.controller;<br><br><span class="hljs-keyword">import</span> com.atguigu.common.result.Result;<br><span class="hljs-keyword">import</span> com.atguigu.model.system.SysRole;<br><span class="hljs-keyword">import</span> com.atguigu.model.vo.SysRoleQueryVo;<br><span class="hljs-keyword">import</span> com.atguigu.system.service.SysRoleService;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.metadata.IPage;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;<br><span class="hljs-keyword">import</span> io.swagger.annotations.Api;<br><span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 测试路径</span><br><span class="hljs-comment"> * http://localhost:8800/admin/system/sysRole/findAll</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Api(&quot;角色管理&quot;)</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/admin/system/sysRole&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SysRoleController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> SysRoleService sysRoleService;<br><br>    <span class="hljs-meta">@ApiOperation(&quot;查询所有角色列表&quot;)</span><br>    <span class="hljs-meta">@GetMapping(&quot;/findAll&quot;)</span><br>    <span class="hljs-keyword">public</span> Result&lt;List&lt;SysRole&gt;&gt; <span class="hljs-title function_">findAll</span><span class="hljs-params">()</span> &#123;<br>        List&lt;SysRole&gt; list = sysRoleService.list(<span class="hljs-literal">null</span>);<br>        <span class="hljs-keyword">return</span> Result.ok(list);<br>    &#125;<br><span class="hljs-comment">/*    public List&lt;SysRole&gt; findAll() &#123;</span><br><span class="hljs-comment">        List&lt;SysRole&gt; list = sysRoleService.list(null);</span><br><span class="hljs-comment">        log.info(&quot;list = &#123;&#125;&quot;, list);</span><br><span class="hljs-comment">        return list;</span><br><span class="hljs-comment">    &#125;*/</span><br><br>    <span class="hljs-meta">@ApiOperation(&quot;通过id删除角色&quot;)</span><br>    <span class="hljs-meta">@DeleteMapping(&quot;/remove/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">deleteById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> String id)</span> &#123;<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> sysRoleService.removeById(id);<br>        <span class="hljs-comment">/*log.info(&quot;result = &#123;&#125;&quot;, result);*/</span><br>        <span class="hljs-keyword">return</span> Result.ok(result);<br>    &#125;<br><br>    <span class="hljs-meta">@ApiOperation(&quot;条件分页查询&quot;)</span><br>    <span class="hljs-meta">@GetMapping(&quot;/&#123;page&#125;/&#123;limit&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">findPageQueryRole</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer page,</span><br><span class="hljs-params">                                    <span class="hljs-meta">@PathVariable</span> Integer limit,</span><br><span class="hljs-params">                                    SysRoleQueryVo sysRoleQueryVo)</span> &#123;<br>        Page&lt;SysRole&gt; pageParam = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;(page, limit);<br>        IPage&lt;SysRole&gt; pageModel =  sysRoleService.selectPage(pageParam, sysRoleQueryVo);<br>        <span class="hljs-keyword">return</span> Result.ok(pageModel);<br>    &#125;<br><br>    <span class="hljs-meta">@ApiOperation(&quot;获取角色&quot;)</span><br>    <span class="hljs-meta">@GetMapping(&quot;/get/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">get</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer id)</span> &#123;<br>        <span class="hljs-type">SysRole</span> <span class="hljs-variable">byId</span> <span class="hljs-operator">=</span> sysRoleService.getById(id);<br>        <span class="hljs-keyword">return</span> Result.ok(byId);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@RequestBody</span> 不能使用get提交方式</span><br><span class="hljs-comment">     * 传递json格式数据, 把json格式数据封装到对象里面&#123;...&#125;</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> sysRole</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@ApiOperation(&quot;新增角色&quot;)</span><br>    <span class="hljs-meta">@PostMapping(&quot;/save&quot;)</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">save</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> SysRole sysRole)</span> &#123;<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">save</span> <span class="hljs-operator">=</span> sysRoleService.save(sysRole);<br>        <span class="hljs-keyword">if</span> (save) &#123;<br>            <span class="hljs-keyword">return</span> Result.ok();<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> Result.fail();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@ApiOperation(&quot;根据id查询&quot;)</span><br>    <span class="hljs-meta">@PostMapping(&quot;/findRoleById/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">findRoleById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> &#123;<br>        <span class="hljs-type">SysRole</span> <span class="hljs-variable">sysRole</span> <span class="hljs-operator">=</span> sysRoleService.getById(id);<br>        <span class="hljs-keyword">return</span> Result.ok(sysRole);<br>    &#125;<br><br>    <span class="hljs-meta">@ApiOperation(&quot;修改角色&quot;)</span><br>    <span class="hljs-meta">@PostMapping(&quot;/update&quot;)</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">update</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> SysRole sysRole)</span> &#123;<br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">         boolean update = sysRoleService.update(sysRole, null);</span><br><span class="hljs-comment">         这里没有设置updateWrapper条件构造器, 所有修改的值是表中的所有记录</span><br><span class="hljs-comment">        */</span><br><br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> sysRoleService.updateById(sysRole);<br>        <span class="hljs-keyword">if</span> (flag) &#123;<br>            <span class="hljs-keyword">return</span> Result.ok();<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> Result.fail();<br>        &#125;<br>    &#125;<br><span class="hljs-comment">/*</span><br><span class="hljs-comment">    @ApiOperation(&quot;删除角色&quot;)</span><br><span class="hljs-comment">    @DeleteMapping(&quot;/remove/&#123;id&#125;&quot;)</span><br><span class="hljs-comment">    public Result delete(@PathVariable Integer id) &#123;</span><br><span class="hljs-comment">        boolean flag = sysRoleService.removeById(id);</span><br><span class="hljs-comment">        return Result.ok(flag);</span><br><span class="hljs-comment">    &#125;*/</span><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * json数组格式 -- java的list集合</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> list</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@ApiOperation(&quot;根据id列表删除&quot;)</span><br>    <span class="hljs-meta">@DeleteMapping(&quot;/batchRemove&quot;)</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">batchRemove</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> List&lt;Long&gt; list)</span> &#123;<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> sysRoleService.removeByIds(list);<br>        <span class="hljs-keyword">if</span> (flag) &#123;<br>            <span class="hljs-keyword">return</span> Result.ok();<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> Result.fail();<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="全局异常"><a href="#全局异常" class="headerlink" title="全局异常"></a>全局异常</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.system.handler;<br><br><span class="hljs-keyword">import</span> com.atguigu.common.result.Result;<br><span class="hljs-keyword">import</span> com.atguigu.system.execption.GuiguException;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ControllerAdvice;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 全局异常处理类</span><br><span class="hljs-comment"> * 有异常出现, 先找有没有异常对应的方法, 有的话执行, 如果没有的话, 执行全局异常</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@ControllerAdvice</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GlobalExceptionHandler</span> &#123;<br><br>    <span class="hljs-meta">@ExceptionHandler(Exception.class)</span><br>    <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">error</span><span class="hljs-params">(Exception e)</span> &#123;<br>        e.printStackTrace();<br>        <span class="hljs-keyword">return</span> Result.fail().message(<span class="hljs-string">&quot;执行了全局异常&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@ExceptionHandler(ArithmeticException.class)</span><br>    <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">error</span><span class="hljs-params">(ArithmeticException e)</span>&#123;<br>        e.printStackTrace();<br>        <span class="hljs-keyword">return</span> Result.fail().message(<span class="hljs-string">&quot;执行了特定异常处理&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@ExceptionHandler(GuiguException.class)</span><br>    <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">error</span><span class="hljs-params">(GuiguException e)</span>&#123;<br>        e.printStackTrace();<br>        <span class="hljs-keyword">return</span> Result.fail().message(e.getMessage()).code(e.getCode());<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>自定义异常</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.system.execption;<br><br><span class="hljs-keyword">import</span> com.atguigu.common.result.ResultCodeEnum;<br><span class="hljs-keyword">import</span> lombok.Data;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 自定义全局异常类</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GuiguException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RuntimeException</span> &#123;<br><br>    <span class="hljs-keyword">private</span> Integer code;<br><br>    <span class="hljs-keyword">private</span> String message;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 通过状态码和错误消息创建异常对象</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> code</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> message</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">GuiguException</span><span class="hljs-params">(Integer code, String message)</span> &#123;<br>        <span class="hljs-built_in">super</span>(message);<br>        <span class="hljs-built_in">this</span>.code = code;<br>        <span class="hljs-built_in">this</span>.message = message;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 接收枚举类型对象</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> resultCodeEnum</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">GuiguException</span><span class="hljs-params">(ResultCodeEnum resultCodeEnum)</span> &#123;<br>        <span class="hljs-built_in">super</span>(resultCodeEnum.getMessage());<br>        <span class="hljs-built_in">this</span>.code = resultCodeEnum.getCode();<br>        <span class="hljs-built_in">this</span>.message = resultCodeEnum.getMessage();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;GuliException&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;code=&quot;</span> + code +<br>                <span class="hljs-string">&quot;, message=&quot;</span> + <span class="hljs-built_in">this</span>.getMessage() +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>测试异常</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java">   <span class="hljs-meta">@Autowired</span><br>   <span class="hljs-keyword">private</span> SysRoleService sysRoleService;<br><br><span class="hljs-meta">@ApiOperation(&quot;查询所有角色列表&quot;)</span><br>   <span class="hljs-meta">@GetMapping(&quot;/findAll&quot;)</span><br>   <span class="hljs-keyword">public</span> Result&lt;List&lt;SysRole&gt;&gt; <span class="hljs-title function_">findAll</span><span class="hljs-params">()</span> &#123;<br>       <span class="hljs-keyword">try</span> &#123;<br>           <span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>/<span class="hljs-number">0</span>;<br>       &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>           <span class="hljs-comment">// 手动抛出异常</span><br>           <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GuiguException</span>(<span class="hljs-number">20001</span>,<span class="hljs-string">&quot;出现自定义异常&quot;</span>);<br>       &#125;<br>       List&lt;SysRole&gt; list = sysRoleService.list(<span class="hljs-literal">null</span>);<br>       <span class="hljs-keyword">return</span> Result.ok(list);<br>   &#125;<br></code></pre></td></tr></table></figure><h2 id="安装-vscode"><a href="#安装-vscode" class="headerlink" title="安装 vscode"></a>安装 vscode</h2><p>下载四个插件<br><img src="/assets/5240ad9fcb00452aa094edb540383ef3.png"><br><img src="/assets/6786ce21ebcf4b5a9a4e81604dfd65ab.png"><br><img src="/assets/8ab828ba635a4b11b1bc8e915a7c0d2a.png"></p><p>创建工作区</p><ul><li>先创建一个空的文件夹</li><li>然后在 vscode 中打开这个空文件夹</li><li>在空文件夹中另存为工作区 (workspace.code-workspace)</li></ul><p><img src="/assets/de9af5ccaedf41b09bac09400b859a4b.png"></p><h2 id="Nodejs-简单入门"><a href="#Nodejs-简单入门" class="headerlink" title="Nodejs 简单入门"></a>Nodejs 简单入门</h2><p>官网：<a href="https://nodejs.org/en/">https://nodejs.org/en/</a><br>中文网：<a href="http://nodejs.cn/">http://nodejs.cn/</a><br>LTS：长期支持版本<br>Current：最新版</p><p>查看 node 版本<br><img src="/assets/d0fe446f2b2c43e2821be44207c6cbff.png"><br>在 vscode 中打开终端, 同样也可以查看版本<br><img src="/assets/14da082f2f714fea9fbd892d7f009cab.png"></p><p>编写第一个 nodejs 服务器<br>01.js<br>console.log(‘Hello Node.js’)<br>node 02.js<br><img src="/assets/cdc6ebce1d7843798ece73e52206a21e.png"></p><p>02.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;http&quot;</span>);<br>http<br>  .<span class="hljs-title function_">createServer</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">request, response</span>) &#123;<br>    <span class="hljs-comment">// 发送 HTTP 头部</span><br>    <span class="hljs-comment">// HTTP 状态值: 200 : OK</span><br>    <span class="hljs-comment">// 内容类型: text/plain</span><br>    response.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, &#123; <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;text/plain&quot;</span> &#125;);<br>    <span class="hljs-comment">// 发送响应数据 &quot;Hello World&quot;</span><br>    response.<span class="hljs-title function_">end</span>(<span class="hljs-string">&quot;Hello Server&quot;</span>);<br>  &#125;)<br>  .<span class="hljs-title function_">listen</span>(<span class="hljs-number">8888</span>);<br><span class="hljs-comment">// 终端打印如下信息</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Server running at http://127.0.0.1:8888/&quot;</span>);<br></code></pre></td></tr></table></figure><p>node 02.js<br>Server running at <a href="http://127.0.0.1:8888/">http://127.0.0.1:8888/</a>说明服务器已经运行起来了<br><img src="/assets/15abac593f4d4ebab677bcf48332ed39.png"></p><h2 id="NPM"><a href="#NPM" class="headerlink" title="NPM"></a>NPM</h2><p>构建前端项目<br>管理前端依赖</p><h2 id="npm-初始化项目"><a href="#npm-初始化项目" class="headerlink" title="npm 初始化项目"></a>npm 初始化项目</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">PS E:\Code\权限项目\guigu-auth-front\npmdemo&gt; npm init<br><br>PS E:\Code\权限项目\guigu-auth-front\npmdemo&gt; npm init -y<br></code></pre></td></tr></table></figure><p><img src="/assets/dd2be233ea6147cabbc8b84481391c8c.png"></p><h2 id="修改-npm-镜像源"><a href="#修改-npm-镜像源" class="headerlink" title="修改 npm 镜像源"></a>修改 npm 镜像源</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><span class="hljs-comment"># 第一种查看修改npm镜像源的方法</span><br><span class="hljs-comment">#经过下面的配置，以后所有的 npm install 都会经过淘宝的镜像地址下载</span><br>npm config <span class="hljs-built_in">set</span> registry https://registry.npm.taobao.org<br><span class="hljs-comment">#查看npm配置信息</span><br>npm config list<br><br><span class="hljs-comment"># 第二种查看修改npm镜像源的方法</span><br>npm config get registry  // 查看npm当前镜像源<br>npm config <span class="hljs-built_in">set</span> registry https://registry.npm.taobao.org/  // 设置npm镜像源为淘宝镜像<br><br><span class="hljs-comment"># 修改yarn的镜像源的方法</span><br><span class="hljs-comment"># yarn 是一个快速、可靠、安全的依赖管理工具，一款新的JavaScript包管理工具</span><br><span class="hljs-comment">#yarn config get registry  // 查看yarn当前镜像源</span><br><span class="hljs-comment">#yarn config set registry https://registry.npm.taobao.org/  // 设置yarn镜像源为淘宝镜像</span><br><br><br></code></pre></td></tr></table></figure><p><img src="/assets/1926ea62be1442d38109b1f5d3d5f3f4.png"></p><h2 id="配置仓库地址"><a href="#配置仓库地址" class="headerlink" title="配置仓库地址"></a>配置仓库地址</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 配置全局安装：</span><br>npm config <span class="hljs-built_in">set</span> prefix D:\atguigu\node-global<br><br><span class="hljs-comment"># 配置缓存路径：</span><br>npm config <span class="hljs-built_in">set</span> cache D:\atguigu\node-cache<br><br><span class="hljs-comment">#查看npm配置信息</span><br>npm config list<br></code></pre></td></tr></table></figure><h2 id="npm-install-命令的使用"><a href="#npm-install-命令的使用" class="headerlink" title="npm install 命令的使用"></a>npm install 命令的使用</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">使用 npm install 安装依赖包的最新版，</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">模块安装的位置：项目目录\node_modules</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">安装会自动在项目目录下添加 package-lock.json文件，这个文件帮助锁定安装包的版本</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">同时package.json 文件中，依赖包会被添加到dependencies节点下，类似maven中的 &lt;dependencies&gt;</span><br>npm install jquery<br><span class="hljs-meta prompt_">#</span><span class="language-bash">npm管理的项目在备份和传输的时候一般不携带node_modules文件夹</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">根据配置文件直接下载依赖</span><br>npm install #根据package.json中的配置下载依赖，初始化项目<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">如果安装时想指定特定的版本</span><br>npm install jquery@2.1.x<br><span class="hljs-meta prompt_"># </span><span class="language-bash">局部安装</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">devDependencies节点：开发时的依赖包，项目打包到生产环境的时候不包含的依赖</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">使用 -D参数将依赖添加到devDependencies节点</span><br>npm install --save-dev eslint<br><span class="hljs-meta prompt_">#</span><span class="language-bash">或</span><br>npm install -D eslint<br><span class="hljs-meta prompt_">#</span><span class="language-bash">全局安装</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">Node.js全局安装的npm包和工具的位置：用户目录\AppData\Roaming\npm\node_modules</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">一些命令行工具常使用全局安装的方式</span><br>npm install -g webpack<br>--global<br></code></pre></td></tr></table></figure><h2 id="其他命令"><a href="#其他命令" class="headerlink" title="其他命令"></a>其他命令</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">更新包（更新到最新版本）</span><br>npm update 包名<br><span class="hljs-meta prompt_">#</span><span class="language-bash">全局更新</span><br>npm update -g 包名<br><span class="hljs-meta prompt_">#</span><span class="language-bash">卸载包</span><br>npm uninstall 包名<br><span class="hljs-meta prompt_">#</span><span class="language-bash">全局卸载</span><br>npm uninstall -g 包名<br></code></pre></td></tr></table></figure><p><img src="/assets/743d8e32a93e483aa085510f88048a8b.png"><br>package.json 项目初始化时候生成文件<br>node_modules 下载依赖在这个目录下<br>package-lock.json 锁定当前版本</p><h2 id="前端模块化开发-ES5"><a href="#前端模块化开发-ES5" class="headerlink" title="前端模块化开发(ES5)"></a>前端模块化开发(ES5)</h2><p>创建两个 js 文件<br>01.js<br>02.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">sum</span>(<span class="hljs-params">a, b</span>) &#123;<br>  <span class="hljs-keyword">return</span> a + b;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">sub</span>(<span class="hljs-params">a, b</span>) &#123;<br>  <span class="hljs-keyword">return</span> a - b;<br>&#125;<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  sum,<br>  sub,<br>&#125;;<br></code></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> m = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./01.js&quot;</span>);<br><br><span class="hljs-keyword">var</span> sum = m.<span class="hljs-title function_">sum</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(sum);<br><br><span class="hljs-keyword">var</span> sub = m.<span class="hljs-title function_">sub</span>(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(sub);<br></code></pre></td></tr></table></figure><p>运行 02.js, 发现成功调用了 01.js 里面的方法<br><img src="/assets/97e77f88aa9e48b2803e51c2a983e24d.png"></p><h2 id="ES6-模块化写法"><a href="#ES6-模块化写法" class="headerlink" title="ES6 模块化写法"></a>ES6 模块化写法</h2><p>创建一个文件夹 es6<br>在文件夹中创建文件 01.js 和 02.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getList</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;获取数据列表&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">save</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;保存数据&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; getList, save &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./01.js&quot;</span>;<br><br><span class="hljs-title function_">getList</span>();<br><br><span class="hljs-title function_">save</span>();<br></code></pre></td></tr></table></figure><p>直接运行会发现报错<br>因为 ES6 的模块化无法在 Node.js 中执行<br>需要用 Babel 编辑成 ES5 后再执行</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><br><span class="hljs-built_in">PS</span> E:\Code\权限项目\guigu<span class="hljs-literal">-auth-front</span>\moduledemo\es6&gt; node .\<span class="hljs-number">02</span>.js<br>(node:<span class="hljs-number">13464</span>) Warning: To load an ES module, <span class="hljs-built_in">set</span> <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;module&quot;</span> <span class="hljs-keyword">in</span> the package.json or use the .mjs extension.<br>(Use `node <span class="hljs-literal">--trace-warnings</span> ...` to show <span class="hljs-built_in">where</span> the warning was created)<br>E:\Code\权限项目\guigu<span class="hljs-literal">-auth-front</span>\moduledemo\es6\<span class="hljs-number">02</span>.js:<span class="hljs-number">2</span><br>import &#123;getList, save&#125; from <span class="hljs-string">&quot;./01.js&quot;</span>;<br>^^^^^^<br><br>SyntaxError: Cannot use import statement outside a module<br>at Object.compile<span class="hljs-function"><span class="hljs-keyword">Function</span> <span class="hljs-params">(node:vm:352:18)</span></span><br>at wrapSafe (node:internal/modules/cjs/loader:<span class="hljs-number">1025</span>:<span class="hljs-number">15</span>)<br>at Module._compile (node:internal/modules/cjs/loader:<span class="hljs-number">1059</span>:<span class="hljs-number">27</span>)<br>at Object.Module._extensions..js (node:internal/modules/cjs/loader:<span class="hljs-number">1147</span>:<span class="hljs-number">10</span>)<br>at Module.load (node:internal/modules/cjs/loader:<span class="hljs-number">975</span>:<span class="hljs-number">32</span>)<br>at Function.Module._load (node:internal/modules/cjs/loader:<span class="hljs-number">822</span>:<span class="hljs-number">12</span>)<br>at Function.executeUserEntryPoint [<span class="hljs-type">as</span> <span class="hljs-type">runMain</span>] (node:internal/modules/run_main:<span class="hljs-number">81</span>:<span class="hljs-number">12</span>)<br>at node:internal/main/run_main_module:<span class="hljs-number">17</span>:<span class="hljs-number">47</span><br><br>Node.js v17.<span class="hljs-number">0.1</span><br></code></pre></td></tr></table></figure><h2 id="安装-Babel"><a href="#安装-Babel" class="headerlink" title="安装 Babel"></a>安装 Babel</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install --global babel-cli<br><span class="hljs-comment">#查看是否安装成功</span><br>babel --version<br></code></pre></td></tr></table></figure><p>如果出现了如下报错</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">PS E:\Code\权限项目\guigu-auth-front\moduledemo\es6&gt; babel --version<br>babel : 无法加载文件 D:\Nodejs\node_global\babel.ps1，因为在此系统上禁止运行脚本。有关详细信息，请参阅 https:/g<br>o.microsoft.com/fwlink/?LinkID=135170 中的 about_Execution_Policies。<br>所在位置 行:1 字符: 1<br>+ babel --version<br>+ ~~~~~<br>    + CategoryInfo          : SecurityError: (:) []，PSSecurityException<br>    + FullyQualifiedErrorId : UnauthorizedAccess<br></code></pre></td></tr></table></figure><p>请在 windows10 电脑中搜索 PowerShell, 并且需要使用管理员权限打开, 输入如下指令, 然后按 y</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">set-ExecutionPolicy RemoteSigned<br></code></pre></td></tr></table></figure><p><img src="/assets/86497435a8374dda80f6d74481d2c5ca.png"></p><h2 id="配置-babelrc"><a href="#配置-babelrc" class="headerlink" title="配置.babelrc"></a>配置.babelrc</h2><p>在项目的根目录下创建.babelrc 文件, 然后保存如下内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">&#123;<br>    <span class="hljs-string">&quot;presets&quot;</span>: [<span class="hljs-string">&quot;es2015&quot;</span>],<br>    <span class="hljs-string">&quot;plugins&quot;</span>: []<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="安装转码器"><a href="#安装转码器" class="headerlink" title="安装转码器"></a>安装转码器</h2><p>在项目的根目录下输入</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install --save-dev babel-preset-es2015<br></code></pre></td></tr></table></figure><p>转码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 整个目录转码</span><br><span class="hljs-built_in">mkdir</span> es5<br><span class="hljs-comment"># --out-dir 或 -d 参数指定输出目录</span><br>babel es6 -d es5<br></code></pre></td></tr></table></figure><p>运行程序</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">node es5/02.js<br></code></pre></td></tr></table></figure><p><img src="/assets/c089327710b24447b3e19de9bdb1c23b.png"></p><h2 id="ES6-模块化写法-二"><a href="#ES6-模块化写法-二" class="headerlink" title="ES6 模块化写法(二)"></a>ES6 模块化写法(二)</h2><p>创建 es62 目录<br>01.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-title function_">getList</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;获取数据列表2&quot;</span>);<br>  &#125;,<br>  <span class="hljs-title function_">save</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;保存数据&quot;</span>);<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure><p>02.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> m <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./01&quot;</span>; <span class="hljs-comment">// 这里引入文件可以省略不写.js文件</span><br><br>m.<span class="hljs-title function_">getList</span>();<br>m.<span class="hljs-title function_">save</span>();<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">PS E:\Code\权限项目\guigu-auth-front\moduledemo&gt; babel .\es62\ -d .\es52\<br>es62\01.js -&gt; es52\01.js<br>es62\02.js -&gt; es52\02.js<br>PS E:\Code\权限项目\guigu-auth-front\moduledemo&gt; node .\es52\02.js<br>获取数据列表2<br>保存数据<br></code></pre></td></tr></table></figure><p><img src="/assets/a7451351ad8b411792086a4efa92712a.png"></p><h2 id="搭建前端环境"><a href="#搭建前端环境" class="headerlink" title="搭建前端环境"></a>搭建前端环境</h2><p>vue-admin-template 后台管理系统模板<br><strong>GitHub 地址：</strong><a href="https://github.com/PanJiaChen/vue-admin-template">https://github.com/PanJiaChen/vue-admin-template</a></p><p>下载项目</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Clone project</span><br>git <span class="hljs-built_in">clone</span> https://github.com/PanJiaChen/vue-admin-template.git<br></code></pre></td></tr></table></figure><p><strong>建议：</strong>你可以在 vue-admin-template 的基础上进行二次开发，把 vue-element-admin 当做工具箱，想要什么功能或者组件就去 vue-element-admin 那里复制过来。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#修改项目名称 vue-admin-template 改为 guigu-auth-ui</span><br><span class="hljs-comment"># 解压压缩包</span><br><span class="hljs-comment"># 进入目录</span><br><span class="hljs-built_in">cd</span> vue-admin-template<br><span class="hljs-comment"># 安装依赖</span><br>npm install<br><span class="hljs-comment"># 启动。执行后，浏览器自动弹出并访问http://localhost:9528/</span><br>npm run dev<br></code></pre></td></tr></table></figure><p>如果出现了如下报错</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">Error: error:0308010C:digital envelope routines::unsupported<br>    at new Hash (node:internal/crypto/hash:67:19)<br>    at Object.createHash (node:crypto:130:10)<br>    at module.exports (E:\Code\guigu-auth\guigu-auth-front\system-front\node_modules\webpack\lib\util\createHash.js:135:53)<br></code></pre></td></tr></table></figure><p>npm run dev 如果报错了, 请把 nodejs 版本降低到 16 版本以前</p><h2 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs bash">|-dist 生产环境打包生成的打包项目<br>|-mock 产生模拟数据<br>|-public 包含会被自动打包到项目根路径的文件夹<br>|-index.html 唯一的页面<br>|-src<br>|-api 包含接口请求函数模块<br>|-table.js  表格列表mock数据接口的请求函数<br>|-user.js  用户登陆相关mock数据接口的请求函数<br>|-assets 组件中需要使用的公用资源<br>|-404_images 404页面的图片<br>|-components 非路由组件<br>|-SvgIcon svg图标组件<br>|-Breadcrumb 面包屑组件(头部水平方向的层级组件)<br>|-Hamburger 用来点击切换左侧菜单导航的图标组件<br>|-icons<br>|-svg 包含一些svg图片文件<br>|-index.js 全局注册SvgIcon组件,加载所有svg图片并暴露所有svg文件名的数组<br>|-layout<br>|-components 组成整体布局的一些子组件<br>|-mixin 组件中可复用的代码<br>|-index.vue 后台管理的整体界面布局组件<br>|-router<br>|-index.js 路由器<br>|-store<br>|-modules<br>|-app.js 管理应用相关数据<br>|-settings.js 管理设置相关数据<br>|-user.js 管理后台登陆用户相关数据<br>|-getters.js 提供子模块相关数据的getters计算属性<br>|-index.js vuex的store<br>|-styles<br>|-xxx.scss 项目组件需要使用的一些样式(使用scss)<br>|-utils 一些工具函数<br>|-auth.js 操作登陆用户的token cookie<br>|-get-page-title.js 得到要显示的网页title<br>|-request.js axios二次封装的模块<br>|-validate.js 检验相关工具函数<br>|-index.js 日期和请求参数处理相关工具函数<br>|-views 路由组件文件夹<br>|-dashboard 首页<br>|-login 登陆<br>|-App.vue 应用根组件<br>|-main.js 入口js<br>|-permission.js 使用全局守卫实现路由权限控制的模块<br>|-settings.js 包含应用设置信息的模块<br>|-.env.development 指定了开发环境的代理服务器前缀路径<br>|-.env.production 指定了生产环境的代理服务器前缀路径<br>|-.eslintignore eslint的忽略配置<br>|-.eslintrc.js eslint的检查配置<br>|-.gitignore git的忽略配置<br>|-.npmrc 指定npm的淘宝镜像和sass的下载地址<br>|-babel.config.js babel的配置<br>|-jsconfig.json 用于vscode引入路径提示的配置<br>|-package.json 当前项目包信息<br>|-package-lock.json 当前项目依赖的第三方包的精确信息<br>|-vue.config.js webpack相关配置(如: 代理服务器)<br></code></pre></td></tr></table></figure><h2 id="改造登录和退出功能"><a href="#改造登录和退出功能" class="headerlink" title="改造登录和退出功能"></a>改造登录和退出功能</h2><h5 id="vue-config-js"><a href="#vue-config-js" class="headerlink" title="vue.config.js"></a>vue.config.js</h5><ul><li>注释掉 mock 接口配置</li><li>配置代理转发请求到目标接口</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// before: require(&#x27;./mock/mock-server.js&#x27;)</span><br><span class="hljs-attr">proxy</span>: &#123;<br>  <span class="hljs-string">&#x27;/dev-api&#x27;</span>: &#123; <span class="hljs-comment">// 匹配所有以 &#x27;/dev-api&#x27;开头的请求路径</span><br>    <span class="hljs-attr">target</span>: <span class="hljs-string">&#x27;http://localhost:8800&#x27;</span>,<br>      <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 支持跨域</span><br>      <span class="hljs-attr">pathRewrite</span>: &#123; <span class="hljs-comment">// 重写路径: 去掉路径中开头的&#x27;/dev-api&#x27;</span><br>      <span class="hljs-string">&#x27;^/dev-api&#x27;</span>: <span class="hljs-string">&#x27;&#x27;</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/assets/4ca60c450a134f18bb3014342ee94391.png"></p><h5 id="src-x2F-utils-x2F-request-js"><a href="#src-x2F-utils-x2F-request-js" class="headerlink" title="src&#x2F;utils&#x2F;request.js"></a>src&#x2F;utils&#x2F;request.js</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">if</span> (res.<span class="hljs-property">code</span> !== <span class="hljs-number">200</span>) &#123;<br>  <span class="hljs-title class_">Message</span>(&#123;<br>    <span class="hljs-attr">message</span>: res.<span class="hljs-property">message</span> || <span class="hljs-string">&quot;Error&quot;</span>,<br>    <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;error&quot;</span>,<br>    <span class="hljs-attr">duration</span>: <span class="hljs-number">5</span> * <span class="hljs-number">1000</span>,<br>  &#125;);<br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(res.<span class="hljs-property">message</span> || <span class="hljs-string">&quot;Error&quot;</span>));<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>  <span class="hljs-keyword">return</span> res;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/assets/68c4de4351204d78867a34b04b910a99.png"></p><h5 id="src-x2F-api-x2F-user-js"><a href="#src-x2F-api-x2F-user-js" class="headerlink" title="src&#x2F;api&#x2F;user.js"></a>src&#x2F;api&#x2F;user.js</h5><p>修改 url</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> request <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/utils/request&quot;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">data</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>(&#123;<br>    <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;/admin/system/index/login&quot;</span>,<br>    <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;post&quot;</span>,<br>    data,<br>  &#125;);<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getInfo</span>(<span class="hljs-params">token</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>(&#123;<br>    <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;/admin/system/index/info&quot;</span>,<br>    <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;get&quot;</span>,<br>    <span class="hljs-attr">params</span>: &#123; token &#125;,<br>  &#125;);<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">logout</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>(&#123;<br>    <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;/admin/system/index/logout&quot;</span>,<br>    <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;post&quot;</span>,<br>  &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/assets/b3fa5292502f46c4acdcd11872af5221.png"><br>后端代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.system.controller;<br><br><span class="hljs-keyword">import</span> com.atguigu.common.result.Result;<br><span class="hljs-keyword">import</span> io.swagger.annotations.Api;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PostMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-meta">@Api(&quot;后台管理登录&quot;)</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/admin/system/index&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IndexController</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * &#123;&quot;code&quot;:20000,</span><br><span class="hljs-comment">     * &quot;data&quot;:&#123;&quot;token&quot;:&quot;admin-token&quot;&#125;&#125;</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PostMapping(&quot;/login&quot;)</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">login</span><span class="hljs-params">()</span> &#123;<br>        Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        map.put(<span class="hljs-string">&quot;token&quot;</span>, <span class="hljs-string">&quot;admin-token xiamu&quot;</span>);<br>        <span class="hljs-keyword">return</span> Result.ok(map);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * &#123;&quot;code&quot;:20000,</span><br><span class="hljs-comment">     * &quot;data&quot;:&#123;&quot;roles&quot;:[&quot;admin&quot;],</span><br><span class="hljs-comment">     * &quot;introduction&quot;:&quot;I am a super administrator&quot;,</span><br><span class="hljs-comment">     * &quot;avatar&quot;:&quot;https://wpimg.wallstcn.com/f778738c-e4f8-4870-b634-56703b4acafe.gif&quot;,</span><br><span class="hljs-comment">     * &quot;name&quot;:&quot;Super Admin&quot;&#125;&#125;</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GetMapping(&quot;/info&quot;)</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">info</span><span class="hljs-params">()</span> &#123;<br>        Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        map.put(<span class="hljs-string">&quot;roles&quot;</span>, <span class="hljs-string">&quot;[admin]&quot;</span>);<br>        map.put(<span class="hljs-string">&quot;introduction&quot;</span>, <span class="hljs-string">&quot;I am a super administrator&quot;</span>);<br>        map.put(<span class="hljs-string">&quot;avatar&quot;</span>, <span class="hljs-string">&quot;https://wpimg.wallstcn.com/f778738c-e4f8-4870-b634-56703b4acafe.gif&quot;</span>);<br>        map.put(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;Super Admin xiamu&quot;</span>);<br>        <span class="hljs-keyword">return</span> Result.ok(map);<br>    &#125;<br><br>    <span class="hljs-meta">@PostMapping(&quot;/logout&quot;)</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">logout</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> Result.ok();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="修改路由"><a href="#修改路由" class="headerlink" title="修改路由"></a>修改路由</h2><p>修改 src&#x2F;router&#x2F;index.js 文件，重新定义 constantRoutes</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> constantRoutes = [<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/login&quot;</span>,<br>    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&quot;@/views/login/index&quot;</span>),<br>    <span class="hljs-attr">hidden</span>: <span class="hljs-literal">true</span>,<br>  &#125;,<br><br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/404&quot;</span>,<br>    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&quot;@/views/404&quot;</span>),<br>    <span class="hljs-attr">hidden</span>: <span class="hljs-literal">true</span>,<br>  &#125;,<br><br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/&quot;</span>,<br>    <span class="hljs-attr">component</span>: <span class="hljs-title class_">Layout</span>,<br>    <span class="hljs-attr">redirect</span>: <span class="hljs-string">&quot;/dashboard&quot;</span>,<br>    <span class="hljs-attr">children</span>: [<br>      &#123;<br>        <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;dashboard&quot;</span>,<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Dashboard&quot;</span>,<br>        <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&quot;@/views/dashboard/index&quot;</span>),<br>        <span class="hljs-attr">meta</span>: &#123; <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;Dashboard&quot;</span>, <span class="hljs-attr">icon</span>: <span class="hljs-string">&quot;dashboard&quot;</span> &#125;,<br>      &#125;,<br>    ],<br>  &#125;,<br><br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;/system&quot;</span>,<br>    <span class="hljs-attr">component</span>: <span class="hljs-title class_">Layout</span>,<br>    <span class="hljs-attr">redirect</span>: <span class="hljs-string">&quot;/system/sysUser&quot;</span>,<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;System&quot;</span>,<br>    <span class="hljs-attr">meta</span>: &#123; <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;系统管理&quot;</span>, <span class="hljs-attr">icon</span>: <span class="hljs-string">&quot;el-icon-s-help&quot;</span> &#125;,<br>    <span class="hljs-attr">children</span>: [<br>      &#123;<br>        <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;sysRole&quot;</span>,<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;SysRole&quot;</span>,<br>        <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&quot;@/views/system/sysRole/list&quot;</span>),<br>        <span class="hljs-attr">meta</span>: &#123; <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;角色管理&quot;</span>, <span class="hljs-attr">icon</span>: <span class="hljs-string">&quot;table&quot;</span> &#125;,<br>      &#125;,<br>      &#123;<br>        <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;sysUser&quot;</span>,<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;SysUser&quot;</span>,<br>        <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&quot;@/views/system/sysUser/list&quot;</span>),<br>        <span class="hljs-attr">meta</span>: &#123; <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;用户管理&quot;</span>, <span class="hljs-attr">icon</span>: <span class="hljs-string">&quot;tree&quot;</span> &#125;,<br>      &#125;,<br>    ],<br>  &#125;,<br><br>  <span class="hljs-comment">// 404 page must be placed at the end !!!</span><br>  &#123; <span class="hljs-attr">path</span>: <span class="hljs-string">&quot;*&quot;</span>, <span class="hljs-attr">redirect</span>: <span class="hljs-string">&quot;/404&quot;</span>, <span class="hljs-attr">hidden</span>: <span class="hljs-literal">true</span> &#125;,<br>];<br></code></pre></td></tr></table></figure><p>views&#x2F;system&#x2F;sysRole&#x2F;list.vue 内容</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;div class=&quot;app-container&quot;&gt;角色列表&lt;/div&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><p>views&#x2F;system&#x2F;sysUser&#x2F;list.vue 内容</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;div class=&quot;app-container&quot;&gt;用户列表&lt;/div&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><h2 id="定义-api"><a href="#定义-api" class="headerlink" title="定义 api"></a>定义 api</h2><p>在 system-front\src\api\system\sysRole.js 定义</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> request <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/utils/request&quot;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-title function_">getList</span>(<span class="hljs-params">page, limit, serachObj</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>(&#123;<br>      <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;/admin/system/sysRole&quot;</span> + <span class="hljs-string">&quot;/&quot;</span> + page + <span class="hljs-string">&quot;/&quot;</span> + limit,<br>      <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;get&quot;</span>,<br>      <span class="hljs-attr">params</span>: serachObj,<br>    &#125;);<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="实现角色的管理"><a href="#实现角色的管理" class="headerlink" title="实现角色的管理"></a>实现角色的管理</h2><p><strong>JavaScript 的整数类型是正负 2 的 53 次方, 跟 Java 的 Long 类型的范围要小</strong><br>list.vue</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;div class=&quot;app-container&quot;&gt;<br>    角色列表<br>    &lt;!--查询表单--&gt;<br>    &lt;div class=&quot;search-div&quot;&gt;<br>      &lt;el-form<br>        label-width=&quot;70px&quot;<br>        size=&quot;small&quot;<br>        @keyup.enter.native=&quot;fetchData()&quot;<br>      &gt;<br>        &lt;el-row&gt;<br>          &lt;el-col :span=&quot;24&quot;&gt;<br>            &lt;el-form-item label=&quot;角色名称&quot;&gt;<br>              &lt;el-input<br>                style=&quot;width: 100%&quot;<br>                v-model=&quot;searchObj.roleName&quot;<br>                placeholder=&quot;角色名称&quot;<br>              &gt;&lt;/el-input&gt;<br>            &lt;/el-form-item&gt;<br>          &lt;/el-col&gt;<br>        &lt;/el-row&gt;<br>        &lt;el-row style=&quot;display:flex&quot;&gt;<br>          &lt;el-button<br>            type=&quot;primary&quot;<br>            icon=&quot;el-icon-search&quot;<br>            size=&quot;mini&quot;<br>            @click=&quot;fetchData()&quot;<br>            &gt;搜索&lt;/el-button<br>          &gt;<br>          &lt;el-button icon=&quot;el-icon-refresh&quot; size=&quot;mini&quot; @click=&quot;resetData&quot;<br>            &gt;重置&lt;/el-button<br>          &gt;<br>        &lt;/el-row&gt;<br>      &lt;/el-form&gt;<br>    &lt;/div&gt;<br><br>    &lt;!-- 添加组件 --&gt;<br>    &lt;div class=&quot;tools-div&quot;&gt;<br>      &lt;el-button type=&quot;success&quot; icon=&quot;el-icon-plus&quot; size=&quot;mini&quot; @click=&quot;add&quot;<br>        &gt;添 加&lt;/el-button<br>      &gt;<br>      &lt;el-button class=&quot;btn-add&quot; size=&quot;mini&quot; @click=&quot;batchRemove&quot;<br>        &gt;批量删除&lt;/el-button<br>      &gt;<br>    &lt;/div&gt;<br><br>    &lt;!-- 表格 --&gt;<br>    &lt;el-table<br>      v-loading=&quot;listLoading&quot;<br>      :data=&quot;list&quot;<br>      stripe<br>      border<br>      style=&quot;width: 100%;margin-top: 10px;&quot;<br>      @selection-change=&quot;handleSelectionChange&quot;<br>    &gt;<br>      &lt;!-- 添加复选框 --&gt;<br>      &lt;el-table-column type=&quot;selection&quot; /&gt;<br><br>      &lt;el-table-column label=&quot;序号&quot; width=&quot;70&quot; align=&quot;center&quot;&gt;<br>        &lt;template slot-scope=&quot;scope&quot;&gt;<br>          &#123;&#123; (page - 1) * limit + scope.$index + 1 &#125;&#125;<br>        &lt;/template&gt;<br>      &lt;/el-table-column&gt;<br><br>      &lt;el-table-column prop=&quot;roleName&quot; label=&quot;角色名称&quot; /&gt;<br>      &lt;el-table-column prop=&quot;roleCode&quot; label=&quot;角色编码&quot; /&gt;<br>      &lt;el-table-column prop=&quot;createTime&quot; label=&quot;创建时间&quot; width=&quot;160&quot; /&gt;<br>      &lt;el-table-column label=&quot;操作&quot; width=&quot;200&quot; align=&quot;center&quot;&gt;<br>        &lt;template slot-scope=&quot;scope&quot;&gt;<br>          &lt;el-button<br>            type=&quot;primary&quot;<br>            icon=&quot;el-icon-edit&quot;<br>            size=&quot;mini&quot;<br>            @click=&quot;edit(scope.row.id)&quot;<br>            title=&quot;修改&quot;<br>          /&gt;<br>          &lt;el-button<br>            type=&quot;danger&quot;<br>            icon=&quot;el-icon-delete&quot;<br>            size=&quot;mini&quot;<br>            @click=&quot;removeDataById(scope.row.id)&quot;<br>            title=&quot;删除&quot;<br>          /&gt;<br>        &lt;/template&gt;<br>      &lt;/el-table-column&gt;<br>    &lt;/el-table&gt;<br><br>    &lt;!-- 分页组件 --&gt;<br>    &lt;el-pagination<br>      :current-page=&quot;page&quot;<br>      :total=&quot;total&quot;<br>      :page-size=&quot;limit&quot;<br>      style=&quot;padding: 30px 0; text-align: center;&quot;<br>      layout=&quot;total, prev, pager, next, jumper&quot;<br>      @current-change=&quot;fetchData&quot;<br>    /&gt;<br><br>    &lt;!-- 定义弹出框 --&gt;<br>    &lt;el-dialog title=&quot;添加/修改&quot; :visible.sync=&quot;dialogVisible&quot; width=&quot;40%&quot;&gt;<br>      &lt;el-form<br>        ref=&quot;dataForm&quot;<br>        :model=&quot;sysRole&quot;<br>        label-width=&quot;150px&quot;<br>        size=&quot;small&quot;<br>        style=&quot;padding-right: 40px;&quot;<br>      &gt;<br>        &lt;el-form-item label=&quot;角色名称&quot;&gt;<br>          &lt;el-input v-model=&quot;sysRole.roleName&quot; /&gt;<br>        &lt;/el-form-item&gt;<br>        &lt;el-form-item label=&quot;角色编码&quot;&gt;<br>          &lt;el-input v-model=&quot;sysRole.roleCode&quot; /&gt;<br>        &lt;/el-form-item&gt;<br>      &lt;/el-form&gt;<br>      &lt;span slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;<br>        &lt;el-button<br>          @click=&quot;dialogVisible = false&quot;<br>          size=&quot;small&quot;<br>          icon=&quot;el-icon-refresh-right&quot;<br>          &gt;取 消&lt;/el-button<br>        &gt;<br>        &lt;el-button<br>          type=&quot;primary&quot;<br>          icon=&quot;el-icon-check&quot;<br>          @click=&quot;saveOrUpdate()&quot;<br>          size=&quot;small&quot;<br>          &gt;确 定&lt;/el-button<br>        &gt;<br>      &lt;/span&gt;<br>    &lt;/el-dialog&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>// 引入定义接口的js文件<br>import api from &quot;@/api/system/sysRole&quot;;<br>const defaultForm = &#123;<br>  id: &quot;&quot;,<br>  roleName: &quot;&quot;,<br>  roleCode: &quot;&quot;,<br>&#125;;<br>export default &#123;<br>  //定义初始值<br>  data() &#123;<br>    return &#123;<br>      listLoading: true, // 数据是否正在加载<br>      list: [], // 角色列表<br>      total: 0, // 总记录数<br>      page: 1, //页码<br>      limit: 8, // 每页记录数<br>      searchObj: &#123;&#125;, // 查询条件<br>      dialogVisible: false, // 不弹框<br>      sysRole: defaultForm, // 封装提交的对象<br>      saveBtnDisabled: false,<br>      multipleSelection: [], // 批量删除选中的记录列表<br>    &#125;;<br>  &#125;,<br>  // 页面渲染之前执行<br>  created() &#123;<br>    this.fetchData();<br>  &#125;,<br>  // 具体方法<br>  methods: &#123;<br>    // 复选框发生变化时处理<br>    handleSelectionChange(selection) &#123;<br>      //console.log(selection);<br>      this.multipleSelection = selection;<br>    &#125;,<br>    // 批量删除<br>    batchRemove() &#123;<br>      if (this.multipleSelection.length == 0) &#123;<br>        this.$message.warning(&quot;请选择你要删除的记录!&quot;);<br>        return;<br>      &#125;<br>      this.$confirm(&quot;此操作将永久删除该记录, 是否继续?&quot;, &quot;提示&quot;, &#123;<br>        confirmButtonText: &quot;确定&quot;,<br>        cancelButtonText: &quot;取消&quot;,<br>        type: &quot;warning&quot;,<br>      &#125;)<br>        .then(() =&gt; &#123;<br>          // 点击确定，远程调用ajax<br>          // 遍历selection，将id取出放入id列表<br>          var idList = [];<br>          this.multipleSelection.forEach((item) =&gt; &#123;<br>            idList.push(item.id);<br>          &#125;);<br>          // 调用api<br>          api.batchRemove(idList).then((response) =&gt; &#123;<br>            console.log(response);<br>            this.fetchData();<br>            this.$message.success(response.message);<br>          &#125;);<br>        &#125;)<br>        .catch((error) =&gt; &#123;<br>          if (error === &quot;cancel&quot;) &#123;<br>            this.$message.info(&quot;取消删除&quot;);<br>          &#125;<br>        &#125;);<br>    &#125;,<br><br>    edit(id) &#123;<br>      this.dialogVisible = true;<br>      api.getById(id).then((response) =&gt; &#123;<br>        this.sysRole = response.data;<br>      &#125;);<br>    &#125;,<br><br>    // 弹出添加功能的表单<br>    add() &#123;<br>      this.dialogVisible = true;<br>      this.sysRole = &#123;&#125;;<br>    &#125;,<br><br>    saveOrUpdate() &#123;<br>      if (!this.sysRole.id) &#123;<br>        this.saveRole();<br>      &#125; else &#123;<br>        this.updateRole();<br>      &#125;<br>    &#125;,<br><br>    saveRole() &#123;<br>      api.save(this.sysRole).then((response) =&gt; &#123;<br>        // 提示保存成功<br>        this.$message(&#123;<br>          type: &quot;success&quot;,<br>          message: &quot;保存成功!&quot;,<br>        &#125;);<br>        this.fetchData();<br>        this.dialogVisible = false;<br>      &#125;);<br>    &#125;,<br><br>    updateRole() &#123;<br>      api.updateById(this.sysRole).then((response) =&gt; &#123;<br>        // 提示保存成功<br>        this.$message(&#123;<br>          type: &quot;success&quot;,<br>          message: &quot;修改成功!&quot;,<br>        &#125;);<br>        this.fetchData(this.page);<br>        this.dialogVisible = false;<br>      &#125;);<br>    &#125;,<br><br>    // 条件分页查询列表方法<br>    fetchData(pageNum = 1) &#123;<br>      // 页数赋值<br>      this.page = pageNum;<br>      // ajax                                     searchObj<br>      api<br>        .getPageList(this.page, this.limit, this.searchObj)<br>        .then((response) =&gt; &#123;<br>          // console.log(response);<br>          this.listLoading = false;<br>          // 每页数据列表<br>          this.list = response.data.records;<br>          // 总记录数<br>          this.total = response.data.total;<br>        &#125;);<br>    &#125;,<br><br>    // 重置表单<br>    resetData() &#123;<br>      console.log(&quot;重置查询表单&quot;);<br>      // 清空表单<br>      this.searchObj = &#123;&#125;;<br>      // 查询所有数据<br>      this.fetchData();<br>    &#125;,<br><br>    // 删除角色<br>    removeDataById(id) &#123;<br>      this.$confirm(&quot;此操作将永久删除该角色, 是否继续?&quot;, &quot;提示&quot;, &#123;<br>        confirmButtonText: &quot;确定&quot;,<br>        cancelButtonText: &quot;取消&quot;,<br>        type: &quot;warning&quot;,<br>      &#125;)<br>        .then(() =&gt; &#123;<br>          // 调用方法删除<br>          api.removeId(id).then((response) =&gt; &#123;<br>            // 提示删除成功<br>            this.$message(&#123;<br>              type: &quot;success&quot;,<br>              message: &quot;删除成功!&quot;,<br>            &#125;);<br>            // 刷新页面<br>            this.fetchData();<br>          &#125;);<br>        &#125;)<br>        .catch(() =&gt; &#123;<br>          this.$message(&#123;<br>            type: &quot;info&quot;,<br>            message: &quot;已取消删除&quot;,<br>          &#125;);<br>        &#125;);<br>    &#125;,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><p>sysRole.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> request <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/utils/request&quot;</span>;<br><br><span class="hljs-keyword">const</span> api_name = <span class="hljs-string">&quot;/admin/system/sysRole&quot;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-title function_">getPageList</span>(<span class="hljs-params">page, limit, serachObj</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>(&#123;<br>      <span class="hljs-comment">//url: &#x27;/admin/system/sysRole&#x27; + &#x27;/&#x27; + page + &#x27;/&#x27; + limit,</span><br>      <span class="hljs-attr">url</span>: <span class="hljs-string">`<span class="hljs-subst">$&#123;api_name&#125;</span>/<span class="hljs-subst">$&#123;page&#125;</span>/<span class="hljs-subst">$&#123;limit&#125;</span>`</span>,<br>      <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;get&quot;</span>,<br>      <span class="hljs-attr">params</span>: serachObj,<br>    &#125;);<br>  &#125;,<br>  <span class="hljs-title function_">removeId</span>(<span class="hljs-params">id</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>(&#123;<br>      <span class="hljs-attr">url</span>: <span class="hljs-string">`<span class="hljs-subst">$&#123;api_name&#125;</span>/remove/<span class="hljs-subst">$&#123;id&#125;</span>`</span>,<br>      <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;delete&quot;</span>,<br>    &#125;);<br>  &#125;,<br>  <span class="hljs-title function_">save</span>(<span class="hljs-params">role</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>(&#123;<br>      <span class="hljs-attr">url</span>: <span class="hljs-string">`<span class="hljs-subst">$&#123;api_name&#125;</span>/save`</span>,<br>      <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;post&quot;</span>,<br>      <span class="hljs-attr">data</span>: role,<br>      <span class="hljs-comment">// data表达json参数</span><br>      <span class="hljs-comment">// params是添加到url的请求字符串中的，一般用于get请求</span><br>      <span class="hljs-comment">// data是添加到请求体（body）中的， 一般用于post请求</span><br>    &#125;);<br>  &#125;,<br>  <span class="hljs-comment">// 通过id查询</span><br>  <span class="hljs-title function_">getById</span>(<span class="hljs-params">id</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>(&#123;<br>      <span class="hljs-attr">url</span>: <span class="hljs-string">`<span class="hljs-subst">$&#123;api_name&#125;</span>/findRoleById/<span class="hljs-subst">$&#123;id&#125;</span>`</span>,<br>      <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;post&quot;</span>,<br>    &#125;);<br>  &#125;,<br>  <span class="hljs-comment">// 更新</span><br>  <span class="hljs-title function_">updateById</span>(<span class="hljs-params">role</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>(&#123;<br>      <span class="hljs-attr">url</span>: <span class="hljs-string">`<span class="hljs-subst">$&#123;api_name&#125;</span>/update`</span>,<br>      <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;post&quot;</span>,<br>      <span class="hljs-attr">data</span>: role,<br>    &#125;);<br>  &#125;,<br>  <span class="hljs-comment">// 批量删除</span><br>  <span class="hljs-title function_">batchRemove</span>(<span class="hljs-params">idList</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">request</span>(&#123;<br>      <span class="hljs-attr">url</span>: <span class="hljs-string">`<span class="hljs-subst">$&#123;api_name&#125;</span>/batchRemove`</span>,<br>      <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;delete&quot;</span>,<br>      <span class="hljs-attr">data</span>: idList,<br>    &#125;);<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="实现用户的管理"><a href="#实现用户的管理" class="headerlink" title="实现用户的管理"></a>实现用户的管理</h2><h2 id="树形结构工具类"><a href="#树形结构工具类" class="headerlink" title="树形结构工具类"></a>树形结构工具类</h2><h2 id="前后端打包"><a href="#前后端打包" class="headerlink" title="前后端打包"></a>前后端打包</h2><p><strong>后端打包</strong>在 pom.xml 加上如下代码</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">finalName</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;project.artifactId&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">finalName</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p>点击 maven 的 package 进行打包, 打包之后的文件存在 target 下<br><img src="/assets/a9a93496c9d044838656a14272b9fff7.png"><br><strong>前端打包</strong>需要把代理修改成 prod 生产环境</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">PS E:\Code\guigu-auth\guigu-auth-front\system-front&gt; npm run build:prod<br></code></pre></td></tr></table></figure><p>打包完之后, 打包之后的文件存在 dist 下<br><img src="/assets/24a1d2a21fe54f4abfad18389b1a061d.png"></p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>SSM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Nginx</title>
    <link href="/Java/Nginx/"/>
    <url>/Java/Nginx/</url>
    
    <content type="html"><![CDATA[<blockquote><p>唯有你也想见我, 我们俩的见面才有意义</p></blockquote><h2 id="Nginx-的安装"><a href="#Nginx-的安装" class="headerlink" title="Nginx 的安装"></a>Nginx 的安装</h2><p>先下载 <a href="http://nginx.org/en/download.html">http://nginx.org/en/download.html</a> , 推荐下载稳定版<br><img src="/assets/45d8c292ee6a4553a736bae4e55e4b50.png"><br>可以先下载到 windows 系统里, 然后再通过 xftp 传输到虚拟机<br>或者通过 wget 的方式安装(虚拟机需要有网络)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 软件包放在/opt目录下</span><br>[root@xiamu ~]<span class="hljs-comment"># cd /opt/</span><br>[root@xiamu opt]<span class="hljs-comment"># wget http://nginx.org/download/nginx-1.22.1.tar.gz</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 安装完之后查看</span><br>[root@xiamu opt]<span class="hljs-comment"># ls</span><br>nginx-1.22.1.tar.gz<br><br><span class="hljs-comment"># 解压nginx</span><br>[root@xiamu opt]<span class="hljs-comment"># tar zxvf nginx-1.22.1.tar.gz</span><br><br>[root@xiamu opt]<span class="hljs-comment"># ls</span><br>nginx-1.22.1 nginx-1.22.1.tar.gz<br><br>[root@xiamu opt]<span class="hljs-comment"># cd nginx-1.22.1/</span><br>[root@xiamu nginx-1.22.1]<span class="hljs-comment"># ls</span><br>auto     CHANGES.ru  configure  html     man     src<br>CHANGES  conf        contrib    LICENSE  README<br><br><span class="hljs-comment"># 编译安装</span><br>[root@xiamu nginx-1.22.1]<span class="hljs-comment"># ./configure --prefix=/usr/local/nginx</span><br>[root@xiamu nginx-1.22.1]<span class="hljs-comment"># make</span><br>[root@xiamu nginx-1.22.1]<span class="hljs-comment"># make install</span><br><br></code></pre></td></tr></table></figure><p>如果指定编译安装的路径是自己自定义的话, 采用如下这种方式安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 文件的解压目录和编译目录不能是同一文件夹</span><br>$ ./configure --prefix=/opt/module/nginx<br>$ make<br>$ sudo make install<br><br>$ sudo vi /usr/lib/systemd/system/nginx.service<br><br>[Unit]<br>Description=nginx - web server<br>After=network.target remote-fs.target nss-lookup.target<br>[Service]<br>Type=forking<br>PIDFile=/opt/module/nginx/logs/nginx.pid<br>ExecStartPre=/opt/module/nginx/sbin/nginx -t -c /opt/module/nginx/conf/nginx.conf<br>ExecStart=/opt/module/nginx/sbin/nginx -c /opt/module/nginx/conf/nginx.conf<br>ExecReload=/opt/module/nginx/sbin/nginx -s reload<br>ExecStop=/opt/module/nginx/sbin/nginx -s stop<br>ExecQuit=/opt/module/nginx/sbin/nginx -s quit<br>PrivateTmp=<span class="hljs-literal">true</span><br>[Install]<br>WantedBy=multi-user.target<br><br>$ sudo systemctl daemon-reload<br>$ sudo systemctl start nginx<br>$ sudo systemctl status nginx<br></code></pre></td></tr></table></figure><p>常见报错</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">checking <span class="hljs-keyword">for</span> OS<br>+ Linux 3.10.0-693.el7.x86_64 x86_64<br>checking <span class="hljs-keyword">for</span> C compiler ... not found<br>./configure: error: C compiler cc is not found<br><span class="hljs-comment"># 安装gcc</span><br>[root@xiamu nginx-1.22.1]<span class="hljs-comment"># yum install -y gcc</span><br><br>./configure: error: the HTTP rewrite module requires the PCRE library.<br>You can either <span class="hljs-built_in">disable</span> the module by using --without-http_rewrite_module<br>option, or install the PCRE library into the system, or build the PCRE library<br>statically from the <span class="hljs-built_in">source</span> with nginx by using --with-pcre=&lt;path&gt; option.<br><span class="hljs-comment"># 安装perl库</span><br>[root@xiamu nginx-1.22.1]<span class="hljs-comment"># yum install -y pcre pcre-devel</span><br><br><br>./configure: error: the HTTP gzip module requires the zlib library.<br>You can either <span class="hljs-built_in">disable</span> the module by using --without-http_gzip_module<br>option, or install the zlib library into the system, or build the zlib library<br>statically from the <span class="hljs-built_in">source</span> with nginx by using --with-zlib=&lt;path&gt; option.<br><span class="hljs-comment"># 安装zlib库</span><br>[root@xiamu nginx-1.22.1]<span class="hljs-comment"># yum install -y zlib zlib-devel</span><br><br></code></pre></td></tr></table></figure><h2 id="开启网络服务报错"><a href="#开启网络服务报错" class="headerlink" title="开启网络服务报错"></a>开启网络服务报错</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">参考网站: https://www.cyberithub.com/failed-to-start-lsb-bring-up-down-networking/<br><br>报错信息<br>Solved: network.service Failed to start LSB: Bring up/down networking <span class="hljs-keyword">in</span> RHEL/Centos 7/8<br><br>尝试禁用NetworkManager, 或者BOOTPROTO设置成none<br>[root@localhost ~]<span class="hljs-comment"># systemctl stop NetworkManager</span><br>[root@localhost ~]<span class="hljs-comment"># systemctl disable NetworkManager</span><br>[root@localhost ~]<span class="hljs-comment"># systemctl status NetworkManager -l</span><br></code></pre></td></tr></table></figure><h2 id="查看-nginx-的目录"><a href="#查看-nginx-的目录" class="headerlink" title="查看 nginx 的目录"></a>查看 nginx 的目录</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xiamu nginx-1.22.1]<span class="hljs-comment"># cd /usr/local/</span><br>[root@xiamu <span class="hljs-built_in">local</span>]<span class="hljs-comment"># ls</span><br>bin  games    lib    libexec  sbin   src<br>etc  include  lib64  nginx    share<br>[root@xiamu <span class="hljs-built_in">local</span>]<span class="hljs-comment"># cd nginx/</span><br>[root@xiamu nginx]<span class="hljs-comment"># ls</span><br>conf  html  logs  sbin<br><br></code></pre></td></tr></table></figure><h2 id="开启-nginx-服务"><a href="#开启-nginx-服务" class="headerlink" title="开启 nginx 服务"></a>开启 nginx 服务</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xiamu nginx]<span class="hljs-comment"># cd sbin/</span><br>[root@xiamu sbin]<span class="hljs-comment"># ls</span><br>nginx<br>[root@xiamu sbin]<span class="hljs-comment"># ./nginx</span><br>[root@xiamu sbin]<span class="hljs-comment"># ./nginx -s stop</span><br><span class="hljs-comment"># 先开启nginx, 然后关闭, 配置脚本, 以后可以通过脚本的方式来启动nginx, 非常的方便</span><br><br><span class="hljs-comment"># nginx的开启和关闭</span><br>./nginx 启动<br>./nginx -s stop 快速停止<br>./nginx -s quit 优雅关闭，在退出前完成已经接受的连接请求<br>./nginx -s reload 重新加载配置<br></code></pre></td></tr></table></figure><p>在 windows 浏览器输入虚拟机的 ip, welcome to nginx, 如果访问不到, 请关闭防火墙<br><img src="/assets/d6261326771e47fdad296e9dd8a8bdcf.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 关闭防火墙</span><br>[root@xiamu sbin]<span class="hljs-comment"># systemctl status firewalld.service</span><br>[root@xiamu sbin]<span class="hljs-comment"># systemctl stop firewalld.service</span><br>[root@xiamu sbin]<span class="hljs-comment"># systemctl status firewalld.service</span><br></code></pre></td></tr></table></figure><h2 id="安装成系统服务-配置脚本启动-nginx"><a href="#安装成系统服务-配置脚本启动-nginx" class="headerlink" title="安装成系统服务(配置脚本启动 nginx)"></a>安装成系统服务(配置脚本启动 nginx)</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 注意在配置脚本的时候, nginx服务需要先关闭</span><br>[root@xiamu sbin]<span class="hljs-comment"># ps -ef | grep nginx</span><br>[root@xiamu sbin]<span class="hljs-comment"># ./nginx -s stop</span><br>[root@xiamu sbin]<span class="hljs-comment"># ps -ef | grep nginx</span><br><br><span class="hljs-comment">#  创建服务脚本</span><br>[root@xiamu sbin]<span class="hljs-comment"># vi /usr/lib/systemd/system/nginx.service</span><br><br>[Unit]<br>Description=nginx - web server<br>After=network.target remote-fs.target nss-lookup.target<br>[Service]<br>Type=forking<br>PIDFile=/usr/local/nginx/logs/nginx.pid<br>ExecStartPre=/usr/local/nginx/sbin/nginx -t -c /usr/local/nginx/conf/nginx.conf<br>ExecStart=/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf<br>ExecReload=/usr/local/nginx/sbin/nginx -s reload<br>ExecStop=/usr/local/nginx/sbin/nginx -s stop<br>ExecQuit=/usr/local/nginx/sbin/nginx -s quit<br>PrivateTmp=<span class="hljs-literal">true</span><br>[Install]<br>WantedBy=multi-user.target<br><br><br><span class="hljs-comment"># 重启系统服务</span><br>[root@xiamu sbin]<span class="hljs-comment"># systemctl daemon-reload</span><br><br><span class="hljs-comment"># 注意要重启一遍</span><br>[root@xiamu sbin]<span class="hljs-comment"># reboot</span><br><br><span class="hljs-comment"># 启动nginx</span><br>[root@xiamu sbin]<span class="hljs-comment"># systemctl start nginx</span><br>[root@xiamu sbin]<span class="hljs-comment"># systemctl status nginx</span><br><br><span class="hljs-comment"># 设置开机启动nginx</span><br>[root@xiamu sbin]<span class="hljs-comment"># systemctl enable nginx</span><br><br></code></pre></td></tr></table></figure><h2 id="了解-ngix-的目录"><a href="#了解-ngix-的目录" class="headerlink" title="了解 ngix 的目录"></a>了解 ngix 的目录</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xiamu nginx]<span class="hljs-comment"># ls</span><br>client_body_temp  conf  fastcgi_temp  html  logs  proxy_temp  sbin  scgi_temp  uwsgi_temp<br><span class="hljs-comment"># html放页面</span><br><span class="hljs-comment"># logs放日志文件, 如果以后的磁盘被日志文件堆满了, nginx可能会出现问题</span><br><span class="hljs-comment"># conf放配置文件</span><br><span class="hljs-comment"># html用来存放静态文件的默认目录 html、css等</span><br><span class="hljs-comment"># sbin nginx的主程序</span><br><br><br><span class="hljs-comment"># logs文件下的pid文件是用来记录当前进程的pid值, 这个值可以自定义</span><br>[root@xiamu nginx]<span class="hljs-comment"># cat logs/nginx.pid</span><br>11928<br>[root@xiamu nginx]<span class="hljs-comment"># ps -ef | grep nginx</span><br>root      11928      1  0 13:20 ?        00:00:00 nginx: master process /usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf<br>nobody    11929  11928  0 13:20 ?        00:00:00 nginx: worker process<br>root      12992   7479  0 13:36 pts/2    00:00:00 grep --color=auto nginx<br><br><br></code></pre></td></tr></table></figure><h2 id="基本运行原理"><a href="#基本运行原理" class="headerlink" title="基本运行原理"></a>基本运行原理</h2><p><img src="/assets/9d6a9809956d43788ae2f76db7b0782a.png"></p><h2 id="Nginx-配置与应用场景"><a href="#Nginx-配置与应用场景" class="headerlink" title="Nginx 配置与应用场景"></a>Nginx 配置与应用场景</h2><p>nginx 目录下 conf&#x2F;nginx.conf</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">worker_processes<br>worker_processes 1; 默认为1，表示开启一个业务进程<br>worker_connections<br>worker_connections 1024; 单个业务进程可接受连接数<br>include mime.types;<br>include mime.types; 引入http mime类型<br>default_type application/octet-stream;<br>default_type application/octet-stream; 如果mime类型没匹配上，默认使用二进制流的方式传输。<br>sendfile on;<br>sendfile on; 使用linux的 sendfile(socket, file, len) 高效网络传输，也就是数据0拷贝。<br><br>keepalive_timeout 65;<br>keepalive_timeout 65;<br><br>虚拟主机配置<br>server &#123;<br>listen 80; 监听端口号<br>server_name localhost; 主机名<br>location / &#123; 匹配路径<br>root html; 文件根目录<br>index index.html index.htm; 默认页名称<br>&#125;<br>error_page 500 502 503 504 /50x.html; 报错编码对应页面<br>location = /50x.html &#123;<br>root html;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>未开启 sendfile<br><img src="/assets/40c2a50d47ea437888e9a05c85da2a99.png"><br>开启后<br><img src="/assets/b0dd0b4e9f594537a043940af4f1dc9d.png"><br>server<br><img src="/assets/b965c653401c44e59785523cc0fd05c0.png"></p><h2 id="配置自定义的域名"><a href="#配置自定义的域名" class="headerlink" title="配置自定义的域名"></a>配置自定义的域名</h2><p>C:\Windows\System32\drivers\etc 下修改 host 文件, 如果不能保存, 请先保存到桌面然后再拖拽进来替换该文件<br>(注意配置完之后要保存, 并且要关掉电脑上的 VPN)<br><img src="/assets/be3b1466509947df88de1379a6201378.png"><br><img src="/assets/8e3042acc2544c0ebf7bb7c27f6826f6.png"><br><img src="/assets/1efd34cc895141bc8fe09cdf3edf9e79.png"></p><h2 id="在阿里云的域名控制台配置内网-ip"><a href="#在阿里云的域名控制台配置内网-ip" class="headerlink" title="在阿里云的域名控制台配置内网 ip"></a>在阿里云的域名控制台配置内网 ip</h2><p><a href="https://dns.console.aliyun.com/#/dns/setting/xiamu.icu">https://dns.console.aliyun.com/#/dns/setting/xiamu.icu</a><br><img src="/assets/8133e3afe22b442083fec1c51f8046ca.png"><br>主机记录填写 www<br>记录值填写虚拟机的 ip 地址</p><p>然后打开 cmd 去 ping <a href="http://www.xiamu.icu/">www.xiamu.icu</a>, ping 通了, 说明配置成功了, 注意 ping 的是<a href="http://www.xxx.com/">www.xxx.com</a> 而不是 xxx.com<br><img src="/assets/f31aa60b0fab4cb38b82aed4b9112ae2.png"><br>ping 通之后可以打开浏览器访问<a href="http://www.xiamu.icu/">www.xiamu.icu</a><br><img src="/assets/43e81174d04a45aeac225ce9de7e4937.png"></p><p>批量添加很多域名, 在主机记录填写一个 * , 浏览器中 <a href="http://wwww.xiamu.icu/">http://wwww.xiamu.icu/</a>, 四个 w 也是可以访问的<br><img src="/assets/6283afdcd2454683bab79439bd8751ed.png"></p><p><img src="/assets/50bcc681f8a94b5fa7077387a6589939.png"></p><p>在根(&#x2F;)路径下创建两个文件 www&#x2F;www&#x2F;index.html 和 www&#x2F;vod&#x2F;index.html, 并且往里面写入内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xiamu www]<span class="hljs-comment"># ls</span><br>index.html<br>[root@xiamu www]<span class="hljs-comment"># cat index.html</span><br>this is www web site!<br>[root@xiamu www]<span class="hljs-comment"># pwd</span><br>/www/www<br><br>[root@xiamu vod]<span class="hljs-comment"># ls</span><br>index.html<br>[root@xiamu vod]<span class="hljs-comment"># cat index.html</span><br>this is void site.<br>[root@xiamu vod]<span class="hljs-comment"># pwd</span><br>/www/vod<br><br><br></code></pre></td></tr></table></figure><p>修改配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@xiamu nginx]<span class="hljs-comment"># vim /usr/local/nginx/conf/nginx.conf</span><br><span class="hljs-comment"># 只需要修改 server_name , location/root 就行了</span><br><span class="hljs-comment"># 注意修改的server_name可以同名, 但是端口不能重复</span><br><span class="hljs-comment"># 或者修改的server_name不同名, 但是端口可以重复</span><br><br>http &#123;<br>    include       mime.types;<br>    default_type  application/octet-stream;<br>    sendfile        on;<br>    keepalive_timeout  65;<br><br>    server &#123;<br>        listen       80;<br>        server_name  www.xiamu.icu;<br>        location / &#123;<br>            root   /www/www;<br>            index  index.html index.htm;<br>        &#125;<br>        error_page   500 502 503 504  /50x.html;<br>        location = /50x.html &#123;<br>            root   html;<br>        &#125;<br>    &#125;<br>server &#123;<br>        listen       80;<br>        server_name  vod.xiamu.icu;<br>        location / &#123;<br>            root   /www/vod;<br>            index  index.html index.htm;<br>        &#125;<br>        error_page   500 502 503 504  /50x.html;<br>        location = /50x.html &#123;<br>            root   html;<br>        &#125;<br>    &#125;<br>&#125;<br><br><br><span class="hljs-comment"># 修改完配置文件之后需要重新加载配置文件</span><br>[root@xiamu nginx]<span class="hljs-comment"># systemctl reload nginx</span><br>[root@xiamu nginx]<span class="hljs-comment"># systemctl status nginx</span><br><br><br></code></pre></td></tr></table></figure><p><img src="/assets/4f0d7304995b48e8b6ccead7e493bab3.png"><br><img src="/assets/996c247e603a4b34ab549025fd873f15.png"></p><h2 id="配置多个域名对应同一个资源文件"><a href="#配置多个域名对应同一个资源文件" class="headerlink" title="配置多个域名对应同一个资源文件"></a>配置多个域名对应同一个资源文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">server &#123;<br>    listen       80;<br>    server_name  www.xiamu.icu; <span class="hljs-comment"># 第一个域名, 这开始找, 如果下面所有的域名都没有匹配上, 就使用这个域名的资源</span><br>    location / &#123;<br>        root   /www/www;<br>        index  index.html index.htm;<br>    &#125;<br>    error_page   500 502 503 504  /50x.html;<br>    location = /50x.html &#123;<br>        root   html;<br>    &#125;<br>&#125;<br><br>server &#123;<br>    listen       80;<br>    server_name  vod.xiamu.icu vod1.xiamu.icu; <span class="hljs-comment"># 多个域名, 中间使用空格分隔开</span><br>    location / &#123;<br>        root   /www/vod;<br>        index  index.html index.htm;<br>    &#125;<br>    error_page   500 502 503 504  /50x.html;<br>    location = /50x.html &#123;<br>        root   html;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>可以发现 vod.xiamu.icu 和 vod1.xiamu.icu 这两个域名都可以访问到 void 的资源,<br>但是 void2.xiamu.icu, 访问的是 www 资源, 没有配置的域名会从第一个开始往下找, 如果没有找到, 就使用第一个域名对应的资源<br><img src="/assets/e003e2d656324fad94fac047decf5044.png"><br><img src="/assets/aeff57c96a9d4f8292661cbac9009875.png"><br><img src="/assets/6d7cef3a2902429c804200ec3e3a9647.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">server_name  *.xiamu.icu;<br><span class="hljs-comment"># *表示通配符, 除了www的开头的, 都会被匹配到vod文件下的资源</span><br><br>server_name  www.xiamu.*;<br><span class="hljs-comment"># 通配符的后匹配, 除了.icu结尾的, 都会被匹配到vod文件下的资源</span><br><br>hosts文件修改成(注意有www)<br>192.168.1.100 www.xiamu.com<br>192.168.1.100 www.xiamu.net<br>192.168.1.100 www.xiamu.org<br><br><br></code></pre></td></tr></table></figure><p>后缀匹配:<br><img src="/assets/44350cd0b2224ca591e1c33be995c4af.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">server_name  ~^[0-9]+\.xiamu\.icu$;<br><span class="hljs-comment"># 这个域名的后缀必须是购买的域名才行, 要经过阿里云服务器云解析之后的后缀</span><br></code></pre></td></tr></table></figure><p>正则表达式匹配:<br><img src="/assets/78fd789e12c34063819b48a5fd83106c.png"></p><h2 id="反向代理到外网与内网主机的配置"><a href="#反向代理到外网与内网主机的配置" class="headerlink" title="反向代理到外网与内网主机的配置"></a>反向代理到外网与内网主机的配置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 反向代理到外网</span><br>server &#123;<br>        listen       80;<br>        server_name  localhost;<br>        location / &#123;<br>             proxy_pass http://www.atguigu.com;<br>    <span class="hljs-comment"># proxy_pass 注意这里配置的是proxy_pass, 就不需要再配置root, 和index了</span><br>    <span class="hljs-comment">#        root   /www/www;</span><br>    <span class="hljs-comment">#        index  index.html index.htm;</span><br>        &#125;<br>        error_page   500 502 503 504  /50x.html;<br>        location = /50x.html &#123;<br>            root   html;<br>        &#125;<br>    &#125;<br><br><span class="hljs-comment"># 这样访问192.168.1.101, 就会跳转到http://www.atguigu.com的页面</span><br><span class="hljs-comment"># 访问www.xiamu.icu, 也会跳转到http://www.atguigu.com的页面</span><br><br><br><span class="hljs-comment"># 反向代理到内网</span><br>nginx1的配置<br>location / &#123;<br>    proxy_pass http://192.168.1.102;<br>&#125;<br><br>nginx2的配置<br>location / &#123;<br>    root   html;<br>    index  index.html index.htm;<br>&#125;<br>会被192.168.1.102代理<br><br></code></pre></td></tr></table></figure><h2 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># nginx1配置</span><br>upstream httpds &#123;<br>    server 192.168.1.102:80;<br>    server 192.168.1.103:80;<br>&#125;<br><br>server &#123;<br>    listen       80;<br>    server_name  localhost;<br>    location / &#123;<br>         proxy_pass http://httpds;<br><span class="hljs-comment">#        root   /www/www;</span><br><span class="hljs-comment">#        index  index.html index.htm;</span><br>    &#125;<br>    error_page   500 502 503 504  /50x.html;<br>    location = /50x.html &#123;<br>        root   html;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment"># nginx2配置</span><br>server &#123;<br>    listen       80;<br>    server_name  localhost;<br>    location / &#123;<br>        root   html;<br>        index  index.html index.htm;<br>    &#125;<br>    error_page   500 502 503 504  /50x.html;<br>    location = /50x.html &#123;<br>        root   html;<br>    &#125;<br>&#125;<br><br><br><span class="hljs-comment"># nginx3配置</span><br>server &#123;<br>    listen       80;<br>    server_name  localhost;<br>    location / &#123;<br>        root   html;<br>        index  index.html index.htm;<br>    &#125;<br>    error_page   500 502 503 504  /50x.html;<br>    location = /50x.html &#123;<br>        root   html;<br>    &#125;<br>&#125;<br><br><br><span class="hljs-comment"># 负载均衡就如同男人脚踏两只船, 需要对每一边都雨露均沾</span><br>192.168.1.101 =&gt; 192.168.1.102<br>            =&gt; 192.168.1.103<br></code></pre></td></tr></table></figure><h2 id="基于反向代理的负载均衡"><a href="#基于反向代理的负载均衡" class="headerlink" title="基于反向代理的负载均衡"></a>基于反向代理的负载均衡</h2><h3 id="负载均衡之权重-down-backup"><a href="#负载均衡之权重-down-backup" class="headerlink" title="负载均衡之权重, down, backup"></a>负载均衡之权重, down, backup</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><span class="hljs-comment"># down：表示当前的server暂时不参与负载</span><br><span class="hljs-comment"># weight：默认为1.weight越大，负载的权重就越大。</span><br><span class="hljs-comment"># backup： 其它所有的非backup机器down或者忙的时候，请求backup机器。</span><br><br><span class="hljs-comment"># nginx1</span><br>upstream httpds &#123;<br>    server 192.168.1.102 weight=8 down;<br>    server 192.168.1.103 weight=2;<br>    server 192.168.1.104 weight=1 backup;<br>&#125;<br>server &#123;<br>    listen       80;<br>    server_name  localhost;<br>    location / &#123;<br>         proxy_pass http://httpds;<br><span class="hljs-comment">#        root   /www/www;</span><br><span class="hljs-comment">#        index  index.html index.htm;</span><br>    &#125;<br>    error_page   500 502 503 504  /50x.html;<br>    location = /50x.html &#123;<br>        root   html;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment"># nginx2, nginx3, nginx4这三个配置一样</span><br>server &#123;<br>    listen       80;<br>    server_name  localhost;<br>    location / &#123;<br>        root   html;<br>        index  index.html index.htm;<br>    &#125;<br>    error_page   500 502 503 504  /50x.html;<br>    location = /50x.html &#123;<br>        root   html;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>轮询<br>默认情况下使用轮询方式，逐一转发，这种方式适用于无状态请求。<br>weight(权重)<br> 指定轮询几率，weight 和访问比率成正比，用于后端服务器性能不均的情况。<br> ip_hash<br>根据客户端的 ip 地址转发同一台服务器，可以保持回话。<br>least_conn<br>最少连接访问<br>url_hash<br>根据用户访问的 url 定向转发请求<br>fair<br>根据后端服务器响应时间转发请求</p><h2 id="动静分离"><a href="#动静分离" class="headerlink" title="动静分离"></a>动静分离</h2><p><img src="/assets/8130f4119cd94a72823e917e4b2c0442.png"></p><p>下载 tomcat<br><a href="https://www.digitalocean.com/community/tutorials/how-to-install-apache-tomcat-7-on-centos-7-via-yum">https://www.digitalocean.com/community/tutorials/how-to-install-apache-tomcat-7-on-centos-7-via-yum</a></p><p>然后在 192.168.1.104 中部署一个项目</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># nginx1</span><br>    server &#123;<br>        listen       80;<br>        server_name  localhost;<br>        location / &#123;<br>             proxy_pass http://192.168.1.104:8080/admin/; <span class="hljs-comment"># 注意格式, 最后面需要一个/</span><br>    <span class="hljs-comment">#        root   /www/www;</span><br>    <span class="hljs-comment">#        index  index.html index.htm;</span><br>        &#125;<br>        error_page   500 502 503 504  /50x.html;<br>        location = /50x.html &#123;<br>            root   html;<br>        &#125;<br>    &#125;<br><br><br>这样可以通过http://192.168.1.101/访问到http://192.168.1.104:8080/admin/<br>接着删除192.168.1.104下的静态资源js, css, images, fonts<br>再次访问的页面就不会有css等静态资源<br>我们需要把这些静态资源上传到192.168.1.101的/usr/local/nginx/html目录下<br>[root@xiamu01 html]<span class="hljs-comment"># ls</span><br>50x.html  css  fonts  images  index1.html  index.html  js<br><br><br><span class="hljs-comment"># 修改nginx1的配置, 再次访问192.168.1.101, 就有静态资源了</span><br>    server &#123;<br>        listen       80;<br>        server_name  localhost;<br>        location / &#123;<br>             proxy_pass http://192.168.1.104:8080/admin/;<br>    <span class="hljs-comment">#        root   /www/www;</span><br>    <span class="hljs-comment">#        index  index.html index.htm;</span><br>        &#125;<br>        location /css &#123;<br>             root html;<br>             index index.html index.htm;<br>        &#125;<br>        location /js &#123;<br>             root html;<br>             index index.html index.htm;<br>        &#125;<br>        location /fonts &#123;<br>             root html;<br>             index index.html index.htm;<br>        &#125;<br>        location /images &#123;<br>             root html;<br>             index index.html index.htm;<br>        &#125;<br>        error_page   500 502 503 504  /50x.html;<br>        location = /50x.html &#123;<br>            root   html;<br>        &#125;<br>    &#125;<br><br></code></pre></td></tr></table></figure><p>使用正则表达式配置静态资源</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">server &#123;<br>    listen       80;<br>    server_name  localhost;<br>    location / &#123;<br>         proxy_pass http://192.168.1.104:8080/admin/;<br><span class="hljs-comment">#        root   /www/www;</span><br><span class="hljs-comment">#        index  index.html index.htm;</span><br>    &#125;<br>    location ~*/(css|js|fonts|images) &#123;<br>         root html;<br>         index index.html index.htm;<br>    &#125;<br>    error_page   500 502 503 504  /50x.html;<br>    location = /50x.html &#123;<br>        root   html;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>伪静态配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">location / &#123;<br>     rewrite ^/2.html$  /hello?pageNum=2 <span class="hljs-built_in">break</span>;<br>     proxy_pass http://192.168.1.104:8888;<br>&#125;<br><br>http://192.168.1.101/hello?pageNum=2 =&gt; http://192.168.1.101/2.html<br><br><br>location / &#123;<br>     rewrite ^/([0-9]+).html$  /hello?pageNum=<span class="hljs-variable">$1</span> <span class="hljs-built_in">break</span>; <span class="hljs-comment"># $1是第一个参数, $2是第二个参数...</span><br>     proxy_pass http://192.168.1.104:8888;<br>&#125;<br>使用正则表达式匹配任意数字<br>...<br>http://192.168.1.101/hello?pageNum=3 =&gt; http://192.168.1.101/3.html<br>...<br>http://192.168.1.101/hello?pageNum=10 =&gt; http://192.168.1.101/10.html<br>...<br><br><br>location / &#123;<br>     rewrite ^/([0-9]+).html$  /hello?pageNum=<span class="hljs-variable">$1</span> redirect;<br>     proxy_pass http://192.168.1.104:8888;<br>&#125;<br><br>http://192.168.1.101/7.html =&gt; http://192.168.1.101/hello?pageNum=7<br></code></pre></td></tr></table></figure><p>UrlRewrite<br> rewrite 语法格式及参数语法:<br> rewrite 是实现 URL 重写的关键指令，根据 regex (正则表达式)部分内容，<br>重定向到 replacement，结尾是 flag 标记。<br>rewrite <regex> <replacement> [flag];<br>关键字 正则 替代内容 flag 标记<br>关键字：其中关键字 error_log 不能改变<br>正则：perl 兼容正则表达式语句进行规则匹配<br>替代内容：将正则匹配的内容替换成 replacement<br>flag 标记：rewrite 支持的 flag 标记<br>rewrite 参数的标签段位置：<br>server,location,if<br>flag 标记说明：<br>last #本条规则匹配完成后，继续向下匹配新的 location URI 规则<br>break #本条规则匹配完成即终止，不再匹配后面的任何规则<br>redirect #返回 302 临时重定向，浏览器地址会显示跳转后的 URL 地址<br>permanent #返回 301 永久重定向，浏览器地址栏会显示跳转后的 URL 地址</p><h2 id="网关服务器"><a href="#网关服务器" class="headerlink" title="网关服务器"></a>网关服务器</h2><p>应用服务器防火墙配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">开启防火墙<br>systemctl start firewalld<br>重启防火墙<br>systemctl restart firewalld<br>重载规则<br>firewall-cmd --reload<br>查看已配置规则<br>firewall-cmd --list-all<br>指定端口和ip访问<br>firewall-cmd --permanent --add-rich-rule=<span class="hljs-string">&quot;rule family=&quot;</span>ipv4<span class="hljs-string">&quot; source address=&quot;</span>192.168.1.101<span class="hljs-string">&quot;</span><br><span class="hljs-string">port protocol=&quot;</span>tcp<span class="hljs-string">&quot; port=&quot;</span>8080<span class="hljs-string">&quot; accept&quot;</span><br>移除规则<br>firewall-cmd --permanent --remove-rich-rule=<span class="hljs-string">&quot;rule family=&quot;</span>ipv4<span class="hljs-string">&quot; source</span><br><span class="hljs-string">address=&quot;</span>192.168.1.101<span class="hljs-string">&quot; port port=&quot;</span>8080<span class="hljs-string">&quot; protocol=&quot;</span>tcp<span class="hljs-string">&quot; accept&quot;</span><br><br>网关配置<br>upstream httpds &#123;<br>    server 192.168.1.102 weight=8 down;<br>    <span class="hljs-comment">#server 192.168.1.103 weight=2;</span><br>    server 192.168.1.104:8888 weight=1 backup;<br>&#125;<br><br>server &#123;<br>    listen       80;<br>    server_name  localhost;<br>    location / &#123;<br>         rewrite ^/([0-9]+).html$  /hello?pageNum=<span class="hljs-variable">$1</span> <span class="hljs-built_in">break</span>;<br>         proxy_pass http://httpds;<br><span class="hljs-comment">#        proxy_pass http://192.168.1.104:8888;</span><br><span class="hljs-comment">#        proxy_pass http://192.168.1.104:8080/admin/;</span><br><span class="hljs-comment">#        root   /www/www;</span><br><span class="hljs-comment">#        index  index.html index.htm;</span><br>    &#125;<br><br></code></pre></td></tr></table></figure><h2 id="防盗链"><a href="#防盗链" class="headerlink" title="防盗链"></a>防盗链</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#valid_referers none | blocked | server_names | strings ....;</span><br><span class="hljs-comment"># none， 检测 Referer 头域不存在的情况。</span><br><span class="hljs-comment"># blocked，检测 Referer 头域的值被防火墙或者代理服务器删除或伪装的情况。这种情况该头域的值不以</span><br><span class="hljs-comment"># “http://” 或 “https://” 开头。</span><br><span class="hljs-comment"># server_names ，设置一个或多个 URL ，检测 Referer 头域的值是否是这些 URL 中的某一个。</span><br><span class="hljs-comment"># 在需要防盗链的location中配置</span><br><br>valid_referers 192.168.44.101;<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$invalid_referer</span>) &#123;<br><span class="hljs-built_in">return</span> 403;<br>&#125;<br><br><br><br><br>location ~*/(css|js|fonts|images) &#123;<br>             valid_referers 192.168.1.101;<br>             <span class="hljs-keyword">if</span> (<span class="hljs-variable">$invalid_referer</span>) &#123;<br>             <span class="hljs-built_in">return</span> 403;<br>             &#125;<br>             root html;<br>             index index.html index.htm;<br>        &#125;<br>        error_page   500 502 503 504  /50x.html;<br>        location = /50x.html &#123;<br>            root   html;<br>        &#125;<br><br><br><br>location ~*/(css|js|fonts|images) &#123;<br>             valid_referers none 192.168.1.101;<br>             <span class="hljs-keyword">if</span> (<span class="hljs-variable">$invalid_referer</span>) &#123;<br>             <span class="hljs-built_in">return</span> 403;<br>             &#125;<br>             root html;<br>             index index.html index.htm;<br>        &#125;<br>        error_page   500 502 503 504  /50x.html;<br>        location = /50x.html &#123;<br>            root   html;<br>        &#125;<br><br><br><span class="hljs-comment"># valid_referers none 192.168.1.101;</span><br><span class="hljs-comment"># 两种访问的方式</span><br><span class="hljs-comment"># 没有referer的时候可以访问资源</span><br><span class="hljs-comment"># 有referer并且域名是等于配置(这里演示只是配置了ip192.168.1.101)的相同可以访问资源</span><br></code></pre></td></tr></table></figure><h2 id="curl"><a href="#curl" class="headerlink" title="curl"></a>curl</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 安装curl</span><br>[root@xiamu04 admin]<span class="hljs-comment"># yum install curl</span><br><br><span class="hljs-comment"># 当前设置的, 只有referer = none 或者 referer = 192.168.1.101的能够访问</span><br>valid_referers none 192.168.1.101;<br><br><span class="hljs-comment"># 使用curl测试</span><br>[root@xiamu04 admin]<span class="hljs-comment"># curl http://192.168.1.101</span><br>&lt;img src=<span class="hljs-string">&quot;images/photos/user-avatar.png&quot;</span>&gt;<br>[root@xiamu04 admin]<span class="hljs-comment"># curl -I http://192.168.1.101</span><br>HTTP/1.1 200 OK<br>Server: nginx/1.22.1<br>Date: Fri, 28 Oct 2022 11:47:22 GMT<br>Content-Type: text/html<br>Content-Length: 42<br>Connection: keep-alive<br>Accept-Ranges: bytes<br>ETag: W/<span class="hljs-string">&quot;42-1666955317000&quot;</span><br>Last-Modified: Fri, 28 Oct 2022 11:08:37 GMT<br><br><span class="hljs-comment"># 带引用</span><br>[root@xiamu04 admin]<span class="hljs-comment"># curl -I http://192.168.1.101/images/photos/user-avatar.png</span><br>HTTP/1.1 200 OK<br>Server: nginx/1.22.1<br>Date: Fri, 28 Oct 2022 11:49:32 GMT<br>Content-Type: image/png<br>Content-Length: 15649<br>Last-Modified: Thu, 27 Oct 2022 08:55:50 GMT<br>Connection: keep-alive<br>ETag: <span class="hljs-string">&quot;635a4796-3d21&quot;</span><br>Accept-Ranges: bytes<br><br>[root@xiamu04 admin]<span class="hljs-comment"># curl -e &quot;http://atguigu.com&quot; -I http://192.168.1.101/images/photos/user-avatar.png</span><br>HTTP/1.1 403 Forbidden<br>Server: nginx/1.22.1<br>Date: Fri, 28 Oct 2022 11:49:43 GMT<br>Content-Type: text/html<br>Content-Length: 153<br>Connection: keep-alive<br><br><br></code></pre></td></tr></table></figure><h2 id="盗链资源返回页面或者提示图片"><a href="#盗链资源返回页面或者提示图片" class="headerlink" title="盗链资源返回页面或者提示图片"></a>盗链资源返回页面或者提示图片</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 盗链之后返回html</span><br>location ~*/(css|js|fonts|images) &#123;<br>             <span class="hljs-comment">#valid_referers 192.168.1.101;</span><br>             valid_referers none 192.168.1.101;<br>             <span class="hljs-keyword">if</span> (<span class="hljs-variable">$invalid_referer</span>) &#123;<br>             <span class="hljs-built_in">return</span> 401;<br>             &#125;<br>             root html;<br>             index index.html index.htm;<br>        &#125;<br>        error_page   500 502 503 504  /50x.html;<br>        location = /50x.html &#123;<br>            root   html;<br>        &#125;<br>        error_page   401  /401.html;<br>        location = /401.html &#123;<br>            root   html;<br>        &#125;<br><br><span class="hljs-comment"># 盗链之后返回png图片</span><br>        location ~*/(css|js|fonts|images) &#123;<br>             <span class="hljs-comment">#valid_referers 192.168.1.101;</span><br>             valid_referers none 192.168.1.101;<br>             <span class="hljs-keyword">if</span> (<span class="hljs-variable">$invalid_referer</span>) &#123;<br>             rewrite ^/   /images/x.png <span class="hljs-built_in">break</span>;<br>             <span class="hljs-comment">#return 401;</span><br>             &#125;<br>             root html;<br>             index index.html index.htm;<br>        &#125;<br><br><br></code></pre></td></tr></table></figure><h2 id="安装-Keepalived"><a href="#安装-Keepalived" class="headerlink" title="安装 Keepalived"></a>安装 Keepalived</h2><p>常见报错</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">configure: error:<br>  !!! OpenSSL is not properly installed on your system. !!!<br>  !!! Can not include OpenSSL headers files.            !!!<br>[root@xiamu01 keepalived-2.2.7]<span class="hljs-comment"># yum install openssl-devel</span><br><br><br>--&gt; 正在检查事务<br>---&gt; 软件包 mariadb-libs.x86_64.1.5.5.68-1.el7 将被 安装<br>--&gt; 正在处理依赖关系 libmysqlclient.so.18(libmysqlclient_18)(64bit)，它被软件包 1:net-snmp-agent-libs-5.7.2-49.el7_9.2.x86_64 需要<br>--&gt; 正在处理依赖关系 libmysqlclient.so.18()(64bit)，它被软件包 1:net-snmp-agent-libs-5.7.2-49.el7_9.2.x86_64 需要<br>--&gt; 解决依赖关系完成<br>错误：软件包：1:net-snmp-agent-libs-5.7.2-49.el7_9.2.x86_64 (updates)<br>          需要：libmysqlclient.so.18()(64bit)<br>错误：软件包：1:net-snmp-agent-libs-5.7.2-49.el7_9.2.x86_64 (updates)<br>          需要：libmysqlclient.so.18(libmysqlclient_18)(64bit)<br> 您可以尝试添加 --skip-broken 选项来解决该问题<br> 您可以尝试执行：rpm -Va --nofiles --nodigest<br>[root@xiamu01 opt]<span class="hljs-comment"># wget https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-community-libs-compat-5.7.25-1.el7.x86_64.rpm</span><br>[root@xiamu01 opt]<span class="hljs-comment"># rpm -ivh mysql-community-libs-compat-5.7.25-1.el7.x86_64.rpm</span><br><br></code></pre></td></tr></table></figure><p>yum 安装 Keepalived</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># nginx1</span><br>[root@xiamu01 ~]<span class="hljs-comment"># yum install keepalived</span><br><br>配置<br>使用yum安装后配置文件在<br>/etc/keepalived/keepalived.conf<br><br>! Configuration File <span class="hljs-keyword">for</span> keepalived<br><br>global_defs &#123;<br>   router_id lb111<br>&#125;<br><br>vrrp_instance atguigu &#123;<br>    state MASTER<br>    interface ens33<br>    virtual_router_id 51<br>    priority 100<br>    advert_int 1<br>    authentication &#123;<br>        auth_type PASS<br>        auth_pass 1111<br>    &#125;<br>    virtual_ipaddress &#123;<br>        192.168.1.200<br>    &#125;<br>&#125;<br><br><br><br><span class="hljs-comment"># nginx1_backup</span><br>[root@xiamu01 ~]<span class="hljs-comment"># yum install keepalived</span><br><br>! Configuration File <span class="hljs-keyword">for</span> keepalived<br><br>global_defs &#123;<br>   router_id lb110<br>&#125;<br><br>vrrp_instance VI_1 &#123;<br>    state BACKUP<br>    interface ens33<br>    virtual_router_id 51<br>    priority 50<br>    advert_int 1<br>    authentication &#123;<br>        auth_type PASS<br>        auth_pass 1111<br>    &#125;<br>    virtual_ipaddress &#123;<br>        192.168.1.200<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><img src="/assets/08e378a3bd7a4aef87f6271529ecf9d8.png"></p><p>查看 ip</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br>[root@xiamu01 ~]<span class="hljs-comment"># ip addr</span><br>2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 00:50:56:3e:9d:2e brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.1.101/24 brd 192.168.1.255 scope global ens33<br>       valid_lft forever preferred_lft forever<br>    inet 192.168.1.200/32 scope global ens33<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::250:56ff:fe3e:9d2e/64 scope <span class="hljs-built_in">link</span><br>       valid_lft forever preferred_lft forever<br><br></code></pre></td></tr></table></figure><p>启动服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># nginx1 和 nginx1_backup</span><br>[root@xiamu01 ~]<span class="hljs-comment"># systemctl start keepalived</span><br>[root@xiamu01 ~]<span class="hljs-comment"># systemctl stop firewalld</span><br>[root@xiamu01 ~]<span class="hljs-comment"># systemctl start nginx</span><br></code></pre></td></tr></table></figure><p>使用 192.168.1.200 也能够访问到页面了<br><img src="/assets/1e85dabcec2d43ffa82afaae0fe972e7.png"></p><h2 id="Https-证书配置"><a href="#Https-证书配置" class="headerlink" title="Https 证书配置"></a>Https 证书配置</h2><p>不安全的 http 协议<br><img src="/assets/793948f170c7472dbdb85ebc6ac29889.png"></p><p>非对称加密算法<br><img src="/assets/d6b577ae81f14f3eab990405c76605f4.png"><br>另一种同样不安全的非对称加密算法<br><img src="/assets/c8926dbf6aba445ba261125a263bc08a.png"></p><p>CA 机构参与保证互联网安全<br><img src="/assets/ccb02c8f18c64fad8ffe7a514491cb39.png"><br>查看操作系统的证书<br>cmd &#x3D;&gt; certmgr.msc</p><h2 id="openssl"><a href="#openssl" class="headerlink" title="openssl"></a>openssl</h2><p>openssl 包含：SSL 协议库、应用程序以及密码算法库</p><h2 id="自签名"><a href="#自签名" class="headerlink" title="自签名"></a>自签名</h2><p>openssl</p><h2 id="图形化工具-XCA"><a href="#图形化工具-XCA" class="headerlink" title="图形化工具 XCA"></a>图形化工具 XCA</h2><p>下载地址 <a href="https://www.hohnstaedt.de/xca/index.php/download">https://www.hohnstaedt.de/xca/index.php/download</a></p><h2 id="CA-签名"><a href="#CA-签名" class="headerlink" title="CA 签名"></a>CA 签名</h2><h2 id="域名的申请"><a href="#域名的申请" class="headerlink" title="域名的申请"></a>域名的申请</h2><p>安装 lnmp<br><a href="https://oneinstack.com/">https://oneinstack.com/</a></p><p>bbs 论坛<br><a href="https://discuz.com/">https://discuz.com/</a></p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>Nginx</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>编译原理笔记</title>
    <link href="/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E7%AC%94%E8%AE%B0/"/>
    <url>/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h2 id="没啥用的网课-一些名词解释"><a href="#没啥用的网课-一些名词解释" class="headerlink" title="没啥用的网课(一些名词解释)"></a>没啥用的网课(一些名词解释)</h2><p>冯·诺伊曼 : 二进制, 五大功能, 存储控制<br>翻墙软件 : VPN<br>远程桌面<br>开源操作系统<br>虚拟化: vmware<br>编辑器: vim</p><p><img src="/assets/ee40446bebb34c7183d7de79655b02ac.png"></p><p><img src="/assets/536e584af51845cc9e2e7ca84cc956ef.png"></p><p><img src="/assets/5eeb1b9baefa476fa3721749d621f8e0.png"></p><p><img src="/assets/f98c032ba061450686c8a8f34c68fa33.png"></p><h2 id="考试复习方向"><a href="#考试复习方向" class="headerlink" title="考试复习方向"></a>考试复习方向</h2><blockquote><p>1.编译原理实验环境：参见资料中的实验指导一。 2.模块化的 C 语言程序设计：参见资料中的实验指导二。 3.编译器组成&#x2F;结构：前端（词法分析、语法分析、语义处理）、后端（中间代码生成、代码优化、运行时存储器组织、目标代码生成）、公共模块（符号表、错误处理），对每个功能模块的理解。<br>4.PL&#x2F;0 语言：基本概念，具备使用 PL&#x2F;0 语言编写简单应用程序的能力。 5.文法与语言中的概念：文法、语言、句子、句型、推导、规约、语法树、二义性文法、回溯、无穷语言与有穷文法（递归文法）、文法等价-&gt;文法改造-&gt;文法分类。 6.文法分类，不同语法分析对文法的要求：短语文法（0）、上下文有关文法（1）、上下文无关文法（2）、正规文法（3）；自顶向下语法分析需要 LL（1）文法，自底向上语法分析需要 2 型文法；对不同类型文法的识别；简单文法的句子推导证明。 7.词法分析：理论基础（符号的连接、或者、闭包运算、正则式），对正则式的识别能力，对 NFA、DFA 的理解与应用（顶点集的空弧闭包、顶点集的 a 弧转换）。 8.自顶向下语法分析：<br>概念与基本思路；First 集、Follow 集计算；<br>LL(1)文法的判断；<br>LL（1）文法的改造；<br>编写递归下降 LL(1)语法分析程序。 9.自底向上语法分析：概念与基本思路；<br>根据语法树反向构造句子在符号栈中的移进-规约过程；<br>利用 Action 和 Goto 表构造句子的状态栈变化过程；<br>文法-&gt;扩广文法-&gt;非终结符的左文-&gt;推导式的 LR(0)左文方程-&gt;NFA-&gt;DFA-&gt;生成 Action 和 Goto 表。 10.语义处理：基本概念（数据类型、强语言与弱语言、函数依赖与循环依赖、作用域）；语义分析的错误可能；语法树、抽象语法树、前缀中缀后缀、波兰式、逆波兰式、四元组、三元组、间接三元组等；符号表。 11.运行时存储组织：栈与堆的应用；参数传递。 12.代码优化：窥孔优化（修身）、局部优化（齐家）、循环优化（治国）、全局优化（平天下）；指令调度与循环展开。 13.目标代码生成：目标代码的一般形式；指令选择、寄存器选择、指令调度的关系。</p></blockquote><h2 id="LL-1-语法的判断"><a href="#LL-1-语法的判断" class="headerlink" title="LL(1)语法的判断"></a>LL(1)语法的判断</h2><blockquote><p>LL(1)文法是自上而下的分析方法。</p></blockquote><p><img src="/assets/0628209fa4294be6a05471f8f553c2d8.png"></p><h2 id="LR-0-语法的分析"><a href="#LR-0-语法的分析" class="headerlink" title="LR(0)语法的分析"></a>LR(0)语法的分析</h2><blockquote><p>与 LL（1）相对，LR(0)文法是下而上的分析方法，从左分析，从栈顶归约。</p></blockquote><p><img src="/assets/b07d9e1b85ea495c87ab72b6c04147bf.png"><br><img src="/assets/5995012d56914cbcb18644b23d19d4d1.png"></p><h2 id="三个练习题"><a href="#三个练习题" class="headerlink" title="三个练习题"></a>三个练习题</h2><h3 id="例题-1"><a href="#例题-1" class="headerlink" title="例题 1"></a>例题 1</h3><p>分析 1+(2+3)<br><img src="/assets/adcd4662fc9949b7894fbbbb35853c50.png"><br><img src="/assets/25d51499d8c14d36a898f26fad69727c.png"><br><img src="/assets/66d7338b961c4280993085b84a69efc2.png"></p><h3 id="例题-2"><a href="#例题-2" class="headerlink" title="例题 2"></a>例题 2</h3><p>分析(a+b)<br><img src="/assets/ea0939b8924b40e7a1c09f12d4bc775c.png"><br><img src="/assets/811eb913ccd74371a84ee767142c68ad.png"></p><h3 id="例题-3"><a href="#例题-3" class="headerlink" title="例题 3"></a>例题 3</h3><p>分析 a*(b+c)<br><img src="/assets/a3b7f88f3d1447f0b0c220f6de0d9c9c.png"><br><img src="/assets/59c5d0fc9ebd4d3faa313b2a4cd6a57f.png"></p><h2 id="临时抱佛脚"><a href="#临时抱佛脚" class="headerlink" title="临时抱佛脚"></a>临时抱佛脚</h2><blockquote><p>看的<a href="https://www.bilibili.com/video/BV12a41167j9">1 编译原理求语法树的短语直接短语等等_哔哩哔哩_bilibili</a>这个速成视频<br>学习什么的不重要, 主要是妹子声音好听</p></blockquote><h3 id="1-编译原理求语法树的短语直接短语等等"><a href="#1-编译原理求语法树的短语直接短语等等" class="headerlink" title="1 编译原理求语法树的短语直接短语等等"></a>1 编译原理求语法树的短语直接短语等等</h3><p>**二义性: **如果两种推导方式画出的树不同, 则说明该文法有二义性<br><img src="/assets/ad3adeafedad4dbda2b625c7209f2a00.png"><br><img src="/assets/0604071a96ca4e36911a644a809ecd1d.png"></p><p>一道练习题<br><img src="/assets/0f05007e21384f58b0d20c49f68a8d9a.png"><br>答案<br><img src="/assets/4672c7e2c39645c2ab9e7442c721f8c3.png"></p><h3 id="2-编译原理消除左递归消除回溯"><a href="#2-编译原理消除左递归消除回溯" class="headerlink" title="2 编译原理消除左递归消除回溯"></a>2 编译原理消除左递归消除回溯</h3><h3 id="3-编译原理如何求-first-集和-follow-集"><a href="#3-编译原理如何求-first-集和-follow-集" class="headerlink" title="3 编译原理如何求 first 集和 follow 集"></a>3 编译原理如何求 first 集和 follow 集</h3><h3 id="4-编译原理构造-LL-1-文法完整分析过程"><a href="#4-编译原理构造-LL-1-文法完整分析过程" class="headerlink" title="4 编译原理构造 LL(1)文法完整分析过程"></a>4 编译原理构造 LL(1)文法完整分析过程</h3><h3 id="5-编译原理构造优先关系表"><a href="#5-编译原理构造优先关系表" class="headerlink" title="5 编译原理构造优先关系表"></a>5 编译原理构造优先关系表</h3><p>妈的不会</p><h3 id="6-编译原理构造优先关系图"><a href="#6-编译原理构造优先关系图" class="headerlink" title="6 编译原理构造优先关系图"></a>6 编译原理构造优先关系图</h3><p>妈的不会</p><h3 id="7-编译原理构造-LR-0-分析表-包含构建项目规范族）"><a href="#7-编译原理构造-LR-0-分析表-包含构建项目规范族）" class="headerlink" title="7 编译原理构造 LR(0)分析表(包含构建项目规范族）"></a>7 编译原理构造 LR(0)分析表(包含构建项目规范族）</h3><p><img src="/assets/4fda73c4d9ca47adb4e82c0e7197c513.png"><br><img src="/assets/5f49e4ed3d07401c8f5cadda05c449b3.png"></p><h3 id="12-编译原理根据五元组构建状态转换图即状态转换矩阵"><a href="#12-编译原理根据五元组构建状态转换图即状态转换矩阵" class="headerlink" title="12 编译原理根据五元组构建状态转换图即状态转换矩阵"></a>12 编译原理根据五元组构建状态转换图即状态转换矩阵</h3><p><img src="/assets/94408b1010dd45d78b19ca65bb95a744.png"><br><img src="/assets/94453e3c37a343e49d0c7dee23aa9dc5.png"><br><img src="/assets/4e9ddd57880c48babc53203f5c72c0b9.png"></p><h2 id="逆波兰"><a href="#逆波兰" class="headerlink" title="逆波兰"></a>逆波兰</h2><p>其实就是后缀表达式<br><img src="/assets/55c2c4d5f0b04a5b8e90b9d582ca6c82.png"></p><h2 id="19-届的复习资料"><a href="#19-届的复习资料" class="headerlink" title="19 届的复习资料"></a>19 届的复习资料</h2><p>自行下载看吧<br><a href="https://www.yuque.com/attachments/yuque/0/2023/docx/33666212/1677762164228-cd49a4d2-2ee3-4ac5-96f0-0f01fc87a3fb.docx?_lake_card=%7B%22src%22:%22https://www.yuque.com/attachments/yuque/0/2023/docx/33666212/1677762164228-cd49a4d2-2ee3-4ac5-96f0-0f01fc87a3fb.docx%22,%22name%22:%22%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86.docx%22,%22size%22:172922,%22ext%22:%22docx%22,%22source%22:%22%22,%22status%22:%22done%22,%22download%22:true,%22taskId%22:%22u325a9e67-6aad-489b-82f5-c8b43137727%22,%22taskType%22:%22upload%22,%22type%22:%22application/vnd.openxmlformats-officedocument.wordprocessingml.document%22,%22__spacing%22:%22both%22,%22mode%22:%22title%22,%22id%22:%22ud8d3a5df%22,%22margin%22:%7B%22top%22:true,%22bottom%22:true%7D,%22card%22:%22file%22%7D">编译原理.docx</a><a href="https://www.yuque.com/attachments/yuque/0/2023/docx/33666212/1677762164280-8b13bc30-980c-4a9f-a791-42df5503e225.docx?_lake_card=%7B%22src%22:%22https://www.yuque.com/attachments/yuque/0/2023/docx/33666212/1677762164280-8b13bc30-980c-4a9f-a791-42df5503e225.docx%22,%22name%22:%22%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%A4%8D%E4%B9%A0%E8%B5%84%E6%96%99.docx%22,%22size%22:270076,%22ext%22:%22docx%22,%22source%22:%22%22,%22status%22:%22done%22,%22download%22:true,%22taskId%22:%22ua9bce26d-1e4a-4d0d-9d4e-381718fc182%22,%22taskType%22:%22upload%22,%22type%22:%22application/vnd.openxmlformats-officedocument.wordprocessingml.document%22,%22__spacing%22:%22both%22,%22mode%22:%22title%22,%22id%22:%22ud2e68ade%22,%22margin%22:%7B%22top%22:true,%22bottom%22:true%7D,%22card%22:%22file%22%7D">编译原理复习资料.docx</a></p><h2 id="19-届的补考题"><a href="#19-届的补考题" class="headerlink" title="19 届的补考题"></a>19 届的补考题</h2><p><img src="/assets/8afc40f847124fbcb65a453b81bfef6a.png"></p><ol><li>何谓编译器? 编译器应由那几部分组成? 简述各部分作用<br>答案编译器就是将“一种语言（通常为<a href="https://baike.baidu.com/item/%E9%AB%98%E7%BA%A7%E8%AF%AD%E8%A8%80/299113?fromModule=lemma_inlink">高级语言</a>）”翻译为“另一种语言（通常为低级语言）”的程序</li></ol><p>编译器可分为前端、后端。<br>前端：词法分析、语法分析（自顶向下、自底向上）、语义处理等；<br>后端：运行时存储组织、代码优化、目标代码生成等。</p><ol start="2"><li><p>简述 Linux 操作系统下 C 语言程序的编译过程<br>答案预处理<br>编译<br>汇编<br>链接</p></li><li><p>何谓文法? 举例说明文法的分类<br>答案文法是用来定义语言的规则的，如一般自然语言的句子的结构是：<br>名词短语+动词短语+句号<br>动词短语&#x3D;动词+名词短语<br>文法分 4 种<br>0 型文法: 没有约束, 是个文法就是 0 型文法<br>1 型文法(上下文有关): 右边的长度大于左边<br>2 型文法(上下文无关): 左边必须为非终结符<br>3 型文法(正规文法):<br>设 G &#x3D; (VN,VT,P, S), 若 P 中的每一个产生式的形式都是 A→aB 或 A→a, 其中 A 和 B 都是非终结符, a∈VT*</p></li></ol><p><img src="/assets/f695ecd78d2d42f8b4da1bf579b9a6b6.png"><br><img src="/assets/49a08628b6d4427680bc6b0e278cb64a.png"></p><ol start="5"><li>设文法 G 为: S→aS|bS|c. 请设计其 LR(0)分析表, 请给出输入串 ababc 的分析过程</li></ol><h2 id="20-届期中考试题"><a href="#20-届期中考试题" class="headerlink" title="20 届期中考试题"></a>20 届期中考试题</h2><p>一、 单选题 （共 20 题，100 分）<br><strong>1、在 Linux 下，将 C 语言源程序编译为可执行程序，可使用命令（ ）</strong><br>**（5.0） **<br>A、 gcc<br>B、 touch<br>C、 ls<br>D、 ar<br>正确答案正确答案：A<br>解析：</p><p><strong>2、在 C 语言程序设计中，用来定义功能函数原型、声明数据接口的文件是（ ）</strong><br>**（5.0） **<br>A、 _.c 文件<br>B、 _.h 文件<br>C、 _.cpp 文件<br>D、 _.exe 文件<br>正确答案正确答案：B<br>解析：</p><p><strong>3、从编译的阶段来看，词法分析应属于（ ）</strong><br>**（5.0） **<br>A、 编译的前端<br>B、 编译的中端<br>C、 编译的后端<br>D、 编译的末端</p><p>正确答案正确答案：A<br>解析：</p><p><strong>4、文法是具有“包含”关系的。下列文法中，处于最内层的文法是（ ）</strong><br>**（5.0） **<br>A、 0 型文法<br>B、 上下文有关文法<br>C、 上下文无关文法<br>D、 正规文法</p><p>正确答案正确答案：D<br>解析：</p><p><strong>已知某文法 G：</strong><br><strong>bexpr→bexpr or bterm|bterm</strong><br><strong>bterm→bterm and bfactor | bfactor</strong><br><strong>bfactor→not bfactor|(bexpr)|true |false</strong><br><strong>则以下哪个是该文法中的起始符号（ ）</strong></p><p>**（5.0） **<br>A、 bexpr<br>B、 bterm<br>C、 bfactor<br>D、 not</p><p>正确答案正确答案：A<br>解析：</p><p><strong>6、刘伟跃老师的电话号码是（ ）</strong><br>**（5.0） **<br>A、 13507440668<br>B、 13574404624<br>C、 18874445225<br>D、 18974471616</p><p>正确答案正确答案：B<br>解析：</p><p><strong>7、形如 0<em>10</em>10<em>10</em>的正则表达式，描述的语言是（ ）</strong><br>**（5.0） **<br>A、 以字符’0’、’1’构成的任意字符串。<br>B、 以字符’0’、’1’构成，以字符’0’开始和结束，包含三个字符’1’的任意字符串。<br>C、 以字符’0’、’1’构成，包含至少三个字符’1’的任意字符串。<br>D、 以字符’0’、’1’构成，有且仅有三个字符’1’的任意字符串。</p><p>正确答案正确答案：D<br>解析：</p><p><strong>8、若文法 G:S-&gt;0S1，S-&gt;01。</strong><br><strong>则 00S11 是符合文法的（ ）,000111 则是符合文法的（ ）。</strong><br>**（5.0） **<br>A、 句型、句型<br>B、 句型、句子<br>C、 句子、句型<br>D、 句子、句子</p><p>正确答案正确答案：B<br>解析： 一个句型中既可以包含终结符，又可以包含非终结符，也可能是空串。</p><p><strong>9、若文法 G：S-&gt;cAd，A-&gt;ab，A-&gt;a，在证明输入串 w&#x3D;cabd 是否符合文法时，有如下证明过程：</strong><br>**根据 S-&gt;cAd，将 S 装换为 cAd； **<br><strong>再根据 A-&gt;ab，将 cAd 装换为 cabd，从而证明 w 是符合文法的串。</strong><br><strong>则该证明过程为（ ）。</strong><br>**（5.0） **<br>A、 自上向下的推导语法分析<br>B、 自下向上的规约语法分析</p><p>正确答案正确答案：A<br>解析：</p><p><strong>10、在实现 LL(1)语法分析时，要求文法是正规文法。文法改造中的“消除左递归”，即要能将 P-&gt;Pa|b 的含左递归的文法进行改造，改造成形如（ ）的文法。</strong><br>**（5.0） **<br>A、 P-&gt;bP’，P’-&gt;aP’|ɛ<br>B、 P-&gt;aP’，P’-&gt;bP’|ɛ<br>C、 P-&gt;bP’，P’-&gt;aP’<br>D、 P-&gt;aP’，P’-&gt;bP’</p><p>正确答案正确答案：A<br>解析：</p><p><strong>11、在 Linux 系统下，若要对 C 语言程序进行静态编译（即编译时使用-static 参数），需要安装的组件是（ ）。</strong><br>**（5.0） **<br>A、 glibc-static<br>B、 mysql<br>C、 qt-devel<br>D、 libgl</p><p>正确答案正确答案：A<br>解析：</p><p><strong>12、在如下的 C 语言源程序中，识别的词法单元有（ ）个。</strong><br><strong>main()</strong><br><strong>{</strong><br><strong>int x;</strong><br><strong>x &#x3D; 1+2*3;</strong><br><strong>}</strong><br>**（5.0） **<br>A、 6<br>B、 16<br>C、 8<br>D、 18</p><p>正确答案正确答案：B<br>解析：</p><p><strong>13、在编译器设计模型中，符号表是贯穿词法分析、语法分析、语义处理、代码优化、目标代码生成等过程的公共模块，符号表中符号的唯一标识是（ ）。</strong><br>**（5.0） **<br>A、 符号名<br>B、 符号类型<br>C、 符号存储类别<br>D、 符号作用域</p><p>正确答案正确答案：A<br>解析：</p><p><strong>14、若有文法 G：S-&gt;aA|bB，aA-&gt;ab，bB-&gt;bA，则该文法是（ ）。</strong><br>**（5.0） **<br>A、 0 型文法<br>B、 1 型文法<br>C、 2 型文法<br>D、 3 型文法</p><p>正确答案正确答案：B<br>解析：</p><p><strong>15、若文法 G：S-&gt;cAd，A-&gt;ab，A-&gt;a，在证明输入串 w&#x3D;cabd 是否符合文法时：</strong><br><strong>先利用 A-&gt;ab，将 cabd 转换为 cAd；</strong><br><strong>再利用 S-&gt;cAd，将 cAd 转换为 S，从而证明输入串符合文法。</strong><br><strong>则该证明过程为（ ）。</strong></p><p>**（5.0） **<br>A、 自上而下的推导证明<br>B、 自下而上的规约证明</p><p>正确答案正确答案：B<br>解析：</p><p><strong>16、形如 a(a|b)*b 的正则表达式，表达的是（ ）。</strong><br>**（5.0） **<br>A、 由字符’a’、’b’字符构成的任意字符串<br>B、 由字符’a’、’b’字符构成，以’a’开始，’b’结束的所有字符<br>C、 由字符’a’、’b’字符构成，以’a’开始的所有字符串<br>D、 由字符’a’、’b’字符构成，以’b’结束的所有字符串</p><p>正确答案正确答案：B<br>解析：</p><p><strong>17、在如下图的 NFA 中，状态’5’的 ɛ 闭包是（ ）</strong><br><img src="/assets/416919a7a0cc4b828021c1be24dc0075.png"><br>**（5.0） **<br>A、 集合{1,5,6,2}<br>B、 集合{5,6,2}<br>C、 集合{5,6}<br>D、 集合{5,6,2,3}</p><p>正确答案正确答案：B<br>解析：</p><p><strong>18、在如图的 NFA 中，状态集{1,2}的 a 弧转换结果为（ ）</strong><br><img src="/assets/76652150422a48728c0ba1515bf37c1a.png"><br>**（5.0） **<br>A、 {5,3}<br>B、 {5,3,4}<br>C、 {3,4,5,6,7,8}<br>D、 {2,3,4,5,6,7,8}</p><p>正确答案正确答案：D<br>解析：</p><p><strong>19、在进行 LL(1)语法分析时，文法中如有 A-&gt;aB，A-&gt;aCd 的规则时，需要进行提取左公因子的文法改造，即将该文法改造为（ ）。</strong><br>**（5.0） **<br>A、<br>A-&gt;aA’，<br>A’-&gt;B|Cd<br>B、<br>A-&gt;bA’，<br>A’-&gt;aA’|ɛ</p><p>正确答案正确答案：A<br>解析：</p><p><strong>20、在判断一个文法是否为 LL(1)文法时，以下描述不正确的是（ ）。</strong><br>**（5.0） **<br>A、 若存在 A-&gt;α|β 的文法，即文法定义中，存在某非终结符可以推导出多个不同句型，则需要计算 First(α)和 First(β)集合，即 A 推导出的不同句型，各句型的 First 集应该没有交集；若 A 推导出的句型存在 ɛ，则还需要计算 A 的 Follow 集合，A 推导出的句型的 First 集和 A 的 Follow 集没有交集。<br>B、 First(A)集，其实质就是，非终结符 A 所推导出的句型中，所有可能出现在句型首部的文法终结符的集合（包含 ɛ）。<br>C、 Follow(B)集，定义为：对于文法的起始符号 S，Follow(S)&#x3D;</p>]]></content>
    
    
    <categories>
      
      <category>编译原理</category>
      
    </categories>
    
    
    <tags>
      
      <tag>编译原理</tag>
      
      <tag>计算机基础课</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBoot</title>
    <link href="/Java/SpringBoot/"/>
    <url>/Java/SpringBoot/</url>
    
    <content type="html"><![CDATA[<h2 id="创建-SpringBoot-项目"><a href="#创建-SpringBoot-项目" class="headerlink" title="创建 SpringBoot 项目"></a>创建 SpringBoot 项目</h2><p>在某些时候<a href="https://start.spring.io/">https://start.spring.io</a>这个网站访问不了, 同样 idea 也因为开 VPN 会莫名抽风, 而导致创建不了 SpringBoot 项目, 这就会显得非常蛋疼<br>以下是针对于开了 VPN 抽风的情况, 当然也可以通过更换仓库地址, 把 start.spring.io 换成 start.aliyun.io<br>ping 也 ping 不通<br><img src="/assets/310f45ef94f84c3ea026cb15f411ce8c.png"><br>先查看代理的地址和端口<br><img src="/assets/fbb3b9440482453ca552c2aad0dc87be.png"><br>然后打开 idea 的 setting-Appearance&amp;Behavior - System Settings - HTTP Proxy - Manual proxy configuration, 配置好当前代理的地址和端口号, 然后点击 Check connection 测试<a href="https://start.spring.io/">https://start.spring.io</a>是否能连通, 多按测试两次按理应该会成功的<br><img src="/assets/7855928574be479b8131d47103fcd1f6.png"></p><p>创建 SpringBoot, 选择 Spring Initializr, 填好对应的 Group 和 Artifact, 注意 Java 和电脑中安装的 JDK 的版本保持一致<br><img src="/assets/2446e14f91e34a59ac308f8bc63aad04.png"><br>然后这里可以选择一些常见的依赖例如 thymeleaf, devtools, lombok, configuration processor,<br>spring web, mysql 等等, 然后点击 Finish<br><img src="/assets/6da36d75ffcf4294930b20796f42c972.png"><br>这样就完整的创建好的 SpringBoot 项目<br><img src="/assets/1f0d7402375f46c5a8bf80e8a3632184.png"></p><h2 id="Thymeleaf"><a href="#Thymeleaf" class="headerlink" title="Thymeleaf"></a>Thymeleaf</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml">加上在maven的配置文件pom.xml中加入一下依赖引入Thymeleaf<br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-comment">&lt;!--   &lt;version&gt;2.7.4&lt;/version&gt; --&gt;</span><br><span class="hljs-comment">&lt;!--   version并不一定是这一个版本, springboot中内置了thymeleaf的版本号 --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>需要在html的文件中引入xmlns:th=&quot;http://www.thymeleaf.org&quot;<br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span> <span class="hljs-attr">xmlns:th</span>=<span class="hljs-string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">&quot;$&#123;msg&#125;&quot;</span>&gt;</span>哈哈<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>获取请求域中共享数据使用$符号<br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;$&#123;link&#125;&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;www.haha.com&quot;</span>&gt;</span>去百度<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/link&#125;&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;www.haha.com&quot;</span>&gt;</span>去百度<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>请求域中的连接地址, 也是使用$符号, @符号时给用来拼接地址用的 th:each=&quot;num :<br>$&#123;#numbers.sequence(from, to)&#125;&quot; th:each=&quot;num : $&#123;#numbers.sequence(1,<br>users.pages)&#125;&quot; 用来创建一个数组遍历用的 @&#123;/dynamic_table(pn=$&#123;num&#125;)&#125;<br>使用小括号用来拼接参数 th:href=&quot;@&#123;&#x27;/employee/page/&#x27; + $&#123;page.prePage&#125;&#125;<br>或者使用字符串的拼接方式来写 行内写法 [[$&#123;session.loginUser.userName&#125;]]<br>在application.yaml访问路径设置路径前缀, 这样设置之后, 访问都需要带上/world 例如,<br>原先是 http://localhost:8080/ 现在是 http://localhost:8080/world server:<br>servlet: context-path: /world<br></code></pre></td></tr></table></figure><h2 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h2><p>HandlerInterceptor 接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.boot.interceptor;<br><br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.ModelAndView;<br><br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpSession;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 登录检查</span><br><span class="hljs-comment"> * 1. 配置好拦截器要拦截哪些请求</span><br><span class="hljs-comment"> * 2. 把这些配置放在容器中</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 目标方法执行之前</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> request</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> response</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> handler</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">requestURI</span> <span class="hljs-operator">=</span> request.getRequestURI();<br>        log.info(<span class="hljs-string">&quot;拦截的请求路径是&#123;&#125;&quot;</span>, requestURI);<br><br>        log.info(<span class="hljs-string">&quot;preHandle&#123;&#125;&quot;</span>, requestURI);<br><span class="hljs-comment">/*</span><br><span class="hljs-comment">        也是获取请求的路径用的一个方法, 和上面的一样</span><br><span class="hljs-comment">        String servletPath = request.getServletPath();</span><br><span class="hljs-comment">        log.info(&quot;&#123;&#125;&quot;, servletPath);*/</span><br><br>        <span class="hljs-comment">// 登录检查逻辑</span><br>        <span class="hljs-type">HttpSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> request.getSession();<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">loginUser</span> <span class="hljs-operator">=</span> session.getAttribute(<span class="hljs-string">&quot;loginUser&quot;</span>);<br>        <span class="hljs-keyword">if</span> (loginUser != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">// 放行</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>        <span class="hljs-comment">// 拦截住, 未登录, 跳转到登录页</span><br><span class="hljs-comment">/*        session.setAttribute(&quot;msg&quot;, &quot;请先登录&quot;);</span><br><span class="hljs-comment">        response.sendRedirect(&quot;/&quot;);*/</span><br><br>        request.setAttribute(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;请先登录&quot;</span>);<br>        request.getRequestDispatcher(<span class="hljs-string">&quot;/&quot;</span>).forward(request, response);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 目标方法执行完成之后</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> request</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> response</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> handler</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> modelAndView</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        log.info(<span class="hljs-string">&quot;postHandle&#123;&#125;&quot;</span>, modelAndView);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 页面渲染之后</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> request</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> response</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> handler</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> ex</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterCompletion</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        log.info(<span class="hljs-string">&quot;afterCompletion&#123;&#125;&quot;</span>, ex);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>配置拦截器</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.boot.config;<br><br><span class="hljs-keyword">import</span> com.atguigu.boot.interceptor.LoginInterceptor;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 1. 编写一个拦截器实现HandlerInterceptor接口</span><br><span class="hljs-comment"> * 2. 拦截器注册到容器中(实现WebMvcConfigurer的addInterceptors)</span><br><span class="hljs-comment"> * 3. 指定拦截规则(如果是拦截所有, 静态资源也会被拦截)</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AdminWebConfig</span>  <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addInterceptors</span><span class="hljs-params">(InterceptorRegistry registry)</span> &#123;<br>        registry.addInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LoginInterceptor</span>())<br>                .addPathPatterns(<span class="hljs-string">&quot;/**&quot;</span>) <span class="hljs-comment">// 所有请求都被拦截包括静态资源</span><br>                .excludePathPatterns(<span class="hljs-string">&quot;/login&quot;</span>, <span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-string">&quot;/css/**&quot;</span>, <span class="hljs-string">&quot;/js/**&quot;</span>, <span class="hljs-string">&quot;/images/**&quot;</span>, <span class="hljs-string">&quot;/fonts/**&quot;</span>); <span class="hljs-comment">// 方形的请求</span><br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>3、拦截器原理<br>1、根据当前请求，找到<strong>HandlerExecutionChain【</strong>可以处理请求的 handler 以及 handler 的所有 拦截器】<br>2、先来**顺序执行 **所有拦截器的 preHandle 方法</p><ul><li>1、如果当前拦截器 prehandler 返回为 true。则执行下一个拦截器的 preHandle</li><li>2、如果当前拦截器返回为 false。直接 倒序执行所有已经执行了的拦截器的 afterCompletion；</li></ul><p><strong>3、如果任何一个拦截器返回 false。直接跳出不执行目标方法</strong><br><strong>4、所有拦截器都返回 True。执行目标方法</strong><br><strong>5、倒序执行所有拦截器的 postHandle 方法。</strong><br>**6、前面的步骤有任何异常都会直接倒序触发 **afterCompletion<br>7、页面成功渲染完成以后，也会倒序触发 afterCompletion</p><h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs html">method要是post请求才能上传文件 enctype=&quot;multipart/form-data&quot;<br>实现文件上传的时候form表单需要指定enctype这个属性<br>多文件上传需要在input标签中加上multiple属性, 表示多个文件上传<br>单文件上传不需要指定multiple<br><span class="hljs-tag">&lt;<span class="hljs-name">form</span></span><br><span class="hljs-tag">  <span class="hljs-attr">role</span>=<span class="hljs-string">&quot;form&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">th:action</span>=<span class="hljs-string">&quot;@&#123;/upload&#125;&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span></span><br><span class="hljs-tag">&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;exampleInputFile&quot;</span>&gt;</span>头像<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;headerImg&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;exampleInputFile&quot;</span> /&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;exampleInputFile&quot;</span>&gt;</span>生活照<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;photos&quot;</span> <span class="hljs-attr">multiple</span> /&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;/upload&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">upload</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;email&quot;)</span> String email,</span><br><span class="hljs-params">                     <span class="hljs-meta">@RequestParam(&quot;username&quot;)</span> String username,</span><br><span class="hljs-params">                     <span class="hljs-meta">@RequestPart</span> MultipartFile headerImg,</span><br><span class="hljs-params">                     <span class="hljs-meta">@RequestPart</span> MultipartFile[] photos)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>    <span class="hljs-comment">// MultipartFile是用来接收文件的类型的, 使用@RequestPart这个注解</span><br>    log.info(<span class="hljs-string">&quot;email=&#123;&#125;, username=&#123;&#125;, headerImg=&#123;&#125;, photos=&#123;&#125;&quot;</span>,<br>            email, username, headerImg.getSize(), photos.length);<br><br>    <span class="hljs-keyword">if</span> (!headerImg.isEmpty()) &#123;<br>        <span class="hljs-comment">// 保存到文件服务器 , OSS服务器</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">originalFilename</span> <span class="hljs-operator">=</span> headerImg.getOriginalFilename();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> headerImg.getName();<br>        <span class="hljs-comment">// getName仅仅只是获取到name这个属性, 并不会获取到文件的原生名字</span><br>        <span class="hljs-comment">// 想要获取到文件原生的名字可以使用getOriginalFilename这个方法</span><br>        log.info(<span class="hljs-string">&quot;originalFilename = &#123;&#125;, name = &#123;&#125;&quot;</span>, originalFilename, name);<br>        headerImg.transferTo(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;E:\\upload\\&quot;</span> + originalFilename));<br>    &#125;<br><br>    <span class="hljs-keyword">for</span> (MultipartFile photo : photos) &#123;<br>        <span class="hljs-keyword">if</span> (!photo.isEmpty()) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">originalFilename</span> <span class="hljs-operator">=</span> photo.getOriginalFilename();<br>            <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> photo.getName();<br>            log.info(<span class="hljs-string">&quot;originalFilename = &#123;&#125;, name = &#123;&#125;&quot;</span>, originalFilename, name);<br>            photo.transferTo(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;E:\\upload\\&quot;</span> + originalFilename));<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;main&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">配置文件上传大小的,</span> <span class="hljs-string">单个文件最大上限设置10MB</span><br><span class="hljs-attr">单次请求最大100MB</span><br><span class="hljs-attr">spring.servlet.multipart.max-file-size</span>=<span class="hljs-string">10MB</span><br><span class="hljs-attr">spring.servlet.multipart.max-request-size</span>=<span class="hljs-string">100MB</span><br></code></pre></td></tr></table></figure><h2 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h2><h2 id="Web-原生组件注入"><a href="#Web-原生组件注入" class="headerlink" title="Web 原生组件注入"></a>Web 原生组件注入</h2><h3 id="1-使用-Servlet-API"><a href="#1-使用-Servlet-API" class="headerlink" title="1.使用 Servlet API"></a>1.使用 Servlet API</h3><p>@ServletComponentScan(basePackages &#x3D; “com.atguigu.boot”)<br>指定原生 Servlet 组件都放在哪里<br>@WebServlet(urlPatterns &#x3D; “&#x2F;my”)<br>效果: 直接响应, 没有 Spring 拦截器<br>@WebFilter(urlPatterns &#x3D; {“&#x2F;css&#x2F;<em>“, “&#x2F;images&#x2F;</em>“})<br>@WebListener<br>推荐可以使用这种方式:</p><p>&#x2F;*是 Servlet 的写法<br>&#x2F;**是 Spring 家族的写法</p><h3 id="2-使用-RegistrationBean"><a href="#2-使用-RegistrationBean" class="headerlink" title="2.使用 RegistrationBean"></a>2.使用 RegistrationBean</h3><p><code>ServletRegistrationBean</code>, <code>FilterRegistrationBean</code>, and <code>ServletListenerRegistrationBean</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyRegisterConfig</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> ServletRegistrationBean <span class="hljs-title function_">myServlet</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">MyServlet</span> <span class="hljs-variable">myServlet</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyServlet</span>();<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServletRegistrationBean</span>(myServlet, <span class="hljs-string">&quot;/my&quot;</span>, <span class="hljs-string">&quot;/my02&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> FilterRegistrationBean <span class="hljs-title function_">myFilter</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">MyFilter</span> <span class="hljs-variable">myFilter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyFilter</span>();<br>        <span class="hljs-comment">//return new FilterRegistrationBean(myFilter, myServlet());</span><br>        <span class="hljs-type">FilterRegistrationBean</span> <span class="hljs-variable">filterRegistrationBean</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FilterRegistrationBean</span>(myFilter);<br>        filterRegistrationBean.setUrlPatterns(Arrays.asList(<span class="hljs-string">&quot;/my&quot;</span>, <span class="hljs-string">&quot;/css/*&quot;</span>));<br>        <span class="hljs-keyword">return</span> filterRegistrationBean;<br>    &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> ServletListenerRegistrationBean <span class="hljs-title function_">myListener</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">MyServletContextListener</span> <span class="hljs-variable">myServletContextListener</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyServletContextListener</span>();<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServletListenerRegistrationBean</span>(myServletContextListener);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="数据访问"><a href="#数据访问" class="headerlink" title="数据访问"></a>数据访问</h2><p>1.导入 jdbc 场景</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-jdbc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/ssm&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;serverTimezone=UTC%2B8</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br><span class="hljs-comment"># 配置数据库的url...</span><br><span class="hljs-comment"># serverTimezone可以就设置为UTC</span><br></code></pre></td></tr></table></figure><h2 id="使用-Druid-数据源"><a href="#使用-Druid-数据源" class="headerlink" title="使用 Druid 数据源"></a>使用 Druid 数据源</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.17<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>配置示例</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/db_account</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.jdbc.Driver</span><br><br>    <span class="hljs-attr">druid:</span><br>      <span class="hljs-attr">aop-patterns:</span> <span class="hljs-string">com.atguigu.admin.*</span> <span class="hljs-comment">#监控SpringBean</span><br>      <span class="hljs-attr">filters:</span> <span class="hljs-string">stat,wall</span> <span class="hljs-comment"># 底层开启功能，stat（sql监控），wall（防火墙）</span><br><br>      <span class="hljs-attr">stat-view-servlet:</span> <span class="hljs-comment"># 配置监控页功能</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>        <span class="hljs-attr">login-username:</span> <span class="hljs-string">admin</span><br>        <span class="hljs-attr">login-password:</span> <span class="hljs-string">admin</span><br>        <span class="hljs-attr">resetEnable:</span> <span class="hljs-literal">false</span><br><br>      <span class="hljs-attr">web-stat-filter:</span> <span class="hljs-comment"># 监控web</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>        <span class="hljs-attr">urlPattern:</span> <span class="hljs-string">/*</span><br>        <span class="hljs-attr">exclusions:</span> <span class="hljs-string">&quot;*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*&quot;</span><br><br>      <span class="hljs-attr">filter:</span><br>        <span class="hljs-attr">stat:</span> <span class="hljs-comment"># 对上面filters里面的stat的详细配置</span><br>          <span class="hljs-attr">slow-sql-millis:</span> <span class="hljs-number">1000</span><br>          <span class="hljs-attr">logSlowSql:</span> <span class="hljs-literal">true</span><br>          <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>        <span class="hljs-attr">wall:</span><br>          <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>          <span class="hljs-attr">config:</span><br>            <span class="hljs-attr">drop-table-allow:</span> <span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure><h2 id="整合-MyBatis-操作"><a href="#整合-MyBatis-操作" class="headerlink" title="整合 MyBatis 操作"></a>整合 MyBatis 操作</h2><p><a href="https://github.com/mybatis">https://github.com/mybatis</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># 配置mybatis规则</span><br><span class="hljs-attr">mybatis:</span><br>  <span class="hljs-attr">config-location:</span> <span class="hljs-string">classpath:mybatis/mybatis-config.xml</span> <span class="hljs-comment"># 全局配置文件位置</span><br>  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">classpath:mybatis/mapper/*.xml</span> <span class="hljs-comment">#sql映射文件位置</span><br><br><span class="hljs-string">Mapper接口</span> <span class="hljs-string">--&gt;</span> <span class="hljs-string">绑定xml</span><br><span class="hljs-string">&lt;mapper</span> <span class="hljs-string">namespace=&quot;com.atguigu.boot.mapper.AccountMapper&quot;&gt;</span><br><br>    <span class="hljs-string">&lt;!--public</span> <span class="hljs-string">Account</span> <span class="hljs-string">getAccount(Long</span> <span class="hljs-string">id);--&gt;</span><br>    <span class="hljs-string">&lt;select</span> <span class="hljs-string">id=&quot;getAccount&quot;</span> <span class="hljs-string">resultType=&quot;com.atguigu.boot.bean.Account&quot;&gt;</span><br>        <span class="hljs-string">select</span> <span class="hljs-string">*</span> <span class="hljs-string">from</span> <span class="hljs-string">account_tbl</span> <span class="hljs-string">where</span> <span class="hljs-string">id</span> <span class="hljs-string">=</span> <span class="hljs-comment">#&#123;id&#125;;</span><br>    <span class="hljs-string">&lt;/select&gt;</span><br><span class="hljs-string">&lt;/mapper&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># 配置mybatis规则</span><br><span class="hljs-attr">mybatis:</span><br>  <span class="hljs-comment">#  config-location: classpath:mybatis/mybatis-config.xml</span><br>  <span class="hljs-comment"># 可以不写全局配置文件, 所有全局配置文件的配置都放在configuration配置项中即可</span><br>  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">classpath:mybatis/mapper/*.xml</span><br>  <span class="hljs-attr">configuration:</span><br>    <span class="hljs-attr">map-underscore-to-camel-case:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><ul><li>导入 mybatis 官方 starter</li><li>编写 mapper 接口, 标注@Mapper 注解</li><li>编写 sql 映射文件并绑定 mapper 接口</li><li>在 application.yaml 中制定 Mapper 配置文件的位置, 以及制定全局配置文件的信息(建议: 配置在 mybatis.configuration)</li></ul><p>使用 MyBatisPlus 的依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>最新版本<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>分页插件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.pagehelper<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>pagehelper<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>最新版本<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="redis-配置"><a href="#redis-配置" class="headerlink" title="redis 配置"></a>redis 配置</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>在 yaml 中配置 redis 的连接 url</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br><span class="hljs-attr">redis:</span><br>  <span class="hljs-attr">url:</span> <span class="hljs-string">redis://192.168.1.100:6379</span><br> <span class="hljs-comment">#url: redis://root:atguigu@192.168.1.100:6379</span><br><span class="hljs-comment"># redis://账户:密码@ip:端口</span><br><span class="hljs-comment"># 没有设置redis密码的时候可以省略&quot;账户:密码&quot;</span><br><br>  <span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.100</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-comment"># 或者把url分开成host, port, password三个参数来连接也是可以的</span><br></code></pre></td></tr></table></figure><p>RedisTemplate 与 Lettuce</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span><br>StringRedisTemplate redisTemplate;<br><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testRedis</span><span class="hljs-params">()</span> &#123;<br>    ValueOperations&lt;String, String&gt; operations = redisTemplate.opsForValue();<br>    operations.set(<span class="hljs-string">&quot;hello&quot;</span>, <span class="hljs-string">&quot;world&quot;</span>);<br>    <span class="hljs-type">String</span> <span class="hljs-variable">hello</span> <span class="hljs-operator">=</span> operations.get(<span class="hljs-string">&quot;hello&quot;</span>);<br>    System.out.println(hello);<br>&#125;<br></code></pre></td></tr></table></figure><p>切换 jedis</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>redis.clients<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jedis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br><span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.100</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-attr">client-type:</span> <span class="hljs-string">jedis</span><br>    <span class="hljs-comment"># client-type: jedis</span><br>    <span class="hljs-comment"># jedis:</span><br>    <span class="hljs-comment">#   pool:</span><br>    <span class="hljs-comment">#     max-active:</span><br>    <span class="hljs-comment"># client-type: lettuce</span><br>    <span class="hljs-comment"># lettuce:</span><br>    <span class="hljs-comment">#   pool:</span><br>    <span class="hljs-comment">#     max-active:</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java">    <span class="hljs-meta">@Autowired</span><br>    RedisConnectionFactory redisConnectionFactory;<br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testRedis</span><span class="hljs-params">()</span> &#123;<br>        ValueOperations&lt;String, String&gt; operations = redisTemplate.opsForValue();<br>        operations.set(<span class="hljs-string">&quot;hello&quot;</span>, <span class="hljs-string">&quot;world&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">hello</span> <span class="hljs-operator">=</span> operations.get(<span class="hljs-string">&quot;hello&quot;</span>);<br>        System.out.println(hello);<br><br>        System.out.println(redisConnectionFactory.getClass());<br>    &#125;<br><br>输出结果<br>world<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">org</span>.springframework.data.redis.connection.jedis.JedisConnectionFactory<br></code></pre></td></tr></table></figure><p>一个小 demo, 用来记录用户访问了当前 uri 的次数</p><p>配置拦截器</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisUrlCountInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    StringRedisTemplate redisTemplate;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">uri</span> <span class="hljs-operator">=</span> request.getRequestURI();<br>        <span class="hljs-comment">// 默认每次访问当前uri就会计数加1</span><br>        redisTemplate.opsForValue().increment(uri);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AdminWebConfig</span>  <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Filter, Interceptor 几乎拥有相同的功能?</span><br><span class="hljs-comment">     * 1. Filter是Servlet定义的原生组件, 好处, 脱离Spring应用也能使用</span><br><span class="hljs-comment">     * 2. Interceptor是Spring定义的接口, 可以使用Spring的自动装配等功能</span><br><span class="hljs-comment">     */</span><br><br>    <span class="hljs-meta">@Autowired</span><br>    RedisUrlCountInterceptor redisUrlCountInterceptor;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addInterceptors</span><span class="hljs-params">(InterceptorRegistry registry)</span> &#123;<br>        registry.addInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LoginInterceptor</span>())<br>                .addPathPatterns(<span class="hljs-string">&quot;/**&quot;</span>) <span class="hljs-comment">// 所有请求都被拦截包括静态资源</span><br>                .excludePathPatterns(<span class="hljs-string">&quot;/login&quot;</span>, <span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-string">&quot;/css/**&quot;</span>, <span class="hljs-string">&quot;/js/**&quot;</span>, <span class="hljs-string">&quot;/images/**&quot;</span>, <span class="hljs-string">&quot;/fonts/**&quot;</span>); <span class="hljs-comment">// 放行的请求</span><br><br>        registry.addInterceptor(redisUrlCountInterceptor)<br>                .addPathPatterns(<span class="hljs-string">&quot;/**&quot;</span>)<br>                .excludePathPatterns(<span class="hljs-string">&quot;/login&quot;</span>, <span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-string">&quot;/css/**&quot;</span>, <span class="hljs-string">&quot;/js/**&quot;</span>, <span class="hljs-string">&quot;/images/**&quot;</span>, <span class="hljs-string">&quot;/fonts/**&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java">    <span class="hljs-meta">@Autowired</span><br>    StringRedisTemplate redisTemplate;<br><br><span class="hljs-meta">@GetMapping(&quot;/main.html&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">mainPage</span><span class="hljs-params">(HttpSession session, Model model)</span> &#123;<br><br>        log.info(<span class="hljs-string">&quot;当前方法&#123;&#125;&quot;</span>, <span class="hljs-string">&quot;mainPage&quot;</span>);<br>        <span class="hljs-comment">// 是否登录, 拦截器, 过滤器</span><br><span class="hljs-comment">/*        if (session.getAttribute(&quot;loginUser&quot;) == null) &#123;</span><br><span class="hljs-comment">            model.addAttribute(&quot;msg&quot;, &quot;请先登录账户&quot;);</span><br><span class="hljs-comment">            return &quot;login&quot;;</span><br><span class="hljs-comment">        &#125; else &#123;</span><br><span class="hljs-comment">            // 回到登录页面</span><br><span class="hljs-comment">            return &quot;main&quot;;</span><br><span class="hljs-comment">        &#125;*/</span><br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().get(<span class="hljs-string">&quot;/main.html&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">s1</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().get(<span class="hljs-string">&quot;/sql&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">s2</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().get(<span class="hljs-string">&quot;/dynamic_table&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">s3</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().get(<span class="hljs-string">&quot;/error&quot;</span>);<br>        model.addAttribute(<span class="hljs-string">&quot;mainCount&quot;</span>, s);<br>        model.addAttribute(<span class="hljs-string">&quot;sqlCount&quot;</span>, s1);<br>        model.addAttribute(<span class="hljs-string">&quot;dynamic_tableCount&quot;</span>, s2);<br>        model.addAttribute(<span class="hljs-string">&quot;errorCount&quot;</span>, s3);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;main&quot;</span>;<br>    &#125;<br></code></pre></td></tr></table></figure><h2 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@DisplayName(&quot;junit5功能测试类&quot;)</span><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Junit5Test</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    JdbcTemplate jdbcTemplate;<br><br>    <span class="hljs-meta">@DisplayName(&quot;测试displayname注解&quot;)</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testDisplayName</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-number">1</span>);<br>        System.out.println(jdbcTemplate);<br>    &#125;<br><br>    <span class="hljs-meta">@Disabled</span><br>    <span class="hljs-meta">@DisplayName(&quot;测试方法2&quot;)</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">test2</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-number">1</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@RepeatedTest(5)</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">test3</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-number">3</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 规定方法超时时间, 超出时间测试出异常</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> InterruptedException</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-meta">@Timeout(value = 500, unit = TimeUnit.MILLISECONDS)</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testTimeout</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>        Thread.sleep(<span class="hljs-number">600</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@BeforeEach</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testBeforeEach</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;测试就要开始了...&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@AfterEach</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testAfterEach</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;测试结束了...&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@BeforeAll</span><br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testBeforeAll</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;所有测试就要开始了...&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@AfterAll</span><br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testAfterAll</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;所有测试已经结束了...&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>打开 Java 监控和管理控制台</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">cmd<br>C:\Users\肉豆蔻吖&gt;jconsole<br></code></pre></td></tr></table></figure><h2 id="application-profile-功能"><a href="#application-profile-功能" class="headerlink" title="application-profile 功能"></a>application-profile 功能</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">  ○ 命令行激活：java -jar xxx.jar --spring.profiles.active=prod  --person.name=haha<br>    ■ 修改配置文件的任意值，命令行优先<br>E:\Code\SpringBoot\boot-09-features-profiles\target&gt;java -jar boot-09-features-profiles-0.0.1-SNAPSHOT.jar --spring.profiles.active=<span class="hljs-built_in">test</span><br><br>E:\Code\SpringBoot\boot-09-features-profiles\target&gt;java -jar boot-09-features-profiles-0.0.1-SNAPSHOT.jar --spring.profiles.active=<span class="hljs-built_in">test</span> --person.name=hello<br></code></pre></td></tr></table></figure><h2 id="跨域-CORS"><a href="#跨域-CORS" class="headerlink" title="跨域 CORS"></a>跨域 CORS</h2><p><img src="/assets/14278578a6154c339d5df7d8d8ce18e1.png"><br><img src="/assets/196974a7747447d5aa68038d0b5fdaeb.png"></p><p>前端访问的页面加</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;meta http-equiv=<span class="hljs-string">&quot;Access-Control-Allow-Origin&quot;</span> content=<span class="hljs-string">&quot;*&quot;</span>&gt;<br></code></pre></td></tr></table></figure><p>后端采用注解<br>参考:</p><ul><li><a href="https://blog.csdn.net/guo_qiangqiang/article/details/88430626">https://blog.csdn.net/guo_qiangqiang&#x2F;article&#x2F;details&#x2F;88430626</a></li><li><a href="https://blog.csdn.net/qq_17011423/article/details/79169112">https://blog.csdn.net/qq_17011423&#x2F;article&#x2F;details&#x2F;79169112</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>SpringBoot</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
