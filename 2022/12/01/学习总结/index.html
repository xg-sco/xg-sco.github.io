

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="肉豆蔻吖">
  <meta name="keywords" content="">
  
    <meta name="description" content="编译原理是一套复杂庞大的偏底层的知识体系。目的是将高级程序设计语言转换成计算机硬件能识别的机器语言，以便计算机进行处理。本文将给大家提炼介绍整体的流程，以及具体深挖部分细节流程。主要会围绕以下几个方面进行介绍：  代码到底是什么 什么是编译 计算机如何将代码转换成可以运行的目标程序(重点介绍) 计算机怎么理解机器语言并落实在硬件上执行 JS 代码的编译解析执行过程  代码到底是什么如果你是内行。代">
<meta property="og:type" content="article">
<meta property="og:title" content="学习总结">
<meta property="og:url" content="http://roudoukou.github.io/2022/12/01/%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/index.html">
<meta property="og:site_name" content="xiamu">
<meta property="og:description" content="编译原理是一套复杂庞大的偏底层的知识体系。目的是将高级程序设计语言转换成计算机硬件能识别的机器语言，以便计算机进行处理。本文将给大家提炼介绍整体的流程，以及具体深挖部分细节流程。主要会围绕以下几个方面进行介绍：  代码到底是什么 什么是编译 计算机如何将代码转换成可以运行的目标程序(重点介绍) 计算机怎么理解机器语言并落实在硬件上执行 JS 代码的编译解析执行过程  代码到底是什么如果你是内行。代">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/roudoukou/roudoukou.github.io/blog-img/FkGuU0HqFd5AZwIF7taEVgSkziAT.webp">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/roudoukou/roudoukou.github.io/blog-img/Fn6opSQJUJsSU2WiyuQMVZWbChcE.webp">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/roudoukou/roudoukou.github.io/blog-img/Fgo3udD-0xWgYQaL0hOYeVnvO7MH.webp">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/roudoukou/roudoukou.github.io/blog-img/Fg0cLqKB6dObLEOyCb2oHDAwliKT.webp">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/roudoukou/roudoukou.github.io/blog-img/FlY_ekp4qHFLMQcLWdcwqNIzn3U_.webp">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/roudoukou/roudoukou.github.io/blog-img/FugCFVaLPt3KEmb4gZJB8jCZ02y-.webp">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/roudoukou/roudoukou.github.io/blog-img/Fvlpv2o5X1kdMmk_4SkJaWUdb4vz.webp">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/roudoukou/roudoukou.github.io/blog-img/FmtaeAwGtQXBho7zHYm2JNpg1RZC.webp">
<meta property="article:published_time" content="2022-12-01T03:51:57.000Z">
<meta property="article:modified_time" content="2023-02-27T12:54:04.126Z">
<meta property="article:author" content="肉豆蔻吖">
<meta property="article:tag" content="计算机基础">
<meta property="article:tag" content="编译原理">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/roudoukou/roudoukou.github.io/blog-img/FkGuU0HqFd5AZwIF7taEVgSkziAT.webp">
  
  
  
  <title>学习总结 - xiamu</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"roudoukou.github.io","root":"/","version":"1.9.4","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>xiamu</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/bg.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="学习总结"></span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        肉豆蔻吖
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-12-01 11:51" pubdate>
          2022年12月1日 中午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          5.3k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          44 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">学习总结</h1>
            
            
              <div class="markdown-body">
                
                <p>编译原理是一套复杂庞大的偏底层的知识体系。目的是将高级程序设计语言转换成计算机硬件能识别的机器语言，以便计算机进行处理。本文将给大家提炼介绍整体的流程，以及具体深挖部分细节流程。主要会围绕以下几个方面进行介绍：</p>
<ul>
<li>代码到底是什么</li>
<li>什么是编译</li>
<li>计算机如何将代码转换成可以运行的目标程序(重点介绍)</li>
<li>计算机怎么理解机器语言并落实在硬件上执行</li>
<li>JS 代码的编译解析执行过程</li>
</ul>
<h1 id="代码到底是什么"><a href="#代码到底是什么" class="headerlink" title="代码到底是什么"></a>代码到底是什么</h1><p>如果你是内行。代码就是你现在想的那个东西（程序、与计算机交流的语言、指令、blablabla……）。一个懂得都懂，只可意会，不可言传的东西。<br>如果你是专家。代码是一个文本文件，包含了 CPU 指令和预置数据。<br>如果你是大师。代码就是两杯水，一杯是空的，一杯是满的。道德经里说上善若水，水善利万物而不争……</p>
<h1 id="什么是编译"><a href="#什么是编译" class="headerlink" title="什么是编译"></a>什么是编译</h1><p><img src="https://cdn.jsdelivr.net/gh/roudoukou/roudoukou.github.io/blog-img/FkGuU0HqFd5AZwIF7taEVgSkziAT.webp" srcset="/img/loading.gif" lazyload><br>机器语言，晦涩难记。所以有了汇编语言。<br>汇编语言，依赖目标机器，需要熟悉相关机器特性。所以有了高级语言。<br>高级语言方便记忆，方便开发，甚至可跨平台，但计算机无法理解。<br><strong>编译就是将高级语言(源语言)翻译成汇编语言或机器语言(目标语言)的过程。</strong></p>
<h1 id="计算机如何将代码转换成可以运行的目标代码"><a href="#计算机如何将代码转换成可以运行的目标代码" class="headerlink" title="计算机如何将代码转换成可以运行的目标代码"></a>计算机如何将代码转换成可以运行的目标代码</h1><p>一般计算机会先将源代码转换成一种中间表达形式，然后由这个中间表达形式再翻译成目标代码。先解释下不同情况下我理解的目标代码</p>
<ul>
<li>如果源代码在操作系统上运行：目标代码就是“汇编代码”。再通过汇编的过程形成可执行的机器码文件，然后通过加载器加载到操作系统执行。<strong>为什么编译器不直接产生机器语言而是产生汇编语言？</strong>因为汇编语言比较容易输出和调试，方便优化，汇编语言到机器语言由硬件实现即可,这样分层处理可以有效降低编译器编写复杂性，提高效率。</li>
<li>如果源代码在虚拟机(解释器)上运行：目标代码就是“解释器可以理解的中间形式的代码”，比如字节码(中间代码)、AST 语法树。</li>
</ul>
<p>由源语言到目标语言的转换流程如下：（下文将逐一解释）<br><img src="https://cdn.jsdelivr.net/gh/roudoukou/roudoukou.github.io/blog-img/Fn6opSQJUJsSU2WiyuQMVZWbChcE.webp" srcset="/img/loading.gif" lazyload></p>
<h2 id="词法分析"><a href="#词法分析" class="headerlink" title="词法分析"></a>词法分析</h2><p>词法分析的目的是将源程序代码分成一堆编译器可以理解的单词。实际上分析过程就是从左到右逐行扫描源程序的字符，识别出各个单词，确定单词的类型。然后转换成词法单元(token)的形式。此外，这个阶段还会完成两件事：</p>
<ul>
<li>过滤掉源程序中的注释和空白</li>
<li>将编译器生成的错误信息与源程序位置关联起来</li>
</ul>
<p>token：&lt;词法单元名，属性值&gt;：</p>
<table>
<thead>
<tr>
<th>单词类型</th>
<th>示例</th>
<th>词法单元名</th>
</tr>
</thead>
<tbody><tr>
<td>关键字</td>
<td>if、else、while</td>
<td>一词一名</td>
</tr>
<tr>
<td>标识符</td>
<td>变量名、数组名……</td>
<td>多词一名</td>
</tr>
<tr>
<td>常量</td>
<td>整型、布尔型……</td>
<td>一型一名</td>
</tr>
<tr>
<td>运算符</td>
<td>+、&amp;&amp;、&gt;……</td>
<td>一词一名</td>
</tr>
<tr>
<td>界限符</td>
<td>; {} ()……</td>
<td>一词一名</td>
</tr>
</tbody></table>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-number">1.</span> <span class="hljs-keyword">while</span>(value!=<span class="hljs-number">100</span>)&#123;num++;&#125;<br><br>    <span class="hljs-comment">// 经过词法分析后得到的token序列：</span><br><br>    &lt;<span class="hljs-keyword">while</span>,-&gt;<br>    &lt;(,-&gt;<br>    &lt;id,指向value的符号表项的指针&gt;<br>    &lt;!=,-&gt;<br>    &lt;id,指向<span class="hljs-number">100</span>的符号表项的指针&gt;<br>    &lt;),-&gt;<br>    &lt;&#123;,-&gt;<br>    &lt;id,指向num的符号表项的指针&gt;<br>    &lt;++,-&gt;<br>    &lt;;,-&gt;<br>    &lt;&#125;,-&gt;<br><br> <span class="hljs-number">2.</span> a = b + c * <span class="hljs-number">60</span>;<br><br>    <span class="hljs-comment">// 经过词法分析后得到的token序列：</span><br><br>    &lt;id,a&gt; &lt;=&gt; &lt;id,b&gt; &lt;+&gt; &lt;id,c&gt; &lt;*&gt; &lt;id,<span class="hljs-number">60</span>&gt; &lt;;&gt;<br></code></pre></td></tr></table></figure>

<h2 id="语法分析"><a href="#语法分析" class="headerlink" title="语法分析"></a>语法分析</h2><p>如果把词法分析看作为字母组合成单词的过程，那么语法分析就是一个把单词组合成句子的过程。语法分析器从词法单元中识别出各类短语，如“程序”，“语句”，“表达式”等等。并构造语法分析树 AST。<br>我们来分析一个赋值语句的语法树。依然是上面的 a &#x3D; b + c * 60;<br><img src="https://cdn.jsdelivr.net/gh/roudoukou/roudoukou.github.io/blog-img/Fgo3udD-0xWgYQaL0hOYeVnvO7MH.webp" srcset="/img/loading.gif" lazyload><br>我们可以看到通过词法分析，可以得到 a,b,c 三个标识符，还有一个常数 60.<br>结合下图看，一个标识符或一个常数可以构成一个表达式 1 和表达式 2。一个表达式 1 通过运算符可以和另一个表达式 2 构成一个更大的表达式 3（或者是一个表达式 3 通过运算符可以和另一个表达式 4 构成一个更大的表达式 5）最终一个标识符 a 和一个表达式 5 通过一个赋值符号连接，再加一个分号。这样就构成了一个赋值语句。<br><img src="https://cdn.jsdelivr.net/gh/roudoukou/roudoukou.github.io/blog-img/Fg0cLqKB6dObLEOyCb2oHDAwliKT.webp" srcset="/img/loading.gif" lazyload><br>我们在语法分析中使用一种很具有表达力的工具,用来描述语言的语法规则 —— 上下文本无关语法 G （ context-free grammar, CFG） ：<br>一个 4 元组： (T, N, P, S) ， 其中 T 为终结符集合， N 为非终结符集合， P 为产生式集合， S 为起始符号。<br>一个句子如果能从语法 G 的 S 推导得到， 可以直接称此句子由语法 G 推导得到， 也可称此句子符合这个语法， 或者说此句子属于 G 语言。 G 语言（ G language） 就是语法 G 推导出来的所有句子的集合， 有时也用 G 代表这个集合</p>
<h2 id="语义分析"><a href="#语义分析" class="headerlink" title="语义分析"></a>语义分析</h2><p>语法分析环节，我们初步构建了抽象语法分析树。语义分析阶段就会根据上下文分析，丰富优化这个语法分析树。我们知道高级语言中的语句一般分为两类，声明语句和可执行语句。在声明语句中，会声明一些变量、函数等。并且会给他们一个变量名、函数名等。我们把这类名称叫做标识符。语义分析的任务就是收集标识符的属性信息和语义检查。<br>收集标识符的属性信息包括以下内容：</p>
<ul>
<li><strong>种类&#x2F;种属</strong> 分析当前标识符是属于简单变量、复合变量（数组、对象）、还是函数等</li>
<li><strong>数据类型</strong> 分析标识符变量或函数对应的数据类型，属于常量、数字、布尔值等</li>
<li><strong>存储位置&#x2F;长度</strong> 根据标识符的各类型所占用的内存长度，分配存储位置</li>
<li><strong>值</strong></li>
<li><strong>作用域</strong></li>
<li><strong>参数和返回信息</strong> 参数个数、参数类型、返回值类型等</li>
</ul>
<p>每一个收集的标识符属性内容会被收录在符号表里。<br><img src="https://cdn.jsdelivr.net/gh/roudoukou/roudoukou.github.io/blog-img/FlY_ekp4qHFLMQcLWdcwqNIzn3U_.webp" srcset="/img/loading.gif" lazyload><br>语义分析的另一个工作，语义检查实际上就是要让计算机理解我们的真实意图，把一些模棱两可的地方消除掉。比如：</p>
<ul>
<li>变量或函数未经声明就使用</li>
<li>变量或函数名重复声明</li>
<li>运算分量类型不匹配，比如说把一个数组和一个函数相加</li>
<li>操作符与操作数之间的类型不匹配<ul>
<li>数组下标不是整数</li>
<li>对非数组变量使用数组访问操作符</li>
<li>对非函数名使用函数调用操作符</li>
<li>函数调用的参数类型或数目不匹配</li>
<li>函数返回类型有误</li>
</ul>
</li>
</ul>
<p>最终，语义分析获得的一些信息（引用消解信息、类型信息等）以及上下文分析结果，会附加到 AST 上，<strong>AST 加上这些语义规则，就能完整地反映源代码的含义</strong>。</p>
<h2 id="中间代码生成"><a href="#中间代码生成" class="headerlink" title="中间代码生成"></a>中间代码生成</h2><p>为什么需要中间代码？编译器不能直接使用语义分析的结果去解释执行或者生成目标代码吗？</p>
<ul>
<li>对于不同架构的 CPU，还需要生成不同的汇编代码，如果对每一种汇编代码做优化就很繁琐了。因此我们需要增加一个环节：生成中间代码 IR，统一优化后中间代码，再去将中间代码生成目标代码。并且从软降工程上考虑，这样更容易实现，容易维护。</li>
</ul>
<p>中间代码生成属于编译器前端结构的最后一部分，传入一棵语法树，从根结点，根据该节点的词法属性，分析词法结点之间的逻辑，翻译成合适的中间表示。中间代码有两个用途：</p>
<ul>
<li><strong>解释执行</strong> 像前面提到的在虚拟机上运行的代码，实际上到这一步就完成了编译。可以根据中间代码直接执行</li>
<li><strong>代码优化</strong> 并不是所有的优化都要在汇编的时候才能完成，所以针对中间代码也会做一部分的代码优化工作</li>
</ul>
<h2 id="代码优化器"><a href="#代码优化器" class="headerlink" title="代码优化器"></a>代码优化器</h2><p>代码优化可以分为机器无关代码优化和机器相关代码优化。代码优化实际上是为改进代码所进行的等价程序变换，使其运行得更快一些、占用空间更少一些，或者二者兼顾。代码优化按照优化的代码块尺度分为：</p>
<ul>
<li><strong>局部优化</strong> 只有一个控制流入口、一个控制流出口的基本程序块上进行的优化；</li>
<li><strong>循环优化</strong> 对循环中的代码进行的优化；</li>
<li><strong>全局优化</strong> 在整个程序范围内进行的优化。</li>
</ul>
<p>常见的代码优化技术有：删除多余运算、合并已知量和复写传播，删除无用赋值等。</p>
<h2 id="目标代码生成器"><a href="#目标代码生成器" class="headerlink" title="目标代码生成器"></a>目标代码生成器</h2><p>目标代码生成，就是生成虚拟机执行的字节码，或是操作系统执行的汇编代码。代码生成的过程，其实很简单，就是将中间代码逐个翻译成想要的汇编的代码。<br>目标代码生成阶段的任务就有：</p>
<ul>
<li>选择合适指令，生成性能最高的代码。</li>
<li><strong>优化寄存器的分配</strong>，让频繁访问的变量，比如循环语句中的变量放到寄存器中，寄存器比内存快。</li>
<li>在不改变运行结果下，对指令做重排序优化，从而充分运用 CPU 内部的多个功能部件的并行能力。</li>
</ul>
<h1 id="计算机怎么理解机器语言并落实在硬件上执行"><a href="#计算机怎么理解机器语言并落实在硬件上执行" class="headerlink" title="计算机怎么理解机器语言并落实在硬件上执行"></a>计算机怎么理解机器语言并落实在硬件上执行</h1><p>通过上述内容实际上已经完成了编译的过程，我们会得到一个汇编语言。汇编语言到机器语言实际上是一个很简单的“查字典”的过程，这部分工作操作系统会自己完成。计算机说到底就是一个电器，他是怎么理解执行这些 0101 的序列号的呢。实际上计算机执行指令的过程分为四步：</p>
<ul>
<li><strong>取指</strong> 控制器将指令的地址送往存储器，存储器根据指令地址读出指令的内容再送回控制器</li>
<li><strong>译码</strong> 控制器分析指令的操作性质，并向有关部件发出指令所需的控制信号</li>
<li><strong>执行</strong> 控制器从通用寄存器或存储器中取出操作数，然后命令运算器对操作数进行运算</li>
<li><strong>回写</strong> 将运算结果写入通用寄存器或存储器</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/roudoukou/roudoukou.github.io/blog-img/FugCFVaLPt3KEmb4gZJB8jCZ02y-.webp" srcset="/img/loading.gif" lazyload><br>这里列举了一个简单的图示。其实我简单理解这里主要是两大重点<strong>存储</strong>和<strong>运算</strong>。这里会涉及到相关专业的知识，比如模电和数电。我们都知道 01 实际上在计算机就代表电平。我简单理解模电在其中的作用就是去控制这些电平信号，还有过滤一些干扰信号。而数电就和运算的关系比较大。会通过一些电器元件的特殊功能，比如单向二极管。就可以模拟一些逻辑运算。</p>
<h1 id="JS-代码的编译解析执行过程"><a href="#JS-代码的编译解析执行过程" class="headerlink" title="JS 代码的编译解析执行过程"></a>JS 代码的编译解析执行过程</h1><p>了解了整个编译原理的过程，我们来分析一下 js 的编译解析过程。js 作为一个高级语言，在被执行前，也需要被某种程序翻译成机器语言让 cpu 识别并执行。而这种程序大家把它叫做 js 引擎。js 有很多引擎，其中最著名的就是 v8 引擎。虽然引擎品类众多，但是这些引擎的执行流程基本是都是以下四个步骤：</p>
<ul>
<li>Parser：解析器，此处进行此法和语法分析，将 JavaScript 源码转换为 AST 抽象语法树并且生成执行期上下文；</li>
<li>Ignition：解释器，解释器会根据 AST 生成字节码，并解释执行字节码（字节码最终也会转为机器码执行），同时收集优化编译所需的信息;</li>
<li>TurboFan：编译器，负责将字节码“翻译”为不同系统识别的机器码。</li>
</ul>
<p><strong>解释器和编译器</strong><br>解释器比较容易让用户实现自己跨平台的代码，同一套代码可以几乎在所有的操作系统上执行，而无需根据操作系统做修改；但是解释器不会一次把整个程序转译出来，每次运行程序时都要先转成另一种语言再作运行，而且是逐行转译执行，因此解释器的程序整体运行速度缓慢。编译器一次性将所有源代码编译为一个可执行程序，一次编译可重复执行。<br>所以为了沿用解释器优点的同时避免解释器的低效性，即遇到相同代码时还会重新翻译一遍，浏览器开始混合加入编译器，产生了即时编译器（JIT）。浏览器会标记反复运行的代码，即 HotSpot 热点代码。JIT 即把解释器解释代码过程中的热点代码编译成可立即执行的机器码，再次命中热点代码时不再重新解释，能够提高性能。</p>
<ul>
<li>Garbage Collector：垃圾回收模块，负责将程序不再需要的内存空间回收；</li>
</ul>
<p>接下来我们将通过 v8 引擎进行举例。简单说明下 v8 引擎是如何运行 js 的。<br>早期的 v8 引擎实际上会直接把 AST 翻译生成机器代码。也就是说没有解释器，却有两个编译器，它的编译流程是这样的<br><img src="https://cdn.jsdelivr.net/gh/roudoukou/roudoukou.github.io/blog-img/Fvlpv2o5X1kdMmk_4SkJaWUdb4vz.webp" srcset="/img/loading.gif" lazyload><br>首先源码通过解析器会生成一个 AST，AST 经过基准编译器直接生成一个基准的未被优化的机器代码，而不进行任何的中间转换。这样做的好处是当你第一次执行 js 的时候就是执行了高效的机器代码。因为没有中间代码的产生所以就不需要解释器。当代码运行一段时间后，v8 引擎中的分析器线程收集了足够的数据来帮助另一个编译器来做代码优化，这个编译器叫做优化编译器。需要优化的源码重新解析生成 AST，然后优化编译器根据 AST 生成优化后的机器代码。来提升整体的运行效率。但这样设计的缺点是：</p>
<ul>
<li>机器码会占用大量的内存</li>
<li>缺少中间层机器码，无法实现一些优化策略</li>
<li>无法很好的支持和优化 JS 的新语特性，无法拥抱未来</li>
</ul>
<p>所以 v8 引擎在 17 年的时候做了一次大的架构调整，很大程度的去解决和改善了这个问题。改善后的架构加入了解释器，流程如下：<br><img src="https://cdn.jsdelivr.net/gh/roudoukou/roudoukou.github.io/blog-img/FmtaeAwGtQXBho7zHYm2JNpg1RZC.webp" srcset="/img/loading.gif" lazyload><br>解析生成 AST 的过程还是一样的，但在随后引入了解释器，根据 AST 会生成字节码。同时 AST 也会被清除掉，释放内存空间。生成的字节码直接被解释器执行，同时会被作为基准执行模型。字节码相对机器码可以节省 50%-75%的内存。在代码运行的过程中，解释器收集了很多代码优化的信息，这些信息被发送给编译器，编译器会根据这些优化信息和字节码生成优化过的机器代码。这里简单说几个 v8 引擎的优化策略：</p>
<ul>
<li>声明未调用，不会被解析生成 AST</li>
<li>函数只被调用一次，bytcode 直接被解释执行，不会进入到编译优化阶段</li>
<li>函数被调用多次，Igniton 会收集函数类型信息，可能会被标记为热点函数，可能被编译成优化后的机器代码</li>
</ul>
<p>优化后的 v8 引擎架构实际上在运行阶段处于一种字节码和机器码共存的状态。优化后的显著好处体现在：</p>
<ul>
<li>由于一开始不需要直接编译成机器码，生成了中间层的字节码，从而节约了时间</li>
<li>优化编译阶段，不需要从源码重新解析,直接通过字节码进行优化，也可以 deoptimization 回退操作</li>
</ul>
<p>QA 虚拟机最终是如何执行机器码的</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/">#计算机基础</a>
      
        <a href="/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/">#编译原理</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>学习总结</div>
      <div>http://roudoukou.github.io/2022/12/01/学习总结/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>肉豆蔻吖</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2022年12月1日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/12/03/%E5%AE%9E%E9%AA%8C%E5%85%ADOracle%20PLSQL%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1(1)/" title="实验六Oracle PLSQL程序设计(1)">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">实验六Oracle PLSQL程序设计(1)</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/11/30/%E7%90%86%E8%AE%BA%E5%AE%9E%E9%AA%8C%E6%95%99%E5%AD%A6%E4%BA%8C/" title="理论实验教学二">
                        <span class="hidden-mobile">理论实验教学二</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <div class="aplayer" 
    data-id="5237049130" 
    data-server="netease" 
    data-type="playlist" 
    data-fixed="true" 
    data-autoplay="false" 
    data-order="list" 
    data-volume="0.5" 
    data-theme="#1da496" 
    data-preload="auto" >
  </div>

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
